
;
;
/*! react-with-addons-0.14.1.min.js */ 
;
;
/**
* React (with addons) v0.14.1
*
* Copyright 2013-2015, Facebook, Inc.
* All rights reserved.
*
* This source code is licensed under the BSD-style license found in the
* LICENSE file in the root directory of this source tree. An additional grant
* of patent rights can be found in the PATENTS file in the same directory.
*
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.React=e()}}(function(){return function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";var r=e(22),o=e(26),a=e(37),i=e(29),u=e(62),s=e(91),l=e(93),c=e(115),p=e(137),d=e(140);e(168);o.addons={CSSTransitionGroup:i,LinkedStateMixin:r,PureRenderMixin:a,TransitionGroup:s,batchedUpdates:function(){return l.batchedUpdates.apply(this,arguments)},cloneWithProps:c,createFragment:u.create,shallowCompare:p,update:d},t.exports=o},{115:115,137:137,140:140,168:168,22:22,26:26,29:29,37:37,62:62,91:91,93:93}],2:[function(e,t,n){"use strict";var r=e(70),o=e(119),a=e(152),i={componentDidMount:function(){this.props.autoFocus&&a(o(this))}},u={Mixin:i,focusDOMComponent:function(){a(r.getNode(this._rootNodeID))}};t.exports=u},{119:119,152:152,70:70}],3:[function(e,t,n){"use strict";function r(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}function o(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function a(e){switch(e){case N.topCompositionStart:return w.compositionStart;case N.topCompositionEnd:return w.compositionEnd;case N.topCompositionUpdate:return w.compositionUpdate}}function i(e,t){return e===N.topKeyDown&&t.keyCode===E}function u(e,t){switch(e){case N.topKeyUp:return-1!==b.indexOf(t.keyCode);case N.topKeyDown:return t.keyCode!==E;case N.topKeyPress:case N.topMouseDown:case N.topBlur:return!0;default:return!1}}function s(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function l(e,t,n,r,o){var l,c;if(_?l=a(e):R?u(e,r)&&(l=w.compositionEnd):i(e,r)&&(l=w.compositionStart),!l)return null;P&&(R||l!==w.compositionStart?l===w.compositionEnd&&R&&(c=R.getData()):R=m.getPooled(t));var p=g.getPooled(l,n,r,o);if(c)p.data=c;else{var d=s(r);null!==d&&(p.data=d)}return h.accumulateTwoPhaseDispatches(p),p}function c(e,t){switch(e){case N.topCompositionEnd:return s(t);case N.topKeyPress:var n=t.which;return n!==T?null:(S=!0,M);case N.topTextInput:var r=t.data;return r===M&&S?null:r;default:return null}}function p(e,t){if(R){if(e===N.topCompositionEnd||u(e,t)){var n=R.getData();return m.release(R),R=null,n}return null}switch(e){case N.topPaste:return null;case N.topKeyPress:return t.which&&!o(t)?String.fromCharCode(t.which):null;case N.topCompositionEnd:return P?null:t.data;default:return null}}function d(e,t,n,r,o){var a;if(a=D?c(e,r):p(e,r),!a)return null;var i=y.getPooled(w.beforeInput,n,r,o);return i.data=a,h.accumulateTwoPhaseDispatches(i),i}var f=e(15),h=e(19),v=e(144),m=e(20),g=e(100),y=e(104),C=e(163),b=[9,13,27,32],E=229,_=v.canUseDOM&&"CompositionEvent"in window,x=null;v.canUseDOM&&"documentMode"in document&&(x=document.documentMode);var D=v.canUseDOM&&"TextEvent"in window&&!x&&!r(),P=v.canUseDOM&&(!_||x&&x>8&&11>=x),T=32,M=String.fromCharCode(T),N=f.topLevelTypes,w={beforeInput:{phasedRegistrationNames:{bubbled:C({onBeforeInput:null}),captured:C({onBeforeInputCapture:null})},dependencies:[N.topCompositionEnd,N.topKeyPress,N.topTextInput,N.topPaste]},compositionEnd:{phasedRegistrationNames:{bubbled:C({onCompositionEnd:null}),captured:C({onCompositionEndCapture:null})},dependencies:[N.topBlur,N.topCompositionEnd,N.topKeyDown,N.topKeyPress,N.topKeyUp,N.topMouseDown]},compositionStart:{phasedRegistrationNames:{bubbled:C({onCompositionStart:null}),captured:C({onCompositionStartCapture:null})},dependencies:[N.topBlur,N.topCompositionStart,N.topKeyDown,N.topKeyPress,N.topKeyUp,N.topMouseDown]},compositionUpdate:{phasedRegistrationNames:{bubbled:C({onCompositionUpdate:null}),captured:C({onCompositionUpdateCapture:null})},dependencies:[N.topBlur,N.topCompositionUpdate,N.topKeyDown,N.topKeyPress,N.topKeyUp,N.topMouseDown]}},S=!1,R=null,I={eventTypes:w,extractEvents:function(e,t,n,r,o){return[l(e,t,n,r,o),d(e,t,n,r,o)]}};t.exports=I},{100:100,104:104,144:144,15:15,163:163,19:19,20:20}],4:[function(e,t,n){"use strict";function r(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var o={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},a=["Webkit","ms","Moz","O"];Object.keys(o).forEach(function(e){a.forEach(function(t){o[r(t,e)]=o[e]})});var i={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},u={isUnitlessNumber:o,shorthandPropertyExpansions:i};t.exports=u},{}],5:[function(e,t,n){"use strict";var r=e(4),o=e(144),a=e(76),i=(e(146),e(116)),u=e(157),s=e(165),l=(e(168),s(function(e){return u(e)})),c=!1,p="cssFloat";if(o.canUseDOM){var d=document.createElement("div").style;try{d.font=""}catch(f){c=!0}void 0===document.documentElement.style.cssFloat&&(p="styleFloat")}var h={createMarkupForStyles:function(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];null!=r&&(t+=l(n)+":",t+=i(n,r)+";")}return t||null},setValueForStyles:function(e,t){var n=e.style;for(var o in t)if(t.hasOwnProperty(o)){var a=i(o,t[o]);if("float"===o&&(o=p),a)n[o]=a;else{var u=c&&r.shorthandPropertyExpansions[o];if(u)for(var s in u)n[s]="";else n[o]=""}}}};a.measureMethods(h,"CSSPropertyOperations",{setValueForStyles:"setValueForStyles"}),t.exports=h},{116:116,144:144,146:146,157:157,165:165,168:168,4:4,76:76}],6:[function(e,t,n){"use strict";function r(){this._callbacks=null,this._contexts=null}var o=e(25),a=e(24),i=e(158);a(r.prototype,{enqueue:function(e,t){this._callbacks=this._callbacks||[],this._contexts=this._contexts||[],this._callbacks.push(e),this._contexts.push(t)},notifyAll:function(){var e=this._callbacks,t=this._contexts;if(e){e.length!==t.length?i(!1):void 0,this._callbacks=null,this._contexts=null;for(var n=0;n<e.length;n++)e[n].call(t[n]);e.length=0,t.length=0}},reset:function(){this._callbacks=null,this._contexts=null},destructor:function(){this.reset()}}),o.addPoolingTo(r),t.exports=r},{158:158,24:24,25:25}],7:[function(e,t,n){"use strict";function r(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function o(e){var t=x.getPooled(w.change,R,e,D(e));b.accumulateTwoPhaseDispatches(t),_.batchedUpdates(a,t)}function a(e){C.enqueueEvents(e),C.processEventQueue(!1)}function i(e,t){S=e,R=t,S.attachEvent("onchange",o)}function u(){S&&(S.detachEvent("onchange",o),S=null,R=null)}function s(e,t,n){return e===N.topChange?n:void 0}function l(e,t,n){e===N.topFocus?(u(),i(t,n)):e===N.topBlur&&u()}function c(e,t){S=e,R=t,I=e.value,k=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(S,"value",L),S.attachEvent("onpropertychange",d)}function p(){S&&(delete S.value,S.detachEvent("onpropertychange",d),S=null,R=null,I=null,k=null)}function d(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==I&&(I=t,o(e))}}function f(e,t,n){return e===N.topInput?n:void 0}function h(e,t,n){e===N.topFocus?(p(),c(t,n)):e===N.topBlur&&p()}function v(e,t,n){return e!==N.topSelectionChange&&e!==N.topKeyUp&&e!==N.topKeyDown||!S||S.value===I?void 0:(I=S.value,R)}function m(e){return e.nodeName&&"input"===e.nodeName.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function g(e,t,n){return e===N.topClick?n:void 0}var y=e(15),C=e(16),b=e(19),E=e(144),_=e(93),x=e(102),D=e(125),P=e(130),T=e(131),M=e(163),N=y.topLevelTypes,w={change:{phasedRegistrationNames:{bubbled:M({onChange:null}),captured:M({onChangeCapture:null})},dependencies:[N.topBlur,N.topChange,N.topClick,N.topFocus,N.topInput,N.topKeyDown,N.topKeyUp,N.topSelectionChange]}},S=null,R=null,I=null,k=null,O=!1;E.canUseDOM&&(O=P("change")&&(!("documentMode"in document)||document.documentMode>8));var A=!1;E.canUseDOM&&(A=P("input")&&(!("documentMode"in document)||document.documentMode>9));var L={get:function(){return k.get.call(this)},set:function(e){I=""+e,k.set.call(this,e)}},U={eventTypes:w,extractEvents:function(e,t,n,o,a){var i,u;if(r(t)?O?i=s:u=l:T(t)?A?i=f:(i=v,u=h):m(t)&&(i=g),i){var c=i(e,t,n);if(c){var p=x.getPooled(w.change,c,o,a);return p.type="change",b.accumulateTwoPhaseDispatches(p),p}}u&&u(e,t,n)}};t.exports=U},{102:102,125:125,130:130,131:131,144:144,15:15,16:16,163:163,19:19,93:93}],8:[function(e,t,n){"use strict";var r=0,o={createReactRootIndex:function(){return r++}};t.exports=o},{}],9:[function(e,t,n){"use strict";function r(e,t,n){var r=n>=e.childNodes.length?null:e.childNodes.item(n);e.insertBefore(t,r)}var o=e(12),a=e(72),i=e(76),u=e(135),s=e(136),l=e(158),c={dangerouslyReplaceNodeWithMarkup:o.dangerouslyReplaceNodeWithMarkup,updateTextContent:s,processUpdates:function(e,t){for(var n,i=null,c=null,p=0;p<e.length;p++)if(n=e[p],n.type===a.MOVE_EXISTING||n.type===a.REMOVE_NODE){var d=n.fromIndex,f=n.parentNode.childNodes[d],h=n.parentID;f?void 0:l(!1),i=i||{},i[h]=i[h]||[],i[h][d]=f,c=c||[],c.push(f)}var v;if(v=t.length&&"string"==typeof t[0]?o.dangerouslyRenderMarkup(t):t,c)for(var m=0;m<c.length;m++)c[m].parentNode.removeChild(c[m]);for(var g=0;g<e.length;g++)switch(n=e[g],n.type){case a.INSERT_MARKUP:r(n.parentNode,v[n.markupIndex],n.toIndex);break;case a.MOVE_EXISTING:r(n.parentNode,i[n.parentID][n.fromIndex],n.toIndex);break;case a.SET_MARKUP:u(n.parentNode,n.content);break;case a.TEXT_CONTENT:s(n.parentNode,n.content);break;case a.REMOVE_NODE:}}};i.measureMethods(c,"DOMChildrenOperations",{updateTextContent:"updateTextContent"}),t.exports=c},{12:12,135:135,136:136,158:158,72:72,76:76}],10:[function(e,t,n){"use strict";function r(e,t){return(e&t)===t}var o=e(158),a={MUST_USE_ATTRIBUTE:1,MUST_USE_PROPERTY:2,HAS_SIDE_EFFECTS:4,HAS_BOOLEAN_VALUE:8,HAS_NUMERIC_VALUE:16,HAS_POSITIVE_NUMERIC_VALUE:48,HAS_OVERLOADED_BOOLEAN_VALUE:64,injectDOMPropertyConfig:function(e){var t=a,n=e.Properties||{},i=e.DOMAttributeNamespaces||{},s=e.DOMAttributeNames||{},l=e.DOMPropertyNames||{},c=e.DOMMutationMethods||{};e.isCustomAttribute&&u._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var p in n){u.properties.hasOwnProperty(p)?o(!1):void 0;var d=p.toLowerCase(),f=n[p],h={attributeName:d,attributeNamespace:null,propertyName:p,mutationMethod:null,mustUseAttribute:r(f,t.MUST_USE_ATTRIBUTE),mustUseProperty:r(f,t.MUST_USE_PROPERTY),hasSideEffects:r(f,t.HAS_SIDE_EFFECTS),hasBooleanValue:r(f,t.HAS_BOOLEAN_VALUE),hasNumericValue:r(f,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:r(f,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:r(f,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(h.mustUseAttribute&&h.mustUseProperty?o(!1):void 0,!h.mustUseProperty&&h.hasSideEffects?o(!1):void 0,h.hasBooleanValue+h.hasNumericValue+h.hasOverloadedBooleanValue<=1?void 0:o(!1),s.hasOwnProperty(p)){var v=s[p];h.attributeName=v}i.hasOwnProperty(p)&&(h.attributeNamespace=i[p]),l.hasOwnProperty(p)&&(h.propertyName=l[p]),c.hasOwnProperty(p)&&(h.mutationMethod=c[p]),u.properties[p]=h}}},i={},u={ID_ATTRIBUTE_NAME:"data-reactid",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<u._isCustomAttributeFunctions.length;t++){var n=u._isCustomAttributeFunctions[t];if(n(e))return!0}return!1},getDefaultValueForProperty:function(e,t){var n,r=i[e];return r||(i[e]=r={}),t in r||(n=document.createElement(e),r[t]=n[t]),r[t]},injection:a};t.exports=u},{158:158}],11:[function(e,t,n){"use strict";function r(e){return c.hasOwnProperty(e)?!0:l.hasOwnProperty(e)?!1:s.test(e)?(c[e]=!0,!0):(l[e]=!0,!1)}function o(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&1>t||e.hasOverloadedBooleanValue&&t===!1}var a=e(10),i=e(76),u=e(133),s=(e(168),/^[a-zA-Z_][\w\.\-]*$/),l={},c={},p={createMarkupForID:function(e){return a.ID_ATTRIBUTE_NAME+"="+u(e)},setAttributeForID:function(e,t){e.setAttribute(a.ID_ATTRIBUTE_NAME,t)},createMarkupForProperty:function(e,t){var n=a.properties.hasOwnProperty(e)?a.properties[e]:null;if(n){if(o(n,t))return"";var r=n.attributeName;return n.hasBooleanValue||n.hasOverloadedBooleanValue&&t===!0?r+'=""':r+"="+u(t)}return a.isCustomAttribute(e)?null==t?"":e+"="+u(t):null},createMarkupForCustomAttribute:function(e,t){return r(e)&&null!=t?e+"="+u(t):""},setValueForProperty:function(e,t,n){var r=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(r){var i=r.mutationMethod;if(i)i(e,n);else if(o(r,n))this.deleteValueForProperty(e,t);else if(r.mustUseAttribute){var u=r.attributeName,s=r.attributeNamespace;s?e.setAttributeNS(s,u,""+n):r.hasBooleanValue||r.hasOverloadedBooleanValue&&n===!0?e.setAttribute(u,""):e.setAttribute(u,""+n)}else{var l=r.propertyName;r.hasSideEffects&&""+e[l]==""+n||(e[l]=n)}}else a.isCustomAttribute(t)&&p.setValueForAttribute(e,t,n)},setValueForAttribute:function(e,t,n){r(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForProperty:function(e,t){var n=a.properties.hasOwnProperty(t)?a.properties[t]:null;if(n){var r=n.mutationMethod;if(r)r(e,void 0);else if(n.mustUseAttribute)e.removeAttribute(n.attributeName);else{var o=n.propertyName,i=a.getDefaultValueForProperty(e.nodeName,o);n.hasSideEffects&&""+e[o]===i||(e[o]=i)}}else a.isCustomAttribute(t)&&e.removeAttribute(t)}};i.measureMethods(p,"DOMPropertyOperations",{setValueForProperty:"setValueForProperty",setValueForAttribute:"setValueForAttribute",deleteValueForProperty:"deleteValueForProperty"}),t.exports=p},{10:10,133:133,168:168,76:76}],12:[function(e,t,n){"use strict";function r(e){return e.substring(1,e.indexOf(" "))}var o=e(144),a=e(149),i=e(150),u=e(154),s=e(158),l=/^(<[^ \/>]+)/,c="data-danger-index",p={dangerouslyRenderMarkup:function(e){o.canUseDOM?void 0:s(!1);for(var t,n={},p=0;p<e.length;p++)e[p]?void 0:s(!1),t=r(e[p]),t=u(t)?t:"*",n[t]=n[t]||[],n[t][p]=e[p];var d=[],f=0;for(t in n)if(n.hasOwnProperty(t)){var h,v=n[t];for(h in v)if(v.hasOwnProperty(h)){var m=v[h];v[h]=m.replace(l,"$1 "+c+'="'+h+'" ')}for(var g=a(v.join(""),i),y=0;y<g.length;++y){var C=g[y];C.hasAttribute&&C.hasAttribute(c)&&(h=+C.getAttribute(c),C.removeAttribute(c),d.hasOwnProperty(h)?s(!1):void 0,d[h]=C,f+=1)}}return f!==d.length?s(!1):void 0,d.length!==e.length?s(!1):void 0,d},dangerouslyReplaceNodeWithMarkup:function(e,t){o.canUseDOM?void 0:s(!1),t?void 0:s(!1),"html"===e.tagName.toLowerCase()?s(!1):void 0;var n;n="string"==typeof t?a(t,i)[0]:t,e.parentNode.replaceChild(n,e)}};t.exports=p},{144:144,149:149,150:150,154:154,158:158}],13:[function(e,t,n){"use strict";var r=e(163),o=[r({ResponderEventPlugin:null}),r({SimpleEventPlugin:null}),r({TapEventPlugin:null}),r({EnterLeaveEventPlugin:null}),r({ChangeEventPlugin:null}),r({SelectEventPlugin:null}),r({BeforeInputEventPlugin:null})];t.exports=o},{163:163}],14:[function(e,t,n){"use strict";var r=e(15),o=e(19),a=e(106),i=e(70),u=e(163),s=r.topLevelTypes,l=i.getFirstReactDOM,c={mouseEnter:{registrationName:u({onMouseEnter:null}),dependencies:[s.topMouseOut,s.topMouseOver]},mouseLeave:{registrationName:u({onMouseLeave:null}),dependencies:[s.topMouseOut,s.topMouseOver]}},p=[null,null],d={eventTypes:c,extractEvents:function(e,t,n,r,u){if(e===s.topMouseOver&&(r.relatedTarget||r.fromElement))return null;if(e!==s.topMouseOut&&e!==s.topMouseOver)return null;var d;if(t.window===t)d=t;else{var f=t.ownerDocument;d=f?f.defaultView||f.parentWindow:window}var h,v,m="",g="";if(e===s.topMouseOut?(h=t,m=n,v=l(r.relatedTarget||r.toElement),v?g=i.getID(v):v=d,v=v||d):(h=d,v=t,g=n),h===v)return null;var y=a.getPooled(c.mouseLeave,m,r,u);y.type="mouseleave",y.target=h,y.relatedTarget=v;var C=a.getPooled(c.mouseEnter,g,r,u);return C.type="mouseenter",C.target=v,C.relatedTarget=h,o.accumulateEnterLeaveDispatches(y,C,m,g),p[0]=y,p[1]=C,p}};t.exports=d},{106:106,15:15,163:163,19:19,70:70}],15:[function(e,t,n){"use strict";var r=e(162),o=r({bubbled:null,captured:null}),a=r({topAbort:null,topBlur:null,topCanPlay:null,topCanPlayThrough:null,topChange:null,topClick:null,topCompositionEnd:null,topCompositionStart:null,topCompositionUpdate:null,topContextMenu:null,topCopy:null,topCut:null,topDoubleClick:null,topDrag:null,topDragEnd:null,topDragEnter:null,topDragExit:null,topDragLeave:null,topDragOver:null,topDragStart:null,topDrop:null,topDurationChange:null,topEmptied:null,topEncrypted:null,topEnded:null,topError:null,topFocus:null,topInput:null,topKeyDown:null,topKeyPress:null,topKeyUp:null,topLoad:null,topLoadedData:null,topLoadedMetadata:null,topLoadStart:null,topMouseDown:null,topMouseMove:null,topMouseOut:null,topMouseOver:null,topMouseUp:null,topPaste:null,topPause:null,topPlay:null,topPlaying:null,topProgress:null,topRateChange:null,topReset:null,topScroll:null,topSeeked:null,topSeeking:null,topSelectionChange:null,topStalled:null,topSubmit:null,topSuspend:null,topTextInput:null,topTimeUpdate:null,topTouchCancel:null,topTouchEnd:null,topTouchMove:null,topTouchStart:null,topVolumeChange:null,topWaiting:null,topWheel:null}),i={topLevelTypes:a,PropagationPhases:o};t.exports=i},{162:162}],16:[function(e,t,n){"use strict";var r=e(17),o=e(18),a=e(59),i=e(112),u=e(121),s=e(158),l=(e(168),{}),c=null,p=function(e,t){e&&(o.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},d=function(e){return p(e,!0)},f=function(e){return p(e,!1)},h=null,v={injection:{injectMount:o.injection.injectMount,injectInstanceHandle:function(e){h=e},getInstanceHandle:function(){return h},injectEventPluginOrder:r.injectEventPluginOrder,injectEventPluginsByName:r.injectEventPluginsByName},eventNameDispatchConfigs:r.eventNameDispatchConfigs,registrationNameModules:r.registrationNameModules,putListener:function(e,t,n){"function"!=typeof n?s(!1):void 0;var o=l[t]||(l[t]={});o[e]=n;var a=r.registrationNameModules[t];a&&a.didPutListener&&a.didPutListener(e,t,n)},getListener:function(e,t){var n=l[t];return n&&n[e]},deleteListener:function(e,t){var n=r.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t);var o=l[t];o&&delete o[e]},deleteAllListeners:function(e){for(var t in l)if(l[t][e]){var n=r.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t),delete l[t][e]}},extractEvents:function(e,t,n,o,a){for(var u,s=r.plugins,l=0;l<s.length;l++){var c=s[l];if(c){var p=c.extractEvents(e,t,n,o,a);p&&(u=i(u,p))}}return u},enqueueEvents:function(e){e&&(c=i(c,e))},processEventQueue:function(e){var t=c;c=null,e?u(t,d):u(t,f),c?s(!1):void 0,a.rethrowCaughtError()},__purge:function(){l={}},__getListenerBank:function(){return l}};t.exports=v},{112:112,121:121,158:158,168:168,17:17,18:18,59:59}],17:[function(e,t,n){"use strict";function r(){if(u)for(var e in s){var t=s[e],n=u.indexOf(e);if(n>-1?void 0:i(!1),!l.plugins[n]){t.extractEvents?void 0:i(!1),l.plugins[n]=t;var r=t.eventTypes;for(var a in r)o(r[a],t,a)?void 0:i(!1)}}}function o(e,t,n){l.eventNameDispatchConfigs.hasOwnProperty(n)?i(!1):void 0,l.eventNameDispatchConfigs[n]=e;var r=e.phasedRegistrationNames;if(r){for(var o in r)if(r.hasOwnProperty(o)){var u=r[o];a(u,t,n)}return!0}return e.registrationName?(a(e.registrationName,t,n),!0):!1}function a(e,t,n){l.registrationNameModules[e]?i(!1):void 0,l.registrationNameModules[e]=t,l.registrationNameDependencies[e]=t.eventTypes[n].dependencies}var i=e(158),u=null,s={},l={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},injectEventPluginOrder:function(e){u?i(!1):void 0,u=Array.prototype.slice.call(e),r()},injectEventPluginsByName:function(e){var t=!1;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];s.hasOwnProperty(n)&&s[n]===o||(s[n]?i(!1):void 0,s[n]=o,t=!0)}t&&r()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return l.registrationNameModules[t.registrationName]||null;for(var n in t.phasedRegistrationNames)if(t.phasedRegistrationNames.hasOwnProperty(n)){var r=l.registrationNameModules[t.phasedRegistrationNames[n]];if(r)return r}return null},_resetEventPlugins:function(){u=null;for(var e in s)s.hasOwnProperty(e)&&delete s[e];l.plugins.length=0;var t=l.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var r=l.registrationNameModules;for(var o in r)r.hasOwnProperty(o)&&delete r[o]}};t.exports=l},{158:158}],18:[function(e,t,n){"use strict";function r(e){return e===m.topMouseUp||e===m.topTouchEnd||e===m.topTouchCancel}function o(e){return e===m.topMouseMove||e===m.topTouchMove}function a(e){return e===m.topMouseDown||e===m.topTouchStart}function i(e,t,n,r){var o=e.type||"unknown-event";e.currentTarget=v.Mount.getNode(r),t?f.invokeGuardedCallbackWithCatch(o,n,e,r):f.invokeGuardedCallback(o,n,e,r),e.currentTarget=null}function u(e,t){var n=e._dispatchListeners,r=e._dispatchIDs;if(Array.isArray(n))for(var o=0;o<n.length&&!e.isPropagationStopped();o++)i(e,t,n[o],r[o]);else n&&i(e,t,n,r);e._dispatchListeners=null,e._dispatchIDs=null}function s(e){var t=e._dispatchListeners,n=e._dispatchIDs;if(Array.isArray(t)){for(var r=0;r<t.length&&!e.isPropagationStopped();r++)if(t[r](e,n[r]))return n[r]}else if(t&&t(e,n))return n;return null}function l(e){var t=s(e);return e._dispatchIDs=null,e._dispatchListeners=null,t}function c(e){var t=e._dispatchListeners,n=e._dispatchIDs;Array.isArray(t)?h(!1):void 0;var r=t?t(e,n):null;return e._dispatchListeners=null,e._dispatchIDs=null,r}function p(e){return!!e._dispatchListeners}var d=e(15),f=e(59),h=e(158),v=(e(168),{Mount:null,injectMount:function(e){v.Mount=e}}),m=d.topLevelTypes,g={isEndish:r,isMoveish:o,isStartish:a,executeDirectDispatch:c,executeDispatchesInOrder:u,executeDispatchesInOrderStopAtTrue:l,hasDispatches:p,getNode:function(e){return v.Mount.getNode(e)},getID:function(e){return v.Mount.getID(e)},injection:v};t.exports=g},{15:15,158:158,168:168,59:59}],19:[function(e,t,n){"use strict";function r(e,t,n){var r=t.dispatchConfig.phasedRegistrationNames[n];return y(e,r)}function o(e,t,n){var o=t?g.bubbled:g.captured,a=r(e,n,o);a&&(n._dispatchListeners=v(n._dispatchListeners,a),n._dispatchIDs=v(n._dispatchIDs,e))}function a(e){e&&e.dispatchConfig.phasedRegistrationNames&&h.injection.getInstanceHandle().traverseTwoPhase(e.dispatchMarker,o,e)}function i(e){e&&e.dispatchConfig.phasedRegistrationNames&&h.injection.getInstanceHandle().traverseTwoPhaseSkipTarget(e.dispatchMarker,o,e)}function u(e,t,n){if(n&&n.dispatchConfig.registrationName){var r=n.dispatchConfig.registrationName,o=y(e,r);o&&(n._dispatchListeners=v(n._dispatchListeners,o),n._dispatchIDs=v(n._dispatchIDs,e))}}function s(e){e&&e.dispatchConfig.registrationName&&u(e.dispatchMarker,null,e)}function l(e){m(e,a)}function c(e){m(e,i)}function p(e,t,n,r){h.injection.getInstanceHandle().traverseEnterLeave(n,r,u,e,t)}function d(e){m(e,s)}var f=e(15),h=e(16),v=(e(168),e(112)),m=e(121),g=f.PropagationPhases,y=h.getListener,C={accumulateTwoPhaseDispatches:l,accumulateTwoPhaseDispatchesSkipTarget:c,accumulateDirectDispatches:d,accumulateEnterLeaveDispatches:p};t.exports=C},{112:112,121:121,15:15,16:16,168:168}],20:[function(e,t,n){"use strict";function r(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var o=e(25),a=e(24),i=e(128);a(r.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[i()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,r=n.length,o=this.getText(),a=o.length;for(e=0;r>e&&n[e]===o[e];e++);var i=r-e;for(t=1;i>=t&&n[r-t]===o[a-t];t++);var u=t>1?1-t:void 0;return this._fallbackText=o.slice(e,u),this._fallbackText}}),o.addPoolingTo(r),t.exports=r},{128:128,24:24,25:25}],21:[function(e,t,n){"use strict";var r,o=e(10),a=e(144),i=o.injection.MUST_USE_ATTRIBUTE,u=o.injection.MUST_USE_PROPERTY,s=o.injection.HAS_BOOLEAN_VALUE,l=o.injection.HAS_SIDE_EFFECTS,c=o.injection.HAS_NUMERIC_VALUE,p=o.injection.HAS_POSITIVE_NUMERIC_VALUE,d=o.injection.HAS_OVERLOADED_BOOLEAN_VALUE;if(a.canUseDOM){var f=document.implementation;r=f&&f.hasFeature&&f.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}var h={isCustomAttribute:RegExp.prototype.test.bind(/^(data|aria)-[a-z_][a-z\d_.\-]*$/),Properties:{accept:null,acceptCharset:null,accessKey:null,action:null,allowFullScreen:i|s,allowTransparency:i,alt:null,async:s,autoComplete:null,autoPlay:s,capture:i|s,cellPadding:null,cellSpacing:null,charSet:i,challenge:i,checked:u|s,classID:i,className:r?i:u,cols:i|p,colSpan:null,content:null,contentEditable:null,contextMenu:i,controls:u|s,coords:null,crossOrigin:null,data:null,dateTime:i,"default":s,defer:s,dir:null,disabled:i|s,download:d,draggable:null,encType:null,form:i,formAction:i,formEncType:i,formMethod:i,formNoValidate:s,formTarget:i,frameBorder:i,headers:null,height:i,hidden:i|s,high:null,href:null,hrefLang:null,htmlFor:null,httpEquiv:null,icon:null,id:u,inputMode:i,is:i,keyParams:i,keyType:i,kind:null,label:null,lang:null,list:i,loop:u|s,low:null,manifest:i,marginHeight:null,marginWidth:null,max:null,maxLength:i,media:i,mediaGroup:null,method:null,min:null,minLength:i,multiple:u|s,muted:u|s,name:null,noValidate:s,open:s,optimum:null,pattern:null,placeholder:null,poster:null,preload:null,radioGroup:null,readOnly:u|s,rel:null,required:s,role:i,rows:i|p,rowSpan:null,sandbox:null,scope:null,scoped:s,scrolling:null,seamless:i|s,selected:u|s,shape:null,size:i|p,sizes:i,span:p,spellCheck:null,src:null,srcDoc:u,srcLang:null,srcSet:i,start:c,step:null,style:null,summary:null,tabIndex:null,target:null,title:null,type:null,useMap:null,value:u|l,width:i,wmode:i,wrap:null,about:i,datatype:i,inlist:i,prefix:i,property:i,resource:i,"typeof":i,vocab:i,autoCapitalize:null,autoCorrect:null,autoSave:null,color:null,itemProp:i,itemScope:i|s,itemType:i,itemID:i,itemRef:i,results:null,security:i,unselectable:i},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{autoCapitalize:"autocapitalize",autoComplete:"autocomplete",autoCorrect:"autocorrect",autoFocus:"autofocus",autoPlay:"autoplay",autoSave:"autosave",encType:"encoding",hrefLang:"hreflang",radioGroup:"radiogroup",spellCheck:"spellcheck",srcDoc:"srcdoc",srcSet:"srcset"}};t.exports=h},{10:10,144:144}],22:[function(e,t,n){"use strict";var r=e(68),o=e(88),a={linkState:function(e){return new r(this.state[e],o.createStateKeySetter(this,e))}};t.exports=a},{68:68,88:88}],23:[function(e,t,n){"use strict";function r(e){null!=e.checkedLink&&null!=e.valueLink?l(!1):void 0}function o(e){r(e),null!=e.value||null!=e.onChange?l(!1):void 0}function a(e){r(e),null!=e.checked||null!=e.onChange?l(!1):void 0}function i(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var u=e(80),s=e(79),l=e(158),c=(e(168),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),p={value:function(e,t,n){return!e[t]||c[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:u.func},d={},f={checkPropTypes:function(e,t,n){for(var r in p){if(p.hasOwnProperty(r))var o=p[r](t,r,e,s.prop);o instanceof Error&&!(o.message in d)&&(d[o.message]=!0,i(n))}},getValue:function(e){return e.valueLink?(o(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(a(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(o(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(a(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};t.exports=f},{158:158,168:168,79:79,80:80}],24:[function(e,t,n){"use strict";function r(e,t){if(null==e)throw new TypeError("Object.assign target cannot be null or undefined");for(var n=Object(e),r=Object.prototype.hasOwnProperty,o=1;o<arguments.length;o++){var a=arguments[o];if(null!=a){var i=Object(a);for(var u in i)r.call(i,u)&&(n[u]=i[u])}}return n}t.exports=r},{}],25:[function(e,t,n){"use strict";var r=e(158),o=function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)},a=function(e,t){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t),r}return new n(e,t)},i=function(e,t,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,e,t,n),o}return new r(e,t,n)},u=function(e,t,n,r){var o=this;if(o.instancePool.length){var a=o.instancePool.pop();return o.call(a,e,t,n,r),a}return new o(e,t,n,r)},s=function(e,t,n,r,o){var a=this;if(a.instancePool.length){var i=a.instancePool.pop();return a.call(i,e,t,n,r,o),i}return new a(e,t,n,r,o)},l=function(e){var t=this;e instanceof t?void 0:r(!1),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},c=10,p=o,d=function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||p,n.poolSize||(n.poolSize=c),n.release=l,n},f={addPoolingTo:d,oneArgumentPooler:o,twoArgumentPooler:a,threeArgumentPooler:i,fourArgumentPooler:u,fiveArgumentPooler:s};t.exports=f},{158:158}],26:[function(e,t,n){"use strict";var r=e(40),o=e(50),a=e(67),i=e(24),u=e(117),s={};i(s,a),i(s,{findDOMNode:u("findDOMNode","ReactDOM","react-dom",r,r.findDOMNode),render:u("render","ReactDOM","react-dom",r,r.render),unmountComponentAtNode:u("unmountComponentAtNode","ReactDOM","react-dom",r,r.unmountComponentAtNode),renderToString:u("renderToString","ReactDOMServer","react-dom/server",o,o.renderToString),renderToStaticMarkup:u("renderToStaticMarkup","ReactDOMServer","react-dom/server",o,o.renderToStaticMarkup)}),s.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=r,t.exports=s},{117:117,24:24,40:40,50:50,67:67}],27:[function(e,t,n){"use strict";var r=(e(66),e(119)),o=(e(168),"_getDOMNodeDidWarn"),a={getDOMNode:function(){return this.constructor[o]=!0,r(this)}};t.exports=a},{119:119,168:168,66:66}],28:[function(e,t,n){"use strict";function r(e){return Object.prototype.hasOwnProperty.call(e,m)||(e[m]=h++,d[e[m]]={}),d[e[m]]}var o=e(15),a=e(16),i=e(17),u=e(60),s=e(76),l=e(111),c=e(24),p=e(130),d={},f=!1,h=0,v={topAbort:"abort",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",
topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},m="_reactListenersID"+String(Math.random()).slice(2),g=c({},u,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(g.handleTopLevel),g.ReactEventListener=e}},setEnabled:function(e){g.ReactEventListener&&g.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!g.ReactEventListener||!g.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,a=r(n),u=i.registrationNameDependencies[e],s=o.topLevelTypes,l=0;l<u.length;l++){var c=u[l];a.hasOwnProperty(c)&&a[c]||(c===s.topWheel?p("wheel")?g.ReactEventListener.trapBubbledEvent(s.topWheel,"wheel",n):p("mousewheel")?g.ReactEventListener.trapBubbledEvent(s.topWheel,"mousewheel",n):g.ReactEventListener.trapBubbledEvent(s.topWheel,"DOMMouseScroll",n):c===s.topScroll?p("scroll",!0)?g.ReactEventListener.trapCapturedEvent(s.topScroll,"scroll",n):g.ReactEventListener.trapBubbledEvent(s.topScroll,"scroll",g.ReactEventListener.WINDOW_HANDLE):c===s.topFocus||c===s.topBlur?(p("focus",!0)?(g.ReactEventListener.trapCapturedEvent(s.topFocus,"focus",n),g.ReactEventListener.trapCapturedEvent(s.topBlur,"blur",n)):p("focusin")&&(g.ReactEventListener.trapBubbledEvent(s.topFocus,"focusin",n),g.ReactEventListener.trapBubbledEvent(s.topBlur,"focusout",n)),a[s.topBlur]=!0,a[s.topFocus]=!0):v.hasOwnProperty(c)&&g.ReactEventListener.trapBubbledEvent(c,v[c],n),a[c]=!0)}},trapBubbledEvent:function(e,t,n){return g.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return g.ReactEventListener.trapCapturedEvent(e,t,n)},ensureScrollValueMonitoring:function(){if(!f){var e=l.refreshScrollValues;g.ReactEventListener.monitorScrollValue(e),f=!0}},eventNameDispatchConfigs:a.eventNameDispatchConfigs,registrationNameModules:a.registrationNameModules,putListener:a.putListener,getListener:a.getListener,deleteListener:a.deleteListener,deleteAllListeners:a.deleteAllListeners});s.measureMethods(g,"ReactBrowserEventEmitter",{putListener:"putListener",deleteListener:"deleteListener"}),t.exports=g},{111:111,130:130,15:15,16:16,17:17,24:24,60:60,76:76}],29:[function(e,t,n){"use strict";function r(e){var t="transition"+e+"Timeout",n="transition"+e;return function(e){if(e[n]){if(null==e[t])return new Error(t+" wasn't supplied to ReactCSSTransitionGroup: this can cause unreliable animations and won't be supported in a future version of React. See https://fb.me/react-animation-transition-group-timeout for more information.");if("number"!=typeof e[t])return new Error(t+" must be a number (in milliseconds)")}}}var o=e(26),a=e(24),i=e(91),u=e(30),s=o.createClass({displayName:"ReactCSSTransitionGroup",propTypes:{transitionName:u.propTypes.name,transitionAppear:o.PropTypes.bool,transitionEnter:o.PropTypes.bool,transitionLeave:o.PropTypes.bool,transitionAppearTimeout:r("Appear"),transitionEnterTimeout:r("Enter"),transitionLeaveTimeout:r("Leave")},getDefaultProps:function(){return{transitionAppear:!1,transitionEnter:!0,transitionLeave:!0}},_wrapChild:function(e){return o.createElement(u,{name:this.props.transitionName,appear:this.props.transitionAppear,enter:this.props.transitionEnter,leave:this.props.transitionLeave,appearTimeout:this.props.transitionAppearTimeout,enterTimeout:this.props.transitionEnterTimeout,leaveTimeout:this.props.transitionLeaveTimeout},e)},render:function(){return o.createElement(i,a({},this.props,{childFactory:this._wrapChild}))}});t.exports=s},{24:24,26:26,30:30,91:91}],30:[function(e,t,n){"use strict";var r=e(26),o=e(40),a=e(142),i=e(90),u=e(132),s=17,l=r.createClass({displayName:"ReactCSSTransitionGroupChild",propTypes:{name:r.PropTypes.oneOfType([r.PropTypes.string,r.PropTypes.shape({enter:r.PropTypes.string,leave:r.PropTypes.string,active:r.PropTypes.string}),r.PropTypes.shape({enter:r.PropTypes.string,enterActive:r.PropTypes.string,leave:r.PropTypes.string,leaveActive:r.PropTypes.string,appear:r.PropTypes.string,appearActive:r.PropTypes.string})]).isRequired,appear:r.PropTypes.bool,enter:r.PropTypes.bool,leave:r.PropTypes.bool,appearTimeout:r.PropTypes.number,enterTimeout:r.PropTypes.number,leaveTimeout:r.PropTypes.number},transition:function(e,t,n){var r=o.findDOMNode(this);if(!r)return void(t&&t());var u=this.props.name[e]||this.props.name+"-"+e,s=this.props.name[e+"Active"]||u+"-active",l=null,c=function(e){e&&e.target!==r||(clearTimeout(l),a.removeClass(r,u),a.removeClass(r,s),i.removeEndEventListener(r,c),t&&t())};a.addClass(r,u),this.queueClass(s),n?l=setTimeout(c,n):i.addEndEventListener(r,c)},queueClass:function(e){this.classNameQueue.push(e),this.timeout||(this.timeout=setTimeout(this.flushClassNameQueue,s))},flushClassNameQueue:function(){this.isMounted()&&this.classNameQueue.forEach(a.addClass.bind(a,o.findDOMNode(this))),this.classNameQueue.length=0,this.timeout=null},componentWillMount:function(){this.classNameQueue=[]},componentWillUnmount:function(){this.timeout&&clearTimeout(this.timeout)},componentWillAppear:function(e){this.props.appear?this.transition("appear",e,this.props.appearTimeout):e()},componentWillEnter:function(e){this.props.enter?this.transition("enter",e,this.props.enterTimeout):e()},componentWillLeave:function(e){this.props.leave?this.transition("leave",e,this.props.leaveTimeout):e()},render:function(){return u(this.props.children)}});t.exports=l},{132:132,142:142,26:26,40:40,90:90}],31:[function(e,t,n){"use strict";function r(e,t,n){var r=void 0===e[n];null!=t&&r&&(e[n]=a(t,null))}var o=e(82),a=e(129),i=e(138),u=e(139),s=(e(168),{instantiateChildren:function(e,t,n){if(null==e)return null;var o={};return u(e,r,o),o},updateChildren:function(e,t,n,r){if(!t&&!e)return null;var u;for(u in t)if(t.hasOwnProperty(u)){var s=e&&e[u],l=s&&s._currentElement,c=t[u];if(null!=s&&i(l,c))o.receiveComponent(s,c,n,r),t[u]=s;else{s&&o.unmountComponent(s,u);var p=a(c,null);t[u]=p}}for(u in e)!e.hasOwnProperty(u)||t&&t.hasOwnProperty(u)||o.unmountComponent(e[u]);return t},unmountChildren:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];o.unmountComponent(n)}}});t.exports=s},{129:129,138:138,139:139,168:168,82:82}],32:[function(e,t,n){"use strict";function r(e){return(""+e).replace(b,"//")}function o(e,t){this.func=e,this.context=t,this.count=0}function a(e,t,n){var r=e.func,o=e.context;r.call(o,t,e.count++)}function i(e,t,n){if(null==e)return e;var r=o.getPooled(t,n);g(e,a,r),o.release(r)}function u(e,t,n,r){this.result=e,this.keyPrefix=t,this.func=n,this.context=r,this.count=0}function s(e,t,n){var o=e.result,a=e.keyPrefix,i=e.func,u=e.context,s=i.call(u,t,e.count++);Array.isArray(s)?l(s,o,n,m.thatReturnsArgument):null!=s&&(v.isValidElement(s)&&(s=v.cloneAndReplaceKey(s,a+(s!==t?r(s.key||"")+"/":"")+n)),o.push(s))}function l(e,t,n,o,a){var i="";null!=n&&(i=r(n)+"/");var l=u.getPooled(t,i,o,a);g(e,s,l),u.release(l)}function c(e,t,n){if(null==e)return e;var r=[];return l(e,r,null,t,n),r}function p(e,t,n){return null}function d(e,t){return g(e,p,null)}function f(e){var t=[];return l(e,t,null,m.thatReturnsArgument),t}var h=e(25),v=e(55),m=e(150),g=e(139),y=h.twoArgumentPooler,C=h.fourArgumentPooler,b=/\/(?!\/)/g;o.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},h.addPoolingTo(o,y),u.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},h.addPoolingTo(u,C);var E={forEach:i,map:c,mapIntoWithKeyPrefixInternal:l,count:d,toArray:f};t.exports=E},{139:139,150:150,25:25,55:55}],33:[function(e,t,n){"use strict";function r(e,t){var n=_.hasOwnProperty(t)?_[t]:null;D.hasOwnProperty(t)&&(n!==b.OVERRIDE_BASE?m(!1):void 0),e.hasOwnProperty(t)&&(n!==b.DEFINE_MANY&&n!==b.DEFINE_MANY_MERGED?m(!1):void 0)}function o(e,t){if(t){"function"==typeof t?m(!1):void 0,d.isValidElement(t)?m(!1):void 0;var n=e.prototype;t.hasOwnProperty(C)&&x.mixins(e,t.mixins);for(var o in t)if(t.hasOwnProperty(o)&&o!==C){var a=t[o];if(r(n,o),x.hasOwnProperty(o))x[o](e,a);else{var i=_.hasOwnProperty(o),l=n.hasOwnProperty(o),c="function"==typeof a,p=c&&!i&&!l&&t.autobind!==!1;if(p)n.__reactAutoBindMap||(n.__reactAutoBindMap={}),n.__reactAutoBindMap[o]=a,n[o]=a;else if(l){var f=_[o];!i||f!==b.DEFINE_MANY_MERGED&&f!==b.DEFINE_MANY?m(!1):void 0,f===b.DEFINE_MANY_MERGED?n[o]=u(n[o],a):f===b.DEFINE_MANY&&(n[o]=s(n[o],a))}else n[o]=a}}}}function a(e,t){if(t)for(var n in t){var r=t[n];if(t.hasOwnProperty(n)){var o=n in x;o?m(!1):void 0;var a=n in e;a?m(!1):void 0,e[n]=r}}}function i(e,t){e&&t&&"object"==typeof e&&"object"==typeof t?void 0:m(!1);for(var n in t)t.hasOwnProperty(n)&&(void 0!==e[n]?m(!1):void 0,e[n]=t[n]);return e}function u(e,t){return function(){var n=e.apply(this,arguments),r=t.apply(this,arguments);if(null==n)return r;if(null==r)return n;var o={};return i(o,n),i(o,r),o}}function s(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function l(e,t){var n=t.bind(e);return n}function c(e){for(var t in e.__reactAutoBindMap)if(e.__reactAutoBindMap.hasOwnProperty(t)){var n=e.__reactAutoBindMap[t];e[t]=l(e,n)}}var p=e(34),d=e(55),f=(e(79),e(78),e(74)),h=e(24),v=e(151),m=e(158),g=e(162),y=e(163),C=(e(168),y({mixins:null})),b=g({DEFINE_ONCE:null,DEFINE_MANY:null,OVERRIDE_BASE:null,DEFINE_MANY_MERGED:null}),E=[],_={mixins:b.DEFINE_MANY,statics:b.DEFINE_MANY,propTypes:b.DEFINE_MANY,contextTypes:b.DEFINE_MANY,childContextTypes:b.DEFINE_MANY,getDefaultProps:b.DEFINE_MANY_MERGED,getInitialState:b.DEFINE_MANY_MERGED,getChildContext:b.DEFINE_MANY_MERGED,render:b.DEFINE_ONCE,componentWillMount:b.DEFINE_MANY,componentDidMount:b.DEFINE_MANY,componentWillReceiveProps:b.DEFINE_MANY,shouldComponentUpdate:b.DEFINE_ONCE,componentWillUpdate:b.DEFINE_MANY,componentDidUpdate:b.DEFINE_MANY,componentWillUnmount:b.DEFINE_MANY,updateComponent:b.OVERRIDE_BASE},x={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)o(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=h({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=h({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=u(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=h({},e.propTypes,t)},statics:function(e,t){a(e,t)},autobind:function(){}},D={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e),t&&this.updater.enqueueCallback(this,t)},isMounted:function(){return this.updater.isMounted(this)},setProps:function(e,t){this.updater.enqueueSetProps(this,e),t&&this.updater.enqueueCallback(this,t)},replaceProps:function(e,t){this.updater.enqueueReplaceProps(this,e),t&&this.updater.enqueueCallback(this,t)}},P=function(){};h(P.prototype,p.prototype,D);var T={createClass:function(e){var t=function(e,t,n){this.__reactAutoBindMap&&c(this),this.props=e,this.context=t,this.refs=v,this.updater=n||f,this.state=null;var r=this.getInitialState?this.getInitialState():null;"object"!=typeof r||Array.isArray(r)?m(!1):void 0,this.state=r};t.prototype=new P,t.prototype.constructor=t,E.forEach(o.bind(null,t)),o(t,e),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),t.prototype.render?void 0:m(!1);for(var n in _)t.prototype[n]||(t.prototype[n]=null);return t},injection:{injectMixin:function(e){E.push(e)}}};t.exports=T},{151:151,158:158,162:162,163:163,168:168,24:24,34:34,55:55,74:74,78:78,79:79}],34:[function(e,t,n){"use strict";function r(e,t,n){this.props=e,this.context=t,this.refs=a,this.updater=n||o}var o=e(74),a=(e(114),e(151)),i=e(158);e(168);r.prototype.isReactComponent={},r.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e?i(!1):void 0,this.updater.enqueueSetState(this,e),t&&this.updater.enqueueCallback(this,t)},r.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e)};t.exports=r},{114:114,151:151,158:158,168:168,74:74}],35:[function(e,t,n){"use strict";var r=e(45),o=e(70),a={processChildrenUpdates:r.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkupByID:r.dangerouslyReplaceNodeWithMarkupByID,unmountIDFromEnvironment:function(e){o.purgeID(e)}};t.exports=a},{45:45,70:70}],36:[function(e,t,n){"use strict";var r=e(158),o=!1,a={unmountIDFromEnvironment:null,replaceNodeWithMarkupByID:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){o?r(!1):void 0,a.unmountIDFromEnvironment=e.unmountIDFromEnvironment,a.replaceNodeWithMarkupByID=e.replaceNodeWithMarkupByID,a.processChildrenUpdates=e.processChildrenUpdates,o=!0}}};t.exports=a},{158:158}],37:[function(e,t,n){"use strict";var r=e(137),o={shouldComponentUpdate:function(e,t){return r(this,e,t)}};t.exports=o},{137:137}],38:[function(e,t,n){"use strict";function r(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" Check the render method of `"+n+"`."}return""}function o(e){}var a=e(36),i=e(39),u=e(55),s=e(66),l=e(76),c=e(79),p=(e(78),e(82)),d=e(92),f=e(24),h=e(151),v=e(158),m=e(138);e(168);o.prototype.render=function(){var e=s.get(this)._currentElement.type;return e(this.props,this.context,this.updater)};var g=1,y={construct:function(e){this._currentElement=e,this._rootNodeID=null,this._instance=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null},mountComponent:function(e,t,n){this._context=n,this._mountOrder=g++,this._rootNodeID=e;var r,a,i=this._processProps(this._currentElement.props),l=this._processContext(n),c=this._currentElement.type,f="prototype"in c;f&&(r=new c(i,l,d)),(!f||null===r||r===!1||u.isValidElement(r))&&(a=r,r=new o(c)),r.props=i,r.context=l,r.refs=h,r.updater=d,this._instance=r,s.set(r,this);var m=r.state;void 0===m&&(r.state=m=null),"object"!=typeof m||Array.isArray(m)?v(!1):void 0,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,r.componentWillMount&&(r.componentWillMount(),this._pendingStateQueue&&(r.state=this._processPendingState(r.props,r.context))),void 0===a&&(a=this._renderValidatedComponent()),this._renderedComponent=this._instantiateReactComponent(a);var y=p.mountComponent(this._renderedComponent,e,t,this._processChildContext(n));return r.componentDidMount&&t.getReactMountReady().enqueue(r.componentDidMount,r),y},unmountComponent:function(){var e=this._instance;e.componentWillUnmount&&e.componentWillUnmount(),p.unmountComponent(this._renderedComponent),this._renderedComponent=null,this._instance=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=null,this._topLevelWrapper=null,s.remove(e)},_maskContext:function(e){var t=null,n=this._currentElement.type,r=n.contextTypes;if(!r)return h;t={};for(var o in r)t[o]=e[o];return t},_processContext:function(e){var t=this._maskContext(e);return t},_processChildContext:function(e){var t=this._currentElement.type,n=this._instance,r=n.getChildContext&&n.getChildContext();if(r){"object"!=typeof t.childContextTypes?v(!1):void 0;for(var o in r)o in t.childContextTypes?void 0:v(!1);return f({},e,r)}return e},_processProps:function(e){return e},_checkPropTypes:function(e,t,n){var o=this.getName();for(var a in e)if(e.hasOwnProperty(a)){var i;try{"function"!=typeof e[a]?v(!1):void 0,i=e[a](t,a,o,n)}catch(u){i=u}i instanceof Error&&(r(this),n===c.prop)}},receiveComponent:function(e,t,n){var r=this._currentElement,o=this._context;this._pendingElement=null,this.updateComponent(t,r,e,o,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement&&p.receiveComponent(this,this._pendingElement||this._currentElement,e,this._context),(null!==this._pendingStateQueue||this._pendingForceUpdate)&&this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context)},updateComponent:function(e,t,n,r,o){var a,i=this._instance,u=this._context===o?i.context:this._processContext(o);t===n?a=n.props:(a=this._processProps(n.props),i.componentWillReceiveProps&&i.componentWillReceiveProps(a,u));var s=this._processPendingState(a,u),l=this._pendingForceUpdate||!i.shouldComponentUpdate||i.shouldComponentUpdate(a,s,u);l?(this._pendingForceUpdate=!1,this._performComponentUpdate(n,a,s,u,e,o)):(this._currentElement=n,this._context=o,i.props=a,i.state=s,i.context=u)},_processPendingState:function(e,t){var n=this._instance,r=this._pendingStateQueue,o=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!r)return n.state;if(o&&1===r.length)return r[0];for(var a=f({},o?r[0]:n.state),i=o?1:0;i<r.length;i++){var u=r[i];f(a,"function"==typeof u?u.call(n,a,e,t):u)}return a},_performComponentUpdate:function(e,t,n,r,o,a){var i,u,s,l=this._instance,c=Boolean(l.componentDidUpdate);c&&(i=l.props,u=l.state,s=l.context),l.componentWillUpdate&&l.componentWillUpdate(t,n,r),this._currentElement=e,this._context=a,l.props=t,l.state=n,l.context=r,this._updateRenderedComponent(o,a),c&&o.getReactMountReady().enqueue(l.componentDidUpdate.bind(l,i,u,s),l)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,r=n._currentElement,o=this._renderValidatedComponent();if(m(r,o))p.receiveComponent(n,o,e,this._processChildContext(t));else{var a=this._rootNodeID,i=n._rootNodeID;p.unmountComponent(n),this._renderedComponent=this._instantiateReactComponent(o);var u=p.mountComponent(this._renderedComponent,a,e,this._processChildContext(t));this._replaceNodeWithMarkupByID(i,u)}},_replaceNodeWithMarkupByID:function(e,t){a.replaceNodeWithMarkupByID(e,t)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e=this._instance,t=e.render();return t},_renderValidatedComponent:function(){var e;i.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{i.current=null}return null===e||e===!1||u.isValidElement(e)?void 0:v(!1),e},attachRef:function(e,t){var n=this.getPublicInstance();null==n?v(!1):void 0;var r=t.getPublicInstance(),o=n.refs===h?n.refs={}:n.refs;o[e]=r},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return e instanceof o?null:e},_instantiateReactComponent:null};l.measureMethods(y,"ReactCompositeComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent",_renderValidatedComponent:"_renderValidatedComponent"});var C={Mixin:y};t.exports=C},{138:138,151:151,158:158,168:168,24:24,36:36,39:39,55:55,66:66,76:76,78:78,79:79,82:82,92:92}],39:[function(e,t,n){"use strict";var r={current:null};t.exports=r},{}],40:[function(e,t,n){"use strict";var r=e(39),o=e(51),a=e(54),i=e(65),u=e(70),s=e(76),l=e(82),c=e(93),p=e(94),d=e(119),f=e(134);e(168);a.inject();var h=s.measure("React","render",u.render),v={findDOMNode:d,render:h,unmountComponentAtNode:u.unmountComponentAtNode,version:p,unstable_batchedUpdates:c.batchedUpdates,unstable_renderSubtreeIntoContainer:f};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({CurrentOwner:r,InstanceHandles:i,Mount:u,Reconciler:l,TextComponent:o});t.exports=v},{119:119,134:134,168:168,39:39,51:51,54:54,65:65,70:70,76:76,82:82,93:93,94:94}],41:[function(e,t,n){"use strict";var r={onClick:!0,onDoubleClick:!0,onMouseDown:!0,onMouseMove:!0,onMouseUp:!0,onClickCapture:!0,onDoubleClickCapture:!0,onMouseDownCapture:!0,onMouseMoveCapture:!0,onMouseUpCapture:!0},o={getNativeProps:function(e,t,n){if(!t.disabled)return t;var o={};for(var a in t)t.hasOwnProperty(a)&&!r[a]&&(o[a]=t[a]);return o}};t.exports=o},{}],42:[function(e,t,n){"use strict";function r(){return this}function o(){var e=this._reactInternalComponent;return!!e}function a(){}function i(e,t){var n=this._reactInternalComponent;n&&(I.enqueueSetPropsInternal(n,e),t&&I.enqueueCallbackInternal(n,t))}function u(e,t){var n=this._reactInternalComponent;n&&(I.enqueueReplacePropsInternal(n,e),t&&I.enqueueCallbackInternal(n,t))}function s(e,t){t&&(null!=t.dangerouslySetInnerHTML&&(null!=t.children?L(!1):void 0,"object"==typeof t.dangerouslySetInnerHTML&&H in t.dangerouslySetInnerHTML?void 0:L(!1)),null!=t.style&&"object"!=typeof t.style?L(!1):void 0)}function l(e,t,n,r){var o=w.findReactContainerForID(e);if(o){var a=o.nodeType===z?o.ownerDocument:o;j(t,a)}r.getReactMountReady().enqueue(c,{id:e,registrationName:t,listener:n})}function c(){var e=this;_.putListener(e.id,e.registrationName,e.listener)}function p(){var e=this;e._rootNodeID?void 0:L(!1);var t=w.getNode(e._rootNodeID);switch(t?void 0:L(!1),e._tag){case"iframe":e._wrapperState.listeners=[_.trapBubbledEvent(E.topLevelTypes.topLoad,"load",t)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var n in Y)Y.hasOwnProperty(n)&&e._wrapperState.listeners.push(_.trapBubbledEvent(E.topLevelTypes[n],Y[n],t));break;case"img":e._wrapperState.listeners=[_.trapBubbledEvent(E.topLevelTypes.topError,"error",t),_.trapBubbledEvent(E.topLevelTypes.topLoad,"load",t)];break;case"form":e._wrapperState.listeners=[_.trapBubbledEvent(E.topLevelTypes.topReset,"reset",t),_.trapBubbledEvent(E.topLevelTypes.topSubmit,"submit",t)]}}function d(){P.mountReadyWrapper(this)}function f(){M.postUpdateWrapper(this)}function h(e){Z.call($,e)||(X.test(e)?void 0:L(!1),$[e]=!0)}function v(e,t){return e.indexOf("-")>=0||null!=t.is}function m(e){h(e),this._tag=e.toLowerCase(),this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._rootNodeID=null,this._wrapperState=null,this._topLevelWrapper=null,this._nodeWithLegacyProperties=null}var g=e(2),y=e(5),C=e(10),b=e(11),E=e(15),_=e(28),x=e(35),D=e(41),P=e(46),T=e(47),M=e(48),N=e(52),w=e(70),S=e(71),R=e(76),I=e(92),k=e(24),O=e(114),A=e(118),L=e(158),U=(e(130),e(163)),F=e(135),B=e(136),V=(e(166),e(141),e(168),_.deleteListener),j=_.listenTo,W=_.registrationNameModules,K={string:!0,number:!0},q=U({style:null}),H=U({__html:null}),z=1,Y={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},G={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Q={listing:!0,pre:!0,textarea:!0},X=(k({menuitem:!0},G),/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/),$={},Z={}.hasOwnProperty;m.displayName="ReactDOMComponent",m.Mixin={construct:function(e){this._currentElement=e},mountComponent:function(e,t,n){this._rootNodeID=e;var r=this._currentElement.props;switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":this._wrapperState={listeners:null},t.getReactMountReady().enqueue(p,this);break;case"button":r=D.getNativeProps(this,r,n);break;case"input":P.mountWrapper(this,r,n),r=P.getNativeProps(this,r,n);break;case"option":T.mountWrapper(this,r,n),r=T.getNativeProps(this,r,n);break;case"select":M.mountWrapper(this,r,n),r=M.getNativeProps(this,r,n),n=M.processChildContext(this,r,n);break;case"textarea":N.mountWrapper(this,r,n),r=N.getNativeProps(this,r,n)}s(this,r);var o;if(t.useCreateElement){var a=n[w.ownerDocumentContextKey],i=a.createElement(this._currentElement.type);b.setAttributeForID(i,this._rootNodeID),w.getID(i),this._updateDOMProperties({},r,t,i),this._createInitialChildren(t,r,n,i),o=i}else{var u=this._createOpenTagMarkupAndPutListeners(t,r),l=this._createContentMarkup(t,r,n);o=!l&&G[this._tag]?u+"/>":u+">"+l+"</"+this._currentElement.type+">"}switch(this._tag){case"input":t.getReactMountReady().enqueue(d,this);case"button":case"select":case"textarea":r.autoFocus&&t.getReactMountReady().enqueue(g.focusDOMComponent,this)}return o},_createOpenTagMarkupAndPutListeners:function(e,t){var n="<"+this._currentElement.type;for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];if(null!=o)if(W.hasOwnProperty(r))o&&l(this._rootNodeID,r,o,e);else{r===q&&(o&&(o=this._previousStyleCopy=k({},t.style)),o=y.createMarkupForStyles(o));var a=null;a=null!=this._tag&&v(this._tag,t)?b.createMarkupForCustomAttribute(r,o):b.createMarkupForProperty(r,o),a&&(n+=" "+a)}}if(e.renderToStaticMarkup)return n;var i=b.createMarkupForID(this._rootNodeID);return n+" "+i},_createContentMarkup:function(e,t,n){var r="",o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&(r=o.__html);else{var a=K[typeof t.children]?t.children:null,i=null!=a?null:t.children;if(null!=a)r=A(a);else if(null!=i){var u=this.mountChildren(i,e,n);r=u.join("")}}return Q[this._tag]&&"\n"===r.charAt(0)?"\n"+r:r},_createInitialChildren:function(e,t,n,r){var o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&F(r,o.__html);else{var a=K[typeof t.children]?t.children:null,i=null!=a?null:t.children;if(null!=a)B(r,a);else if(null!=i)for(var u=this.mountChildren(i,e,n),s=0;s<u.length;s++)r.appendChild(u[s])}},receiveComponent:function(e,t,n){var r=this._currentElement;this._currentElement=e,this.updateComponent(t,r,e,n)},updateComponent:function(e,t,n,r){var o=t.props,a=this._currentElement.props;switch(this._tag){case"button":o=D.getNativeProps(this,o),a=D.getNativeProps(this,a);break;case"input":P.updateWrapper(this),o=P.getNativeProps(this,o),a=P.getNativeProps(this,a);break;case"option":o=T.getNativeProps(this,o),a=T.getNativeProps(this,a);break;case"select":o=M.getNativeProps(this,o),a=M.getNativeProps(this,a);break;case"textarea":N.updateWrapper(this),o=N.getNativeProps(this,o),a=N.getNativeProps(this,a)}s(this,a),this._updateDOMProperties(o,a,e,null),this._updateDOMChildren(o,a,e,r),!O&&this._nodeWithLegacyProperties&&(this._nodeWithLegacyProperties.props=a),"select"===this._tag&&e.getReactMountReady().enqueue(f,this)},_updateDOMProperties:function(e,t,n,r){var o,a,i;for(o in e)if(!t.hasOwnProperty(o)&&e.hasOwnProperty(o))if(o===q){var u=this._previousStyleCopy;for(a in u)u.hasOwnProperty(a)&&(i=i||{},i[a]="");this._previousStyleCopy=null}else W.hasOwnProperty(o)?e[o]&&V(this._rootNodeID,o):(C.properties[o]||C.isCustomAttribute(o))&&(r||(r=w.getNode(this._rootNodeID)),b.deleteValueForProperty(r,o));for(o in t){var s=t[o],c=o===q?this._previousStyleCopy:e[o];if(t.hasOwnProperty(o)&&s!==c)if(o===q)if(s?s=this._previousStyleCopy=k({},s):this._previousStyleCopy=null,c){for(a in c)!c.hasOwnProperty(a)||s&&s.hasOwnProperty(a)||(i=i||{},i[a]="");for(a in s)s.hasOwnProperty(a)&&c[a]!==s[a]&&(i=i||{},i[a]=s[a])}else i=s;else W.hasOwnProperty(o)?s?l(this._rootNodeID,o,s,n):c&&V(this._rootNodeID,o):v(this._tag,t)?(r||(r=w.getNode(this._rootNodeID)),b.setValueForAttribute(r,o,s)):(C.properties[o]||C.isCustomAttribute(o))&&(r||(r=w.getNode(this._rootNodeID)),null!=s?b.setValueForProperty(r,o,s):b.deleteValueForProperty(r,o))}i&&(r||(r=w.getNode(this._rootNodeID)),y.setValueForStyles(r,i))},_updateDOMChildren:function(e,t,n,r){var o=K[typeof e.children]?e.children:null,a=K[typeof t.children]?t.children:null,i=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,u=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,s=null!=o?null:e.children,l=null!=a?null:t.children,c=null!=o||null!=i,p=null!=a||null!=u;null!=s&&null==l?this.updateChildren(null,n,r):c&&!p&&this.updateTextContent(""),null!=a?o!==a&&this.updateTextContent(""+a):null!=u?i!==u&&this.updateMarkup(""+u):null!=l&&this.updateChildren(l,n,r)},unmountComponent:function(){switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":var e=this._wrapperState.listeners;if(e)for(var t=0;t<e.length;t++)e[t].remove();break;case"input":P.unmountWrapper(this);break;case"html":case"head":case"body":L(!1)}if(this.unmountChildren(),_.deleteAllListeners(this._rootNodeID),x.unmountIDFromEnvironment(this._rootNodeID),this._rootNodeID=null,this._wrapperState=null,this._nodeWithLegacyProperties){var n=this._nodeWithLegacyProperties;n._reactInternalComponent=null,this._nodeWithLegacyProperties=null}},getPublicInstance:function(){if(!this._nodeWithLegacyProperties){var e=w.getNode(this._rootNodeID);e._reactInternalComponent=this,e.getDOMNode=r,e.isMounted=o,e.setState=a,e.replaceState=a,e.forceUpdate=a,e.setProps=i,e.replaceProps=u,e.props=this._currentElement.props,this._nodeWithLegacyProperties=e}return this._nodeWithLegacyProperties}},R.measureMethods(m,"ReactDOMComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent"}),k(m.prototype,m.Mixin,S.Mixin),t.exports=m},{10:10,11:11,114:114,118:118,130:130,135:135,136:136,141:141,15:15,158:158,163:163,166:166,168:168,2:2,24:24,28:28,35:35,41:41,46:46,47:47,48:48,5:5,52:52,70:70,71:71,76:76,92:92}],43:[function(e,t,n){"use strict";function r(e){return o.createFactory(e)}var o=e(55),a=(e(56),e(164)),i=a({a:"a",abbr:"abbr",address:"address",area:"area",article:"article",aside:"aside",audio:"audio",b:"b",base:"base",bdi:"bdi",bdo:"bdo",big:"big",blockquote:"blockquote",body:"body",br:"br",button:"button",canvas:"canvas",caption:"caption",cite:"cite",code:"code",col:"col",colgroup:"colgroup",data:"data",datalist:"datalist",dd:"dd",del:"del",details:"details",dfn:"dfn",dialog:"dialog",div:"div",dl:"dl",dt:"dt",em:"em",embed:"embed",fieldset:"fieldset",figcaption:"figcaption",figure:"figure",footer:"footer",form:"form",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",head:"head",header:"header",hgroup:"hgroup",hr:"hr",html:"html",i:"i",iframe:"iframe",img:"img",input:"input",ins:"ins",kbd:"kbd",keygen:"keygen",label:"label",legend:"legend",li:"li",link:"link",main:"main",map:"map",mark:"mark",menu:"menu",menuitem:"menuitem",meta:"meta",meter:"meter",nav:"nav",noscript:"noscript",object:"object",ol:"ol",optgroup:"optgroup",option:"option",output:"output",p:"p",param:"param",picture:"picture",pre:"pre",progress:"progress",q:"q",rp:"rp",rt:"rt",ruby:"ruby",s:"s",samp:"samp",script:"script",section:"section",select:"select",small:"small",source:"source",span:"span",strong:"strong",style:"style",sub:"sub",summary:"summary",sup:"sup",table:"table",tbody:"tbody",td:"td",textarea:"textarea",tfoot:"tfoot",th:"th",thead:"thead",time:"time",title:"title",tr:"tr",track:"track",u:"u",ul:"ul","var":"var",video:"video",wbr:"wbr",circle:"circle",clipPath:"clipPath",defs:"defs",ellipse:"ellipse",g:"g",image:"image",line:"line",linearGradient:"linearGradient",mask:"mask",path:"path",pattern:"pattern",polygon:"polygon",polyline:"polyline",radialGradient:"radialGradient",rect:"rect",stop:"stop",svg:"svg",text:"text",tspan:"tspan"},r);t.exports=i},{164:164,55:55,56:56}],44:[function(e,t,n){"use strict";var r={useCreateElement:!1};t.exports=r},{}],45:[function(e,t,n){"use strict";var r=e(9),o=e(11),a=e(70),i=e(76),u=e(158),s={dangerouslySetInnerHTML:"`dangerouslySetInnerHTML` must be set using `updateInnerHTMLByID()`.",
style:"`style` must be set using `updateStylesByID()`."},l={updatePropertyByID:function(e,t,n){var r=a.getNode(e);s.hasOwnProperty(t)?u(!1):void 0,null!=n?o.setValueForProperty(r,t,n):o.deleteValueForProperty(r,t)},dangerouslyReplaceNodeWithMarkupByID:function(e,t){var n=a.getNode(e);r.dangerouslyReplaceNodeWithMarkup(n,t)},dangerouslyProcessChildrenUpdates:function(e,t){for(var n=0;n<e.length;n++)e[n].parentNode=a.getNode(e[n].parentID);r.processUpdates(e,t)}};i.measureMethods(l,"ReactDOMIDOperations",{dangerouslyReplaceNodeWithMarkupByID:"dangerouslyReplaceNodeWithMarkupByID",dangerouslyProcessChildrenUpdates:"dangerouslyProcessChildrenUpdates"}),t.exports=l},{11:11,158:158,70:70,76:76,9:9}],46:[function(e,t,n){"use strict";function r(){this._rootNodeID&&d.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=i.executeOnChange(t,e);s.asap(r,this);var o=t.name;if("radio"===t.type&&null!=o){for(var a=u.getNode(this._rootNodeID),l=a;l.parentNode;)l=l.parentNode;for(var d=l.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),f=0;f<d.length;f++){var h=d[f];if(h!==a&&h.form===a.form){var v=u.getID(h);v?void 0:c(!1);var m=p[v];m?void 0:c(!1),s.asap(r,m)}}}return n}var a=e(45),i=e(23),u=e(70),s=e(93),l=e(24),c=e(158),p={},d={getNativeProps:function(e,t,n){var r=i.getValue(t),o=i.getChecked(t),a=l({},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=r?r:e._wrapperState.initialValue,checked:null!=o?o:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange});return a},mountWrapper:function(e,t){var n=t.defaultValue;e._wrapperState={initialChecked:t.defaultChecked||!1,initialValue:null!=n?n:null,onChange:o.bind(e)}},mountReadyWrapper:function(e){p[e._rootNodeID]=e},unmountWrapper:function(e){delete p[e._rootNodeID]},updateWrapper:function(e){var t=e._currentElement.props,n=t.checked;null!=n&&a.updatePropertyByID(e._rootNodeID,"checked",n||!1);var r=i.getValue(t);null!=r&&a.updatePropertyByID(e._rootNodeID,"value",""+r)}};t.exports=d},{158:158,23:23,24:24,45:45,70:70,93:93}],47:[function(e,t,n){"use strict";var r=e(32),o=e(48),a=e(24),i=(e(168),o.valueContextKey),u={mountWrapper:function(e,t,n){var r=n[i],o=null;if(null!=r)if(o=!1,Array.isArray(r)){for(var a=0;a<r.length;a++)if(""+r[a]==""+t.value){o=!0;break}}else o=""+r==""+t.value;e._wrapperState={selected:o}},getNativeProps:function(e,t,n){var o=a({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(o.selected=e._wrapperState.selected);var i="";return r.forEach(t.children,function(e){null!=e&&("string"==typeof e||"number"==typeof e)&&(i+=e)}),o.children=i,o}};t.exports=u},{168:168,24:24,32:32,48:48}],48:[function(e,t,n){"use strict";function r(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=i.getValue(e);null!=t&&o(this,e,t)}}function o(e,t,n){var r,o,a=u.getNode(e._rootNodeID).options;if(t){for(r={},o=0;o<n.length;o++)r[""+n[o]]=!0;for(o=0;o<a.length;o++){var i=r.hasOwnProperty(a[o].value);a[o].selected!==i&&(a[o].selected=i)}}else{for(r=""+n,o=0;o<a.length;o++)if(a[o].value===r)return void(a[o].selected=!0);a.length&&(a[0].selected=!0)}}function a(e){var t=this._currentElement.props,n=i.executeOnChange(t,e);return this._wrapperState.pendingUpdate=!0,s.asap(r,this),n}var i=e(23),u=e(70),s=e(93),l=e(24),c=(e(168),"__ReactDOMSelect_value$"+Math.random().toString(36).slice(2)),p={valueContextKey:c,getNativeProps:function(e,t,n){return l({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var n=i.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=n?n:t.defaultValue,onChange:a.bind(e),wasMultiple:Boolean(t.multiple)}},processChildContext:function(e,t,n){var r=l({},n);return r[c]=e._wrapperState.initialValue,r},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var n=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var r=i.getValue(t);null!=r?(e._wrapperState.pendingUpdate=!1,o(e,Boolean(t.multiple),r)):n!==Boolean(t.multiple)&&(null!=t.defaultValue?o(e,Boolean(t.multiple),t.defaultValue):o(e,Boolean(t.multiple),t.multiple?[]:""))}};t.exports=p},{168:168,23:23,24:24,70:70,93:93}],49:[function(e,t,n){"use strict";function r(e,t,n,r){return e===n&&t===r}function o(e){var t=document.selection,n=t.createRange(),r=n.text.length,o=n.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",n);var a=o.text.length,i=a+r;return{start:a,end:i}}function a(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,o=t.anchorOffset,a=t.focusNode,i=t.focusOffset,u=t.getRangeAt(0);try{u.startContainer.nodeType,u.endContainer.nodeType}catch(s){return null}var l=r(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),c=l?0:u.toString().length,p=u.cloneRange();p.selectNodeContents(e),p.setEnd(u.startContainer,u.startOffset);var d=r(p.startContainer,p.startOffset,p.endContainer,p.endOffset),f=d?0:p.toString().length,h=f+c,v=document.createRange();v.setStart(n,o),v.setEnd(a,i);var m=v.collapsed;return{start:m?h:f,end:m?f:h}}function i(e,t){var n,r,o=document.selection.createRange().duplicate();"undefined"==typeof t.end?(n=t.start,r=n):t.start>t.end?(n=t.end,r=t.start):(n=t.start,r=t.end),o.moveToElementText(e),o.moveStart("character",n),o.setEndPoint("EndToStart",o),o.moveEnd("character",r-n),o.select()}function u(e,t){if(window.getSelection){var n=window.getSelection(),r=e[c()].length,o=Math.min(t.start,r),a="undefined"==typeof t.end?o:Math.min(t.end,r);if(!n.extend&&o>a){var i=a;a=o,o=i}var u=l(e,o),s=l(e,a);if(u&&s){var p=document.createRange();p.setStart(u.node,u.offset),n.removeAllRanges(),o>a?(n.addRange(p),n.extend(s.node,s.offset)):(p.setEnd(s.node,s.offset),n.addRange(p))}}}var s=e(144),l=e(127),c=e(128),p=s.canUseDOM&&"selection"in document&&!("getSelection"in window),d={getOffsets:p?o:a,setOffsets:p?i:u};t.exports=d},{127:127,128:128,144:144}],50:[function(e,t,n){"use strict";var r=e(54),o=e(86),a=e(94);r.inject();var i={renderToString:o.renderToString,renderToStaticMarkup:o.renderToStaticMarkup,version:a};t.exports=i},{54:54,86:86,94:94}],51:[function(e,t,n){"use strict";var r=e(9),o=e(11),a=e(35),i=e(70),u=e(24),s=e(118),l=e(136),c=(e(141),function(e){});u(c.prototype,{construct:function(e){this._currentElement=e,this._stringText=""+e,this._rootNodeID=null,this._mountIndex=0},mountComponent:function(e,t,n){if(this._rootNodeID=e,t.useCreateElement){var r=n[i.ownerDocumentContextKey],a=r.createElement("span");return o.setAttributeForID(a,e),i.getID(a),l(a,this._stringText),a}var u=s(this._stringText);return t.renderToStaticMarkup?u:"<span "+o.createMarkupForID(e)+">"+u+"</span>"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;if(n!==this._stringText){this._stringText=n;var o=i.getNode(this._rootNodeID);r.updateTextContent(o,n)}}},unmountComponent:function(){a.unmountIDFromEnvironment(this._rootNodeID)}}),t.exports=c},{11:11,118:118,136:136,141:141,24:24,35:35,70:70,9:9}],52:[function(e,t,n){"use strict";function r(){this._rootNodeID&&c.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=a.executeOnChange(t,e);return u.asap(r,this),n}var a=e(23),i=e(45),u=e(93),s=e(24),l=e(158),c=(e(168),{getNativeProps:function(e,t,n){null!=t.dangerouslySetInnerHTML?l(!1):void 0;var r=s({},t,{defaultValue:void 0,value:void 0,children:e._wrapperState.initialValue,onChange:e._wrapperState.onChange});return r},mountWrapper:function(e,t){var n=t.defaultValue,r=t.children;null!=r&&(null!=n?l(!1):void 0,Array.isArray(r)&&(r.length<=1?void 0:l(!1),r=r[0]),n=""+r),null==n&&(n="");var i=a.getValue(t);e._wrapperState={initialValue:""+(null!=i?i:n),onChange:o.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=a.getValue(t);null!=n&&i.updatePropertyByID(e._rootNodeID,"value",""+n)}});t.exports=c},{158:158,168:168,23:23,24:24,45:45,93:93}],53:[function(e,t,n){"use strict";function r(){this.reinitializeTransaction()}var o=e(93),a=e(110),i=e(24),u=e(150),s={initialize:u,close:function(){d.isBatchingUpdates=!1}},l={initialize:u,close:o.flushBatchedUpdates.bind(o)},c=[l,s];i(r.prototype,a.Mixin,{getTransactionWrappers:function(){return c}});var p=new r,d={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,r,o,a){var i=d.isBatchingUpdates;d.isBatchingUpdates=!0,i?e(t,n,r,o,a):p.perform(e,null,t,n,r,o,a)}};t.exports=d},{110:110,150:150,24:24,93:93}],54:[function(e,t,n){"use strict";function r(){P||(P=!0,g.EventEmitter.injectReactEventListener(m),g.EventPluginHub.injectEventPluginOrder(u),g.EventPluginHub.injectInstanceHandle(y),g.EventPluginHub.injectMount(C),g.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:x,EnterLeaveEventPlugin:s,ChangeEventPlugin:a,SelectEventPlugin:E,BeforeInputEventPlugin:o}),g.NativeComponent.injectGenericComponentClass(h),g.NativeComponent.injectTextComponentClass(v),g.Class.injectMixin(p),g.DOMProperty.injectDOMPropertyConfig(c),g.DOMProperty.injectDOMPropertyConfig(D),g.EmptyComponent.injectEmptyComponent("noscript"),g.Updates.injectReconcileTransaction(b),g.Updates.injectBatchingStrategy(f),g.RootIndex.injectCreateReactRootIndex(l.canUseDOM?i.createReactRootIndex:_.createReactRootIndex),g.Component.injectEnvironment(d))}var o=e(3),a=e(7),i=e(8),u=e(13),s=e(14),l=e(144),c=e(21),p=e(27),d=e(35),f=e(53),h=e(42),v=e(51),m=e(61),g=e(63),y=e(65),C=e(70),b=e(81),E=e(96),_=e(97),x=e(98),D=e(95),P=!1;t.exports={inject:r}},{13:13,14:14,144:144,21:21,27:27,3:3,35:35,42:42,51:51,53:53,61:61,63:63,65:65,7:7,70:70,8:8,81:81,95:95,96:96,97:97,98:98}],55:[function(e,t,n){"use strict";var r=e(39),o=e(24),a=(e(114),"function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103),i={key:!0,ref:!0,__self:!0,__source:!0},u=function(e,t,n,r,o,i,u){var s={$$typeof:a,type:e,key:t,ref:n,props:u,_owner:i};return s};u.createElement=function(e,t,n){var o,a={},s=null,l=null,c=null,p=null;if(null!=t){l=void 0===t.ref?null:t.ref,s=void 0===t.key?null:""+t.key,c=void 0===t.__self?null:t.__self,p=void 0===t.__source?null:t.__source;for(o in t)t.hasOwnProperty(o)&&!i.hasOwnProperty(o)&&(a[o]=t[o])}var d=arguments.length-2;if(1===d)a.children=n;else if(d>1){for(var f=Array(d),h=0;d>h;h++)f[h]=arguments[h+2];a.children=f}if(e&&e.defaultProps){var v=e.defaultProps;for(o in v)"undefined"==typeof a[o]&&(a[o]=v[o])}return u(e,s,l,c,p,r.current,a)},u.createFactory=function(e){var t=u.createElement.bind(null,e);return t.type=e,t},u.cloneAndReplaceKey=function(e,t){var n=u(e.type,t,e.ref,e._self,e._source,e._owner,e.props);return n},u.cloneAndReplaceProps=function(e,t){var n=u(e.type,e.key,e.ref,e._self,e._source,e._owner,t);return n},u.cloneElement=function(e,t,n){var a,s=o({},e.props),l=e.key,c=e.ref,p=e._self,d=e._source,f=e._owner;if(null!=t){void 0!==t.ref&&(c=t.ref,f=r.current),void 0!==t.key&&(l=""+t.key);for(a in t)t.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(s[a]=t[a])}var h=arguments.length-2;if(1===h)s.children=n;else if(h>1){for(var v=Array(h),m=0;h>m;m++)v[m]=arguments[m+2];s.children=v}return u(e.type,l,c,p,d,f,s)},u.isValidElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===a},t.exports=u},{114:114,24:24,39:39}],56:[function(e,t,n){"use strict";function r(){if(p.current){var e=p.current.getName();if(e)return" Check the render method of `"+e+"`."}return""}function o(e,t){e._store&&!e._store.validated&&null==e.key&&(e._store.validated=!0,a("uniqueKey",e,t))}function a(e,t,n){var o=r();if(!o){var a="string"==typeof n?n:n.displayName||n.name;a&&(o=" Check the top-level render call using <"+a+">.")}var i=h[e]||(h[e]={});if(i[o])return null;i[o]=!0;var u={parentOrOwner:o,url:" See https://fb.me/react-warning-keys for more information.",childOwner:null};return t&&t._owner&&t._owner!==p.current&&(u.childOwner=" It was passed a child from "+t._owner.getName()+"."),u}function i(e,t){if("object"==typeof e)if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];l.isValidElement(r)&&o(r,t)}else if(l.isValidElement(e))e._store&&(e._store.validated=!0);else if(e){var a=d(e);if(a&&a!==e.entries)for(var i,u=a.call(e);!(i=u.next()).done;)l.isValidElement(i.value)&&o(i.value,t)}}function u(e,t,n,o){for(var a in t)if(t.hasOwnProperty(a)){var i;try{"function"!=typeof t[a]?f(!1):void 0,i=t[a](n,a,e,o)}catch(u){i=u}i instanceof Error&&!(i.message in v)&&(v[i.message]=!0,r())}}function s(e){var t=e.type;if("function"==typeof t){var n=t.displayName||t.name;t.propTypes&&u(n,t.propTypes,e.props,c.prop),"function"==typeof t.getDefaultProps}}var l=e(55),c=e(79),p=(e(78),e(39)),d=(e(114),e(126)),f=e(158),h=(e(168),{}),v={},m={createElement:function(e,t,n){var r="string"==typeof e||"function"==typeof e,o=l.createElement.apply(this,arguments);if(null==o)return o;if(r)for(var a=2;a<arguments.length;a++)i(arguments[a],e);return s(o),o},createFactory:function(e){var t=m.createElement.bind(null,e);return t.type=e,t},cloneElement:function(e,t,n){for(var r=l.cloneElement.apply(this,arguments),o=2;o<arguments.length;o++)i(arguments[o],r.type);return s(r),r}};t.exports=m},{114:114,126:126,158:158,168:168,39:39,55:55,78:78,79:79}],57:[function(e,t,n){"use strict";var r,o=e(55),a=e(58),i=e(82),u=e(24),s={injectEmptyComponent:function(e){r=o.createElement(e)}},l=function(e){this._currentElement=null,this._rootNodeID=null,this._renderedComponent=e(r)};u(l.prototype,{construct:function(e){},mountComponent:function(e,t,n){return a.registerNullComponentID(e),this._rootNodeID=e,i.mountComponent(this._renderedComponent,e,t,n)},receiveComponent:function(){},unmountComponent:function(e,t,n){i.unmountComponent(this._renderedComponent),a.deregisterNullComponentID(this._rootNodeID),this._rootNodeID=null,this._renderedComponent=null}}),l.injection=s,t.exports=l},{24:24,55:55,58:58,82:82}],58:[function(e,t,n){"use strict";function r(e){return!!i[e]}function o(e){i[e]=!0}function a(e){delete i[e]}var i={},u={isNullComponentID:r,registerNullComponentID:o,deregisterNullComponentID:a};t.exports=u},{}],59:[function(e,t,n){"use strict";function r(e,t,n,r){try{return t(n,r)}catch(a){return void(null===o&&(o=a))}}var o=null,a={invokeGuardedCallback:r,invokeGuardedCallbackWithCatch:r,rethrowCaughtError:function(){if(o){var e=o;throw o=null,e}}};t.exports=a},{}],60:[function(e,t,n){"use strict";function r(e){o.enqueueEvents(e),o.processEventQueue(!1)}var o=e(16),a={handleTopLevel:function(e,t,n,a,i){var u=o.extractEvents(e,t,n,a,i);r(u)}};t.exports=a},{16:16}],61:[function(e,t,n){"use strict";function r(e){var t=d.getID(e),n=p.getReactRootIDFromNodeID(t),r=d.findReactContainerForID(n),o=d.getFirstReactDOM(r);return o}function o(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function a(e){i(e)}function i(e){for(var t=d.getFirstReactDOM(v(e.nativeEvent))||window,n=t;n;)e.ancestors.push(n),n=r(n);for(var o=0;o<e.ancestors.length;o++){t=e.ancestors[o];var a=d.getID(t)||"";g._handleTopLevel(e.topLevelType,t,a,e.nativeEvent,v(e.nativeEvent))}}function u(e){var t=m(window);e(t)}var s=e(143),l=e(144),c=e(25),p=e(65),d=e(70),f=e(93),h=e(24),v=e(125),m=e(155);h(o.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),c.addPoolingTo(o,c.twoArgumentPooler);var g={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:l.canUseDOM?window:null,setHandleTopLevel:function(e){g._handleTopLevel=e},setEnabled:function(e){g._enabled=!!e},isEnabled:function(){return g._enabled},trapBubbledEvent:function(e,t,n){var r=n;return r?s.listen(r,t,g.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){var r=n;return r?s.capture(r,t,g.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=u.bind(null,e);s.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(g._enabled){var n=o.getPooled(e,t);try{f.batchedUpdates(a,n)}finally{o.release(n)}}}};t.exports=g},{125:125,143:143,144:144,155:155,24:24,25:25,65:65,70:70,93:93}],62:[function(e,t,n){"use strict";var r=e(32),o=e(55),a=e(150),i=e(158),u=(e(168),{create:function(e){if("object"!=typeof e||!e||Array.isArray(e))return e;if(o.isValidElement(e))return e;1===e.nodeType?i(!1):void 0;var t=[];for(var n in e)r.mapIntoWithKeyPrefixInternal(e[n],t,n,a.thatReturnsArgument);return t}});t.exports=u},{150:150,158:158,168:168,32:32,55:55}],63:[function(e,t,n){"use strict";var r=e(10),o=e(16),a=e(36),i=e(33),u=e(57),s=e(28),l=e(73),c=e(76),p=e(84),d=e(93),f={Component:a.injection,Class:i.injection,DOMProperty:r.injection,EmptyComponent:u.injection,EventPluginHub:o.injection,EventEmitter:s.injection,NativeComponent:l.injection,Perf:c.injection,RootIndex:p.injection,Updates:d.injection};t.exports=f},{10:10,16:16,28:28,33:33,36:36,57:57,73:73,76:76,84:84,93:93}],64:[function(e,t,n){"use strict";function r(e){return a(document.documentElement,e)}var o=e(49),a=e(147),i=e(152),u=e(153),s={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=u();return{focusedElem:e,selectionRange:s.hasSelectionCapabilities(e)?s.getSelection(e):null}},restoreSelection:function(e){var t=u(),n=e.focusedElem,o=e.selectionRange;t!==n&&r(n)&&(s.hasSelectionCapabilities(n)&&s.setSelection(n,o),i(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=o.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,r=t.end;if("undefined"==typeof r&&(r=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(r,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",n),a.moveEnd("character",r-n),a.select()}else o.setOffsets(e,t)}};t.exports=s},{147:147,152:152,153:153,49:49}],65:[function(e,t,n){"use strict";function r(e){return f+e.toString(36)}function o(e,t){return e.charAt(t)===f||t===e.length}function a(e){return""===e||e.charAt(0)===f&&e.charAt(e.length-1)!==f}function i(e,t){return 0===t.indexOf(e)&&o(t,e.length)}function u(e){return e?e.substr(0,e.lastIndexOf(f)):""}function s(e,t){if(a(e)&&a(t)?void 0:d(!1),i(e,t)?void 0:d(!1),e===t)return e;var n,r=e.length+h;for(n=r;n<t.length&&!o(t,n);n++);return t.substr(0,n)}function l(e,t){var n=Math.min(e.length,t.length);if(0===n)return"";for(var r=0,i=0;n>=i;i++)if(o(e,i)&&o(t,i))r=i;else if(e.charAt(i)!==t.charAt(i))break;var u=e.substr(0,r);return a(u)?void 0:d(!1),u}function c(e,t,n,r,o,a){e=e||"",t=t||"",e===t?d(!1):void 0;var l=i(t,e);l||i(e,t)?void 0:d(!1);for(var c=0,p=l?u:s,f=e;;f=p(f,t)){var h;if(o&&f===e||a&&f===t||(h=n(f,l,r)),h===!1||f===t)break;c++<v?void 0:d(!1)}}var p=e(84),d=e(158),f=".",h=f.length,v=1e4,m={createReactRootID:function(){return r(p.createReactRootIndex())},createReactID:function(e,t){return e+t},getReactRootIDFromNodeID:function(e){if(e&&e.charAt(0)===f&&e.length>1){var t=e.indexOf(f,1);return t>-1?e.substr(0,t):e}return null},traverseEnterLeave:function(e,t,n,r,o){var a=l(e,t);a!==e&&c(e,a,n,r,!1,!0),a!==t&&c(a,t,n,o,!0,!1)},traverseTwoPhase:function(e,t,n){e&&(c("",e,t,n,!0,!1),c(e,"",t,n,!1,!0))},traverseTwoPhaseSkipTarget:function(e,t,n){e&&(c("",e,t,n,!0,!0),c(e,"",t,n,!0,!0))},traverseAncestors:function(e,t,n){c("",e,t,n,!0,!1)},getFirstCommonAncestorID:l,_getNextDescendantID:s,isAncestorIDOf:i,SEPARATOR:f};t.exports=m},{158:158,84:84}],66:[function(e,t,n){"use strict";var r={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};t.exports=r},{}],67:[function(e,t,n){"use strict";var r=e(32),o=e(34),a=e(33),i=e(43),u=e(55),s=(e(56),e(80)),l=e(94),c=e(24),p=e(132),d=u.createElement,f=u.createFactory,h=u.cloneElement,v={Children:{map:r.map,forEach:r.forEach,count:r.count,toArray:r.toArray,only:p},Component:o,createElement:d,cloneElement:h,isValidElement:u.isValidElement,PropTypes:s,createClass:a.createClass,createFactory:f,createMixin:function(e){return e},DOM:i,version:l,__spread:c};t.exports=v},{132:132,24:24,32:32,33:33,34:34,43:43,55:55,56:56,80:80,94:94}],68:[function(e,t,n){"use strict";function r(e,t){this.value=e,this.requestChange=t}function o(e){var t={value:"undefined"==typeof e?a.PropTypes.any.isRequired:e.isRequired,requestChange:a.PropTypes.func.isRequired};return a.PropTypes.shape(t)}var a=e(26);r.PropTypes={link:o},t.exports=r},{26:26}],69:[function(e,t,n){"use strict";var r=e(113),o=/\/?>/,a={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=r(e);return e.replace(o," "+a.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var n=t.getAttribute(a.CHECKSUM_ATTR_NAME);n=n&&parseInt(n,10);var o=r(e);return o===n}};t.exports=a},{113:113}],70:[function(e,t,n){"use strict";function r(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r))return r;return e.length===t.length?-1:n}function o(e){return e?e.nodeType===W?e.documentElement:e.firstChild:null}function a(e){var t=o(e);return t&&X.getID(t)}function i(e){var t=u(e);if(t)if(V.hasOwnProperty(t)){var n=V[t];n!==e&&(p(n,t)?L(!1):void 0,V[t]=e)}else V[t]=e;return t}function u(e){return e&&e.getAttribute&&e.getAttribute(B)||""}function s(e,t){var n=u(e);n!==t&&delete V[n],e.setAttribute(B,t),V[t]=e}function l(e){return V.hasOwnProperty(e)&&p(V[e],e)||(V[e]=X.findReactNodeByID(e)),V[e]}function c(e){var t=T.get(e)._rootNodeID;return D.isNullComponentID(t)?null:(V.hasOwnProperty(t)&&p(V[t],t)||(V[t]=X.findReactNodeByID(t)),V[t])}function p(e,t){if(e){u(e)!==t?L(!1):void 0;var n=X.findReactContainerForID(t);if(n&&O(n,e))return!0}return!1}function d(e){delete V[e]}function f(e){var t=V[e];return t&&p(t,e)?void(G=t):!1}function h(e){G=null,P.traverseAncestors(e,f);var t=G;return G=null,t}function v(e,t,n,r,o,a){_.useCreateElement&&(a=I({},a),n.nodeType===W?a[q]=n:a[q]=n.ownerDocument);var i=w.mountComponent(e,t,r,a);e._renderedComponent._topLevelWrapper=e,X._mountImageIntoNode(i,n,o,r)}function m(e,t,n,r,o){var a=R.ReactReconcileTransaction.getPooled(r);a.perform(v,null,e,t,n,a,r,o),R.ReactReconcileTransaction.release(a)}function g(e,t){for(w.unmountComponent(e),t.nodeType===W&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function y(e){var t=a(e);return t?t!==P.getReactRootIDFromNodeID(t):!1}function C(e){for(;e&&e.parentNode!==e;e=e.parentNode)if(1===e.nodeType){var t=u(e);if(t){var n,r=P.getReactRootIDFromNodeID(t),o=e;do if(n=u(o),o=o.parentNode,null==o)return null;while(n!==r);if(o===z[r])return e}}return null}var b=e(10),E=e(28),_=(e(39),e(44)),x=e(55),D=e(58),P=e(65),T=e(66),M=e(69),N=e(76),w=e(82),S=e(92),R=e(93),I=e(24),k=e(151),O=e(147),A=e(129),L=e(158),U=e(135),F=e(138),B=(e(141),e(168),b.ID_ATTRIBUTE_NAME),V={},j=1,W=9,K=11,q="__ReactMount_ownerDocument$"+Math.random().toString(36).slice(2),H={},z={},Y=[],G=null,Q=function(){};Q.prototype.isReactComponent={},Q.prototype.render=function(){return this.props};var X={TopLevelWrapper:Q,_instancesByReactRootID:H,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,r){return X.scrollMonitor(n,function(){S.enqueueElementInternal(e,t),r&&S.enqueueCallbackInternal(e,r)}),e},_registerComponent:function(e,t){!t||t.nodeType!==j&&t.nodeType!==W&&t.nodeType!==K?L(!1):void 0,E.ensureScrollValueMonitoring();var n=X.registerContainer(t);return H[n]=e,n},_renderNewRootComponent:function(e,t,n,r){var o=A(e,null),a=X._registerComponent(o,t);return R.batchedUpdates(m,o,a,t,n,r),o},renderSubtreeIntoContainer:function(e,t,n,r){return null==e||null==e._reactInternalInstance?L(!1):void 0,X._renderSubtreeIntoContainer(e,t,n,r)},_renderSubtreeIntoContainer:function(e,t,n,r){x.isValidElement(t)?void 0:L(!1);var i=new x(Q,null,null,null,null,null,t),s=H[a(n)];if(s){var l=s._currentElement,c=l.props;if(F(c,t)){var p=s._renderedComponent.getPublicInstance(),d=r&&function(){r.call(p)};return X._updateRootComponent(s,i,n,d),p}X.unmountComponentAtNode(n)}var f=o(n),h=f&&!!u(f),v=y(n),m=h&&!s&&!v,g=X._renderNewRootComponent(i,n,m,null!=e?e._reactInternalInstance._processChildContext(e._reactInternalInstance._context):k)._renderedComponent.getPublicInstance();return r&&r.call(g),g},render:function(e,t,n){return X._renderSubtreeIntoContainer(null,e,t,n)},registerContainer:function(e){var t=a(e);return t&&(t=P.getReactRootIDFromNodeID(t)),t||(t=P.createReactRootID()),z[t]=e,t},unmountComponentAtNode:function(e){!e||e.nodeType!==j&&e.nodeType!==W&&e.nodeType!==K?L(!1):void 0;var t=a(e),n=H[t];if(!n){var r=(y(e),u(e));return r&&r===P.getReactRootIDFromNodeID(r),!1}return R.batchedUpdates(g,n,e),delete H[t],delete z[t],!0},findReactContainerForID:function(e){var t=P.getReactRootIDFromNodeID(e),n=z[t];return n},findReactNodeByID:function(e){var t=X.findReactContainerForID(e);return X.findComponentRoot(t,e)},getFirstReactDOM:function(e){return C(e)},findComponentRoot:function(e,t){var n=Y,r=0,o=h(t)||e;for(n[0]=o.firstChild,n.length=1;r<n.length;){for(var a,i=n[r++];i;){var u=X.getID(i);u?t===u?a=i:P.isAncestorIDOf(u,t)&&(n.length=r=0,n.push(i.firstChild)):n.push(i.firstChild),i=i.nextSibling}if(a)return n.length=0,a}n.length=0,L(!1)},_mountImageIntoNode:function(e,t,n,a){if(!t||t.nodeType!==j&&t.nodeType!==W&&t.nodeType!==K?L(!1):void 0,n){var i=o(t);if(M.canReuseMarkup(e,i))return;var u=i.getAttribute(M.CHECKSUM_ATTR_NAME);i.removeAttribute(M.CHECKSUM_ATTR_NAME);var s=i.outerHTML;i.setAttribute(M.CHECKSUM_ATTR_NAME,u);var l=e,c=r(l,s);" (client) "+l.substring(c-20,c+20)+"\n (server) "+s.substring(c-20,c+20),t.nodeType===W?L(!1):void 0}if(t.nodeType===W?L(!1):void 0,a.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(e)}else U(t,e)},ownerDocumentContextKey:q,getReactRootID:a,getID:i,setID:s,getNode:l,getNodeFromInstance:c,isValid:p,purgeID:d};N.measureMethods(X,"ReactMount",{_renderNewRootComponent:"_renderNewRootComponent",_mountImageIntoNode:"_mountImageIntoNode"}),t.exports=X},{10:10,129:129,135:135,138:138,141:141,147:147,151:151,158:158,168:168,24:24,28:28,39:39,44:44,55:55,58:58,65:65,66:66,69:69,76:76,82:82,92:92,93:93}],71:[function(e,t,n){"use strict";function r(e,t,n){m.push({parentID:e,parentNode:null,type:p.INSERT_MARKUP,markupIndex:g.push(t)-1,content:null,fromIndex:null,toIndex:n})}function o(e,t,n){m.push({parentID:e,parentNode:null,type:p.MOVE_EXISTING,markupIndex:null,content:null,fromIndex:t,toIndex:n})}function a(e,t){m.push({parentID:e,parentNode:null,type:p.REMOVE_NODE,markupIndex:null,content:null,fromIndex:t,toIndex:null})}function i(e,t){m.push({parentID:e,parentNode:null,type:p.SET_MARKUP,markupIndex:null,content:t,fromIndex:null,toIndex:null})}function u(e,t){m.push({parentID:e,parentNode:null,type:p.TEXT_CONTENT,markupIndex:null,content:t,fromIndex:null,toIndex:null})}function s(){m.length&&(c.processChildrenUpdates(m,g),l())}function l(){m.length=0,g.length=0}var c=e(36),p=e(72),d=(e(39),e(82)),f=e(31),h=e(120),v=0,m=[],g=[],y={Mixin:{_reconcilerInstantiateChildren:function(e,t,n){return f.instantiateChildren(e,t,n)},_reconcilerUpdateChildren:function(e,t,n,r){var o;return o=h(t),f.updateChildren(e,o,n,r)},mountChildren:function(e,t,n){var r=this._reconcilerInstantiateChildren(e,t,n);this._renderedChildren=r;var o=[],a=0;for(var i in r)if(r.hasOwnProperty(i)){var u=r[i],s=this._rootNodeID+i,l=d.mountComponent(u,s,t,n);u._mountIndex=a++,o.push(l)}return o},updateTextContent:function(e){v++;var t=!0;try{var n=this._renderedChildren;f.unmountChildren(n);for(var r in n)n.hasOwnProperty(r)&&this._unmountChild(n[r]);this.setTextContent(e),t=!1}finally{v--,v||(t?l():s())}},updateMarkup:function(e){v++;var t=!0;try{var n=this._renderedChildren;f.unmountChildren(n);for(var r in n)n.hasOwnProperty(r)&&this._unmountChildByName(n[r],r);this.setMarkup(e),t=!1}finally{v--,v||(t?l():s())}},updateChildren:function(e,t,n){v++;var r=!0;try{this._updateChildren(e,t,n),r=!1}finally{v--,v||(r?l():s())}},_updateChildren:function(e,t,n){var r=this._renderedChildren,o=this._reconcilerUpdateChildren(r,e,t,n);if(this._renderedChildren=o,o||r){var a,i=0,u=0;for(a in o)if(o.hasOwnProperty(a)){var s=r&&r[a],l=o[a];s===l?(this.moveChild(s,u,i),i=Math.max(s._mountIndex,i),s._mountIndex=u):(s&&(i=Math.max(s._mountIndex,i),this._unmountChild(s)),this._mountChildByNameAtIndex(l,a,u,t,n)),u++}for(a in r)!r.hasOwnProperty(a)||o&&o.hasOwnProperty(a)||this._unmountChild(r[a])}},unmountChildren:function(){var e=this._renderedChildren;f.unmountChildren(e),this._renderedChildren=null},moveChild:function(e,t,n){e._mountIndex<n&&o(this._rootNodeID,e._mountIndex,t)},createChild:function(e,t){r(this._rootNodeID,t,e._mountIndex)},removeChild:function(e){a(this._rootNodeID,e._mountIndex)},setTextContent:function(e){u(this._rootNodeID,e)},setMarkup:function(e){i(this._rootNodeID,e)},_mountChildByNameAtIndex:function(e,t,n,r,o){var a=this._rootNodeID+t,i=d.mountComponent(e,a,r,o);e._mountIndex=n,this.createChild(e,i)},_unmountChild:function(e){this.removeChild(e),e._mountIndex=null}}};t.exports=y},{120:120,31:31,36:36,39:39,72:72,82:82}],72:[function(e,t,n){"use strict";var r=e(162),o=r({INSERT_MARKUP:null,MOVE_EXISTING:null,REMOVE_NODE:null,SET_MARKUP:null,TEXT_CONTENT:null});t.exports=o},{162:162}],73:[function(e,t,n){"use strict";function r(e){if("function"==typeof e.type)return e.type;var t=e.type,n=p[t];return null==n&&(p[t]=n=l(t)),n}function o(e){return c?void 0:s(!1),new c(e.type,e.props)}function a(e){return new d(e)}function i(e){return e instanceof d}var u=e(24),s=e(158),l=null,c=null,p={},d=null,f={injectGenericComponentClass:function(e){c=e},injectTextComponentClass:function(e){d=e},injectComponentClasses:function(e){u(p,e)}},h={getComponentClassForElement:r,createInternalComponent:o,createInstanceForText:a,isTextComponent:i,injection:f};t.exports=h},{158:158,24:24}],74:[function(e,t,n){"use strict";function r(e,t){}var o=(e(168),{isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){r(e,"forceUpdate")},enqueueReplaceState:function(e,t){r(e,"replaceState")},enqueueSetState:function(e,t){r(e,"setState")},enqueueSetProps:function(e,t){r(e,"setProps")},enqueueReplaceProps:function(e,t){r(e,"replaceProps")}});t.exports=o},{168:168}],75:[function(e,t,n){"use strict";var r=e(158),o={isValidOwner:function(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)},addComponentAsRefTo:function(e,t,n){o.isValidOwner(n)?void 0:r(!1),n.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,n){o.isValidOwner(n)?void 0:r(!1),n.getPublicInstance().refs[t]===e.getPublicInstance()&&n.detachRef(t)}};t.exports=o},{158:158}],76:[function(e,t,n){"use strict";function r(e,t,n){return n}var o={enableMeasure:!1,storedMeasure:r,measureMethods:function(e,t,n){},measure:function(e,t,n){return n},injection:{injectMeasure:function(e){o.storedMeasure=e}}};t.exports=o},{}],77:[function(e,t,n){"use strict";function r(e){return function(t,n,r){t.hasOwnProperty(n)?t[n]=e(t[n],r):t[n]=r}}function o(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=l[n];r&&l.hasOwnProperty(n)?r(e,n,t[n]):e.hasOwnProperty(n)||(e[n]=t[n])}return e}var a=e(24),i=e(150),u=e(161),s=r(function(e,t){return a({},t,e)}),l={children:i,className:r(u),style:s},c={mergeProps:function(e,t){return o(a({},e),t)}};t.exports=c},{150:150,161:161,24:24}],78:[function(e,t,n){"use strict";var r={};t.exports=r},{}],79:[function(e,t,n){"use strict";var r=e(162),o=r({prop:null,context:null,childContext:null});t.exports=o},{162:162}],80:[function(e,t,n){"use strict";function r(e){function t(t,n,r,o,a,i){if(o=o||_,i=i||r,null==n[r]){var u=C[a];return t?new Error("Required "+u+" `"+i+"` was not specified in "+("`"+o+"`.")):null;
}return e(n,r,o,a,i)}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}function o(e){function t(t,n,r,o,a){var i=t[n],u=v(i);if(u!==e){var s=C[o],l=m(i);return new Error("Invalid "+s+" `"+a+"` of type "+("`"+l+"` supplied to `"+r+"`, expected ")+("`"+e+"`."))}return null}return r(t)}function a(){return r(b.thatReturns(null))}function i(e){function t(t,n,r,o,a){var i=t[n];if(!Array.isArray(i)){var u=C[o],s=v(i);return new Error("Invalid "+u+" `"+a+"` of type "+("`"+s+"` supplied to `"+r+"`, expected an array."))}for(var l=0;l<i.length;l++){var c=e(i,l,r,o,a+"["+l+"]");if(c instanceof Error)return c}return null}return r(t)}function u(){function e(e,t,n,r,o){if(!y.isValidElement(e[t])){var a=C[r];return new Error("Invalid "+a+" `"+o+"` supplied to "+("`"+n+"`, expected a single ReactElement."))}return null}return r(e)}function s(e){function t(t,n,r,o,a){if(!(t[n]instanceof e)){var i=C[o],u=e.name||_,s=g(t[n]);return new Error("Invalid "+i+" `"+a+"` of type "+("`"+s+"` supplied to `"+r+"`, expected ")+("instance of `"+u+"`."))}return null}return r(t)}function l(e){function t(t,n,r,o,a){for(var i=t[n],u=0;u<e.length;u++)if(i===e[u])return null;var s=C[o],l=JSON.stringify(e);return new Error("Invalid "+s+" `"+a+"` of value `"+i+"` "+("supplied to `"+r+"`, expected one of "+l+"."))}return r(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOf, expected an instance of array.")})}function c(e){function t(t,n,r,o,a){var i=t[n],u=v(i);if("object"!==u){var s=C[o];return new Error("Invalid "+s+" `"+a+"` of type "+("`"+u+"` supplied to `"+r+"`, expected an object."))}for(var l in i)if(i.hasOwnProperty(l)){var c=e(i,l,r,o,a+"."+l);if(c instanceof Error)return c}return null}return r(t)}function p(e){function t(t,n,r,o,a){for(var i=0;i<e.length;i++){var u=e[i];if(null==u(t,n,r,o,a))return null}var s=C[o];return new Error("Invalid "+s+" `"+a+"` supplied to "+("`"+r+"`."))}return r(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOfType, expected an instance of array.")})}function d(){function e(e,t,n,r,o){if(!h(e[t])){var a=C[r];return new Error("Invalid "+a+" `"+o+"` supplied to "+("`"+n+"`, expected a ReactNode."))}return null}return r(e)}function f(e){function t(t,n,r,o,a){var i=t[n],u=v(i);if("object"!==u){var s=C[o];return new Error("Invalid "+s+" `"+a+"` of type `"+u+"` "+("supplied to `"+r+"`, expected `object`."))}for(var l in e){var c=e[l];if(c){var p=c(i,l,r,o,a+"."+l);if(p)return p}}return null}return r(t)}function h(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(h);if(null===e||y.isValidElement(e))return!0;var t=E(e);if(!t)return!1;var n,r=t.call(e);if(t!==e.entries){for(;!(n=r.next()).done;)if(!h(n.value))return!1}else for(;!(n=r.next()).done;){var o=n.value;if(o&&!h(o[1]))return!1}return!0;default:return!1}}function v(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":t}function m(e){var t=v(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function g(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}var y=e(55),C=e(78),b=e(150),E=e(126),_="<<anonymous>>",x={array:o("array"),bool:o("boolean"),func:o("function"),number:o("number"),object:o("object"),string:o("string"),any:a(),arrayOf:i,element:u(),instanceOf:s,node:d(),objectOf:c,oneOf:l,oneOfType:p,shape:f};t.exports=x},{126:126,150:150,55:55,78:78}],81:[function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=o.getPooled(null),this.useCreateElement=!e&&u.useCreateElement}var o=e(6),a=e(25),i=e(28),u=e(44),s=e(64),l=e(110),c=e(24),p={initialize:s.getSelectionInformation,close:s.restoreSelection},d={initialize:function(){var e=i.isEnabled();return i.setEnabled(!1),e},close:function(e){i.setEnabled(e)}},f={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},h=[p,d,f],v={getTransactionWrappers:function(){return h},getReactMountReady:function(){return this.reactMountReady},destructor:function(){o.release(this.reactMountReady),this.reactMountReady=null}};c(r.prototype,l.Mixin,v),a.addPoolingTo(r),t.exports=r},{110:110,24:24,25:25,28:28,44:44,6:6,64:64}],82:[function(e,t,n){"use strict";function r(){o.attachRefs(this,this._currentElement)}var o=e(83),a={mountComponent:function(e,t,n,o){var a=e.mountComponent(t,n,o);return e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e),a},unmountComponent:function(e){o.detachRefs(e,e._currentElement),e.unmountComponent()},receiveComponent:function(e,t,n,a){var i=e._currentElement;if(t!==i||a!==e._context){var u=o.shouldUpdateRefs(i,t);u&&o.detachRefs(e,i),e.receiveComponent(t,n,a),u&&e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e)}},performUpdateIfNecessary:function(e,t){e.performUpdateIfNecessary(t)}};t.exports=a},{83:83}],83:[function(e,t,n){"use strict";function r(e,t,n){"function"==typeof e?e(t.getPublicInstance()):a.addComponentAsRefTo(t,e,n)}function o(e,t,n){"function"==typeof e?e(null):a.removeComponentAsRefFrom(t,e,n)}var a=e(75),i={};i.attachRefs=function(e,t){if(null!==t&&t!==!1){var n=t.ref;null!=n&&r(n,e,t._owner)}},i.shouldUpdateRefs=function(e,t){var n=null===e||e===!1,r=null===t||t===!1;return n||r||t._owner!==e._owner||t.ref!==e.ref},i.detachRefs=function(e,t){if(null!==t&&t!==!1){var n=t.ref;null!=n&&o(n,e,t._owner)}},t.exports=i},{75:75}],84:[function(e,t,n){"use strict";var r={injectCreateReactRootIndex:function(e){o.createReactRootIndex=e}},o={createReactRootIndex:null,injection:r};t.exports=o},{}],85:[function(e,t,n){"use strict";var r={isBatchingUpdates:!1,batchedUpdates:function(e){}};t.exports=r},{}],86:[function(e,t,n){"use strict";function r(e){i.isValidElement(e)?void 0:h(!1);var t;try{p.injection.injectBatchingStrategy(l);var n=u.createReactRootID();return t=c.getPooled(!1),t.perform(function(){var r=f(e,null),o=r.mountComponent(n,t,d);return s.addChecksumToMarkup(o)},null)}finally{c.release(t),p.injection.injectBatchingStrategy(a)}}function o(e){i.isValidElement(e)?void 0:h(!1);var t;try{p.injection.injectBatchingStrategy(l);var n=u.createReactRootID();return t=c.getPooled(!0),t.perform(function(){var r=f(e,null);return r.mountComponent(n,t,d)},null)}finally{c.release(t),p.injection.injectBatchingStrategy(a)}}var a=e(53),i=e(55),u=e(65),s=e(69),l=e(85),c=e(87),p=e(93),d=e(151),f=e(129),h=e(158);t.exports={renderToString:r,renderToStaticMarkup:o}},{129:129,151:151,158:158,53:53,55:55,65:65,69:69,85:85,87:87,93:93}],87:[function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.reactMountReady=a.getPooled(null),this.useCreateElement=!1}var o=e(25),a=e(6),i=e(110),u=e(24),s=e(150),l={initialize:function(){this.reactMountReady.reset()},close:s},c=[l],p={getTransactionWrappers:function(){return c},getReactMountReady:function(){return this.reactMountReady},destructor:function(){a.release(this.reactMountReady),this.reactMountReady=null}};u(r.prototype,i.Mixin,p),o.addPoolingTo(r),t.exports=r},{110:110,150:150,24:24,25:25,6:6}],88:[function(e,t,n){"use strict";function r(e,t){var n={};return function(r){n[t]=r,e.setState(n)}}var o={createStateSetter:function(e,t){return function(n,r,o,a,i,u){var s=t.call(e,n,r,o,a,i,u);s&&e.setState(s)}},createStateKeySetter:function(e,t){var n=e.__keySetters||(e.__keySetters={});return n[t]||(n[t]=r(e,t))}};o.Mixin={createStateSetter:function(e){return o.createStateSetter(this,e)},createStateKeySetter:function(e){return o.createStateKeySetter(this,e)}},t.exports=o},{}],89:[function(e,t,n){"use strict";var r=e(120),o={getChildMapping:function(e){return e?r(e):e},mergeChildMappings:function(e,t){function n(n){return t.hasOwnProperty(n)?t[n]:e[n]}e=e||{},t=t||{};var r={},o=[];for(var a in e)t.hasOwnProperty(a)?o.length&&(r[a]=o,o=[]):o.push(a);var i,u={};for(var s in t){if(r.hasOwnProperty(s))for(i=0;i<r[s].length;i++){var l=r[s][i];u[r[s][i]]=n(l)}u[s]=n(s)}for(i=0;i<o.length;i++)u[o[i]]=n(o[i]);return u}};t.exports=o},{120:120}],90:[function(e,t,n){"use strict";function r(){var e=document.createElement("div"),t=e.style;"AnimationEvent"in window||delete u.animationend.animation,"TransitionEvent"in window||delete u.transitionend.transition;for(var n in u){var r=u[n];for(var o in r)if(o in t){s.push(r[o]);break}}}function o(e,t,n){e.addEventListener(t,n,!1)}function a(e,t,n){e.removeEventListener(t,n,!1)}var i=e(144),u={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},s=[];i.canUseDOM&&r();var l={addEndEventListener:function(e,t){return 0===s.length?void window.setTimeout(t,0):void s.forEach(function(n){o(e,n,t)})},removeEndEventListener:function(e,t){0!==s.length&&s.forEach(function(n){a(e,n,t)})}};t.exports=l},{144:144}],91:[function(e,t,n){"use strict";var r=e(26),o=e(89),a=e(24),i=e(150),u=r.createClass({displayName:"ReactTransitionGroup",propTypes:{component:r.PropTypes.any,childFactory:r.PropTypes.func},getDefaultProps:function(){return{component:"span",childFactory:i.thatReturnsArgument}},getInitialState:function(){return{children:o.getChildMapping(this.props.children)}},componentWillMount:function(){this.currentlyTransitioningKeys={},this.keysToEnter=[],this.keysToLeave=[]},componentDidMount:function(){var e=this.state.children;for(var t in e)e[t]&&this.performAppear(t)},componentWillReceiveProps:function(e){var t=o.getChildMapping(e.children),n=this.state.children;this.setState({children:o.mergeChildMappings(n,t)});var r;for(r in t){var a=n&&n.hasOwnProperty(r);!t[r]||a||this.currentlyTransitioningKeys[r]||this.keysToEnter.push(r)}for(r in n){var i=t&&t.hasOwnProperty(r);!n[r]||i||this.currentlyTransitioningKeys[r]||this.keysToLeave.push(r)}},componentDidUpdate:function(){var e=this.keysToEnter;this.keysToEnter=[],e.forEach(this.performEnter);var t=this.keysToLeave;this.keysToLeave=[],t.forEach(this.performLeave)},performAppear:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillAppear?t.componentWillAppear(this._handleDoneAppearing.bind(this,e)):this._handleDoneAppearing(e)},_handleDoneAppearing:function(e){var t=this.refs[e];t.componentDidAppear&&t.componentDidAppear(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)||this.performLeave(e)},performEnter:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillEnter?t.componentWillEnter(this._handleDoneEntering.bind(this,e)):this._handleDoneEntering(e)},_handleDoneEntering:function(e){var t=this.refs[e];t.componentDidEnter&&t.componentDidEnter(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)||this.performLeave(e)},performLeave:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillLeave?t.componentWillLeave(this._handleDoneLeaving.bind(this,e)):this._handleDoneLeaving(e)},_handleDoneLeaving:function(e){var t=this.refs[e];t.componentDidLeave&&t.componentDidLeave(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)?this.performEnter(e):this.setState(function(t){var n=a({},t.children);return delete n[e],{children:n}})},render:function(){var e=[];for(var t in this.state.children){var n=this.state.children[t];n&&e.push(r.cloneElement(this.props.childFactory(n),{ref:t,key:t}))}return r.createElement(this.props.component,this.props,e)}});t.exports=u},{150:150,24:24,26:26,89:89}],92:[function(e,t,n){"use strict";function r(e){u.enqueueUpdate(e)}function o(e,t){var n=i.get(e);return n?n:null}var a=(e(39),e(55)),i=e(66),u=e(93),s=e(24),l=e(158),c=(e(168),{isMounted:function(e){var t=i.get(e);return t?!!t._renderedComponent:!1},enqueueCallback:function(e,t){"function"!=typeof t?l(!1):void 0;var n=o(e);return n?(n._pendingCallbacks?n._pendingCallbacks.push(t):n._pendingCallbacks=[t],void r(n)):null},enqueueCallbackInternal:function(e,t){"function"!=typeof t?l(!1):void 0,e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],r(e)},enqueueForceUpdate:function(e){var t=o(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,r(t))},enqueueReplaceState:function(e,t){var n=o(e,"replaceState");n&&(n._pendingStateQueue=[t],n._pendingReplaceState=!0,r(n))},enqueueSetState:function(e,t){var n=o(e,"setState");if(n){var a=n._pendingStateQueue||(n._pendingStateQueue=[]);a.push(t),r(n)}},enqueueSetProps:function(e,t){var n=o(e,"setProps");n&&c.enqueueSetPropsInternal(n,t)},enqueueSetPropsInternal:function(e,t){var n=e._topLevelWrapper;n?void 0:l(!1);var o=n._pendingElement||n._currentElement,i=o.props,u=s({},i.props,t);n._pendingElement=a.cloneAndReplaceProps(o,a.cloneAndReplaceProps(i,u)),r(n)},enqueueReplaceProps:function(e,t){var n=o(e,"replaceProps");n&&c.enqueueReplacePropsInternal(n,t)},enqueueReplacePropsInternal:function(e,t){var n=e._topLevelWrapper;n?void 0:l(!1);var o=n._pendingElement||n._currentElement,i=o.props;n._pendingElement=a.cloneAndReplaceProps(o,a.cloneAndReplaceProps(i,t)),r(n)},enqueueElementInternal:function(e,t){e._pendingElement=t,r(e)}});t.exports=c},{158:158,168:168,24:24,39:39,55:55,66:66,93:93}],93:[function(e,t,n){"use strict";function r(){T.ReactReconcileTransaction&&b?void 0:m(!1)}function o(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=c.getPooled(),this.reconcileTransaction=T.ReactReconcileTransaction.getPooled(!1)}function a(e,t,n,o,a,i){r(),b.batchedUpdates(e,t,n,o,a,i)}function i(e,t){return e._mountOrder-t._mountOrder}function u(e){var t=e.dirtyComponentsLength;t!==g.length?m(!1):void 0,g.sort(i);for(var n=0;t>n;n++){var r=g[n],o=r._pendingCallbacks;if(r._pendingCallbacks=null,f.performUpdateIfNecessary(r,e.reconcileTransaction),o)for(var a=0;a<o.length;a++)e.callbackQueue.enqueue(o[a],r.getPublicInstance())}}function s(e){return r(),b.isBatchingUpdates?void g.push(e):void b.batchedUpdates(s,e)}function l(e,t){b.isBatchingUpdates?void 0:m(!1),y.enqueue(e,t),C=!0}var c=e(6),p=e(25),d=e(76),f=e(82),h=e(110),v=e(24),m=e(158),g=[],y=c.getPooled(),C=!1,b=null,E={initialize:function(){this.dirtyComponentsLength=g.length},close:function(){this.dirtyComponentsLength!==g.length?(g.splice(0,this.dirtyComponentsLength),D()):g.length=0}},_={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},x=[E,_];v(o.prototype,h.Mixin,{getTransactionWrappers:function(){return x},destructor:function(){this.dirtyComponentsLength=null,c.release(this.callbackQueue),this.callbackQueue=null,T.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return h.Mixin.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)}}),p.addPoolingTo(o);var D=function(){for(;g.length||C;){if(g.length){var e=o.getPooled();e.perform(u,null,e),o.release(e)}if(C){C=!1;var t=y;y=c.getPooled(),t.notifyAll(),c.release(t)}}};D=d.measure("ReactUpdates","flushBatchedUpdates",D);var P={injectReconcileTransaction:function(e){e?void 0:m(!1),T.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e?void 0:m(!1),"function"!=typeof e.batchedUpdates?m(!1):void 0,"boolean"!=typeof e.isBatchingUpdates?m(!1):void 0,b=e}},T={ReactReconcileTransaction:null,batchedUpdates:a,enqueueUpdate:s,flushBatchedUpdates:D,injection:P,asap:l};t.exports=T},{110:110,158:158,24:24,25:25,6:6,76:76,82:82}],94:[function(e,t,n){"use strict";t.exports="0.14.1"},{}],95:[function(e,t,n){"use strict";var r=e(10),o=r.injection.MUST_USE_ATTRIBUTE,a={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},i={Properties:{clipPath:o,cx:o,cy:o,d:o,dx:o,dy:o,fill:o,fillOpacity:o,fontFamily:o,fontSize:o,fx:o,fy:o,gradientTransform:o,gradientUnits:o,markerEnd:o,markerMid:o,markerStart:o,offset:o,opacity:o,patternContentUnits:o,patternUnits:o,points:o,preserveAspectRatio:o,r:o,rx:o,ry:o,spreadMethod:o,stopColor:o,stopOpacity:o,stroke:o,strokeDasharray:o,strokeLinecap:o,strokeOpacity:o,strokeWidth:o,textAnchor:o,transform:o,version:o,viewBox:o,x1:o,x2:o,x:o,xlinkActuate:o,xlinkArcrole:o,xlinkHref:o,xlinkRole:o,xlinkShow:o,xlinkTitle:o,xlinkType:o,xmlBase:o,xmlLang:o,xmlSpace:o,y1:o,y2:o,y:o},DOMAttributeNamespaces:{xlinkActuate:a.xlink,xlinkArcrole:a.xlink,xlinkHref:a.xlink,xlinkRole:a.xlink,xlinkShow:a.xlink,xlinkTitle:a.xlink,xlinkType:a.xlink,xmlBase:a.xml,xmlLang:a.xml,xmlSpace:a.xml},DOMAttributeNames:{clipPath:"clip-path",fillOpacity:"fill-opacity",fontFamily:"font-family",fontSize:"font-size",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",patternContentUnits:"patternContentUnits",patternUnits:"patternUnits",preserveAspectRatio:"preserveAspectRatio",spreadMethod:"spreadMethod",stopColor:"stop-color",stopOpacity:"stop-opacity",strokeDasharray:"stroke-dasharray",strokeLinecap:"stroke-linecap",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",viewBox:"viewBox",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlLang:"xml:lang",xmlSpace:"xml:space"}};t.exports=i},{10:10}],96:[function(e,t,n){"use strict";function r(e){if("selectionStart"in e&&s.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}function o(e,t){if(b||null==g||g!==c())return null;var n=r(g);if(!C||!f(C,n)){C=n;var o=l.getPooled(m.select,y,e,t);return o.type="select",o.target=g,i.accumulateTwoPhaseDispatches(o),o}return null}var a=e(15),i=e(19),u=e(144),s=e(64),l=e(102),c=e(153),p=e(131),d=e(163),f=e(166),h=a.topLevelTypes,v=u.canUseDOM&&"documentMode"in document&&document.documentMode<=11,m={select:{phasedRegistrationNames:{bubbled:d({onSelect:null}),captured:d({onSelectCapture:null})},dependencies:[h.topBlur,h.topContextMenu,h.topFocus,h.topKeyDown,h.topMouseDown,h.topMouseUp,h.topSelectionChange]}},g=null,y=null,C=null,b=!1,E=!1,_=d({onSelect:null}),x={eventTypes:m,extractEvents:function(e,t,n,r,a){if(!E)return null;switch(e){case h.topFocus:(p(t)||"true"===t.contentEditable)&&(g=t,y=n,C=null);break;case h.topBlur:g=null,y=null,C=null;break;case h.topMouseDown:b=!0;break;case h.topContextMenu:case h.topMouseUp:return b=!1,o(r,a);case h.topSelectionChange:if(v)break;case h.topKeyDown:case h.topKeyUp:return o(r,a)}return null},didPutListener:function(e,t,n){t===_&&(E=!0)}};t.exports=x},{102:102,131:131,144:144,15:15,153:153,163:163,166:166,19:19,64:64}],97:[function(e,t,n){"use strict";var r=Math.pow(2,53),o={createReactRootIndex:function(){return Math.ceil(Math.random()*r)}};t.exports=o},{}],98:[function(e,t,n){"use strict";var r=e(15),o=e(143),a=e(19),i=e(70),u=e(99),s=e(102),l=e(103),c=e(105),p=e(106),d=e(101),f=e(107),h=e(108),v=e(109),m=e(150),g=e(122),y=e(158),C=e(163),b=r.topLevelTypes,E={abort:{phasedRegistrationNames:{bubbled:C({onAbort:!0}),captured:C({onAbortCapture:!0})}},blur:{phasedRegistrationNames:{bubbled:C({onBlur:!0}),captured:C({onBlurCapture:!0})}},canPlay:{phasedRegistrationNames:{bubbled:C({onCanPlay:!0}),captured:C({onCanPlayCapture:!0})}},canPlayThrough:{phasedRegistrationNames:{bubbled:C({onCanPlayThrough:!0}),captured:C({onCanPlayThroughCapture:!0})}},click:{phasedRegistrationNames:{bubbled:C({onClick:!0}),captured:C({onClickCapture:!0})}},contextMenu:{phasedRegistrationNames:{bubbled:C({onContextMenu:!0}),captured:C({onContextMenuCapture:!0})}},copy:{phasedRegistrationNames:{bubbled:C({onCopy:!0}),captured:C({onCopyCapture:!0})}},cut:{phasedRegistrationNames:{bubbled:C({onCut:!0}),captured:C({onCutCapture:!0})}},doubleClick:{phasedRegistrationNames:{bubbled:C({onDoubleClick:!0}),captured:C({onDoubleClickCapture:!0})}},drag:{phasedRegistrationNames:{bubbled:C({onDrag:!0}),captured:C({onDragCapture:!0})}},dragEnd:{phasedRegistrationNames:{bubbled:C({onDragEnd:!0}),captured:C({onDragEndCapture:!0})}},dragEnter:{phasedRegistrationNames:{bubbled:C({onDragEnter:!0}),captured:C({onDragEnterCapture:!0})}},dragExit:{phasedRegistrationNames:{bubbled:C({onDragExit:!0}),captured:C({onDragExitCapture:!0})}},dragLeave:{phasedRegistrationNames:{bubbled:C({onDragLeave:!0}),captured:C({onDragLeaveCapture:!0})}},dragOver:{phasedRegistrationNames:{bubbled:C({onDragOver:!0}),captured:C({onDragOverCapture:!0})}},dragStart:{phasedRegistrationNames:{bubbled:C({onDragStart:!0}),captured:C({onDragStartCapture:!0})}},drop:{phasedRegistrationNames:{bubbled:C({onDrop:!0}),captured:C({onDropCapture:!0})}},durationChange:{phasedRegistrationNames:{bubbled:C({onDurationChange:!0}),captured:C({onDurationChangeCapture:!0})}},emptied:{phasedRegistrationNames:{bubbled:C({onEmptied:!0}),captured:C({onEmptiedCapture:!0})}},encrypted:{phasedRegistrationNames:{bubbled:C({onEncrypted:!0}),captured:C({onEncryptedCapture:!0})}},ended:{phasedRegistrationNames:{bubbled:C({onEnded:!0}),captured:C({onEndedCapture:!0})}},error:{phasedRegistrationNames:{bubbled:C({onError:!0}),captured:C({onErrorCapture:!0})}},focus:{phasedRegistrationNames:{bubbled:C({onFocus:!0}),captured:C({onFocusCapture:!0})}},input:{phasedRegistrationNames:{bubbled:C({onInput:!0}),captured:C({onInputCapture:!0})}},keyDown:{phasedRegistrationNames:{bubbled:C({onKeyDown:!0}),captured:C({onKeyDownCapture:!0})}},keyPress:{phasedRegistrationNames:{bubbled:C({onKeyPress:!0}),captured:C({onKeyPressCapture:!0})}},keyUp:{phasedRegistrationNames:{bubbled:C({onKeyUp:!0}),captured:C({onKeyUpCapture:!0})}},load:{phasedRegistrationNames:{bubbled:C({onLoad:!0}),captured:C({onLoadCapture:!0})}},loadedData:{phasedRegistrationNames:{bubbled:C({onLoadedData:!0}),captured:C({onLoadedDataCapture:!0})}},loadedMetadata:{phasedRegistrationNames:{bubbled:C({onLoadedMetadata:!0}),captured:C({onLoadedMetadataCapture:!0})}},loadStart:{phasedRegistrationNames:{bubbled:C({onLoadStart:!0}),captured:C({onLoadStartCapture:!0})}},mouseDown:{phasedRegistrationNames:{bubbled:C({onMouseDown:!0}),captured:C({onMouseDownCapture:!0})}},mouseMove:{phasedRegistrationNames:{bubbled:C({onMouseMove:!0}),captured:C({onMouseMoveCapture:!0})}},mouseOut:{phasedRegistrationNames:{bubbled:C({onMouseOut:!0}),captured:C({onMouseOutCapture:!0})}},mouseOver:{phasedRegistrationNames:{bubbled:C({onMouseOver:!0}),captured:C({onMouseOverCapture:!0})}},mouseUp:{phasedRegistrationNames:{bubbled:C({onMouseUp:!0}),captured:C({onMouseUpCapture:!0})}},paste:{phasedRegistrationNames:{bubbled:C({onPaste:!0}),captured:C({onPasteCapture:!0})}},pause:{phasedRegistrationNames:{bubbled:C({onPause:!0}),captured:C({onPauseCapture:!0})}},play:{phasedRegistrationNames:{bubbled:C({onPlay:!0}),captured:C({onPlayCapture:!0})}},playing:{phasedRegistrationNames:{bubbled:C({onPlaying:!0}),captured:C({onPlayingCapture:!0})}},progress:{phasedRegistrationNames:{bubbled:C({onProgress:!0}),captured:C({onProgressCapture:!0})}},rateChange:{phasedRegistrationNames:{bubbled:C({onRateChange:!0}),captured:C({onRateChangeCapture:!0})}},reset:{phasedRegistrationNames:{bubbled:C({onReset:!0}),captured:C({onResetCapture:!0})}},scroll:{phasedRegistrationNames:{bubbled:C({onScroll:!0}),captured:C({onScrollCapture:!0})}},seeked:{phasedRegistrationNames:{bubbled:C({onSeeked:!0}),captured:C({onSeekedCapture:!0})}},seeking:{phasedRegistrationNames:{bubbled:C({onSeeking:!0}),captured:C({onSeekingCapture:!0})}},stalled:{phasedRegistrationNames:{bubbled:C({onStalled:!0}),captured:C({onStalledCapture:!0})}},submit:{phasedRegistrationNames:{bubbled:C({onSubmit:!0}),captured:C({onSubmitCapture:!0})}},suspend:{phasedRegistrationNames:{bubbled:C({onSuspend:!0}),captured:C({onSuspendCapture:!0})}},timeUpdate:{phasedRegistrationNames:{bubbled:C({onTimeUpdate:!0}),captured:C({onTimeUpdateCapture:!0})}},touchCancel:{phasedRegistrationNames:{bubbled:C({onTouchCancel:!0}),captured:C({onTouchCancelCapture:!0})}},touchEnd:{phasedRegistrationNames:{bubbled:C({onTouchEnd:!0}),captured:C({onTouchEndCapture:!0})}},touchMove:{phasedRegistrationNames:{bubbled:C({onTouchMove:!0}),captured:C({onTouchMoveCapture:!0})}},touchStart:{phasedRegistrationNames:{bubbled:C({onTouchStart:!0}),captured:C({onTouchStartCapture:!0})}},volumeChange:{phasedRegistrationNames:{bubbled:C({onVolumeChange:!0}),captured:C({onVolumeChangeCapture:!0})}},waiting:{phasedRegistrationNames:{bubbled:C({onWaiting:!0}),captured:C({onWaitingCapture:!0})}},wheel:{phasedRegistrationNames:{bubbled:C({onWheel:!0}),captured:C({onWheelCapture:!0})}}},_={topAbort:E.abort,topBlur:E.blur,topCanPlay:E.canPlay,topCanPlayThrough:E.canPlayThrough,topClick:E.click,topContextMenu:E.contextMenu,topCopy:E.copy,topCut:E.cut,topDoubleClick:E.doubleClick,topDrag:E.drag,topDragEnd:E.dragEnd,topDragEnter:E.dragEnter,topDragExit:E.dragExit,topDragLeave:E.dragLeave,topDragOver:E.dragOver,topDragStart:E.dragStart,topDrop:E.drop,topDurationChange:E.durationChange,topEmptied:E.emptied,topEncrypted:E.encrypted,topEnded:E.ended,topError:E.error,topFocus:E.focus,topInput:E.input,topKeyDown:E.keyDown,topKeyPress:E.keyPress,topKeyUp:E.keyUp,topLoad:E.load,topLoadedData:E.loadedData,topLoadedMetadata:E.loadedMetadata,topLoadStart:E.loadStart,topMouseDown:E.mouseDown,topMouseMove:E.mouseMove,topMouseOut:E.mouseOut,topMouseOver:E.mouseOver,topMouseUp:E.mouseUp,topPaste:E.paste,topPause:E.pause,topPlay:E.play,topPlaying:E.playing,topProgress:E.progress,topRateChange:E.rateChange,topReset:E.reset,topScroll:E.scroll,topSeeked:E.seeked,topSeeking:E.seeking,topStalled:E.stalled,topSubmit:E.submit,topSuspend:E.suspend,topTimeUpdate:E.timeUpdate,topTouchCancel:E.touchCancel,topTouchEnd:E.touchEnd,topTouchMove:E.touchMove,topTouchStart:E.touchStart,topVolumeChange:E.volumeChange,topWaiting:E.waiting,topWheel:E.wheel};for(var x in _)_[x].dependencies=[x];var D=C({onClick:null}),P={},T={eventTypes:E,extractEvents:function(e,t,n,r,o){var i=_[e];if(!i)return null;var m;switch(e){case b.topAbort:case b.topCanPlay:case b.topCanPlayThrough:case b.topDurationChange:case b.topEmptied:case b.topEncrypted:case b.topEnded:case b.topError:case b.topInput:case b.topLoad:case b.topLoadedData:case b.topLoadedMetadata:case b.topLoadStart:case b.topPause:case b.topPlay:case b.topPlaying:case b.topProgress:case b.topRateChange:case b.topReset:case b.topSeeked:case b.topSeeking:case b.topStalled:case b.topSubmit:case b.topSuspend:case b.topTimeUpdate:case b.topVolumeChange:case b.topWaiting:m=s;break;case b.topKeyPress:if(0===g(r))return null;case b.topKeyDown:case b.topKeyUp:m=c;break;case b.topBlur:case b.topFocus:m=l;break;case b.topClick:if(2===r.button)return null;case b.topContextMenu:case b.topDoubleClick:case b.topMouseDown:case b.topMouseMove:case b.topMouseOut:case b.topMouseOver:case b.topMouseUp:m=p;break;case b.topDrag:case b.topDragEnd:case b.topDragEnter:case b.topDragExit:case b.topDragLeave:case b.topDragOver:case b.topDragStart:case b.topDrop:m=d;break;case b.topTouchCancel:case b.topTouchEnd:case b.topTouchMove:case b.topTouchStart:m=f;break;case b.topScroll:m=h;break;case b.topWheel:m=v;break;case b.topCopy:case b.topCut:case b.topPaste:m=u}m?void 0:y(!1);var C=m.getPooled(i,n,r,o);return a.accumulateTwoPhaseDispatches(C),C},didPutListener:function(e,t,n){if(t===D){var r=i.getNode(e);P[e]||(P[e]=o.listen(r,"click",m))}},willDeleteListener:function(e,t){t===D&&(P[e].remove(),delete P[e])}};t.exports=T},{101:101,102:102,103:103,105:105,106:106,107:107,108:108,109:109,122:122,143:143,15:15,150:150,158:158,163:163,19:19,70:70,99:99}],99:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102),a={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};o.augmentClass(r,a),t.exports=r},{102:102}],100:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102),a={data:null};o.augmentClass(r,a),t.exports=r},{102:102}],101:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(106),a={dataTransfer:null};o.augmentClass(r,a),t.exports=r},{106:106}],102:[function(e,t,n){"use strict";function r(e,t,n,r){this.dispatchConfig=e,this.dispatchMarker=t,this.nativeEvent=n,this.target=r,this.currentTarget=r;var o=this.constructor.Interface;for(var a in o)if(o.hasOwnProperty(a)){var u=o[a];u?this[a]=u(n):this[a]=n[a]}var s=null!=n.defaultPrevented?n.defaultPrevented:n.returnValue===!1;s?this.isDefaultPrevented=i.thatReturnsTrue:this.isDefaultPrevented=i.thatReturnsFalse,this.isPropagationStopped=i.thatReturnsFalse}var o=e(25),a=e(24),i=e(150),u=(e(168),{type:null,currentTarget:i.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null});a(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1,this.isDefaultPrevented=i.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.isPropagationStopped=i.thatReturnsTrue)},persist:function(){this.isPersistent=i.thatReturnsTrue},isPersistent:i.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;this.dispatchConfig=null,this.dispatchMarker=null,this.nativeEvent=null}}),r.Interface=u,r.augmentClass=function(e,t){var n=this,r=Object.create(n.prototype);a(r,e.prototype),e.prototype=r,e.prototype.constructor=e,e.Interface=a({},n.Interface,t),e.augmentClass=n.augmentClass,o.addPoolingTo(e,o.fourArgumentPooler)},o.addPoolingTo(r,o.fourArgumentPooler),t.exports=r},{150:150,168:168,24:24,25:25}],103:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),a={relatedTarget:null};o.augmentClass(r,a),t.exports=r},{108:108}],104:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102),a={data:null};o.augmentClass(r,a),t.exports=r},{102:102}],105:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),a=e(122),i=e(123),u=e(124),s={key:i,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:u,charCode:function(e){return"keypress"===e.type?a(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?a(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};o.augmentClass(r,s),t.exports=r},{108:108,122:122,123:123,124:124}],106:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),a=e(111),i=e(124),u={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:i,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+a.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+a.currentScrollTop}};o.augmentClass(r,u),t.exports=r},{108:108,111:111,124:124}],107:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(108),a=e(124),i={touches:null,targetTouches:null,changedTouches:null,
altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:a};o.augmentClass(r,i),t.exports=r},{108:108,124:124}],108:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(102),a=e(125),i={view:function(e){if(e.view)return e.view;var t=a(e);if(null!=t&&t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};o.augmentClass(r,i),t.exports=r},{102:102,125:125}],109:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=e(106),a={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};o.augmentClass(r,a),t.exports=r},{106:106}],110:[function(e,t,n){"use strict";var r=e(158),o={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,n,o,a,i,u,s){this.isInTransaction()?r(!1):void 0;var l,c;try{this._isInTransaction=!0,l=!0,this.initializeAll(0),c=e.call(t,n,o,a,i,u,s),l=!1}finally{try{if(l)try{this.closeAll(0)}catch(p){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return c},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var r=t[n];try{this.wrapperInitData[n]=a.OBSERVED_ERROR,this.wrapperInitData[n]=r.initialize?r.initialize.call(this):null}finally{if(this.wrapperInitData[n]===a.OBSERVED_ERROR)try{this.initializeAll(n+1)}catch(o){}}}},closeAll:function(e){this.isInTransaction()?void 0:r(!1);for(var t=this.transactionWrappers,n=e;n<t.length;n++){var o,i=t[n],u=this.wrapperInitData[n];try{o=!0,u!==a.OBSERVED_ERROR&&i.close&&i.close.call(this,u),o=!1}finally{if(o)try{this.closeAll(n+1)}catch(s){}}}this.wrapperInitData.length=0}},a={Mixin:o,OBSERVED_ERROR:{}};t.exports=a},{158:158}],111:[function(e,t,n){"use strict";var r={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){r.currentScrollLeft=e.x,r.currentScrollTop=e.y}};t.exports=r},{}],112:[function(e,t,n){"use strict";function r(e,t){if(null==t?o(!1):void 0,null==e)return t;var n=Array.isArray(e),r=Array.isArray(t);return n&&r?(e.push.apply(e,t),e):n?(e.push(t),e):r?[e].concat(t):[e,t]}var o=e(158);t.exports=r},{158:158}],113:[function(e,t,n){"use strict";function r(e){for(var t=1,n=0,r=0,a=e.length,i=-4&a;i>r;){for(;r<Math.min(r+4096,i);r+=4)n+=(t+=e.charCodeAt(r))+(t+=e.charCodeAt(r+1))+(t+=e.charCodeAt(r+2))+(t+=e.charCodeAt(r+3));t%=o,n%=o}for(;a>r;r++)n+=t+=e.charCodeAt(r);return t%=o,n%=o,t|n<<16}var o=65521;t.exports=r},{}],114:[function(e,t,n){"use strict";var r=!1;t.exports=r},{}],115:[function(e,t,n){"use strict";function r(e,t){var n=a.mergeProps(t,e.props);return!n.hasOwnProperty(u)&&e.props.hasOwnProperty(u)&&(n.children=e.props.children),o.createElement(e.type,n)}var o=e(55),a=e(77),i=e(163),u=(e(168),i({children:null}));t.exports=r},{163:163,168:168,55:55,77:77}],116:[function(e,t,n){"use strict";function r(e,t){var n=null==t||"boolean"==typeof t||""===t;if(n)return"";var r=isNaN(t);return r||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var o=e(4),a=o.isUnitlessNumber;t.exports=r},{4:4}],117:[function(e,t,n){"use strict";function r(e,t,n,r,o){return o}e(24),e(168);t.exports=r},{168:168,24:24}],118:[function(e,t,n){"use strict";function r(e){return a[e]}function o(e){return(""+e).replace(i,r)}var a={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},i=/[&><"']/g;t.exports=o},{}],119:[function(e,t,n){"use strict";function r(e){return null==e?null:1===e.nodeType?e:o.has(e)?a.getNodeFromInstance(e):(null!=e.render&&"function"==typeof e.render?i(!1):void 0,void i(!1))}var o=(e(39),e(66)),a=e(70),i=e(158);e(168);t.exports=r},{158:158,168:168,39:39,66:66,70:70}],120:[function(e,t,n){"use strict";function r(e,t,n){var r=e,o=void 0===r[n];o&&null!=t&&(r[n]=t)}function o(e){if(null==e)return e;var t={};return a(e,r,t),t}var a=e(139);e(168);t.exports=o},{139:139,168:168}],121:[function(e,t,n){"use strict";var r=function(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)};t.exports=r},{}],122:[function(e,t,n){"use strict";function r(e){var t,n=e.keyCode;return"charCode"in e?(t=e.charCode,0===t&&13===n&&(t=13)):t=n,t>=32||13===t?t:0}t.exports=r},{}],123:[function(e,t,n){"use strict";function r(e){if(e.key){var t=a[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=o(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?i[e.keyCode]||"Unidentified":""}var o=e(122),a={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},i={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};t.exports=r},{122:122}],124:[function(e,t,n){"use strict";function r(e){var t=this,n=t.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var r=a[e];return r?!!n[r]:!1}function o(e){return r}var a={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};t.exports=o},{}],125:[function(e,t,n){"use strict";function r(e){var t=e.target||e.srcElement||window;return 3===t.nodeType?t.parentNode:t}t.exports=r},{}],126:[function(e,t,n){"use strict";function r(e){var t=e&&(o&&e[o]||e[a]);return"function"==typeof t?t:void 0}var o="function"==typeof Symbol&&Symbol.iterator,a="@@iterator";t.exports=r},{}],127:[function(e,t,n){"use strict";function r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function a(e,t){for(var n=r(e),a=0,i=0;n;){if(3===n.nodeType){if(i=a+n.textContent.length,t>=a&&i>=t)return{node:n,offset:t-a};a=i}n=r(o(n))}}t.exports=a},{}],128:[function(e,t,n){"use strict";function r(){return!a&&o.canUseDOM&&(a="textContent"in document.documentElement?"textContent":"innerText"),a}var o=e(144),a=null;t.exports=r},{144:144}],129:[function(e,t,n){"use strict";function r(e){return"function"==typeof e&&"undefined"!=typeof e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function o(e){var t;if(null===e||e===!1)t=new i(o);else if("object"==typeof e){var n=e;!n||"function"!=typeof n.type&&"string"!=typeof n.type?l(!1):void 0,t="string"==typeof n.type?u.createInternalComponent(n):r(n.type)?new n.type(n):new c}else"string"==typeof e||"number"==typeof e?t=u.createInstanceForText(e):l(!1);return t.construct(e),t._mountIndex=0,t._mountImage=null,t}var a=e(38),i=e(57),u=e(73),s=e(24),l=e(158),c=(e(168),function(){});s(c.prototype,a.Mixin,{_instantiateReactComponent:o}),t.exports=o},{158:158,168:168,24:24,38:38,57:57,73:73}],130:[function(e,t,n){"use strict";function r(e,t){if(!a.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&o&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var o,a=e(144);a.canUseDOM&&(o=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0),t.exports=r},{144:144}],131:[function(e,t,n){"use strict";function r(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&o[e.type]||"textarea"===t)}var o={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};t.exports=r},{}],132:[function(e,t,n){"use strict";function r(e){return o.isValidElement(e)?void 0:a(!1),e}var o=e(55),a=e(158);t.exports=r},{158:158,55:55}],133:[function(e,t,n){"use strict";function r(e){return'"'+o(e)+'"'}var o=e(118);t.exports=r},{118:118}],134:[function(e,t,n){"use strict";var r=e(70);t.exports=r.renderSubtreeIntoContainer},{70:70}],135:[function(e,t,n){"use strict";var r=e(144),o=/^[ \r\n\t\f]/,a=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,i=function(e,t){e.innerHTML=t};if("undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction&&(i=function(e,t){MSApp.execUnsafeLocalFunction(function(){e.innerHTML=t})}),r.canUseDOM){var u=document.createElement("div");u.innerHTML=" ",""===u.innerHTML&&(i=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),o.test(t)||"<"===t[0]&&a.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t})}t.exports=i},{144:144}],136:[function(e,t,n){"use strict";var r=e(144),o=e(118),a=e(135),i=function(e,t){e.textContent=t};r.canUseDOM&&("textContent"in document.documentElement||(i=function(e,t){a(e,o(t))})),t.exports=i},{118:118,135:135,144:144}],137:[function(e,t,n){"use strict";function r(e,t,n){return!o(e.props,t)||!o(e.state,n)}var o=e(166);t.exports=r},{166:166}],138:[function(e,t,n){"use strict";function r(e,t){var n=null===e||e===!1,r=null===t||t===!1;if(n||r)return n===r;var o=typeof e,a=typeof t;return"string"===o||"number"===o?"string"===a||"number"===a:"object"===a&&e.type===t.type&&e.key===t.key}t.exports=r},{}],139:[function(e,t,n){"use strict";function r(e){return v[e]}function o(e,t){return e&&null!=e.key?i(e.key):t.toString(36)}function a(e){return(""+e).replace(m,r)}function i(e){return"$"+a(e)}function u(e,t,n,r){var a=typeof e;if(("undefined"===a||"boolean"===a)&&(e=null),null===e||"string"===a||"number"===a||l.isValidElement(e))return n(r,e,""===t?f+o(e,0):t),1;var s,c,v=0,m=""===t?f:t+h;if(Array.isArray(e))for(var g=0;g<e.length;g++)s=e[g],c=m+o(s,g),v+=u(s,c,n,r);else{var y=p(e);if(y){var C,b=y.call(e);if(y!==e.entries)for(var E=0;!(C=b.next()).done;)s=C.value,c=m+o(s,E++),v+=u(s,c,n,r);else for(;!(C=b.next()).done;){var _=C.value;_&&(s=_[1],c=m+i(_[0])+h+o(s,0),v+=u(s,c,n,r))}}else"object"===a&&(String(e),d(!1))}return v}function s(e,t,n){return null==e?0:u(e,"",t,n)}var l=(e(39),e(55)),c=e(65),p=e(126),d=e(158),f=(e(168),c.SEPARATOR),h=":",v={"=":"=0",".":"=1",":":"=2"},m=/[=.:]/g;t.exports=s},{126:126,158:158,168:168,39:39,55:55,65:65}],140:[function(e,t,n){"use strict";function r(e){return Array.isArray(e)?e.concat():e&&"object"==typeof e?i(new e.constructor,e):e}function o(e,t,n){Array.isArray(e)?void 0:s(!1);var r=t[n];Array.isArray(r)?void 0:s(!1)}function a(e,t){if("object"!=typeof t?s(!1):void 0,l.call(t,f))return 1!==Object.keys(t).length?s(!1):void 0,t[f];var n=r(e);if(l.call(t,h)){var u=t[h];u&&"object"==typeof u?void 0:s(!1),n&&"object"==typeof n?void 0:s(!1),i(n,t[h])}l.call(t,c)&&(o(e,t,c),t[c].forEach(function(e){n.push(e)})),l.call(t,p)&&(o(e,t,p),t[p].forEach(function(e){n.unshift(e)})),l.call(t,d)&&(Array.isArray(e)?void 0:s(!1),Array.isArray(t[d])?void 0:s(!1),t[d].forEach(function(e){Array.isArray(e)?void 0:s(!1),n.splice.apply(n,e)})),l.call(t,v)&&("function"!=typeof t[v]?s(!1):void 0,n=t[v](n));for(var m in t)g.hasOwnProperty(m)&&g[m]||(n[m]=a(e[m],t[m]));return n}var i=e(24),u=e(163),s=e(158),l={}.hasOwnProperty,c=u({$push:null}),p=u({$unshift:null}),d=u({$splice:null}),f=u({$set:null}),h=u({$merge:null}),v=u({$apply:null}),m=[c,p,d,f,h,v],g={};m.forEach(function(e){g[e]=!0}),t.exports=a},{158:158,163:163,24:24}],141:[function(e,t,n){"use strict";var r=(e(24),e(150)),o=(e(168),r);t.exports=o},{150:150,168:168,24:24}],142:[function(e,t,n){"use strict";var r=e(158),o={addClass:function(e,t){return/\s/.test(t)?r(!1):void 0,t&&(e.classList?e.classList.add(t):o.hasClass(e,t)||(e.className=e.className+" "+t)),e},removeClass:function(e,t){return/\s/.test(t)?r(!1):void 0,t&&(e.classList?e.classList.remove(t):o.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,""))),e},conditionClass:function(e,t,n){return(n?o.addClass:o.removeClass)(e,t)},hasClass:function(e,t){return/\s/.test(t)?r(!1):void 0,e.classList?!!t&&e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1}};t.exports=o},{158:158}],143:[function(e,t,n){"use strict";var r=e(150),o={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!0),{remove:function(){e.removeEventListener(t,n,!0)}}):{remove:r}},registerDefault:function(){}};t.exports=o},{150:150}],144:[function(e,t,n){"use strict";var r=!("undefined"==typeof window||!window.document||!window.document.createElement),o={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};t.exports=o},{}],145:[function(e,t,n){"use strict";function r(e){return e.replace(o,function(e,t){return t.toUpperCase()})}var o=/-(.)/g;t.exports=r},{}],146:[function(e,t,n){"use strict";function r(e){return o(e.replace(a,"ms-"))}var o=e(145),a=/^-ms-/;t.exports=r},{145:145}],147:[function(e,t,n){"use strict";function r(e,t){var n=!0;e:for(;n;){var r=e,a=t;if(n=!1,r&&a){if(r===a)return!0;if(o(r))return!1;if(o(a)){e=r,t=a.parentNode,n=!0;continue e}return r.contains?r.contains(a):r.compareDocumentPosition?!!(16&r.compareDocumentPosition(a)):!1}return!1}}var o=e(160);t.exports=r},{160:160}],148:[function(e,t,n){"use strict";function r(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function o(e){return r(e)?Array.isArray(e)?e.slice():a(e):[e]}var a=e(167);t.exports=o},{167:167}],149:[function(e,t,n){"use strict";function r(e){var t=e.match(c);return t&&t[1].toLowerCase()}function o(e,t){var n=l;l?void 0:s(!1);var o=r(e),a=o&&u(o);if(a){n.innerHTML=a[1]+e+a[2];for(var c=a[0];c--;)n=n.lastChild}else n.innerHTML=e;var p=n.getElementsByTagName("script");p.length&&(t?void 0:s(!1),i(p).forEach(t));for(var d=i(n.childNodes);n.lastChild;)n.removeChild(n.lastChild);return d}var a=e(144),i=e(148),u=e(154),s=e(158),l=a.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;t.exports=o},{144:144,148:148,154:154,158:158}],150:[function(e,t,n){"use strict";function r(e){return function(){return e}}function o(){}o.thatReturns=r,o.thatReturnsFalse=r(!1),o.thatReturnsTrue=r(!0),o.thatReturnsNull=r(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},t.exports=o},{}],151:[function(e,t,n){"use strict";var r={};t.exports=r},{}],152:[function(e,t,n){"use strict";function r(e){try{e.focus()}catch(t){}}t.exports=r},{}],153:[function(e,t,n){"use strict";function r(){if("undefined"==typeof document)return null;try{return document.activeElement||document.body}catch(e){return document.body}}t.exports=r},{}],154:[function(e,t,n){"use strict";function r(e){return i?void 0:a(!1),d.hasOwnProperty(e)||(e="*"),u.hasOwnProperty(e)||("*"===e?i.innerHTML="<link />":i.innerHTML="<"+e+"></"+e+">",u[e]=!i.firstChild),u[e]?d[e]:null}var o=e(144),a=e(158),i=o.canUseDOM?document.createElement("div"):null,u={},s=[1,'<select multiple="true">',"</select>"],l=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],p=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],d={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:s,option:s,caption:l,colgroup:l,tbody:l,tfoot:l,thead:l,td:c,th:c},f=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];f.forEach(function(e){d[e]=p,u[e]=!0}),t.exports=r},{144:144,158:158}],155:[function(e,t,n){"use strict";function r(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}t.exports=r},{}],156:[function(e,t,n){"use strict";function r(e){return e.replace(o,"-$1").toLowerCase()}var o=/([A-Z])/g;t.exports=r},{}],157:[function(e,t,n){"use strict";function r(e){return o(e).replace(a,"-ms-")}var o=e(156),a=/^ms-/;t.exports=r},{156:156}],158:[function(e,t,n){"use strict";var r=function(e,t,n,r,o,a,i,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,o,a,i,u],c=0;s=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return l[c++]}))}throw s.framesToPop=1,s}};t.exports=r},{}],159:[function(e,t,n){"use strict";function r(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}t.exports=r},{}],160:[function(e,t,n){"use strict";function r(e){return o(e)&&3==e.nodeType}var o=e(159);t.exports=r},{159:159}],161:[function(e,t,n){"use strict";function r(e){e||(e="");var t,n=arguments.length;if(n>1)for(var r=1;n>r;r++)t=arguments[r],t&&(e=(e?e+" ":"")+t);return e}t.exports=r},{}],162:[function(e,t,n){"use strict";var r=e(158),o=function(e){var t,n={};e instanceof Object&&!Array.isArray(e)?void 0:r(!1);for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};t.exports=o},{158:158}],163:[function(e,t,n){"use strict";var r=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return t;return null};t.exports=r},{}],164:[function(e,t,n){"use strict";function r(e,t,n){if(!e)return null;var r={};for(var a in e)o.call(e,a)&&(r[a]=t.call(n,e[a],a,e));return r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],165:[function(e,t,n){"use strict";function r(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}t.exports=r},{}],166:[function(e,t,n){"use strict";function r(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=o.bind(t),i=0;i<n.length;i++)if(!a(n[i])||e[n[i]]!==t[n[i]])return!1;return!0}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],167:[function(e,t,n){"use strict";function r(e){var t=e.length;if(Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e?o(!1):void 0,"number"!=typeof t?o(!1):void 0,0===t||t-1 in e?void 0:o(!1),e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(n){}for(var r=Array(t),a=0;t>a;a++)r[a]=e[a];return r}var o=e(158);t.exports=r},{158:158}],168:[function(e,t,n){"use strict";var r=e(150),o=r;t.exports=o},{150:150}]},{},[1])(1)});
;
;
/*! react-dom-0.14.1.min.js */ 
;
;
/**
* ReactDOM v0.14.1
*
* Copyright 2013-2015, Facebook, Inc.
* All rights reserved.
*
* This source code is licensed under the BSD-style license found in the
* LICENSE file in the root directory of this source tree. An additional grant
* of patent rights can be found in the PATENTS file in the same directory.
*
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e(require("react"));else if("function"==typeof define&&define.amd)define(["react"],e);else{var f;f="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,f.ReactDOM=e(f.React)}}(function(e){return e.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED});
;
;
/*! jquery-1.8.2.min.js */ 
;
;
/*! jQuery v1.8.2 jquery.com | jquery.org/license */
(function(a,b){function G(a){var b=F[a]={};return p.each(a.split(s),function(a,c){b[c]=!0}),b}function J(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(I,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:+d+""===d?+d:H.test(d)?p.parseJSON(d):d}catch(f){}p.data(a,c,d)}else d=b}return d}function K(a){var b;for(b in a){if(b==="data"&&p.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function ba(){return!1}function bb(){return!0}function bh(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function bi(a,b){do a=a[b];while(a&&a.nodeType!==1);return a}function bj(a,b,c){b=b||0;if(p.isFunction(b))return p.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return p.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=p.grep(a,function(a){return a.nodeType===1});if(be.test(b))return p.filter(b,d,!c);b=p.filter(b,d)}return p.grep(a,function(a,d){return p.inArray(a,b)>=0===c})}function bk(a){var b=bl.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function bC(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function bD(a,b){if(b.nodeType!==1||!p.hasData(a))return;var c,d,e,f=p._data(a),g=p._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)p.event.add(b,c,h[c][d])}g.data&&(g.data=p.extend({},g.data))}function bE(a,b){var c;if(b.nodeType!==1)return;b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?(b.parentNode&&(b.outerHTML=a.outerHTML),p.support.html5Clone&&a.innerHTML&&!p.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):c==="input"&&bv.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(p.expando)}function bF(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bG(a){bv.test(a.type)&&(a.defaultChecked=a.checked)}function bY(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=bW.length;while(e--){b=bW[e]+c;if(b in a)return b}return d}function bZ(a,b){return a=b||a,p.css(a,"display")==="none"||!p.contains(a.ownerDocument,a)}function b$(a,b){var c,d,e=[],f=0,g=a.length;for(;f<g;f++){c=a[f];if(!c.style)continue;e[f]=p._data(c,"olddisplay"),b?(!e[f]&&c.style.display==="none"&&(c.style.display=""),c.style.display===""&&bZ(c)&&(e[f]=p._data(c,"olddisplay",cc(c.nodeName)))):(d=bH(c,"display"),!e[f]&&d!=="none"&&p._data(c,"olddisplay",d))}for(f=0;f<g;f++){c=a[f];if(!c.style)continue;if(!b||c.style.display==="none"||c.style.display==="")c.style.display=b?e[f]||"":"none"}return a}function b_(a,b,c){var d=bP.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function ca(a,b,c,d){var e=c===(d?"border":"content")?4:b==="width"?1:0,f=0;for(;e<4;e+=2)c==="margin"&&(f+=p.css(a,c+bV[e],!0)),d?(c==="content"&&(f-=parseFloat(bH(a,"padding"+bV[e]))||0),c!=="margin"&&(f-=parseFloat(bH(a,"border"+bV[e]+"Width"))||0)):(f+=parseFloat(bH(a,"padding"+bV[e]))||0,c!=="padding"&&(f+=parseFloat(bH(a,"border"+bV[e]+"Width"))||0));return f}function cb(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=!0,f=p.support.boxSizing&&p.css(a,"boxSizing")==="border-box";if(d<=0||d==null){d=bH(a,b);if(d<0||d==null)d=a.style[b];if(bQ.test(d))return d;e=f&&(p.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+ca(a,b,c||(f?"border":"content"),e)+"px"}function cc(a){if(bS[a])return bS[a];var b=p("<"+a+">").appendTo(e.body),c=b.css("display");b.remove();if(c==="none"||c===""){bI=e.body.appendChild(bI||p.extend(e.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!bJ||!bI.createElement)bJ=(bI.contentWindow||bI.contentDocument).document,bJ.write("<!doctype html><html><body>"),bJ.close();b=bJ.body.appendChild(bJ.createElement(a)),c=bH(b,"display"),e.body.removeChild(bI)}return bS[a]=c,c}function ci(a,b,c,d){var e;if(p.isArray(b))p.each(b,function(b,e){c||ce.test(a)?d(a,e):ci(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&p.type(b)==="object")for(e in b)ci(a+"["+e+"]",b[e],c,d);else d(a,b)}function cz(a){return function(b,c){typeof b!="string"&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(s),h=0,i=g.length;if(p.isFunction(c))for(;h<i;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function cA(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h,i=a[f],j=0,k=i?i.length:0,l=a===cv;for(;j<k&&(l||!h);j++)h=i[j](c,d,e),typeof h=="string"&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=cA(a,c,d,e,h,g)));return(l||!h)&&!g["*"]&&(h=cA(a,c,d,e,"*",g)),h}function cB(a,c){var d,e,f=p.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&p.extend(!0,a,e)}function cC(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k)f in d&&(c[k[f]]=d[f]);while(j[0]==="*")j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}if(g)return g!==j[0]&&j.unshift(g),d[g]}function cD(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;a.dataFilter&&(b=a.dataFilter(b,a.dataType));if(g[1])for(c in a.converters)i[c.toLowerCase()]=a.converters[c];for(;e=g[++j];)if(e!=="*"){if(h!=="*"&&h!==e){c=i[h+" "+e]||i["* "+e];if(!c)for(d in i){f=d.split(" ");if(f[1]===e){c=i[h+" "+f[0]]||i["* "+f[0]];if(c){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}}}if(c!==!0)if(c&&a["throws"])b=c(b);else try{b=c(b)}catch(k){return{state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}}}h=e}return{state:"success",data:b}}function cL(){try{return new a.XMLHttpRequest}catch(b){}}function cM(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function cU(){return setTimeout(function(){cN=b},0),cN=p.now()}function cV(a,b){p.each(b,function(b,c){var d=(cT[b]||[]).concat(cT["*"]),e=0,f=d.length;for(;e<f;e++)if(d[e].call(a,b,c))return})}function cW(a,b,c){var d,e=0,f=0,g=cS.length,h=p.Deferred().always(function(){delete i.elem}),i=function(){var b=cN||cU(),c=Math.max(0,j.startTime+j.duration-b),d=1-(c/j.duration||0),e=0,f=j.tweens.length;for(;e<f;e++)j.tweens[e].run(d);return h.notifyWith(a,[j,d,c]),d<1&&f?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:p.extend({},b),opts:p.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:cN||cU(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=p.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(e),e},stop:function(b){var c=0,d=b?j.tweens.length:0;for(;c<d;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;cX(k,j.opts.specialEasing);for(;e<g;e++){d=cS[e].call(j,a,k,j.opts);if(d)return d}return cV(j,k),p.isFunction(j.opts.start)&&j.opts.start.call(a,j),p.fx.timer(p.extend(i,{anim:j,queue:j.opts.queue,elem:a})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function cX(a,b){var c,d,e,f,g;for(c in a){d=p.camelCase(c),e=b[d],f=a[c],p.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=p.cssHooks[d];if(g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}}function cY(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=a.style,n={},o=[],q=a.nodeType&&bZ(a);c.queue||(j=p._queueHooks(a,"fx"),j.unqueued==null&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){j.unqueued||k()}),j.unqueued++,l.always(function(){l.always(function(){j.unqueued--,p.queue(a,"fx").length||j.empty.fire()})})),a.nodeType===1&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],p.css(a,"display")==="inline"&&p.css(a,"float")==="none"&&(!p.support.inlineBlockNeedsLayout||cc(a.nodeName)==="inline"?m.display="inline-block":m.zoom=1)),c.overflow&&(m.overflow="hidden",p.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b){f=b[d];if(cP.exec(f)){delete b[d];if(f===(q?"hide":"show"))continue;o.push(d)}}g=o.length;if(g){h=p._data(a,"fxshow")||p._data(a,"fxshow",{}),q?p(a).show():l.done(function(){p(a).hide()}),l.done(function(){var b;p.removeData(a,"fxshow",!0);for(b in n)p.style(a,b,n[b])});for(d=0;d<g;d++)e=o[d],i=l.createTween(e,q?h[e]:0),n[e]=h[e]||p.style(a,e),e in h||(h[e]=i.start,q&&(i.end=i.start,i.start=e==="width"||e==="height"?1:0))}}function cZ(a,b,c,d,e){return new cZ.prototype.init(a,b,c,d,e)}function c$(a,b){var c,d={height:a},e=0;b=b?1:0;for(;e<4;e+=2-b)c=bV[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function da(a){return p.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var c,d,e=a.document,f=a.location,g=a.navigator,h=a.jQuery,i=a.$,j=Array.prototype.push,k=Array.prototype.slice,l=Array.prototype.indexOf,m=Object.prototype.toString,n=Object.prototype.hasOwnProperty,o=String.prototype.trim,p=function(a,b){return new p.fn.init(a,b,c)},q=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,r=/\S/,s=/\s+/,t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,y=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,z=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,A=/^-ms-/,B=/-([\da-z])/gi,C=function(a,b){return(b+"").toUpperCase()},D=function(){e.addEventListener?(e.removeEventListener("DOMContentLoaded",D,!1),p.ready()):e.readyState==="complete"&&(e.detachEvent("onreadystatechange",D),p.ready())},E={};p.fn=p.prototype={constructor:p,init:function(a,c,d){var f,g,h,i;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?f=[null,a,null]:f=u.exec(a);if(f&&(f[1]||!c)){if(f[1])return c=c instanceof p?c[0]:c,i=c&&c.nodeType?c.ownerDocument||c:e,a=p.parseHTML(f[1],i,!0),v.test(f[1])&&p.isPlainObject(c)&&this.attr.call(a,c,!0),p.merge(this,a);g=e.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2])return d.find(a);this.length=1,this[0]=g}return this.context=e,this.selector=a,this}return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a)}return p.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),p.makeArray(a,this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return k.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=p.merge(this.constructor(),a);return d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return p.each(this,a,b)},ready:function(a){return p.ready.promise().done(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(k.apply(this,arguments),"slice",k.call(arguments).join(","))},map:function(a){return this.pushStack(p.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:j,sort:[].sort,splice:[].splice},p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!p.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((a=arguments[i])!=null)for(c in a){d=h[c],e=a[c];if(h===e)continue;k&&e&&(p.isPlainObject(e)||(f=p.isArray(e)))?(f?(f=!1,g=d&&p.isArray(d)?d:[]):g=d&&p.isPlainObject(d)?d:{},h[c]=p.extend(k,g,e)):e!==b&&(h[c]=e)}return h},p.extend({noConflict:function(b){return a.$===p&&(a.$=i),b&&a.jQuery===p&&(a.jQuery=h),p},isReady:!1,readyWait:1,holdReady:function(a){a?p.readyWait++:p.ready(!0)},ready:function(a){if(a===!0?--p.readyWait:p.isReady)return;if(!e.body)return setTimeout(p.ready,1);p.isReady=!0;if(a!==!0&&--p.readyWait>0)return;d.resolveWith(e,[p]),p.fn.trigger&&p(e).trigger("ready").off("ready")},isFunction:function(a){return p.type(a)==="function"},isArray:Array.isArray||function(a){return p.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):E[m.call(a)]||"object"},isPlainObject:function(a){if(!a||p.type(a)!=="object"||a.nodeType||p.isWindow(a))return!1;try{if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||n.call(a,d)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;return!a||typeof a!="string"?null:(typeof b=="boolean"&&(c=b,b=0),b=b||e,(d=v.exec(a))?[b.createElement(d[1])]:(d=p.buildFragment([a],b,c?null:[]),p.merge([],(d.cacheable?p.clone(d.fragment):d.fragment).childNodes)))},parseJSON:function(b){if(!b||typeof b!="string")return null;b=p.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(w.test(b.replace(y,"@").replace(z,"]").replace(x,"")))return(new Function("return "+b))();p.error("Invalid JSON: "+b)},parseXML:function(c){var d,e;if(!c||typeof c!="string")return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&r.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(A,"ms-").replace(B,C)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||p.isFunction(a);if(d){if(h){for(e in a)if(c.apply(a[e],d)===!1)break}else for(;f<g;)if(c.apply(a[f++],d)===!1)break}else if(h){for(e in a)if(c.call(a[e],e,a[e])===!1)break}else for(;f<g;)if(c.call(a[f],f,a[f++])===!1)break;return a},trim:o&&!o.call("﻿ ")?function(a){return a==null?"":o.call(a)}:function(a){return a==null?"":(a+"").replace(t,"")},makeArray:function(a,b){var c,d=b||[];return a!=null&&(c=p.type(a),a.length==null||c==="string"||c==="function"||c==="regexp"||p.isWindow(a)?j.call(d,a):p.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(l)return l.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if(typeof d=="number")for(;f<d;f++)a[e++]=c[f];else while(c[f]!==b)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,c,d){var e,f,g=[],h=0,i=a.length,j=a instanceof p||i!==b&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||p.isArray(a));if(j)for(;h<i;h++)e=c(a[h],h,d),e!=null&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),e!=null&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return typeof c=="string"&&(d=a[c],c=a,a=d),p.isFunction(a)?(e=k.call(arguments,2),f=function(){return a.apply(c,e.concat(k.call(arguments)))},f.guid=a.guid=a.guid||p.guid++,f):b},access:function(a,c,d,e,f,g,h){var i,j=d==null,k=0,l=a.length;if(d&&typeof d=="object"){for(k in d)p.access(a,c,k,d[k],1,g,e);f=1}else if(e!==b){i=h===b&&p.isFunction(e),j&&(i?(i=c,c=function(a,b,c){return i.call(p(a),c)}):(c.call(a,e),c=null));if(c)for(;k<l;k++)c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h);f=1}return f?a:j?c.call(a):l?c(a[0],d):g},now:function(){return(new Date).getTime()}}),p.ready.promise=function(b){if(!d){d=p.Deferred();if(e.readyState==="complete")setTimeout(p.ready,1);else if(e.addEventListener)e.addEventListener("DOMContentLoaded",D,!1),a.addEventListener("load",p.ready,!1);else{e.attachEvent("onreadystatechange",D),a.attachEvent("onload",p.ready);var c=!1;try{c=a.frameElement==null&&e.documentElement}catch(f){}c&&c.doScroll&&function g(){if(!p.isReady){try{c.doScroll("left")}catch(a){return setTimeout(g,50)}p.ready()}}()}}return d.promise(b)},p.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){E["[object "+b+"]"]=b.toLowerCase()}),c=p(e);var F={};p.Callbacks=function(a){a=typeof a=="string"?F[a]||G(a):p.extend({},a);var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){c=a.memory&&b,d=!0,h=f||0,f=0,g=i.length,e=!0;for(;i&&h<g;h++)if(i[h].apply(b[0],b[1])===!1&&a.stopOnFalse){c=!1;break}e=!1,i&&(j?j.length&&k(j.shift()):c?i=[]:l.disable())},l={add:function(){if(i){var b=i.length;(function d(b){p.each(b,function(b,c){var e=p.type(c);e==="function"&&(!a.unique||!l.has(c))?i.push(c):c&&c.length&&e!=="string"&&d(c)})})(arguments),e?g=i.length:c&&(f=b,k(c))}return this},remove:function(){return i&&p.each(arguments,function(a,b){var c;while((c=p.inArray(b,i,c))>-1)i.splice(c,1),e&&(c<=g&&g--,c<=h&&h--)}),this},has:function(a){return p.inArray(a,i)>-1},empty:function(){return i=[],this},disable:function(){return i=j=c=b,this},disabled:function(){return!i},lock:function(){return j=b,c||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],i&&(!d||j)&&(e?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!d}};return l},p.extend({Deferred:function(a){var b=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return p.Deferred(function(c){p.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]](p.isFunction(g)?function(){var a=g.apply(this,arguments);a&&p.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return a!=null?p.extend(a,d):d}},e={};return d.pipe=d.then,p.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=k.call(arguments),d=c.length,e=d!==1||a&&p.isFunction(a.promise)?d:0,f=e===1?a:p.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?k.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,i,j;if(d>1){h=new Array(d),i=new Array(d),j=new Array(d);for(;b<d;b++)c[b]&&p.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e}return e||f.resolveWith(j,c),f.promise()}}),p.support=function(){var b,c,d,f,g,h,i,j,k,l,m,n=e.createElement("div");n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*"),d=n.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length)return{};f=e.createElement("select"),g=f.appendChild(e.createElement("option")),h=n.getElementsByTagName("input")[0],b={leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:h.value==="on",optSelected:g.selected,getSetAttribute:n.className!=="t",enctype:!!e.createElement("form").enctype,html5Clone:e.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:e.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},h.checked=!0,b.noCloneChecked=h.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled;try{delete n.test}catch(o){b.deleteExpando=!1}!n.addEventListener&&n.attachEvent&&n.fireEvent&&(n.attachEvent("onclick",m=function(){b.noCloneEvent=!1}),n.cloneNode(!0).fireEvent("onclick"),n.detachEvent("onclick",m)),h=e.createElement("input"),h.value="t",h.setAttribute("type","radio"),b.radioValue=h.value==="t",h.setAttribute("checked","checked"),h.setAttribute("name","t"),n.appendChild(h),i=e.createDocumentFragment(),i.appendChild(n.lastChild),b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=h.checked,i.removeChild(h),i.appendChild(n);if(n.attachEvent)for(k in{submit:!0,change:!0,focusin:!0})j="on"+k,l=j in n,l||(n.setAttribute(j,"return;"),l=typeof n[j]=="function"),b[k+"Bubbles"]=l;return p(function(){var c,d,f,g,h="padding:0;margin:0;border:0;display:block;overflow:hidden;",i=e.getElementsByTagName("body")[0];if(!i)return;c=e.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",i.insertBefore(c,i.firstChild),d=e.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=d.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&f[0].offsetHeight===0,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=d.offsetWidth===4,b.doesNotIncludeMarginInBodyOffset=i.offsetTop!==1,a.getComputedStyle&&(b.pixelPosition=(a.getComputedStyle(d,null)||{}).top!=="1%",b.boxSizingReliable=(a.getComputedStyle(d,null)||{width:"4px"}).width==="4px",g=e.createElement("div"),g.style.cssText=d.style.cssText=h,g.style.marginRight=g.style.width="0",d.style.width="1px",d.appendChild(g),b.reliableMarginRight=!parseFloat((a.getComputedStyle(g,null)||{}).marginRight)),typeof d.style.zoom!="undefined"&&(d.innerHTML="",d.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=d.offsetWidth===3,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=d.offsetWidth!==3,c.style.zoom=1),i.removeChild(c),c=d=f=g=null}),i.removeChild(n),c=d=f=g=h=i=n=null,b}();var H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,I=/([A-Z])/g;p.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(p.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?p.cache[a[p.expando]]:a[p.expando],!!a&&!K(a)},data:function(a,c,d,e){if(!p.acceptData(a))return;var f,g,h=p.expando,i=typeof c=="string",j=a.nodeType,k=j?p.cache:a,l=j?a[h]:a[h]&&h;if((!l||!k[l]||!e&&!k[l].data)&&i&&d===b)return;l||(j?a[h]=l=p.deletedIds.pop()||p.guid++:l=h),k[l]||(k[l]={},j||(k[l].toJSON=p.noop));if(typeof c=="object"||typeof c=="function")e?k[l]=p.extend(k[l],c):k[l].data=p.extend(k[l].data,c);return f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[p.camelCase(c)]=d),i?(g=f[c],g==null&&(g=f[p.camelCase(c)])):g=f,g},removeData:function(a,b,c){if(!p.acceptData(a))return;var d,e,f,g=a.nodeType,h=g?p.cache:a,i=g?a[p.expando]:p.expando;if(!h[i])return;if(b){d=c?h[i]:h[i].data;if(d){p.isArray(b)||(b in d?b=[b]:(b=p.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++)delete d[b[e]];if(!(c?K:p.isEmptyObject)(d))return}}if(!c){delete h[i].data;if(!K(h[i]))return}g?p.cleanData([a],!0):p.support.deleteExpando||h!=h.window?delete h[i]:h[i]=null},_data:function(a,b,c){return p.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&p.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),p.fn.extend({data:function(a,c){var d,e,f,g,h,i=this[0],j=0,k=null;if(a===b){if(this.length){k=p.data(i);if(i.nodeType===1&&!p._data(i,"parsedAttrs")){f=i.attributes;for(h=f.length;j<h;j++)g=f[j].name,g.indexOf("data-")||(g=p.camelCase(g.substring(5)),J(i,g,k[g]));p._data(i,"parsedAttrs",!0)}}return k}return typeof a=="object"?this.each(function(){p.data(this,a)}):(d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!",p.access(this,function(c){if(c===b)return k=this.triggerHandler("getData"+e,[d[0]]),k===b&&i&&(k=p.data(i,a),k=J(i,a,k)),k===b&&d[1]?this.data(d[0]):k;d[1]=c,this.each(function(){var b=p(this);b.triggerHandler("setData"+e,d),p.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){p.removeData(this,a)})}}),p.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=p._data(a,b),c&&(!d||p.isArray(c)?d=p._data(a,b,p.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=p.queue(a,b),d=c.length,e=c.shift(),f=p._queueHooks(a,b),g=function(){p.dequeue(a,b)};e==="inprogress"&&(e=c.shift(),d--),e&&(b==="fx"&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return p._data(a,c)||p._data(a,c,{empty:p.Callbacks("once memory").add(function(){p.removeData(a,b+"queue",!0),p.removeData(a,c,!0)})})}}),p.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?p.queue(this[0],a):c===b?this:this.each(function(){var b=p.queue(this,a,c);p._queueHooks(this,a),a==="fx"&&b[0]!=="inprogress"&&p.dequeue(this,a)})},dequeue:function(a){return this.each(function(){p.dequeue(this,a)})},delay:function(a,b){return a=p.fx?p.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=p.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};typeof a!="string"&&(c=a,a=b),a=a||"fx";while(h--)d=p._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var L,M,N,O=/[\t\r\n]/g,P=/\r/g,Q=/^(?:button|input)$/i,R=/^(?:button|input|object|select|textarea)$/i,S=/^a(?:rea|)$/i,T=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,U=p.support.getSetAttribute;p.fn.extend({attr:function(a,b){return p.access(this,p.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){p.removeAttr(this,a)})},prop:function(a,b){return p.access(this,p.prop,a,b,arguments.length>1)},removeProp:function(a){return a=p.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(p.isFunction(a))return this.each(function(b){p(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(s);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)f.indexOf(" "+b[g]+" ")<0&&(f+=b[g]+" ");e.className=p.trim(f)}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if(p.isFunction(a))return this.each(function(b){p(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(s);for(h=0,i=this.length;h<i;h++){e=this[h];if(e.nodeType===1&&e.className){d=(" "+e.className+" ").replace(O," ");for(f=0,g=c.length;f<g;f++)while(d.indexOf(" "+c[f]+" ")>=0)d=d.replace(" "+c[f]+" "," ");e.className=a?p.trim(d):""}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return p.isFunction(a)?this.each(function(c){p(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=p(this),h=b,i=a.split(s);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&p._data(this,"__className__",this.className),this.className=this.className||a===!1?"":p._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(O," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!arguments.length){if(f)return c=p.valHooks[f.type]||p.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(P,""):d==null?"":d);return}return e=p.isFunction(a),this.each(function(d){var f,g=p(this);if(this.nodeType!==1)return;e?f=a.call(this,d,g.val()):f=a,f==null?f="":typeof f=="number"?f+="":p.isArray(f)&&(f=p.map(f,function(a){return a==null?"":a+""})),c=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,f,"value")===b)this.value=f})}}),p.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0)return null;c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&(p.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!p.nodeName(e.parentNode,"optgroup"))){b=p(e).val();if(i)return b;g.push(b)}}return i&&!g.length&&h.length?p(h[f]).val():g},set:function(a,b){var c=p.makeArray(b);return p(a).find("option").each(function(){this.selected=p.inArray(p(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!a||i===3||i===8||i===2)return;if(e&&p.isFunction(p.fn[c]))return p(a)[c](d);if(typeof a.getAttribute=="undefined")return p.prop(a,c,d);h=i!==1||!p.isXMLDoc(a),h&&(c=c.toLowerCase(),g=p.attrHooks[c]||(T.test(c)?M:L));if(d!==b){if(d===null){p.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d)}return g&&"get"in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.split(s);for(;g<d.length;g++)e=d[g],e&&(c=p.propFix[e]||e,f=T.test(e),f||p.attr(a,e,""),a.removeAttribute(U?e:c),f&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(Q.test(a.nodeName)&&a.parentNode)p.error("type property can't be changed");else if(!p.support.radioValue&&b==="radio"&&p.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return L&&p.nodeName(a,"button")?L.get(a,b):b in a?a.value:null},set:function(a,b,c){if(L&&p.nodeName(a,"button"))return L.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!a||h===3||h===8||h===2)return;return g=h!==1||!p.isXMLDoc(a),g&&(c=p.propFix[c]||c,f=p.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):R.test(a.nodeName)||S.test(a.nodeName)&&a.href?0:b}}}}),M={get:function(a,c){var d,e=p.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?p.removeAttr(a,c):(d=p.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},U||(N={name:!0,id:!0,coords:!0},L=p.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(N[c]?d.value!=="":d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=e.createAttribute(c),a.setAttributeNode(d)),d.value=b+""}},p.each(["width","height"],function(a,b){p.attrHooks[b]=p.extend(p.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),p.attrHooks.contenteditable={get:L.get,set:function(a,b,c){b===""&&(b="false"),L.set(a,b,c)}}),p.support.hrefNormalized||p.each(["href","src","width","height"],function(a,c){p.attrHooks[c]=p.extend(p.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),p.support.style||(p.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=b+""}}),p.support.optSelected||(p.propHooks.selected=p.extend(p.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),p.support.enctype||(p.propFix.enctype="encoding"),p.support.checkOn||p.each(["radio","checkbox"],function(){p.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]=p.extend(p.valHooks[this],{set:function(a,b){if(p.isArray(b))return a.checked=p.inArray(p(a).val(),b)>=0}})});var V=/^(?:textarea|input|select)$/i,W=/^([^\.]*|)(?:\.(.+)|)$/,X=/(?:^|\s)hover(\.\S+|)\b/,Y=/^key/,Z=/^(?:mouse|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=function(a){return p.event.special.hover?a:a.replace(X,"mouseenter$1 mouseleave$1")};p.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,q,r;if(a.nodeType===3||a.nodeType===8||!c||!d||!(g=p._data(a)))return;d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=p.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof p!="undefined"&&(!a||p.event.triggered!==a.type)?p.event.dispatch.apply(h.elem,arguments):b},h.elem=a),c=p.trim(_(c)).split(" ");for(j=0;j<c.length;j++){k=W.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=p.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=p.event.special[l]||{},n=p.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&p.expr.match.needsContext.test(f),namespace:m.join(".")},o),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),p.event.global[l]=!0}a=null},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,q,r=p.hasData(a)&&p._data(a);if(!r||!(m=r.events))return;b=p.trim(_(b||"")).split(" ");for(f=0;f<b.length;f++){g=W.exec(b[f])||[],h=i=g[1],j=g[2];if(!h){for(h in m)p.event.remove(a,h+b[f],c,d,!0);continue}n=p.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(l=0;l<o.length;l++)q=o[l],(e||i===q.origType)&&(!c||c.guid===q.guid)&&(!j||j.test(q.namespace))&&(!d||d===q.selector||d==="**"&&q.selector)&&(o.splice(l--,1),q.selector&&o.delegateCount--,n.remove&&n.remove.call(a,q));o.length===0&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,r.handle)===!1)&&p.removeEvent(a,h,r.handle),delete m[h])}p.isEmptyObject(m)&&(delete r.handle,p.removeData(a,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,f,g){if(!f||f.nodeType!==3&&f.nodeType!==8){var h,i,j,k,l,m,n,o,q,r,s=c.type||c,t=[];if($.test(s+p.event.triggered))return;s.indexOf("!")>=0&&(s=s.slice(0,-1),i=!0),s.indexOf(".")>=0&&(t=s.split("."),s=t.shift(),t.sort());if((!f||p.event.customEvent[s])&&!p.event.global[s])return;c=typeof c=="object"?c[p.expando]?c:new p.Event(s,c):new p.Event(s),c.type=s,c.isTrigger=!0,c.exclusive=i,c.namespace=t.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+t.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m=s.indexOf(":")<0?"on"+s:"";if(!f){h=p.cache;for(j in h)h[j].events&&h[j].events[s]&&p.event.trigger(c,d,h[j].handle.elem,!0);return}c.result=b,c.target||(c.target=f),d=d!=null?p.makeArray(d):[],d.unshift(c),n=p.event.special[s]||{};if(n.trigger&&n.trigger.apply(f,d)===!1)return;q=[[f,n.bindType||s]];if(!g&&!n.noBubble&&!p.isWindow(f)){r=n.delegateType||s,k=$.test(r+s)?f:f.parentNode;for(l=f;k;k=k.parentNode)q.push([k,r]),l=k;l===(f.ownerDocument||e)&&q.push([l.defaultView||l.parentWindow||a,r])}for(j=0;j<q.length&&!c.isPropagationStopped();j++)k=q[j][0],c.type=q[j][1],o=(p._data(k,"events")||{})[c.type]&&p._data(k,"handle"),o&&o.apply(k,d),o=m&&k[m],o&&p.acceptData(k)&&o.apply&&o.apply(k,d)===!1&&c.preventDefault();return c.type=s,!g&&!c.isDefaultPrevented()&&(!n._default||n._default.apply(f.ownerDocument,d)===!1)&&(s!=="click"||!p.nodeName(f,"a"))&&p.acceptData(f)&&m&&f[s]&&(s!=="focus"&&s!=="blur"||c.target.offsetWidth!==0)&&!p.isWindow(f)&&(l=f[m],l&&(f[m]=null),p.event.triggered=s,f[s](),p.event.triggered=b,l&&(f[m]=l)),c.result}return},dispatch:function(c){c=p.event.fix(c||a.event);var d,e,f,g,h,i,j,l,m,n,o=(p._data(this,"events")||{})[c.type]||[],q=o.delegateCount,r=k.call(arguments),s=!c.exclusive&&!c.namespace,t=p.event.special[c.type]||{},u=[];r[0]=c,c.delegateTarget=this;if(t.preDispatch&&t.preDispatch.call(this,c)===!1)return;if(q&&(!c.button||c.type!=="click"))for(f=c.target;f!=this;f=f.parentNode||this)if(f.disabled!==!0||c.type!=="click"){h={},j=[];for(d=0;d<q;d++)l=o[d],m=l.selector,h[m]===b&&(h[m]=l.needsContext?p(m,this).index(f)>=0:p.find(m,this,null,[f]).length),h[m]&&j.push(l);j.length&&u.push({elem:f,matches:j})}o.length>q&&u.push({elem:this,matches:o.slice(q)});for(d=0;d<u.length&&!c.isPropagationStopped();d++){i=u[d],c.currentTarget=i.elem;for(e=0;e<i.matches.length&&!c.isImmediatePropagationStopped();e++){l=i.matches[e];if(s||!c.namespace&&!l.namespace||c.namespace_re&&c.namespace_re.test(l.namespace))c.data=l.data,c.handleObj=l,g=((p.event.special[l.origType]||{}).handle||l.handler).apply(i.elem,r),g!==b&&(c.result=g,g===!1&&(c.preventDefault(),c.stopPropagation()))}}return t.postDispatch&&t.postDispatch.call(this,c),c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,f,g,h=c.button,i=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||e,f=d.documentElement,g=d.body,a.pageX=c.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?c.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0),a}},fix:function(a){if(a[p.expando])return a;var b,c,d=a,f=p.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props;a=p.Event(d);for(b=g.length;b;)c=g[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||e),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,f.filter?f.filter(a,d):a},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){p.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=p.extend(new p.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?p.event.trigger(e,null,b):p.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},p.event.handle=p.event.dispatch,p.removeEvent=e.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]=="undefined"&&(a[d]=null),a.detachEvent(d,c))},p.Event=function(a,b){if(this instanceof p.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?bb:ba):this.type=a,b&&p.extend(this,b),this.timeStamp=a&&a.timeStamp||p.now(),this[p.expando]=!0;else return new p.Event(a,b)},p.Event.prototype={preventDefault:function(){this.isDefaultPrevented=bb;var a=this.originalEvent;if(!a)return;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=bb;var a=this.originalEvent;if(!a)return;a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bb,this.stopPropagation()},isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){p.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj,g=f.selector;if(!e||e!==d&&!p.contains(d,e))a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b;return c}}}),p.support.submitBubbles||(p.event.special.submit={setup:function(){if(p.nodeName(this,"form"))return!1;p.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=p.nodeName(c,"input")||p.nodeName(c,"button")?c.form:b;d&&!p._data(d,"_submit_attached")&&(p.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),p._data(d,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&p.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(p.nodeName(this,"form"))return!1;p.event.remove(this,"._submit")}}),p.support.changeBubbles||(p.event.special.change={setup:function(){if(V.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")p.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,a,!0)});return!1}p.event.add(this,"beforeactivate._change",function(a){var b=a.target;V.test(b.nodeName)&&!p._data(b,"_change_attached")&&(p.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&p.event.simulate("change",this.parentNode,a,!0)}),p._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return p.event.remove(this,"._change"),!V.test(this.nodeName)}}),p.support.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){p.event.simulate(b,a.target,p.event.fix(a),!0)};p.event.special[b]={setup:function(){c++===0&&e.addEventListener(a,d,!0)},teardown:function(){--c===0&&e.removeEventListener(a,d,!0)}}}),p.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(h in a)this.on(h,c,d,a[h],f);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=ba;else if(!e)return this;return f===1&&(g=e,e=function(a){return p().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=p.guid++)),this.each(function(){p.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,p(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if(typeof a=="object"){for(f in a)this.off(f,c,a[f]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=ba),this.each(function(){p.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return p(this.context).on(a,this.selector,b,c),this},die:function(a,b){return p(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length===1?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){p.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return p.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||p.guid++,d=0,e=function(c){var e=(p._data(this,"lastToggle"+a.guid)||0)%d;return p._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){p.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},Y.test(b)&&(p.event.fixHooks[b]=p.event.keyHooks),Z.test(b)&&(p.event.fixHooks[b]=p.event.mouseHooks)}),function(a,b){function bc(a,b,c,d){c=c||[],b=b||r;var e,f,i,j,k=b.nodeType;if(!a||typeof a!="string")return c;if(k!==1&&k!==9)return[];i=g(b);if(!i&&!d)if(e=P.exec(a))if(j=e[1]){if(k===9){f=b.getElementById(j);if(!f||!f.parentNode)return c;if(f.id===j)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(j))&&h(b,f)&&f.id===j)return c.push(f),c}else{if(e[2])return w.apply(c,x.call(b.getElementsByTagName(a),0)),c;if((j=e[3])&&_&&b.getElementsByClassName)return w.apply(c,x.call(b.getElementsByClassName(j),0)),c}return bp(a.replace(L,"$1"),b,c,d,i)}function bd(a){return function(b){var c=b.nodeName.toLowerCase();return c==="input"&&b.type===a}}function be(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}}function bf(a){return z(function(b){return b=+b,z(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function bg(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}function bh(a,b){var c,d,f,g,h,i,j,k=C[o][a];if(k)return b?0:k.slice(0);h=a,i=[],j=e.preFilter;while(h){if(!c||(d=M.exec(h)))d&&(h=h.slice(d[0].length)),i.push(f=[]);c=!1;if(d=N.exec(h))f.push(c=new q(d.shift())),h=h.slice(c.length),c.type=d[0].replace(L," ");for(g in e.filter)(d=W[g].exec(h))&&(!j[g]||(d=j[g](d,r,!0)))&&(f.push(c=new q(d.shift())),h=h.slice(c.length),c.type=g,c.matches=d);if(!c)break}return b?h.length:h?bc.error(a):C(a,i).slice(0)}function bi(a,b,d){var e=b.dir,f=d&&b.dir==="parentNode",g=u++;return b.first?function(b,c,d){while(b=b[e])if(f||b.nodeType===1)return a(b,c,d)}:function(b,d,h){if(!h){var i,j=t+" "+g+" ",k=j+c;while(b=b[e])if(f||b.nodeType===1){if((i=b[o])===k)return b.sizset;if(typeof i=="string"&&i.indexOf(j)===0){if(b.sizset)return b}else{b[o]=k;if(a(b,d,h))return b.sizset=!0,b;b.sizset=!1}}}else while(b=b[e])if(f||b.nodeType===1)if(a(b,d,h))return b}}function bj(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function bk(a,b,c,d,e){var f,g=[],h=0,i=a.length,j=b!=null;for(;h<i;h++)if(f=a[h])if(!c||c(f,d,e))g.push(f),j&&b.push(h);return g}function bl(a,b,c,d,e,f){return d&&!d[o]&&(d=bl(d)),e&&!e[o]&&(e=bl(e,f)),z(function(f,g,h,i){if(f&&e)return;var j,k,l,m=[],n=[],o=g.length,p=f||bo(b||"*",h.nodeType?[h]:h,[],f),q=a&&(f||!b)?bk(p,m,a,h,i):p,r=c?e||(f?a:o||d)?[]:g:q;c&&c(q,r,h,i);if(d){l=bk(r,n),d(l,[],h,i),j=l.length;while(j--)if(k=l[j])r[n[j]]=!(q[n[j]]=k)}if(f){j=a&&r.length;while(j--)if(k=r[j])f[m[j]]=!(g[m[j]]=k)}else r=bk(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):w.apply(g,r)})}function bm(a){var b,c,d,f=a.length,g=e.relative[a[0].type],h=g||e.relative[" "],i=g?1:0,j=bi(function(a){return a===b},h,!0),k=bi(function(a){return y.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==l)||((b=c).nodeType?j(a,c,d):k(a,c,d))}];for(;i<f;i++)if(c=e.relative[a[i].type])m=[bi(bj(m),c)];else{c=e.filter[a[i].type].apply(null,a[i].matches);if(c[o]){d=++i;for(;d<f;d++)if(e.relative[a[d].type])break;return bl(i>1&&bj(m),i>1&&a.slice(0,i-1).join("").replace(L,"$1"),c,i<d&&bm(a.slice(i,d)),d<f&&bm(a=a.slice(d)),d<f&&a.join(""))}m.push(c)}return bj(m)}function bn(a,b){var d=b.length>0,f=a.length>0,g=function(h,i,j,k,m){var n,o,p,q=[],s=0,u="0",x=h&&[],y=m!=null,z=l,A=h||f&&e.find.TAG("*",m&&i.parentNode||i),B=t+=z==null?1:Math.E;y&&(l=i!==r&&i,c=g.el);for(;(n=A[u])!=null;u++){if(f&&n){for(o=0;p=a[o];o++)if(p(n,i,j)){k.push(n);break}y&&(t=B,c=++g.el)}d&&((n=!p&&n)&&s--,h&&x.push(n))}s+=u;if(d&&u!==s){for(o=0;p=b[o];o++)p(x,q,i,j);if(h){if(s>0)while(u--)!x[u]&&!q[u]&&(q[u]=v.call(k));q=bk(q)}w.apply(k,q),y&&!h&&q.length>0&&s+b.length>1&&bc.uniqueSort(k)}return y&&(t=B,l=z),x};return g.el=0,d?z(g):g}function bo(a,b,c,d){var e=0,f=b.length;for(;e<f;e++)bc(a,b[e],c,d);return c}function bp(a,b,c,d,f){var g,h,j,k,l,m=bh(a),n=m.length;if(!d&&m.length===1){h=m[0]=m[0].slice(0);if(h.length>2&&(j=h[0]).type==="ID"&&b.nodeType===9&&!f&&e.relative[h[1].type]){b=e.find.ID(j.matches[0].replace(V,""),b,f)[0];if(!b)return c;a=a.slice(h.shift().length)}for(g=W.POS.test(a)?-1:h.length-1;g>=0;g--){j=h[g];if(e.relative[k=j.type])break;if(l=e.find[k])if(d=l(j.matches[0].replace(V,""),R.test(h[0].type)&&b.parentNode||b,f)){h.splice(g,1),a=d.length&&h.join("");if(!a)return w.apply(c,x.call(d,0)),c;break}}}return i(a,m)(d,b,f,c,R.test(a)),c}function bq(){}var c,d,e,f,g,h,i,j,k,l,m=!0,n="undefined",o=("sizcache"+Math.random()).replace(".",""),q=String,r=a.document,s=r.documentElement,t=0,u=0,v=[].pop,w=[].push,x=[].slice,y=[].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++)if(this[b]===a)return b;return-1},z=function(a,b){return a[o]=b==null||b,a},A=function(){var a={},b=[];return z(function(c,d){return b.push(c)>e.cacheLength&&delete a[b.shift()],a[c]=d},a)},B=A(),C=A(),D=A(),E="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",G=F.replace("w","w#"),H="([*^$|!~]?=)",I="\\["+E+"*("+F+")"+E+"*(?:"+H+E+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+G+")|)|)"+E+"*\\]",J=":("+F+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+I+")|[^:]|\\\\.)*|.*))\\)|)",K=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+E+"*((?:-\\d)?\\d*)"+E+"*\\)|)(?=[^-]|$)",L=new RegExp("^"+E+"+|((?:^|[^\\\\])(?:\\\\.)*)"+E+"+$","g"),M=new RegExp("^"+E+"*,"+E+"*"),N=new RegExp("^"+E+"*([\\x20\\t\\r\\n\\f>+~])"+E+"*"),O=new RegExp(J),P=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Q=/^:not/,R=/[\x20\t\r\n\f]*[+~]/,S=/:not\($/,T=/h\d/i,U=/input|select|textarea|button/i,V=/\\(?!\\)/g,W={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),NAME:new RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+J),POS:new RegExp(K,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+E+"*(even|odd|(([+-]|)(\\d*)n|)"+E+"*(?:([+-]|)"+E+"*(\\d+)|))"+E+"*\\)|)","i"),needsContext:new RegExp("^"+E+"*[>+~]|"+K,"i")},X=function(a){var b=r.createElement("div");try{return a(b)}catch(c){return!1}finally{b=null}},Y=X(function(a){return a.appendChild(r.createComment("")),!a.getElementsByTagName("*").length}),Z=X(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==n&&a.firstChild.getAttribute("href")==="#"}),$=X(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return b!=="boolean"&&b!=="string"}),_=X(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||!a.getElementsByClassName("e").length?!1:(a.lastChild.className="e",a.getElementsByClassName("e").length===2)}),ba=X(function(a){a.id=o+0,a.innerHTML="<a name='"+o+"'></a><div name='"+o+"'></div>",s.insertBefore(a,s.firstChild);var b=r.getElementsByName&&r.getElementsByName(o).length===2+r.getElementsByName(o+0).length;return d=!r.getElementById(o),s.removeChild(a),b});try{x.call(s.childNodes,0)[0].nodeType}catch(bb){x=function(a){var b,c=[];for(;b=this[a];a++)c.push(b);return c}}bc.matches=function(a,b){return bc(a,null,null,b)},bc.matchesSelector=function(a,b){return bc(b,null,null,[a]).length>0},f=bc.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(e===1||e===9||e===11){if(typeof a.textContent=="string")return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=f(a)}else if(e===3||e===4)return a.nodeValue}else for(;b=a[d];d++)c+=f(b);return c},g=bc.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":!1},h=bc.contains=s.contains?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&d.nodeType===1&&c.contains&&c.contains(d))}:s.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b=b.parentNode)if(b===a)return!0;return!1},bc.attr=function(a,b){var c,d=g(a);return d||(b=b.toLowerCase()),(c=e.attrHandle[b])?c(a):d||$?a.getAttribute(b):(c=a.getAttributeNode(b),c?typeof a[b]=="boolean"?a[b]?b:null:c.specified?c.value:null:null)},e=bc.selectors={cacheLength:50,createPseudo:z,match:W,attrHandle:Z?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:d?function(a,b,c){if(typeof b.getElementById!==n&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==n&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==n&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:Y?function(a,b){if(typeof b.getElementsByTagName!==n)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if(a==="*"){var d,e=[],f=0;for(;d=c[f];f++)d.nodeType===1&&e.push(d);return e}return c},NAME:ba&&function(a,b){if(typeof b.getElementsByName!==n)return b.getElementsByName(name)},CLASS:_&&function(a,b,c){if(typeof b.getElementsByClassName!==n&&!c)return b.getElementsByClassName(a)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(V,""),a[3]=(a[4]||a[5]||"").replace(V,""),a[2]==="~="&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),a[1]==="nth"?(a[2]||bc.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*(a[2]==="even"||a[2]==="odd")),a[4]=+(a[6]+a[7]||a[2]==="odd")):a[2]&&bc.error(a[0]),a},PSEUDO:function(a){var b,c;if(W.CHILD.test(a[0]))return null;if(a[3])a[2]=a[3];else if(b=a[4])O.test(b)&&(c=bh(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(b=b.slice(0,c),a[0]=a[0].slice(0,c)),a[2]=b;return a.slice(0,3)}},filter:{ID:d?function(a){return a=a.replace(V,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(V,""),function(b){var c=typeof b.getAttributeNode!==n&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return a==="*"?function(){return!0}:(a=a.replace(V,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=B[o][a];return b||(b=B(a,new RegExp("(^|"+E+")"+a+"("+E+"|$)"))),function(a){return b.test(a.className||typeof a.getAttribute!==n&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return function(d,e){var f=bc.attr(d,a);return f==null?b==="!=":b?(f+="",b==="="?f===c:b==="!="?f!==c:b==="^="?c&&f.indexOf(c)===0:b==="*="?c&&f.indexOf(c)>-1:b==="$="?c&&f.substr(f.length-c.length)===c:b==="~="?(" "+f+" ").indexOf(c)>-1:b==="|="?f===c||f.substr(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d){return a==="nth"?function(a){var b,e,f=a.parentNode;if(c===1&&d===0)return!0;if(f){e=0;for(b=f.firstChild;b;b=b.nextSibling)if(b.nodeType===1){e++;if(a===b)break}}return e-=d,e===c||e%c===0&&e/c>=0}:function(b){var c=b;switch(a){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(a==="first")return!0;c=b;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0}}},PSEUDO:function(a,b){var c,d=e.pseudos[a]||e.setFilters[a.toLowerCase()]||bc.error("unsupported pseudo: "+a);return d[o]?d(b):d.length>1?(c=[a,a,"",b],e.setFilters.hasOwnProperty(a.toLowerCase())?z(function(a,c){var e,f=d(a,b),g=f.length;while(g--)e=y.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}):d}},pseudos:{not:z(function(a){var b=[],c=[],d=i(a.replace(L,"$1"));return d[o]?z(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)if(f=g[h])a[h]=!(b[h]=f)}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:z(function(a){return function(b){return bc(a,b).length>0}}),contains:z(function(a){return function(b){return(b.textContent||b.innerText||f(b)).indexOf(a)>-1}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!e.pseudos.empty(a)},empty:function(a){var b;a=a.firstChild;while(a){if(a.nodeName>"@"||(b=a.nodeType)===3||b===4)return!1;a=a.nextSibling}return!0},header:function(a){return T.test(a.nodeName)},text:function(a){var b,c;return a.nodeName.toLowerCase()==="input"&&(b=a.type)==="text"&&((c=a.getAttribute("type"))==null||c.toLowerCase()===b)},radio:bd("radio"),checkbox:bd("checkbox"),file:bd("file"),password:bd("password"),image:bd("image"),submit:be("submit"),reset:be("reset"),button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},input:function(a){return U.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement},first:bf(function(a,b,c){return[0]}),last:bf(function(a,b,c){return[b-1]}),eq:bf(function(a,b,c){return[c<0?c+b:c]}),even:bf(function(a,b,c){for(var d=0;d<b;d+=2)a.push(d);return a}),odd:bf(function(a,b,c){for(var d=1;d<b;d+=2)a.push(d);return a}),lt:bf(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:bf(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},j=s.compareDocumentPosition?function(a,b){return a===b?(k=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b)return k=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,h=b.parentNode,i=g;if(g===h)return bg(a,b);if(!g)return-1;if(!h)return 1;while(i)e.unshift(i),i=i.parentNode;i=h;while(i)f.unshift(i),i=i.parentNode;c=e.length,d=f.length;for(var j=0;j<c&&j<d;j++)if(e[j]!==f[j])return bg(e[j],f[j]);return j===c?bg(a,f[j],-1):bg(e[j],b,1)},[0,0].sort(j),m=!k,bc.uniqueSort=function(a){var b,c=1;k=m,a.sort(j);if(k)for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a},bc.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},i=bc.compile=function(a,b){var c,d=[],e=[],f=D[o][a];if(!f){b||(b=bh(a)),c=b.length;while(c--)f=bm(b[c]),f[o]?d.push(f):e.push(f);f=D(a,bn(e,d))}return f},r.querySelectorAll&&function(){var a,b=bp,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[":focus"],f=[":active",":focus"],h=s.matchesSelector||s.mozMatchesSelector||s.webkitMatchesSelector||s.oMatchesSelector||s.msMatchesSelector;X(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||e.push("\\["+E+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||e.push(":checked")}),X(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+E+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")}),e=new RegExp(e.join("|")),bp=function(a,d,f,g,h){if(!g&&!h&&(!e||!e.test(a))){var i,j,k=!0,l=o,m=d,n=d.nodeType===9&&a;if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){i=bh(a),(k=d.getAttribute("id"))?l=k.replace(c,"\\$&"):d.setAttribute("id",l),l="[id='"+l+"'] ",j=i.length;while(j--)i[j]=l+i[j].join("");m=R.test(a)&&d.parentNode||d,n=i.join(",")}if(n)try{return w.apply(f,x.call(m.querySelectorAll(n),0)),f}catch(p){}finally{k||d.removeAttribute("id")}}return b(a,d,f,g,h)},h&&(X(function(b){a=h.call(b,"div");try{h.call(b,"[test!='']:sizzle"),f.push("!=",J)}catch(c){}}),f=new RegExp(f.join("|")),bc.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!g(b)&&!f.test(c)&&(!e||!e.test(c)))try{var i=h.call(b,c);if(i||a||b.document&&b.document.nodeType!==11)return i}catch(j){}return bc(c,null,null,[b]).length>0})}(),e.pseudos.nth=e.pseudos.eq,e.filters=bq.prototype=e.pseudos,e.setFilters=new bq,bc.attr=p.attr,p.find=bc,p.expr=bc.selectors,p.expr[":"]=p.expr.pseudos,p.unique=bc.uniqueSort,p.text=bc.getText,p.isXMLDoc=bc.isXML,p.contains=bc.contains}(a);var bc=/Until$/,bd=/^(?:parents|prev(?:Until|All))/,be=/^.[^:#\[\.,]*$/,bf=p.expr.match.needsContext,bg={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if(typeof a!="string")return p(a).filter(function(){for(b=0,c=h.length;b<c;b++)if(p.contains(h[b],this))return!0});g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++){d=g.length,p.find(a,this[b],g);if(b>0)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}}return g},has:function(a){var b,c=p(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if(p.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(bj(this,a,!1),"not",a)},filter:function(a){return this.pushStack(bj(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?bf.test(a)?p(a,this.context).index(this[0])>=0:p.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c,d=0,e=this.length,f=[],g=bf.test(a)||typeof a!="string"?p(a,b||this.context):0;for(;d<e;d++){c=this[d];while(c&&c.ownerDocument&&c!==b&&c.nodeType!==11){if(g?g.index(c)>-1:p.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}}return f=f.length>1?p.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?typeof a=="string"?p.inArray(this[0],p(a)):p.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?p(a,b):p.makeArray(a&&a.nodeType?[a]:a),d=p.merge(this.get(),c);return this.pushStack(bh(c[0])||bh(d[0])?d:p.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}}),p.fn.andSelf=p.fn.addBack,p.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return p.dir(a,"parentNode")},parentsUntil:function(a,b,c){return p.dir(a,"parentNode",c)},next:function(a){return bi(a,"nextSibling")},prev:function(a){return bi(a,"previousSibling")},nextAll:function(a){return p.dir(a,"nextSibling")},prevAll:function(a){return p.dir(a,"previousSibling")},nextUntil:function(a,b,c){return p.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return p.dir(a,"previousSibling",c)},siblings:function(a){return p.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return p.sibling(a.firstChild)},contents:function(a){return p.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:p.merge([],a.childNodes)}},function(a,b){p.fn[a]=function(c,d){var e=p.map(this,b,c);return bc.test(a)||(d=c),d&&typeof d=="string"&&(e=p.filter(d,e)),e=this.length>1&&!bg[a]?p.unique(e):e,this.length>1&&bd.test(a)&&(e=e.reverse()),this.pushStack(e,a,k.call(arguments).join(","))}}),p.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?p.find.matchesSelector(b[0],a)?[b[0]]:[]:p.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!p(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var bl="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bm=/ jQuery\d+="(?:null|\d+)"/g,bn=/^\s+/,bo=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bp=/<([\w:]+)/,bq=/<tbody/i,br=/<|&#?\w+;/,bs=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,bu=new RegExp("<(?:"+bl+")[\\s/>]","i"),bv=/^(?:checkbox|radio)$/,bw=/checked\s*(?:[^=]|=\s*.checked.)/i,bx=/\/(java|ecma)script/i,by=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,bz={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bA=bk(e),bB=bA.appendChild(e.createElement("div"));bz.optgroup=bz.option,bz.tbody=bz.tfoot=bz.colgroup=bz.caption=bz.thead,bz.th=bz.td,p.support.htmlSerialize||(bz._default=[1,"X<div>","</div>"]),p.fn.extend({text:function(a){return p.access(this,function(a){return a===b?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||e).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(p.isFunction(a))return this.each(function(b){p(this).wrapAll(a.call(this,b))});if(this[0]){var b=p(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return p.isFunction(a)?this.each(function(b){p(this).wrapInner(a.call(this,b))}):this.each(function(){var b=p(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=p.isFunction(a);return this.each(function(c){p(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!bh(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(a,this),"before",this.selector)}},after:function(){if(!bh(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(this,a),"after",this.selector)}},remove:function(a,b){var c,d=0;for(;(c=this[d])!=null;d++)if(!a||p.filter(a,[c]).length)!b&&c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),p.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){a.nodeType===1&&p.cleanData(a.getElementsByTagName("*"));while(a.firstChild)a.removeChild(a.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return p.clone(this,a,b)})},html:function(a){return p.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(bm,""):b;if(typeof a=="string"&&!bs.test(a)&&(p.support.htmlSerialize||!bu.test(a))&&(p.support.leadingWhitespace||!bn.test(a))&&!bz[(bp.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bo,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return bh(this[0])?this.length?this.pushStack(p(p.isFunction(a)?a():a),"replaceWith",a):this:p.isFunction(a)?this.each(function(b){var c=p(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=p(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;p(this).remove(),b?p(b).before(a):p(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],l=this.length;if(!p.support.checkClone&&l>1&&typeof j=="string"&&bw.test(j))return this.each(function(){p(this).domManip(a,c,d)});if(p.isFunction(j))return this.each(function(e){var f=p(this);a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){e=p.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,g.childNodes.length===1&&(g=f);if(f){c=c&&p.nodeName(f,"tr");for(h=e.cacheable||l-1;i<l;i++)d.call(c&&p.nodeName(this[i],"table")?bC(this[i],"tbody"):this[i],i===h?g:p.clone(g,!0,!0))}g=f=null,k.length&&p.each(k,function(a,b){b.src?p.ajax?p.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):p.error("no ajax"):p.globalEval((b.text||b.textContent||b.innerHTML||"").replace(by,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),p.buildFragment=function(a,c,d){var f,g,h,i=a[0];return c=c||e,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,a.length===1&&typeof i=="string"&&i.length<512&&c===e&&i.charAt(0)==="<"&&!bt.test(i)&&(p.support.checkClone||!bw.test(i))&&(p.support.html5Clone||!bu.test(i))&&(g=!0,f=p.fragments[i],h=f!==b),f||(f=c.createDocumentFragment(),p.clean(a,c,f,d),g&&(p.fragments[i]=h&&f)),{fragment:f,cacheable:g}},p.fragments={},p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){p.fn[a]=function(c){var d,e=0,f=[],g=p(c),h=g.length,i=this.length===1&&this[0].parentNode;if((i==null||i&&i.nodeType===11&&i.childNodes.length===1)&&h===1)return g[b](this[0]),this;for(;e<h;e++)d=(e>0?this.clone(!0):this).get(),p(g[e])[b](d),f=f.concat(d);return this.pushStack(f,a,g.selector)}}),p.extend({clone:function(a,b,c){var d,e,f,g;p.support.html5Clone||p.isXMLDoc(a)||!bu.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bB.innerHTML=a.outerHTML,bB.removeChild(g=bB.firstChild));if((!p.support.noCloneEvent||!p.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!p.isXMLDoc(a)){bE(a,g),d=bF(a),e=bF(g);for(f=0;d[f];++f)e[f]&&bE(d[f],e[f])}if(b){bD(a,g);if(c){d=bF(a),e=bF(g);for(f=0;d[f];++f)bD(d[f],e[f])}}return d=e=null,g},clean:function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,q,r,s=b===e&&bA,t=[];if(!b||typeof b.createDocumentFragment=="undefined")b=e;for(f=0;(h=a[f])!=null;f++){typeof h=="number"&&(h+="");if(!h)continue;if(typeof h=="string")if(!br.test(h))h=b.createTextNode(h);else{s=s||bk(b),l=b.createElement("div"),s.appendChild(l),h=h.replace(bo,"<$1></$2>"),i=(bp.exec(h)||["",""])[1].toLowerCase(),j=bz[i]||bz._default,k=j[0],l.innerHTML=j[1]+h+j[2];while(k--)l=l.lastChild;if(!p.support.tbody){m=bq.test(h),n=i==="table"&&!m?l.firstChild&&l.firstChild.childNodes:j[1]==="<table>"&&!m?l.childNodes:[];for(g=n.length-1;g>=0;--g)p.nodeName(n[g],"tbody")&&!n[g].childNodes.length&&n[g].parentNode.removeChild(n[g])}!p.support.leadingWhitespace&&bn.test(h)&&l.insertBefore(b.createTextNode(bn.exec(h)[0]),l.firstChild),h=l.childNodes,l.parentNode.removeChild(l)}h.nodeType?t.push(h):p.merge(t,h)}l&&(h=l=s=null);if(!p.support.appendChecked)for(f=0;(h=t[f])!=null;f++)p.nodeName(h,"input")?bG(h):typeof h.getElementsByTagName!="undefined"&&p.grep(h.getElementsByTagName("input"),bG);if(c){q=function(a){if(!a.type||bx.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)};for(f=0;(h=t[f])!=null;f++)if(!p.nodeName(h,"script")||!q(h))c.appendChild(h),typeof h.getElementsByTagName!="undefined"&&(r=p.grep(p.merge([],h.getElementsByTagName("script")),q),t.splice.apply(t,[f+1,0].concat(r)),f+=r.length)}return t},cleanData:function(a,b){var c,d,e,f,g=0,h=p.expando,i=p.cache,j=p.support.deleteExpando,k=p.event.special;for(;(e=a[g])!=null;g++)if(b||p.acceptData(e)){d=e[h],c=d&&i[d];if(c){if(c.events)for(f in c.events)k[f]?p.event.remove(e,f):p.removeEvent(e,f,c.handle);i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,p.deletedIds.push(d))}}}}),function(){var a,b;p.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=p.uaMatch(g.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),p.browser=b,p.sub=function(){function a(b,c){return new a.fn.init(b,c)}p.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function c(c,d){return d&&d instanceof p&&!(d instanceof a)&&(d=a(d)),p.fn.init.call(this,c,d,b)},a.fn.init.prototype=a.fn;var b=a(e);return a}}();var bH,bI,bJ,bK=/alpha\([^)]*\)/i,bL=/opacity=([^)]*)/,bM=/^(top|right|bottom|left)$/,bN=/^(none|table(?!-c[ea]).+)/,bO=/^margin/,bP=new RegExp("^("+q+")(.*)$","i"),bQ=new RegExp("^("+q+")(?!px)[a-z%]+$","i"),bR=new RegExp("^([-+])=("+q+")","i"),bS={},bT={position:"absolute",visibility:"hidden",display:"block"},bU={letterSpacing:0,fontWeight:400},bV=["Top","Right","Bottom","Left"],bW=["Webkit","O","Moz","ms"],bX=p.fn.toggle;p.fn.extend({css:function(a,c){return p.access(this,function(a,c,d){return d!==b?p.style(a,c,d):p.css(a,c)},a,c,arguments.length>1)},show:function(){return b$(this,!0)},hide:function(){return b$(this)},toggle:function(a,b){var c=typeof a=="boolean";return p.isFunction(a)&&p.isFunction(b)?bX.apply(this,arguments):this.each(function(){(c?a:bZ(this))?p(this).show():p(this).hide()})}}),p.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bH(a,"opacity");return c===""?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":p.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!a||a.nodeType===3||a.nodeType===8||!a.style)return;var f,g,h,i=p.camelCase(c),j=a.style;c=p.cssProps[i]||(p.cssProps[i]=bY(j,i)),h=p.cssHooks[c]||p.cssHooks[i];if(d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];g=typeof d,g==="string"&&(f=bR.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(p.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!p.cssNumber[i]&&(d+="px");if(!h||!("set"in h)||(d=h.set(a,d,e))!==b)try{j[c]=d}catch(k){}},css:function(a,c,d,e){var f,g,h,i=p.camelCase(c);return c=p.cssProps[i]||(p.cssProps[i]=bY(a.style,i)),h=p.cssHooks[c]||p.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=bH(a,c)),f==="normal"&&c in bU&&(f=bU[c]),d||e!==b?(g=parseFloat(f),d||p.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];d=c.call(a);for(e in b)a.style[e]=f[e];return d}}),a.getComputedStyle?bH=function(b,c){var d,e,f,g,h=a.getComputedStyle(b,null),i=b.style;return h&&(d=h[c],d===""&&!p.contains(b.ownerDocument,b)&&(d=p.style(b,c)),bQ.test(d)&&bO.test(c)&&(e=i.width,f=i.minWidth,g=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=h.width,i.width=e,i.minWidth=f,i.maxWidth=g)),d}:e.documentElement.currentStyle&&(bH=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return e==null&&f&&f[b]&&(e=f[b]),bQ.test(e)&&!bM.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),e===""?"auto":e}),p.each(["height","width"],function(a,b){p.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth===0&&bN.test(bH(a,"display"))?p.swap(a,bT,function(){return cb(a,b,d)}):cb(a,b,d)},set:function(a,c,d){return b_(a,c,d?ca(a,b,d,p.support.boxSizing&&p.css(a,"boxSizing")==="border-box"):0)}}}),p.support.opacity||(p.cssHooks.opacity={get:function(a,b){return bL.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=p.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&p.trim(f.replace(bK,""))===""&&c.removeAttribute){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bK.test(f)?f.replace(bK,e):f+" "+e}}),p(function(){p.support.reliableMarginRight||(p.cssHooks.marginRight={get:function(a,b){return p.swap(a,{display:"inline-block"},function(){if(b)return bH(a,"marginRight")})}}),!p.support.pixelPosition&&p.fn.position&&p.each(["top","left"],function(a,b){p.cssHooks[b]={get:function(a,c){if(c){var d=bH(a,b);return bQ.test(d)?p(a).position()[b]+"px":d}}}})}),p.expr&&p.expr.filters&&(p.expr.filters.hidden=function(a){return a.offsetWidth===0&&a.offsetHeight===0||!p.support.reliableHiddenOffsets&&(a.style&&a.style.display||bH(a,"display"))==="none"},p.expr.filters.visible=function(a){return!p.expr.filters.hidden(a)}),p.each({margin:"",padding:"",border:"Width"},function(a,b){p.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bV[d]+b]=e[d]||e[d-2]||e[0];return f}},bO.test(a)||(p.cssHooks[a+b].set=b_)});var cd=/%20/g,ce=/\[\]$/,cf=/\r?\n/g,cg=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ch=/^(?:select|textarea)/i;p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?p.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ch.test(this.nodeName)||cg.test(this.type))}).map(function(a,b){var c=p(this).val();return c==null?null:p.isArray(c)?p.map(c,function(a,c){return{name:b.name,value:a.replace(cf,"\r\n")}}):{name:b.name,value:c.replace(cf,"\r\n")}}).get()}}),p.param=function(a,c){var d,e=[],f=function(a,b){b=p.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=p.ajaxSettings&&p.ajaxSettings.traditional);if(p.isArray(a)||a.jquery&&!p.isPlainObject(a))p.each(a,function(){f(this.name,this.value)});else for(d in a)ci(d,a[d],c,f);return e.join("&").replace(cd,"+")};var cj,ck,cl=/#.*$/,cm=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,cn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,co=/^(?:GET|HEAD)$/,cp=/^\/\//,cq=/\?/,cr=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,cs=/([?&])_=[^&]*/,ct=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cu=p.fn.load,cv={},cw={},cx=["*/"]+["*"];try{ck=f.href}catch(cy){ck=e.createElement("a"),ck.href="",ck=ck.href}cj=ct.exec(ck.toLowerCase())||[],p.fn.load=function(a,c,d){if(typeof a!="string"&&cu)return cu.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),p.isFunction(c)?(d=c,c=b):c&&typeof c=="object"&&(f="POST"),p.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?p("<div>").append(a.replace(cr,"")).find(e):a)}),this},p.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){p.fn[b]=function(a){return this.on(b,a)}}),p.each(["get","post"],function(a,c){p[c]=function(a,d,e,f){return p.isFunction(d)&&(f=f||e,e=d,d=b),p.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),p.extend({getScript:function(a,c){return p.get(a,b,c,"script")},getJSON:function(a,b,c){return p.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?cB(a,p.ajaxSettings):(b=a,a=p.ajaxSettings),cB(a,b),a},ajaxSettings:{url:ck,isLocal:cn.test(cj[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":cx},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:cz(cv),ajaxTransport:cz(cw),ajax:function(a,c){function y(a,c,f,i){var k,s,t,u,w,y=c;if(v===2)return;v=2,h&&clearTimeout(h),g=b,e=i||"",x.readyState=a>0?4:0,f&&(u=cC(l,x,f));if(a>=200&&a<300||a===304)l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(p.lastModified[d]=w),w=x.getResponseHeader("Etag"),w&&(p.etag[d]=w)),a===304?(y="notmodified",k=!0):(k=cD(l,u),y=k.state,s=k.data,t=k.error,k=!t);else{t=y;if(!y||a)y="error",a<0&&(a=0)}x.status=a,x.statusText=(c||y)+"",k?o.resolveWith(m,[s,y,x]):o.rejectWith(m,[x,y,t]),x.statusCode(r),r=b,j&&n.trigger("ajax"+(k?"Success":"Error"),[x,l,k?s:t]),q.fireWith(m,[x,y]),j&&(n.trigger("ajaxComplete",[x,l]),--p.active||p.event.trigger("ajaxStop"))}typeof a=="object"&&(c=a,a=b),c=c||{};var d,e,f,g,h,i,j,k,l=p.ajaxSetup({},c),m=l.context||l,n=m!==l&&(m.nodeType||m instanceof p)?p(m):p.event,o=p.Deferred(),q=p.Callbacks("once memory"),r=l.statusCode||{},t={},u={},v=0,w="canceled",x={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=u[c]=u[c]||a,t[a]=b}return this},getAllResponseHeaders:function(){return v===2?e:null},getResponseHeader:function(a){var c;if(v===2){if(!f){f={};while(c=cm.exec(e))f[c[1].toLowerCase()]=c[2]}c=f[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return v||(l.mimeType=a),this},abort:function(a){return a=a||w,g&&g.abort(a),y(0,a),this}};o.promise(x),x.success=x.done,x.error=x.fail,x.complete=q.add,x.statusCode=function(a){if(a){var b;if(v<2)for(b in a)r[b]=[r[b],a[b]];else b=a[x.status],x.always(b)}return this},l.url=((a||l.url)+"").replace(cl,"").replace(cp,cj[1]+"//"),l.dataTypes=p.trim(l.dataType||"*").toLowerCase().split(s),l.crossDomain==null&&(i=ct.exec(l.url.toLowerCase())||!1,l.crossDomain=i&&i.join(":")+(i[3]?"":i[1]==="http:"?80:443)!==cj.join(":")+(cj[3]?"":cj[1]==="http:"?80:443)),l.data&&l.processData&&typeof l.data!="string"&&(l.data=p.param(l.data,l.traditional)),cA(cv,l,c,x);if(v===2)return x;j=l.global,l.type=l.type.toUpperCase(),l.hasContent=!co.test(l.type),j&&p.active++===0&&p.event.trigger("ajaxStart");if(!l.hasContent){l.data&&(l.url+=(cq.test(l.url)?"&":"?")+l.data,delete l.data),d=l.url;if(l.cache===!1){var z=p.now(),A=l.url.replace(cs,"$1_="+z);l.url=A+(A===l.url?(cq.test(l.url)?"&":"?")+"_="+z:"")}}(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",l.contentType),l.ifModified&&(d=d||l.url,p.lastModified[d]&&x.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&x.setRequestHeader("If-None-Match",p.etag[d])),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+cx+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)x.setRequestHeader(k,l.headers[k]);if(!l.beforeSend||l.beforeSend.call(m,x,l)!==!1&&v!==2){w="abort";for(k in{success:1,error:1,complete:1})x[k](l[k]);g=cA(cw,l,c,x);if(!g)y(-1,"No Transport");else{x.readyState=1,j&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){x.abort("timeout")},l.timeout));try{v=1,g.send(t,y)}catch(B){if(v<2)y(-1,B);else throw B}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var cE=[],cF=/\?/,cG=/(=)\?(?=&|$)|\?\?/,cH=p.now();p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=cE.pop()||p.expando+"_"+cH++;return this[a]=!0,a}}),p.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&cG.test(j),m=k&&!l&&typeof i=="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&cG.test(i);if(c.dataTypes[0]==="jsonp"||l||m)return f=c.jsonpCallback=p.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(cG,"$1"+f):m?c.data=i.replace(cG,"$1"+f):k&&(c.url+=(cF.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||p.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,cE.push(f)),h&&p.isFunction(g)&&g(h[0]),h=g=b}),"script"}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return p.globalEval(a),a}}}),p.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),p.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=e.head||e.getElementsByTagName("head")[0]||e.documentElement;return{send:function(f,g){c=e.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||g(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var cI,cJ=a.ActiveXObject?function(){for(var a in cI)cI[a](0,1)}:!1,cK=0;p.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&cL()||cM()}:cL,function(a){p.extend(p.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(p.ajaxSettings.xhr()),p.support.ajax&&p.ajaxTransport(function(c){if(!c.crossDomain||p.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async);if(c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l,m;try{if(d&&(e||i.readyState===4)){d=b,g&&(i.onreadystatechange=p.noop,cJ&&delete cI[g]);if(e)i.readyState!==4&&i.abort();else{h=i.status,k=i.getAllResponseHeaders(),l={},m=i.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=i.responseText}catch(a){}try{j=i.statusText}catch(n){j=""}!h&&c.isLocal&&!c.crossDomain?h=l.text?200:404:h===1223&&(h=204)}}}catch(o){e||f(-1,o)}l&&f(h,j,l,k)},c.async?i.readyState===4?setTimeout(d,0):(g=++cK,cJ&&(cI||(cI={},p(a).unload(cJ)),cI[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var cN,cO,cP=/^(?:toggle|show|hide)$/,cQ=new RegExp("^(?:([-+])=|)("+q+")([a-z%]*)$","i"),cR=/queueHooks$/,cS=[cY],cT={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=cQ.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){c=+f[2],d=f[3]||(p.cssNumber[a]?"":"px");if(d!=="px"&&h){h=p.css(e.elem,a,!0)||c||1;do i=i||".5",h=h/i,p.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&i!==1&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};p.Animation=p.extend(cW,{tweener:function(a,b){p.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");var c,d=0,e=a.length;for(;d<e;d++)c=a[d],cT[c]=cT[c]||[],cT[c].unshift(b)},prefilter:function(a,b){b?cS.unshift(a):cS.push(a)}}),p.Tween=cZ,cZ.prototype={constructor:cZ,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[c]?"":"px")},cur:function(){var a=cZ.propHooks[this.prop];return a&&a.get?a.get(this):cZ.propHooks._default.get(this)},run:function(a){var b,c=cZ.propHooks[this.prop];return this.options.duration?this.pos=b=p.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):cZ.propHooks._default.set(this),this}},cZ.prototype.init.prototype=cZ.prototype,cZ.propHooks={_default:{get:function(a){var b;return a.elem[a.prop]==null||!!a.elem.style&&a.elem.style[a.prop]!=null?(b=p.css(a.elem,a.prop,!1,""),!b||b==="auto"?0:b):a.elem[a.prop]},set:function(a){p.fx.step[a.prop]?p.fx.step[a.prop](a):a.elem.style&&(a.elem.style[p.cssProps[a.prop]]!=null||p.cssHooks[a.prop])?p.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},cZ.propHooks.scrollTop=cZ.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},p.each(["toggle","show","hide"],function(a,b){var c=p.fn[b];p.fn[b]=function(d,e,f){return d==null||typeof d=="boolean"||!a&&p.isFunction(d)&&p.isFunction(e)?c.apply(this,arguments):this.animate(c$(b,!0),d,e,f)}}),p.fn.extend({fadeTo:function(a,b,c,d){return this.filter(bZ).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=p.isEmptyObject(a),f=p.speed(b,c,d),g=function(){var b=cW(this,p.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=a!=null&&a+"queueHooks",f=p.timers,g=p._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&cR.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&p.dequeue(this,a)})}}),p.each({slideDown:c$("show"),slideUp:c$("hide"),slideToggle:c$("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){p.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),p.speed=function(a,b,c){var d=a&&typeof a=="object"?p.extend({},a):{complete:c||!c&&b||p.isFunction(a)&&a,duration:a,easing:c&&b||b&&!p.isFunction(b)&&b};d.duration=p.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in p.fx.speeds?p.fx.speeds[d.duration]:p.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(){p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)},d},p.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},p.timers=[],p.fx=cZ.prototype.init,p.fx.tick=function(){var a,b=p.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||p.fx.stop()},p.fx.timer=function(a){a()&&p.timers.push(a)&&!cO&&(cO=setInterval(p.fx.tick,p.fx.interval))},p.fx.interval=13,p.fx.stop=function(){clearInterval(cO),cO=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fx.step={},p.expr&&p.expr.filters&&(p.expr.filters.animated=function(a){return p.grep(p.timers,function(b){return a===b.elem}).length});var c_=/^(?:body|html)$/i;p.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){p.offset.setOffset(this,a,b)});var c,d,e,f,g,h,i,j={top:0,left:0},k=this[0],l=k&&k.ownerDocument;if(!l)return;return(d=l.body)===k?p.offset.bodyOffset(k):(c=l.documentElement,p.contains(c,k)?(typeof k.getBoundingClientRect!="undefined"&&(j=k.getBoundingClientRect()),e=da(l),f=c.clientTop||d.clientTop||0,g=c.clientLeft||d.clientLeft||0,h=e.pageYOffset||c.scrollTop,i=e.pageXOffset||c.scrollLeft,{top:j.top+h-f,left:j.left+i-g}):j)},p.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return p.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(p.css(a,"marginTop"))||0,c+=parseFloat(p.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=p.css(a,"position");d==="static"&&(a.style.position="relative");var e=p(a),f=e.offset(),g=p.css(a,"top"),h=p.css(a,"left"),i=(d==="absolute"||d==="fixed")&&p.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),p.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},p.fn.extend({position:function(){if(!this[0])return;var a=this[0],b=this.offsetParent(),c=this.offset(),d=c_.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(p.css(a,"marginTop"))||0,c.left-=parseFloat(p.css(a,"marginLeft"))||0,d.top+=parseFloat(p.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(p.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||e.body;while(a&&!c_.test(a.nodeName)&&p.css(a,"position")==="static")a=a.offsetParent;return a||e.body})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);p.fn[a]=function(e){return p.access(this,function(a,e,f){var g=da(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?p(g).scrollLeft():f,d?f:p(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}}),p.each({Height:"height",Width:"width"},function(a,c){p.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){p.fn[e]=function(e,f){var g=arguments.length&&(d||typeof e!="boolean"),h=d||(e===!0||f===!0?"margin":"border");return p.access(this,function(c,d,e){var f;return p.isWindow(c)?c.document.documentElement["client"+a]:c.nodeType===9?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?p.css(c,d,e,h):p.style(c,d,e,h)},c,g?e:b,g,null)}})}),a.jQuery=a.$=p,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return p})})(window);
;
;
/*! lodash.min.js */ 
;
;
/**
* @license
* lodash 3.9.3 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
* Build: `lodash modern -o ./lodash.js`
*/
;(function(){function n(n,t){if(n!==t){var r=null===n,e=n===m,u=n===n,i=null===t,o=t===m,f=t===t;if(n>t&&!i||!u||r&&!o&&f||e&&f)return 1;if(n<t&&!r||!f||i&&!e&&u||o&&u)return-1}return 0}function t(n,t,r){for(var e=n.length,u=r?e:-1;r?u--:++u<e;)if(t(n[u],u,n))return u;return-1}function r(n,t,r){if(t!==t)return s(n,r);r-=1;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function e(n){return typeof n=="function"||false}function u(n){return typeof n=="string"?n:null==n?"":n+""}function i(n,t){for(var r=-1,e=n.length;++r<e&&-1<t.indexOf(n.charAt(r)););
return r}function o(n,t){for(var r=n.length;r--&&-1<t.indexOf(n.charAt(r)););return r}function f(t,r){return n(t.a,r.a)||t.b-r.b}function l(n){return Nn[n]}function a(n){return Ln[n]}function c(n){return"\\"+Mn[n]}function s(n,t,r){var e=n.length;for(t+=r?0:-1;r?t--:++t<e;){var u=n[t];if(u!==u)return t}return-1}function p(n){return!!n&&typeof n=="object"}function h(n){return 160>=n&&9<=n&&13>=n||32==n||160==n||5760==n||6158==n||8192<=n&&(8202>=n||8232==n||8233==n||8239==n||8287==n||12288==n||65279==n);
}function _(n,t){for(var r=-1,e=n.length,u=-1,i=[];++r<e;)n[r]===t&&(n[r]=L,i[++u]=r);return i}function v(n){for(var t=-1,r=n.length;++t<r&&h(n.charCodeAt(t)););return t}function g(n){for(var t=n.length;t--&&h(n.charCodeAt(t)););return t}function y(n){return zn[n]}function d(h){function Nn(n){if(p(n)&&!(Ti(n)||n instanceof Bn)){if(n instanceof zn)return n;if(ru.call(n,"__chain__")&&ru.call(n,"__wrapped__"))return Mr(n)}return new zn(n)}function Ln(){}function zn(n,t,r){this.__wrapped__=n,this.__actions__=r||[],
this.__chain__=!!t}function Bn(n){this.__wrapped__=n,this.__actions__=null,this.__dir__=1,this.__filtered__=false,this.__iteratees__=null,this.__takeCount__=Su,this.__views__=null}function Mn(){this.__data__={}}function Pn(n){var t=n?n.length:0;for(this.data={hash:bu(null),set:new vu};t--;)this.push(n[t])}function qn(n,t){var r=n.data;return(typeof t=="string"||ve(t)?r.set.has(t):r.hash[t])?0:-1}function Dn(n,t){var r=-1,e=n.length;for(t||(t=Me(e));++r<e;)t[r]=n[r];return t}function Kn(n,t){for(var r=-1,e=n.length;++r<e&&false!==t(n[r],r,n););
return n}function Vn(n,t){for(var r=-1,e=n.length;++r<e;)if(!t(n[r],r,n))return false;return true}function Gn(n,t){for(var r=-1,e=n.length,u=-1,i=[];++r<e;){var o=n[r];t(o,r,n)&&(i[++u]=o)}return i}function Jn(n,t){for(var r=-1,e=n.length,u=Me(e);++r<e;)u[r]=t(n[r],r,n);return u}function Xn(n,t,r,e){var u=-1,i=n.length;for(e&&i&&(r=n[++u]);++u<i;)r=t(r,n[u],u,n);return r}function Hn(n,t){for(var r=-1,e=n.length;++r<e;)if(t(n[r],r,n))return true;return false}function Qn(n,t){return n===m?t:n}function nt(n,t,r,e){
return n!==m&&ru.call(e,r)?n:t}function tt(n,t,r){for(var e=-1,u=Ki(t),i=u.length;++e<i;){var o=u[e],f=n[o],l=r(f,t[o],o,n,t);(l===l?l===f:f!==f)&&(f!==m||o in n)||(n[o]=l)}return n}function rt(n,t){return null==t?n:ut(t,Ki(t),n)}function et(n,t){for(var r=-1,e=null==n,u=!e&&Ir(n),i=u?n.length:0,o=t.length,f=Me(o);++r<o;){var l=t[r];f[r]=u?Er(l,i)?n[l]:m:e?m:n[l]}return f}function ut(n,t,r){r||(r={});for(var e=-1,u=t.length;++e<u;){var i=t[e];r[i]=n[i]}return r}function it(n,t,r){var e=typeof n;return"function"==e?t===m?n:Mt(n,t,r):null==n?Fe:"object"==e?xt(n):t===m?Be(n):At(n,t);
}function ot(n,t,r,e,u,i,o){var f;if(r&&(f=u?r(n,e,u):r(n)),f!==m)return f;if(!ve(n))return n;if(e=Ti(n)){if(f=jr(n),!t)return Dn(n,f)}else{var l=uu.call(n),a=l==D;if(l!=V&&l!=z&&(!a||u))return $n[l]?Or(n,l,t):u?n:{};if(f=kr(a?{}:n),!t)return rt(f,n)}for(i||(i=[]),o||(o=[]),u=i.length;u--;)if(i[u]==n)return o[u];return i.push(n),o.push(f),(e?Kn:vt)(n,function(e,u){f[u]=ot(e,t,r,u,n,i,o)}),f}function ft(n,t,r){if(typeof n!="function")throw new Je(N);return gu(function(){n.apply(m,r)},t)}function lt(n,t){
var e=n?n.length:0,u=[];if(!e)return u;var i=-1,o=br(),f=o==r,l=f&&200<=t.length?Vu(t):null,a=t.length;l&&(o=qn,f=false,t=l);n:for(;++i<e;)if(l=n[i],f&&l===l){for(var c=a;c--;)if(t[c]===l)continue n;u.push(l)}else 0>o(t,l,0)&&u.push(l);return u}function at(n,t){var r=true;return Mu(n,function(n,e,u){return r=!!t(n,e,u)}),r}function ct(n,t,r,e){var u=e,i=u;return Mu(n,function(n,o,f){o=+t(n,o,f),(r(o,u)||o===e&&o===i)&&(u=o,i=n)}),i}function st(n,t){var r=[];return Mu(n,function(n,e,u){t(n,e,u)&&r.push(n);
}),r}function pt(n,t,r,e){var u;return r(n,function(n,r,i){return t(n,r,i)?(u=e?r:n,false):void 0}),u}function ht(n,t,r){for(var e=-1,u=n.length,i=-1,o=[];++e<u;){var f=n[e];if(p(f)&&Ir(f)&&(r||Ti(f)||se(f))){t&&(f=ht(f,t,r));for(var l=-1,a=f.length;++l<a;)o[++i]=f[l]}else r||(o[++i]=f)}return o}function _t(n,t){qu(n,t,ke)}function vt(n,t){return qu(n,t,Ki)}function gt(n,t){return Du(n,t,Ki)}function yt(n,t){for(var r=-1,e=t.length,u=-1,i=[];++r<e;){var o=t[r];$i(n[o])&&(i[++u]=o)}return i}function dt(n,t,r){
if(null!=n){r!==m&&r in zr(n)&&(t=[r]),r=0;for(var e=t.length;null!=n&&r<e;)n=n[t[r++]];return r&&r==e?n:m}}function mt(n,t,r,e,u,i){if(n===t)n=true;else if(null==n||null==t||!ve(n)&&!p(t))n=n!==n&&t!==t;else n:{var o=mt,f=Ti(n),l=Ti(t),a=B,c=B;f||(a=uu.call(n),a==z?a=V:a!=V&&(f=we(n))),l||(c=uu.call(t),c==z?c=V:c!=V&&we(t));var s=a==V,l=c==V,c=a==c;if(!c||f||s){if(!e&&(a=s&&ru.call(n,"__wrapped__"),l=l&&ru.call(t,"__wrapped__"),a||l)){n=o(a?n.value():n,l?t.value():t,r,e,u,i);break n}if(c){for(u||(u=[]),
i||(i=[]),a=u.length;a--;)if(u[a]==n){n=i[a]==t;break n}u.push(n),i.push(t),n=(f?gr:dr)(n,t,o,r,e,u,i),u.pop(),i.pop()}else n=false}else n=yr(n,t,a)}return n}function wt(n,t,r){var e=t.length,u=e,i=!r;if(null==n)return!u;for(n=zr(n);e--;){var o=t[e];if(i&&o[2]?o[1]!==n[o[0]]:!(o[0]in n))return false}for(;++e<u;){var o=t[e],f=o[0],l=n[f],a=o[1];if(i&&o[2]){if(l===m&&!(f in n))return false}else if(o=r?r(l,a,f):m,o===m?!mt(a,l,r,true):!o)return false}return true}function bt(n,t){var r=-1,e=Ir(n)?Me(n.length):[];return Mu(n,function(n,u,i){
e[++r]=t(n,u,i)}),e}function xt(n){var t=xr(n);if(1==t.length&&t[0][2]){var r=t[0][0],e=t[0][1];return function(n){return null==n?false:n[r]===e&&(e!==m||r in zr(n))}}return function(n){return wt(n,t)}}function At(n,t){var r=Ti(n),e=Wr(n)&&t===t&&!ve(t),u=n+"";return n=Br(n),function(i){if(null==i)return false;var o=u;if(i=zr(i),!(!r&&e||o in i)){if(i=1==n.length?i:dt(i,Ct(n,0,-1)),null==i)return false;o=Vr(n),i=zr(i)}return i[o]===t?t!==m||o in i:mt(t,i[o],m,true)}}function jt(n,t,r,e,u){if(!ve(n))return n;var i=Ir(t)&&(Ti(t)||we(t)),o=i?null:Ki(t);
return Kn(o||t,function(f,l){if(o&&(l=f,f=t[l]),p(f)){e||(e=[]),u||(u=[]);n:{for(var a=l,c=e,s=u,h=c.length,_=t[a];h--;)if(c[h]==_){n[a]=s[h];break n}var h=n[a],v=r?r(h,_,a,n,t):m,g=v===m;g&&(v=_,Ir(_)&&(Ti(_)||we(_))?v=Ti(h)?h:Ir(h)?Dn(h):[]:Fi(_)||se(_)?v=se(h)?Ae(h):Fi(h)?h:{}:g=false),c.push(_),s.push(v),g?n[a]=jt(v,_,r,c,s):(v===v?v!==h:h===h)&&(n[a]=v)}}else a=n[l],c=r?r(a,f,l,n,t):m,(s=c===m)&&(c=f),c===m&&(!i||l in n)||!s&&(c===c?c===a:a!==a)||(n[l]=c)}),n}function kt(n){return function(t){return null==t?m:t[n];
}}function Ot(n){var t=n+"";return n=Br(n),function(r){return dt(r,n,t)}}function Rt(n,t){for(var r=n?t.length:0;r--;){var e=t[r];if(e!=u&&Er(e)){var u=e;yu.call(n,e,1)}}}function It(n,t){return n+su(Cu()*(t-n+1))}function Et(n,t,r,e,u){return u(n,function(n,u,i){r=e?(e=false,n):t(r,n,u,i)}),r}function Ct(n,t,r){var e=-1,u=n.length;for(t=null==t?0:+t||0,0>t&&(t=-t>u?0:u+t),r=r===m||r>u?u:+r||0,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Me(u);++e<u;)r[e]=n[e+t];return r}function Wt(n,t){var r;return Mu(n,function(n,e,u){
return r=t(n,e,u),!r}),!!r}function St(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].c;return n}function Tt(t,r,e){var u=mr(),i=-1;return r=Jn(r,function(n){return u(n)}),t=bt(t,function(n){return{a:Jn(r,function(t){return t(n)}),b:++i,c:n}}),St(t,function(t,r){var u;n:{u=-1;for(var i=t.a,o=r.a,f=i.length,l=e.length;++u<f;){var a=n(i[u],o[u]);if(a){u=u<l?a*(e[u]?1:-1):a;break n}}u=t.b-r.b}return u})}function Ut(n,t){var r=0;return Mu(n,function(n,e,u){r+=+t(n,e,u)||0}),r}function $t(n,t){var e=-1,u=br(),i=n.length,o=u==r,f=o&&200<=i,l=f?Vu():null,a=[];
l?(u=qn,o=false):(f=false,l=t?[]:a);n:for(;++e<i;){var c=n[e],s=t?t(c,e,n):c;if(o&&c===c){for(var p=l.length;p--;)if(l[p]===s)continue n;t&&l.push(s),a.push(c)}else 0>u(l,s,0)&&((t||f)&&l.push(s),a.push(c))}return a}function Ft(n,t){for(var r=-1,e=t.length,u=Me(e);++r<e;)u[r]=n[t[r]];return u}function Nt(n,t,r,e){for(var u=n.length,i=e?u:-1;(e?i--:++i<u)&&t(n[i],i,n););return r?Ct(n,e?0:i,e?i+1:u):Ct(n,e?i+1:0,e?u:i)}function Lt(n,t){var r=n;r instanceof Bn&&(r=r.value());for(var e=-1,u=t.length;++e<u;){
var r=[r],i=t[e];_u.apply(r,i.args),r=i.func.apply(i.thisArg,r)}return r}function zt(n,t,r){var e=0,u=n?n.length:e;if(typeof t=="number"&&t===t&&u<=Uu){for(;e<u;){var i=e+u>>>1,o=n[i];(r?o<=t:o<t)&&null!==o?e=i+1:u=i}return u}return Bt(n,t,Fe,r)}function Bt(n,t,r,e){t=r(t);for(var u=0,i=n?n.length:0,o=t!==t,f=null===t,l=t===m;u<i;){var a=su((u+i)/2),c=r(n[a]),s=c!==m,p=c===c;(o?p||e:f?p&&s&&(e||null!=c):l?p&&(e||s):null==c?0:e?c<=t:c<t)?u=a+1:i=a}return Ou(i,Tu)}function Mt(n,t,r){if(typeof n!="function")return Fe;
if(t===m)return n;switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)};case 5:return function(r,e,u,i,o){return n.call(t,r,e,u,i,o)}}return function(){return n.apply(t,arguments)}}function Pt(n){return lu.call(n,0)}function qt(n,t,r){for(var e=r.length,u=-1,i=ku(n.length-e,0),o=-1,f=t.length,l=Me(i+f);++o<f;)l[o]=t[o];for(;++u<e;)l[r[u]]=n[u];for(;i--;)l[o++]=n[u++];return l}function Dt(n,t,r){
for(var e=-1,u=r.length,i=-1,o=ku(n.length-u,0),f=-1,l=t.length,a=Me(o+l);++i<o;)a[i]=n[i];for(o=i;++f<l;)a[o+f]=t[f];for(;++e<u;)a[o+r[e]]=n[i++];return a}function Kt(n,t){return function(r,e,u){var i=t?t():{};if(e=mr(e,u,3),Ti(r)){u=-1;for(var o=r.length;++u<o;){var f=r[u];n(i,f,e(f,u,r),r)}}else Mu(r,function(t,r,u){n(i,t,e(t,r,u),u)});return i}}function Vt(n){return ae(function(t,r){var e=-1,u=null==t?0:r.length,i=2<u?r[u-2]:m,o=2<u?r[2]:m,f=1<u?r[u-1]:m;for(typeof i=="function"?(i=Mt(i,f,5),
u-=2):(i=typeof f=="function"?f:m,u-=i?1:0),o&&Cr(r[0],r[1],o)&&(i=3>u?m:i,u=1);++e<u;)(o=r[e])&&n(t,o,i);return t})}function Yt(n,t){return function(r,e){var u=r?Zu(r):0;if(!Tr(u))return n(r,e);for(var i=t?u:-1,o=zr(r);(t?i--:++i<u)&&false!==e(o[i],i,o););return r}}function Zt(n){return function(t,r,e){var u=zr(t);e=e(t);for(var i=e.length,o=n?i:-1;n?o--:++o<i;){var f=e[o];if(false===r(u[f],f,u))break}return t}}function Gt(n,t){function r(){return(this&&this!==Yn&&this instanceof r?e:n).apply(t,arguments);
}var e=Xt(n);return r}function Jt(n){return function(t){var r=-1;t=Te(Ie(t));for(var e=t.length,u="";++r<e;)u=n(u,t[r],r);return u}}function Xt(n){return function(){var t=arguments;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4])}var r=Bu(n.prototype),t=n.apply(r,t);return ve(t)?t:r}}function Ht(n){function t(r,e,u){return u&&Cr(r,e,u)&&(e=null),
r=vr(r,n,null,null,null,null,null,e),r.placeholder=t.placeholder,r}return t}function Qt(n,t){return function(r,e,u){if(u&&Cr(r,e,u)&&(e=null),e=mr(e,u,3),1==e.length){u=r=Lr(r);for(var i=e,o=-1,f=u.length,l=t,a=l;++o<f;){var c=u[o],s=+i(c);n(s,l)&&(l=s,a=c)}if(u=a,!r.length||u!==t)return u}return ct(r,e,n,t)}}function nr(n,r){return function(e,u,i){return u=mr(u,i,3),Ti(e)?(u=t(e,u,r),-1<u?e[u]:m):pt(e,u,n)}}function tr(n){return function(r,e,u){return r&&r.length?(e=mr(e,u,3),t(r,e,n)):-1}}function rr(n){
return function(t,r,e){return r=mr(r,e,3),pt(t,r,n,true)}}function er(n){return function(){for(var t,r=arguments.length,e=n?r:-1,u=0,i=Me(r);n?e--:++e<r;){var o=i[u++]=arguments[e];if(typeof o!="function")throw new Je(N);!t&&zn.prototype.thru&&"wrapper"==wr(o)&&(t=new zn([]))}for(e=t?-1:r;++e<r;){var o=i[e],u=wr(o),f="wrapper"==u?Yu(o):null;t=f&&Sr(f[0])&&f[1]==(I|j|O|E)&&!f[4].length&&1==f[9]?t[wr(f[0])].apply(t,f[3]):1==o.length&&Sr(o)?t[u]():t.thru(o)}return function(){var n=arguments;if(t&&1==n.length&&Ti(n[0]))return t.plant(n[0]).value();
for(var e=0,n=r?i[e].apply(this,n):n[0];++e<r;)n=i[e].call(this,n);return n}}}function ur(n,t){return function(r,e,u){return typeof e=="function"&&u===m&&Ti(r)?n(r,e):t(r,Mt(e,u,3))}}function ir(n){return function(t,r,e){return(typeof r!="function"||e!==m)&&(r=Mt(r,e,3)),n(t,r,ke)}}function or(n){return function(t,r,e){return(typeof r!="function"||e!==m)&&(r=Mt(r,e,3)),n(t,r)}}function fr(n){return function(t,r,e){var u={};return r=mr(r,e,3),vt(t,function(t,e,i){i=r(t,e,i),e=n?i:e,t=n?t:i,u[e]=t}),
u}}function lr(n){return function(t,r,e){return t=u(t),(n?t:"")+pr(t,r,e)+(n?"":t)}}function ar(n){var t=ae(function(r,e){var u=_(e,t.placeholder);return vr(r,n,null,e,u)});return t}function cr(n,t){return function(r,e,u,i){var o=3>arguments.length;return typeof e=="function"&&i===m&&Ti(r)?n(r,e,u,o):Et(r,mr(e,i,4),u,o,t)}}function sr(n,t,r,e,u,i,o,f,l,a){function c(){for(var w=arguments.length,A=w,j=Me(w);A--;)j[A]=arguments[A];if(e&&(j=qt(j,e,u)),i&&(j=Dt(j,i,o)),v||y){var A=c.placeholder,k=_(j,A),w=w-k.length;
if(w<a){var I=f?Dn(f):null,w=ku(a-w,0),E=v?k:null,k=v?null:k,C=v?j:null,j=v?null:j;return t|=v?O:R,t&=~(v?R:O),g||(t&=~(b|x)),j=[n,t,r,C,E,j,k,I,l,w],I=sr.apply(m,j),Sr(n)&&Gu(I,j),I.placeholder=A,I}}if(A=p?r:this,I=h?A[n]:n,f)for(w=j.length,E=Ou(f.length,w),k=Dn(j);E--;)C=f[E],j[E]=Er(C,w)?k[C]:m;return s&&l<j.length&&(j.length=l),this&&this!==Yn&&this instanceof c&&(I=d||Xt(n)),I.apply(A,j)}var s=t&I,p=t&b,h=t&x,v=t&j,g=t&A,y=t&k,d=h?null:Xt(n);return c}function pr(n,t,r){return n=n.length,t=+t,
n<t&&Au(t)?(t-=n,r=null==r?" ":r+"",We(r,au(t/r.length)).slice(0,t)):""}function hr(n,t,r,e){function u(){for(var t=-1,f=arguments.length,l=-1,a=e.length,c=Me(f+a);++l<a;)c[l]=e[l];for(;f--;)c[l++]=arguments[++t];return(this&&this!==Yn&&this instanceof u?o:n).apply(i?r:this,c)}var i=t&b,o=Xt(n);return u}function _r(n){return function(t,r,e,u){var i=mr(e);return null==e&&i===it?zt(t,r,n):Bt(t,r,i(e,u,1),n)}}function vr(n,t,r,e,u,i,o,f){var l=t&x;if(!l&&typeof n!="function")throw new Je(N);var a=e?e.length:0;
if(a||(t&=~(O|R),e=u=null),a-=u?u.length:0,t&R){var c=e,s=u;e=u=null}var p=l?null:Yu(n);return r=[n,t,r,e,u,c,s,i,o,f],p&&(e=r[1],t=p[1],f=e|t,u=t==I&&e==j||t==I&&e==E&&r[7].length<=p[8]||t==(I|E)&&e==j,(f<I||u)&&(t&b&&(r[2]=p[2],f|=e&b?0:A),(e=p[3])&&(u=r[3],r[3]=u?qt(u,e,p[4]):Dn(e),r[4]=u?_(r[3],L):Dn(p[4])),(e=p[5])&&(u=r[5],r[5]=u?Dt(u,e,p[6]):Dn(e),r[6]=u?_(r[5],L):Dn(p[6])),(e=p[7])&&(r[7]=Dn(e)),t&I&&(r[8]=null==r[8]?p[8]:Ou(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=f),t=r[1],f=r[9]),
r[9]=null==f?l?0:n.length:ku(f-a,0)||0,(p?Ku:Gu)(t==b?Gt(r[0],r[2]):t!=O&&t!=(b|O)||r[4].length?sr.apply(m,r):hr.apply(m,r),r)}function gr(n,t,r,e,u,i,o){var f=-1,l=n.length,a=t.length;if(l!=a&&(!u||a<=l))return false;for(;++f<l;){var c=n[f],a=t[f],s=e?e(u?a:c,u?c:a,f):m;if(s!==m){if(s)continue;return false}if(u){if(!Hn(t,function(n){return c===n||r(c,n,e,u,i,o)}))return false}else if(c!==a&&!r(c,a,e,u,i,o))return false}return true}function yr(n,t,r){switch(r){case M:case P:return+n==+t;case q:return n.name==t.name&&n.message==t.message;
case K:return n!=+n?t!=+t:n==+t;case Y:case Z:return n==t+""}return false}function dr(n,t,r,e,u,i,o){var f=Ki(n),l=f.length,a=Ki(t).length;if(l!=a&&!u)return false;for(a=l;a--;){var c=f[a];if(!(u?c in t:ru.call(t,c)))return false}for(var s=u;++a<l;){var c=f[a],p=n[c],h=t[c],_=e?e(u?h:p,u?p:h,c):m;if(_===m?!r(p,h,e,u,i,o):!_)return false;s||(s="constructor"==c)}return s||(r=n.constructor,e=t.constructor,!(r!=e&&"constructor"in n&&"constructor"in t)||typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)?true:false;
}function mr(n,t,r){var e=Nn.callback||Ue,e=e===Ue?it:e;return r?e(n,t,r):e}function wr(n){for(var t=n.name,r=Lu[t],e=r?r.length:0;e--;){var u=r[e],i=u.func;if(null==i||i==n)return u.name}return t}function br(n,t,e){var u=Nn.indexOf||Kr,u=u===Kr?r:u;return n?u(n,t,e):u}function xr(n){n=Oe(n);for(var t=n.length;t--;){var r=n[t][1];n[t][2]=r===r&&!ve(r)}return n}function Ar(n,t){var r=null==n?m:n[t];return ge(r)?r:m}function jr(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&ru.call(n,"index")&&(r.index=n.index,
r.input=n.input),r}function kr(n){return n=n.constructor,typeof n=="function"&&n instanceof n||(n=Ye),new n}function Or(n,t,r){var e=n.constructor;switch(t){case G:return Pt(n);case M:case P:return new e(+n);case J:case X:case H:case Q:case nn:case tn:case rn:case en:case un:return t=n.buffer,new e(r?Pt(t):t,n.byteOffset,n.length);case K:case Z:return new e(n);case Y:var u=new e(n.source,jn.exec(n));u.lastIndex=n.lastIndex}return u}function Rr(n,t,r){return null==n||Wr(t,n)||(t=Br(t),n=1==t.length?n:dt(n,Ct(t,0,-1)),
t=Vr(t)),t=null==n?n:n[t],null==t?m:t.apply(n,r)}function Ir(n){return null!=n&&Tr(Zu(n))}function Er(n,t){return n=typeof n=="number"||Rn.test(n)?+n:-1,t=null==t?Fu:t,-1<n&&0==n%1&&n<t}function Cr(n,t,r){if(!ve(r))return false;var e=typeof t;return("number"==e?Ir(r)&&Er(t,r.length):"string"==e&&t in r)?(t=r[t],n===n?n===t:t!==t):false}function Wr(n,t){var r=typeof n;return"string"==r&&yn.test(n)||"number"==r?true:Ti(n)?false:!gn.test(n)||null!=t&&n in zr(t)}function Sr(n){var t=wr(n);return t in Bn.prototype?(t=Nn[t],
n===t?true:(t=Yu(t),!!t&&n===t[0])):false}function Tr(n){return typeof n=="number"&&-1<n&&0==n%1&&n<=Fu}function Ur(n,t){n=zr(n);for(var r=-1,e=t.length,u={};++r<e;){var i=t[r];i in n&&(u[i]=n[i])}return u}function $r(n,t){var r={};return _t(n,function(n,e,u){t(n,e,u)&&(r[e]=n)}),r}function Fr(n){var t;if(!p(n)||uu.call(n)!=V||!(ru.call(n,"constructor")||(t=n.constructor,typeof t!="function"||t instanceof t)))return false;var r;return _t(n,function(n,t){r=t}),r===m||ru.call(n,r)}function Nr(n){for(var t=ke(n),r=t.length,e=r&&n.length,u=!!e&&Tr(e)&&(Ti(n)||se(n)),i=-1,o=[];++i<r;){
var f=t[i];(u&&Er(f,e)||ru.call(n,f))&&o.push(f)}return o}function Lr(n){return null==n?[]:Ir(n)?ve(n)?n:Ye(n):Re(n)}function zr(n){return ve(n)?n:Ye(n)}function Br(n){if(Ti(n))return n;var t=[];return u(n).replace(dn,function(n,r,e,u){t.push(e?u.replace(xn,"$1"):r||n)}),t}function Mr(n){return n instanceof Bn?n.clone():new zn(n.__wrapped__,n.__chain__,Dn(n.__actions__))}function Pr(n,t,r){return n&&n.length?((r?Cr(n,t,r):null==t)&&(t=1),Ct(n,0>t?0:t)):[]}function qr(n,t,r){var e=n?n.length:0;return e?((r?Cr(n,t,r):null==t)&&(t=1),
t=e-(+t||0),Ct(n,0,0>t?0:t)):[]}function Dr(n){return n?n[0]:m}function Kr(n,t,e){var u=n?n.length:0;if(!u)return-1;if(typeof e=="number")e=0>e?ku(u+e,0):e;else if(e)return e=zt(n,t),n=n[e],(t===t?t===n:n!==n)?e:-1;return r(n,t,e||0)}function Vr(n){var t=n?n.length:0;return t?n[t-1]:m}function Yr(n){return Pr(n,1)}function Zr(n,t,e,u){if(!n||!n.length)return[];null!=t&&typeof t!="boolean"&&(u=e,e=Cr(n,t,u)?null:t,t=false);var i=mr();if((null!=e||i!==it)&&(e=i(e,u,3)),t&&br()==r){t=e;var o;e=-1,u=n.length;
for(var i=-1,f=[];++e<u;){var l=n[e],a=t?t(l,e,n):l;e&&o===a||(o=a,f[++i]=l)}n=f}else n=$t(n,e);return n}function Gr(n){if(!n||!n.length)return[];var t=-1,r=0;n=Gn(n,function(n){return Ir(n)?(r=ku(n.length,r),true):void 0});for(var e=Me(r);++t<r;)e[t]=Jn(n,kt(t));return e}function Jr(n,t,r){return n&&n.length?(n=Gr(n),null==t?n:(t=Mt(t,r,4),Jn(n,function(n){return Xn(n,t,m,true)}))):[]}function Xr(n,t){var r=-1,e=n?n.length:0,u={};for(!e||t||Ti(n[0])||(t=[]);++r<e;){var i=n[r];t?u[i]=t[r]:i&&(u[i[0]]=i[1]);
}return u}function Hr(n){return n=Nn(n),n.__chain__=true,n}function Qr(n,t,r){return t.call(r,n)}function ne(n,t,r){var e=Ti(n)?Vn:at;return r&&Cr(n,t,r)&&(t=null),(typeof t!="function"||r!==m)&&(t=mr(t,r,3)),e(n,t)}function te(n,t,r){var e=Ti(n)?Gn:st;return t=mr(t,r,3),e(n,t)}function re(n,t,r,e){var u=n?Zu(n):0;return Tr(u)||(n=Re(n),u=n.length),u?(r=typeof r!="number"||e&&Cr(t,r,e)?0:0>r?ku(u+r,0):r||0,typeof n=="string"||!Ti(n)&&me(n)?r<u&&-1<n.indexOf(t,r):-1<br(n,t,r)):false}function ee(n,t,r){
var e=Ti(n)?Jn:bt;return t=mr(t,r,3),e(n,t)}function ue(n,t,r){if(r?Cr(n,t,r):null==t){n=Lr(n);var e=n.length;return 0<e?n[It(0,e-1)]:m}r=-1,n=xe(n);var e=n.length,u=e-1;for(t=Ou(0>t?0:+t||0,e);++r<t;){var e=It(r,u),i=n[e];n[e]=n[r],n[r]=i}return n.length=t,n}function ie(n,t,r){var e=Ti(n)?Hn:Wt;return r&&Cr(n,t,r)&&(t=null),(typeof t!="function"||r!==m)&&(t=mr(t,r,3)),e(n,t)}function oe(n,t){var r;if(typeof t!="function"){if(typeof n!="function")throw new Je(N);var e=n;n=t,t=e}return function(){
return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=null),r}}function fe(n,t,r){function e(){var r=t-(wi()-a);0>=r||r>t?(f&&cu(f),r=p,f=s=p=m,r&&(h=wi(),l=n.apply(c,o),s||f||(o=c=null))):s=gu(e,r)}function u(){s&&cu(s),f=s=p=m,(v||_!==t)&&(h=wi(),l=n.apply(c,o),s||f||(o=c=null))}function i(){if(o=arguments,a=wi(),c=this,p=v&&(s||!g),false===_)var r=g&&!s;else{f||g||(h=a);var i=_-(a-h),y=0>=i||i>_;y?(f&&(f=cu(f)),h=a,l=n.apply(c,o)):f||(f=gu(u,i))}return y&&s?s=cu(s):s||t===_||(s=gu(e,t)),r&&(y=true,l=n.apply(c,o)),
!y||s||f||(o=c=null),l}var o,f,l,a,c,s,p,h=0,_=false,v=true;if(typeof n!="function")throw new Je(N);if(t=0>t?0:+t||0,true===r)var g=true,v=false;else ve(r)&&(g=r.leading,_="maxWait"in r&&ku(+r.maxWait||0,t),v="trailing"in r?r.trailing:v);return i.cancel=function(){s&&cu(s),f&&cu(f),f=s=p=m},i}function le(n,t){function r(){var e=arguments,u=t?t.apply(this,e):e[0],i=r.cache;return i.has(u)?i.get(u):(e=n.apply(this,e),r.cache=i.set(u,e),e)}if(typeof n!="function"||t&&typeof t!="function")throw new Je(N);return r.cache=new le.Cache,
r}function ae(n,t){if(typeof n!="function")throw new Je(N);return t=ku(t===m?n.length-1:+t||0,0),function(){for(var r=arguments,e=-1,u=ku(r.length-t,0),i=Me(u);++e<u;)i[e]=r[t+e];switch(t){case 0:return n.call(this,i);case 1:return n.call(this,r[0],i);case 2:return n.call(this,r[0],r[1],i)}for(u=Me(t+1),e=-1;++e<t;)u[e]=r[e];return u[t]=i,n.apply(this,u)}}function ce(n,t){return n>t}function se(n){return p(n)&&Ir(n)&&uu.call(n)==z}function pe(n){return!!n&&1===n.nodeType&&p(n)&&-1<uu.call(n).indexOf("Element");
}function he(n,t,r,e){return e=(r=typeof r=="function"?Mt(r,e,3):m)?r(n,t):m,e===m?mt(n,t,r):!!e}function _e(n){return p(n)&&typeof n.message=="string"&&uu.call(n)==q}function ve(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function ge(n){return null==n?false:uu.call(n)==D?ou.test(tu.call(n)):p(n)&&On.test(n)}function ye(n){return typeof n=="number"||p(n)&&uu.call(n)==K}function de(n){return p(n)&&uu.call(n)==Y}function me(n){return typeof n=="string"||p(n)&&uu.call(n)==Z}function we(n){return p(n)&&Tr(n.length)&&!!Un[uu.call(n)];
}function be(n,t){return n<t}function xe(n){var t=n?Zu(n):0;return Tr(t)?t?Dn(n):[]:Re(n)}function Ae(n){return ut(n,ke(n))}function je(n){return yt(n,ke(n))}function ke(n){if(null==n)return[];ve(n)||(n=Ye(n));for(var t=n.length,t=t&&Tr(t)&&(Ti(n)||se(n))&&t||0,r=n.constructor,e=-1,r=typeof r=="function"&&r.prototype===n,u=Me(t),i=0<t;++e<t;)u[e]=e+"";for(var o in n)i&&Er(o,t)||"constructor"==o&&(r||!ru.call(n,o))||u.push(o);return u}function Oe(n){n=zr(n);for(var t=-1,r=Ki(n),e=r.length,u=Me(e);++t<e;){
var i=r[t];u[t]=[i,n[i]]}return u}function Re(n){return Ft(n,Ki(n))}function Ie(n){return(n=u(n))&&n.replace(In,l).replace(bn,"")}function Ee(n){return(n=u(n))&&wn.test(n)?n.replace(mn,"\\$&"):n}function Ce(n,t,r){return r&&Cr(n,t,r)&&(t=0),Eu(n,t)}function We(n,t){var r="";if(n=u(n),t=+t,1>t||!n||!Au(t))return r;do t%2&&(r+=n),t=su(t/2),n+=n;while(t);return r}function Se(n,t,r){var e=n;return(n=u(n))?(r?Cr(e,t,r):null==t)?n.slice(v(n),g(n)+1):(t+="",n.slice(i(n,t),o(n,t)+1)):n}function Te(n,t,r){
return r&&Cr(n,t,r)&&(t=null),n=u(n),n.match(t||Wn)||[]}function Ue(n,t,r){return r&&Cr(n,t,r)&&(t=null),p(n)?Ne(n):it(n,t)}function $e(n){return function(){return n}}function Fe(n){return n}function Ne(n){return xt(ot(n,true))}function Le(n,t,r){if(null==r){var e=ve(t),u=e?Ki(t):null;((u=u&&u.length?yt(t,u):null)?u.length:e)||(u=false,r=t,t=n,n=this)}u||(u=yt(t,Ki(t)));var i=true,e=-1,o=$i(n),f=u.length;false===r?i=false:ve(r)&&"chain"in r&&(i=r.chain);for(;++e<f;){r=u[e];var l=t[r];n[r]=l,o&&(n.prototype[r]=function(t){
return function(){var r=this.__chain__;if(i||r){var e=n(this.__wrapped__);return(e.__actions__=Dn(this.__actions__)).push({func:t,args:arguments,thisArg:n}),e.__chain__=r,e}return r=[this.value()],_u.apply(r,arguments),t.apply(n,r)}}(l))}return n}function ze(){}function Be(n){return Wr(n)?kt(n):Ot(n)}h=h?Zn.defaults(Yn.Object(),h,Zn.pick(Yn,Tn)):Yn;var Me=h.Array,Pe=h.Date,qe=h.Error,De=h.Function,Ke=h.Math,Ve=h.Number,Ye=h.Object,Ze=h.RegExp,Ge=h.String,Je=h.TypeError,Xe=Me.prototype,He=Ye.prototype,Qe=Ge.prototype,nu=(nu=h.window)?nu.document:null,tu=De.prototype.toString,ru=He.hasOwnProperty,eu=0,uu=He.toString,iu=h._,ou=Ze("^"+Ee(tu.call(ru)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fu=Ar(h,"ArrayBuffer"),lu=Ar(fu&&new fu(0),"slice"),au=Ke.ceil,cu=h.clearTimeout,su=Ke.floor,pu=Ar(Ye,"getPrototypeOf"),hu=h.parseFloat,_u=Xe.push,vu=Ar(h,"Set"),gu=h.setTimeout,yu=Xe.splice,du=Ar(h,"Uint8Array"),mu=Ar(h,"WeakMap"),wu=function(){
try{var n=Ar(h,"Float64Array"),t=new n(new fu(10),0,1)&&n}catch(r){}return t||null}(),bu=Ar(Ye,"create"),xu=Ar(Me,"isArray"),Au=h.isFinite,ju=Ar(Ye,"keys"),ku=Ke.max,Ou=Ke.min,Ru=Ar(Pe,"now"),Iu=Ar(Ve,"isFinite"),Eu=h.parseInt,Cu=Ke.random,Wu=Ve.NEGATIVE_INFINITY,Su=Ve.POSITIVE_INFINITY,Tu=4294967294,Uu=2147483647,$u=wu?wu.BYTES_PER_ELEMENT:0,Fu=9007199254740991,Nu=mu&&new mu,Lu={},zu=Nn.support={};!function(n){function t(){this.x=n}var r=[];t.prototype={valueOf:n,y:n};for(var e in new t)r.push(e);
try{zu.dom=11===nu.createDocumentFragment().nodeType}catch(u){zu.dom=false}}(1,0),Nn.templateSettings={escape:hn,evaluate:_n,interpolate:vn,variable:"",imports:{_:Nn}};var Bu=function(){function n(){}return function(t){if(ve(t)){n.prototype=t;var r=new n;n.prototype=null}return r||{}}}(),Mu=Yt(vt),Pu=Yt(gt,true),qu=Zt(),Du=Zt(true),Ku=Nu?function(n,t){return Nu.set(n,t),n}:Fe;lu||(Pt=fu&&du?function(n){var t=n.byteLength,r=wu?su(t/$u):0,e=r*$u,u=new fu(t);if(r){var i=new wu(u,0,r);i.set(new wu(n,0,r))}return t!=e&&(i=new du(u,e),
i.set(new du(n,e))),u}:$e(null));var Vu=bu&&vu?function(n){return new Pn(n)}:$e(null),Yu=Nu?function(n){return Nu.get(n)}:ze,Zu=kt("length"),Gu=function(){var n=0,t=0;return function(r,e){var u=wi(),i=T-(u-t);if(t=u,0<i){if(++n>=S)return r}else n=0;return Ku(r,e)}}(),Ju=ae(function(n,t){return Ir(n)?lt(n,ht(t,false,true)):[]}),Xu=tr(),Hu=tr(true),Qu=ae(function(n){for(var t=n.length,e=t,u=Me(c),i=br(),o=i==r,f=[];e--;){var l=n[e]=Ir(l=n[e])?l:[];u[e]=o&&120<=l.length?Vu(e&&l):null}var o=n[0],a=-1,c=o?o.length:0,s=u[0];
n:for(;++a<c;)if(l=o[a],0>(s?qn(s,l):i(f,l,0))){for(e=t;--e;){var p=u[e];if(0>(p?qn(p,l):i(n[e],l,0)))continue n}s&&s.push(l),f.push(l)}return f}),ni=ae(function(t,r){r=ht(r);var e=et(t,r);return Rt(t,r.sort(n)),e}),ti=_r(),ri=_r(true),ei=ae(function(n){return $t(ht(n,false,true))}),ui=ae(function(n,t){return Ir(n)?lt(n,t):[]}),ii=ae(Gr),oi=ae(function(n){var t=n.length,r=2<t?n[t-2]:m,e=1<t?n[t-1]:m;return 2<t&&typeof r=="function"?t-=2:(r=1<t&&typeof e=="function"?(--t,e):m,e=m),n.length=t,Jr(n,r,e)}),fi=ae(function(n,t){
return et(n,ht(t))}),li=Kt(function(n,t,r){ru.call(n,r)?++n[r]:n[r]=1}),ai=nr(Mu),ci=nr(Pu,true),si=ur(Kn,Mu),pi=ur(function(n,t){for(var r=n.length;r--&&false!==t(n[r],r,n););return n},Pu),hi=Kt(function(n,t,r){ru.call(n,r)?n[r].push(t):n[r]=[t]}),_i=Kt(function(n,t,r){n[r]=t}),vi=ae(function(n,t,r){var e=-1,u=typeof t=="function",i=Wr(t),o=Ir(n)?Me(n.length):[];return Mu(n,function(n){var f=u?t:i&&null!=n?n[t]:null;o[++e]=f?f.apply(n,r):Rr(n,t,r)}),o}),gi=Kt(function(n,t,r){n[r?0:1].push(t)},function(){
return[[],[]]}),yi=cr(Xn,Mu),di=cr(function(n,t,r,e){var u=n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r},Pu),mi=ae(function(n,t){if(null==n)return[];var r=t[2];return r&&Cr(t[0],t[1],r)&&(t.length=1),Tt(n,ht(t),[])}),wi=Ru||function(){return(new Pe).getTime()},bi=ae(function(n,t,r){var e=b;if(r.length)var u=_(r,bi.placeholder),e=e|O;return vr(n,e,t,r,u)}),xi=ae(function(n,t){t=t.length?ht(t):je(n);for(var r=-1,e=t.length;++r<e;){var u=t[r];n[u]=vr(n[u],b,n)}return n}),Ai=ae(function(n,t,r){
var e=b|x;if(r.length)var u=_(r,Ai.placeholder),e=e|O;return vr(t,e,n,r,u)}),ji=Ht(j),ki=Ht(k),Oi=ae(function(n,t){return ft(n,1,t)}),Ri=ae(function(n,t,r){return ft(n,t,r)}),Ii=er(),Ei=er(true),Ci=ar(O),Wi=ar(R),Si=ae(function(n,t){return vr(n,E,null,null,null,ht(t))}),Ti=xu||function(n){return p(n)&&Tr(n.length)&&uu.call(n)==B};zu.dom||(pe=function(n){return!!n&&1===n.nodeType&&p(n)&&!Fi(n)});var Ui=Iu||function(n){return typeof n=="number"&&Au(n)},$i=e(/x/)||du&&!e(du)?function(n){return uu.call(n)==D;
}:e,Fi=pu?function(n){if(!n||uu.call(n)!=V)return false;var t=Ar(n,"valueOf"),r=t&&(r=pu(t))&&pu(r);return r?n==r||pu(n)==r:Fr(n)}:Fr,Ni=Vt(function(n,t,r){return r?tt(n,t,r):rt(n,t)}),Li=ae(function(n){var t=n[0];return null==t?t:(n.push(Qn),Ni.apply(m,n))}),zi=rr(vt),Bi=rr(gt),Mi=ir(qu),Pi=ir(Du),qi=or(vt),Di=or(gt),Ki=ju?function(n){var t=null==n?null:n.constructor;return typeof t=="function"&&t.prototype===n||typeof n!="function"&&Ir(n)?Nr(n):ve(n)?ju(n):[]}:Nr,Vi=fr(true),Yi=fr(),Zi=Vt(jt),Gi=ae(function(n,t){
if(null==n)return{};if("function"!=typeof t[0])return t=Jn(ht(t),Ge),Ur(n,lt(ke(n),t));var r=Mt(t[0],t[1],3);return $r(n,function(n,t,e){return!r(n,t,e)})}),Ji=ae(function(n,t){return null==n?{}:"function"==typeof t[0]?$r(n,Mt(t[0],t[1],3)):Ur(n,ht(t))}),Xi=Jt(function(n,t,r){return t=t.toLowerCase(),n+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),Hi=Jt(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),Qi=lr(),no=lr(true);8!=Eu(Sn+"08")&&(Ce=function(n,t,r){return(r?Cr(n,t,r):null==t)?t=0:t&&(t=+t),
n=Se(n),Eu(n,t||(kn.test(n)?16:10))});var to=Jt(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),ro=Jt(function(n,t,r){return n+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),eo=ae(function(n,t){try{return n.apply(m,t)}catch(r){return _e(r)?r:new qe(r)}}),uo=ae(function(n,t){return function(r){return Rr(r,n,t)}}),io=ae(function(n,t){return function(r){return Rr(n,r,t)}}),oo=Qt(ce,Wu),fo=Qt(be,Su);return Nn.prototype=Ln.prototype,zn.prototype=Bu(Ln.prototype),zn.prototype.constructor=zn,
Bn.prototype=Bu(Ln.prototype),Bn.prototype.constructor=Bn,Mn.prototype["delete"]=function(n){return this.has(n)&&delete this.__data__[n]},Mn.prototype.get=function(n){return"__proto__"==n?m:this.__data__[n]},Mn.prototype.has=function(n){return"__proto__"!=n&&ru.call(this.__data__,n)},Mn.prototype.set=function(n,t){return"__proto__"!=n&&(this.__data__[n]=t),this},Pn.prototype.push=function(n){var t=this.data;typeof n=="string"||ve(n)?t.set.add(n):t.hash[n]=true},le.Cache=Mn,Nn.after=function(n,t){if(typeof t!="function"){
if(typeof n!="function")throw new Je(N);var r=n;n=t,t=r}return n=Au(n=+n)?n:0,function(){return 1>--n?t.apply(this,arguments):void 0}},Nn.ary=function(n,t,r){return r&&Cr(n,t,r)&&(t=null),t=n&&null==t?n.length:ku(+t||0,0),vr(n,I,null,null,null,null,t)},Nn.assign=Ni,Nn.at=fi,Nn.before=oe,Nn.bind=bi,Nn.bindAll=xi,Nn.bindKey=Ai,Nn.callback=Ue,Nn.chain=Hr,Nn.chunk=function(n,t,r){t=(r?Cr(n,t,r):null==t)?1:ku(+t||1,1),r=0;for(var e=n?n.length:0,u=-1,i=Me(au(e/t));r<e;)i[++u]=Ct(n,r,r+=t);return i},Nn.compact=function(n){
for(var t=-1,r=n?n.length:0,e=-1,u=[];++t<r;){var i=n[t];i&&(u[++e]=i)}return u},Nn.constant=$e,Nn.countBy=li,Nn.create=function(n,t,r){var e=Bu(n);return r&&Cr(n,t,r)&&(t=null),t?rt(e,t):e},Nn.curry=ji,Nn.curryRight=ki,Nn.debounce=fe,Nn.defaults=Li,Nn.defer=Oi,Nn.delay=Ri,Nn.difference=Ju,Nn.drop=Pr,Nn.dropRight=qr,Nn.dropRightWhile=function(n,t,r){return n&&n.length?Nt(n,mr(t,r,3),true,true):[]},Nn.dropWhile=function(n,t,r){return n&&n.length?Nt(n,mr(t,r,3),true):[]},Nn.fill=function(n,t,r,e){var u=n?n.length:0;
if(!u)return[];for(r&&typeof r!="number"&&Cr(n,t,r)&&(r=0,e=u),u=n.length,r=null==r?0:+r||0,0>r&&(r=-r>u?0:u+r),e=e===m||e>u?u:+e||0,0>e&&(e+=u),u=r>e?0:e>>>0,r>>>=0;r<u;)n[r++]=t;return n},Nn.filter=te,Nn.flatten=function(n,t,r){var e=n?n.length:0;return r&&Cr(n,t,r)&&(t=false),e?ht(n,t):[]},Nn.flattenDeep=function(n){return n&&n.length?ht(n,true):[]},Nn.flow=Ii,Nn.flowRight=Ei,Nn.forEach=si,Nn.forEachRight=pi,Nn.forIn=Mi,Nn.forInRight=Pi,Nn.forOwn=qi,Nn.forOwnRight=Di,Nn.functions=je,Nn.groupBy=hi,Nn.indexBy=_i,
Nn.initial=function(n){return qr(n,1)},Nn.intersection=Qu,Nn.invert=function(n,t,r){r&&Cr(n,t,r)&&(t=null),r=-1;for(var e=Ki(n),u=e.length,i={};++r<u;){var o=e[r],f=n[o];t?ru.call(i,f)?i[f].push(o):i[f]=[o]:i[f]=o}return i},Nn.invoke=vi,Nn.keys=Ki,Nn.keysIn=ke,Nn.map=ee,Nn.mapKeys=Vi,Nn.mapValues=Yi,Nn.matches=Ne,Nn.matchesProperty=function(n,t){return At(n,ot(t,true))},Nn.memoize=le,Nn.merge=Zi,Nn.method=uo,Nn.methodOf=io,Nn.mixin=Le,Nn.negate=function(n){if(typeof n!="function")throw new Je(N);return function(){
return!n.apply(this,arguments)}},Nn.omit=Gi,Nn.once=function(n){return oe(2,n)},Nn.pairs=Oe,Nn.partial=Ci,Nn.partialRight=Wi,Nn.partition=gi,Nn.pick=Ji,Nn.pluck=function(n,t){return ee(n,Be(t))},Nn.property=Be,Nn.propertyOf=function(n){return function(t){return dt(n,Br(t),t+"")}},Nn.pull=function(){var n=arguments,t=n[0];if(!t||!t.length)return t;for(var r=0,e=br(),u=n.length;++r<u;)for(var i=0,o=n[r];-1<(i=e(t,o,i));)yu.call(t,i,1);return t},Nn.pullAt=ni,Nn.range=function(n,t,r){r&&Cr(n,t,r)&&(t=r=null),
n=+n||0,r=null==r?1:+r||0,null==t?(t=n,n=0):t=+t||0;var e=-1;t=ku(au((t-n)/(r||1)),0);for(var u=Me(t);++e<t;)u[e]=n,n+=r;return u},Nn.rearg=Si,Nn.reject=function(n,t,r){var e=Ti(n)?Gn:st;return t=mr(t,r,3),e(n,function(n,r,e){return!t(n,r,e)})},Nn.remove=function(n,t,r){var e=[];if(!n||!n.length)return e;var u=-1,i=[],o=n.length;for(t=mr(t,r,3);++u<o;)r=n[u],t(r,u,n)&&(e.push(r),i.push(u));return Rt(n,i),e},Nn.rest=Yr,Nn.restParam=ae,Nn.set=function(n,t,r){if(null==n)return n;var e=t+"";t=null!=n[e]||Wr(t,n)?[e]:Br(t);
for(var e=-1,u=t.length,i=u-1,o=n;null!=o&&++e<u;){var f=t[e];ve(o)&&(e==i?o[f]=r:null==o[f]&&(o[f]=Er(t[e+1])?[]:{})),o=o[f]}return n},Nn.shuffle=function(n){return ue(n,Su)},Nn.slice=function(n,t,r){var e=n?n.length:0;return e?(r&&typeof r!="number"&&Cr(n,t,r)&&(t=0,r=e),Ct(n,t,r)):[]},Nn.sortBy=function(n,t,r){if(null==n)return[];r&&Cr(n,t,r)&&(t=null);var e=-1;return t=mr(t,r,3),n=bt(n,function(n,r,u){return{a:t(n,r,u),b:++e,c:n}}),St(n,f)},Nn.sortByAll=mi,Nn.sortByOrder=function(n,t,r,e){return null==n?[]:(e&&Cr(t,r,e)&&(r=null),
Ti(t)||(t=null==t?[]:[t]),Ti(r)||(r=null==r?[]:[r]),Tt(n,t,r))},Nn.spread=function(n){if(typeof n!="function")throw new Je(N);return function(t){return n.apply(this,t)}},Nn.take=function(n,t,r){return n&&n.length?((r?Cr(n,t,r):null==t)&&(t=1),Ct(n,0,0>t?0:t)):[]},Nn.takeRight=function(n,t,r){var e=n?n.length:0;return e?((r?Cr(n,t,r):null==t)&&(t=1),t=e-(+t||0),Ct(n,0>t?0:t)):[]},Nn.takeRightWhile=function(n,t,r){return n&&n.length?Nt(n,mr(t,r,3),false,true):[]},Nn.takeWhile=function(n,t,r){return n&&n.length?Nt(n,mr(t,r,3)):[];
},Nn.tap=function(n,t,r){return t.call(r,n),n},Nn.throttle=function(n,t,r){var e=true,u=true;if(typeof n!="function")throw new Je(N);return false===r?e=false:ve(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),Fn.leading=e,Fn.maxWait=+t,Fn.trailing=u,fe(n,t,Fn)},Nn.thru=Qr,Nn.times=function(n,t,r){if(n=su(n),1>n||!Au(n))return[];var e=-1,u=Me(Ou(n,4294967295));for(t=Mt(t,r,1);++e<n;)4294967295>e?u[e]=t(e):t(e);return u},Nn.toArray=xe,Nn.toPlainObject=Ae,Nn.transform=function(n,t,r,e){var u=Ti(n)||we(n);
return t=mr(t,e,4),null==r&&(u||ve(n)?(e=n.constructor,r=u?Ti(n)?new e:[]:Bu($i(e)?e.prototype:null)):r={}),(u?Kn:vt)(n,function(n,e,u){return t(r,n,e,u)}),r},Nn.union=ei,Nn.uniq=Zr,Nn.unzip=Gr,Nn.unzipWith=Jr,Nn.values=Re,Nn.valuesIn=function(n){return Ft(n,ke(n))},Nn.where=function(n,t){return te(n,xt(t))},Nn.without=ui,Nn.wrap=function(n,t){return t=null==t?Fe:t,vr(t,O,null,[n],[])},Nn.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var r=arguments[n];if(Ir(r))var e=e?lt(e,r).concat(lt(r,e)):r;
}return e?$t(e):[]},Nn.zip=ii,Nn.zipObject=Xr,Nn.zipWith=oi,Nn.backflow=Ei,Nn.collect=ee,Nn.compose=Ei,Nn.each=si,Nn.eachRight=pi,Nn.extend=Ni,Nn.iteratee=Ue,Nn.methods=je,Nn.object=Xr,Nn.select=te,Nn.tail=Yr,Nn.unique=Zr,Le(Nn,Nn),Nn.add=function(n,t){return(+n||0)+(+t||0)},Nn.attempt=eo,Nn.camelCase=Xi,Nn.capitalize=function(n){return(n=u(n))&&n.charAt(0).toUpperCase()+n.slice(1)},Nn.clone=function(n,t,r,e){return t&&typeof t!="boolean"&&Cr(n,t,r)?t=false:typeof t=="function"&&(e=r,r=t,t=false),typeof r=="function"?ot(n,t,Mt(r,e,1)):ot(n,t);
},Nn.cloneDeep=function(n,t,r){return typeof t=="function"?ot(n,true,Mt(t,r,1)):ot(n,true)},Nn.deburr=Ie,Nn.endsWith=function(n,t,r){n=u(n),t+="";var e=n.length;return r=r===m?e:Ou(0>r?0:+r||0,e),r-=t.length,0<=r&&n.indexOf(t,r)==r},Nn.escape=function(n){return(n=u(n))&&pn.test(n)?n.replace(cn,a):n},Nn.escapeRegExp=Ee,Nn.every=ne,Nn.find=ai,Nn.findIndex=Xu,Nn.findKey=zi,Nn.findLast=ci,Nn.findLastIndex=Hu,Nn.findLastKey=Bi,Nn.findWhere=function(n,t){return ai(n,xt(t))},Nn.first=Dr,Nn.get=function(n,t,r){
return n=null==n?m:dt(n,Br(t),t+""),n===m?r:n},Nn.gt=ce,Nn.gte=function(n,t){return n>=t},Nn.has=function(n,t){if(null==n)return false;var r=ru.call(n,t);if(!r&&!Wr(t)){if(t=Br(t),n=1==t.length?n:dt(n,Ct(t,0,-1)),null==n)return false;t=Vr(t),r=ru.call(n,t)}return r||Tr(n.length)&&Er(t,n.length)&&(Ti(n)||se(n))},Nn.identity=Fe,Nn.includes=re,Nn.indexOf=Kr,Nn.inRange=function(n,t,r){return t=+t||0,"undefined"===typeof r?(r=t,t=0):r=+r||0,n>=Ou(t,r)&&n<ku(t,r)},Nn.isArguments=se,Nn.isArray=Ti,Nn.isBoolean=function(n){
return true===n||false===n||p(n)&&uu.call(n)==M},Nn.isDate=function(n){return p(n)&&uu.call(n)==P},Nn.isElement=pe,Nn.isEmpty=function(n){return null==n?true:Ir(n)&&(Ti(n)||me(n)||se(n)||p(n)&&$i(n.splice))?!n.length:!Ki(n).length},Nn.isEqual=he,Nn.isError=_e,Nn.isFinite=Ui,Nn.isFunction=$i,Nn.isMatch=function(n,t,r,e){return r=typeof r=="function"?Mt(r,e,3):m,wt(n,xr(t),r)},Nn.isNaN=function(n){return ye(n)&&n!=+n},Nn.isNative=ge,Nn.isNull=function(n){return null===n},Nn.isNumber=ye,Nn.isObject=ve,Nn.isPlainObject=Fi,
Nn.isRegExp=de,Nn.isString=me,Nn.isTypedArray=we,Nn.isUndefined=function(n){return n===m},Nn.kebabCase=Hi,Nn.last=Vr,Nn.lastIndexOf=function(n,t,r){var e=n?n.length:0;if(!e)return-1;var u=e;if(typeof r=="number")u=(0>r?ku(e+r,0):Ou(r||0,e-1))+1;else if(r)return u=zt(n,t,true)-1,n=n[u],(t===t?t===n:n!==n)?u:-1;if(t!==t)return s(n,u,true);for(;u--;)if(n[u]===t)return u;return-1},Nn.lt=be,Nn.lte=function(n,t){return n<=t},Nn.max=oo,Nn.min=fo,Nn.noConflict=function(){return h._=iu,this},Nn.noop=ze,Nn.now=wi,
Nn.pad=function(n,t,r){n=u(n),t=+t;var e=n.length;return e<t&&Au(t)?(e=(t-e)/2,t=su(e),e=au(e),r=pr("",e,r),r.slice(0,t)+n+r):n},Nn.padLeft=Qi,Nn.padRight=no,Nn.parseInt=Ce,Nn.random=function(n,t,r){r&&Cr(n,t,r)&&(t=r=null);var e=null==n,u=null==t;return null==r&&(u&&typeof n=="boolean"?(r=n,n=1):typeof t=="boolean"&&(r=t,u=true)),e&&u&&(t=1,u=false),n=+n||0,u?(t=n,n=0):t=+t||0,r||n%1||t%1?(r=Cu(),Ou(n+r*(t-n+hu("1e-"+((r+"").length-1))),t)):It(n,t)},Nn.reduce=yi,Nn.reduceRight=di,Nn.repeat=We,Nn.result=function(n,t,r){
var e=null==n?m:n[t];return e===m&&(null==n||Wr(t,n)||(t=Br(t),n=1==t.length?n:dt(n,Ct(t,0,-1)),e=null==n?m:n[Vr(t)]),e=e===m?r:e),$i(e)?e.call(n):e},Nn.runInContext=d,Nn.size=function(n){var t=n?Zu(n):0;return Tr(t)?t:Ki(n).length},Nn.snakeCase=to,Nn.some=ie,Nn.sortedIndex=ti,Nn.sortedLastIndex=ri,Nn.startCase=ro,Nn.startsWith=function(n,t,r){return n=u(n),r=null==r?0:Ou(0>r?0:+r||0,n.length),n.lastIndexOf(t,r)==r},Nn.sum=function(n,t,r){r&&Cr(n,t,r)&&(t=null);var e=mr(),u=null==t;if(u&&e===it||(u=false,
t=e(t,r,3)),u){for(n=Ti(n)?n:Lr(n),t=n.length,r=0;t--;)r+=+n[t]||0;n=r}else n=Ut(n,t);return n},Nn.template=function(n,t,r){var e=Nn.templateSettings;r&&Cr(n,t,r)&&(t=r=null),n=u(n),t=tt(rt({},r||t),e,nt),r=tt(rt({},t.imports),e.imports,nt);var i,o,f=Ki(r),l=Ft(r,f),a=0;r=t.interpolate||En;var s="__p+='";r=Ze((t.escape||En).source+"|"+r.source+"|"+(r===vn?An:En).source+"|"+(t.evaluate||En).source+"|$","g");var p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(n.replace(r,function(t,r,e,u,f,l){
return e||(e=u),s+=n.slice(a,l).replace(Cn,c),r&&(i=true,s+="'+__e("+r+")+'"),f&&(o=true,s+="';"+f+";\n__p+='"),e&&(s+="'+((__t=("+e+"))==null?'':__t)+'"),a=l+t.length,t}),s+="';",(t=t.variable)||(s="with(obj){"+s+"}"),s=(o?s.replace(on,""):s).replace(fn,"$1").replace(ln,"$1;"),s="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(i?",__e=_.escape":"")+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+s+"return __p}",t=eo(function(){return De(f,p+"return "+s).apply(m,l);
}),t.source=s,_e(t))throw t;return t},Nn.trim=Se,Nn.trimLeft=function(n,t,r){var e=n;return(n=u(n))?n.slice((r?Cr(e,t,r):null==t)?v(n):i(n,t+"")):n},Nn.trimRight=function(n,t,r){var e=n;return(n=u(n))?(r?Cr(e,t,r):null==t)?n.slice(0,g(n)+1):n.slice(0,o(n,t+"")+1):n},Nn.trunc=function(n,t,r){r&&Cr(n,t,r)&&(t=null);var e=C;if(r=W,null!=t)if(ve(t)){var i="separator"in t?t.separator:i,e="length"in t?+t.length||0:e;r="omission"in t?u(t.omission):r}else e=+t||0;if(n=u(n),e>=n.length)return n;if(e-=r.length,
1>e)return r;if(t=n.slice(0,e),null==i)return t+r;if(de(i)){if(n.slice(e).search(i)){var o,f=n.slice(0,e);for(i.global||(i=Ze(i.source,(jn.exec(i)||"")+"g")),i.lastIndex=0;n=i.exec(f);)o=n.index;t=t.slice(0,null==o?e:o)}}else n.indexOf(i,e)!=e&&(i=t.lastIndexOf(i),-1<i&&(t=t.slice(0,i)));return t+r},Nn.unescape=function(n){return(n=u(n))&&sn.test(n)?n.replace(an,y):n},Nn.uniqueId=function(n){var t=++eu;return u(n)+t},Nn.words=Te,Nn.all=ne,Nn.any=ie,Nn.contains=re,Nn.eq=he,Nn.detect=ai,Nn.foldl=yi,
Nn.foldr=di,Nn.head=Dr,Nn.include=re,Nn.inject=yi,Le(Nn,function(){var n={};return vt(Nn,function(t,r){Nn.prototype[r]||(n[r]=t)}),n}(),false),Nn.sample=ue,Nn.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(t){return ue(t,n)}):ue(this.value())},Nn.VERSION=w,Kn("bind bindKey curry curryRight partial partialRight".split(" "),function(n){Nn[n].placeholder=Nn}),Kn(["dropWhile","filter","map","takeWhile"],function(n,t){var r=t!=F,e=t==U;Bn.prototype[n]=function(n,u){var i=this.__filtered__,o=i&&e?new Bn(this):this.clone();
return(o.__iteratees__||(o.__iteratees__=[])).push({done:false,count:0,index:0,iteratee:mr(n,u,1),limit:-1,type:t}),o.__filtered__=i||r,o}}),Kn(["drop","take"],function(n,t){var r=n+"While";Bn.prototype[n]=function(r){var e=this.__filtered__,u=e&&!t?this.dropWhile():this.clone();return r=null==r?1:ku(su(r)||0,0),e?t?u.__takeCount__=Ou(u.__takeCount__,r):Vr(u.__iteratees__).limit=r:(u.__views__||(u.__views__=[])).push({size:r,type:n+(0>u.__dir__?"Right":"")}),u},Bn.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse();
},Bn.prototype[n+"RightWhile"]=function(n,t){return this.reverse()[r](n,t).reverse()}}),Kn(["first","last"],function(n,t){var r="take"+(t?"Right":"");Bn.prototype[n]=function(){return this[r](1).value()[0]}}),Kn(["initial","rest"],function(n,t){var r="drop"+(t?"":"Right");Bn.prototype[n]=function(){return this[r](1)}}),Kn(["pluck","where"],function(n,t){var r=t?"filter":"map",e=t?xt:Be;Bn.prototype[n]=function(n){return this[r](e(n))}}),Bn.prototype.compact=function(){return this.filter(Fe)},Bn.prototype.reject=function(n,t){
return n=mr(n,t,1),this.filter(function(t){return!n(t)})},Bn.prototype.slice=function(n,t){n=null==n?0:+n||0;var r=this;return 0>n?r=this.takeRight(-n):n&&(r=this.drop(n)),t!==m&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-n)),r},Bn.prototype.toArray=function(){return this.drop(0)},vt(Bn.prototype,function(n,t){var r=Nn[t];if(r){var e=/^(?:filter|map|reject)|While$/.test(t),u=/^(?:first|last)$/.test(t);Nn.prototype[t]=function(){function t(n){return n=[n],_u.apply(n,i),r.apply(Nn,n)}var i=arguments,o=this.__chain__,f=this.__wrapped__,l=!!this.__actions__.length,a=f instanceof Bn,c=i[0],s=a||Ti(f);
return s&&e&&typeof c=="function"&&1!=c.length&&(a=s=false),a=a&&!l,u&&!o?a?n.call(f):r.call(Nn,this.value()):s?(f=n.apply(a?f:new Bn(this),i),u||!l&&!f.__actions__||(f.__actions__||(f.__actions__=[])).push({func:Qr,args:[t],thisArg:Nn}),new zn(f,o)):this.thru(t)}}}),Kn("concat join pop push replace shift sort splice split unshift".split(" "),function(n){var t=(/^(?:replace|split)$/.test(n)?Qe:Xe)[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:join|pop|replace|shift)$/.test(n);Nn.prototype[n]=function(){
var n=arguments;return e&&!this.__chain__?t.apply(this.value(),n):this[r](function(r){return t.apply(r,n)})}}),vt(Bn.prototype,function(n,t){var r=Nn[t];if(r){var e=r.name;(Lu[e]||(Lu[e]=[])).push({name:t,func:r})}}),Lu[sr(null,x).name]=[{name:"wrapper",func:null}],Bn.prototype.clone=function(){var n=this.__actions__,t=this.__iteratees__,r=this.__views__,e=new Bn(this.__wrapped__);return e.__actions__=n?Dn(n):null,e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=t?Dn(t):null,
e.__takeCount__=this.__takeCount__,e.__views__=r?Dn(r):null,e},Bn.prototype.reverse=function(){if(this.__filtered__){var n=new Bn(this);n.__dir__=-1,n.__filtered__=true}else n=this.clone(),n.__dir__*=-1;return n},Bn.prototype.value=function(){var n=this.__wrapped__.value();if(!Ti(n))return Lt(n,this.__actions__);var t,r=this.__dir__,e=0>r;t=n.length;for(var u=this.__views__,i=0,o=-1,f=u?u.length:0;++o<f;){var l=u[o],a=l.size;switch(l.type){case"drop":i+=a;break;case"dropRight":t-=a;break;case"take":
t=Ou(t,i+a);break;case"takeRight":i=ku(i,t-a)}}t={start:i,end:t},u=t.start,i=t.end,t=i-u,u=e?i:u-1,i=Ou(t,this.__takeCount__),f=(o=this.__iteratees__)?o.length:0,l=0,a=[];n:for(;t--&&l<i;){for(var u=u+r,c=-1,s=n[u];++c<f;){var p=o[c],h=p.iteratee,_=p.type;if(_==U){if(p.done&&(e?u>p.index:u<p.index)&&(p.count=0,p.done=false),p.index=u,!(p.done||(_=p.limit,p.done=-1<_?p.count++>=_:!h(s))))continue n}else if(p=h(s),_==F)s=p;else if(!p){if(_==$)continue n;break n}}a[l++]=s}return a},Nn.prototype.chain=function(){
return Hr(this)},Nn.prototype.commit=function(){return new zn(this.value(),this.__chain__)},Nn.prototype.plant=function(n){for(var t,r=this;r instanceof Ln;){var e=Mr(r);t?u.__wrapped__=e:t=e;var u=e,r=r.__wrapped__}return u.__wrapped__=n,t},Nn.prototype.reverse=function(){var n=this.__wrapped__;return n instanceof Bn?(this.__actions__.length&&(n=new Bn(this)),new zn(n.reverse(),this.__chain__)):this.thru(function(n){return n.reverse()})},Nn.prototype.toString=function(){return this.value()+""},Nn.prototype.run=Nn.prototype.toJSON=Nn.prototype.valueOf=Nn.prototype.value=function(){
return Lt(this.__wrapped__,this.__actions__)},Nn.prototype.collect=Nn.prototype.map,Nn.prototype.head=Nn.prototype.first,Nn.prototype.select=Nn.prototype.filter,Nn.prototype.tail=Nn.prototype.rest,Nn}var m,w="3.9.3",b=1,x=2,A=4,j=8,k=16,O=32,R=64,I=128,E=256,C=30,W="...",S=150,T=16,U=0,$=1,F=2,N="Expected a function",L="__lodash_placeholder__",z="[object Arguments]",B="[object Array]",M="[object Boolean]",P="[object Date]",q="[object Error]",D="[object Function]",K="[object Number]",V="[object Object]",Y="[object RegExp]",Z="[object String]",G="[object ArrayBuffer]",J="[object Float32Array]",X="[object Float64Array]",H="[object Int8Array]",Q="[object Int16Array]",nn="[object Int32Array]",tn="[object Uint8Array]",rn="[object Uint8ClampedArray]",en="[object Uint16Array]",un="[object Uint32Array]",on=/\b__p\+='';/g,fn=/\b(__p\+=)''\+/g,ln=/(__e\(.*?\)|\b__t\))\+'';/g,an=/&(?:amp|lt|gt|quot|#39|#96);/g,cn=/[&<>"'`]/g,sn=RegExp(an.source),pn=RegExp(cn.source),hn=/<%-([\s\S]+?)%>/g,_n=/<%([\s\S]+?)%>/g,vn=/<%=([\s\S]+?)%>/g,gn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,yn=/^\w*$/,dn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,mn=/[.*+?^${}()|[\]\/\\]/g,wn=RegExp(mn.source),bn=/[\u0300-\u036f\ufe20-\ufe23]/g,xn=/\\(\\)?/g,An=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jn=/\w*$/,kn=/^0[xX]/,On=/^\[object .+?Constructor\]$/,Rn=/^\d+$/,In=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,En=/($^)/,Cn=/['\n\r\u2028\u2029\\]/g,Wn=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),Sn=" \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",Tn="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseFloat parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window".split(" "),Un={};
Un[J]=Un[X]=Un[H]=Un[Q]=Un[nn]=Un[tn]=Un[rn]=Un[en]=Un[un]=true,Un[z]=Un[B]=Un[G]=Un[M]=Un[P]=Un[q]=Un[D]=Un["[object Map]"]=Un[K]=Un[V]=Un[Y]=Un["[object Set]"]=Un[Z]=Un["[object WeakMap]"]=false;var $n={};$n[z]=$n[B]=$n[G]=$n[M]=$n[P]=$n[J]=$n[X]=$n[H]=$n[Q]=$n[nn]=$n[K]=$n[V]=$n[Y]=$n[Z]=$n[tn]=$n[rn]=$n[en]=$n[un]=true,$n[q]=$n[D]=$n["[object Map]"]=$n["[object Set]"]=$n["[object WeakMap]"]=false;var Fn={leading:false,maxWait:0,trailing:false},Nn={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A",
"\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u",
"\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss"},Ln={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},zn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Bn={"function":true,object:true},Mn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Pn=Bn[typeof exports]&&exports&&!exports.nodeType&&exports,qn=Bn[typeof module]&&module&&!module.nodeType&&module,Dn=Bn[typeof self]&&self&&self.Object&&self,Kn=Bn[typeof window]&&window&&window.Object&&window,Vn=qn&&qn.exports===Pn&&Pn,Yn=Pn&&qn&&typeof global=="object"&&global&&global.Object&&global||Kn!==(this&&this.window)&&Kn||Dn||this,Zn=d();
typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Yn._=Zn, define(function(){return Zn})):Pn&&qn?Vn?(qn.exports=Zn)._=Zn:Pn._=Zn:Yn._=Zn}).call(this);
;
;
/*! moment.min.js */ 
;
;
(function(e){function O(e,t){return function(n){return j(e.call(this,n),t)}}function M(e){return function(t){return this.lang().ordinal(e.call(this,t))}}function _(){}function D(e){H(this,e)}function P(e){var t=this._data={},n=e.years||e.year||e.y||0,r=e.months||e.month||e.M||0,i=e.weeks||e.week||e.w||0,s=e.days||e.day||e.d||0,o=e.hours||e.hour||e.h||0,u=e.minutes||e.minute||e.m||0,a=e.seconds||e.second||e.s||0,f=e.milliseconds||e.millisecond||e.ms||0;this._milliseconds=f+a*1e3+u*6e4+o*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=f%1e3,a+=B(f/1e3),t.seconds=a%60,u+=B(a/60),t.minutes=u%60,o+=B(u/60),t.hours=o%24,s+=B(o/24),s+=i*7,t.days=s%30,r+=B(s/30),t.months=r%12,n+=B(r/12),t.years=n}function H(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function B(e){return e<0?Math.ceil(e):Math.floor(e)}function j(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function F(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function I(e){return Object.prototype.toString.call(e)==="[object Array]"}function q(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function R(e,t){return t.abbr=e,s[e]||(s[e]=new _),s[e].set(t),s[e]}function U(e){return e?(!s[e]&&o&&require("./lang/"+e),s[e]):t.fn._lang}function z(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function W(e){var t=e.match(a),n,r;for(n=0,r=t.length;n<r;n++)A[t[n]]?t[n]=A[t[n]]:t[n]=z(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function X(e,t){function r(t){return e.lang().longDateFormat(t)||t}var n=5;while(n--&&f.test(t))t=t.replace(f,r);return C[t]||(C[t]=W(t)),C[t](e)}function V(e){switch(e){case"DDDD":return p;case"YYYY":return d;case"YYYYY":return v;case"S":case"SS":case"SSS":case"DDD":return h;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return m;case"X":return b;case"Z":case"ZZ":return g;case"T":return y;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return c;default:return new RegExp(e.replace("\\",""))}}function $(e,t,n){var r,i,s=n._a;switch(e){case"M":case"MM":s[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":r=U(n._l).monthsParse(t),r!=null?s[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(s[2]=~~t);break;case"YY":s[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~t;break;case"a":case"A":n._isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":s[3]=~~t;break;case"m":case"mm":s[4]=~~t;break;case"s":case"ss":s[5]=~~t;break;case"S":case"SS":case"SSS":s[6]=~~(("0."+t)*1e3);break;case"X":n._d=new Date(parseFloat(t)*1e3);break;case"Z":case"ZZ":n._useUTC=!0,r=(t+"").match(x),r&&r[1]&&(n._tzh=~~r[1]),r&&r[2]&&(n._tzm=~~r[2]),r&&r[0]==="+"&&(n._tzh=-n._tzh,n._tzm=-n._tzm)}t==null&&(n._isValid=!1)}function J(e){var t,n,r=[];if(e._d)return;for(t=0;t<7;t++)e._a[t]=r[t]=e._a[t]==null?t===2?1:0:e._a[t];r[3]+=e._tzh||0,r[4]+=e._tzm||0,n=new Date(0),e._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),e._d=n}function K(e){var t=e._f.match(a),n=e._i,r,i;e._a=[];for(r=0;r<t.length;r++)i=(V(t[r]).exec(n)||[])[0],i&&(n=n.slice(n.indexOf(i)+i.length)),A[t[r]]&&$(t[r],i,e);e._isPm&&e._a[3]<12&&(e._a[3]+=12),e._isPm===!1&&e._a[3]===12&&(e._a[3]=0),J(e)}function Q(e){var t,n,r,i=99,s,o,u;while(e._f.length){t=H({},e),t._f=e._f.pop(),K(t),n=new D(t);if(n.isValid()){r=n;break}u=q(t._a,n.toArray()),u<i&&(i=u,r=n)}H(e,r)}function G(e){var t,n=e._i;if(w.exec(n)){e._f="YYYY-MM-DDT";for(t=0;t<4;t++)if(S[t][1].exec(n)){e._f+=S[t][0];break}g.exec(n)&&(e._f+=" Z"),K(e)}else e._d=new Date(n)}function Y(t){var n=t._i,r=u.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):typeof n=="string"?G(t):I(n)?(t._a=n.slice(0),J(t)):t._d=n instanceof Date?new Date(+n):new Date(n)}function Z(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function et(e,t,n){var i=r(Math.abs(e)/1e3),s=r(i/60),o=r(s/60),u=r(o/24),a=r(u/365),f=i<45&&["s",i]||s===1&&["m"]||s<45&&["mm",s]||o===1&&["h"]||o<22&&["hh",o]||u===1&&["d"]||u<=25&&["dd",u]||u<=45&&["M"]||u<345&&["MM",r(u/30)]||a===1&&["y"]||["yy",a];return f[2]=t,f[3]=e>0,f[4]=n,Z.apply({},f)}function tt(e,n,r){var i=r-n,s=r-e.day();return s>i&&(s-=7),s<i-7&&(s+=7),Math.ceil(t(e).add("d",s).dayOfYear()/7)}function nt(e){var n=e._i,r=e._f;return n===null||n===""?null:(typeof n=="string"&&(e._i=n=U().preparse(n)),t.isMoment(n)?(e=H({},n),e._d=new Date(+n._d)):r?I(r)?Q(e):K(e):Y(e),new D(e))}function rt(e,n){t.fn[e]=t.fn[e+"s"]=function(e){var t=this._isUTC?"UTC":"";return e!=null?(this._d["set"+t+n](e),this):this._d["get"+t+n]()}}function it(e){t.duration.fn[e]=function(){return this._data[e]}}function st(e,n){t.duration.fn["as"+e]=function(){return+this/n}}var t,n="2.0.0",r=Math.round,i,s={},o=typeof module!="undefined"&&module.exports,u=/^\/?Date\((\-?\d+)/i,a=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,f=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,l=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,c=/\d\d?/,h=/\d{1,3}/,p=/\d{3}/,d=/\d{1,4}/,v=/[+\-]?\d{1,6}/,m=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,g=/Z|[\+\-]\d\d:?\d\d/i,y=/T/i,b=/[\+\-]?\d+(\.\d{1,3})?/,w=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,E="YYYY-MM-DDTHH:mm:ssZ",S=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],x=/([\+\-]|\d\d)/gi,T="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),N={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},C={},k="DDD w W M D d".split(" "),L="M D H h m s w W".split(" "),A={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return j(this.year()%100,2)},YYYY:function(){return j(this.year(),4)},YYYYY:function(){return j(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return j(~~(this.milliseconds()/10),2)},SSS:function(){return j(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(e/60),2)+":"+j(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(10*e/6),4)},X:function(){return this.unix()}};while(k.length)i=k.pop(),A[i+"o"]=M(A[i]);while(L.length)i=L.pop(),A[i+i]=O(A[i],2);A.DDDD=O(A.DDD,3),_.prototype={set:function(e){var t,n;for(n in e)t=e[n],typeof t=="function"?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var n,r,i,s;this._monthsParse||(this._monthsParse=[]);for(n=0;n<12;n++){this._monthsParse[n]||(r=t([2e3,n]),i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[n]=new RegExp(i.replace(".",""),"i"));if(this._monthsParse[n].test(e))return n}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return typeof n=="function"?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return typeof i=="function"?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return typeof n=="function"?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return tt(e,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},t=function(e,t,n){return nt({_i:e,_f:t,_l:n,_isUTC:!1})},t.utc=function(e,t,n){return nt({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},t.unix=function(e){return t(e*1e3)},t.duration=function(e,n){var r=t.isDuration(e),i=typeof e=="number",s=r?e._data:i?{}:e,o;return i&&(n?s[n]=e:s.milliseconds=e),o=new P(s),r&&e.hasOwnProperty("_lang")&&(o._lang=e._lang),o},t.version=n,t.defaultFormat=E,t.lang=function(e,n){var r;if(!e)return t.fn._lang._abbr;n?R(e,n):s[e]||U(e),t.duration.fn._lang=t.fn._lang=U(e)},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),U(e)},t.isMoment=function(e){return e instanceof D},t.isDuration=function(e){return e instanceof P},t.fn=D.prototype={clone:function(){return t(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return t.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return this._isValid==null&&(this._a?this._isValid=!q(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){var n=X(this,e||t.defaultFormat);return this.lang().postformat(n)},add:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),F(this,r,1),this},subtract:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),F(this,r,-1),this},diff:function(e,n,r){var i=this._isUTC?t(e).utc():t(e).local(),s=(this.zone()-i.zone())*6e4,o,u;return n&&(n=n.replace(/s$/,"")),n==="year"||n==="month"?(o=(this.daysInMonth()+i.daysInMonth())*432e5,u=(this.year()-i.year())*12+(this.month()-i.month()),u+=(this-t(this).startOf("month")-(i-t(i).startOf("month")))/o,n==="year"&&(u/=12)):(o=this-i-s,u=n==="second"?o/1e3:n==="minute"?o/6e4:n==="hour"?o/36e5:n==="day"?o/864e5:n==="week"?o/6048e5:o),r?u:B(u)},from:function(e,n){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=this.diff(t().startOf("day"),"days",!0),n=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<t([this.year()]).zone()||this.zone()<t([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){e=e.replace(/s$/,"");switch(e){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return e==="week"&&this.day(0),this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)>+t(e).startOf(n)},isBefore:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)<+t(e).startOf(n)},isSame:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)===+t(e).startOf(n)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return t.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var n=r((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return e==null?n:this.add("d",e-n)},isoWeek:function(e){var t=tt(this,1,4);return e==null?t:this.add("d",(e-t)*7)},week:function(e){var t=this.lang().week(this);return e==null?t:this.add("d",(e-t)*7)},lang:function(t){return t===e?this._lang:(this._lang=U(t),this)}};for(i=0;i<T.length;i++)rt(T[i].toLowerCase().replace(/s$/,""),T[i]);rt("year","FullYear"),t.fn.days=t.fn.day,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.duration.fn=P.prototype={weeks:function(){return B(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=et(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},lang:t.fn.lang};for(i in N)N.hasOwnProperty(i)&&(st(i,N[i]),it(i.toLowerCase()));st("Weeks",6048e5),t.lang("en",{ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}}),o&&(module.exports=t),typeof ender=="undefined"&&(this.moment=t),typeof define=="function"&&define.amd&&define("moment",[],function(){return t})}).call(this);
;
;
/*! bootstrap.min.js */ 
;
;
/*!
* Bootstrap.js by @fat & @mdo
* Copyright 2012 Twitter, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/
!function(e){e(function(){"use strict";e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t){if(e.style[n]!==undefined){return t[n]}}}();return e&&{end:e}}()})}(window.jQuery);!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;if(!r){r=n.attr("href");r=r&&r.replace(/.*(?=#[^\s]*$)/,"")}i=e(r);t&&t.preventDefault();i.length||(i=n.hasClass("alert")?n:n.parent());i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in");e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()};e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");if(!i)r.data("alert",i=new n(this));if(typeof t=="string")i[t].call(r)})};e.fn.alert.Constructor=n;e(function(){e("body").on("click.alert.data-api",t,n.prototype.close)})}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e=e+"Text";r.resetText||n.data("resetText",n[i]());n[i](r[e]||this.options[e]);setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)};t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active");this.$element.toggleClass("active")};e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;if(!i)r.data("button",i=new t(this,s));if(n=="toggle")i.toggle();else if(n)i.setState(n)})};e.fn.button.defaults={loadingText:"loading..."};e.fn.button.Constructor=t;e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);if(!n.hasClass("btn"))n=n.closest(".btn");n.button("toggle")})})}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=n;this.options.slide&&this.slide(this.options.slide);this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){if(!t)this.paused=false;this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval));return this},to:function(t){var n=this.$element.find(".item.active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;if(this.sliding){return this.$element.one("slid",function(){s.to(t)})}if(i==t){return this.pause().cycle()}return this.slide(t>i?"next":"prev",e(r[t]))},pause:function(t){if(!t)this.paused=true;if(this.$element.find(".next, .prev").length&&e.support.transition.end){this.$element.trigger(e.support.transition.end);this.cycle()}clearInterval(this.interval);this.interval=null;return this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f=e.Event("slide",{relatedTarget:i[0]});this.sliding=true;s&&this.pause();i=i.length?i:this.$element.find(".item")[u]();if(i.hasClass("active"))return;if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t);i[0].offsetWidth;r.addClass(o);i.addClass(o);this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active");r.removeClass(["active",o].join(" "));a.sliding=false;setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active");i.addClass("active");this.sliding=false;this.$element.trigger("slid")}s&&this.cycle();return this}};e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;if(!i)r.data("carousel",i=new t(this,s));if(typeof n=="number")i.to(n);else if(o)i[o]();else if(s.interval)i.cycle()})};e.fn.carousel.defaults={interval:5e3,pause:"hover"};e.fn.carousel.Constructor=t;e(function(){e("body").on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=!i.data("modal")&&e.extend({},i.data(),n.data());i.carousel(s);t.preventDefault()})})}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.collapse.defaults,n);if(this.options.parent){this.$parent=e(this.options.parent)}this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning)return;t=this.dimension();n=e.camelCase(["scroll",t].join("-"));r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide");i||r.data("collapse",null)}this.$element[t](0);this.transition("addClass",e.Event("show"),"shown");e.support.transition&&this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning)return;t=this.dimension();this.reset(this.$element[t]());this.transition("removeClass",e.Event("hide"),"hidden");this.$element[t](0)},reset:function(e){var t=this.dimension();this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth;this.$element[e!==null?"addClass":"removeClass"]("collapse");return this},transition:function(t,n,r){var i=this,s=function(){if(n.type=="show")i.reset();i.transitioning=0;i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1;this.$element[t]("in");e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=typeof n=="object"&&n;if(!i)r.data("collapse",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.collapse.defaults={toggle:true};e.fn.collapse.Constructor=t;e(function(){e("body").on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed");e(i).collapse(s)})})}(window.jQuery);!function(e){"use strict";function r(){i(e(t)).removeClass("open")}function i(t){var n=t.attr("data-target"),r;if(!n){n=t.attr("href");n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")}r=e(n);r.length||(r=t.parent());return r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;s=i(n);o=s.hasClass("open");r();if(!o){s.toggleClass("open");n.focus()}return false},keydown:function(t){var n,r,s,o,u,a;if(!/(38|40|27)/.test(t.keyCode))return;n=e(this);t.preventDefault();t.stopPropagation();if(n.is(".disabled, :disabled"))return;o=i(n);u=o.hasClass("open");if(!u||u&&t.keyCode==27)return n.click();r=e("[role=menu] li:not(.divider) a",o);if(!r.length)return;a=r.index(r.filter(":focus"));if(t.keyCode==38&&a>0)a--;if(t.keyCode==40&&a<r.length-1)a++;if(!~a)a=0;r.eq(a).focus()}};e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");if(!i)r.data("dropdown",i=new n(this));if(typeof t=="string")i[t].call(r)})};e.fn.dropdown.Constructor=n;e(function(){e("html").on("click.dropdown.data-api touchstart.dropdown.data-api",r);e("body").on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)})}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.options=n;this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;e("body").addClass("modal-open");this.isShown=true;this.escape();this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");if(!t.$element.parent().length){t.$element.appendTo(document.body)}t.$element.show();if(n){t.$element[0].offsetWidth}t.$element.addClass("in").attr("aria-hidden",false);t.enforceFocus();n?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide");this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=false;e("body").removeClass("modal-open");this.escape();e(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){},escape:function(){var e=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()})}else if(!this.isShown){this.$element.off("keyup.dismiss.modal")}},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end);t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n);t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden");this.backdrop()},removeBackdrop:function(){this.$backdrop.remove();this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body);if(this.options.backdrop!="static"){this.$backdrop.click(e.proxy(this.hide,this))}if(i)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");i?this.$backdrop.one(e.support.transition.end,t):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()}else if(t){t()}}};e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);if(!i)r.data("modal",i=new t(this,s));if(typeof n=="string")i[n]();else if(s.show)i.show()})};e.fn.modal.defaults={backdrop:true,keyboard:true,show:true};e.fn.modal.Constructor=t;e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault();i.modal(s).one("hide",function(){n.focus()})})})}(window.jQuery);!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t;this.$element=e(n);this.options=this.getOptions(r);this.enabled=true;if(this.options.trigger=="click"){this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this))}else if(this.options.trigger!="manual"){i=this.options.trigger=="hover"?"mouseenter":"focus";s=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this));this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this))}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){t=e.extend({},e.fn[this.type].defaults,t,this.$element.data());if(t.delay&&typeof t.delay=="number"){t.delay={show:t.delay,hide:t.delay}}return t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(!n.options.delay||!n.options.delay.show)return n.show();clearTimeout(this.timeout);n.hoverState="in";this.timeout=setTimeout(function(){if(n.hoverState=="in")n.show()},n.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(this.timeout)clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out";this.timeout=setTimeout(function(){if(n.hoverState=="out")n.hide()},n.options.delay.hide)},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip();this.setContent();if(this.options.animation){e.addClass("fade")}s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement;t=/in/.test(s);e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body);n=this.getPosition(t);r=e[0].offsetWidth;i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width};break}e.css(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t);e.removeClass("fade in top bottom left right")},hide:function(){function r(){var t=setTimeout(function(){n.off(e.support.transition.end).remove()},500);n.one(e.support.transition.end,function(){clearTimeout(t);n.remove()})}var t=this,n=this.tip();n.removeClass("in");e.support.transition&&this.$tip.hasClass("fade")?r():n.remove();return this},fixTitle:function(){var e=this.$element;if(e.attr("title")||typeof e.attr("data-original-title")!="string"){e.attr("data-original-title",e.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title);return e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;if(!i)r.data("tooltip",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.tooltip.Constructor=t;e.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:true}}(window.jQuery);!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t);e.find(".popover-content > *")[this.options.html?"html":"text"](n);e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content);return e},tip:function(){if(!this.$tip){this.$tip=e(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;if(!i)r.data("popover",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.popover.Constructor=t;e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery);!function(e){"use strict";function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n);this.$scrollElement=i.on("scroll.scroll-spy.data-api",r);this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a";this.$body=e("body");this.refresh();this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]);this.targets=e([]);n=this.$body.find(this.selector).map(function(){var t=e(this),n=t.data("target")||t.attr("href"),r=/^#\w/.test(n)&&e(n);return r&&r.length&&[[r.position().top,n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]);t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n){return s!=(o=i.last()[0])&&this.activate(o)}for(o=r.length;o--;){s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])}},activate:function(t){var n,r;this.activeTarget=t;e(this.selector).parent(".active").removeClass("active");r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]';n=e(r).parent("li").addClass("active");if(n.parent(".dropdown-menu").length){n=n.closest("li.dropdown").addClass("active")}n.trigger("activate")}};e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;if(!i)r.data("scrollspy",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.scrollspy.Constructor=t;e.fn.scrollspy.defaults={offset:10};e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery);!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;if(!r){r=t.attr("href");r=r&&r.replace(/.*(?=#[^\s]*$)/,"")}if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0];o=e.Event("show",{relatedTarget:i});t.trigger(o);if(o.isDefaultPrevented())return;s=e(r);this.activate(t.parent("li"),n);this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");t.addClass("active");if(s){t[0].offsetWidth;t.addClass("in")}else{t.removeClass("fade")}if(t.parent(".dropdown-menu")){t.closest("li.dropdown").addClass("active")}r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o();i.removeClass("in")}};e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");if(!i)r.data("tab",i=new t(this));if(typeof n=="string")i[n]()})};e.fn.tab.Constructor=t;e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault();e(this).tab("show")})})}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.typeahead.defaults,n);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.$menu=e(this.options.menu).appendTo("body");this.source=this.options.source;this.shown=false;this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");this.$element.val(this.updater(e)).change();return this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:t.top+t.height,left:t.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(t){var n;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength){return this.shown?this.hide():this}n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source;return n?this.process(n):this},process:function(t){var n=this;t=e.grep(t,function(e){return n.matcher(e)});t=this.sorter(t);if(!t.length){return this.shown?this.hide():this}return this.render(t.slice(0,this.options.items)).show()},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift()){if(!i.toLowerCase().indexOf(this.query.toLowerCase()))t.push(i);else if(~i.indexOf(this.query))n.push(i);else r.push(i)}return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;t=e(t).map(function(t,r){t=e(n.options.item).attr("data-value",r);t.find("a").html(n.highlighter(r));return t[0]});t.first().addClass("active");this.$menu.html(t);return this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();if(!r.length){r=e(this.$menu.find("li")[0])}r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();if(!n.length){n=this.$menu.find("li").last()}n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this));if(e.browser.chrome||e.browser.webkit||e.browser.msie){this.$element.on("keydown",e.proxy(this.keydown,this))}this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault();this.prev();break;case 40:e.preventDefault();this.next();break}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]);this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation();e.preventDefault()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation();e.preventDefault();this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active");e(t.currentTarget).addClass("active")}};e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;if(!i)r.data("typeahead",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1};e.fn.typeahead.Constructor=t;e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault();n.typeahead(n.data())})})}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n);this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this));this.$element=e(t);this.checkPosition()};t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom",a;if(typeof i!="object")s=o=i;if(typeof o=="function")o=i.top();if(typeof s=="function")s=i.bottom();a=this.unpin!=null&&n+this.unpin<=r.top?false:s!=null&&r.top+this.$element.height()>=t-s?"bottom":o!=null&&n<=o?"top":false;if(this.affixed===a)return;this.affixed=a;this.unpin=a=="bottom"?r.top-n:null;this.$element.removeClass(u).addClass("affix"+(a?"-"+a:""))};e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s=typeof n=="object"&&n;if(!i)r.data("affix",i=new t(this,s));if(typeof n=="string")i[n]()})};e.fn.affix.Constructor=t;e.fn.affix.defaults={offset:0};e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{};n.offsetBottom&&(n.offset.bottom=n.offsetBottom);n.offsetTop&&(n.offset.top=n.offsetTop);t.affix(n)})})}(window.jQuery);
;
;
/*! angular.min.js */ 
;
;
/*
AngularJS v1.2.22
(c) 2010-2014 Google, Inc. http://angularjs.org
License: MIT
*/
(function(P,X,s){'use strict';function w(b){return function(){var a=arguments[0],c,a="["+(b?b+":":"")+a+"] http://errors.angularjs.org/1.2.22/"+(b?b+"/":"")+a;for(c=1;c<arguments.length;c++)a=a+(1==c?"?":"&")+"p"+(c-1)+"="+encodeURIComponent("function"==typeof arguments[c]?arguments[c].toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof arguments[c]?"undefined":"string"!=typeof arguments[c]?JSON.stringify(arguments[c]):arguments[c]);return Error(a)}}function fb(b){if(null==b||Fa(b))return!1;
var a=b.length;return 1===b.nodeType&&a?!0:C(b)||L(b)||0===a||"number"===typeof a&&0<a&&a-1 in b}function r(b,a,c){var d;if(b)if(J(b))for(d in b)"prototype"==d||("length"==d||"name"==d||b.hasOwnProperty&&!b.hasOwnProperty(d))||a.call(c,b[d],d);else if(L(b)||fb(b))for(d=0;d<b.length;d++)a.call(c,b[d],d);else if(b.forEach&&b.forEach!==r)b.forEach(a,c);else for(d in b)b.hasOwnProperty(d)&&a.call(c,b[d],d);return b}function Zb(b){var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c);return a.sort()}function Tc(b,
a,c){for(var d=Zb(b),e=0;e<d.length;e++)a.call(c,b[d[e]],d[e]);return d}function $b(b){return function(a,c){b(c,a)}}function gb(){for(var b=la.length,a;b;){b--;a=la[b].charCodeAt(0);if(57==a)return la[b]="A",la.join("");if(90==a)la[b]="0";else return la[b]=String.fromCharCode(a+1),la.join("")}la.unshift("0");return la.join("")}function ac(b,a){a?b.$$hashKey=a:delete b.$$hashKey}function E(b){var a=b.$$hashKey;r(arguments,function(a){a!==b&&r(a,function(a,c){b[c]=a})});ac(b,a);return b}function Z(b){return parseInt(b,
10)}function bc(b,a){return E(new (E(function(){},{prototype:b})),a)}function z(){}function Ga(b){return b}function $(b){return function(){return b}}function F(b){return"undefined"===typeof b}function D(b){return"undefined"!==typeof b}function T(b){return null!=b&&"object"===typeof b}function C(b){return"string"===typeof b}function Ab(b){return"number"===typeof b}function sa(b){return"[object Date]"===ya.call(b)}function J(b){return"function"===typeof b}function hb(b){return"[object RegExp]"===ya.call(b)}
function Fa(b){return b&&b.document&&b.location&&b.alert&&b.setInterval}function Uc(b){return!(!b||!(b.nodeName||b.prop&&b.attr&&b.find))}function Vc(b,a,c){var d=[];r(b,function(b,f,g){d.push(a.call(c,b,f,g))});return d}function Qa(b,a){if(b.indexOf)return b.indexOf(a);for(var c=0;c<b.length;c++)if(a===b[c])return c;return-1}function Ra(b,a){var c=Qa(b,a);0<=c&&b.splice(c,1);return a}function Ha(b,a,c,d){if(Fa(b)||b&&b.$evalAsync&&b.$watch)throw Sa("cpws");if(a){if(b===a)throw Sa("cpi");c=c||[];
d=d||[];if(T(b)){var e=Qa(c,b);if(-1!==e)return d[e];c.push(b);d.push(a)}if(L(b))for(var f=a.length=0;f<b.length;f++)e=Ha(b[f],null,c,d),T(b[f])&&(c.push(b[f]),d.push(e)),a.push(e);else{var g=a.$$hashKey;r(a,function(b,c){delete a[c]});for(f in b)e=Ha(b[f],null,c,d),T(b[f])&&(c.push(b[f]),d.push(e)),a[f]=e;ac(a,g)}}else if(a=b)L(b)?a=Ha(b,[],c,d):sa(b)?a=new Date(b.getTime()):hb(b)?(a=RegExp(b.source,b.toString().match(/[^\/]*$/)[0]),a.lastIndex=b.lastIndex):T(b)&&(a=Ha(b,{},c,d));return a}function ga(b,
a){if(L(b)){a=a||[];for(var c=0;c<b.length;c++)a[c]=b[c]}else if(T(b))for(c in a=a||{},b)!ib.call(b,c)||"$"===c.charAt(0)&&"$"===c.charAt(1)||(a[c]=b[c]);return a||b}function za(b,a){if(b===a)return!0;if(null===b||null===a)return!1;if(b!==b&&a!==a)return!0;var c=typeof b,d;if(c==typeof a&&"object"==c)if(L(b)){if(!L(a))return!1;if((c=b.length)==a.length){for(d=0;d<c;d++)if(!za(b[d],a[d]))return!1;return!0}}else{if(sa(b))return sa(a)&&b.getTime()==a.getTime();if(hb(b)&&hb(a))return b.toString()==a.toString();
if(b&&b.$evalAsync&&b.$watch||a&&a.$evalAsync&&a.$watch||Fa(b)||Fa(a)||L(a))return!1;c={};for(d in b)if("$"!==d.charAt(0)&&!J(b[d])){if(!za(b[d],a[d]))return!1;c[d]=!0}for(d in a)if(!c.hasOwnProperty(d)&&"$"!==d.charAt(0)&&a[d]!==s&&!J(a[d]))return!1;return!0}return!1}function Bb(b,a){var c=2<arguments.length?Aa.call(arguments,2):[];return!J(a)||a instanceof RegExp?a:c.length?function(){return arguments.length?a.apply(b,c.concat(Aa.call(arguments,0))):a.apply(b,c)}:function(){return arguments.length?
a.apply(b,arguments):a.call(b)}}function Wc(b,a){var c=a;"string"===typeof b&&"$"===b.charAt(0)?c=s:Fa(a)?c="$WINDOW":a&&X===a?c="$DOCUMENT":a&&(a.$evalAsync&&a.$watch)&&(c="$SCOPE");return c}function ta(b,a){return"undefined"===typeof b?s:JSON.stringify(b,Wc,a?"  ":null)}function cc(b){return C(b)?JSON.parse(b):b}function Ta(b){"function"===typeof b?b=!0:b&&0!==b.length?(b=M(""+b),b=!("f"==b||"0"==b||"false"==b||"no"==b||"n"==b||"[]"==b)):b=!1;return b}function ha(b){b=y(b).clone();try{b.empty()}catch(a){}var c=
y("<div>").append(b).html();try{return 3===b[0].nodeType?M(c):c.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+M(b)})}catch(d){return M(c)}}function dc(b){try{return decodeURIComponent(b)}catch(a){}}function ec(b){var a={},c,d;r((b||"").split("&"),function(b){b&&(c=b.replace(/\+/g,"%20").split("="),d=dc(c[0]),D(d)&&(b=D(c[1])?dc(c[1]):!0,ib.call(a,d)?L(a[d])?a[d].push(b):a[d]=[a[d],b]:a[d]=b))});return a}function Cb(b){var a=[];r(b,function(b,d){L(b)?r(b,function(b){a.push(Ba(d,
!0)+(!0===b?"":"="+Ba(b,!0)))}):a.push(Ba(d,!0)+(!0===b?"":"="+Ba(b,!0)))});return a.length?a.join("&"):""}function jb(b){return Ba(b,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function Ba(b,a){return encodeURIComponent(b).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,a?"%20":"+")}function Xc(b,a){function c(a){a&&d.push(a)}var d=[b],e,f,g=["ng:app","ng-app","x-ng-app","data-ng-app"],k=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;
r(g,function(a){g[a]=!0;c(X.getElementById(a));a=a.replace(":","\\:");b.querySelectorAll&&(r(b.querySelectorAll("."+a),c),r(b.querySelectorAll("."+a+"\\:"),c),r(b.querySelectorAll("["+a+"]"),c))});r(d,function(a){if(!e){var b=k.exec(" "+a.className+" ");b?(e=a,f=(b[2]||"").replace(/\s+/g,",")):r(a.attributes,function(b){!e&&g[b.name]&&(e=a,f=b.value)})}});e&&a(e,f?[f]:[])}function fc(b,a){var c=function(){b=y(b);if(b.injector()){var c=b[0]===X?"document":ha(b);throw Sa("btstrpd",c);}a=a||[];a.unshift(["$provide",
function(a){a.value("$rootElement",b)}]);a.unshift("ng");c=gc(a);c.invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(a,b,c,d,e){a.$apply(function(){b.data("$injector",d);c(b)(a)})}]);return c},d=/^NG_DEFER_BOOTSTRAP!/;if(P&&!d.test(P.name))return c();P.name=P.name.replace(d,"");Ua.resumeBootstrap=function(b){r(b,function(b){a.push(b)});c()}}function kb(b,a){a=a||"_";return b.replace(Yc,function(b,d){return(d?a:"")+b.toLowerCase()})}function Db(b,a,c){if(!b)throw Sa("areq",
a||"?",c||"required");return b}function Va(b,a,c){c&&L(b)&&(b=b[b.length-1]);Db(J(b),a,"not a function, got "+(b&&"object"===typeof b?b.constructor.name||"Object":typeof b));return b}function Ca(b,a){if("hasOwnProperty"===b)throw Sa("badname",a);}function hc(b,a,c){if(!a)return b;a=a.split(".");for(var d,e=b,f=a.length,g=0;g<f;g++)d=a[g],b&&(b=(e=b)[d]);return!c&&J(b)?Bb(e,b):b}function Eb(b){var a=b[0];b=b[b.length-1];if(a===b)return y(a);var c=[a];do{a=a.nextSibling;if(!a)break;c.push(a)}while(a!==
b);return y(c)}function Zc(b){var a=w("$injector"),c=w("ng");b=b.angular||(b.angular={});b.$$minErr=b.$$minErr||w;return b.module||(b.module=function(){var b={};return function(e,f,g){if("hasOwnProperty"===e)throw c("badname","module");f&&b.hasOwnProperty(e)&&(b[e]=null);return b[e]||(b[e]=function(){function b(a,d,e){return function(){c[e||"push"]([a,d,arguments]);return n}}if(!f)throw a("nomod",e);var c=[],d=[],l=b("$injector","invoke"),n={_invokeQueue:c,_runBlocks:d,requires:f,name:e,provider:b("$provide",
"provider"),factory:b("$provide","factory"),service:b("$provide","service"),value:b("$provide","value"),constant:b("$provide","constant","unshift"),animation:b("$animateProvider","register"),filter:b("$filterProvider","register"),controller:b("$controllerProvider","register"),directive:b("$compileProvider","directive"),config:l,run:function(a){d.push(a);return this}};g&&l(g);return n}())}}())}function $c(b){E(b,{bootstrap:fc,copy:Ha,extend:E,equals:za,element:y,forEach:r,injector:gc,noop:z,bind:Bb,
toJson:ta,fromJson:cc,identity:Ga,isUndefined:F,isDefined:D,isString:C,isFunction:J,isObject:T,isNumber:Ab,isElement:Uc,isArray:L,version:ad,isDate:sa,lowercase:M,uppercase:Ia,callbacks:{counter:0},$$minErr:w,$$csp:Wa});Xa=Zc(P);try{Xa("ngLocale")}catch(a){Xa("ngLocale",[]).provider("$locale",bd)}Xa("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:cd});a.provider("$compile",ic).directive({a:dd,input:jc,textarea:jc,form:ed,script:fd,select:gd,style:hd,option:id,ngBind:jd,ngBindHtml:kd,
ngBindTemplate:ld,ngClass:md,ngClassEven:nd,ngClassOdd:od,ngCloak:pd,ngController:qd,ngForm:rd,ngHide:sd,ngIf:td,ngInclude:ud,ngInit:vd,ngNonBindable:wd,ngPluralize:xd,ngRepeat:yd,ngShow:zd,ngStyle:Ad,ngSwitch:Bd,ngSwitchWhen:Cd,ngSwitchDefault:Dd,ngOptions:Ed,ngTransclude:Fd,ngModel:Gd,ngList:Hd,ngChange:Id,required:kc,ngRequired:kc,ngValue:Jd}).directive({ngInclude:Kd}).directive(Fb).directive(lc);a.provider({$anchorScroll:Ld,$animate:Md,$browser:Nd,$cacheFactory:Od,$controller:Pd,$document:Qd,
$exceptionHandler:Rd,$filter:mc,$interpolate:Sd,$interval:Td,$http:Ud,$httpBackend:Vd,$location:Wd,$log:Xd,$parse:Yd,$rootScope:Zd,$q:$d,$sce:ae,$sceDelegate:be,$sniffer:ce,$templateCache:de,$timeout:ee,$window:fe,$$rAF:ge,$$asyncCallback:he})}])}function Ya(b){return b.replace(ie,function(a,b,d,e){return e?d.toUpperCase():d}).replace(je,"Moz$1")}function Gb(b,a,c,d){function e(b){var e=c&&b?[this.filter(b)]:[this],m=a,h,l,n,p,q,t;if(!d||null!=b)for(;e.length;)for(h=e.shift(),l=0,n=h.length;l<n;l++)for(p=
y(h[l]),m?p.triggerHandler("$destroy"):m=!m,q=0,p=(t=p.children()).length;q<p;q++)e.push(Da(t[q]));return f.apply(this,arguments)}var f=Da.fn[b],f=f.$original||f;e.$original=f;Da.fn[b]=e}function S(b){if(b instanceof S)return b;C(b)&&(b=aa(b));if(!(this instanceof S)){if(C(b)&&"<"!=b.charAt(0))throw Hb("nosel");return new S(b)}if(C(b)){var a=b;b=X;var c;if(c=ke.exec(a))b=[b.createElement(c[1])];else{var d=b,e;b=d.createDocumentFragment();c=[];if(Ib.test(a)){d=b.appendChild(d.createElement("div"));
e=(le.exec(a)||["",""])[1].toLowerCase();e=ba[e]||ba._default;d.innerHTML="<div>&#160;</div>"+e[1]+a.replace(me,"<$1></$2>")+e[2];d.removeChild(d.firstChild);for(a=e[0];a--;)d=d.lastChild;a=0;for(e=d.childNodes.length;a<e;++a)c.push(d.childNodes[a]);d=b.firstChild;d.textContent=""}else c.push(d.createTextNode(a));b.textContent="";b.innerHTML="";b=c}Jb(this,b);y(X.createDocumentFragment()).append(this)}else Jb(this,b)}function Kb(b){return b.cloneNode(!0)}function Ja(b){Lb(b);var a=0;for(b=b.childNodes||
[];a<b.length;a++)Ja(b[a])}function nc(b,a,c,d){if(D(d))throw Hb("offargs");var e=ma(b,"events");ma(b,"handle")&&(F(a)?r(e,function(a,c){Za(b,c,a);delete e[c]}):r(a.split(" "),function(a){F(c)?(Za(b,a,e[a]),delete e[a]):Ra(e[a]||[],c)}))}function Lb(b,a){var c=b.ng339,d=$a[c];d&&(a?delete $a[c].data[a]:(d.handle&&(d.events.$destroy&&d.handle({},"$destroy"),nc(b)),delete $a[c],b.ng339=s))}function ma(b,a,c){var d=b.ng339,d=$a[d||-1];if(D(c))d||(b.ng339=d=++ne,d=$a[d]={}),d[a]=c;else return d&&d[a]}
function Mb(b,a,c){var d=ma(b,"data"),e=D(c),f=!e&&D(a),g=f&&!T(a);d||g||ma(b,"data",d={});if(e)d[a]=c;else if(f){if(g)return d&&d[a];E(d,a)}else return d}function Nb(b,a){return b.getAttribute?-1<(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+a+" "):!1}function lb(b,a){a&&b.setAttribute&&r(a.split(" "),function(a){b.setAttribute("class",aa((" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+aa(a)+" "," ")))})}function mb(b,a){if(a&&b.setAttribute){var c=
(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");r(a.split(" "),function(a){a=aa(a);-1===c.indexOf(" "+a+" ")&&(c+=a+" ")});b.setAttribute("class",aa(c))}}function Jb(b,a){if(a){a=a.nodeName||!D(a.length)||Fa(a)?[a]:a;for(var c=0;c<a.length;c++)b.push(a[c])}}function oc(b,a){return nb(b,"$"+(a||"ngController")+"Controller")}function nb(b,a,c){9==b.nodeType&&(b=b.documentElement);for(a=L(a)?a:[a];b;){for(var d=0,e=a.length;d<e;d++)if((c=y.data(b,a[d]))!==s)return c;b=b.parentNode||11===
b.nodeType&&b.host}}function pc(b){for(var a=0,c=b.childNodes;a<c.length;a++)Ja(c[a]);for(;b.firstChild;)b.removeChild(b.firstChild)}function qc(b,a){var c=ob[a.toLowerCase()];return c&&rc[b.nodeName]&&c}function oe(b,a){var c=function(c,e){c.preventDefault||(c.preventDefault=function(){c.returnValue=!1});c.stopPropagation||(c.stopPropagation=function(){c.cancelBubble=!0});c.target||(c.target=c.srcElement||X);if(F(c.defaultPrevented)){var f=c.preventDefault;c.preventDefault=function(){c.defaultPrevented=
!0;f.call(c)};c.defaultPrevented=!1}c.isDefaultPrevented=function(){return c.defaultPrevented||!1===c.returnValue};var g=ga(a[e||c.type]||[]);r(g,function(a){a.call(b,c)});8>=Q?(c.preventDefault=null,c.stopPropagation=null,c.isDefaultPrevented=null):(delete c.preventDefault,delete c.stopPropagation,delete c.isDefaultPrevented)};c.elem=b;return c}function Ka(b,a){var c=typeof b,d;"function"==c||"object"==c&&null!==b?"function"==typeof(d=b.$$hashKey)?d=b.$$hashKey():d===s&&(d=b.$$hashKey=(a||gb)()):
d=b;return c+":"+d}function ab(b,a){if(a){var c=0;this.nextUid=function(){return++c}}r(b,this.put,this)}function sc(b){var a,c;"function"===typeof b?(a=b.$inject)||(a=[],b.length&&(c=b.toString().replace(pe,""),c=c.match(qe),r(c[1].split(re),function(b){b.replace(se,function(b,c,d){a.push(d)})})),b.$inject=a):L(b)?(c=b.length-1,Va(b[c],"fn"),a=b.slice(0,c)):Va(b,"fn",!0);return a}function gc(b){function a(a){return function(b,c){if(T(b))r(b,$b(a));else return a(b,c)}}function c(a,b){Ca(a,"service");
if(J(b)||L(b))b=n.instantiate(b);if(!b.$get)throw bb("pget",a);return l[a+k]=b}function d(a,b){return c(a,{$get:b})}function e(a){var b=[],c,d,f,k;r(a,function(a){if(!h.get(a)){h.put(a,!0);try{if(C(a))for(c=Xa(a),b=b.concat(e(c.requires)).concat(c._runBlocks),d=c._invokeQueue,f=0,k=d.length;f<k;f++){var g=d[f],m=n.get(g[0]);m[g[1]].apply(m,g[2])}else J(a)?b.push(n.invoke(a)):L(a)?b.push(n.invoke(a)):Va(a,"module")}catch(l){throw L(a)&&(a=a[a.length-1]),l.message&&(l.stack&&-1==l.stack.indexOf(l.message))&&
(l=l.message+"\n"+l.stack),bb("modulerr",a,l.stack||l.message||l);}}});return b}function f(a,b){function c(d){if(a.hasOwnProperty(d)){if(a[d]===g)throw bb("cdep",d+" <- "+m.join(" <- "));return a[d]}try{return m.unshift(d),a[d]=g,a[d]=b(d)}catch(e){throw a[d]===g&&delete a[d],e;}finally{m.shift()}}function d(a,b,e){var f=[],k=sc(a),g,m,h;m=0;for(g=k.length;m<g;m++){h=k[m];if("string"!==typeof h)throw bb("itkn",h);f.push(e&&e.hasOwnProperty(h)?e[h]:c(h))}L(a)&&(a=a[g]);return a.apply(b,f)}return{invoke:d,
instantiate:function(a,b){var c=function(){},e;c.prototype=(L(a)?a[a.length-1]:a).prototype;c=new c;e=d(a,c,b);return T(e)||J(e)?e:c},get:c,annotate:sc,has:function(b){return l.hasOwnProperty(b+k)||a.hasOwnProperty(b)}}}var g={},k="Provider",m=[],h=new ab([],!0),l={$provide:{provider:a(c),factory:a(d),service:a(function(a,b){return d(a,["$injector",function(a){return a.instantiate(b)}])}),value:a(function(a,b){return d(a,$(b))}),constant:a(function(a,b){Ca(a,"constant");l[a]=b;p[a]=b}),decorator:function(a,
b){var c=n.get(a+k),d=c.$get;c.$get=function(){var a=q.invoke(d,c);return q.invoke(b,null,{$delegate:a})}}}},n=l.$injector=f(l,function(){throw bb("unpr",m.join(" <- "));}),p={},q=p.$injector=f(p,function(a){a=n.get(a+k);return q.invoke(a.$get,a)});r(e(b),function(a){q.invoke(a||z)});return q}function Ld(){var b=!0;this.disableAutoScrolling=function(){b=!1};this.$get=["$window","$location","$rootScope",function(a,c,d){function e(a){var b=null;r(a,function(a){b||"a"!==M(a.nodeName)||(b=a)});return b}
function f(){var b=c.hash(),d;b?(d=g.getElementById(b))?d.scrollIntoView():(d=e(g.getElementsByName(b)))?d.scrollIntoView():"top"===b&&a.scrollTo(0,0):a.scrollTo(0,0)}var g=a.document;b&&d.$watch(function(){return c.hash()},function(){d.$evalAsync(f)});return f}]}function he(){this.$get=["$$rAF","$timeout",function(b,a){return b.supported?function(a){return b(a)}:function(b){return a(b,0,!1)}}]}function te(b,a,c,d){function e(a){try{a.apply(null,Aa.call(arguments,1))}finally{if(t--,0===t)for(;K.length;)try{K.pop()()}catch(b){c.error(b)}}}
function f(a,b){(function ca(){r(x,function(a){a()});v=b(ca,a)})()}function g(){u=null;A!=k.url()&&(A=k.url(),r(da,function(a){a(k.url())}))}var k=this,m=a[0],h=b.location,l=b.history,n=b.setTimeout,p=b.clearTimeout,q={};k.isMock=!1;var t=0,K=[];k.$$completeOutstandingRequest=e;k.$$incOutstandingRequestCount=function(){t++};k.notifyWhenNoOutstandingRequests=function(a){r(x,function(a){a()});0===t?a():K.push(a)};var x=[],v;k.addPollFn=function(a){F(v)&&f(100,n);x.push(a);return a};var A=h.href,R=a.find("base"),
u=null;k.url=function(a,c){h!==b.location&&(h=b.location);l!==b.history&&(l=b.history);if(a){if(A!=a)return A=a,d.history?c?l.replaceState(null,"",a):(l.pushState(null,"",a),R.attr("href",R.attr("href"))):(u=a,c?h.replace(a):h.href=a),k}else return u||h.href.replace(/%27/g,"'")};var da=[],I=!1;k.onUrlChange=function(a){if(!I){if(d.history)y(b).on("popstate",g);if(d.hashchange)y(b).on("hashchange",g);else k.addPollFn(g);I=!0}da.push(a);return a};k.baseHref=function(){var a=R.attr("href");return a?
a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var W={},ea="",N=k.baseHref();k.cookies=function(a,b){var d,e,f,k;if(a)b===s?m.cookie=escape(a)+"=;path="+N+";expires=Thu, 01 Jan 1970 00:00:00 GMT":C(b)&&(d=(m.cookie=escape(a)+"="+escape(b)+";path="+N).length+1,4096<d&&c.warn("Cookie '"+a+"' possibly not set or overflowed because it was too large ("+d+" > 4096 bytes)!"));else{if(m.cookie!==ea)for(ea=m.cookie,d=ea.split("; "),W={},f=0;f<d.length;f++)e=d[f],k=e.indexOf("="),0<k&&(a=unescape(e.substring(0,
k)),W[a]===s&&(W[a]=unescape(e.substring(k+1))));return W}};k.defer=function(a,b){var c;t++;c=n(function(){delete q[c];e(a)},b||0);q[c]=!0;return c};k.defer.cancel=function(a){return q[a]?(delete q[a],p(a),e(z),!0):!1}}function Nd(){this.$get=["$window","$log","$sniffer","$document",function(b,a,c,d){return new te(b,d,a,c)}]}function Od(){this.$get=function(){function b(b,d){function e(a){a!=n&&(p?p==a&&(p=a.n):p=a,f(a.n,a.p),f(a,n),n=a,n.n=null)}function f(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(b in
a)throw w("$cacheFactory")("iid",b);var g=0,k=E({},d,{id:b}),m={},h=d&&d.capacity||Number.MAX_VALUE,l={},n=null,p=null;return a[b]={put:function(a,b){if(h<Number.MAX_VALUE){var c=l[a]||(l[a]={key:a});e(c)}if(!F(b))return a in m||g++,m[a]=b,g>h&&this.remove(p.key),b},get:function(a){if(h<Number.MAX_VALUE){var b=l[a];if(!b)return;e(b)}return m[a]},remove:function(a){if(h<Number.MAX_VALUE){var b=l[a];if(!b)return;b==n&&(n=b.p);b==p&&(p=b.n);f(b.n,b.p);delete l[a]}delete m[a];g--},removeAll:function(){m=
{};g=0;l={};n=p=null},destroy:function(){l=k=m=null;delete a[b]},info:function(){return E({},k,{size:g})}}}var a={};b.info=function(){var b={};r(a,function(a,e){b[e]=a.info()});return b};b.get=function(b){return a[b]};return b}}function de(){this.$get=["$cacheFactory",function(b){return b("templates")}]}function ic(b,a){var c={},d="Directive",e=/^\s*directive\:\s*([\d\w_\-]+)\s+(.*)$/,f=/(([\d\w_\-]+)(?:\:([^;]+))?;?)/,g=/^(on[a-z]+|formaction)$/;this.directive=function m(a,e){Ca(a,"directive");C(a)?
(Db(e,"directiveFactory"),c.hasOwnProperty(a)||(c[a]=[],b.factory(a+d,["$injector","$exceptionHandler",function(b,d){var e=[];r(c[a],function(c,f){try{var g=b.invoke(c);J(g)?g={compile:$(g)}:!g.compile&&g.link&&(g.compile=$(g.link));g.priority=g.priority||0;g.index=f;g.name=g.name||a;g.require=g.require||g.controller&&g.name;g.restrict=g.restrict||"A";e.push(g)}catch(m){d(m)}});return e}])),c[a].push(e)):r(a,$b(m));return this};this.aHrefSanitizationWhitelist=function(b){return D(b)?(a.aHrefSanitizationWhitelist(b),
this):a.aHrefSanitizationWhitelist()};this.imgSrcSanitizationWhitelist=function(b){return D(b)?(a.imgSrcSanitizationWhitelist(b),this):a.imgSrcSanitizationWhitelist()};this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(a,b,l,n,p,q,t,K,x,v,A,R){function u(a,b,c,d,e){a instanceof y||(a=y(a));r(a,function(b,c){3==b.nodeType&&b.nodeValue.match(/\S+/)&&(a[c]=y(b).wrap("<span></span>").parent()[0])});
var f=I(a,b,a,c,d,e);da(a,"ng-scope");return function(b,c,d,e){Db(b,"scope");var g=c?La.clone.call(a):a;r(d,function(a,b){g.data("$"+b+"Controller",a)});d=0;for(var m=g.length;d<m;d++){var h=g[d].nodeType;1!==h&&9!==h||g.eq(d).data("$scope",b)}c&&c(g,b);f&&f(b,g,g,e);return g}}function da(a,b){try{a.addClass(b)}catch(c){}}function I(a,b,c,d,e,f){function g(a,c,d,e){var f,h,l,q,n,p,t;f=c.length;var x=Array(f);for(q=0;q<f;q++)x[q]=c[q];p=q=0;for(n=m.length;q<n;p++)h=x[p],c=m[q++],f=m[q++],c?(c.scope?
(l=a.$new(),y.data(h,"$scope",l)):l=a,t=c.transcludeOnThisElement?W(a,c.transclude,e):!c.templateOnThisElement&&e?e:!e&&b?W(a,b):null,c(f,l,h,d,t)):f&&f(a,h.childNodes,s,e)}for(var m=[],h,l,q,n,p=0;p<a.length;p++)h=new Ob,l=ea(a[p],[],h,0===p?d:s,e),(f=l.length?G(l,a[p],h,b,c,null,[],[],f):null)&&f.scope&&da(h.$$element,"ng-scope"),h=f&&f.terminal||!(q=a[p].childNodes)||!q.length?null:I(q,f?(f.transcludeOnThisElement||!f.templateOnThisElement)&&f.transclude:b),m.push(f,h),n=n||f||h,f=null;return n?
g:null}function W(a,b,c){return function(d,e,f){var g=!1;d||(d=a.$new(),g=d.$$transcluded=!0);e=b(d,e,f,c);if(g)e.on("$destroy",function(){d.$destroy()});return e}}function ea(a,b,c,d,g){var h=c.$attr,m;switch(a.nodeType){case 1:ca(b,na(Ma(a).toLowerCase()),"E",d,g);for(var l,q,n,p=a.attributes,t=0,x=p&&p.length;t<x;t++){var K=!1,v=!1;l=p[t];if(!Q||8<=Q||l.specified){m=l.name;q=aa(l.value);l=na(m);if(n=V.test(l))m=kb(l.substr(6),"-");var A=l.replace(/(Start|End)$/,"");l===A+"Start"&&(K=m,v=m.substr(0,
m.length-5)+"end",m=m.substr(0,m.length-6));l=na(m.toLowerCase());h[l]=m;if(n||!c.hasOwnProperty(l))c[l]=q,qc(a,l)&&(c[l]=!0);P(a,b,q,l);ca(b,l,"A",d,g,K,v)}}a=a.className;if(C(a)&&""!==a)for(;m=f.exec(a);)l=na(m[2]),ca(b,l,"C",d,g)&&(c[l]=aa(m[3])),a=a.substr(m.index+m[0].length);break;case 3:w(b,a.nodeValue);break;case 8:try{if(m=e.exec(a.nodeValue))l=na(m[1]),ca(b,l,"M",d,g)&&(c[l]=aa(m[2]))}catch(u){}}b.sort(F);return b}function N(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw ia("uterdir",
b,c);1==a.nodeType&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--);d.push(a);a=a.nextSibling}while(0<e)}else d.push(a);return y(d)}function B(a,b,c){return function(d,e,f,g,m){e=N(e[0],b,c);return a(d,e,f,g,m)}}function G(a,c,d,e,f,g,m,n,p){function x(a,b,c,d){if(a){c&&(a=B(a,c,d));a.require=H.require;a.directiveName=oa;if(I===H||H.$$isolateScope)a=tc(a,{isolateScope:!0});m.push(a)}if(b){c&&(b=B(b,c,d));b.require=H.require;b.directiveName=oa;if(I===H||H.$$isolateScope)b=tc(b,{isolateScope:!0});n.push(b)}}
function K(a,b,c,d){var e,f="data",g=!1;if(C(b)){for(;"^"==(e=b.charAt(0))||"?"==e;)b=b.substr(1),"^"==e&&(f="inheritedData"),g=g||"?"==e;e=null;d&&"data"===f&&(e=d[b]);e=e||c[f]("$"+b+"Controller");if(!e&&!g)throw ia("ctreq",b,a);}else L(b)&&(e=[],r(b,function(b){e.push(K(a,b,c,d))}));return e}function v(a,e,f,g,p){function x(a,b){var c;2>arguments.length&&(b=a,a=s);Ea&&(c=ea);return p(a,b,c)}var A,O,u,R,B,N,ea={},qb;A=c===f?d:ga(d,new Ob(y(f),d.$attr));O=A.$$element;if(I){var Na=/^\s*([@=&])(\??)\s*(\w*)\s*$/;
N=e.$new(!0);!G||G!==I&&G!==I.$$originalDirective?O.data("$isolateScopeNoTemplate",N):O.data("$isolateScope",N);da(O,"ng-isolate-scope");r(I.scope,function(a,c){var d=a.match(Na)||[],f=d[3]||c,g="?"==d[2],d=d[1],m,l,n,p;N.$$isolateBindings[c]=d+f;switch(d){case "@":A.$observe(f,function(a){N[c]=a});A.$$observers[f].$$scope=e;A[f]&&(N[c]=b(A[f])(e));break;case "=":if(g&&!A[f])break;l=q(A[f]);p=l.literal?za:function(a,b){return a===b||a!==a&&b!==b};n=l.assign||function(){m=N[c]=l(e);throw ia("nonassign",
A[f],I.name);};m=N[c]=l(e);N.$watch(function(){var a=l(e);p(a,N[c])||(p(a,m)?n(e,a=N[c]):N[c]=a);return m=a},null,l.literal);break;case "&":l=q(A[f]);N[c]=function(a){return l(e,a)};break;default:throw ia("iscp",I.name,c,a);}})}qb=p&&x;W&&r(W,function(a){var b={$scope:a===I||a.$$isolateScope?N:e,$element:O,$attrs:A,$transclude:qb},c;B=a.controller;"@"==B&&(B=A[a.name]);c=t(B,b);ea[a.name]=c;Ea||O.data("$"+a.name+"Controller",c);a.controllerAs&&(b.$scope[a.controllerAs]=c)});g=0;for(u=m.length;g<u;g++)try{R=
m[g],R(R.isolateScope?N:e,O,A,R.require&&K(R.directiveName,R.require,O,ea),qb)}catch(ca){l(ca,ha(O))}g=e;I&&(I.template||null===I.templateUrl)&&(g=N);a&&a(g,f.childNodes,s,p);for(g=n.length-1;0<=g;g--)try{R=n[g],R(R.isolateScope?N:e,O,A,R.require&&K(R.directiveName,R.require,O,ea),qb)}catch(pb){l(pb,ha(O))}}p=p||{};for(var A=-Number.MAX_VALUE,R,W=p.controllerDirectives,I=p.newIsolateScopeDirective,G=p.templateDirective,ca=p.nonTlbTranscludeDirective,F=!1,E=!1,Ea=p.hasElementTranscludeDirective,w=
d.$$element=y(c),H,oa,U,S=e,Q,P=0,pa=a.length;P<pa;P++){H=a[P];var V=H.$$start,Y=H.$$end;V&&(w=N(c,V,Y));U=s;if(A>H.priority)break;if(U=H.scope)R=R||H,H.templateUrl||(M("new/isolated scope",I,H,w),T(U)&&(I=H));oa=H.name;!H.templateUrl&&H.controller&&(U=H.controller,W=W||{},M("'"+oa+"' controller",W[oa],H,w),W[oa]=H);if(U=H.transclude)F=!0,H.$$tlb||(M("transclusion",ca,H,w),ca=H),"element"==U?(Ea=!0,A=H.priority,U=w,w=d.$$element=y(X.createComment(" "+oa+": "+d[oa]+" ")),c=w[0],Na(f,Aa.call(U,0),c),
S=u(U,e,A,g&&g.name,{nonTlbTranscludeDirective:ca})):(U=y(Kb(c)).contents(),w.empty(),S=u(U,e));if(H.template)if(E=!0,M("template",G,H,w),G=H,U=J(H.template)?H.template(w,d):H.template,U=Z(U),H.replace){g=H;U=Ib.test(U)?y(aa(U)):[];c=U[0];if(1!=U.length||1!==c.nodeType)throw ia("tplrt",oa,"");Na(f,w,c);pa={$attr:{}};U=ea(c,[],pa);var $=a.splice(P+1,a.length-(P+1));I&&pb(U);a=a.concat(U).concat($);D(d,pa);pa=a.length}else w.html(U);if(H.templateUrl)E=!0,M("template",G,H,w),G=H,H.replace&&(g=H),v=z(a.splice(P,
a.length-P),w,d,f,F&&S,m,n,{controllerDirectives:W,newIsolateScopeDirective:I,templateDirective:G,nonTlbTranscludeDirective:ca}),pa=a.length;else if(H.compile)try{Q=H.compile(w,d,S),J(Q)?x(null,Q,V,Y):Q&&x(Q.pre,Q.post,V,Y)}catch(ba){l(ba,ha(w))}H.terminal&&(v.terminal=!0,A=Math.max(A,H.priority))}v.scope=R&&!0===R.scope;v.transcludeOnThisElement=F;v.templateOnThisElement=E;v.transclude=S;p.hasElementTranscludeDirective=Ea;return v}function pb(a){for(var b=0,c=a.length;b<c;b++)a[b]=bc(a[b],{$$isolateScope:!0})}
function ca(b,e,f,g,h,q,n){if(e===h)return null;h=null;if(c.hasOwnProperty(e)){var p;e=a.get(e+d);for(var t=0,x=e.length;t<x;t++)try{p=e[t],(g===s||g>p.priority)&&-1!=p.restrict.indexOf(f)&&(q&&(p=bc(p,{$$start:q,$$end:n})),b.push(p),h=p)}catch(K){l(K)}}return h}function D(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;r(a,function(d,e){"$"!=e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))});r(b,function(b,f){"class"==f?(da(e,b),a["class"]=(a["class"]?a["class"]+" ":
"")+b):"style"==f?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==f.charAt(0)||a.hasOwnProperty(f)||(a[f]=b,d[f]=c[f])})}function z(a,b,c,d,e,f,g,m){var h=[],l,q,t=b[0],x=a.shift(),K=E({},x,{templateUrl:null,transclude:null,replace:null,$$originalDirective:x}),A=J(x.templateUrl)?x.templateUrl(b,c):x.templateUrl;b.empty();n.get(v.getTrustedResourceUrl(A),{cache:p}).success(function(n){var p,v;n=Z(n);if(x.replace){n=Ib.test(n)?y(aa(n)):[];p=n[0];if(1!=n.length||1!==p.nodeType)throw ia("tplrt",
x.name,A);n={$attr:{}};Na(d,b,p);var u=ea(p,[],n);T(x.scope)&&pb(u);a=u.concat(a);D(c,n)}else p=t,b.html(n);a.unshift(K);l=G(a,p,c,e,b,x,f,g,m);r(d,function(a,c){a==p&&(d[c]=b[0])});for(q=I(b[0].childNodes,e);h.length;){n=h.shift();v=h.shift();var R=h.shift(),B=h.shift(),u=b[0];if(v!==t){var N=v.className;m.hasElementTranscludeDirective&&x.replace||(u=Kb(p));Na(R,y(v),u);da(y(u),N)}v=l.transcludeOnThisElement?W(n,l.transclude,B):B;l(q,n,u,d,v)}h=null}).error(function(a,b,c,d){throw ia("tpload",d.url);
});return function(a,b,c,d,e){a=e;h?(h.push(b),h.push(c),h.push(d),h.push(a)):(l.transcludeOnThisElement&&(a=W(b,l.transclude,e)),l(q,b,c,d,a))}}function F(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function M(a,b,c,d){if(b)throw ia("multidir",b.name,c.name,a,ha(d));}function w(a,c){var d=b(c,!0);d&&a.push({priority:0,compile:function(a){var b=a.parent().length;b&&da(a.parent(),"ng-binding");return function(a,c){var e=c.parent(),f=e.data("$binding")||
[];f.push(d);e.data("$binding",f);b||da(e,"ng-binding");a.$watch(d,function(a){c[0].nodeValue=a})}}})}function S(a,b){if("srcdoc"==b)return v.HTML;var c=Ma(a);if("xlinkHref"==b||"FORM"==c&&"action"==b||"IMG"!=c&&("src"==b||"ngSrc"==b))return v.RESOURCE_URL}function P(a,c,d,e){var f=b(d,!0);if(f){if("multiple"===e&&"SELECT"===Ma(a))throw ia("selmulti",ha(a));c.push({priority:100,compile:function(){return{pre:function(c,d,m){d=m.$$observers||(m.$$observers={});if(g.test(e))throw ia("nodomevents");if(f=
b(m[e],!0,S(a,e)))m[e]=f(c),(d[e]||(d[e]=[])).$$inter=!0,(m.$$observers&&m.$$observers[e].$$scope||c).$watch(f,function(a,b){"class"===e&&a!=b?m.$updateClass(a,b):m.$set(e,a)})}}}})}}function Na(a,b,c){var d=b[0],e=b.length,f=d.parentNode,g,m;if(a)for(g=0,m=a.length;g<m;g++)if(a[g]==d){a[g++]=c;m=g+e-1;for(var h=a.length;g<h;g++,m++)m<h?a[g]=a[m]:delete a[g];a.length-=e-1;break}f&&f.replaceChild(c,d);a=X.createDocumentFragment();a.appendChild(d);c[y.expando]=d[y.expando];d=1;for(e=b.length;d<e;d++)f=
b[d],y(f).remove(),a.appendChild(f),delete b[d];b[0]=c;b.length=1}function tc(a,b){return E(function(){return a.apply(null,arguments)},a,b)}var Ob=function(a,b){this.$$element=a;this.$attr=b||{}};Ob.prototype={$normalize:na,$addClass:function(a){a&&0<a.length&&A.addClass(this.$$element,a)},$removeClass:function(a){a&&0<a.length&&A.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=uc(a,b),d=uc(b,a);0===c.length?A.removeClass(this.$$element,d):0===d.length?A.addClass(this.$$element,c):
A.setClass(this.$$element,c,d)},$set:function(a,b,c,d){var e=qc(this.$$element[0],a);e&&(this.$$element.prop(a,b),d=e);this[a]=b;d?this.$attr[a]=d:(d=this.$attr[a])||(this.$attr[a]=d=kb(a,"-"));e=Ma(this.$$element);if("A"===e&&"href"===a||"IMG"===e&&"src"===a)this[a]=b=R(b,"src"===a);!1!==c&&(null===b||b===s?this.$$element.removeAttr(d):this.$$element.attr(d,b));(c=this.$$observers)&&r(c[a],function(a){try{a(b)}catch(c){l(c)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers={}),
e=d[a]||(d[a]=[]);e.push(b);K.$evalAsync(function(){e.$$inter||b(c[a])});return b}};var pa=b.startSymbol(),Ea=b.endSymbol(),Z="{{"==pa||"}}"==Ea?Ga:function(a){return a.replace(/\{\{/g,pa).replace(/}}/g,Ea)},V=/^ngAttr[A-Z]/;return u}]}function na(b){return Ya(b.replace(ue,""))}function uc(b,a){var c="",d=b.split(/\s+/),e=a.split(/\s+/),f=0;a:for(;f<d.length;f++){for(var g=d[f],k=0;k<e.length;k++)if(g==e[k])continue a;c+=(0<c.length?" ":"")+g}return c}function Pd(){var b={},a=/^(\S+)(\s+as\s+(\w+))?$/;
this.register=function(a,d){Ca(a,"controller");T(a)?E(b,a):b[a]=d};this.$get=["$injector","$window",function(c,d){return function(e,f){var g,k,m;C(e)&&(g=e.match(a),k=g[1],m=g[3],e=b.hasOwnProperty(k)?b[k]:hc(f.$scope,k,!0)||hc(d,k,!0),Va(e,k,!0));g=c.instantiate(e,f);if(m){if(!f||"object"!==typeof f.$scope)throw w("$controller")("noscp",k||e.name,m);f.$scope[m]=g}return g}}]}function Qd(){this.$get=["$window",function(b){return y(b.document)}]}function Rd(){this.$get=["$log",function(b){return function(a,
c){b.error.apply(b,arguments)}}]}function vc(b){var a={},c,d,e;if(!b)return a;r(b.split("\n"),function(b){e=b.indexOf(":");c=M(aa(b.substr(0,e)));d=aa(b.substr(e+1));c&&(a[c]=a[c]?a[c]+", "+d:d)});return a}function wc(b){var a=T(b)?b:s;return function(c){a||(a=vc(b));return c?a[M(c)]||null:a}}function xc(b,a,c){if(J(c))return c(b,a);r(c,function(c){b=c(b,a)});return b}function Ud(){var b=/^\s*(\[|\{[^\{])/,a=/[\}\]]\s*$/,c=/^\)\]\}',?\n/,d={"Content-Type":"application/json;charset=utf-8"},e=this.defaults=
{transformResponse:[function(d){C(d)&&(d=d.replace(c,""),b.test(d)&&a.test(d)&&(d=cc(d)));return d}],transformRequest:[function(a){return T(a)&&"[object File]"!==ya.call(a)&&"[object Blob]"!==ya.call(a)?ta(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:ga(d),put:ga(d),patch:ga(d)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},f=this.interceptors=[],g=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",
function(a,b,c,d,n,p){function q(a){function b(a){var d=E({},a,{data:xc(a.data,a.headers,c.transformResponse)});return 200<=a.status&&300>a.status?d:n.reject(d)}var c={method:"get",transformRequest:e.transformRequest,transformResponse:e.transformResponse},d=function(a){var b=e.headers,c=E({},a.headers),d,f,b=E({},b.common,b[M(a.method)]);a:for(d in b){a=M(d);for(f in c)if(M(f)===a)continue a;c[d]=b[d]}(function(a){var b;r(a,function(c,d){J(c)&&(b=c(),null!=b?a[d]=b:delete a[d])})})(c);return c}(a);
E(c,a);c.headers=d;c.method=Ia(c.method);var f=[function(a){d=a.headers;var c=xc(a.data,wc(d),a.transformRequest);F(c)&&r(d,function(a,b){"content-type"===M(b)&&delete d[b]});F(a.withCredentials)&&!F(e.withCredentials)&&(a.withCredentials=e.withCredentials);return t(a,c,d).then(b,b)},s],g=n.when(c);for(r(v,function(a){(a.request||a.requestError)&&f.unshift(a.request,a.requestError);(a.response||a.responseError)&&f.push(a.response,a.responseError)});f.length;){a=f.shift();var m=f.shift(),g=g.then(a,
m)}g.success=function(a){g.then(function(b){a(b.data,b.status,b.headers,c)});return g};g.error=function(a){g.then(null,function(b){a(b.data,b.status,b.headers,c)});return g};return g}function t(c,f,g){function h(a,b,c,e){B&&(200<=a&&300>a?B.put(y,[a,b,vc(c),e]):B.remove(y));p(b,a,c,e);d.$$phase||d.$apply()}function p(a,b,d,e){b=Math.max(b,0);(200<=b&&300>b?v.resolve:v.reject)({data:a,status:b,headers:wc(d),config:c,statusText:e})}function t(){var a=Qa(q.pendingRequests,c);-1!==a&&q.pendingRequests.splice(a,
1)}var v=n.defer(),r=v.promise,B,G,y=K(c.url,c.params);q.pendingRequests.push(c);r.then(t,t);!c.cache&&!e.cache||(!1===c.cache||"GET"!==c.method&&"JSONP"!==c.method)||(B=T(c.cache)?c.cache:T(e.cache)?e.cache:x);if(B)if(G=B.get(y),D(G)){if(G&&J(G.then))return G.then(t,t),G;L(G)?p(G[1],G[0],ga(G[2]),G[3]):p(G,200,{},"OK")}else B.put(y,r);F(G)&&((G=Pb(c.url)?b.cookies()[c.xsrfCookieName||e.xsrfCookieName]:s)&&(g[c.xsrfHeaderName||e.xsrfHeaderName]=G),a(c.method,y,f,h,g,c.timeout,c.withCredentials,c.responseType));
return r}function K(a,b){if(!b)return a;var c=[];Tc(b,function(a,b){null===a||F(a)||(L(a)||(a=[a]),r(a,function(a){T(a)&&(sa(a)?a=a.toISOString():T(a)&&(a=ta(a)));c.push(Ba(b)+"="+Ba(a))}))});0<c.length&&(a+=(-1==a.indexOf("?")?"?":"&")+c.join("&"));return a}var x=c("$http"),v=[];r(f,function(a){v.unshift(C(a)?p.get(a):p.invoke(a))});r(g,function(a,b){var c=C(a)?p.get(a):p.invoke(a);v.splice(b,0,{response:function(a){return c(n.when(a))},responseError:function(a){return c(n.reject(a))}})});q.pendingRequests=
[];(function(a){r(arguments,function(a){q[a]=function(b,c){return q(E(c||{},{method:a,url:b}))}})})("get","delete","head","jsonp");(function(a){r(arguments,function(a){q[a]=function(b,c,d){return q(E(d||{},{method:a,url:b,data:c}))}})})("post","put");q.defaults=e;return q}]}function ve(b){if(8>=Q&&(!b.match(/^(get|post|head|put|delete|options)$/i)||!P.XMLHttpRequest))return new P.ActiveXObject("Microsoft.XMLHTTP");if(P.XMLHttpRequest)return new P.XMLHttpRequest;throw w("$httpBackend")("noxhr");}function Vd(){this.$get=
["$browser","$window","$document",function(b,a,c){return we(b,ve,b.defer,a.angular.callbacks,c[0])}]}function we(b,a,c,d,e){function f(a,b,c){var f=e.createElement("script"),g=null;f.type="text/javascript";f.src=a;f.async=!0;g=function(a){Za(f,"load",g);Za(f,"error",g);e.body.removeChild(f);f=null;var k=-1,t="unknown";a&&("load"!==a.type||d[b].called||(a={type:"error"}),t=a.type,k="error"===a.type?404:200);c&&c(k,t)};rb(f,"load",g);rb(f,"error",g);8>=Q&&(f.onreadystatechange=function(){C(f.readyState)&&
/loaded|complete/.test(f.readyState)&&(f.onreadystatechange=null,g({type:"load"}))});e.body.appendChild(f);return g}var g=-1;return function(e,m,h,l,n,p,q,t){function K(){v=g;R&&R();u&&u.abort()}function x(a,d,e,f,g){I&&c.cancel(I);R=u=null;0===d&&(d=e?200:"file"==ua(m).protocol?404:0);a(1223===d?204:d,e,f,g||"");b.$$completeOutstandingRequest(z)}var v;b.$$incOutstandingRequestCount();m=m||b.url();if("jsonp"==M(e)){var A="_"+(d.counter++).toString(36);d[A]=function(a){d[A].data=a;d[A].called=!0};
var R=f(m.replace("JSON_CALLBACK","angular.callbacks."+A),A,function(a,b){x(l,a,d[A].data,"",b);d[A]=z})}else{var u=a(e);u.open(e,m,!0);r(n,function(a,b){D(a)&&u.setRequestHeader(b,a)});u.onreadystatechange=function(){if(u&&4==u.readyState){var a=null,b=null,c="";v!==g&&(a=u.getAllResponseHeaders(),b="response"in u?u.response:u.responseText);v===g&&10>Q||(c=u.statusText);x(l,v||u.status,b,a,c)}};q&&(u.withCredentials=!0);if(t)try{u.responseType=t}catch(da){if("json"!==t)throw da;}u.send(h||null)}if(0<
p)var I=c(K,p);else p&&J(p.then)&&p.then(K)}}function Sd(){var b="{{",a="}}";this.startSymbol=function(a){return a?(b=a,this):b};this.endSymbol=function(b){return b?(a=b,this):a};this.$get=["$parse","$exceptionHandler","$sce",function(c,d,e){function f(f,h,l){for(var n,p,q=0,t=[],K=f.length,x=!1,v=[];q<K;)-1!=(n=f.indexOf(b,q))&&-1!=(p=f.indexOf(a,n+g))?(q!=n&&t.push(f.substring(q,n)),t.push(q=c(x=f.substring(n+g,p))),q.exp=x,q=p+k,x=!0):(q!=K&&t.push(f.substring(q)),q=K);(K=t.length)||(t.push(""),
K=1);if(l&&1<t.length)throw yc("noconcat",f);if(!h||x)return v.length=K,q=function(a){try{for(var b=0,c=K,g;b<c;b++){if("function"==typeof(g=t[b]))if(g=g(a),g=l?e.getTrusted(l,g):e.valueOf(g),null==g)g="";else switch(typeof g){case "string":break;case "number":g=""+g;break;default:g=ta(g)}v[b]=g}return v.join("")}catch(k){a=yc("interr",f,k.toString()),d(a)}},q.exp=f,q.parts=t,q}var g=b.length,k=a.length;f.startSymbol=function(){return b};f.endSymbol=function(){return a};return f}]}function Td(){this.$get=
["$rootScope","$window","$q",function(b,a,c){function d(d,g,k,m){var h=a.setInterval,l=a.clearInterval,n=c.defer(),p=n.promise,q=0,t=D(m)&&!m;k=D(k)?k:0;p.then(null,null,d);p.$$intervalId=h(function(){n.notify(q++);0<k&&q>=k&&(n.resolve(q),l(p.$$intervalId),delete e[p.$$intervalId]);t||b.$apply()},g);e[p.$$intervalId]=n;return p}var e={};d.cancel=function(b){return b&&b.$$intervalId in e?(e[b.$$intervalId].reject("canceled"),a.clearInterval(b.$$intervalId),delete e[b.$$intervalId],!0):!1};return d}]}
function bd(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"\u00a4",posSuf:"",negPre:"(\u00a4",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January February March April May June July August September October November December".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),
DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(b){return 1===b?"one":"other"}}}}function Qb(b){b=b.split("/");for(var a=b.length;a--;)b[a]=jb(b[a]);return b.join("/")}function zc(b,a,c){b=ua(b,c);a.$$protocol=
b.protocol;a.$$host=b.hostname;a.$$port=Z(b.port)||xe[b.protocol]||null}function Ac(b,a,c){var d="/"!==b.charAt(0);d&&(b="/"+b);b=ua(b,c);a.$$path=decodeURIComponent(d&&"/"===b.pathname.charAt(0)?b.pathname.substring(1):b.pathname);a.$$search=ec(b.search);a.$$hash=decodeURIComponent(b.hash);a.$$path&&"/"!=a.$$path.charAt(0)&&(a.$$path="/"+a.$$path)}function qa(b,a){if(0===a.indexOf(b))return a.substr(b.length)}function cb(b){var a=b.indexOf("#");return-1==a?b:b.substr(0,a)}function Rb(b){return b.substr(0,
cb(b).lastIndexOf("/")+1)}function Bc(b,a){this.$$html5=!0;a=a||"";var c=Rb(b);zc(b,this,b);this.$$parse=function(a){var e=qa(c,a);if(!C(e))throw Sb("ipthprfx",a,c);Ac(e,this,b);this.$$path||(this.$$path="/");this.$$compose()};this.$$compose=function(){var a=Cb(this.$$search),b=this.$$hash?"#"+jb(this.$$hash):"";this.$$url=Qb(this.$$path)+(a?"?"+a:"")+b;this.$$absUrl=c+this.$$url.substr(1)};this.$$rewrite=function(d){var e;if((e=qa(b,d))!==s)return d=e,(e=qa(a,e))!==s?c+(qa("/",e)||e):b+d;if((e=qa(c,
d))!==s)return c+e;if(c==d+"/")return c}}function Tb(b,a){var c=Rb(b);zc(b,this,b);this.$$parse=function(d){var e=qa(b,d)||qa(c,d),e="#"==e.charAt(0)?qa(a,e):this.$$html5?e:"";if(!C(e))throw Sb("ihshprfx",d,a);Ac(e,this,b);d=this.$$path;var f=/^\/[A-Z]:(\/.*)/;0===e.indexOf(b)&&(e=e.replace(b,""));f.exec(e)||(d=(e=f.exec(d))?e[1]:d);this.$$path=d;this.$$compose()};this.$$compose=function(){var c=Cb(this.$$search),e=this.$$hash?"#"+jb(this.$$hash):"";this.$$url=Qb(this.$$path)+(c?"?"+c:"")+e;this.$$absUrl=
b+(this.$$url?a+this.$$url:"")};this.$$rewrite=function(a){if(cb(b)==cb(a))return a}}function Ub(b,a){this.$$html5=!0;Tb.apply(this,arguments);var c=Rb(b);this.$$rewrite=function(d){var e;if(b==cb(d))return d;if(e=qa(c,d))return b+a+e;if(c===d+"/")return c};this.$$compose=function(){var c=Cb(this.$$search),e=this.$$hash?"#"+jb(this.$$hash):"";this.$$url=Qb(this.$$path)+(c?"?"+c:"")+e;this.$$absUrl=b+a+this.$$url}}function sb(b){return function(){return this[b]}}function Cc(b,a){return function(c){if(F(c))return this[b];
this[b]=a(c);this.$$compose();return this}}function Wd(){var b="",a=!1;this.hashPrefix=function(a){return D(a)?(b=a,this):b};this.html5Mode=function(b){return D(b)?(a=b,this):a};this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(c,d,e,f){function g(a){c.$broadcast("$locationChangeSuccess",k.absUrl(),a)}var k,m,h=d.baseHref(),l=d.url(),n;a?(n=l.substring(0,l.indexOf("/",l.indexOf("//")+2))+(h||"/"),m=e.history?Bc:Ub):(n=cb(l),m=Tb);k=new m(n,"#"+b);k.$$parse(k.$$rewrite(l));var p=
/^\s*(javascript|mailto):/i;f.on("click",function(a){if(!a.ctrlKey&&!a.metaKey&&2!=a.which){for(var e=y(a.target);"a"!==M(e[0].nodeName);)if(e[0]===f[0]||!(e=e.parent())[0])return;var g=e.prop("href");T(g)&&"[object SVGAnimatedString]"===g.toString()&&(g=ua(g.animVal).href);if(!p.test(g)){if(m===Ub){var h=e.attr("href")||e.attr("xlink:href");if(0>h.indexOf("://"))if(g="#"+b,"/"==h[0])g=n+g+h;else if("#"==h[0])g=n+g+(k.path()||"/")+h;else{for(var l=k.path().split("/"),h=h.split("/"),q=0;q<h.length;q++)"."!=
h[q]&&(".."==h[q]?l.pop():h[q].length&&l.push(h[q]));g=n+g+l.join("/")}}l=k.$$rewrite(g);g&&(!e.attr("target")&&l&&!a.isDefaultPrevented())&&(a.preventDefault(),l!=d.url()&&(k.$$parse(l),c.$apply(),P.angular["ff-684208-preventDefault"]=!0))}}});k.absUrl()!=l&&d.url(k.absUrl(),!0);d.onUrlChange(function(a){k.absUrl()!=a&&(c.$evalAsync(function(){var b=k.absUrl();k.$$parse(a);c.$broadcast("$locationChangeStart",a,b).defaultPrevented?(k.$$parse(b),d.url(b)):g(b)}),c.$$phase||c.$digest())});var q=0;c.$watch(function(){var a=
d.url(),b=k.$$replace;q&&a==k.absUrl()||(q++,c.$evalAsync(function(){c.$broadcast("$locationChangeStart",k.absUrl(),a).defaultPrevented?k.$$parse(a):(d.url(k.absUrl(),b),g(a))}));k.$$replace=!1;return q});return k}]}function Xd(){var b=!0,a=this;this.debugEnabled=function(a){return D(a)?(b=a,this):b};this.$get=["$window",function(c){function d(a){a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+
":"+a.line));return a}function e(a){var b=c.console||{},e=b[a]||b.log||z;a=!1;try{a=!!e.apply}catch(m){}return a?function(){var a=[];r(arguments,function(b){a.push(d(b))});return e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){b&&c.apply(a,arguments)}}()}}]}function ja(b,a){if("__defineGetter__"===b||"__defineSetter__"===b||"__lookupGetter__"===b||"__lookupSetter__"===b||"__proto__"===
b)throw ka("isecfld",a);return b}function Oa(b,a){if(b){if(b.constructor===b)throw ka("isecfn",a);if(b.document&&b.location&&b.alert&&b.setInterval)throw ka("isecwindow",a);if(b.children&&(b.nodeName||b.prop&&b.attr&&b.find))throw ka("isecdom",a);if(b===Object)throw ka("isecobj",a);}return b}function tb(b,a,c,d,e){e=e||{};a=a.split(".");for(var f,g=0;1<a.length;g++){f=ja(a.shift(),d);var k=b[f];k||(k={},b[f]=k);b=k;b.then&&e.unwrapPromises&&(va(d),"$$v"in b||function(a){a.then(function(b){a.$$v=b})}(b),
b.$$v===s&&(b.$$v={}),b=b.$$v)}f=ja(a.shift(),d);Oa(b,d);Oa(b[f],d);return b[f]=c}function Dc(b,a,c,d,e,f,g){ja(b,f);ja(a,f);ja(c,f);ja(d,f);ja(e,f);return g.unwrapPromises?function(g,m){var h=m&&m.hasOwnProperty(b)?m:g,l;if(null==h)return h;(h=h[b])&&h.then&&(va(f),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!a)return h;if(null==h)return s;(h=h[a])&&h.then&&(va(f),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!c)return h;if(null==h)return s;(h=h[c])&&h.then&&
(va(f),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!d)return h;if(null==h)return s;(h=h[d])&&h.then&&(va(f),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!e)return h;if(null==h)return s;(h=h[e])&&h.then&&(va(f),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);return h}:function(f,g){var h=g&&g.hasOwnProperty(b)?g:f;if(null==h)return h;h=h[b];if(!a)return h;if(null==h)return s;h=h[a];if(!c)return h;if(null==h)return s;h=h[c];if(!d)return h;if(null==
h)return s;h=h[d];return e?null==h?s:h=h[e]:h}}function Ec(b,a,c){if(Vb.hasOwnProperty(b))return Vb[b];var d=b.split("."),e=d.length,f;if(a.csp)f=6>e?Dc(d[0],d[1],d[2],d[3],d[4],c,a):function(b,f){var g=0,k;do k=Dc(d[g++],d[g++],d[g++],d[g++],d[g++],c,a)(b,f),f=s,b=k;while(g<e);return k};else{var g="var p;\n";r(d,function(b,d){ja(b,c);g+="if(s == null) return undefined;\ns="+(d?"s":'((k&&k.hasOwnProperty("'+b+'"))?k:s)')+'["'+b+'"];\n'+(a.unwrapPromises?'if (s && s.then) {\n pw("'+c.replace(/(["\r\n])/g,
"\\$1")+'");\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v=v;});\n}\n s=s.$$v\n}\n':"")});var g=g+"return s;",k=new Function("s","k","pw",g);k.toString=$(g);f=a.unwrapPromises?function(a,b){return k(a,b,va)}:k}"hasOwnProperty"!==b&&(Vb[b]=f);return f}function Yd(){var b={},a={csp:!1,unwrapPromises:!1,logPromiseWarnings:!0};this.unwrapPromises=function(b){return D(b)?(a.unwrapPromises=!!b,this):a.unwrapPromises};this.logPromiseWarnings=function(b){return D(b)?(a.logPromiseWarnings=
b,this):a.logPromiseWarnings};this.$get=["$filter","$sniffer","$log",function(c,d,e){a.csp=d.csp;va=function(b){a.logPromiseWarnings&&!Fc.hasOwnProperty(b)&&(Fc[b]=!0,e.warn("[$parse] Promise found in the expression `"+b+"`. Automatic unwrapping of promises in Angular expressions is deprecated."))};return function(d){var e;switch(typeof d){case "string":if(b.hasOwnProperty(d))return b[d];e=new Wb(a);e=(new db(e,c,a)).parse(d);"hasOwnProperty"!==d&&(b[d]=e);return e;case "function":return d;default:return z}}}]}
function $d(){this.$get=["$rootScope","$exceptionHandler",function(b,a){return ye(function(a){b.$evalAsync(a)},a)}]}function ye(b,a){function c(a){return a}function d(a){return g(a)}var e=function(){var g=[],h,l;return l={resolve:function(a){if(g){var c=g;g=s;h=f(a);c.length&&b(function(){for(var a,b=0,d=c.length;b<d;b++)a=c[b],h.then(a[0],a[1],a[2])})}},reject:function(a){l.resolve(k(a))},notify:function(a){if(g){var c=g;g.length&&b(function(){for(var b,d=0,e=c.length;d<e;d++)b=c[d],b[2](a)})}},
promise:{then:function(b,f,k){var l=e(),K=function(d){try{l.resolve((J(b)?b:c)(d))}catch(e){l.reject(e),a(e)}},x=function(b){try{l.resolve((J(f)?f:d)(b))}catch(c){l.reject(c),a(c)}},v=function(b){try{l.notify((J(k)?k:c)(b))}catch(d){a(d)}};g?g.push([K,x,v]):h.then(K,x,v);return l.promise},"catch":function(a){return this.then(null,a)},"finally":function(a){function b(a,c){var d=e();c?d.resolve(a):d.reject(a);return d.promise}function d(e,f){var g=null;try{g=(a||c)()}catch(k){return b(k,!1)}return g&&
J(g.then)?g.then(function(){return b(e,f)},function(a){return b(a,!1)}):b(e,f)}return this.then(function(a){return d(a,!0)},function(a){return d(a,!1)})}}}},f=function(a){return a&&J(a.then)?a:{then:function(c){var d=e();b(function(){d.resolve(c(a))});return d.promise}}},g=function(a){var b=e();b.reject(a);return b.promise},k=function(c){return{then:function(f,g){var k=e();b(function(){try{k.resolve((J(g)?g:d)(c))}catch(b){k.reject(b),a(b)}});return k.promise}}};return{defer:e,reject:g,when:function(k,
h,l,n){var p=e(),q,t=function(b){try{return(J(h)?h:c)(b)}catch(d){return a(d),g(d)}},K=function(b){try{return(J(l)?l:d)(b)}catch(c){return a(c),g(c)}},x=function(b){try{return(J(n)?n:c)(b)}catch(d){a(d)}};b(function(){f(k).then(function(a){q||(q=!0,p.resolve(f(a).then(t,K,x)))},function(a){q||(q=!0,p.resolve(K(a)))},function(a){q||p.notify(x(a))})});return p.promise},all:function(a){var b=e(),c=0,d=L(a)?[]:{};r(a,function(a,e){c++;f(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},
function(a){d.hasOwnProperty(e)||b.reject(a)})});0===c&&b.resolve(d);return b.promise}}}function ge(){this.$get=["$window","$timeout",function(b,a){var c=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame,d=b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.webkitCancelRequestAnimationFrame,e=!!c,f=e?function(a){var b=c(a);return function(){d(b)}}:function(b){var c=a(b,16.66,!1);return function(){a.cancel(c)}};f.supported=e;return f}]}
function Zd(){var b=10,a=w("$rootScope"),c=null;this.digestTtl=function(a){arguments.length&&(b=a);return b};this.$get=["$injector","$exceptionHandler","$parse","$browser",function(d,e,f,g){function k(){this.$id=gb();this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this["this"]=this.$root=this;this.$$destroyed=!1;this.$$asyncQueue=[];this.$$postDigestQueue=[];this.$$listeners={};this.$$listenerCount={};this.$$isolateBindings={}}
function m(b){if(p.$$phase)throw a("inprog",p.$$phase);p.$$phase=b}function h(a,b){var c=f(a);Va(c,b);return c}function l(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function n(){}k.prototype={constructor:k,$new:function(a){a?(a=new k,a.$root=this.$root,a.$$asyncQueue=this.$$asyncQueue,a.$$postDigestQueue=this.$$postDigestQueue):(this.$$childScopeClass||(this.$$childScopeClass=function(){this.$$watchers=this.$$nextSibling=this.$$childHead=
this.$$childTail=null;this.$$listeners={};this.$$listenerCount={};this.$id=gb();this.$$childScopeClass=null},this.$$childScopeClass.prototype=this),a=new this.$$childScopeClass);a["this"]=a;a.$parent=this;a.$$prevSibling=this.$$childTail;this.$$childHead?this.$$childTail=this.$$childTail.$$nextSibling=a:this.$$childHead=this.$$childTail=a;return a},$watch:function(a,b,d){var e=h(a,"watch"),f=this.$$watchers,g={fn:b,last:n,get:e,exp:a,eq:!!d};c=null;if(!J(b)){var k=h(b||z,"listener");g.fn=function(a,
b,c){k(c)}}if("string"==typeof a&&e.constant){var m=g.fn;g.fn=function(a,b,c){m.call(this,a,b,c);Ra(f,g)}}f||(f=this.$$watchers=[]);f.unshift(g);return function(){Ra(f,g);c=null}},$watchCollection:function(a,b){var c=this,d,e,g,k=1<b.length,h=0,m=f(a),l=[],p={},n=!0,r=0;return this.$watch(function(){d=m(c);var a,b,f;if(T(d))if(fb(d))for(e!==l&&(e=l,r=e.length=0,h++),a=d.length,r!==a&&(h++,e.length=r=a),b=0;b<a;b++)f=e[b]!==e[b]&&d[b]!==d[b],f||e[b]===d[b]||(h++,e[b]=d[b]);else{e!==p&&(e=p={},r=0,
h++);a=0;for(b in d)d.hasOwnProperty(b)&&(a++,e.hasOwnProperty(b)?(f=e[b]!==e[b]&&d[b]!==d[b],f||e[b]===d[b]||(h++,e[b]=d[b])):(r++,e[b]=d[b],h++));if(r>a)for(b in h++,e)e.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(r--,delete e[b])}else e!==d&&(e=d,h++);return h},function(){n?(n=!1,b(d,d,c)):b(d,g,c);if(k)if(T(d))if(fb(d)){g=Array(d.length);for(var a=0;a<d.length;a++)g[a]=d[a]}else for(a in g={},d)ib.call(d,a)&&(g[a]=d[a]);else g=d})},$digest:function(){var d,f,g,k,h=this.$$asyncQueue,l=this.$$postDigestQueue,
r,u,s=b,I,W=[],y,N,B;m("$digest");c=null;do{u=!1;for(I=this;h.length;){try{B=h.shift(),B.scope.$eval(B.expression)}catch(G){p.$$phase=null,e(G)}c=null}a:do{if(k=I.$$watchers)for(r=k.length;r--;)try{if(d=k[r])if((f=d.get(I))!==(g=d.last)&&!(d.eq?za(f,g):"number"===typeof f&&"number"===typeof g&&isNaN(f)&&isNaN(g)))u=!0,c=d,d.last=d.eq?Ha(f,null):f,d.fn(f,g===n?f:g,I),5>s&&(y=4-s,W[y]||(W[y]=[]),N=J(d.exp)?"fn: "+(d.exp.name||d.exp.toString()):d.exp,N+="; newVal: "+ta(f)+"; oldVal: "+ta(g),W[y].push(N));
else if(d===c){u=!1;break a}}catch(D){p.$$phase=null,e(D)}if(!(k=I.$$childHead||I!==this&&I.$$nextSibling))for(;I!==this&&!(k=I.$$nextSibling);)I=I.$parent}while(I=k);if((u||h.length)&&!s--)throw p.$$phase=null,a("infdig",b,ta(W));}while(u||h.length);for(p.$$phase=null;l.length;)try{l.shift()()}catch(w){e(w)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;this.$broadcast("$destroy");this.$$destroyed=!0;this!==p&&(r(this.$$listenerCount,Bb(null,l,this)),a.$$childHead==this&&(a.$$childHead=
this.$$nextSibling),a.$$childTail==this&&(a.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=null,this.$$listeners={},this.$$watchers=this.$$asyncQueue=this.$$postDigestQueue=[],this.$destroy=this.$digest=this.$apply=z,this.$on=this.$watch=function(){return z})}},$eval:function(a,
b){return f(a)(this,b)},$evalAsync:function(a){p.$$phase||p.$$asyncQueue.length||g.defer(function(){p.$$asyncQueue.length&&p.$digest()});this.$$asyncQueue.push({scope:this,expression:a})},$$postDigest:function(a){this.$$postDigestQueue.push(a)},$apply:function(a){try{return m("$apply"),this.$eval(a)}catch(b){e(b)}finally{p.$$phase=null;try{p.$digest()}catch(c){throw e(c),c;}}},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]);c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=
0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){c[Qa(c,b)]=null;l(e,1,a)}},$emit:function(a,b){var c=[],d,f=this,g=!1,k={name:a,targetScope:f,stopPropagation:function(){g=!0},preventDefault:function(){k.defaultPrevented=!0},defaultPrevented:!1},h=[k].concat(Aa.call(arguments,1)),m,l;do{d=f.$$listeners[a]||c;k.currentScope=f;m=0;for(l=d.length;m<l;m++)if(d[m])try{d[m].apply(null,h)}catch(p){e(p)}else d.splice(m,1),m--,l--;if(g)break;f=f.$parent}while(f);return k},$broadcast:function(a,
b){for(var c=this,d=this,f={name:a,targetScope:this,preventDefault:function(){f.defaultPrevented=!0},defaultPrevented:!1},g=[f].concat(Aa.call(arguments,1)),k,h;c=d;){f.currentScope=c;d=c.$$listeners[a]||[];k=0;for(h=d.length;k<h;k++)if(d[k])try{d[k].apply(null,g)}catch(m){e(m)}else d.splice(k,1),k--,h--;if(!(d=c.$$listenerCount[a]&&c.$$childHead||c!==this&&c.$$nextSibling))for(;c!==this&&!(d=c.$$nextSibling);)c=c.$parent}return f}};var p=new k;return p}]}function cd(){var b=/^\s*(https?|ftp|mailto|tel|file):/,
a=/^\s*(https?|ftp|file):|data:image\//;this.aHrefSanitizationWhitelist=function(a){return D(a)?(b=a,this):b};this.imgSrcSanitizationWhitelist=function(b){return D(b)?(a=b,this):a};this.$get=function(){return function(c,d){var e=d?a:b,f;if(!Q||8<=Q)if(f=ua(c).href,""!==f&&!f.match(e))return"unsafe:"+f;return c}}}function ze(b){if("self"===b)return b;if(C(b)){if(-1<b.indexOf("***"))throw wa("iwcard",b);b=b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace("\\*\\*",".*").replace("\\*",
"[^:/.?&;]*");return RegExp("^"+b+"$")}if(hb(b))return RegExp("^"+b.source+"$");throw wa("imatcher");}function Gc(b){var a=[];D(b)&&r(b,function(b){a.push(ze(b))});return a}function be(){this.SCE_CONTEXTS=fa;var b=["self"],a=[];this.resourceUrlWhitelist=function(a){arguments.length&&(b=Gc(a));return b};this.resourceUrlBlacklist=function(b){arguments.length&&(a=Gc(b));return a};this.$get=["$injector",function(c){function d(a){var b=function(a){this.$$unwrapTrustedValue=function(){return a}};a&&(b.prototype=
new a);b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()};b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()};return b}var e=function(a){throw wa("unsafe");};c.has("$sanitize")&&(e=c.get("$sanitize"));var f=d(),g={};g[fa.HTML]=d(f);g[fa.CSS]=d(f);g[fa.URL]=d(f);g[fa.JS]=d(f);g[fa.RESOURCE_URL]=d(g[fa.URL]);return{trustAs:function(a,b){var c=g.hasOwnProperty(a)?g[a]:null;if(!c)throw wa("icontext",a,b);if(null===b||b===s||""===b)return b;if("string"!==typeof b)throw wa("itype",
a);return new c(b)},getTrusted:function(c,d){if(null===d||d===s||""===d)return d;var f=g.hasOwnProperty(c)?g[c]:null;if(f&&d instanceof f)return d.$$unwrapTrustedValue();if(c===fa.RESOURCE_URL){var f=ua(d.toString()),l,n,p=!1;l=0;for(n=b.length;l<n;l++)if("self"===b[l]?Pb(f):b[l].exec(f.href)){p=!0;break}if(p)for(l=0,n=a.length;l<n;l++)if("self"===a[l]?Pb(f):a[l].exec(f.href)){p=!1;break}if(p)return d;throw wa("insecurl",d.toString());}if(c===fa.HTML)return e(d);throw wa("unsafe");},valueOf:function(a){return a instanceof
f?a.$$unwrapTrustedValue():a}}}]}function ae(){var b=!0;this.enabled=function(a){arguments.length&&(b=!!a);return b};this.$get=["$parse","$sniffer","$sceDelegate",function(a,c,d){if(b&&c.msie&&8>c.msieDocumentMode)throw wa("iequirks");var e=ga(fa);e.isEnabled=function(){return b};e.trustAs=d.trustAs;e.getTrusted=d.getTrusted;e.valueOf=d.valueOf;b||(e.trustAs=e.getTrusted=function(a,b){return b},e.valueOf=Ga);e.parseAs=function(b,c){var d=a(c);return d.literal&&d.constant?d:function(a,c){return e.getTrusted(b,
d(a,c))}};var f=e.parseAs,g=e.getTrusted,k=e.trustAs;r(fa,function(a,b){var c=M(b);e[Ya("parse_as_"+c)]=function(b){return f(a,b)};e[Ya("get_trusted_"+c)]=function(b){return g(a,b)};e[Ya("trust_as_"+c)]=function(b){return k(a,b)}});return e}]}function ce(){this.$get=["$window","$document",function(b,a){var c={},d=Z((/android (\d+)/.exec(M((b.navigator||{}).userAgent))||[])[1]),e=/Boxee/i.test((b.navigator||{}).userAgent),f=a[0]||{},g=f.documentMode,k,m=/^(Moz|webkit|O|ms)(?=[A-Z])/,h=f.body&&f.body.style,
l=!1,n=!1;if(h){for(var p in h)if(l=m.exec(p)){k=l[0];k=k.substr(0,1).toUpperCase()+k.substr(1);break}k||(k="WebkitOpacity"in h&&"webkit");l=!!("transition"in h||k+"Transition"in h);n=!!("animation"in h||k+"Animation"in h);!d||l&&n||(l=C(f.body.style.webkitTransition),n=C(f.body.style.webkitAnimation))}return{history:!(!b.history||!b.history.pushState||4>d||e),hashchange:"onhashchange"in b&&(!g||7<g),hasEvent:function(a){if("input"==a&&9==Q)return!1;if(F(c[a])){var b=f.createElement("div");c[a]="on"+
a in b}return c[a]},csp:Wa(),vendorPrefix:k,transitions:l,animations:n,android:d,msie:Q,msieDocumentMode:g}}]}function ee(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(b,a,c,d){function e(e,k,m){var h=c.defer(),l=h.promise,n=D(m)&&!m;k=a.defer(function(){try{h.resolve(e())}catch(a){h.reject(a),d(a)}finally{delete f[l.$$timeoutId]}n||b.$apply()},k);l.$$timeoutId=k;f[k]=h;return l}var f={};e.cancel=function(b){return b&&b.$$timeoutId in f?(f[b.$$timeoutId].reject("canceled"),
delete f[b.$$timeoutId],a.defer.cancel(b.$$timeoutId)):!1};return e}]}function ua(b,a){var c=b;Q&&(V.setAttribute("href",c),c=V.href);V.setAttribute("href",c);return{href:V.href,protocol:V.protocol?V.protocol.replace(/:$/,""):"",host:V.host,search:V.search?V.search.replace(/^\?/,""):"",hash:V.hash?V.hash.replace(/^#/,""):"",hostname:V.hostname,port:V.port,pathname:"/"===V.pathname.charAt(0)?V.pathname:"/"+V.pathname}}function Pb(b){b=C(b)?ua(b):b;return b.protocol===Hc.protocol&&b.host===Hc.host}
function fe(){this.$get=$(P)}function mc(b){function a(d,e){if(T(d)){var f={};r(d,function(b,c){f[c]=a(c,b)});return f}return b.factory(d+c,e)}var c="Filter";this.register=a;this.$get=["$injector",function(a){return function(b){return a.get(b+c)}}];a("currency",Ic);a("date",Jc);a("filter",Ae);a("json",Be);a("limitTo",Ce);a("lowercase",De);a("number",Kc);a("orderBy",Lc);a("uppercase",Ee)}function Ae(){return function(b,a,c){if(!L(b))return b;var d=typeof c,e=[];e.check=function(a){for(var b=0;b<e.length;b++)if(!e[b](a))return!1;
return!0};"function"!==d&&(c="boolean"===d&&c?function(a,b){return Ua.equals(a,b)}:function(a,b){if(a&&b&&"object"===typeof a&&"object"===typeof b){for(var d in a)if("$"!==d.charAt(0)&&ib.call(a,d)&&c(a[d],b[d]))return!0;return!1}b=(""+b).toLowerCase();return-1<(""+a).toLowerCase().indexOf(b)});var f=function(a,b){if("string"==typeof b&&"!"===b.charAt(0))return!f(a,b.substr(1));switch(typeof a){case "boolean":case "number":case "string":return c(a,b);case "object":switch(typeof b){case "object":return c(a,
b);default:for(var d in a)if("$"!==d.charAt(0)&&f(a[d],b))return!0}return!1;case "array":for(d=0;d<a.length;d++)if(f(a[d],b))return!0;return!1;default:return!1}};switch(typeof a){case "boolean":case "number":case "string":a={$:a};case "object":for(var g in a)(function(b){"undefined"!==typeof a[b]&&e.push(function(c){return f("$"==b?c:c&&c[b],a[b])})})(g);break;case "function":e.push(a);break;default:return b}d=[];for(g=0;g<b.length;g++){var k=b[g];e.check(k)&&d.push(k)}return d}}function Ic(b){var a=
b.NUMBER_FORMATS;return function(b,d){F(d)&&(d=a.CURRENCY_SYM);return Mc(b,a.PATTERNS[1],a.GROUP_SEP,a.DECIMAL_SEP,2).replace(/\u00A4/g,d)}}function Kc(b){var a=b.NUMBER_FORMATS;return function(b,d){return Mc(b,a.PATTERNS[0],a.GROUP_SEP,a.DECIMAL_SEP,d)}}function Mc(b,a,c,d,e){if(null==b||!isFinite(b)||T(b))return"";var f=0>b;b=Math.abs(b);var g=b+"",k="",m=[],h=!1;if(-1!==g.indexOf("e")){var l=g.match(/([\d\.]+)e(-?)(\d+)/);l&&"-"==l[2]&&l[3]>e+1?(g="0",b=0):(k=g,h=!0)}if(h)0<e&&(-1<b&&1>b)&&(k=
b.toFixed(e));else{g=(g.split(Nc)[1]||"").length;F(e)&&(e=Math.min(Math.max(a.minFrac,g),a.maxFrac));b=+(Math.round(+(b.toString()+"e"+e)).toString()+"e"+-e);b=(""+b).split(Nc);g=b[0];b=b[1]||"";var l=0,n=a.lgSize,p=a.gSize;if(g.length>=n+p)for(l=g.length-n,h=0;h<l;h++)0===(l-h)%p&&0!==h&&(k+=c),k+=g.charAt(h);for(h=l;h<g.length;h++)0===(g.length-h)%n&&0!==h&&(k+=c),k+=g.charAt(h);for(;b.length<e;)b+="0";e&&"0"!==e&&(k+=d+b.substr(0,e))}m.push(f?a.negPre:a.posPre);m.push(k);m.push(f?a.negSuf:a.posSuf);
return m.join("")}function Xb(b,a,c){var d="";0>b&&(d="-",b=-b);for(b=""+b;b.length<a;)b="0"+b;c&&(b=b.substr(b.length-a));return d+b}function Y(b,a,c,d){c=c||0;return function(e){e=e["get"+b]();if(0<c||e>-c)e+=c;0===e&&-12==c&&(e=12);return Xb(e,a,d)}}function ub(b,a){return function(c,d){var e=c["get"+b](),f=Ia(a?"SHORT"+b:b);return d[f][e]}}function Jc(b){function a(a){var b;if(b=a.match(c)){a=new Date(0);var f=0,g=0,k=b[8]?a.setUTCFullYear:a.setFullYear,m=b[8]?a.setUTCHours:a.setHours;b[9]&&(f=
Z(b[9]+b[10]),g=Z(b[9]+b[11]));k.call(a,Z(b[1]),Z(b[2])-1,Z(b[3]));f=Z(b[4]||0)-f;g=Z(b[5]||0)-g;k=Z(b[6]||0);b=Math.round(1E3*parseFloat("0."+(b[7]||0)));m.call(a,f,g,k,b)}return a}var c=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,e){var f="",g=[],k,m;e=e||"mediumDate";e=b.DATETIME_FORMATS[e]||e;C(c)&&(c=Fe.test(c)?Z(c):a(c));Ab(c)&&(c=new Date(c));if(!sa(c))return c;for(;e;)(m=Ge.exec(e))?(g=g.concat(Aa.call(m,1)),e=g.pop()):
(g.push(e),e=null);r(g,function(a){k=He[a];f+=k?k(c,b.DATETIME_FORMATS):a.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return f}}function Be(){return function(b){return ta(b,!0)}}function Ce(){return function(b,a){if(!L(b)&&!C(b))return b;a=Infinity===Math.abs(Number(a))?Number(a):Z(a);if(C(b))return a?0<=a?b.slice(0,a):b.slice(a,b.length):"";var c=[],d,e;a>b.length?a=b.length:a<-b.length&&(a=-b.length);0<a?(d=0,e=a):(d=b.length+a,e=b.length);for(;d<e;d++)c.push(b[d]);return c}}function Lc(b){return function(a,
c,d){function e(a,b){return Ta(b)?function(b,c){return a(c,b)}:a}function f(a,b){var c=typeof a,d=typeof b;return c==d?(sa(a)&&sa(b)&&(a=a.valueOf(),b=b.valueOf()),"string"==c&&(a=a.toLowerCase(),b=b.toLowerCase()),a===b?0:a<b?-1:1):c<d?-1:1}if(!L(a)||!c)return a;c=L(c)?c:[c];c=Vc(c,function(a){var c=!1,d=a||Ga;if(C(a)){if("+"==a.charAt(0)||"-"==a.charAt(0))c="-"==a.charAt(0),a=a.substring(1);d=b(a);if(d.constant){var g=d();return e(function(a,b){return f(a[g],b[g])},c)}}return e(function(a,b){return f(d(a),
d(b))},c)});for(var g=[],k=0;k<a.length;k++)g.push(a[k]);return g.sort(e(function(a,b){for(var d=0;d<c.length;d++){var e=c[d](a,b);if(0!==e)return e}return 0},d))}}function xa(b){J(b)&&(b={link:b});b.restrict=b.restrict||"AC";return $(b)}function Oc(b,a,c,d){function e(a,c){c=c?"-"+kb(c,"-"):"";d.removeClass(b,(a?vb:wb)+c);d.addClass(b,(a?wb:vb)+c)}var f=this,g=b.parent().controller("form")||xb,k=0,m=f.$error={},h=[];f.$name=a.name||a.ngForm;f.$dirty=!1;f.$pristine=!0;f.$valid=!0;f.$invalid=!1;g.$addControl(f);
b.addClass(Pa);e(!0);f.$addControl=function(a){Ca(a.$name,"input");h.push(a);a.$name&&(f[a.$name]=a)};f.$removeControl=function(a){a.$name&&f[a.$name]===a&&delete f[a.$name];r(m,function(b,c){f.$setValidity(c,!0,a)});Ra(h,a)};f.$setValidity=function(a,b,c){var d=m[a];if(b)d&&(Ra(d,c),d.length||(k--,k||(e(b),f.$valid=!0,f.$invalid=!1),m[a]=!1,e(!0,a),g.$setValidity(a,!0,f)));else{k||e(b);if(d){if(-1!=Qa(d,c))return}else m[a]=d=[],k++,e(!1,a),g.$setValidity(a,!1,f);d.push(c);f.$valid=!1;f.$invalid=
!0}};f.$setDirty=function(){d.removeClass(b,Pa);d.addClass(b,yb);f.$dirty=!0;f.$pristine=!1;g.$setDirty()};f.$setPristine=function(){d.removeClass(b,yb);d.addClass(b,Pa);f.$dirty=!1;f.$pristine=!0;r(h,function(a){a.$setPristine()})}}function ra(b,a,c,d){b.$setValidity(a,c);return c?d:s}function Pc(b,a){var c,d;if(a)for(c=0;c<a.length;++c)if(d=a[c],b[d])return!0;return!1}function Ie(b,a,c,d,e){T(e)&&(b.$$hasNativeValidators=!0,b.$parsers.push(function(f){if(b.$error[a]||Pc(e,d)||!Pc(e,c))return f;
b.$setValidity(a,!1)}))}function zb(b,a,c,d,e,f){var g=a.prop(Je),k=a[0].placeholder,m={};d.$$validityState=g;if(!e.android){var h=!1;a.on("compositionstart",function(a){h=!0});a.on("compositionend",function(){h=!1;l()})}var l=function(e){if(!h){var f=a.val();if(Q&&"input"===(e||m).type&&a[0].placeholder!==k)k=a[0].placeholder;else if(Ta(c.ngTrim||"T")&&(f=aa(f)),e=g&&d.$$hasNativeValidators,d.$viewValue!==f||""===f&&e)b.$$phase?d.$setViewValue(f):b.$apply(function(){d.$setViewValue(f)})}};if(e.hasEvent("input"))a.on("input",
l);else{var n,p=function(){n||(n=f.defer(function(){l();n=null}))};a.on("keydown",function(a){a=a.keyCode;91===a||(15<a&&19>a||37<=a&&40>=a)||p()});if(e.hasEvent("paste"))a.on("paste cut",p)}a.on("change",l);d.$render=function(){a.val(d.$isEmpty(d.$viewValue)?"":d.$viewValue)};var q=c.ngPattern;q&&((e=q.match(/^\/(.*)\/([gim]*)$/))?(q=RegExp(e[1],e[2]),e=function(a){return ra(d,"pattern",d.$isEmpty(a)||q.test(a),a)}):e=function(c){var e=b.$eval(q);if(!e||!e.test)throw w("ngPattern")("noregexp",q,
e,ha(a));return ra(d,"pattern",d.$isEmpty(c)||e.test(c),c)},d.$formatters.push(e),d.$parsers.push(e));if(c.ngMinlength){var t=Z(c.ngMinlength);e=function(a){return ra(d,"minlength",d.$isEmpty(a)||a.length>=t,a)};d.$parsers.push(e);d.$formatters.push(e)}if(c.ngMaxlength){var r=Z(c.ngMaxlength);e=function(a){return ra(d,"maxlength",d.$isEmpty(a)||a.length<=r,a)};d.$parsers.push(e);d.$formatters.push(e)}}function Yb(b,a){b="ngClass"+b;return["$animate",function(c){function d(a,b){var c=[],d=0;a:for(;d<
a.length;d++){for(var e=a[d],l=0;l<b.length;l++)if(e==b[l])continue a;c.push(e)}return c}function e(a){if(!L(a)){if(C(a))return a.split(" ");if(T(a)){var b=[];r(a,function(a,c){a&&(b=b.concat(c.split(" ")))});return b}}return a}return{restrict:"AC",link:function(f,g,k){function m(a,b){var c=g.data("$classCounts")||{},d=[];r(a,function(a){if(0<b||c[a])c[a]=(c[a]||0)+b,c[a]===+(0<b)&&d.push(a)});g.data("$classCounts",c);return d.join(" ")}function h(b){if(!0===a||f.$index%2===a){var h=e(b||[]);if(!l){var q=
m(h,1);k.$addClass(q)}else if(!za(b,l)){var r=e(l),q=d(h,r),h=d(r,h),h=m(h,-1),q=m(q,1);0===q.length?c.removeClass(g,h):0===h.length?c.addClass(g,q):c.setClass(g,q,h)}}l=ga(b)}var l;f.$watch(k[b],h,!0);k.$observe("class",function(a){h(f.$eval(k[b]))});"ngClass"!==b&&f.$watch("$index",function(c,d){var g=c&1;if(g!==(d&1)){var h=e(f.$eval(k[b]));g===a?(g=m(h,1),k.$addClass(g)):(g=m(h,-1),k.$removeClass(g))}})}}}]}var Je="validity",M=function(b){return C(b)?b.toLowerCase():b},ib=Object.prototype.hasOwnProperty,
Ia=function(b){return C(b)?b.toUpperCase():b},Q,y,Da,Aa=[].slice,Ke=[].push,ya=Object.prototype.toString,Sa=w("ng"),Ua=P.angular||(P.angular={}),Xa,Ma,la=["0","0","0"];Q=Z((/msie (\d+)/.exec(M(navigator.userAgent))||[])[1]);isNaN(Q)&&(Q=Z((/trident\/.*; rv:(\d+)/.exec(M(navigator.userAgent))||[])[1]));z.$inject=[];Ga.$inject=[];var L=function(){return J(Array.isArray)?Array.isArray:function(b){return"[object Array]"===ya.call(b)}}(),aa=function(){return String.prototype.trim?function(b){return C(b)?
b.trim():b}:function(b){return C(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}();Ma=9>Q?function(b){b=b.nodeName?b:b[0];return b.scopeName&&"HTML"!=b.scopeName?Ia(b.scopeName+":"+b.nodeName):b.nodeName}:function(b){return b.nodeName?b.nodeName:b[0].nodeName};var Wa=function(){if(D(Wa.isActive_))return Wa.isActive_;var b=!(!X.querySelector("[ng-csp]")&&!X.querySelector("[data-ng-csp]"));if(!b)try{new Function("")}catch(a){b=!0}return Wa.isActive_=b},Yc=/[A-Z]/g,ad={full:"1.2.22",major:1,minor:2,
dot:22,codeName:"finicky-pleasure"};S.expando="ng339";var $a=S.cache={},ne=1,rb=P.document.addEventListener?function(b,a,c){b.addEventListener(a,c,!1)}:function(b,a,c){b.attachEvent("on"+a,c)},Za=P.document.removeEventListener?function(b,a,c){b.removeEventListener(a,c,!1)}:function(b,a,c){b.detachEvent("on"+a,c)};S._data=function(b){return this.cache[b[this.expando]]||{}};var ie=/([\:\-\_]+(.))/g,je=/^moz([A-Z])/,Hb=w("jqLite"),ke=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Ib=/<|&#?\w+;/,le=/<([\w:]+)/,me=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
ba={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ba.optgroup=ba.option;ba.tbody=ba.tfoot=ba.colgroup=ba.caption=ba.thead;ba.th=ba.td;var La=S.prototype={ready:function(b){function a(){c||(c=!0,b())}var c=!1;"complete"===X.readyState?setTimeout(a):(this.on("DOMContentLoaded",a),S(P).on("load",a))},
toString:function(){var b=[];r(this,function(a){b.push(""+a)});return"["+b.join(", ")+"]"},eq:function(b){return 0<=b?y(this[b]):y(this[this.length+b])},length:0,push:Ke,sort:[].sort,splice:[].splice},ob={};r("multiple selected checked disabled readOnly required open".split(" "),function(b){ob[M(b)]=b});var rc={};r("input select option textarea button form details".split(" "),function(b){rc[Ia(b)]=!0});r({data:Mb,removeData:Lb},function(b,a){S[a]=b});r({data:Mb,inheritedData:nb,scope:function(b){return y.data(b,
"$scope")||nb(b.parentNode||b,["$isolateScope","$scope"])},isolateScope:function(b){return y.data(b,"$isolateScope")||y.data(b,"$isolateScopeNoTemplate")},controller:oc,injector:function(b){return nb(b,"$injector")},removeAttr:function(b,a){b.removeAttribute(a)},hasClass:Nb,css:function(b,a,c){a=Ya(a);if(D(c))b.style[a]=c;else{var d;8>=Q&&(d=b.currentStyle&&b.currentStyle[a],""===d&&(d="auto"));d=d||b.style[a];8>=Q&&(d=""===d?s:d);return d}},attr:function(b,a,c){var d=M(a);if(ob[d])if(D(c))c?(b[a]=
!0,b.setAttribute(a,d)):(b[a]=!1,b.removeAttribute(d));else return b[a]||(b.attributes.getNamedItem(a)||z).specified?d:s;else if(D(c))b.setAttribute(a,c);else if(b.getAttribute)return b=b.getAttribute(a,2),null===b?s:b},prop:function(b,a,c){if(D(c))b[a]=c;else return b[a]},text:function(){function b(b,d){var e=a[b.nodeType];if(F(d))return e?b[e]:"";b[e]=d}var a=[];9>Q?(a[1]="innerText",a[3]="nodeValue"):a[1]=a[3]="textContent";b.$dv="";return b}(),val:function(b,a){if(F(a)){if("SELECT"===Ma(b)&&b.multiple){var c=
[];r(b.options,function(a){a.selected&&c.push(a.value||a.text)});return 0===c.length?null:c}return b.value}b.value=a},html:function(b,a){if(F(a))return b.innerHTML;for(var c=0,d=b.childNodes;c<d.length;c++)Ja(d[c]);b.innerHTML=a},empty:pc},function(b,a){S.prototype[a]=function(a,d){var e,f,g=this.length;if(b!==pc&&(2==b.length&&b!==Nb&&b!==oc?a:d)===s){if(T(a)){for(e=0;e<g;e++)if(b===Mb)b(this[e],a);else for(f in a)b(this[e],f,a[f]);return this}e=b.$dv;g=e===s?Math.min(g,1):g;for(f=0;f<g;f++){var k=
b(this[f],a,d);e=e?e+k:k}return e}for(e=0;e<g;e++)b(this[e],a,d);return this}});r({removeData:Lb,dealoc:Ja,on:function a(c,d,e,f){if(D(f))throw Hb("onargs");var g=ma(c,"events"),k=ma(c,"handle");g||ma(c,"events",g={});k||ma(c,"handle",k=oe(c,g));r(d.split(" "),function(d){var f=g[d];if(!f){if("mouseenter"==d||"mouseleave"==d){var l=X.body.contains||X.body.compareDocumentPosition?function(a,c){var d=9===a.nodeType?a.documentElement:a,e=c&&c.parentNode;return a===e||!!(e&&1===e.nodeType&&(d.contains?
d.contains(e):a.compareDocumentPosition&&a.compareDocumentPosition(e)&16))}:function(a,c){if(c)for(;c=c.parentNode;)if(c===a)return!0;return!1};g[d]=[];a(c,{mouseleave:"mouseout",mouseenter:"mouseover"}[d],function(a){var c=a.relatedTarget;c&&(c===this||l(this,c))||k(a,d)})}else rb(c,d,k),g[d]=[];f=g[d]}f.push(e)})},off:nc,one:function(a,c,d){a=y(a);a.on(c,function f(){a.off(c,d);a.off(c,f)});a.on(c,d)},replaceWith:function(a,c){var d,e=a.parentNode;Ja(a);r(new S(c),function(c){d?e.insertBefore(c,
d.nextSibling):e.replaceChild(c,a);d=c})},children:function(a){var c=[];r(a.childNodes,function(a){1===a.nodeType&&c.push(a)});return c},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,c){r(new S(c),function(c){1!==a.nodeType&&11!==a.nodeType||a.appendChild(c)})},prepend:function(a,c){if(1===a.nodeType){var d=a.firstChild;r(new S(c),function(c){a.insertBefore(c,d)})}},wrap:function(a,c){c=y(c)[0];var d=a.parentNode;d&&d.replaceChild(c,a);c.appendChild(a)},remove:function(a){Ja(a);
var c=a.parentNode;c&&c.removeChild(a)},after:function(a,c){var d=a,e=a.parentNode;r(new S(c),function(a){e.insertBefore(a,d.nextSibling);d=a})},addClass:mb,removeClass:lb,toggleClass:function(a,c,d){c&&r(c.split(" "),function(c){var f=d;F(f)&&(f=!Nb(a,c));(f?mb:lb)(a,c)})},parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},next:function(a){if(a.nextElementSibling)return a.nextElementSibling;for(a=a.nextSibling;null!=a&&1!==a.nodeType;)a=a.nextSibling;return a},find:function(a,c){return a.getElementsByTagName?
a.getElementsByTagName(c):[]},clone:Kb,triggerHandler:function(a,c,d){var e,f;e=c.type||c;var g=(ma(a,"events")||{})[e];g&&(e={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopPropagation:z,type:e,target:a},c.type&&(e=E(e,c)),c=ga(g),f=d?[e].concat(d):[e],r(c,function(c){c.apply(a,f)}))}},function(a,c){S.prototype[c]=function(c,e,f){for(var g,k=0;k<this.length;k++)F(g)?(g=a(this[k],c,e,f),D(g)&&(g=y(g))):Jb(g,a(this[k],c,e,f));
return D(g)?g:this};S.prototype.bind=S.prototype.on;S.prototype.unbind=S.prototype.off});ab.prototype={put:function(a,c){this[Ka(a,this.nextUid)]=c},get:function(a){return this[Ka(a,this.nextUid)]},remove:function(a){var c=this[a=Ka(a,this.nextUid)];delete this[a];return c}};var qe=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,re=/,/,se=/^\s*(_?)(\S+?)\1\s*$/,pe=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,bb=w("$injector"),Le=w("$animate"),Md=["$provide",function(a){this.$$selectors={};this.register=function(c,d){var e=
c+"-animation";if(c&&"."!=c.charAt(0))throw Le("notcsel",c);this.$$selectors[c.substr(1)]=e;a.factory(e,d)};this.classNameFilter=function(a){1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null);return this.$$classNameFilter};this.$get=["$timeout","$$asyncCallback",function(a,d){return{enter:function(a,c,g,k){g?g.after(a):(c&&c[0]||(c=g.parent()),c.append(a));k&&d(k)},leave:function(a,c){a.remove();c&&d(c)},move:function(a,c,d,k){this.enter(a,c,d,k)},addClass:function(a,c,g){c=
C(c)?c:L(c)?c.join(" "):"";r(a,function(a){mb(a,c)});g&&d(g)},removeClass:function(a,c,g){c=C(c)?c:L(c)?c.join(" "):"";r(a,function(a){lb(a,c)});g&&d(g)},setClass:function(a,c,g,k){r(a,function(a){mb(a,c);lb(a,g)});k&&d(k)},enabled:z}}]}],ia=w("$compile");ic.$inject=["$provide","$$sanitizeUriProvider"];var ue=/^(x[\:\-_]|data[\:\-_])/i,yc=w("$interpolate"),Me=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,xe={http:80,https:443,ftp:21},Sb=w("$location");Ub.prototype=Tb.prototype=Bc.prototype={$$html5:!1,$$replace:!1,
absUrl:sb("$$absUrl"),url:function(a,c){if(F(a))return this.$$url;var d=Me.exec(a);d[1]&&this.path(decodeURIComponent(d[1]));(d[2]||d[1])&&this.search(d[3]||"");this.hash(d[5]||"",c);return this},protocol:sb("$$protocol"),host:sb("$$host"),port:sb("$$port"),path:Cc("$$path",function(a){return"/"==a.charAt(0)?a:"/"+a}),search:function(a,c){switch(arguments.length){case 0:return this.$$search;case 1:if(C(a))this.$$search=ec(a);else if(T(a))r(a,function(c,e){null==c&&delete a[e]}),this.$$search=a;else throw Sb("isrcharg");
break;default:F(c)||null===c?delete this.$$search[a]:this.$$search[a]=c}this.$$compose();return this},hash:Cc("$$hash",Ga),replace:function(){this.$$replace=!0;return this}};var ka=w("$parse"),Fc={},va,Ne=Function.prototype.call,Oe=Function.prototype.apply,Qc=Function.prototype.bind,eb={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:z,"+":function(a,c,d,e){d=d(a,c);e=e(a,c);return D(d)?D(e)?d+e:d:D(e)?e:s},"-":function(a,c,d,e){d=d(a,c);e=e(a,c);
return(D(d)?d:0)-(D(e)?e:0)},"*":function(a,c,d,e){return d(a,c)*e(a,c)},"/":function(a,c,d,e){return d(a,c)/e(a,c)},"%":function(a,c,d,e){return d(a,c)%e(a,c)},"^":function(a,c,d,e){return d(a,c)^e(a,c)},"=":z,"===":function(a,c,d,e){return d(a,c)===e(a,c)},"!==":function(a,c,d,e){return d(a,c)!==e(a,c)},"==":function(a,c,d,e){return d(a,c)==e(a,c)},"!=":function(a,c,d,e){return d(a,c)!=e(a,c)},"<":function(a,c,d,e){return d(a,c)<e(a,c)},">":function(a,c,d,e){return d(a,c)>e(a,c)},"<=":function(a,
c,d,e){return d(a,c)<=e(a,c)},">=":function(a,c,d,e){return d(a,c)>=e(a,c)},"&&":function(a,c,d,e){return d(a,c)&&e(a,c)},"||":function(a,c,d,e){return d(a,c)||e(a,c)},"&":function(a,c,d,e){return d(a,c)&e(a,c)},"|":function(a,c,d,e){return e(a,c)(a,c,d(a,c))},"!":function(a,c,d){return!d(a,c)}},Pe={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},Wb=function(a){this.options=a};Wb.prototype={constructor:Wb,lex:function(a){this.text=a;this.index=0;this.ch=s;this.lastCh=":";for(this.tokens=[];this.index<
this.text.length;){this.ch=this.text.charAt(this.index);if(this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent();else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch}),this.index++;else if(this.isWhitespace(this.ch)){this.index++;continue}else{a=this.ch+this.peek();var c=a+this.peek(2),d=eb[this.ch],e=eb[a],f=eb[c];f?(this.tokens.push({index:this.index,
text:c,fn:f}),this.index+=3):e?(this.tokens.push({index:this.index,text:a,fn:e}),this.index+=2):d?(this.tokens.push({index:this.index,text:this.ch,fn:d}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(a){return-1!==a.indexOf(this.ch)},was:function(a){return-1!==a.indexOf(this.lastCh)},peek:function(a){a=a||1;return this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return"0"<=
a&&"9">=a},isWhitespace:function(a){return" "===a||"\r"===a||"\t"===a||"\n"===a||"\v"===a||"\u00a0"===a},isIdent:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===a||"+"===a||this.isNumber(a)},throwError:function(a,c,d){d=d||this.index;c=D(c)?"s "+c+"-"+this.index+" ["+this.text.substring(c,d)+"]":" "+d;throw ka("lexerr",a,c,this.text);},readNumber:function(){for(var a="",c=this.index;this.index<this.text.length;){var d=M(this.text.charAt(this.index));
if("."==d||this.isNumber(d))a+=d;else{var e=this.peek();if("e"==d&&this.isExpOperator(e))a+=d;else if(this.isExpOperator(d)&&e&&this.isNumber(e)&&"e"==a.charAt(a.length-1))a+=d;else if(!this.isExpOperator(d)||e&&this.isNumber(e)||"e"!=a.charAt(a.length-1))break;else this.throwError("Invalid exponent")}this.index++}a*=1;this.tokens.push({index:c,text:a,literal:!0,constant:!0,fn:function(){return a}})},readIdent:function(){for(var a=this,c="",d=this.index,e,f,g,k;this.index<this.text.length;){k=this.text.charAt(this.index);
if("."===k||this.isIdent(k)||this.isNumber(k))"."===k&&(e=this.index),c+=k;else break;this.index++}if(e)for(f=this.index;f<this.text.length;){k=this.text.charAt(f);if("("===k){g=c.substr(e-d+1);c=c.substr(0,e-d);this.index=f;break}if(this.isWhitespace(k))f++;else break}d={index:d,text:c};if(eb.hasOwnProperty(c))d.fn=eb[c],d.literal=!0,d.constant=!0;else{var m=Ec(c,this.options,this.text);d.fn=E(function(a,c){return m(a,c)},{assign:function(d,e){return tb(d,c,e,a.text,a.options)}})}this.tokens.push(d);
g&&(this.tokens.push({index:e,text:"."}),this.tokens.push({index:e+1,text:g}))},readString:function(a){var c=this.index;this.index++;for(var d="",e=a,f=!1;this.index<this.text.length;){var g=this.text.charAt(this.index),e=e+g;if(f)"u"===g?(f=this.text.substring(this.index+1,this.index+5),f.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+f+"]"),this.index+=4,d+=String.fromCharCode(parseInt(f,16))):d+=Pe[g]||g,f=!1;else if("\\"===g)f=!0;else{if(g===a){this.index++;this.tokens.push({index:c,
text:e,string:d,literal:!0,constant:!0,fn:function(){return d}});return}d+=g}this.index++}this.throwError("Unterminated quote",c)}};var db=function(a,c,d){this.lexer=a;this.$filter=c;this.options=d};db.ZERO=E(function(){return 0},{constant:!0});db.prototype={constructor:db,parse:function(a){this.text=a;this.tokens=this.lexer.lex(a);a=this.statements();0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]);a.literal=!!a.literal;a.constant=!!a.constant;return a},primary:function(){var a;
if(this.expect("("))a=this.filterChain(),this.consume(")");else if(this.expect("["))a=this.arrayDeclaration();else if(this.expect("{"))a=this.object();else{var c=this.expect();(a=c.fn)||this.throwError("not a primary expression",c);a.literal=!!c.literal;a.constant=!!c.constant}for(var d;c=this.expect("(","[",".");)"("===c.text?(a=this.functionCall(a,d),d=null):"["===c.text?(d=a,a=this.objectIndex(a)):"."===c.text?(d=a,a=this.fieldAccess(a)):this.throwError("IMPOSSIBLE");return a},throwError:function(a,
c){throw ka("syntax",c.text,a,c.index+1,this.text,this.text.substring(c.index));},peekToken:function(){if(0===this.tokens.length)throw ka("ueoe",this.text);return this.tokens[0]},peek:function(a,c,d,e){if(0<this.tokens.length){var f=this.tokens[0],g=f.text;if(g===a||g===c||g===d||g===e||!(a||c||d||e))return f}return!1},expect:function(a,c,d,e){return(a=this.peek(a,c,d,e))?(this.tokens.shift(),a):!1},consume:function(a){this.expect(a)||this.throwError("is unexpected, expecting ["+a+"]",this.peek())},
unaryFn:function(a,c){return E(function(d,e){return a(d,e,c)},{constant:c.constant})},ternaryFn:function(a,c,d){return E(function(e,f){return a(e,f)?c(e,f):d(e,f)},{constant:a.constant&&c.constant&&d.constant})},binaryFn:function(a,c,d){return E(function(e,f){return c(e,f,a,d)},{constant:a.constant&&d.constant})},statements:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.filterChain()),!this.expect(";"))return 1===a.length?a[0]:function(c,d){for(var e,f=
0;f<a.length;f++){var g=a[f];g&&(e=g(c,d))}return e}},filterChain:function(){for(var a=this.expression(),c;;)if(c=this.expect("|"))a=this.binaryFn(a,c.fn,this.filter());else return a},filter:function(){for(var a=this.expect(),c=this.$filter(a.text),d=[];;)if(a=this.expect(":"))d.push(this.expression());else{var e=function(a,e,k){k=[k];for(var m=0;m<d.length;m++)k.push(d[m](a,e));return c.apply(a,k)};return function(){return e}}},expression:function(){return this.assignment()},assignment:function(){var a=
this.ternary(),c,d;return(d=this.expect("="))?(a.assign||this.throwError("implies assignment but ["+this.text.substring(0,d.index)+"] can not be assigned to",d),c=this.ternary(),function(d,f){return a.assign(d,c(d,f),f)}):a},ternary:function(){var a=this.logicalOR(),c,d;if(this.expect("?")){c=this.assignment();if(d=this.expect(":"))return this.ternaryFn(a,c,this.assignment());this.throwError("expected :",d)}else return a},logicalOR:function(){for(var a=this.logicalAND(),c;;)if(c=this.expect("||"))a=
this.binaryFn(a,c.fn,this.logicalAND());else return a},logicalAND:function(){var a=this.equality(),c;if(c=this.expect("&&"))a=this.binaryFn(a,c.fn,this.logicalAND());return a},equality:function(){var a=this.relational(),c;if(c=this.expect("==","!=","===","!=="))a=this.binaryFn(a,c.fn,this.equality());return a},relational:function(){var a=this.additive(),c;if(c=this.expect("<",">","<=",">="))a=this.binaryFn(a,c.fn,this.relational());return a},additive:function(){for(var a=this.multiplicative(),c;c=
this.expect("+","-");)a=this.binaryFn(a,c.fn,this.multiplicative());return a},multiplicative:function(){for(var a=this.unary(),c;c=this.expect("*","/","%");)a=this.binaryFn(a,c.fn,this.unary());return a},unary:function(){var a;return this.expect("+")?this.primary():(a=this.expect("-"))?this.binaryFn(db.ZERO,a.fn,this.unary()):(a=this.expect("!"))?this.unaryFn(a.fn,this.unary()):this.primary()},fieldAccess:function(a){var c=this,d=this.expect().text,e=Ec(d,this.options,this.text);return E(function(c,
d,k){return e(k||a(c,d))},{assign:function(e,g,k){(k=a(e,k))||a.assign(e,k={});return tb(k,d,g,c.text,c.options)}})},objectIndex:function(a){var c=this,d=this.expression();this.consume("]");return E(function(e,f){var g=a(e,f),k=d(e,f),m;ja(k,c.text);if(!g)return s;(g=Oa(g[k],c.text))&&(g.then&&c.options.unwrapPromises)&&(m=g,"$$v"in g||(m.$$v=s,m.then(function(a){m.$$v=a})),g=g.$$v);return g},{assign:function(e,f,g){var k=ja(d(e,g),c.text);(g=Oa(a(e,g),c.text))||a.assign(e,g={});return g[k]=f}})},
functionCall:function(a,c){var d=[];if(")"!==this.peekToken().text){do d.push(this.expression());while(this.expect(","))}this.consume(")");var e=this;return function(f,g){for(var k=[],m=c?c(f,g):f,h=0;h<d.length;h++)k.push(d[h](f,g));h=a(f,g,m)||z;Oa(m,e.text);var l=e.text;if(h){if(h.constructor===h)throw ka("isecfn",l);if(h===Ne||h===Oe||Qc&&h===Qc)throw ka("isecff",l);}k=h.apply?h.apply(m,k):h(k[0],k[1],k[2],k[3],k[4]);return Oa(k,e.text)}},arrayDeclaration:function(){var a=[],c=!0;if("]"!==this.peekToken().text){do{if(this.peek("]"))break;
var d=this.expression();a.push(d);d.constant||(c=!1)}while(this.expect(","))}this.consume("]");return E(function(c,d){for(var g=[],k=0;k<a.length;k++)g.push(a[k](c,d));return g},{literal:!0,constant:c})},object:function(){var a=[],c=!0;if("}"!==this.peekToken().text){do{if(this.peek("}"))break;var d=this.expect(),d=d.string||d.text;this.consume(":");var e=this.expression();a.push({key:d,value:e});e.constant||(c=!1)}while(this.expect(","))}this.consume("}");return E(function(c,d){for(var e={},m=0;m<
a.length;m++){var h=a[m];e[h.key]=h.value(c,d)}return e},{literal:!0,constant:c})}};var Vb={},wa=w("$sce"),fa={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},V=X.createElement("a"),Hc=ua(P.location.href,!0);mc.$inject=["$provide"];Ic.$inject=["$locale"];Kc.$inject=["$locale"];var Nc=".",He={yyyy:Y("FullYear",4),yy:Y("FullYear",2,0,!0),y:Y("FullYear",1),MMMM:ub("Month"),MMM:ub("Month",!0),MM:Y("Month",2,1),M:Y("Month",1,1),dd:Y("Date",2),d:Y("Date",1),HH:Y("Hours",2),H:Y("Hours",
1),hh:Y("Hours",2,-12),h:Y("Hours",1,-12),mm:Y("Minutes",2),m:Y("Minutes",1),ss:Y("Seconds",2),s:Y("Seconds",1),sss:Y("Milliseconds",3),EEEE:ub("Day"),EEE:ub("Day",!0),a:function(a,c){return 12>a.getHours()?c.AMPMS[0]:c.AMPMS[1]},Z:function(a){a=-1*a.getTimezoneOffset();return a=(0<=a?"+":"")+(Xb(Math[0<a?"floor":"ceil"](a/60),2)+Xb(Math.abs(a%60),2))}},Ge=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,Fe=/^\-?\d+$/;Jc.$inject=["$locale"];var De=$(M),Ee=$(Ia);Lc.$inject=
["$parse"];var dd=$({restrict:"E",compile:function(a,c){8>=Q&&(c.href||c.name||c.$set("href",""),a.append(X.createComment("IE fix")));if(!c.href&&!c.xlinkHref&&!c.name)return function(a,c){var f="[object SVGAnimatedString]"===ya.call(c.prop("href"))?"xlink:href":"href";c.on("click",function(a){c.attr(f)||a.preventDefault()})}}}),Fb={};r(ob,function(a,c){if("multiple"!=a){var d=na("ng-"+c);Fb[d]=function(){return{priority:100,link:function(a,f,g){a.$watch(g[d],function(a){g.$set(c,!!a)})}}}}});r(["src",
"srcset","href"],function(a){var c=na("ng-"+a);Fb[c]=function(){return{priority:99,link:function(d,e,f){var g=a,k=a;"href"===a&&"[object SVGAnimatedString]"===ya.call(e.prop("href"))&&(k="xlinkHref",f.$attr[k]="xlink:href",g=null);f.$observe(c,function(a){a&&(f.$set(k,a),Q&&g&&e.prop(g,f[k]))})}}}});var xb={$addControl:z,$removeControl:z,$setValidity:z,$setDirty:z,$setPristine:z};Oc.$inject=["$element","$attrs","$scope","$animate"];var Rc=function(a){return["$timeout",function(c){return{name:"form",
restrict:a?"EAC":"E",controller:Oc,compile:function(){return{pre:function(a,e,f,g){if(!f.action){var k=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};rb(e[0],"submit",k);e.on("$destroy",function(){c(function(){Za(e[0],"submit",k)},0,!1)})}var m=e.parent().controller("form"),h=f.name||f.ngForm;h&&tb(a,h,g,h);if(m)e.on("$destroy",function(){m.$removeControl(g);h&&tb(a,h,s,h);E(g,xb)})}}}}}]},ed=Rc(),rd=Rc(!0),Qe=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,
Re=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,Se=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Sc={text:zb,number:function(a,c,d,e,f,g){zb(a,c,d,e,f,g);e.$parsers.push(function(a){var c=e.$isEmpty(a);if(c||Se.test(a))return e.$setValidity("number",!0),""===a?null:c?a:parseFloat(a);e.$setValidity("number",!1);return s});Ie(e,"number",Te,null,e.$$validityState);e.$formatters.push(function(a){return e.$isEmpty(a)?"":""+a});d.min&&(a=function(a){var c=parseFloat(d.min);
return ra(e,"min",e.$isEmpty(a)||a>=c,a)},e.$parsers.push(a),e.$formatters.push(a));d.max&&(a=function(a){var c=parseFloat(d.max);return ra(e,"max",e.$isEmpty(a)||a<=c,a)},e.$parsers.push(a),e.$formatters.push(a));e.$formatters.push(function(a){return ra(e,"number",e.$isEmpty(a)||Ab(a),a)})},url:function(a,c,d,e,f,g){zb(a,c,d,e,f,g);a=function(a){return ra(e,"url",e.$isEmpty(a)||Qe.test(a),a)};e.$formatters.push(a);e.$parsers.push(a)},email:function(a,c,d,e,f,g){zb(a,c,d,e,f,g);a=function(a){return ra(e,
"email",e.$isEmpty(a)||Re.test(a),a)};e.$formatters.push(a);e.$parsers.push(a)},radio:function(a,c,d,e){F(d.name)&&c.attr("name",gb());c.on("click",function(){c[0].checked&&a.$apply(function(){e.$setViewValue(d.value)})});e.$render=function(){c[0].checked=d.value==e.$viewValue};d.$observe("value",e.$render)},checkbox:function(a,c,d,e){var f=d.ngTrueValue,g=d.ngFalseValue;C(f)||(f=!0);C(g)||(g=!1);c.on("click",function(){a.$apply(function(){e.$setViewValue(c[0].checked)})});e.$render=function(){c[0].checked=
e.$viewValue};e.$isEmpty=function(a){return a!==f};e.$formatters.push(function(a){return a===f});e.$parsers.push(function(a){return a?f:g})},hidden:z,button:z,submit:z,reset:z,file:z},Te=["badInput"],jc=["$browser","$sniffer",function(a,c){return{restrict:"E",require:"?ngModel",link:function(d,e,f,g){g&&(Sc[M(f.type)]||Sc.text)(d,e,f,g,c,a)}}}],wb="ng-valid",vb="ng-invalid",Pa="ng-pristine",yb="ng-dirty",Ue=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate",function(a,c,d,e,f,g){function k(a,
c){c=c?"-"+kb(c,"-"):"";g.removeClass(e,(a?vb:wb)+c);g.addClass(e,(a?wb:vb)+c)}this.$modelValue=this.$viewValue=Number.NaN;this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$pristine=!0;this.$dirty=!1;this.$valid=!0;this.$invalid=!1;this.$name=d.name;var m=f(d.ngModel),h=m.assign;if(!h)throw w("ngModel")("nonassign",d.ngModel,ha(e));this.$render=z;this.$isEmpty=function(a){return F(a)||""===a||null===a||a!==a};var l=e.inheritedData("$formController")||xb,n=0,p=this.$error={};
e.addClass(Pa);k(!0);this.$setValidity=function(a,c){p[a]!==!c&&(c?(p[a]&&n--,n||(k(!0),this.$valid=!0,this.$invalid=!1)):(k(!1),this.$invalid=!0,this.$valid=!1,n++),p[a]=!c,k(c,a),l.$setValidity(a,c,this))};this.$setPristine=function(){this.$dirty=!1;this.$pristine=!0;g.removeClass(e,yb);g.addClass(e,Pa)};this.$setViewValue=function(d){this.$viewValue=d;this.$pristine&&(this.$dirty=!0,this.$pristine=!1,g.removeClass(e,Pa),g.addClass(e,yb),l.$setDirty());r(this.$parsers,function(a){d=a(d)});this.$modelValue!==
d&&(this.$modelValue=d,h(a,d),r(this.$viewChangeListeners,function(a){try{a()}catch(d){c(d)}}))};var q=this;a.$watch(function(){var c=m(a);if(q.$modelValue!==c){var d=q.$formatters,e=d.length;for(q.$modelValue=c;e--;)c=d[e](c);q.$viewValue!==c&&(q.$viewValue=c,q.$render())}return c})}],Gd=function(){return{require:["ngModel","^?form"],controller:Ue,link:function(a,c,d,e){var f=e[0],g=e[1]||xb;g.$addControl(f);a.$on("$destroy",function(){g.$removeControl(f)})}}},Id=$({require:"ngModel",link:function(a,
c,d,e){e.$viewChangeListeners.push(function(){a.$eval(d.ngChange)})}}),kc=function(){return{require:"?ngModel",link:function(a,c,d,e){if(e){d.required=!0;var f=function(a){if(d.required&&e.$isEmpty(a))e.$setValidity("required",!1);else return e.$setValidity("required",!0),a};e.$formatters.push(f);e.$parsers.unshift(f);d.$observe("required",function(){f(e.$viewValue)})}}}},Hd=function(){return{require:"ngModel",link:function(a,c,d,e){var f=(a=/\/(.*)\//.exec(d.ngList))&&RegExp(a[1])||d.ngList||",";
e.$parsers.push(function(a){if(!F(a)){var c=[];a&&r(a.split(f),function(a){a&&c.push(aa(a))});return c}});e.$formatters.push(function(a){return L(a)?a.join(", "):s});e.$isEmpty=function(a){return!a||!a.length}}}},Ve=/^(true|false|\d+)$/,Jd=function(){return{priority:100,compile:function(a,c){return Ve.test(c.ngValue)?function(a,c,f){f.$set("value",a.$eval(f.ngValue))}:function(a,c,f){a.$watch(f.ngValue,function(a){f.$set("value",a)})}}}},jd=xa({compile:function(a){a.addClass("ng-binding");return function(a,
d,e){d.data("$binding",e.ngBind);a.$watch(e.ngBind,function(a){d.text(a==s?"":a)})}}}),ld=["$interpolate",function(a){return function(c,d,e){c=a(d.attr(e.$attr.ngBindTemplate));d.addClass("ng-binding").data("$binding",c);e.$observe("ngBindTemplate",function(a){d.text(a)})}}],kd=["$sce","$parse",function(a,c){return{compile:function(d){d.addClass("ng-binding");return function(d,f,g){f.data("$binding",g.ngBindHtml);var k=c(g.ngBindHtml);d.$watch(function(){return(k(d)||"").toString()},function(c){f.html(a.getTrustedHtml(k(d))||
"")})}}}}],md=Yb("",!0),od=Yb("Odd",0),nd=Yb("Even",1),pd=xa({compile:function(a,c){c.$set("ngCloak",s);a.removeClass("ng-cloak")}}),qd=[function(){return{scope:!0,controller:"@",priority:500}}],lc={};r("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(a){var c=na("ng-"+a);lc[c]=["$parse",function(d){return{compile:function(e,f){var g=d(f[c]);return function(c,d){d.on(M(a),function(a){c.$apply(function(){g(c,
{$event:a})})})}}}}]});var td=["$animate",function(a){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,f,g){var k,m,h;c.$watch(e.ngIf,function(f){Ta(f)?m||(m=c.$new(),g(m,function(c){c[c.length++]=X.createComment(" end ngIf: "+e.ngIf+" ");k={clone:c};a.enter(c,d.parent(),d)})):(h&&(h.remove(),h=null),m&&(m.$destroy(),m=null),k&&(h=Eb(k.clone),a.leave(h,function(){h=null}),k=null))})}}}],ud=["$http","$templateCache","$anchorScroll","$animate","$sce",function(a,
c,d,e,f){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:Ua.noop,compile:function(g,k){var m=k.ngInclude||k.src,h=k.onload||"",l=k.autoscroll;return function(g,k,q,r,K){var x=0,v,A,s,u=function(){A&&(A.remove(),A=null);v&&(v.$destroy(),v=null);s&&(e.leave(s,function(){A=null}),A=s,s=null)};g.$watch(f.parseAsResourceUrl(m),function(f){var m=function(){!D(l)||l&&!g.$eval(l)||d()},q=++x;f?(a.get(f,{cache:c}).success(function(a){if(q===x){var c=g.$new();r.template=a;a=K(c,
function(a){u();e.enter(a,null,k,m)});v=c;s=a;v.$emit("$includeContentLoaded");g.$eval(h)}}).error(function(){q===x&&u()}),g.$emit("$includeContentRequested")):(u(),r.template=null)})}}}}],Kd=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(c,d,e,f){d.html(f.template);a(d.contents())(c)}}}],vd=xa({priority:450,compile:function(){return{pre:function(a,c,d){a.$eval(d.ngInit)}}}}),wd=xa({terminal:!0,priority:1E3}),xd=["$locale","$interpolate",function(a,c){var d=
/{}/g;return{restrict:"EA",link:function(e,f,g){var k=g.count,m=g.$attr.when&&f.attr(g.$attr.when),h=g.offset||0,l=e.$eval(m)||{},n={},p=c.startSymbol(),q=c.endSymbol(),t=/^when(Minus)?(.+)$/;r(g,function(a,c){t.test(c)&&(l[M(c.replace("when","").replace("Minus","-"))]=f.attr(g.$attr[c]))});r(l,function(a,e){n[e]=c(a.replace(d,p+k+"-"+h+q))});e.$watch(function(){var c=parseFloat(e.$eval(k));if(isNaN(c))return"";c in l||(c=a.pluralCat(c-h));return n[c](e,f,!0)},function(a){f.text(a)})}}}],yd=["$parse",
"$animate",function(a,c){var d=w("ngRepeat");return{transclude:"element",priority:1E3,terminal:!0,$$tlb:!0,link:function(e,f,g,k,m){var h=g.ngRepeat,l=h.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),n,p,q,t,s,x,v={$id:Ka};if(!l)throw d("iexp",h);g=l[1];k=l[2];(l=l[3])?(n=a(l),p=function(a,c,d){x&&(v[x]=a);v[s]=c;v.$index=d;return n(e,v)}):(q=function(a,c){return Ka(c)},t=function(a){return a});l=g.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);if(!l)throw d("iidexp",
g);s=l[3]||l[1];x=l[2];var A={};e.$watchCollection(k,function(a){var g,k,l=f[0],n,v={},D,B,G,w,C,z,F=[];if(fb(a))C=a,n=p||q;else{n=p||t;C=[];for(G in a)a.hasOwnProperty(G)&&"$"!=G.charAt(0)&&C.push(G);C.sort()}D=C.length;k=F.length=C.length;for(g=0;g<k;g++)if(G=a===C?g:C[g],w=a[G],w=n(G,w,g),Ca(w,"`track by` id"),A.hasOwnProperty(w))z=A[w],delete A[w],v[w]=z,F[g]=z;else{if(v.hasOwnProperty(w))throw r(F,function(a){a&&a.scope&&(A[a.id]=a)}),d("dupes",h,w);F[g]={id:w};v[w]=!1}for(G in A)A.hasOwnProperty(G)&&
(z=A[G],g=Eb(z.clone),c.leave(g),r(g,function(a){a.$$NG_REMOVED=!0}),z.scope.$destroy());g=0;for(k=C.length;g<k;g++){G=a===C?g:C[g];w=a[G];z=F[g];F[g-1]&&(l=F[g-1].clone[F[g-1].clone.length-1]);if(z.scope){B=z.scope;n=l;do n=n.nextSibling;while(n&&n.$$NG_REMOVED);z.clone[0]!=n&&c.move(Eb(z.clone),null,y(l));l=z.clone[z.clone.length-1]}else B=e.$new();B[s]=w;x&&(B[x]=G);B.$index=g;B.$first=0===g;B.$last=g===D-1;B.$middle=!(B.$first||B.$last);B.$odd=!(B.$even=0===(g&1));z.scope||m(B,function(a){a[a.length++]=
X.createComment(" end ngRepeat: "+h+" ");c.enter(a,null,y(l));l=a;z.scope=B;z.clone=a;v[z.id]=z})}A=v})}}}],zd=["$animate",function(a){return function(c,d,e){c.$watch(e.ngShow,function(c){a[Ta(c)?"removeClass":"addClass"](d,"ng-hide")})}}],sd=["$animate",function(a){return function(c,d,e){c.$watch(e.ngHide,function(c){a[Ta(c)?"addClass":"removeClass"](d,"ng-hide")})}}],Ad=xa(function(a,c,d){a.$watch(d.ngStyle,function(a,d){d&&a!==d&&r(d,function(a,d){c.css(d,"")});a&&c.css(a)},!0)}),Bd=["$animate",
function(a){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(c,d,e,f){var g=[],k=[],m=[],h=[];c.$watch(e.ngSwitch||e.on,function(d){var n,p;n=0;for(p=m.length;n<p;++n)m[n].remove();n=m.length=0;for(p=h.length;n<p;++n){var q=k[n];h[n].$destroy();m[n]=q;a.leave(q,function(){m.splice(n,1)})}k.length=0;h.length=0;if(g=f.cases["!"+d]||f.cases["?"])c.$eval(e.change),r(g,function(d){var e=c.$new();h.push(e);d.transclude(e,function(c){var e=d.element;k.push(c);
a.enter(c,e.parent(),e)})})})}}}],Cd=xa({transclude:"element",priority:800,require:"^ngSwitch",link:function(a,c,d,e,f){e.cases["!"+d.ngSwitchWhen]=e.cases["!"+d.ngSwitchWhen]||[];e.cases["!"+d.ngSwitchWhen].push({transclude:f,element:c})}}),Dd=xa({transclude:"element",priority:800,require:"^ngSwitch",link:function(a,c,d,e,f){e.cases["?"]=e.cases["?"]||[];e.cases["?"].push({transclude:f,element:c})}}),Fd=xa({link:function(a,c,d,e,f){if(!f)throw w("ngTransclude")("orphan",ha(c));f(function(a){c.empty();
c.append(a)})}}),fd=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(c,d){"text/ng-template"==d.type&&a.put(d.id,c[0].text)}}}],We=w("ngOptions"),Ed=$({terminal:!0}),gd=["$compile","$parse",function(a,c){var d=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,e={$setViewValue:z};return{restrict:"E",require:["select","?ngModel"],
controller:["$element","$scope","$attrs",function(a,c,d){var m=this,h={},l=e,n;m.databound=d.ngModel;m.init=function(a,c,d){l=a;n=d};m.addOption=function(c){Ca(c,'"option value"');h[c]=!0;l.$viewValue==c&&(a.val(c),n.parent()&&n.remove())};m.removeOption=function(a){this.hasOption(a)&&(delete h[a],l.$viewValue==a&&this.renderUnknownOption(a))};m.renderUnknownOption=function(c){c="? "+Ka(c)+" ?";n.val(c);a.prepend(n);a.val(c);n.prop("selected",!0)};m.hasOption=function(a){return h.hasOwnProperty(a)};
c.$on("$destroy",function(){m.renderUnknownOption=z})}],link:function(e,g,k,m){function h(a,c,d,e){d.$render=function(){var a=d.$viewValue;e.hasOption(a)?(z.parent()&&z.remove(),c.val(a),""===a&&x.prop("selected",!0)):F(a)&&x?c.val(""):e.renderUnknownOption(a)};c.on("change",function(){a.$apply(function(){z.parent()&&z.remove();d.$setViewValue(c.val())})})}function l(a,c,d){var e;d.$render=function(){var a=new ab(d.$viewValue);r(c.find("option"),function(c){c.selected=D(a.get(c.value))})};a.$watch(function(){za(e,
d.$viewValue)||(e=ga(d.$viewValue),d.$render())});c.on("change",function(){a.$apply(function(){var a=[];r(c.find("option"),function(c){c.selected&&a.push(c.value)});d.$setViewValue(a)})})}function n(e,f,g){function k(){var a={"":[]},c=[""],d,h,s,t,u;s=g.$modelValue;t=z(e)||[];var C=n?Zb(t):t,F,O,B;O={};B=!1;if(q)if(h=g.$modelValue,x&&L(h))for(B=new ab([]),d={},u=0;u<h.length;u++)d[m]=h[u],B.put(x(e,d),h[u]);else B=new ab(h);u=B;var E,J;for(B=0;F=C.length,B<F;B++){h=B;if(n){h=C[B];if("$"===h.charAt(0))continue;
O[n]=h}O[m]=t[h];d=p(e,O)||"";(h=a[d])||(h=a[d]=[],c.push(d));q?d=D(u.remove(x?x(e,O):r(e,O))):(x?(d={},d[m]=s,d=x(e,d)===x(e,O)):d=s===r(e,O),u=u||d);E=l(e,O);E=D(E)?E:"";h.push({id:x?x(e,O):n?C[B]:B,label:E,selected:d})}q||(w||null===s?a[""].unshift({id:"",label:"",selected:!u}):u||a[""].unshift({id:"?",label:"",selected:!0}));O=0;for(C=c.length;O<C;O++){d=c[O];h=a[d];y.length<=O?(s={element:A.clone().attr("label",d),label:h.label},t=[s],y.push(t),f.append(s.element)):(t=y[O],s=t[0],s.label!=d&&
s.element.attr("label",s.label=d));E=null;B=0;for(F=h.length;B<F;B++)d=h[B],(u=t[B+1])?(E=u.element,u.label!==d.label&&E.text(u.label=d.label),u.id!==d.id&&E.val(u.id=d.id),E[0].selected!==d.selected&&(E.prop("selected",u.selected=d.selected),Q&&E.prop("selected",u.selected))):(""===d.id&&w?J=w:(J=v.clone()).val(d.id).prop("selected",d.selected).attr("selected",d.selected).text(d.label),t.push({element:J,label:d.label,id:d.id,selected:d.selected}),E?E.after(J):s.element.append(J),E=J);for(B++;t.length>
B;)t.pop().element.remove()}for(;y.length>O;)y.pop()[0].element.remove()}var h;if(!(h=t.match(d)))throw We("iexp",t,ha(f));var l=c(h[2]||h[1]),m=h[4]||h[6],n=h[5],p=c(h[3]||""),r=c(h[2]?h[1]:m),z=c(h[7]),x=h[8]?c(h[8]):null,y=[[{element:f,label:""}]];w&&(a(w)(e),w.removeClass("ng-scope"),w.remove());f.empty();f.on("change",function(){e.$apply(function(){var a,c=z(e)||[],d={},h,l,p,t,u,w,v;if(q)for(l=[],t=0,w=y.length;t<w;t++)for(a=y[t],p=1,u=a.length;p<u;p++){if((h=a[p].element)[0].selected){h=h.val();
n&&(d[n]=h);if(x)for(v=0;v<c.length&&(d[m]=c[v],x(e,d)!=h);v++);else d[m]=c[h];l.push(r(e,d))}}else if(h=f.val(),"?"==h)l=s;else if(""===h)l=null;else if(x)for(v=0;v<c.length;v++){if(d[m]=c[v],x(e,d)==h){l=r(e,d);break}}else d[m]=c[h],n&&(d[n]=h),l=r(e,d);g.$setViewValue(l);k()})});g.$render=k;e.$watchCollection(z,k);q&&e.$watchCollection(function(){return g.$modelValue},k)}if(m[1]){var p=m[0];m=m[1];var q=k.multiple,t=k.ngOptions,w=!1,x,v=y(X.createElement("option")),A=y(X.createElement("optgroup")),
z=v.clone();k=0;for(var u=g.children(),C=u.length;k<C;k++)if(""===u[k].value){x=w=u.eq(k);break}p.init(m,w,z);q&&(m.$isEmpty=function(a){return!a||0===a.length});t?n(e,g,m):q?l(e,g,m):h(e,g,m,p)}}}}],id=["$interpolate",function(a){var c={addOption:z,removeOption:z};return{restrict:"E",priority:100,compile:function(d,e){if(F(e.value)){var f=a(d.text(),!0);f||e.$set("value",d.text())}return function(a,d,e){var h=d.parent(),l=h.data("$selectController")||h.parent().data("$selectController");l&&l.databound?
d.prop("selected",!1):l=c;f?a.$watch(f,function(a,c){e.$set("value",a);a!==c&&l.removeOption(c);l.addOption(a)}):l.addOption(e.value);d.on("$destroy",function(){l.removeOption(e.value)})}}}}],hd=$({restrict:"E",terminal:!0});P.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):((Da=P.jQuery)&&Da.fn.on?(y=Da,E(Da.fn,{scope:La.scope,isolateScope:La.isolateScope,controller:La.controller,injector:La.injector,inheritedData:La.inheritedData}),Gb("remove",!0,!0,!1),Gb("empty",
!1,!1,!1),Gb("html",!1,!1,!0)):y=S,Ua.element=y,$c(Ua),y(X).ready(function(){Xc(X,fc)}))})(window,document);!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>');
;
;
/*! angular-route.min.js */ 
;
;
/*
AngularJS v1.2.22
(c) 2010-2014 Google, Inc. http://angularjs.org
License: MIT
*/
(function(n,e,A){'use strict';function x(s,g,h){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,c,b,f,w){function y(){p&&(p.remove(),p=null);k&&(k.$destroy(),k=null);l&&(h.leave(l,function(){p=null}),p=l,l=null)}function v(){var b=s.current&&s.current.locals;if(e.isDefined(b&&b.$template)){var b=a.$new(),d=s.current;l=w(b,function(d){h.enter(d,null,l||c,function(){!e.isDefined(t)||t&&!a.$eval(t)||g()});y()});k=d.scope=b;k.$emit("$viewContentLoaded");k.$eval(u)}else y()}
var k,l,p,t=b.autoscroll,u=b.onload||"";a.$on("$routeChangeSuccess",v);v()}}}function z(e,g,h){return{restrict:"ECA",priority:-400,link:function(a,c){var b=h.current,f=b.locals;c.html(f.$template);var w=e(c.contents());b.controller&&(f.$scope=a,f=g(b.controller,f),b.controllerAs&&(a[b.controllerAs]=f),c.data("$ngControllerController",f),c.children().data("$ngControllerController",f));w(a)}}}n=e.module("ngRoute",["ng"]).provider("$route",function(){function s(a,c){return e.extend(new (e.extend(function(){},
{prototype:a})),c)}function g(a,e){var b=e.caseInsensitiveMatch,f={originalPath:a,regexp:a},h=f.keys=[];a=a.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(a,e,b,c){a="?"===c?c:null;c="*"===c?c:null;h.push({name:b,optional:!!a});e=e||"";return""+(a?"":e)+"(?:"+(a?e:"")+(c&&"(.+?)"||"([^/]+)")+(a||"")+")"+(a||"")}).replace(/([\/$\*])/g,"\\$1");f.regexp=RegExp("^"+a+"$",b?"i":"");return f}var h={};this.when=function(a,c){h[a]=e.extend({reloadOnSearch:!0},c,a&&g(a,c));if(a){var b=
"/"==a[a.length-1]?a.substr(0,a.length-1):a+"/";h[b]=e.extend({redirectTo:a},g(b,c))}return this};this.otherwise=function(a){this.when(null,a);return this};this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(a,c,b,f,g,n,v,k){function l(){var d=p(),m=r.current;if(d&&m&&d.$$route===m.$$route&&e.equals(d.pathParams,m.pathParams)&&!d.reloadOnSearch&&!u)m.params=d.params,e.copy(m.params,b),a.$broadcast("$routeUpdate",m);else if(d||m)u=!1,a.$broadcast("$routeChangeStart",
d,m),(r.current=d)&&d.redirectTo&&(e.isString(d.redirectTo)?c.path(t(d.redirectTo,d.params)).search(d.params).replace():c.url(d.redirectTo(d.pathParams,c.path(),c.search())).replace()),f.when(d).then(function(){if(d){var a=e.extend({},d.resolve),c,b;e.forEach(a,function(d,c){a[c]=e.isString(d)?g.get(d):g.invoke(d)});e.isDefined(c=d.template)?e.isFunction(c)&&(c=c(d.params)):e.isDefined(b=d.templateUrl)&&(e.isFunction(b)&&(b=b(d.params)),b=k.getTrustedResourceUrl(b),e.isDefined(b)&&(d.loadedTemplateUrl=
b,c=n.get(b,{cache:v}).then(function(a){return a.data})));e.isDefined(c)&&(a.$template=c);return f.all(a)}}).then(function(c){d==r.current&&(d&&(d.locals=c,e.copy(d.params,b)),a.$broadcast("$routeChangeSuccess",d,m))},function(c){d==r.current&&a.$broadcast("$routeChangeError",d,m,c)})}function p(){var a,b;e.forEach(h,function(f,h){var q;if(q=!b){var g=c.path();q=f.keys;var l={};if(f.regexp)if(g=f.regexp.exec(g)){for(var k=1,p=g.length;k<p;++k){var n=q[k-1],r=g[k];n&&r&&(l[n.name]=r)}q=l}else q=null;
else q=null;q=a=q}q&&(b=s(f,{params:e.extend({},c.search(),a),pathParams:a}),b.$$route=f)});return b||h[null]&&s(h[null],{params:{},pathParams:{}})}function t(a,c){var b=[];e.forEach((a||"").split(":"),function(a,d){if(0===d)b.push(a);else{var e=a.match(/(\w+)(.*)/),f=e[1];b.push(c[f]);b.push(e[2]||"");delete c[f]}});return b.join("")}var u=!1,r={routes:h,reload:function(){u=!0;a.$evalAsync(l)}};a.$on("$locationChangeSuccess",l);return r}]});n.provider("$routeParams",function(){this.$get=function(){return{}}});
n.directive("ngView",x);n.directive("ngView",z);x.$inject=["$route","$anchorScroll","$animate"];z.$inject=["$compile","$controller","$route"]})(window,window.angular);
;
;
/*! angular-resource.min.js */ 
;
;
/*
AngularJS v1.2.22
(c) 2010-2014 Google, Inc. http://angularjs.org
License: MIT
*/
(function(H,a,A){'use strict';function D(p,g){g=g||{};a.forEach(g,function(a,c){delete g[c]});for(var c in p)!p.hasOwnProperty(c)||"$"===c.charAt(0)&&"$"===c.charAt(1)||(g[c]=p[c]);return g}var v=a.$$minErr("$resource"),C=/^(\.[a-zA-Z_$][0-9a-zA-Z_$]*)+$/;a.module("ngResource",["ng"]).factory("$resource",["$http","$q",function(p,g){function c(a,c){this.template=a;this.defaults=c||{};this.urlParams={}}function t(n,w,l){function r(h,d){var e={};d=x({},w,d);s(d,function(b,d){u(b)&&(b=b());var k;if(b&&
b.charAt&&"@"==b.charAt(0)){k=h;var a=b.substr(1);if(null==a||""===a||"hasOwnProperty"===a||!C.test("."+a))throw v("badmember",a);for(var a=a.split("."),f=0,c=a.length;f<c&&k!==A;f++){var g=a[f];k=null!==k?k[g]:A}}else k=b;e[d]=k});return e}function e(a){return a.resource}function f(a){D(a||{},this)}var F=new c(n);l=x({},B,l);s(l,function(h,d){var c=/^(POST|PUT|PATCH)$/i.test(h.method);f[d]=function(b,d,k,w){var q={},n,l,y;switch(arguments.length){case 4:y=w,l=k;case 3:case 2:if(u(d)){if(u(b)){l=
b;y=d;break}l=d;y=k}else{q=b;n=d;l=k;break}case 1:u(b)?l=b:c?n=b:q=b;break;case 0:break;default:throw v("badargs",arguments.length);}var t=this instanceof f,m=t?n:h.isArray?[]:new f(n),z={},B=h.interceptor&&h.interceptor.response||e,C=h.interceptor&&h.interceptor.responseError||A;s(h,function(a,b){"params"!=b&&("isArray"!=b&&"interceptor"!=b)&&(z[b]=G(a))});c&&(z.data=n);F.setUrlParams(z,x({},r(n,h.params||{}),q),h.url);q=p(z).then(function(b){var d=b.data,k=m.$promise;if(d){if(a.isArray(d)!==!!h.isArray)throw v("badcfg",
h.isArray?"array":"object",a.isArray(d)?"array":"object");h.isArray?(m.length=0,s(d,function(b){"object"===typeof b?m.push(new f(b)):m.push(b)})):(D(d,m),m.$promise=k)}m.$resolved=!0;b.resource=m;return b},function(b){m.$resolved=!0;(y||E)(b);return g.reject(b)});q=q.then(function(b){var a=B(b);(l||E)(a,b.headers);return a},C);return t?q:(m.$promise=q,m.$resolved=!1,m)};f.prototype["$"+d]=function(b,a,k){u(b)&&(k=a,a=b,b={});b=f[d].call(this,b,this,a,k);return b.$promise||b}});f.bind=function(a){return t(n,
x({},w,a),l)};return f}var B={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},E=a.noop,s=a.forEach,x=a.extend,G=a.copy,u=a.isFunction;c.prototype={setUrlParams:function(c,g,l){var r=this,e=l||r.template,f,p,h=r.urlParams={};s(e.split(/\W/),function(a){if("hasOwnProperty"===a)throw v("badname");!/^\d+$/.test(a)&&(a&&RegExp("(^|[^\\\\]):"+a+"(\\W|$)").test(e))&&(h[a]=!0)});e=e.replace(/\\:/g,":");g=g||{};s(r.urlParams,function(d,
c){f=g.hasOwnProperty(c)?g[c]:r.defaults[c];a.isDefined(f)&&null!==f?(p=encodeURIComponent(f).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"%20").replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+"),e=e.replace(RegExp(":"+c+"(\\W|$)","g"),function(a,c){return p+c})):e=e.replace(RegExp("(/?):"+c+"(\\W|$)","g"),function(a,c,d){return"/"==d.charAt(0)?d:c+d})});e=e.replace(/\/+$/,"")||"/";e=e.replace(/\/\.(?=\w+($|\?))/,".");c.url=e.replace(/\/\\\./,
"/.");s(g,function(a,e){r.urlParams[e]||(c.params=c.params||{},c.params[e]=a)})}};return t}])})(window,window.angular);
;
;
/*! angular-sanitize.min.js */ 
;
;
/*
AngularJS v1.2.22
(c) 2010-2014 Google, Inc. http://angularjs.org
License: MIT
*/
(function(q,g,r){'use strict';function F(a){var d=[];t(d,g.noop).chars(a);return d.join("")}function m(a){var d={};a=a.split(",");var c;for(c=0;c<a.length;c++)d[a[c]]=!0;return d}function G(a,d){function c(a,b,c,h){b=g.lowercase(b);if(u[b])for(;f.last()&&v[f.last()];)e("",f.last());w[b]&&f.last()==b&&e("",b);(h=x[b]||!!h)||f.push(b);var n={};c.replace(H,function(a,b,d,c,e){n[b]=s(d||c||e||"")});d.start&&d.start(b,n,h)}function e(a,b){var c=0,e;if(b=g.lowercase(b))for(c=f.length-1;0<=c&&f[c]!=b;c--);
if(0<=c){for(e=f.length-1;e>=c;e--)d.end&&d.end(f[e]);f.length=c}}"string"!==typeof a&&(a=null===a||"undefined"===typeof a?"":""+a);var b,l,f=[],n=a,h;for(f.last=function(){return f[f.length-1]};a;){h="";l=!0;if(f.last()&&y[f.last()])a=a.replace(RegExp("(.*)<\\s*\\/\\s*"+f.last()+"[^>]*>","i"),function(a,b){b=b.replace(I,"$1").replace(J,"$1");d.chars&&d.chars(s(b));return""}),e("",f.last());else{if(0===a.indexOf("\x3c!--"))b=a.indexOf("--",4),0<=b&&a.lastIndexOf("--\x3e",b)===b&&(d.comment&&d.comment(a.substring(4,
b)),a=a.substring(b+3),l=!1);else if(z.test(a)){if(b=a.match(z))a=a.replace(b[0],""),l=!1}else if(K.test(a)){if(b=a.match(A))a=a.substring(b[0].length),b[0].replace(A,e),l=!1}else L.test(a)&&((b=a.match(B))?(b[4]&&(a=a.substring(b[0].length),b[0].replace(B,c)),l=!1):(h+="<",a=a.substring(1)));l&&(b=a.indexOf("<"),h+=0>b?a:a.substring(0,b),a=0>b?"":a.substring(b),d.chars&&d.chars(s(h)))}if(a==n)throw M("badparse",a);n=a}e()}function s(a){if(!a)return"";var d=N.exec(a);a=d[1];var c=d[3];if(d=d[2])p.innerHTML=
d.replace(/</g,"&lt;"),d="textContent"in p?p.textContent:p.innerText;return a+d+c}function C(a){return a.replace(/&/g,"&amp;").replace(O,function(a){var c=a.charCodeAt(0);a=a.charCodeAt(1);return"&#"+(1024*(c-55296)+(a-56320)+65536)+";"}).replace(P,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function t(a,d){var c=!1,e=g.bind(a,a.push);return{start:function(a,l,f){a=g.lowercase(a);!c&&y[a]&&(c=a);c||!0!==D[a]||(e("<"),e(a),g.forEach(l,function(c,f){var k=
g.lowercase(f),l="img"===a&&"src"===k||"background"===k;!0!==Q[k]||!0===E[k]&&!d(c,l)||(e(" "),e(f),e('="'),e(C(c)),e('"'))}),e(f?"/>":">"))},end:function(a){a=g.lowercase(a);c||!0!==D[a]||(e("</"),e(a),e(">"));a==c&&(c=!1)},chars:function(a){c||e(C(a))}}}var M=g.$$minErr("$sanitize"),B=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,A=/^<\/\s*([\w:-]+)[^>]*>/,H=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,L=/^</,
K=/^<\//,I=/\x3c!--(.*?)--\x3e/g,z=/<!DOCTYPE([^>]*?)>/i,J=/<!\[CDATA\[(.*?)]]\x3e/g,O=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,P=/([^\#-~| |!])/g,x=m("area,br,col,hr,img,wbr");q=m("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr");r=m("rp,rt");var w=g.extend({},r,q),u=g.extend({},q,m("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),v=g.extend({},r,m("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),
y=m("script,style"),D=g.extend({},x,u,v,w),E=m("background,cite,href,longdesc,src,usemap"),Q=g.extend({},E,m("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),p=document.createElement("pre"),N=/^(\s*)([\s\S]*?)(\s*)$/;g.module("ngSanitize",[]).provider("$sanitize",
function(){this.$get=["$$sanitizeUri",function(a){return function(d){var c=[];G(d,t(c,function(c,b){return!/^unsafe/.test(a(c,b))}));return c.join("")}}]});g.module("ngSanitize").filter("linky",["$sanitize",function(a){var d=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,c=/^mailto:/;return function(e,b){function l(a){a&&k.push(F(a))}function f(a,c){k.push("<a ");g.isDefined(b)&&(k.push('target="'),k.push(b),k.push('" '));k.push('href="');k.push(a);k.push('">');l(c);k.push("</a>")}
if(!e)return e;for(var n,h=e,k=[],m,p;n=h.match(d);)m=n[0],n[2]==n[3]&&(m="mailto:"+m),p=n.index,l(h.substr(0,p)),f(m,n[0].replace(c,"")),h=h.substring(p+n[0].length);l(h);return a(k.join(""))}}])})(window,window.angular);
;
;
/*! stacktrace-0.6.4.min.js */ 
;
;
(function(global,factory){if(typeof exports==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{global.printStackTrace=factory()}})(this,function(){function printStackTrace(options){options=options||{guess:true};var ex=options.e||null,guess=!!options.guess,mode=options.mode||null;var p=new printStackTrace.implementation,result=p.run(ex,mode);return guess?p.guessAnonymousFunctions(result):result}printStackTrace.implementation=function(){};printStackTrace.implementation.prototype={run:function(ex,mode){ex=ex||this.createException();mode=mode||this.mode(ex);if(mode==="other"){return this.other(arguments.callee)}else{return this[mode](ex)}},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){if(typeof window!=="undefined"&&window.navigator.userAgent.indexOf("PhantomJS")>-1){return"phantomjs"}if(e["arguments"]&&e.stack){return"chrome"}if(e.stack&&e.sourceURL){return"safari"}if(e.stack&&e.number){return"ie"}if(e.stack&&e.fileName){return"firefox"}if(e.message&&e["opera#sourceloc"]){if(!e.stacktrace){return"opera9"}if(e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length){return"opera9"}return"opera10a"}if(e.message&&e.stack&&e.stacktrace){if(e.stacktrace.indexOf("called from line")<0){return"opera10b"}return"opera11"}if(e.stack&&!e.fileName){return"chrome"}return"other"},instrumentFunction:function(context,functionName,callback){context=context||window;var original=context[functionName];context[functionName]=function instrumented(){callback.call(this,printStackTrace().slice(4));return context[functionName]._instrumented.apply(this,arguments)};context[functionName]._instrumented=original},deinstrumentFunction:function(context,functionName){if(context[functionName].constructor===Function&&context[functionName]._instrumented&&context[functionName]._instrumented.constructor===Function){context[functionName]=context[functionName]._instrumented}},chrome:function(e){return(e.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(e){return e.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(e){var ANON="{anonymous}",lineRE=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var location=match[4]+":"+match[1]+":"+match[2];var fnName=match[3]||"global code";fnName=fnName.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,ANON);result.push(fnName+"@"+location+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera10b:function(e){var lineRE=/^(.*)@(.+):(\d+)$/;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i++){var match=lineRE.exec(lines[i]);if(match){var fnName=match[1]?match[1]+"()":"global code";result.push(fnName+"@"+match[2]+":"+match[3])}}return result},opera10a:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var fnName=match[3]||ANON;result.push(fnName+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera9:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)/i;var lines=e.message.split("\n"),result=[];for(var i=2,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){result.push(ANON+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},phantomjs:function(e){var ANON="{anonymous}",lineRE=/(\S+) \((\S+)\)/i;var lines=e.stack.split("\n"),result=[];for(var i=1,len=lines.length;i<len;i++){lines[i]=lines[i].replace(/^\s+at\s+/gm,"");var match=lineRE.exec(lines[i]);if(match){result.push(match[1]+"()@"+match[2])}else{result.push(ANON+"()@"+lines[i])}}return result},other:function(curr){var ANON="{anonymous}",fnRE=/function(?:\s+([\w$]+))?\s*\(/,stack=[],fn,args,maxStackSize=10;var slice=Array.prototype.slice;while(curr&&stack.length<maxStackSize){fn=fnRE.test(curr.toString())?RegExp.$1||ANON:ANON;try{args=slice.call(curr["arguments"]||[])}catch(e){args=["Cannot access arguments: "+e]}stack[stack.length]=fn+"("+this.stringifyArguments(args)+")";try{curr=curr.caller}catch(e){stack[stack.length]="Cannot access caller: "+e;break}}return stack},stringifyArguments:function(args){var result=[];var slice=Array.prototype.slice;for(var i=0;i<args.length;++i){var arg=args[i];if(arg===undefined){result[i]="undefined"}else if(arg===null){result[i]="null"}else if(arg.constructor){if(arg.constructor===Array){if(arg.length<3){result[i]="["+this.stringifyArguments(arg)+"]"}else{result[i]="["+this.stringifyArguments(slice.call(arg,0,1))+"..."+this.stringifyArguments(slice.call(arg,-1))+"]"}}else if(arg.constructor===Object){result[i]="#object"}else if(arg.constructor===Function){result[i]="#function"}else if(arg.constructor===String){result[i]='"'+arg+'"'}else if(arg.constructor===Number){result[i]=arg}else{result[i]="?"}}}return result.join(",")},sourceCache:{},ajax:function(url){var req=this.createXMLHTTPObject();if(req){try{req.open("GET",url,false);req.send(null);return req.responseText}catch(e){}}return""},createXMLHTTPObject:function(){var xmlhttp,XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();this.createXMLHTTPObject=XMLHttpFactories[i];return xmlhttp}catch(e){}}},isSameDomain:function(url){return typeof location!=="undefined"&&url.indexOf(location.hostname)!==-1},getSource:function(url){if(!(url in this.sourceCache)){this.sourceCache[url]=this.ajax(url).split("\n")}return this.sourceCache[url]},guessAnonymousFunctions:function(stack){for(var i=0;i<stack.length;++i){var reStack=/\{anonymous\}\(.*\)@(.*)/,reRef=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,frame=stack[i],ref=reStack.exec(frame);if(ref){var m=reRef.exec(ref[1]);if(m){var file=m[1],lineno=m[2],charno=m[3]||0;if(file&&this.isSameDomain(file)&&lineno){var functionName=this.guessAnonymousFunction(file,lineno,charno);stack[i]=frame.replace("{anonymous}",functionName)}}}}return stack},guessAnonymousFunction:function(url,lineNo,charNo){var ret;try{ret=this.findFunctionName(this.getSource(url),lineNo)}catch(e){ret="getSource failed with url: "+url+", exception: "+e.toString()}return ret},findFunctionName:function(source,lineNo){var reFunctionDeclaration=/function\s+([^(]*?)\s*\(([^)]*)\)/;var reFunctionExpression=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/;var reFunctionEvaluation=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var code="",line,maxLines=Math.min(lineNo,20),m,commentPos;for(var i=0;i<maxLines;++i){line=source[lineNo-i-1];commentPos=line.indexOf("//");if(commentPos>=0){line=line.substr(0,commentPos)}if(line){code=line+code;m=reFunctionExpression.exec(code);if(m&&m[1]){return m[1]}m=reFunctionDeclaration.exec(code);if(m&&m[1]){return m[1]}m=reFunctionEvaluation.exec(code);if(m&&m[1]){return m[1]}}}return"(?)"}};return printStackTrace});

;
;
/*! ZeroClipboard.js */ 
;
;
/*!
* ZeroClipboard
* The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
* Copyright (c) 2014 Jon Rohan, James M. Greene
* Licensed MIT
* http://zeroclipboard.org/
* v1.3.5
*/
(function(window) {
"use strict";
var currentElement;
var flashState = {
bridge: null,
version: "0.0.0",
disabled: null,
outdated: null,
ready: null
};
var _clipData = {};
var clientIdCounter = 0;
var _clientMeta = {};
var elementIdCounter = 0;
var _elementMeta = {};
var _amdModuleId = null;
var _cjsModuleId = null;
var _swfPath = function() {
var i, jsDir, tmpJsPath, jsPath, swfPath = "ZeroClipboard.swf";
if (document.currentScript && (jsPath = document.currentScript.src)) {} else {
var scripts = document.getElementsByTagName("script");
if ("readyState" in scripts[0]) {
for (i = scripts.length; i--; ) {
if (scripts[i].readyState === "interactive" && (jsPath = scripts[i].src)) {
break;
}
}
} else if (document.readyState === "loading") {
jsPath = scripts[scripts.length - 1].src;
} else {
for (i = scripts.length; i--; ) {
tmpJsPath = scripts[i].src;
if (!tmpJsPath) {
jsDir = null;
break;
}
tmpJsPath = tmpJsPath.split("#")[0].split("?")[0];
tmpJsPath = tmpJsPath.slice(0, tmpJsPath.lastIndexOf("/") + 1);
if (jsDir == null) {
jsDir = tmpJsPath;
} else if (jsDir !== tmpJsPath) {
jsDir = null;
break;
}
}
if (jsDir !== null) {
jsPath = jsDir;
}
}
}
if (jsPath) {
jsPath = jsPath.split("#")[0].split("?")[0];
swfPath = jsPath.slice(0, jsPath.lastIndexOf("/") + 1) + swfPath;
}
return swfPath;
}();
var _camelizeCssPropName = function() {
var matcherRegex = /\-([a-z])/g, replacerFn = function(match, group) {
return group.toUpperCase();
};
return function(prop) {
return prop.replace(matcherRegex, replacerFn);
};
}();
var _getStyle = function(el, prop) {
var value, camelProp, tagName, possiblePointers, i, len;
if (window.getComputedStyle) {
value = window.getComputedStyle(el, null).getPropertyValue(prop);
} else {
camelProp = _camelizeCssPropName(prop);
if (el.currentStyle) {
value = el.currentStyle[camelProp];
} else {
value = el.style[camelProp];
}
}
if (prop === "cursor") {
if (!value || value === "auto") {
tagName = el.tagName.toLowerCase();
if (tagName === "a") {
return "pointer";
}
}
}
return value;
};
var _elementMouseOver = function(event) {
if (!event) {
event = window.event;
}
var target;
if (this !== window) {
target = this;
} else if (event.target) {
target = event.target;
} else if (event.srcElement) {
target = event.srcElement;
}
ZeroClipboard.activate(target);
};
var _addEventHandler = function(element, method, func) {
if (!element || element.nodeType !== 1) {
return;
}
if (element.addEventListener) {
element.addEventListener(method, func, false);
} else if (element.attachEvent) {
element.attachEvent("on" + method, func);
}
};
var _removeEventHandler = function(element, method, func) {
if (!element || element.nodeType !== 1) {
return;
}
if (element.removeEventListener) {
element.removeEventListener(method, func, false);
} else if (element.detachEvent) {
element.detachEvent("on" + method, func);
}
};
var _addClass = function(element, value) {
if (!element || element.nodeType !== 1) {
return element;
}
if (element.classList) {
if (!element.classList.contains(value)) {
element.classList.add(value);
}
return element;
}
if (value && typeof value === "string") {
var classNames = (value || "").split(/\s+/);
if (element.nodeType === 1) {
if (!element.className) {
element.className = value;
} else {
var className = " " + element.className + " ", setClass = element.className;
for (var c = 0, cl = classNames.length; c < cl; c++) {
if (className.indexOf(" " + classNames[c] + " ") < 0) {
setClass += " " + classNames[c];
}
}
element.className = setClass.replace(/^\s+|\s+$/g, "");
}
}
}
return element;
};
var _removeClass = function(element, value) {
if (!element || element.nodeType !== 1) {
return element;
}
if (element.classList) {
if (element.classList.contains(value)) {
element.classList.remove(value);
}
return element;
}
if (value && typeof value === "string" || value === undefined) {
var classNames = (value || "").split(/\s+/);
if (element.nodeType === 1 && element.className) {
if (value) {
var className = (" " + element.className + " ").replace(/[\n\t]/g, " ");
for (var c = 0, cl = classNames.length; c < cl; c++) {
className = className.replace(" " + classNames[c] + " ", " ");
}
element.className = className.replace(/^\s+|\s+$/g, "");
} else {
element.className = "";
}
}
}
return element;
};
var _getZoomFactor = function() {
var rect, physicalWidth, logicalWidth, zoomFactor = 1;
if (typeof document.body.getBoundingClientRect === "function") {
rect = document.body.getBoundingClientRect();
physicalWidth = rect.right - rect.left;
logicalWidth = document.body.offsetWidth;
zoomFactor = Math.round(physicalWidth / logicalWidth * 100) / 100;
}
return zoomFactor;
};
var _getDOMObjectPosition = function(obj, defaultZIndex) {
var info = {
left: 0,
top: 0,
width: 0,
height: 0,
zIndex: _getSafeZIndex(defaultZIndex) - 1
};
if (obj.getBoundingClientRect) {
var rect = obj.getBoundingClientRect();
var pageXOffset, pageYOffset, zoomFactor;
if ("pageXOffset" in window && "pageYOffset" in window) {
pageXOffset = window.pageXOffset;
pageYOffset = window.pageYOffset;
} else {
zoomFactor = _getZoomFactor();
pageXOffset = Math.round(document.documentElement.scrollLeft / zoomFactor);
pageYOffset = Math.round(document.documentElement.scrollTop / zoomFactor);
}
var leftBorderWidth = document.documentElement.clientLeft || 0;
var topBorderWidth = document.documentElement.clientTop || 0;
info.left = rect.left + pageXOffset - leftBorderWidth;
info.top = rect.top + pageYOffset - topBorderWidth;
info.width = "width" in rect ? rect.width : rect.right - rect.left;
info.height = "height" in rect ? rect.height : rect.bottom - rect.top;
}
return info;
};
var _cacheBust = function(path, options) {
var cacheBust = options == null || options && options.cacheBust === true && options.useNoCache === true;
if (cacheBust) {
return (path.indexOf("?") === -1 ? "?" : "&") + "noCache=" + new Date().getTime();
} else {
return "";
}
};
var _vars = function(options) {
var i, len, domain, str = [], domains = [], trustedOriginsExpanded = [];
if (options.trustedOrigins) {
if (typeof options.trustedOrigins === "string") {
domains.push(options.trustedOrigins);
} else if (typeof options.trustedOrigins === "object" && "length" in options.trustedOrigins) {
domains = domains.concat(options.trustedOrigins);
}
}
if (options.trustedDomains) {
if (typeof options.trustedDomains === "string") {
domains.push(options.trustedDomains);
} else if (typeof options.trustedDomains === "object" && "length" in options.trustedDomains) {
domains = domains.concat(options.trustedDomains);
}
}
if (domains.length) {
for (i = 0, len = domains.length; i < len; i++) {
if (domains.hasOwnProperty(i) && domains[i] && typeof domains[i] === "string") {
domain = _extractDomain(domains[i]);
if (!domain) {
continue;
}
if (domain === "*") {
trustedOriginsExpanded = [ domain ];
break;
}
trustedOriginsExpanded.push.apply(trustedOriginsExpanded, [ domain, "//" + domain, window.location.protocol + "//" + domain ]);
}
}
}
if (trustedOriginsExpanded.length) {
str.push("trustedOrigins=" + encodeURIComponent(trustedOriginsExpanded.join(",")));
}
if (typeof options.jsModuleId === "string" && options.jsModuleId) {
str.push("jsModuleId=" + encodeURIComponent(options.jsModuleId));
}
return str.join("&");
};
var _inArray = function(elem, array, fromIndex) {
if (typeof array.indexOf === "function") {
return array.indexOf(elem, fromIndex);
}
var i, len = array.length;
if (typeof fromIndex === "undefined") {
fromIndex = 0;
} else if (fromIndex < 0) {
fromIndex = len + fromIndex;
}
for (i = fromIndex; i < len; i++) {
if (array.hasOwnProperty(i) && array[i] === elem) {
return i;
}
}
return -1;
};
var _prepClip = function(elements) {
if (typeof elements === "string") throw new TypeError("ZeroClipboard doesn't accept query strings.");
if (!elements.length) return [ elements ];
return elements;
};
var _dispatchCallback = function(func, context, args, async) {
if (async) {
window.setTimeout(function() {
func.apply(context, args);
}, 0);
} else {
func.apply(context, args);
}
};
var _getSafeZIndex = function(val) {
var zIndex, tmp;
if (val) {
if (typeof val === "number" && val > 0) {
zIndex = val;
} else if (typeof val === "string" && (tmp = parseInt(val, 10)) && !isNaN(tmp) && tmp > 0) {
zIndex = tmp;
}
}
if (!zIndex) {
if (typeof _globalConfig.zIndex === "number" && _globalConfig.zIndex > 0) {
zIndex = _globalConfig.zIndex;
} else if (typeof _globalConfig.zIndex === "string" && (tmp = parseInt(_globalConfig.zIndex, 10)) && !isNaN(tmp) && tmp > 0) {
zIndex = tmp;
}
}
return zIndex || 0;
};
var _deprecationWarning = function(deprecatedApiName, debugEnabled) {
if (deprecatedApiName && debugEnabled !== false && typeof console !== "undefined" && console && (console.warn || console.log)) {
var deprecationWarning = "`" + deprecatedApiName + "` is deprecated. See docs for more info:\n" + "    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";
if (console.warn) {
console.warn(deprecationWarning);
} else {
console.log(deprecationWarning);
}
}
};
var _extend = function() {
var i, len, arg, prop, src, copy, target = arguments[0] || {};
for (i = 1, len = arguments.length; i < len; i++) {
if ((arg = arguments[i]) != null) {
for (prop in arg) {
if (arg.hasOwnProperty(prop)) {
src = target[prop];
copy = arg[prop];
if (target === copy) {
continue;
}
if (copy !== undefined) {
target[prop] = copy;
}
}
}
}
}
return target;
};
var _extractDomain = function(originOrUrl) {
if (originOrUrl == null || originOrUrl === "") {
return null;
}
originOrUrl = originOrUrl.replace(/^\s+|\s+$/g, "");
if (originOrUrl === "") {
return null;
}
var protocolIndex = originOrUrl.indexOf("//");
originOrUrl = protocolIndex === -1 ? originOrUrl : originOrUrl.slice(protocolIndex + 2);
var pathIndex = originOrUrl.indexOf("/");
originOrUrl = pathIndex === -1 ? originOrUrl : protocolIndex === -1 || pathIndex === 0 ? null : originOrUrl.slice(0, pathIndex);
if (originOrUrl && originOrUrl.slice(-4).toLowerCase() === ".swf") {
return null;
}
return originOrUrl || null;
};
var _determineScriptAccess = function() {
var _extractAllDomains = function(origins, resultsArray) {
var i, len, tmp;
if (origins != null && resultsArray[0] !== "*") {
if (typeof origins === "string") {
origins = [ origins ];
}
if (typeof origins === "object" && "length" in origins) {
for (i = 0, len = origins.length; i < len; i++) {
if (origins.hasOwnProperty(i)) {
tmp = _extractDomain(origins[i]);
if (tmp) {
if (tmp === "*") {
resultsArray.length = 0;
resultsArray.push("*");
break;
}
if (_inArray(tmp, resultsArray) === -1) {
resultsArray.push(tmp);
}
}
}
}
}
}
};
var _accessLevelLookup = {
always: "always",
samedomain: "sameDomain",
never: "never"
};
return function(currentDomain, configOptions) {
var asaLower, allowScriptAccess = configOptions.allowScriptAccess;
if (typeof allowScriptAccess === "string" && (asaLower = allowScriptAccess.toLowerCase()) && /^always|samedomain|never$/.test(asaLower)) {
return _accessLevelLookup[asaLower];
}
var swfDomain = _extractDomain(configOptions.moviePath);
if (swfDomain === null) {
swfDomain = currentDomain;
}
var trustedDomains = [];
_extractAllDomains(configOptions.trustedOrigins, trustedDomains);
_extractAllDomains(configOptions.trustedDomains, trustedDomains);
var len = trustedDomains.length;
if (len > 0) {
if (len === 1 && trustedDomains[0] === "*") {
return "always";
}
if (_inArray(currentDomain, trustedDomains) !== -1) {
if (len === 1 && currentDomain === swfDomain) {
return "sameDomain";
}
return "always";
}
}
return "never";
};
}();
var _objectKeys = function(obj) {
if (obj == null) {
return [];
}
if (Object.keys) {
return Object.keys(obj);
}
var keys = [];
for (var prop in obj) {
if (obj.hasOwnProperty(prop)) {
keys.push(prop);
}
}
return keys;
};
var _deleteOwnProperties = function(obj) {
if (obj) {
for (var prop in obj) {
if (obj.hasOwnProperty(prop)) {
delete obj[prop];
}
}
}
return obj;
};
var _safeActiveElement = function() {
try {
return document.activeElement;
} catch (err) {}
return null;
};
var _detectFlashSupport = function() {
var hasFlash = false;
if (typeof flashState.disabled === "boolean") {
hasFlash = flashState.disabled === false;
} else {
if (typeof ActiveXObject === "function") {
try {
if (new ActiveXObject("ShockwaveFlash.ShockwaveFlash")) {
hasFlash = true;
}
} catch (error) {}
}
if (!hasFlash && navigator.mimeTypes["application/x-shockwave-flash"]) {
hasFlash = true;
}
}
return hasFlash;
};
function _parseFlashVersion(flashVersion) {
return flashVersion.replace(/,/g, ".").replace(/[^0-9\.]/g, "");
}
function _isFlashVersionSupported(flashVersion) {
return parseFloat(_parseFlashVersion(flashVersion)) >= 10;
}
var ZeroClipboard = function(elements, options) {
if (!(this instanceof ZeroClipboard)) {
return new ZeroClipboard(elements, options);
}
this.id = "" + clientIdCounter++;
_clientMeta[this.id] = {
instance: this,
elements: [],
handlers: {}
};
if (elements) {
this.clip(elements);
}
if (typeof options !== "undefined") {
_deprecationWarning("new ZeroClipboard(elements, options)", _globalConfig.debug);
ZeroClipboard.config(options);
}
this.options = ZeroClipboard.config();
if (typeof flashState.disabled !== "boolean") {
flashState.disabled = !_detectFlashSupport();
}
if (flashState.disabled === false && flashState.outdated !== true) {
if (flashState.bridge === null) {
flashState.outdated = false;
flashState.ready = false;
_bridge();
}
}
};
ZeroClipboard.prototype.setText = function(newText) {
if (newText && newText !== "") {
_clipData["text/plain"] = newText;
if (flashState.ready === true && flashState.bridge && typeof flashState.bridge.setText === "function") {
flashState.bridge.setText(newText);
} else {
flashState.ready = false;
}
}
return this;
};
ZeroClipboard.prototype.setSize = function(width, height) {
if (flashState.ready === true && flashState.bridge && typeof flashState.bridge.setSize === "function") {
flashState.bridge.setSize(width, height);
} else {
flashState.ready = false;
}
return this;
};
var _setHandCursor = function(enabled) {
if (flashState.ready === true && flashState.bridge && typeof flashState.bridge.setHandCursor === "function") {
flashState.bridge.setHandCursor(enabled);
} else {
flashState.ready = false;
}
};
ZeroClipboard.prototype.destroy = function() {
this.unclip();
this.off();
delete _clientMeta[this.id];
};
var _getAllClients = function() {
var i, len, client, clients = [], clientIds = _objectKeys(_clientMeta);
for (i = 0, len = clientIds.length; i < len; i++) {
client = _clientMeta[clientIds[i]].instance;
if (client && client instanceof ZeroClipboard) {
clients.push(client);
}
}
return clients;
};
ZeroClipboard.version = "1.3.5";
var _globalConfig = {
swfPath: _swfPath,
trustedDomains: window.location.host ? [ window.location.host ] : [],
cacheBust: true,
forceHandCursor: false,
zIndex: 999999999,
debug: true,
title: null,
autoActivate: true
};
ZeroClipboard.config = function(options) {
if (typeof options === "object" && options !== null) {
_extend(_globalConfig, options);
}
if (typeof options === "string" && options) {
if (_globalConfig.hasOwnProperty(options)) {
return _globalConfig[options];
}
return;
}
var copy = {};
for (var prop in _globalConfig) {
if (_globalConfig.hasOwnProperty(prop)) {
if (typeof _globalConfig[prop] === "object" && _globalConfig[prop] !== null) {
if ("length" in _globalConfig[prop]) {
copy[prop] = _globalConfig[prop].slice(0);
} else {
copy[prop] = _extend({}, _globalConfig[prop]);
}
} else {
copy[prop] = _globalConfig[prop];
}
}
}
return copy;
};
ZeroClipboard.destroy = function() {
ZeroClipboard.deactivate();
for (var clientId in _clientMeta) {
if (_clientMeta.hasOwnProperty(clientId) && _clientMeta[clientId]) {
var client = _clientMeta[clientId].instance;
if (client && typeof client.destroy === "function") {
client.destroy();
}
}
}
var htmlBridge = _getHtmlBridge(flashState.bridge);
if (htmlBridge && htmlBridge.parentNode) {
htmlBridge.parentNode.removeChild(htmlBridge);
flashState.ready = null;
flashState.bridge = null;
}
};
ZeroClipboard.activate = function(element) {
if (currentElement) {
_removeClass(currentElement, _globalConfig.hoverClass);
_removeClass(currentElement, _globalConfig.activeClass);
}
currentElement = element;
_addClass(element, _globalConfig.hoverClass);
_reposition();
var newTitle = _globalConfig.title || element.getAttribute("title");
if (newTitle) {
var htmlBridge = _getHtmlBridge(flashState.bridge);
if (htmlBridge) {
htmlBridge.setAttribute("title", newTitle);
}
}
var useHandCursor = _globalConfig.forceHandCursor === true || _getStyle(element, "cursor") === "pointer";
_setHandCursor(useHandCursor);
};
ZeroClipboard.deactivate = function() {
var htmlBridge = _getHtmlBridge(flashState.bridge);
if (htmlBridge) {
htmlBridge.style.left = "0px";
htmlBridge.style.top = "-9999px";
htmlBridge.removeAttribute("title");
}
if (currentElement) {
_removeClass(currentElement, _globalConfig.hoverClass);
_removeClass(currentElement, _globalConfig.activeClass);
currentElement = null;
}
};
var _bridge = function() {
var flashBridge, len;
var container = document.getElementById("global-zeroclipboard-html-bridge");
if (!container) {
var opts = ZeroClipboard.config();
opts.jsModuleId = typeof _amdModuleId === "string" && _amdModuleId || typeof _cjsModuleId === "string" && _cjsModuleId || null;
var allowScriptAccess = _determineScriptAccess(window.location.host, _globalConfig);
var flashvars = _vars(opts);
var swfUrl = _globalConfig.moviePath + _cacheBust(_globalConfig.moviePath, _globalConfig);
var html = '      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="' + swfUrl + '"/>         <param name="allowScriptAccess" value="' + allowScriptAccess + '"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="' + flashvars + '"/>         <embed src="' + swfUrl + '"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="' + allowScriptAccess + '"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="' + flashvars + '"           scale="exactfit">         </embed>       </object>';
container = document.createElement("div");
container.id = "global-zeroclipboard-html-bridge";
container.setAttribute("class", "global-zeroclipboard-container");
container.style.position = "absolute";
container.style.left = "0px";
container.style.top = "-9999px";
container.style.width = "15px";
container.style.height = "15px";
container.style.zIndex = "" + _getSafeZIndex(_globalConfig.zIndex);
document.body.appendChild(container);
container.innerHTML = html;
}
flashBridge = document["global-zeroclipboard-flash-bridge"];
if (flashBridge && (len = flashBridge.length)) {
flashBridge = flashBridge[len - 1];
}
flashState.bridge = flashBridge || container.children[0].lastElementChild;
};
var _getHtmlBridge = function(flashBridge) {
var isFlashElement = /^OBJECT|EMBED$/;
var htmlBridge = flashBridge && flashBridge.parentNode;
while (htmlBridge && isFlashElement.test(htmlBridge.nodeName) && htmlBridge.parentNode) {
htmlBridge = htmlBridge.parentNode;
}
return htmlBridge || null;
};
var _reposition = function() {
if (currentElement) {
var pos = _getDOMObjectPosition(currentElement, _globalConfig.zIndex);
var htmlBridge = _getHtmlBridge(flashState.bridge);
if (htmlBridge) {
htmlBridge.style.top = pos.top + "px";
htmlBridge.style.left = pos.left + "px";
htmlBridge.style.width = pos.width + "px";
htmlBridge.style.height = pos.height + "px";
htmlBridge.style.zIndex = pos.zIndex + 1;
}
if (flashState.ready === true && flashState.bridge && typeof flashState.bridge.setSize === "function") {
flashState.bridge.setSize(pos.width, pos.height);
} else {
flashState.ready = false;
}
}
return this;
};
ZeroClipboard.prototype.on = function(eventName, func) {
var i, len, events, added = {}, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;
if (typeof eventName === "string" && eventName) {
events = eventName.toLowerCase().split(/\s+/);
} else if (typeof eventName === "object" && eventName && typeof func === "undefined") {
for (i in eventName) {
if (eventName.hasOwnProperty(i) && typeof i === "string" && i && typeof eventName[i] === "function") {
this.on(i, eventName[i]);
}
}
}
if (events && events.length) {
for (i = 0, len = events.length; i < len; i++) {
eventName = events[i].replace(/^on/, "");
added[eventName] = true;
if (!handlers[eventName]) {
handlers[eventName] = [];
}
handlers[eventName].push(func);
}
if (added.noflash && flashState.disabled) {
_receiveEvent.call(this, "noflash", {});
}
if (added.wrongflash && flashState.outdated) {
_receiveEvent.call(this, "wrongflash", {
flashVersion: flashState.version
});
}
if (added.load && flashState.ready) {
_receiveEvent.call(this, "load", {
flashVersion: flashState.version
});
}
}
return this;
};
ZeroClipboard.prototype.off = function(eventName, func) {
var i, len, foundIndex, events, perEventHandlers, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;
if (arguments.length === 0) {
events = _objectKeys(handlers);
} else if (typeof eventName === "string" && eventName) {
events = eventName.split(/\s+/);
} else if (typeof eventName === "object" && eventName && typeof func === "undefined") {
for (i in eventName) {
if (eventName.hasOwnProperty(i) && typeof i === "string" && i && typeof eventName[i] === "function") {
this.off(i, eventName[i]);
}
}
}
if (events && events.length) {
for (i = 0, len = events.length; i < len; i++) {
eventName = events[i].toLowerCase().replace(/^on/, "");
perEventHandlers = handlers[eventName];
if (perEventHandlers && perEventHandlers.length) {
if (func) {
foundIndex = _inArray(func, perEventHandlers);
while (foundIndex !== -1) {
perEventHandlers.splice(foundIndex, 1);
foundIndex = _inArray(func, perEventHandlers, foundIndex);
}
} else {
handlers[eventName].length = 0;
}
}
}
}
return this;
};
ZeroClipboard.prototype.handlers = function(eventName) {
var prop, copy = null, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;
if (handlers) {
if (typeof eventName === "string" && eventName) {
return handlers[eventName] ? handlers[eventName].slice(0) : null;
}
copy = {};
for (prop in handlers) {
if (handlers.hasOwnProperty(prop) && handlers[prop]) {
copy[prop] = handlers[prop].slice(0);
}
}
}
return copy;
};
var _dispatchClientCallbacks = function(eventName, context, args, async) {
var handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers[eventName];
if (handlers && handlers.length) {
var i, len, func, originalContext = context || this;
for (i = 0, len = handlers.length; i < len; i++) {
func = handlers[i];
context = originalContext;
if (typeof func === "string" && typeof window[func] === "function") {
func = window[func];
}
if (typeof func === "object" && func && typeof func.handleEvent === "function") {
context = func;
func = func.handleEvent;
}
if (typeof func === "function") {
_dispatchCallback(func, context, args, async);
}
}
}
return this;
};
ZeroClipboard.prototype.clip = function(elements) {
elements = _prepClip(elements);
for (var i = 0; i < elements.length; i++) {
if (elements.hasOwnProperty(i) && elements[i] && elements[i].nodeType === 1) {
if (!elements[i].zcClippingId) {
elements[i].zcClippingId = "zcClippingId_" + elementIdCounter++;
_elementMeta[elements[i].zcClippingId] = [ this.id ];
if (_globalConfig.autoActivate === true) {
_addEventHandler(elements[i], "mouseover", _elementMouseOver);
}
} else if (_inArray(this.id, _elementMeta[elements[i].zcClippingId]) === -1) {
_elementMeta[elements[i].zcClippingId].push(this.id);
}
var clippedElements = _clientMeta[this.id].elements;
if (_inArray(elements[i], clippedElements) === -1) {
clippedElements.push(elements[i]);
}
}
}
return this;
};
ZeroClipboard.prototype.unclip = function(elements) {
var meta = _clientMeta[this.id];
if (meta) {
var clippedElements = meta.elements;
var arrayIndex;
if (typeof elements === "undefined") {
elements = clippedElements.slice(0);
} else {
elements = _prepClip(elements);
}
for (var i = elements.length; i--; ) {
if (elements.hasOwnProperty(i) && elements[i] && elements[i].nodeType === 1) {
arrayIndex = 0;
while ((arrayIndex = _inArray(elements[i], clippedElements, arrayIndex)) !== -1) {
clippedElements.splice(arrayIndex, 1);
}
var clientIds = _elementMeta[elements[i].zcClippingId];
if (clientIds) {
arrayIndex = 0;
while ((arrayIndex = _inArray(this.id, clientIds, arrayIndex)) !== -1) {
clientIds.splice(arrayIndex, 1);
}
if (clientIds.length === 0) {
if (_globalConfig.autoActivate === true) {
_removeEventHandler(elements[i], "mouseover", _elementMouseOver);
}
delete elements[i].zcClippingId;
}
}
}
}
}
return this;
};
ZeroClipboard.prototype.elements = function() {
var meta = _clientMeta[this.id];
return meta && meta.elements ? meta.elements.slice(0) : [];
};
var _getAllClientsClippedToElement = function(element) {
var elementMetaId, clientIds, i, len, client, clients = [];
if (element && element.nodeType === 1 && (elementMetaId = element.zcClippingId) && _elementMeta.hasOwnProperty(elementMetaId)) {
clientIds = _elementMeta[elementMetaId];
if (clientIds && clientIds.length) {
for (i = 0, len = clientIds.length; i < len; i++) {
client = _clientMeta[clientIds[i]].instance;
if (client && client instanceof ZeroClipboard) {
clients.push(client);
}
}
}
}
return clients;
};
_globalConfig.hoverClass = "zeroclipboard-is-hover";
_globalConfig.activeClass = "zeroclipboard-is-active";
_globalConfig.trustedOrigins = null;
_globalConfig.allowScriptAccess = null;
_globalConfig.useNoCache = true;
_globalConfig.moviePath = "ZeroClipboard.swf";
ZeroClipboard.detectFlashSupport = function() {
_deprecationWarning("ZeroClipboard.detectFlashSupport", _globalConfig.debug);
return _detectFlashSupport();
};
ZeroClipboard.dispatch = function(eventName, args) {
if (typeof eventName === "string" && eventName) {
var cleanEventName = eventName.toLowerCase().replace(/^on/, "");
if (cleanEventName) {
var clients = currentElement && _globalConfig.autoActivate === true ? _getAllClientsClippedToElement(currentElement) : _getAllClients();
for (var i = 0, len = clients.length; i < len; i++) {
_receiveEvent.call(clients[i], cleanEventName, args);
}
}
}
};
ZeroClipboard.prototype.setHandCursor = function(enabled) {
_deprecationWarning("ZeroClipboard.prototype.setHandCursor", _globalConfig.debug);
enabled = typeof enabled === "boolean" ? enabled : !!enabled;
_setHandCursor(enabled);
_globalConfig.forceHandCursor = enabled;
return this;
};
ZeroClipboard.prototype.reposition = function() {
_deprecationWarning("ZeroClipboard.prototype.reposition", _globalConfig.debug);
return _reposition();
};
ZeroClipboard.prototype.receiveEvent = function(eventName, args) {
_deprecationWarning("ZeroClipboard.prototype.receiveEvent", _globalConfig.debug);
if (typeof eventName === "string" && eventName) {
var cleanEventName = eventName.toLowerCase().replace(/^on/, "");
if (cleanEventName) {
_receiveEvent.call(this, cleanEventName, args);
}
}
};
ZeroClipboard.prototype.setCurrent = function(element) {
_deprecationWarning("ZeroClipboard.prototype.setCurrent", _globalConfig.debug);
ZeroClipboard.activate(element);
return this;
};
ZeroClipboard.prototype.resetBridge = function() {
_deprecationWarning("ZeroClipboard.prototype.resetBridge", _globalConfig.debug);
ZeroClipboard.deactivate();
return this;
};
ZeroClipboard.prototype.setTitle = function(newTitle) {
_deprecationWarning("ZeroClipboard.prototype.setTitle", _globalConfig.debug);
newTitle = newTitle || _globalConfig.title || currentElement && currentElement.getAttribute("title");
if (newTitle) {
var htmlBridge = _getHtmlBridge(flashState.bridge);
if (htmlBridge) {
htmlBridge.setAttribute("title", newTitle);
}
}
return this;
};
ZeroClipboard.setDefaults = function(options) {
_deprecationWarning("ZeroClipboard.setDefaults", _globalConfig.debug);
ZeroClipboard.config(options);
};
ZeroClipboard.prototype.addEventListener = function(eventName, func) {
_deprecationWarning("ZeroClipboard.prototype.addEventListener", _globalConfig.debug);
return this.on(eventName, func);
};
ZeroClipboard.prototype.removeEventListener = function(eventName, func) {
_deprecationWarning("ZeroClipboard.prototype.removeEventListener", _globalConfig.debug);
return this.off(eventName, func);
};
ZeroClipboard.prototype.ready = function() {
_deprecationWarning("ZeroClipboard.prototype.ready", _globalConfig.debug);
return flashState.ready === true;
};
var _receiveEvent = function(eventName, args) {
eventName = eventName.toLowerCase().replace(/^on/, "");
var cleanVersion = args && args.flashVersion && _parseFlashVersion(args.flashVersion) || null;
var element = currentElement;
var performCallbackAsync = true;
switch (eventName) {
case "load":
if (cleanVersion) {
if (!_isFlashVersionSupported(cleanVersion)) {
_receiveEvent.call(this, "onWrongFlash", {
flashVersion: cleanVersion
});
return;
}
flashState.outdated = false;
flashState.ready = true;
flashState.version = cleanVersion;
}
break;
case "wrongflash":
if (cleanVersion && !_isFlashVersionSupported(cleanVersion)) {
flashState.outdated = true;
flashState.ready = false;
flashState.version = cleanVersion;
}
break;
case "mouseover":
_addClass(element, _globalConfig.hoverClass);
break;
case "mouseout":
if (_globalConfig.autoActivate === true) {
ZeroClipboard.deactivate();
}
break;
case "mousedown":
_addClass(element, _globalConfig.activeClass);
break;
case "mouseup":
_removeClass(element, _globalConfig.activeClass);
break;
case "datarequested":
if (element) {
var targetId = element.getAttribute("data-clipboard-target"), targetEl = !targetId ? null : document.getElementById(targetId);
if (targetEl) {
var textContent = targetEl.value || targetEl.textContent || targetEl.innerText;
if (textContent) {
this.setText(textContent);
}
} else {
var defaultText = element.getAttribute("data-clipboard-text");
if (defaultText) {
this.setText(defaultText);
}
}
}
performCallbackAsync = false;
break;
case "complete":
_deleteOwnProperties(_clipData);
if (element && element !== _safeActiveElement() && element.focus) {
element.focus();
}
break;
}
var context = element;
var eventArgs = [ this, args ];
return _dispatchClientCallbacks.call(this, eventName, context, eventArgs, performCallbackAsync);
};
if (typeof define === "function" && define.amd) {
define([ "require", "exports", "module" ], function(require, exports, module) {
_amdModuleId = module && module.id || null;
return ZeroClipboard;
});
} else if (typeof module === "object" && module && typeof module.exports === "object" && module.exports && typeof window.require === "function") {
_cjsModuleId = module.id || null;
module.exports = ZeroClipboard;
} else {
window.ZeroClipboard = ZeroClipboard;
}
})(function() {
return this;
}());
;
;
/*! pusher-2.2.4.min.js */ 
;
;
/*!
* Pusher JavaScript Library v2.2.4
* http://pusher.com/
*
* Copyright 2014, Pusher
* Released under the MIT licence.
*/
(function(){function b(a,d){(null===a||void 0===a)&&b.warn("Warning","You must pass your app key when you instantiate Pusher.");d=d||{};var c=this;this.key=a;this.config=b.Util.extend(b.getGlobalConfig(),d.cluster?b.getClusterConfig(d.cluster):{},d);this.channels=new b.Channels;this.global_emitter=new b.EventsDispatcher;this.sessionID=Math.floor(1E9*Math.random());this.timeline=new b.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:b.Util.getClientFeatures(),params:this.config.timelineParams||
{},limit:50,level:b.Timeline.INFO,version:b.VERSION});this.config.disableStats||(this.timelineSender=new b.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));this.connection=new b.ConnectionManager(this.key,b.Util.extend({getStrategy:function(a){a=b.Util.extend({},c.config,a);return b.StrategyBuilder.build(b.getDefaultStrategy(a),a)},timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},
this.config,{encrypted:this.isEncrypted()}));this.connection.bind("connected",function(){c.subscribeAll();c.timelineSender&&c.timelineSender.send(c.connection.isEncrypted())});this.connection.bind("message",function(a){var d=0===a.event.indexOf("pusher_internal:");if(a.channel){var b=c.channel(a.channel);b&&b.handleEvent(a.event,a.data)}d||c.global_emitter.emit(a.event,a.data)});this.connection.bind("disconnected",function(){c.channels.disconnect()});this.connection.bind("error",function(a){b.warn("Error",
a)});b.instances.push(this);this.timeline.info({instances:b.instances.length});b.isReady&&c.connect()}var c=b.prototype;b.instances=[];b.isReady=!1;b.debug=function(){b.log&&b.log(b.Util.stringify.apply(this,arguments))};b.warn=function(){var a=b.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(a):window.console.log&&window.console.log(a));b.log&&b.log(a)};b.ready=function(){b.isReady=!0;for(var a=0,d=b.instances.length;a<d;a++)b.instances[a].connect()};
c.channel=function(a){return this.channels.find(a)};c.allChannels=function(){return this.channels.all()};c.connect=function(){this.connection.connect();if(this.timelineSender&&!this.timelineSenderTimer){var a=this.connection.isEncrypted(),d=this.timelineSender;this.timelineSenderTimer=new b.PeriodicTimer(6E4,function(){d.send(a)})}};c.disconnect=function(){this.connection.disconnect();this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)};c.bind=function(a,
d){this.global_emitter.bind(a,d);return this};c.bind_all=function(a){this.global_emitter.bind_all(a);return this};c.subscribeAll=function(){for(var a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)};c.subscribe=function(a){a=this.channels.add(a,this);"connected"===this.connection.state&&a.subscribe();return a};c.unsubscribe=function(a){a=this.channels.remove(a);"connected"===this.connection.state&&a.unsubscribe()};c.send_event=function(a,d,b){return this.connection.send_event(a,
d,b)};c.isEncrypted=function(){return"https:"===b.Util.getDocument().location.protocol?!0:Boolean(this.config.encrypted)};b.HTTP={};this.Pusher=b}).call(this);
(function(){function b(a){window.clearTimeout(a)}function c(a){window.clearInterval(a)}function a(a,d,b,c){var k=this;this.clear=d;this.timer=a(function(){null!==k.timer&&(k.timer=c(k.timer))},b)}var d=a.prototype;d.isRunning=function(){return null!==this.timer};d.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)};Pusher.Timer=function(d,c){return new a(setTimeout,b,d,function(a){c();return null})};Pusher.PeriodicTimer=function(d,b){return new a(setInterval,c,d,function(a){b();
return a})}}).call(this);
(function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(b){return new Pusher.Timer(0,b)},extend:function(b){for(var c=1;c<arguments.length;c++){var a=arguments[c],d;for(d in a)b[d]=a[d]&&a[d].constructor&&a[d].constructor===Object?Pusher.Util.extend(b[d]||{},a[d]):a[d]}return b},stringify:function(){for(var b=["Pusher"],c=0;c<arguments.length;c++)"string"===typeof arguments[c]?b.push(arguments[c]):void 0===window.JSON?b.push(arguments[c].toString()):b.push(JSON.stringify(arguments[c]));
return b.join(" : ")},arrayIndexOf:function(b,c){var a=Array.prototype.indexOf;if(null===b)return-1;if(a&&b.indexOf===a)return b.indexOf(c);for(var a=0,d=b.length;a<d;a++)if(b[a]===c)return a;return-1},objectApply:function(b,c){for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&c(b[a],a,b)},keys:function(b){var c=[];Pusher.Util.objectApply(b,function(a,d){c.push(d)});return c},values:function(b){var c=[];Pusher.Util.objectApply(b,function(a){c.push(a)});return c},apply:function(b,c,a){for(var d=
0;d<b.length;d++)c.call(a||window,b[d],d,b)},map:function(b,c){for(var a=[],d=0;d<b.length;d++)a.push(c(b[d],d,b,a));return a},mapObject:function(b,c){var a={};Pusher.Util.objectApply(b,function(d,b){a[b]=c(d)});return a},filter:function(b,c){c=c||function(a){return!!a};for(var a=[],d=0;d<b.length;d++)c(b[d],d,b,a)&&a.push(b[d]);return a},filterObject:function(b,c){var a={};Pusher.Util.objectApply(b,function(d,h){if(c&&c(d,h,b,a)||Boolean(d))a[h]=d});return a},flatten:function(b){var c=[];Pusher.Util.objectApply(b,
function(a,d){c.push([d,a])});return c},any:function(b,c){for(var a=0;a<b.length;a++)if(c(b[a],a,b))return!0;return!1},all:function(b,c){for(var a=0;a<b.length;a++)if(!c(b[a],a,b))return!1;return!0},method:function(b){var c=Array.prototype.slice.call(arguments,1);return function(a){return a[b].apply(a,c.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator},getLocalStorage:function(){try{return window.localStorage}catch(b){}},
getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(b){return b.isSupported({})}))},addWindowListener:function(b,c){var a=Pusher.Util.getWindow();void 0!==a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeWindowListener:function(b,c){var a=Pusher.Util.getWindow();void 0!==a.addEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},isXHRSupported:function(){var b=window.XMLHttpRequest;
return Boolean(b)&&void 0!==(new b).withCredentials},isXDRSupported:function(b){b=b?"https:":"http:";var c=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&c===b}}}).call(this);
(function(){Pusher.VERSION="2.2.4";Pusher.PROTOCOL=7;Pusher.host="ws.pusherapp.com";Pusher.ws_port=80;Pusher.wss_port=443;Pusher.sockjs_host="sockjs.pusher.com";Pusher.sockjs_http_port=80;Pusher.sockjs_https_port=443;Pusher.sockjs_path="/pusher";Pusher.stats_host="stats.pusher.com";Pusher.channel_auth_endpoint="/pusher/auth";Pusher.channel_auth_transport="ajax";Pusher.activity_timeout=12E4;Pusher.pong_timeout=3E4;Pusher.unavailable_timeout=1E4;Pusher.cdn_http="http://js.pusher.com/";Pusher.cdn_https=
"https://js.pusher.com/";Pusher.dependency_suffix=".min";Pusher.getDefaultStrategy=function(b){return[[":def","ws_options",{hostUnencrypted:b.wsHost+":"+b.wsPort,hostEncrypted:b.wsHost+":"+b.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:b.httpHost+":"+b.httpPort,hostEncrypted:b.httpHost+":"+b.httpsPort,httpPath:b.httpPath}],[":def","timeouts",{loop:!0,timeout:15E3,timeoutLimit:6E4}],[":def","ws_manager",[":transport_manager",{lives:2,
minPingDelay:1E4,maxPingDelay:b.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1E4,maxPingDelay:b.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport",
"xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",
":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4E3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18E5,[":first_connected",[":if",
[":is_supported",":ws"],b.encrypted?[":best_connected_ever",":ws_loop",[":delayed",2E3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2E3,[":wss_loop"]],[":delayed",5E3,[":http_fallback_loop"]]],[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2E3,[":http_fallback_loop"]]],[":http_fallback_loop"]]]]]]]}}).call(this);
(function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}};Pusher.getClusterConfig=
function(b){return{wsHost:"ws-"+b+".pusher.com",httpHost:"sockjs-"+b+".pusher.com"}}}).call(this);(function(){function b(b){var a=function(a){Error.call(this,a);this.name=b};Pusher.Util.extend(a.prototype,Error.prototype);return a}Pusher.Errors={BadEventName:b("BadEventName"),RequestTimedOut:b("RequestTimedOut"),TransportPriorityTooLow:b("TransportPriorityTooLow"),TransportClosed:b("TransportClosed"),UnsupportedTransport:b("UnsupportedTransport"),UnsupportedStrategy:b("UnsupportedStrategy")}}).call(this);
(function(){function b(a){this.callbacks=new c;this.global_callbacks=[];this.failThrough=a}function c(){this._callbacks={}}var a=b.prototype;a.bind=function(a,b,c){this.callbacks.add(a,b,c);return this};a.bind_all=function(a){this.global_callbacks.push(a);return this};a.unbind=function(a,b,c){this.callbacks.remove(a,b,c);return this};a.unbind_all=function(a,b){this.callbacks.remove(a,b);return this};a.emit=function(a,b){var c;for(c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);
var e=this.callbacks.get(a);if(e&&0<e.length)for(c=0;c<e.length;c++)e[c].fn.call(e[c].context||window,b);else this.failThrough&&this.failThrough(a,b);return this};c.prototype.get=function(a){return this._callbacks["_"+a]};c.prototype.add=function(a,b,c){a="_"+a;this._callbacks[a]=this._callbacks[a]||[];this._callbacks[a].push({fn:b,context:c})};c.prototype.remove=function(a,b,c){!a&&!b&&!c?this._callbacks={}:(a=a?["_"+a]:Pusher.Util.keys(this._callbacks),b||c?Pusher.Util.apply(a,function(a){this._callbacks[a]=
Pusher.Util.filter(this._callbacks[a]||[],function(a){return b&&b!==a.fn||c&&c!==a.context});0===this._callbacks[a].length&&delete this._callbacks[a]},this):Pusher.Util.apply(a,function(a){delete this._callbacks[a]},this))};Pusher.EventsDispatcher=b}).call(this);
(function(){function b(a,d){this.lastId=0;this.prefix=a;this.name=d}var c=b.prototype;c.create=function(a){this.lastId++;var d=this.lastId,b=this.prefix+d,c=this.name+"["+d+"]",e=!1,f=function(){e||(a.apply(null,arguments),e=!0)};this[d]=f;return{number:d,id:b,name:c,callback:f}};c.remove=function(a){delete this[a.number]};Pusher.ScriptReceiverFactory=b;Pusher.ScriptReceivers=new b("_pusher_script_","Pusher.ScriptReceivers")}).call(this);
(function(){function b(a){this.src=a}var c=b.prototype;c.send=function(a){var d=this,b="Error loading "+d.src;d.script=document.createElement("script");d.script.id=a.id;d.script.src=d.src;d.script.type="text/javascript";d.script.charset="UTF-8";d.script.addEventListener?(d.script.onerror=function(){a.callback(b)},d.script.onload=function(){a.callback(null)}):d.script.onreadystatechange=function(){("loaded"===d.script.readyState||"complete"===d.script.readyState)&&a.callback(null)};void 0===d.script.async&&
document.attachEvent&&/opera/i.test(navigator.userAgent)?(d.errorScript=document.createElement("script"),d.errorScript.id=a.id+"_error",d.errorScript.text=a.name+"('"+b+"');",d.script.async=d.errorScript.async=!1):d.script.async=!0;var c=document.getElementsByTagName("head")[0];c.insertBefore(d.script,c.firstChild);d.errorScript&&c.insertBefore(d.errorScript,d.script.nextSibling)};c.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null);this.script&&
this.script.parentNode&&this.script.parentNode.removeChild(this.script);this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript);this.errorScript=this.script=null};Pusher.ScriptRequest=b}).call(this);
(function(){function b(a){this.options=a;this.receivers=a.receivers||Pusher.ScriptReceivers;this.loading={}}var c=b.prototype;c.load=function(a,d,b){var c=this;if(c.loading[a]&&0<c.loading[a].length)c.loading[a].push(b);else{c.loading[a]=[b];var e=new Pusher.ScriptRequest(c.getPath(a,d)),f=c.receivers.create(function(d){c.receivers.remove(f);if(c.loading[a]){var b=c.loading[a];delete c.loading[a];for(var h=function(a){a||e.cleanup()},m=0;m<b.length;m++)b[m](d,h)}});e.send(f)}};c.getRoot=function(a){var d=
Pusher.Util.getDocument().location.protocol;return(a&&a.encrypted||"https:"===d?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version};c.getPath=function(a,d){return this.getRoot(d)+"/"+a+this.options.suffix+".js"};Pusher.DependencyLoader=b}).call(this);
(function(){function b(){Pusher.ready()}function c(a){document.body?a():setTimeout(function(){c(a)},0)}function a(){c(b)}Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers");Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers});window.JSON?a():Pusher.Dependencies.load("json2",{},a)})();
(function(){for(var b=String.fromCharCode,c=0;64>c;c++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c);var a=function(a){var d=a.charCodeAt(0);return 128>d?a:2048>d?b(192|d>>>6)+b(128|d&63):b(224|d>>>12&15)+b(128|d>>>6&63)+b(128|d&63)},d=function(a){var d=[0,2,1][a.length%3];a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>
12&63),2<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6&63),1<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},h=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,d)};Pusher.Base64={encode:function(d){return h(d.replace(/[^\x00-\x7F]/g,a))}}}).call(this);
(function(){function b(a,b){this.url=a;this.data=b}function c(a){return Pusher.Util.mapObject(a,function(a){"object"===typeof a&&(a=JSON.stringify(a));return encodeURIComponent(Pusher.Base64.encode(a.toString()))})}var a=b.prototype;a.send=function(a){if(!this.request){var b=Pusher.Util.filterObject(this.data,function(a){return void 0!==a}),b=Pusher.Util.map(Pusher.Util.flatten(c(b)),Pusher.Util.method("join","=")).join("&");this.request=new Pusher.ScriptRequest(this.url+"/"+a.number+"?"+b);this.request.send(a)}};
a.cleanup=function(){this.request&&this.request.cleanup()};Pusher.JSONPRequest=b}).call(this);
(function(){function b(a,d,b){this.key=a;this.session=d;this.events=[];this.options=b||{};this.uniqueID=this.sent=0}var c=b.prototype;b.ERROR=3;b.INFO=6;b.DEBUG=7;c.log=function(a,d){a<=this.options.level&&(this.events.push(Pusher.Util.extend({},d,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())};c.error=function(a){this.log(b.ERROR,a)};c.info=function(a){this.log(b.INFO,a)};c.debug=function(a){this.log(b.DEBUG,a)};c.isEmpty=function(){return 0===
this.events.length};c.send=function(a,d){var b=this,c=Pusher.Util.extend({session:b.session,bundle:b.sent+1,key:b.key,lib:"js",version:b.options.version,cluster:b.options.cluster,features:b.options.features,timeline:b.events},b.options.params);b.events=[];a(c,function(a,c){a||b.sent++;d&&d(a,c)});return!0};c.generateUniqueID=function(){this.uniqueID++;return this.uniqueID};Pusher.Timeline=b}).call(this);
(function(){function b(b,a){this.timeline=b;this.options=a||{}}b.prototype.send=function(b,a){var d=this;d.timeline.isEmpty()||d.timeline.send(function(a,g){var e=new Pusher.JSONPRequest("http"+(b?"s":"")+"://"+(d.host||d.options.host)+d.options.path,a),f=Pusher.ScriptReceivers.create(function(a,b){Pusher.ScriptReceivers.remove(f);e.cleanup();b&&b.host&&(d.host=b.host);g&&g(a,b)});e.send(f)},a)};Pusher.TimelineSender=b}).call(this);
(function(){function b(a){this.strategies=a}function c(a,b,c){var h=Pusher.Util.map(a,function(a,d,h,g){return a.connect(b,c(d,g))});return{abort:function(){Pusher.Util.apply(h,d)},forceMinPriority:function(a){Pusher.Util.apply(h,function(b){b.forceMinPriority(a)})}}}function a(a){return Pusher.Util.all(a,function(a){return Boolean(a.error)})}function d(a){!a.error&&!a.aborted&&(a.abort(),a.aborted=!0)}var h=b.prototype;h.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};
h.connect=function(b,d){return c(this.strategies,b,function(b,c){return function(h,g){(c[b].error=h)?a(c)&&d(!0):(Pusher.Util.apply(c,function(a){a.forceMinPriority(g.transport.priority)}),d(null,g))}})};Pusher.BestConnectedEverStrategy=b}).call(this);
(function(){function b(a,b,d){this.strategy=a;this.transports=b;this.ttl=d.ttl||18E5;this.encrypted=d.encrypted;this.timeline=d.timeline}function c(a){return"pusherTransport"+(a?"Encrypted":"Unencrypted")}function a(a){var b=Pusher.Util.getLocalStorage();if(b)try{var h=b[c(a)];if(h)return JSON.parse(h)}catch(k){d(a)}return null}function d(a){var b=Pusher.Util.getLocalStorage();if(b)try{delete b[c(a)]}catch(d){}}var h=b.prototype;h.isSupported=function(){return this.strategy.isSupported()};h.connect=
function(b,h){var f=this.encrypted,k=a(f),l=[this.strategy];if(k&&k.timestamp+this.ttl>=Pusher.Util.now()){var n=this.transports[k.transport];n&&(this.timeline.info({cached:!0,transport:k.transport,latency:k.latency}),l.push(new Pusher.SequentialStrategy([n],{timeout:2*k.latency+1E3,failFast:!0})))}var m=Pusher.Util.now(),p=l.pop().connect(b,function s(a,k){if(a)d(f),0<l.length?(m=Pusher.Util.now(),p=l.pop().connect(b,s)):h(a);else{var n=k.transport.name,t=Pusher.Util.now()-m,r=Pusher.Util.getLocalStorage();
if(r)try{r[c(f)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:n,latency:t})}catch(u){}h(null,k)}});return{abort:function(){p.abort()},forceMinPriority:function(a){b=a;p&&p.forceMinPriority(a)}}};Pusher.CachedStrategy=b}).call(this);
(function(){function b(a,b){this.strategy=a;this.options={delay:b.delay}}var c=b.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy,g,e=new Pusher.Timer(this.options.delay,function(){g=c.connect(a,b)});return{abort:function(){e.ensureAborted();g&&g.abort()},forceMinPriority:function(b){a=b;g&&g.forceMinPriority(b)}}};Pusher.DelayedStrategy=b}).call(this);
(function(){function b(a){this.strategy=a}var c=b.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy.connect(a,function(a,e){e&&c.abort();b(a,e)});return c};Pusher.FirstConnectedStrategy=b}).call(this);
(function(){function b(a,b,c){this.test=a;this.trueBranch=b;this.falseBranch=c}var c=b.prototype;c.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()};c.connect=function(a,b){return(this.test()?this.trueBranch:this.falseBranch).connect(a,b)};Pusher.IfStrategy=b}).call(this);
(function(){function b(a,b){this.strategies=a;this.loop=Boolean(b.loop);this.failFast=Boolean(b.failFast);this.timeout=b.timeout;this.timeoutLimit=b.timeoutLimit}var c=b.prototype;c.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};c.connect=function(a,b){var c=this,g=this.strategies,e=0,f=this.timeout,k=null,l=function(n,m){m?b(null,m):(e+=1,c.loop&&(e%=g.length),e<g.length?(f&&(f*=2,c.timeoutLimit&&(f=Math.min(f,c.timeoutLimit))),k=c.tryStrategy(g[e],
a,{timeout:f,failFast:c.failFast},l)):b(!0))},k=this.tryStrategy(g[e],a,{timeout:f,failFast:this.failFast},l);return{abort:function(){k.abort()},forceMinPriority:function(b){a=b;k&&k.forceMinPriority(b)}}};c.tryStrategy=function(a,b,c,g){var e=null,f=null;0<c.timeout&&(e=new Pusher.Timer(c.timeout,function(){f.abort();g(!0)}));f=a.connect(b,function(a,b){if(!a||!e||!e.isRunning()||c.failFast)e&&e.ensureAborted(),g(a,b)});return{abort:function(){e&&e.ensureAborted();f.abort()},forceMinPriority:function(a){f.forceMinPriority(a)}}};
Pusher.SequentialStrategy=b}).call(this);
(function(){function b(a,b,c,e){this.name=a;this.priority=b;this.transport=c;this.options=e||{}}function c(a,b){Pusher.Util.defer(function(){b(a)});return{abort:function(){},forceMinPriority:function(){}}}var a=b.prototype;a.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})};a.connect=function(a,b){if(this.isSupported()){if(this.priority<a)return c(new Pusher.Errors.TransportPriorityTooLow,b)}else return c(new Pusher.Errors.UnsupportedStrategy,b);var g=this,
e=!1,f=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),k=null,l=function(){f.unbind("initialized",l);f.connect()},n=function(){k=new Pusher.Handshake(f,function(a){e=!0;q();b(null,a)})},m=function(a){q();b(a)},p=function(){q();b(new Pusher.Errors.TransportClosed(f))},q=function(){f.unbind("initialized",l);f.unbind("open",n);f.unbind("error",m);f.unbind("closed",p)};f.bind("initialized",l);f.bind("open",n);f.bind("error",m);f.bind("closed",p);f.initialize();return{abort:function(){e||
(q(),k?k.close():f.close())},forceMinPriority:function(a){e||g.priority<a&&(k?k.close():f.close())}}};Pusher.TransportStrategy=b}).call(this);
(function(){function b(a,b,c){return a+(b.encrypted?"s":"")+"://"+(b.encrypted?b.hostEncrypted:b.hostUnencrypted)+c}function c(a,b){return"/app/"+a+("?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION+(b?"&"+b:""))}Pusher.URLSchemes={ws:{getInitial:function(a,d){return b("ws",d,c(a,"flash=false"))}},flash:{getInitial:function(a,d){return b("ws",d,c(a,"flash=true"))}},sockjs:{getInitial:function(a,c){return b("http",c,c.httpPath||"/pusher","")},getPath:function(a,b){return c(a)}},http:{getInitial:function(a,
d){var h=(d.httpPath||"/pusher")+c(a);return b("http",d,h)}}}}).call(this);
(function(){function b(a,b,c,g,e){Pusher.EventsDispatcher.call(this);this.hooks=a;this.name=b;this.priority=c;this.key=g;this.options=e;this.state="new";this.timeline=e.timeline;this.activityTimeout=e.activityTimeout;this.id=this.timeline.generateUniqueID()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)};c.supportsPing=function(){return Boolean(this.hooks.supportsPing)};c.initialize=function(){var a=
this;a.timeline.info(a.buildTimelineMessage({transport:a.name+(a.options.encrypted?"s":"")}));a.hooks.beforeInitialize&&a.hooks.beforeInitialize.call(a);if(a.hooks.isInitialized())a.changeState("initialized");else if(a.hooks.file)a.changeState("initializing"),Pusher.Dependencies.load(a.hooks.file,{encrypted:a.options.encrypted},function(b,c){if(a.hooks.isInitialized())a.changeState("initialized"),c(!0);else{if(b)a.onError(b);a.onClose();c(!1)}});else a.onClose()};c.connect=function(){var a=this;if(a.socket||
"initialized"!==a.state)return!1;var b=a.hooks.urls.getInitial(a.key,a.options);try{a.socket=a.hooks.getSocket(b,a.options)}catch(c){return Pusher.Util.defer(function(){a.onError(c);a.changeState("closed")}),!1}a.bindListeners();Pusher.debug("Connecting",{transport:a.name,url:b});a.changeState("connecting");return!0};c.close=function(){return this.socket?(this.socket.close(),!0):!1};c.send=function(a){var b=this;return"open"===b.state?(Pusher.Util.defer(function(){b.socket&&b.socket.send(a)}),!0):
!1};c.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()};c.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options));this.changeState("open");this.socket.onopen=void 0};c.onError=function(a){this.emit("error",{type:"WebSocketError",error:a});this.timeline.error(this.buildTimelineMessage({error:a.toString()}))};c.onClose=function(a){a?this.changeState("closed",{code:a.code,reason:a.reason,wasClean:a.wasClean}):
this.changeState("closed");this.unbindListeners();this.socket=void 0};c.onMessage=function(a){this.emit("message",a)};c.onActivity=function(){this.emit("activity")};c.bindListeners=function(){var a=this;a.socket.onopen=function(){a.onOpen()};a.socket.onerror=function(b){a.onError(b)};a.socket.onclose=function(b){a.onClose(b)};a.socket.onmessage=function(b){a.onMessage(b)};a.supportsPing()&&(a.socket.onactivity=function(){a.onActivity()})};c.unbindListeners=function(){this.socket&&(this.socket.onopen=
void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))};c.changeState=function(a,b){this.state=a;this.timeline.info(this.buildTimelineMessage({state:a,params:b}));this.emit(a,b)};c.buildTimelineMessage=function(a){return Pusher.Util.extend({cid:this.id},a)};Pusher.TransportConnection=b}).call(this);
(function(){function b(a){this.hooks=a}var c=b.prototype;c.isSupported=function(a){return this.hooks.isSupported(a)};c.createConnection=function(a,b,c,g){return new Pusher.TransportConnection(this.hooks,a,b,c,g)};Pusher.Transport=b}).call(this);
(function(){Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(a){return new (window.WebSocket||window.MozWebSocket)(a)}});Pusher.FlashTransport=new Pusher.Transport({file:"flashfallback",urls:Pusher.URLSchemes.flash,handlesActivityChecks:!1,supportsPing:!1,isSupported:function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(a){try{var b=
Pusher.Util.getNavigator();return Boolean(b&&b.mimeTypes&&void 0!==b.mimeTypes["application/x-shockwave-flash"])}catch(c){return!1}}},beforeInitialize:function(){void 0===window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0);window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot({encrypted:this.options.encrypted})+"/WebSocketMain.swf"},isInitialized:function(){return void 0!==window.FlashWebSocket},getSocket:function(a){return new FlashWebSocket(a)}});
Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(a,b){return new SockJS(a,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:b.encrypted}),ignore_null_origin:b.ignoreNullOrigin})},beforeOpen:function(a,b){a.send(JSON.stringify({path:b}))}});var b={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,
supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},c=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getStreamingSocket(a)}},b),b=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getPollingSocket(a)}},b),a={file:"xhr",isSupported:Pusher.Util.isXHRSupported},d={file:"xdr",isSupported:function(a){return Pusher.Util.isXDRSupported(a.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},c,a));Pusher.XDRStreamingTransport=
new Pusher.Transport(Pusher.Util.extend({},c,d));Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},b,a));Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},b,d))}).call(this);
(function(){function b(a,b,c){this.manager=a;this.transport=b;this.minPingDelay=c.minPingDelay;this.maxPingDelay=c.maxPingDelay;this.pingDelay=void 0}var c=b.prototype;c.createConnection=function(a,b,c,g){var e=this;g=Pusher.Util.extend({},g,{activityTimeout:e.pingDelay});var f=e.transport.createConnection(a,b,c,g),k=null,l=function(){f.unbind("open",l);f.bind("closed",n);k=Pusher.Util.now()},n=function(a){f.unbind("closed",n);1002===a.code||1003===a.code?e.manager.reportDeath():!a.wasClean&&k&&(a=
Pusher.Util.now()-k,a<2*e.maxPingDelay&&(e.manager.reportDeath(),e.pingDelay=Math.max(a/2,e.minPingDelay)))};f.bind("open",l);return f};c.isSupported=function(a){return this.manager.isAlive()&&this.transport.isSupported(a)};Pusher.AssistantToTheTransportManager=b}).call(this);
(function(){function b(a){this.options=a||{};this.livesLeft=this.options.lives||Infinity}var c=b.prototype;c.getAssistant=function(a){return new Pusher.AssistantToTheTransportManager(this,a,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})};c.isAlive=function(){return 0<this.livesLeft};c.reportDeath=function(){this.livesLeft-=1};Pusher.TransportManager=b}).call(this);
(function(){function b(a){return function(b){return[a.apply(this,arguments),b]}}function c(a,b){if(0===a.length)return[[],b];var h=d(a[0],b),e=c(a.slice(1),h[1]);return[[h[0]].concat(e[0]),e[1]]}function a(a,b){if("string"===typeof a[0]&&":"===a[0].charAt(0)){var h=b[a[0].slice(1)];if(1<a.length){if("function"!==typeof h)throw"Calling non-function "+a[0];var e=[Pusher.Util.extend({},b)].concat(Pusher.Util.map(a.slice(1),function(a){return d(a,Pusher.Util.extend({},b))[0]}));return h.apply(this,e)}return[h,
b]}return c(a,b)}function d(b,c){if("string"===typeof b){var d;if("string"===typeof b&&":"===b.charAt(0)){d=c[b.slice(1)];if(void 0===d)throw"Undefined symbol "+b;d=[d,c]}else d=[b,c];return d}return"object"===typeof b&&b instanceof Array&&0<b.length?a(b,c):[b,c]}var h={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},
g={isSupported:function(){return!1},connect:function(a,b){var c=Pusher.Util.defer(function(){b(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){c.ensureAborted()},forceMinPriority:function(){}}}},e={extend:function(a,b,c){return[Pusher.Util.extend({},b,c),a]},def:function(a,b,c){if(void 0!==a[b])throw"Redefining symbol "+b;a[b]=c;return[void 0,a]},def_transport:function(a,b,c,d,e,p){var q=h[c];if(!q)throw new Pusher.Errors.UnsupportedTransport(c);c=(!a.enabledTransports||-1!==Pusher.Util.arrayIndexOf(a.enabledTransports,
b))&&(!a.disabledTransports||-1===Pusher.Util.arrayIndexOf(a.disabledTransports,b))&&("flash"!==b||!0!==a.disableFlash)?new Pusher.TransportStrategy(b,d,p?p.getAssistant(q):q,Pusher.Util.extend({key:a.key,encrypted:a.encrypted,timeline:a.timeline,ignoreNullOrigin:a.ignoreNullOrigin},e)):g;d=a.def(a,b,c)[1];d.transports=a.transports||{};d.transports[b]=c;return[void 0,d]},transport_manager:b(function(a,b){return new Pusher.TransportManager(b)}),sequential:b(function(a,b){var c=Array.prototype.slice.call(arguments,
2);return new Pusher.SequentialStrategy(c,b)}),cached:b(function(a,b,c){return new Pusher.CachedStrategy(c,a.transports,{ttl:b,timeline:a.timeline,encrypted:a.encrypted})}),first_connected:b(function(a,b){return new Pusher.FirstConnectedStrategy(b)}),best_connected_ever:b(function(){var a=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(a)}),delayed:b(function(a,b,c){return new Pusher.DelayedStrategy(c,{delay:b})}),"if":b(function(a,b,c,d){return new Pusher.IfStrategy(b,
c,d)}),is_supported:b(function(a,b){return function(){return b.isSupported()}})};Pusher.StrategyBuilder={build:function(a,b){var c=Pusher.Util.extend({},e,b);return d(a,c)[1].strategy}}}).call(this);
(function(){Pusher.Protocol={decodeMessage:function(b){try{var c=JSON.parse(b.data);if("string"===typeof c.data)try{c.data=JSON.parse(c.data)}catch(a){if(!(a instanceof SyntaxError))throw a;}return c}catch(d){throw{type:"MessageParseError",error:d,data:b.data};}},encodeMessage:function(b){return JSON.stringify(b)},processHandshake:function(b){b=this.decodeMessage(b);if("pusher:connection_established"===b.event){if(!b.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",
id:b.data.socket_id,activityTimeout:1E3*b.data.activity_timeout}}if("pusher:error"===b.event)return{action:this.getCloseAction(b.data),error:this.getCloseError(b.data)};throw"Invalid handshake";},getCloseAction:function(b){return 4E3>b.code?1002<=b.code&&1004>=b.code?"backoff":null:4E3===b.code?"ssl_only":4100>b.code?"refused":4200>b.code?"backoff":4300>b.code?"retry":"refused"},getCloseError:function(b){return 1E3!==b.code&&1001!==b.code?{type:"PusherError",data:{code:b.code,message:b.reason||b.message}}:
null}}}).call(this);
(function(){function b(a,b){Pusher.EventsDispatcher.call(this);this.id=a;this.transport=b;this.activityTimeout=b.activityTimeout;this.bindListeners()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()};c.send=function(a){return this.transport.send(a)};c.send_event=function(a,b,c){a={event:a,data:b};c&&(a.channel=c);Pusher.debug("Event sent",a);return this.send(Pusher.Protocol.encodeMessage(a))};c.ping=
function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})};c.close=function(){this.transport.close()};c.bindListeners=function(){var a=this,b={message:function(b){var c;try{c=Pusher.Protocol.decodeMessage(b)}catch(d){a.emit("error",{type:"MessageParseError",error:d,data:b.data})}if(void 0!==c){Pusher.debug("Event recd",c);switch(c.event){case "pusher:error":a.emit("error",{type:"PusherError",data:c.data});break;case "pusher:ping":a.emit("ping");break;case "pusher:pong":a.emit("pong")}a.emit("message",
c)}},activity:function(){a.emit("activity")},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(b){c();b&&b.code&&a.handleCloseEvent(b);a.transport=null;a.emit("closed")}},c=function(){Pusher.Util.objectApply(b,function(b,c){a.transport.unbind(c,b)})};Pusher.Util.objectApply(b,function(b,c){a.transport.bind(c,b)})};c.handleCloseEvent=function(a){var b=Pusher.Protocol.getCloseAction(a);(a=Pusher.Protocol.getCloseError(a))&&this.emit("error",a);b&&this.emit(b)};Pusher.Connection=
b}).call(this);
(function(){function b(a,b){this.transport=a;this.callback=b;this.bindListeners()}var c=b.prototype;c.close=function(){this.unbindListeners();this.transport.close()};c.bindListeners=function(){var a=this;a.onMessage=function(b){a.unbindListeners();try{var c=Pusher.Protocol.processHandshake(b);"connected"===c.action?a.finish("connected",{connection:new Pusher.Connection(c.id,a.transport),activityTimeout:c.activityTimeout}):(a.finish(c.action,{error:c.error}),a.transport.close())}catch(g){a.finish("error",{error:g}),
a.transport.close()}};a.onClosed=function(b){a.unbindListeners();var c=Pusher.Protocol.getCloseAction(b)||"backoff";b=Pusher.Protocol.getCloseError(b);a.finish(c,{error:b})};a.transport.bind("message",a.onMessage);a.transport.bind("closed",a.onClosed)};c.unbindListeners=function(){this.transport.unbind("message",this.onMessage);this.transport.unbind("closed",this.onClosed)};c.finish=function(a,b){this.callback(Pusher.Util.extend({transport:this.transport,action:a},b))};Pusher.Handshake=b}).call(this);
(function(){function b(a,b){Pusher.EventsDispatcher.call(this);this.key=a;this.options=b||{};this.state="initialized";this.connection=null;this.encrypted=!!b.encrypted;this.timeline=this.options.timeline;this.connectionCallbacks=this.buildConnectionCallbacks();this.errorCallbacks=this.buildErrorCallbacks();this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var c=this;Pusher.Network.bind("online",function(){c.timeline.info({netinfo:"online"});("connecting"===c.state||"unavailable"===
c.state)&&c.retryIn(0)});Pusher.Network.bind("offline",function(){c.timeline.info({netinfo:"offline"});c.connection&&c.sendActivityCheck()});this.updateStrategy()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.connect=function(){!this.connection&&!this.runner&&(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))};c.send=function(a){return this.connection?this.connection.send(a):!1};
c.send_event=function(a,b,c){return this.connection?this.connection.send_event(a,b,c):!1};c.disconnect=function(){this.disconnectInternally();this.updateState("disconnected")};c.isEncrypted=function(){return this.encrypted};c.startConnecting=function(){var a=this,b=function(c,g){c?a.runner=a.strategy.connect(0,b):"error"===g.action?(a.emit("error",{type:"HandshakeError",error:g.error}),a.timeline.error({handshakeError:g.error})):(a.abortConnecting(),a.handshakeCallbacks[g.action](g))};a.runner=a.strategy.connect(0,
b)};c.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)};c.disconnectInternally=function(){this.abortConnecting();this.clearRetryTimer();this.clearUnavailableTimer();this.connection&&this.abandonConnection().close()};c.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})};c.retryIn=function(a){var b=this;b.timeline.info({action:"retry",delay:a});0<a&&b.emit("connecting_in",Math.round(a/1E3));b.retryTimer=
new Pusher.Timer(a||0,function(){b.disconnectInternally();b.connect()})};c.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)};c.setUnavailableTimer=function(){var a=this;a.unavailableTimer=new Pusher.Timer(a.options.unavailableTimeout,function(){a.updateState("unavailable")})};c.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()};c.sendActivityCheck=function(){var a=this;a.stopActivityCheck();a.connection.ping();
a.activityTimer=new Pusher.Timer(a.options.pongTimeout,function(){a.timeline.error({pong_timed_out:a.options.pongTimeout});a.retryIn(0)})};c.resetActivityCheck=function(){var a=this;a.stopActivityCheck();a.connection.handlesActivityChecks()||(a.activityTimer=new Pusher.Timer(a.activityTimeout,function(){a.sendActivityCheck()}))};c.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()};c.buildConnectionCallbacks=function(){var a=this;return{message:function(b){a.resetActivityCheck();
a.emit("message",b)},ping:function(){a.send_event("pusher:pong",{})},activity:function(){a.resetActivityCheck()},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(){a.abandonConnection();a.shouldRetry()&&a.retryIn(1E3)}}};c.buildHandshakeCallbacks=function(a){var b=this;return Pusher.Util.extend({},a,{connected:function(a){b.activityTimeout=Math.min(b.options.activityTimeout,a.activityTimeout,a.connection.activityTimeout||Infinity);b.clearUnavailableTimer();b.setConnection(a.connection);
b.socket_id=b.connection.id;b.updateState("connected",{socket_id:b.socket_id})}})};c.buildErrorCallbacks=function(){function a(a){return function(c){c.error&&b.emit("error",{type:"WebSocketError",error:c.error});a(c)}}var b=this;return{ssl_only:a(function(){b.encrypted=!0;b.updateStrategy();b.retryIn(0)}),refused:a(function(){b.disconnect()}),backoff:a(function(){b.retryIn(1E3)}),retry:a(function(){b.retryIn(0)})}};c.setConnection=function(a){this.connection=a;for(var b in this.connectionCallbacks)this.connection.bind(b,
this.connectionCallbacks[b]);this.resetActivityCheck()};c.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var a in this.connectionCallbacks)this.connection.unbind(a,this.connectionCallbacks[a]);a=this.connection;this.connection=null;return a}};c.updateState=function(a,b){var c=this.state;this.state=a;c!==a&&(Pusher.debug("State changed",c+" -> "+a),this.timeline.info({state:a,params:b}),this.emit("state_change",{previous:c,current:a}),this.emit(a,b))};c.shouldRetry=function(){return"connecting"===
this.state||"connected"===this.state};Pusher.ConnectionManager=b}).call(this);
(function(){function b(){Pusher.EventsDispatcher.call(this);var b=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){b.emit("online")},!1),window.addEventListener("offline",function(){b.emit("offline")},!1))}Pusher.Util.extend(b.prototype,Pusher.EventsDispatcher.prototype);b.prototype.isOnline=function(){return void 0===window.navigator.onLine?!0:window.navigator.onLine};Pusher.NetInfo=b;Pusher.Network=new b}).call(this);
(function(){function b(){this.reset()}var c=b.prototype;c.get=function(a){return Object.prototype.hasOwnProperty.call(this.members,a)?{id:a,info:this.members[a]}:null};c.each=function(a){var b=this;Pusher.Util.objectApply(b.members,function(c,g){a(b.get(g))})};c.setMyID=function(a){this.myID=a};c.onSubscription=function(a){this.members=a.presence.hash;this.count=a.presence.count;this.me=this.get(this.myID)};c.addMember=function(a){null===this.get(a.user_id)&&this.count++;this.members[a.user_id]=a.user_info;
return this.get(a.user_id)};c.removeMember=function(a){var b=this.get(a.user_id);b&&(delete this.members[a.user_id],this.count--);return b};c.reset=function(){this.members={};this.count=0;this.me=this.myID=null};Pusher.Members=b}).call(this);
(function(){function b(a,b){Pusher.EventsDispatcher.call(this,function(b,c){Pusher.debug("No callbacks on "+a+" for "+b)});this.name=a;this.pusher=b;this.subscribed=!1}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.authorize=function(a,b){return b(!1,{})};c.trigger=function(a,b){if(0!==a.indexOf("client-"))throw new Pusher.Errors.BadEventName("Event '"+a+"' does not start with 'client-'");return this.pusher.send_event(a,b,this.name)};c.disconnect=function(){this.subscribed=
!1};c.handleEvent=function(a,b){0===a.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===a&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",b)):this.emit(a,b)};c.subscribe=function(){var a=this;a.authorize(a.pusher.connection.socket_id,function(b,c){b?a.handleEvent("pusher:subscription_error",c):a.pusher.send_event("pusher:subscribe",{auth:c.auth,channel_data:c.channel_data,channel:a.name})})};c.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})};
Pusher.Channel=b}).call(this);(function(){function b(a,b){Pusher.Channel.call(this,a,b)}var c=b.prototype;Pusher.Util.extend(c,Pusher.Channel.prototype);c.authorize=function(a,b){return(new Pusher.Channel.Authorizer(this,this.pusher.config)).authorize(a,b)};Pusher.PrivateChannel=b}).call(this);
(function(){function b(a,b){Pusher.PrivateChannel.call(this,a,b);this.members=new Pusher.Members}var c=b.prototype;Pusher.Util.extend(c,Pusher.PrivateChannel.prototype);c.authorize=function(a,b){var c=this;Pusher.PrivateChannel.prototype.authorize.call(c,a,function(a,e){if(!a){if(void 0===e.channel_data){Pusher.warn("Invalid auth response for channel '"+c.name+"', expected 'channel_data' field");b("Invalid auth response");return}var f=JSON.parse(e.channel_data);c.members.setMyID(f.user_id)}b(a,e)})};
c.handleEvent=function(a,b){switch(a){case "pusher_internal:subscription_succeeded":this.members.onSubscription(b);this.subscribed=!0;this.emit("pusher:subscription_succeeded",this.members);break;case "pusher_internal:member_added":var c=this.members.addMember(b);this.emit("pusher:member_added",c);break;case "pusher_internal:member_removed":(c=this.members.removeMember(b))&&this.emit("pusher:member_removed",c);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,a,b)}};c.disconnect=
function(){this.members.reset();Pusher.PrivateChannel.prototype.disconnect.call(this)};Pusher.PresenceChannel=b}).call(this);
(function(){function b(){this.channels={}}var c=b.prototype;c.add=function(a,b){if(!this.channels[a]){var c=this.channels,g;g=0===a.indexOf("private-")?new Pusher.PrivateChannel(a,b):0===a.indexOf("presence-")?new Pusher.PresenceChannel(a,b):new Pusher.Channel(a,b);c[a]=g}return this.channels[a]};c.all=function(a){return Pusher.Util.values(this.channels)};c.find=function(a){return this.channels[a]};c.remove=function(a){var b=this.channels[a];delete this.channels[a];return b};c.disconnect=function(){Pusher.Util.objectApply(this.channels,
function(a){a.disconnect()})};Pusher.Channels=b}).call(this);
(function(){Pusher.Channel.Authorizer=function(b,a){this.channel=b;this.type=a.authTransport;this.options=a;this.authOptions=(a||{}).auth||{}};Pusher.Channel.Authorizer.prototype={composeQuery:function(b){b="socket_id="+encodeURIComponent(b)+"&channel_name="+encodeURIComponent(this.channel.name);for(var a in this.authOptions.params)b+="&"+encodeURIComponent(a)+"="+encodeURIComponent(this.authOptions.params[a]);return b},authorize:function(b,a){return Pusher.authorizers[this.type].call(this,b,a)}};
var b=1;Pusher.auth_callbacks={};Pusher.authorizers={ajax:function(b,a){var d;d=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",this.options.authEndpoint,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var h in this.authOptions.headers)d.setRequestHeader(h,this.authOptions.headers[h]);d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var b,c=!1;try{b=JSON.parse(d.responseText),
c=!0}catch(f){a(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+d.responseText)}c&&a(!1,b)}else Pusher.warn("Couldn't get auth info from your webapp",d.status),a(!0,d.status)};d.send(this.composeQuery(b));return d},jsonp:function(c,a){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var d=b.toString();b++;var h=Pusher.Util.getDocument(),g=h.createElement("script");Pusher.auth_callbacks[d]=
function(b){a(!1,b)};g.src=this.options.authEndpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+d+"']")+"&"+this.composeQuery(c);d=h.getElementsByTagName("head")[0]||h.documentElement;d.insertBefore(g,d.firstChild)}}}).call(this);
;
;
/*! packery.js */ 
;
;
/*!
* Packery PACKAGED v1.4.1
* bin-packing layout library
*
* Licensed GPLv3 for open source use
* or Flickity Commercial License for commercial use
*
* http://packery.metafizzy.co
* Copyright 2015 Metafizzy
*/
(function(t){function e(){}function i(t){function i(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}function o(e,i){t.fn[e]=function(o){if("string"==typeof o){for(var s=n.call(arguments,1),a=0,h=this.length;h>a;a++){var p=this[a],u=t.data(p,e);if(u)if(t.isFunction(u[o])&&"_"!==o.charAt(0)){var c=u[o].apply(u,s);if(void 0!==c)return c}else r("no such method '"+o+"' for "+e+" instance");else r("cannot call methods on "+e+" prior to initialization; "+"attempted to call '"+o+"'")}return this}return this.each(function(){var n=t.data(this,e);n?(n.option(o),n._init()):(n=new i(this,o),t.data(this,e,n))})}}if(t){var r="undefined"==typeof console?e:function(t){console.error(t)};return t.bridget=function(t,e){i(e),o(t,e)},t.bridget}}var n=Array.prototype.slice;"function"==typeof define&&define.amd?define("jquery-bridget/jquery.bridget",["jquery"],i):"object"==typeof exports?i(require("jquery")):i(t.jQuery)})(window),function(t){function e(t){return RegExp("(^|\\s+)"+t+"(\\s+|$)")}function i(t,e){var i=n(t,e)?r:o;i(t,e)}var n,o,r;"classList"in document.documentElement?(n=function(t,e){return t.classList.contains(e)},o=function(t,e){t.classList.add(e)},r=function(t,e){t.classList.remove(e)}):(n=function(t,i){return e(i).test(t.className)},o=function(t,e){n(t,e)||(t.className=t.className+" "+e)},r=function(t,i){t.className=t.className.replace(e(i)," ")});var s={hasClass:n,addClass:o,removeClass:r,toggleClass:i,has:n,add:o,remove:r,toggle:i};"function"==typeof define&&define.amd?define("classie/classie",s):"object"==typeof exports?module.exports=s:t.classie=s}(window),function(t){function e(t){if(t){if("string"==typeof n[t])return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e,o=0,r=i.length;r>o;o++)if(e=i[o]+t,"string"==typeof n[e])return e}}var i="Webkit Moz ms Ms O".split(" "),n=document.documentElement.style;"function"==typeof define&&define.amd?define("get-style-property/get-style-property",[],function(){return e}):"object"==typeof exports?module.exports=e:t.getStyleProperty=e}(window),function(t){function e(t){var e=parseFloat(t),i=-1===t.indexOf("%")&&!isNaN(e);return i&&e}function i(){}function n(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0,i=s.length;i>e;e++){var n=s[e];t[n]=0}return t}function o(i){function o(){if(!d){d=!0;var n=t.getComputedStyle;if(p=function(){var t=n?function(t){return n(t,null)}:function(t){return t.currentStyle};return function(e){var i=t(e);return i||r("Style returned "+i+". Are you running this code in a hidden iframe on Firefox? "+"See http://bit.ly/getsizebug1"),i}}(),u=i("boxSizing")){var o=document.createElement("div");o.style.width="200px",o.style.padding="1px 2px 3px 4px",o.style.borderStyle="solid",o.style.borderWidth="1px 2px 3px 4px",o.style[u]="border-box";var s=document.body||document.documentElement;s.appendChild(o);var a=p(o);c=200===e(a.width),s.removeChild(o)}}}function a(t){if(o(),"string"==typeof t&&(t=document.querySelector(t)),t&&"object"==typeof t&&t.nodeType){var i=p(t);if("none"===i.display)return n();var r={};r.width=t.offsetWidth,r.height=t.offsetHeight;for(var a=r.isBorderBox=!(!u||!i[u]||"border-box"!==i[u]),d=0,l=s.length;l>d;d++){var f=s[d],y=i[f];y=h(t,y);var m=parseFloat(y);r[f]=isNaN(m)?0:m}var g=r.paddingLeft+r.paddingRight,v=r.paddingTop+r.paddingBottom,x=r.marginLeft+r.marginRight,E=r.marginTop+r.marginBottom,b=r.borderLeftWidth+r.borderRightWidth,w=r.borderTopWidth+r.borderBottomWidth,_=a&&c,T=e(i.width);T!==!1&&(r.width=T+(_?0:g+b));var z=e(i.height);return z!==!1&&(r.height=z+(_?0:v+w)),r.innerWidth=r.width-(g+b),r.innerHeight=r.height-(v+w),r.outerWidth=r.width+x,r.outerHeight=r.height+E,r}}function h(e,i){if(t.getComputedStyle||-1===i.indexOf("%"))return i;var n=e.style,o=n.left,r=e.runtimeStyle,s=r&&r.left;return s&&(r.left=e.currentStyle.left),n.left=i,i=n.pixelLeft,n.left=o,s&&(r.left=s),i}var p,u,c,d=!1;return a}var r="undefined"==typeof console?i:function(t){console.error(t)},s=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];"function"==typeof define&&define.amd?define("get-size/get-size",["get-style-property/get-style-property"],o):"object"==typeof exports?module.exports=o(require("desandro-get-style-property")):t.getSize=o(t.getStyleProperty)}(window),function(t){function e(e){var i=t.event;return i.target=i.target||i.srcElement||e,i}var i=document.documentElement,n=function(){};i.addEventListener?n=function(t,e,i){t.addEventListener(e,i,!1)}:i.attachEvent&&(n=function(t,i,n){t[i+n]=n.handleEvent?function(){var i=e(t);n.handleEvent.call(n,i)}:function(){var i=e(t);n.call(t,i)},t.attachEvent("on"+i,t[i+n])});var o=function(){};i.removeEventListener?o=function(t,e,i){t.removeEventListener(e,i,!1)}:i.detachEvent&&(o=function(t,e,i){t.detachEvent("on"+e,t[e+i]);try{delete t[e+i]}catch(n){t[e+i]=void 0}});var r={bind:n,unbind:o};"function"==typeof define&&define.amd?define("eventie/eventie",r):"object"==typeof exports?module.exports=r:t.eventie=r}(window),function(){function t(){}function e(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}function i(t){return function(){return this[t].apply(this,arguments)}}var n=t.prototype,o=this,r=o.EventEmitter;n.getListeners=function(t){var e,i,n=this._getEvents();if(t instanceof RegExp){e={};for(i in n)n.hasOwnProperty(i)&&t.test(i)&&(e[i]=n[i])}else e=n[t]||(n[t]=[]);return e},n.flattenListeners=function(t){var e,i=[];for(e=0;t.length>e;e+=1)i.push(t[e].listener);return i},n.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&(e={},e[t]=i),e||i},n.addListener=function(t,i){var n,o=this.getListenersAsObject(t),r="object"==typeof i;for(n in o)o.hasOwnProperty(n)&&-1===e(o[n],i)&&o[n].push(r?i:{listener:i,once:!1});return this},n.on=i("addListener"),n.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},n.once=i("addOnceListener"),n.defineEvent=function(t){return this.getListeners(t),this},n.defineEvents=function(t){for(var e=0;t.length>e;e+=1)this.defineEvent(t[e]);return this},n.removeListener=function(t,i){var n,o,r=this.getListenersAsObject(t);for(o in r)r.hasOwnProperty(o)&&(n=e(r[o],i),-1!==n&&r[o].splice(n,1));return this},n.off=i("removeListener"),n.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},n.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},n.manipulateListeners=function(t,e,i){var n,o,r=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(n=i.length;n--;)r.call(this,e,i[n]);else for(n in e)e.hasOwnProperty(n)&&(o=e[n])&&("function"==typeof o?r.call(this,n,o):s.call(this,n,o));return this},n.removeEvent=function(t){var e,i=typeof t,n=this._getEvents();if("string"===i)delete n[t];else if(t instanceof RegExp)for(e in n)n.hasOwnProperty(e)&&t.test(e)&&delete n[e];else delete this._events;return this},n.removeAllListeners=i("removeEvent"),n.emitEvent=function(t,e){var i,n,o,r,s=this.getListenersAsObject(t);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].length;n--;)i=s[o][n],i.once===!0&&this.removeListener(t,i.listener),r=i.listener.apply(this,e||[]),r===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},n.trigger=i("emitEvent"),n.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},n.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},n._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},n._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return o.EventEmitter=r,t},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return t}):"object"==typeof module&&module.exports?module.exports=t:o.EventEmitter=t}.call(this),function(t){function e(t){"function"==typeof t&&(e.isReady?t():s.push(t))}function i(t){var i="readystatechange"===t.type&&"complete"!==r.readyState;e.isReady||i||n()}function n(){e.isReady=!0;for(var t=0,i=s.length;i>t;t++){var n=s[t];n()}}function o(o){return"complete"===r.readyState?n():(o.bind(r,"DOMContentLoaded",i),o.bind(r,"readystatechange",i),o.bind(t,"load",i)),e}var r=t.document,s=[];e.isReady=!1,"function"==typeof define&&define.amd?define("doc-ready/doc-ready",["eventie/eventie"],o):"object"==typeof exports?module.exports=o(require("eventie")):t.docReady=o(t.eventie)}(window),function(t){function e(t,e){return t[s](e)}function i(t){if(!t.parentNode){var e=document.createDocumentFragment();e.appendChild(t)}}function n(t,e){i(t);for(var n=t.parentNode.querySelectorAll(e),o=0,r=n.length;r>o;o++)if(n[o]===t)return!0;return!1}function o(t,n){return i(t),e(t,n)}var r,s=function(){if(t.matches)return"matches";if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],i=0,n=e.length;n>i;i++){var o=e[i],r=o+"MatchesSelector";if(t[r])return r}}();if(s){var a=document.createElement("div"),h=e(a,"div");r=h?e:o}else r=n;"function"==typeof define&&define.amd?define("matches-selector/matches-selector",[],function(){return r}):"object"==typeof exports?module.exports=r:window.matchesSelector=r}(Element.prototype),function(t,e){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["doc-ready/doc-ready","matches-selector/matches-selector"],function(i,n){return e(t,i,n)}):"object"==typeof exports?module.exports=e(t,require("doc-ready"),require("desandro-matches-selector")):t.fizzyUIUtils=e(t,t.docReady,t.matchesSelector)}(window,function(t,e,i){var n={};n.extend=function(t,e){for(var i in e)t[i]=e[i];return t},n.modulo=function(t,e){return(t%e+e)%e};var o=Object.prototype.toString;n.isArray=function(t){return"[object Array]"==o.call(t)},n.makeArray=function(t){var e=[];if(n.isArray(t))e=t;else if(t&&"number"==typeof t.length)for(var i=0,o=t.length;o>i;i++)e.push(t[i]);else e.push(t);return e},n.indexOf=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},n.removeFrom=function(t,e){var i=n.indexOf(t,e);-1!=i&&t.splice(i,1)},n.isElement="function"==typeof HTMLElement||"object"==typeof HTMLElement?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"==typeof t&&1==t.nodeType&&"string"==typeof t.nodeName},n.setText=function(){function t(t,i){e=e||(void 0!==document.documentElement.textContent?"textContent":"innerText"),t[e]=i}var e;return t}(),n.getParent=function(t,e){for(;t!=document.body;)if(t=t.parentNode,i(t,e))return t},n.getQueryElement=function(t){return"string"==typeof t?document.querySelector(t):t},n.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},n.filterFindElements=function(t,e){t=n.makeArray(t);for(var o=[],r=0,s=t.length;s>r;r++){var a=t[r];if(n.isElement(a))if(e){i(a,e)&&o.push(a);for(var h=a.querySelectorAll(e),p=0,u=h.length;u>p;p++)o.push(h[p])}else o.push(a)}return o},n.debounceMethod=function(t,e,i){var n=t.prototype[e],o=e+"Timeout";t.prototype[e]=function(){var t=this[o];t&&clearTimeout(t);var e=arguments,r=this;this[o]=setTimeout(function(){n.apply(r,e),delete r[o]},i||100)}},n.toDashed=function(t){return t.replace(/(.)([A-Z])/g,function(t,e,i){return e+"-"+i}).toLowerCase()};var r=t.console;return n.htmlInit=function(i,o){e(function(){for(var e=n.toDashed(o),s=document.querySelectorAll(".js-"+e),a="data-"+e+"-options",h=0,p=s.length;p>h;h++){var u,c=s[h],d=c.getAttribute(a);try{u=d&&JSON.parse(d)}catch(l){r&&r.error("Error parsing "+a+" on "+c.nodeName.toLowerCase()+(c.id?"#"+c.id:"")+": "+l);continue}var f=new i(c,u),y=t.jQuery;y&&y.data(c,o,f)}})},n}),function(t,e){"function"==typeof define&&define.amd?define("outlayer/item",["eventEmitter/EventEmitter","get-size/get-size","get-style-property/get-style-property","fizzy-ui-utils/utils"],function(i,n,o,r){return e(t,i,n,o,r)}):"object"==typeof exports?module.exports=e(t,require("wolfy87-eventemitter"),require("get-size"),require("desandro-get-style-property"),require("fizzy-ui-utils")):(t.Outlayer={},t.Outlayer.Item=e(t,t.EventEmitter,t.getSize,t.getStyleProperty,t.fizzyUIUtils))}(window,function(t,e,i,n,o){function r(t){for(var e in t)return!1;return e=null,!0}function s(t,e){t&&(this.element=t,this.layout=e,this.position={x:0,y:0},this._create())}var a=t.getComputedStyle,h=a?function(t){return a(t,null)}:function(t){return t.currentStyle},p=n("transition"),u=n("transform"),c=p&&u,d=!!n("perspective"),l={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"}[p],f=["transform","transition","transitionDuration","transitionProperty"],y=function(){for(var t={},e=0,i=f.length;i>e;e++){var o=f[e],r=n(o);r&&r!==o&&(t[o]=r)}return t}();o.extend(s.prototype,e.prototype),s.prototype._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},s.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},s.prototype.getSize=function(){this.size=i(this.element)},s.prototype.css=function(t){var e=this.element.style;for(var i in t){var n=y[i]||i;e[n]=t[i]}},s.prototype.getPosition=function(){var t=h(this.element),e=this.layout.options,i=e.isOriginLeft,n=e.isOriginTop,o=parseInt(t[i?"left":"right"],10),r=parseInt(t[n?"top":"bottom"],10);o=isNaN(o)?0:o,r=isNaN(r)?0:r;var s=this.layout.size;o-=i?s.paddingLeft:s.paddingRight,r-=n?s.paddingTop:s.paddingBottom,this.position.x=o,this.position.y=r},s.prototype.layoutPosition=function(){var t=this.layout.size,e=this.layout.options,i={},n=e.isOriginLeft?"paddingLeft":"paddingRight",o=e.isOriginLeft?"left":"right",r=e.isOriginLeft?"right":"left",s=this.position.x+t[n];s=e.percentPosition&&!e.isHorizontal?100*(s/t.width)+"%":s+"px",i[o]=s,i[r]="";var a=e.isOriginTop?"paddingTop":"paddingBottom",h=e.isOriginTop?"top":"bottom",p=e.isOriginTop?"bottom":"top",u=this.position.y+t[a];u=e.percentPosition&&e.isHorizontal?100*(u/t.height)+"%":u+"px",i[h]=u,i[p]="",this.css(i),this.emitEvent("layout",[this])};var m=d?function(t,e){return"translate3d("+t+"px, "+e+"px, 0)"}:function(t,e){return"translate("+t+"px, "+e+"px)"};s.prototype._transitionTo=function(t,e){this.getPosition();var i=this.position.x,n=this.position.y,o=parseInt(t,10),r=parseInt(e,10),s=o===this.position.x&&r===this.position.y;if(this.setPosition(t,e),s&&!this.isTransitioning)return this.layoutPosition(),void 0;var a=t-i,h=e-n,p={},u=this.layout.options;a=u.isOriginLeft?a:-a,h=u.isOriginTop?h:-h,p.transform=m(a,h),this.transition({to:p,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})},s.prototype.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},s.prototype.moveTo=c?s.prototype._transitionTo:s.prototype.goTo,s.prototype.setPosition=function(t,e){this.position.x=parseInt(t,10),this.position.y=parseInt(e,10)},s.prototype._nonTransition=function(t){this.css(t.to),t.isCleaning&&this._removeStyles(t.to);for(var e in t.onTransitionEnd)t.onTransitionEnd[e].call(this)},s.prototype._transition=function(t){if(!parseFloat(this.layout.options.transitionDuration))return this._nonTransition(t),void 0;var e=this._transn;for(var i in t.onTransitionEnd)e.onEnd[i]=t.onTransitionEnd[i];for(i in t.to)e.ingProperties[i]=!0,t.isCleaning&&(e.clean[i]=!0);if(t.from){this.css(t.from);var n=this.element.offsetHeight;n=null}this.enableTransition(t.to),this.css(t.to),this.isTransitioning=!0};var g=u&&o.toDashed(u)+",opacity";s.prototype.enableTransition=function(){this.isTransitioning||(this.css({transitionProperty:g,transitionDuration:this.layout.options.transitionDuration}),this.element.addEventListener(l,this,!1))},s.prototype.transition=s.prototype[p?"_transition":"_nonTransition"],s.prototype.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},s.prototype.onotransitionend=function(t){this.ontransitionend(t)};var v={"-webkit-transform":"transform","-moz-transform":"transform","-o-transform":"transform"};s.prototype.ontransitionend=function(t){if(t.target===this.element){var e=this._transn,i=v[t.propertyName]||t.propertyName;if(delete e.ingProperties[i],r(e.ingProperties)&&this.disableTransition(),i in e.clean&&(this.element.style[t.propertyName]="",delete e.clean[i]),i in e.onEnd){var n=e.onEnd[i];n.call(this),delete e.onEnd[i]}this.emitEvent("transitionEnd",[this])}},s.prototype.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(l,this,!1),this.isTransitioning=!1},s.prototype._removeStyles=function(t){var e={};for(var i in t)e[i]="";this.css(e)};var x={transitionProperty:"",transitionDuration:""};return s.prototype.removeTransitionStyles=function(){this.css(x)},s.prototype.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},s.prototype.remove=function(){if(!p||!parseFloat(this.layout.options.transitionDuration))return this.removeElem(),void 0;var t=this;this.once("transitionEnd",function(){t.removeElem()}),this.hide()},s.prototype.reveal=function(){delete this.isHidden,this.css({display:""});var t=this.layout.options,e={},i=this.getHideRevealTransitionEndProperty("visibleStyle");e[i]=this.onRevealTransitionEnd,this.transition({from:t.hiddenStyle,to:t.visibleStyle,isCleaning:!0,onTransitionEnd:e})},s.prototype.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},s.prototype.getHideRevealTransitionEndProperty=function(t){var e=this.layout.options[t];if(e.opacity)return"opacity";for(var i in e)return i},s.prototype.hide=function(){this.isHidden=!0,this.css({display:""});var t=this.layout.options,e={},i=this.getHideRevealTransitionEndProperty("hiddenStyle");e[i]=this.onHideTransitionEnd,this.transition({from:t.visibleStyle,to:t.hiddenStyle,isCleaning:!0,onTransitionEnd:e})},s.prototype.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},s.prototype.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},s}),function(t,e){"function"==typeof define&&define.amd?define("outlayer/outlayer",["eventie/eventie","eventEmitter/EventEmitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(i,n,o,r,s){return e(t,i,n,o,r,s)}):"object"==typeof exports?module.exports=e(t,require("eventie"),require("wolfy87-eventemitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):t.Outlayer=e(t,t.eventie,t.EventEmitter,t.getSize,t.fizzyUIUtils,t.Outlayer.Item)}(window,function(t,e,i,n,o,r){function s(t,e){var i=o.getQueryElement(t);if(!i)return a&&a.error("Bad element for "+this.constructor.namespace+": "+(i||t)),void 0;this.element=i,h&&(this.$element=h(this.element)),this.options=o.extend({},this.constructor.defaults),this.option(e);var n=++u;this.element.outlayerGUID=n,c[n]=this,this._create(),this.options.isInitLayout&&this.layout()}var a=t.console,h=t.jQuery,p=function(){},u=0,c={};return s.namespace="outlayer",s.Item=r,s.defaults={containerStyle:{position:"relative"},isInitLayout:!0,isOriginLeft:!0,isOriginTop:!0,isResizeBound:!0,isResizingContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}},o.extend(s.prototype,i.prototype),s.prototype.option=function(t){o.extend(this.options,t)},s.prototype._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),o.extend(this.element.style,this.options.containerStyle),this.options.isResizeBound&&this.bindResize()},s.prototype.reloadItems=function(){this.items=this._itemize(this.element.children)},s.prototype._itemize=function(t){for(var e=this._filterFindItemElements(t),i=this.constructor.Item,n=[],o=0,r=e.length;r>o;o++){var s=e[o],a=new i(s,this);n.push(a)}return n},s.prototype._filterFindItemElements=function(t){return o.filterFindElements(t,this.options.itemSelector)},s.prototype.getItemElements=function(){for(var t=[],e=0,i=this.items.length;i>e;e++)t.push(this.items[e].element);return t},s.prototype.layout=function(){this._resetLayout(),this._manageStamps();var t=void 0!==this.options.isLayoutInstant?this.options.isLayoutInstant:!this._isLayoutInited;this.layoutItems(this.items,t),this._isLayoutInited=!0},s.prototype._init=s.prototype.layout,s.prototype._resetLayout=function(){this.getSize()},s.prototype.getSize=function(){this.size=n(this.element)},s.prototype._getMeasurement=function(t,e){var i,r=this.options[t];r?("string"==typeof r?i=this.element.querySelector(r):o.isElement(r)&&(i=r),this[t]=i?n(i)[e]:r):this[t]=0},s.prototype.layoutItems=function(t,e){t=this._getItemsForLayout(t),this._layoutItems(t,e),this._postLayout()},s.prototype._getItemsForLayout=function(t){for(var e=[],i=0,n=t.length;n>i;i++){var o=t[i];o.isIgnored||e.push(o)}return e},s.prototype._layoutItems=function(t,e){if(this._emitCompleteOnItems("layout",t),t&&t.length){for(var i=[],n=0,o=t.length;o>n;n++){var r=t[n],s=this._getItemLayoutPosition(r);s.item=r,s.isInstant=e||r.isLayoutInstant,i.push(s)}this._processLayoutQueue(i)}},s.prototype._getItemLayoutPosition=function(){return{x:0,y:0}},s.prototype._processLayoutQueue=function(t){for(var e=0,i=t.length;i>e;e++){var n=t[e];this._positionItem(n.item,n.x,n.y,n.isInstant)}},s.prototype._positionItem=function(t,e,i,n){n?t.goTo(e,i):t.moveTo(e,i)},s.prototype._postLayout=function(){this.resizeContainer()},s.prototype.resizeContainer=function(){if(this.options.isResizingContainer){var t=this._getContainerSize();t&&(this._setContainerMeasure(t.width,!0),this._setContainerMeasure(t.height,!1))}},s.prototype._getContainerSize=p,s.prototype._setContainerMeasure=function(t,e){if(void 0!==t){var i=this.size;i.isBorderBox&&(t+=e?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),t=Math.max(t,0),this.element.style[e?"width":"height"]=t+"px"}},s.prototype._emitCompleteOnItems=function(t,e){function i(){o.emitEvent(t+"Complete",[e])}function n(){s++,s===r&&i()}var o=this,r=e.length;if(!e||!r)return i(),void 0;for(var s=0,a=0,h=e.length;h>a;a++){var p=e[a];p.once(t,n)}},s.prototype.ignore=function(t){var e=this.getItem(t);e&&(e.isIgnored=!0)},s.prototype.unignore=function(t){var e=this.getItem(t);e&&delete e.isIgnored},s.prototype.stamp=function(t){if(t=this._find(t)){this.stamps=this.stamps.concat(t);for(var e=0,i=t.length;i>e;e++){var n=t[e];this.ignore(n)}}},s.prototype.unstamp=function(t){if(t=this._find(t))for(var e=0,i=t.length;i>e;e++){var n=t[e];o.removeFrom(this.stamps,n),this.unignore(n)}},s.prototype._find=function(t){return t?("string"==typeof t&&(t=this.element.querySelectorAll(t)),t=o.makeArray(t)):void 0},s.prototype._manageStamps=function(){if(this.stamps&&this.stamps.length){this._getBoundingRect();for(var t=0,e=this.stamps.length;e>t;t++){var i=this.stamps[t];this._manageStamp(i)}}},s.prototype._getBoundingRect=function(){var t=this.element.getBoundingClientRect(),e=this.size;this._boundingRect={left:t.left+e.paddingLeft+e.borderLeftWidth,top:t.top+e.paddingTop+e.borderTopWidth,right:t.right-(e.paddingRight+e.borderRightWidth),bottom:t.bottom-(e.paddingBottom+e.borderBottomWidth)}},s.prototype._manageStamp=p,s.prototype._getElementOffset=function(t){var e=t.getBoundingClientRect(),i=this._boundingRect,o=n(t),r={left:e.left-i.left-o.marginLeft,top:e.top-i.top-o.marginTop,right:i.right-e.right-o.marginRight,bottom:i.bottom-e.bottom-o.marginBottom};return r},s.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},s.prototype.bindResize=function(){this.isResizeBound||(e.bind(t,"resize",this),this.isResizeBound=!0)},s.prototype.unbindResize=function(){this.isResizeBound&&e.unbind(t,"resize",this),this.isResizeBound=!1},s.prototype.onresize=function(){function t(){e.resize(),delete e.resizeTimeout}this.resizeTimeout&&clearTimeout(this.resizeTimeout);var e=this;this.resizeTimeout=setTimeout(t,100)},s.prototype.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},s.prototype.needsResizeLayout=function(){var t=n(this.element),e=this.size&&t;return e&&t.innerWidth!==this.size.innerWidth},s.prototype.addItems=function(t){var e=this._itemize(t);return e.length&&(this.items=this.items.concat(e)),e},s.prototype.appended=function(t){var e=this.addItems(t);e.length&&(this.layoutItems(e,!0),this.reveal(e))},s.prototype.prepended=function(t){var e=this._itemize(t);if(e.length){var i=this.items.slice(0);this.items=e.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(e,!0),this.reveal(e),this.layoutItems(i)}},s.prototype.reveal=function(t){this._emitCompleteOnItems("reveal",t);for(var e=t&&t.length,i=0;e&&e>i;i++){var n=t[i];n.reveal()}},s.prototype.hide=function(t){this._emitCompleteOnItems("hide",t);for(var e=t&&t.length,i=0;e&&e>i;i++){var n=t[i];n.hide()}},s.prototype.revealItemElements=function(t){var e=this.getItems(t);this.reveal(e)},s.prototype.hideItemElements=function(t){var e=this.getItems(t);this.hide(e)},s.prototype.getItem=function(t){for(var e=0,i=this.items.length;i>e;e++){var n=this.items[e];if(n.element===t)return n}},s.prototype.getItems=function(t){t=o.makeArray(t);for(var e=[],i=0,n=t.length;n>i;i++){var r=t[i],s=this.getItem(r);s&&e.push(s)}return e},s.prototype.remove=function(t){var e=this.getItems(t);if(this._emitCompleteOnItems("remove",e),e&&e.length)for(var i=0,n=e.length;n>i;i++){var r=e[i];r.remove(),o.removeFrom(this.items,r)}},s.prototype.destroy=function(){var t=this.element.style;t.height="",t.position="",t.width="";for(var e=0,i=this.items.length;i>e;e++){var n=this.items[e];n.destroy()}this.unbindResize();var o=this.element.outlayerGUID;delete c[o],delete this.element.outlayerGUID,h&&h.removeData(this.element,this.constructor.namespace)},s.data=function(t){t=o.getQueryElement(t);var e=t&&t.outlayerGUID;return e&&c[e]},s.create=function(t,e){function i(){s.apply(this,arguments)}return Object.create?i.prototype=Object.create(s.prototype):o.extend(i.prototype,s.prototype),i.prototype.constructor=i,i.defaults=o.extend({},s.defaults),o.extend(i.defaults,e),i.prototype.settings={},i.namespace=t,i.data=s.data,i.Item=function(){r.apply(this,arguments)},i.Item.prototype=new r,o.htmlInit(i,t),h&&h.bridget&&h.bridget(t,i),i},s.Item=r,s}),function(t,e){"function"==typeof define&&define.amd?define("packery/js/rect",e):"object"==typeof exports?module.exports=e():(t.Packery=t.Packery||{},t.Packery.Rect=e())}(window,function(){function t(e){for(var i in t.defaults)this[i]=t.defaults[i];for(i in e)this[i]=e[i]}var e=window.Packery=function(){};return e.Rect=t,t.defaults={x:0,y:0,width:0,height:0},t.prototype.contains=function(t){var e=t.width||0,i=t.height||0;return this.x<=t.x&&this.y<=t.y&&this.x+this.width>=t.x+e&&this.y+this.height>=t.y+i},t.prototype.overlaps=function(t){var e=this.x+this.width,i=this.y+this.height,n=t.x+t.width,o=t.y+t.height;return n>this.x&&e>t.x&&o>this.y&&i>t.y},t.prototype.getMaximalFreeRects=function(e){if(!this.overlaps(e))return!1;var i,n=[],o=this.x+this.width,r=this.y+this.height,s=e.x+e.width,a=e.y+e.height;return this.y<e.y&&(i=new t({x:this.x,y:this.y,width:this.width,height:e.y-this.y}),n.push(i)),o>s&&(i=new t({x:s,y:this.y,width:o-s,height:this.height}),n.push(i)),r>a&&(i=new t({x:this.x,y:a,width:this.width,height:r-a}),n.push(i)),this.x<e.x&&(i=new t({x:this.x,y:this.y,width:e.x-this.x,height:this.height}),n.push(i)),n},t.prototype.canFit=function(t){return this.width>=t.width&&this.height>=t.height},t}),function(t,e){if("function"==typeof define&&define.amd)define("packery/js/packer",["./rect"],e);else if("object"==typeof exports)module.exports=e(require("./rect"));else{var i=t.Packery=t.Packery||{};i.Packer=e(i.Rect)}}(window,function(t){function e(t,e,i){this.width=t||0,this.height=e||0,this.sortDirection=i||"downwardLeftToRight",this.reset()}e.prototype.reset=function(){this.spaces=[],this.newSpaces=[];var e=new t({x:0,y:0,width:this.width,height:this.height});this.spaces.push(e),this.sorter=i[this.sortDirection]||i.downwardLeftToRight},e.prototype.pack=function(t){for(var e=0,i=this.spaces.length;i>e;e++){var n=this.spaces[e];if(n.canFit(t)){this.placeInSpace(t,n);break}}},e.prototype.placeInSpace=function(t,e){t.x=e.x,t.y=e.y,this.placed(t)},e.prototype.placed=function(t){for(var e=[],i=0,n=this.spaces.length;n>i;i++){var o=this.spaces[i],r=o.getMaximalFreeRects(t);r?e.push.apply(e,r):e.push(o)}this.spaces=e,this.mergeSortSpaces()},e.prototype.mergeSortSpaces=function(){e.mergeRects(this.spaces),this.spaces.sort(this.sorter)},e.prototype.addSpace=function(t){this.spaces.push(t),this.mergeSortSpaces()},e.mergeRects=function(t){for(var e=0,i=t.length;i>e;e++){var n=t[e];if(n){var o=t.slice(0);o.splice(e,1);for(var r=0,s=0,a=o.length;a>s;s++){var h=o[s],p=e>s?0:1;n.contains(h)&&(t.splice(s+p-r,1),r++)}}}return t};var i={downwardLeftToRight:function(t,e){return t.y-e.y||t.x-e.x},rightwardTopToBottom:function(t,e){return t.x-e.x||t.y-e.y}};return e}),function(t,e){"function"==typeof define&&define.amd?define("packery/js/item",["get-style-property/get-style-property","outlayer/outlayer","./rect"],e):"object"==typeof exports?module.exports=e(require("desandro-get-style-property"),require("outlayer"),require("./rect")):t.Packery.Item=e(t.getStyleProperty,t.Outlayer,t.Packery.Rect)}(window,function(t,e,i){var n=t("transform"),o=function(){e.Item.apply(this,arguments)};o.prototype=new e.Item;var r=o.prototype._create;return o.prototype._create=function(){r.call(this),this.rect=new i,this.placeRect=new i},o.prototype.dragStart=function(){this.getPosition(),this.removeTransitionStyles(),this.isTransitioning&&n&&(this.element.style[n]="none"),this.getSize(),this.isPlacing=!0,this.needsPositioning=!1,this.positionPlaceRect(this.position.x,this.position.y),this.isTransitioning=!1,this.didDrag=!1},o.prototype.dragMove=function(t,e){this.didDrag=!0;var i=this.layout.size;t-=i.paddingLeft,e-=i.paddingTop,this.positionPlaceRect(t,e)},o.prototype.dragStop=function(){this.getPosition();var t=this.position.x!=this.placeRect.x,e=this.position.y!=this.placeRect.y;this.needsPositioning=t||e,this.didDrag=!1},o.prototype.positionPlaceRect=function(t,e,i){this.placeRect.x=this.getPlaceRectCoord(t,!0),this.placeRect.y=this.getPlaceRectCoord(e,!1,i)},o.prototype.getPlaceRectCoord=function(t,e,i){var n=e?"Width":"Height",o=this.size["outer"+n],r=this.layout[e?"columnWidth":"rowHeight"],s=this.layout.size["inner"+n];e||(s=Math.max(s,this.layout.maxY),this.layout.rowHeight||(s-=this.layout.gutter));var a;if(r){r+=this.layout.gutter,s+=e?this.layout.gutter:0,t=Math.round(t/r);var h;h=this.layout.options.isHorizontal?e?"ceil":"floor":e?"floor":"ceil";var p=Math[h](s/r);p-=Math.ceil(o/r),a=p}else a=s-o;return t=i?t:Math.min(t,a),t*=r||1,Math.max(0,t)},o.prototype.copyPlaceRectPosition=function(){this.rect.x=this.placeRect.x,this.rect.y=this.placeRect.y},o.prototype.removeElem=function(){this.element.parentNode.removeChild(this.element),this.layout.packer.addSpace(this.rect),this.emitEvent("remove",[this])},o}),function(t,e){"function"==typeof define&&define.amd?define(["classie/classie","get-size/get-size","outlayer/outlayer","packery/js/rect","packery/js/packer","packery/js/item"],e):"object"==typeof exports?module.exports=e(require("desandro-classie"),require("get-size"),require("outlayer"),require("./rect"),require("./packer"),require("./item")):t.Packery=e(t.classie,t.getSize,t.Outlayer,t.Packery.Rect,t.Packery.Packer,t.Packery.Item)}(window,function(t,e,i,n,o,r){function s(t,e){return t.position.y-e.position.y||t.position.x-e.position.x}function a(t,e){return t.position.x-e.position.x||t.position.y-e.position.y}n.prototype.canFit=function(t){return this.width>=t.width-1&&this.height>=t.height-1};var h=i.create("packery");return h.Item=r,h.prototype._create=function(){i.prototype._create.call(this),this.packer=new o,this.stamp(this.options.stamped);
var t=this;this.handleDraggabilly={dragStart:function(){t.itemDragStart(this.element)},dragMove:function(){t.itemDragMove(this.element,this.position.x,this.position.y)},dragEnd:function(){t.itemDragEnd(this.element)}},this.handleUIDraggable={start:function(e){t.itemDragStart(e.currentTarget)},drag:function(e,i){t.itemDragMove(e.currentTarget,i.position.left,i.position.top)},stop:function(e){t.itemDragEnd(e.currentTarget)}}},h.prototype._resetLayout=function(){this.getSize(),this._getMeasurements();var t=this.packer;this.options.isHorizontal?(t.width=Number.POSITIVE_INFINITY,t.height=this.size.innerHeight+this.gutter,t.sortDirection="rightwardTopToBottom"):(t.width=this.size.innerWidth+this.gutter,t.height=Number.POSITIVE_INFINITY,t.sortDirection="downwardLeftToRight"),t.reset(),this.maxY=0,this.maxX=0},h.prototype._getMeasurements=function(){this._getMeasurement("columnWidth","width"),this._getMeasurement("rowHeight","height"),this._getMeasurement("gutter","width")},h.prototype._getItemLayoutPosition=function(t){return this._packItem(t),t.rect},h.prototype._packItem=function(t){this._setRectSize(t.element,t.rect),this.packer.pack(t.rect),this._setMaxXY(t.rect)},h.prototype._setMaxXY=function(t){this.maxX=Math.max(t.x+t.width,this.maxX),this.maxY=Math.max(t.y+t.height,this.maxY)},h.prototype._setRectSize=function(t,i){var n=e(t),o=n.outerWidth,r=n.outerHeight;(o||r)&&(o=this._applyGridGutter(o,this.columnWidth),r=this._applyGridGutter(r,this.rowHeight)),i.width=Math.min(o,this.packer.width),i.height=Math.min(r,this.packer.height)},h.prototype._applyGridGutter=function(t,e){if(!e)return t+this.gutter;e+=this.gutter;var i=t%e,n=i&&1>i?"round":"ceil";return t=Math[n](t/e)*e},h.prototype._getContainerSize=function(){return this.options.isHorizontal?{width:this.maxX-this.gutter}:{height:this.maxY-this.gutter}},h.prototype._manageStamp=function(t){var e,i=this.getItem(t);if(i&&i.isPlacing)e=i.placeRect;else{var o=this._getElementOffset(t);e=new n({x:this.options.isOriginLeft?o.left:o.right,y:this.options.isOriginTop?o.top:o.bottom})}this._setRectSize(t,e),this.packer.placed(e),this._setMaxXY(e)},h.prototype.sortItemsByPosition=function(){var t=this.options.isHorizontal?a:s;this.items.sort(t)},h.prototype.fit=function(t,e,i){var n=this.getItem(t);n&&(this._getMeasurements(),this.stamp(n.element),n.getSize(),n.isPlacing=!0,e=void 0===e?n.rect.x:e,i=void 0===i?n.rect.y:i,n.positionPlaceRect(e,i,!0),this._bindFitEvents(n),n.moveTo(n.placeRect.x,n.placeRect.y),this.layout(),this.unstamp(n.element),this.sortItemsByPosition(),n.isPlacing=!1,n.copyPlaceRectPosition())},h.prototype._bindFitEvents=function(t){function e(){n++,2==n&&i.emitEvent("fitComplete",[t])}var i=this,n=0;t.on("layout",function(){return e(),!0}),this.on("layoutComplete",function(){return e(),!0})},h.prototype.resize=function(){var t=e(this.element),i=this.size&&t,n=this.options.isHorizontal?"innerHeight":"innerWidth";i&&t[n]==this.size[n]||this.layout()},h.prototype.itemDragStart=function(t){this.stamp(t);var e=this.getItem(t);e&&e.dragStart()},h.prototype.itemDragMove=function(t,e,i){function n(){r.layout(),delete r.dragTimeout}var o=this.getItem(t);o&&o.dragMove(e,i);var r=this;this.clearDragTimeout(),this.dragTimeout=setTimeout(n,40)},h.prototype.clearDragTimeout=function(){this.dragTimeout&&clearTimeout(this.dragTimeout)},h.prototype.itemDragEnd=function(e){var i,n=this.getItem(e);if(n&&(i=n.didDrag,n.dragStop()),!n||!i&&!n.needsPositioning)return this.unstamp(e),void 0;t.add(n.element,"is-positioning-post-drag");var o=this._getDragEndLayoutComplete(e,n);n.needsPositioning?(n.on("layout",o),n.moveTo(n.placeRect.x,n.placeRect.y)):n&&n.copyPlaceRectPosition(),this.clearDragTimeout(),this.on("layoutComplete",o),this.layout()},h.prototype._getDragEndLayoutComplete=function(e,i){var n=i&&i.needsPositioning,o=0,r=n?2:1,s=this;return function(){return o++,o!=r?!0:(i&&(t.remove(i.element,"is-positioning-post-drag"),i.isPlacing=!1,i.copyPlaceRectPosition()),s.unstamp(e),s.sortItemsByPosition(),n&&s.emitEvent("dragItemPositioned",[i]),!0)}},h.prototype.bindDraggabillyEvents=function(t){t.on("dragStart",this.handleDraggabilly.dragStart),t.on("dragMove",this.handleDraggabilly.dragMove),t.on("dragEnd",this.handleDraggabilly.dragEnd)},h.prototype.bindUIDraggableEvents=function(t){t.on("dragstart",this.handleUIDraggable.start).on("drag",this.handleUIDraggable.drag).on("dragstop",this.handleUIDraggable.stop)},h.Rect=n,h.Packer=o,h});
;
;
/*! advanced.js */ 
;
;
/**
* Full HTML5 compatibility rule set
* These rules define which tags and CSS classes are supported and which tags should be specially treated.
*
* Examples based on this rule set:
*
*    <a href="http://foobar.com">foo</a>
*    ... becomes ...
*    <a href="http://foobar.com" target="_blank" rel="nofollow">foo</a>
*
*    <img align="left" src="http://foobar.com/image.png">
*    ... becomes ...
*    <img class="wysiwyg-float-left" src="http://foobar.com/image.png" alt="">
*
*    <div>foo<script>alert(document.cookie)</script></div>
*    ... becomes ...
*    <div>foo</div>
*
*    <marquee>foo</marquee>
*    ... becomes ...
*    <span>foo</span>
*
*    foo <br clear="both"> bar
*    ... becomes ...
*    foo <br class="wysiwyg-clear-both"> bar
*
*    <div>hello <iframe src="http://google.com"></iframe></div>
*    ... becomes ...
*    <div>hello </div>
*
*    <center>hello</center>
*    ... becomes ...
*    <div class="wysiwyg-text-align-center">hello</div>
*/
var wysihtml5ParserRules = {
/**
* CSS Class white-list
* Following CSS classes won't be removed when parsed by the wysihtml5 HTML parser
*/
"classes": {
"wysiwyg-clear-both": 1,
"wysiwyg-clear-left": 1,
"wysiwyg-clear-right": 1,
"wysiwyg-color-aqua": 1,
"wysiwyg-color-black": 1,
"wysiwyg-color-blue": 1,
"wysiwyg-color-fuchsia": 1,
"wysiwyg-color-gray": 1,
"wysiwyg-color-green": 1,
"wysiwyg-color-lime": 1,
"wysiwyg-color-maroon": 1,
"wysiwyg-color-navy": 1,
"wysiwyg-color-olive": 1,
"wysiwyg-color-purple": 1,
"wysiwyg-color-red": 1,
"wysiwyg-color-silver": 1,
"wysiwyg-color-teal": 1,
"wysiwyg-color-white": 1,
"wysiwyg-color-yellow": 1,
"wysiwyg-float-left": 1,
"wysiwyg-float-right": 1,
"wysiwyg-font-size-large": 1,
"wysiwyg-font-size-larger": 1,
"wysiwyg-font-size-medium": 1,
"wysiwyg-font-size-small": 1,
"wysiwyg-font-size-smaller": 1,
"wysiwyg-font-size-x-large": 1,
"wysiwyg-font-size-x-small": 1,
"wysiwyg-font-size-xx-large": 1,
"wysiwyg-font-size-xx-small": 1,
"wysiwyg-text-align-center": 1,
"wysiwyg-text-align-justify": 1,
"wysiwyg-text-align-left": 1,
"wysiwyg-text-align-right": 1
},
/**
* Tag list
*
* The following options are available:
*
*    - add_class:        converts and deletes the given HTML4 attribute (align, clear, ...) via the given method to a css class
*                        The following methods are implemented in wysihtml5.dom.parse:
*                          - align_text:  converts align attribute values (right/left/center/justify) to their corresponding css class "wysiwyg-text-align-*")
*                            <p align="center">foo</p> ... becomes ... <p class="wysiwyg-text-align-center">foo</p>
*                          - clear_br:    converts clear attribute values left/right/all/both to their corresponding css class "wysiwyg-clear-*"
*                            <br clear="all"> ... becomes ... <br class="wysiwyg-clear-both">
*                          - align_img:    converts align attribute values (right/left) on <img> to their corresponding css class "wysiwyg-float-*"
*
*    - add_style:        converts and deletes the given HTML4 attribute (align) via the given method to a css style
*                        The following methods are implemented in wysihtml5.dom.parse:
*                          - align_text:  converts align attribute values (right/left/center) to their corresponding css style)
*                            <p align="center">foo</p> ... becomes ... <p style="text-align:center">foo</p>
*
*    - remove:             removes the element and its content
*
*    - unwrap              removes element but leaves content
*
*    - rename_tag:         renames the element to the given tag
*
*    - set_class:          adds the given class to the element (note: make sure that the class is in the "classes" white list above)
*
*    - set_attributes:     sets/overrides the given attributes
*
*    - check_attributes:   checks the given HTML attribute via the given method
*                            - url:            allows only valid urls (starting with http:// or https://)
*                            - src:            allows something like "/foobar.jpg", "http://google.com", ...
*                            - href:           allows something like "mailto:bert@foo.com", "http://google.com", "/foobar.jpg"
*                            - alt:            strips unwanted characters. if the attribute is not set, then it gets set (to ensure valid and compatible HTML)
*                            - numbers:        ensures that the attribute only contains numeric (integer) characters (no float values or units)
*                            - dimension:      for with/height attributes where floating point numbrs and percentages are allowed
*                            - any:            allows anything to pass 
*/
"tags": {
"tr": {
"add_class": {
"align": "align_text"
}
},
"strike": {
"remove": 1
},
"form": {
"rename_tag": "div"
},
"rt": {
"rename_tag": "span"
},
"code": {},
"acronym": {
"rename_tag": "span"
},
"br": {
"add_class": {
"clear": "clear_br"
}
},
"details": {
"rename_tag": "div"
},
"h4": {
"add_class": {
"align": "align_text"
}
},
"em": {},
"title": {
"remove": 1
},
"multicol": {
"rename_tag": "div"
},
"figure": {
"rename_tag": "div"
},
"xmp": {
"rename_tag": "span"
},
"small": {
"rename_tag": "span",
"set_class": "wysiwyg-font-size-smaller"
},
"area": {
"remove": 1
},
"time": {
"rename_tag": "span"
},
"dir": {
"rename_tag": "ul"
},
"bdi": {
"rename_tag": "span"
},
"command": {
"remove": 1
},
"ul": {},
"progress": {
"rename_tag": "span"
},
"dfn": {
"rename_tag": "span"
},
"iframe": {
"remove": 1
},
"figcaption": {
"rename_tag": "div"
},
"a": {
"check_attributes": {
"target": "any",
"href": "url" // if you compiled master manually then change this from 'url' to 'href'
},
"set_attributes": {
"rel": "nofollow"
}
},
"img": {
"check_attributes": {
"width": "dimension",
"alt": "alt",
"src": "url", // if you compiled master manually then change this from 'url' to 'src'
"height": "dimension"
},
"add_class": {
"align": "align_img"
}
},
"rb": {
"rename_tag": "span"
},
"footer": {
"rename_tag": "div"
},
"noframes": {
"remove": 1
},
"abbr": {
"rename_tag": "span"
},
"u": {},
"bgsound": {
"remove": 1
},
"address": {
"rename_tag": "div"
},
"basefont": {
"remove": 1
},
"nav": {
"rename_tag": "div"
},
"h1": {
"add_class": {
"align": "align_text"
}
},
"head": {
"remove": 1
},
"tbody": {
"add_class": {
"align": "align_text"
}
},
"dd": {
"rename_tag": "div"
},
"s": {
"rename_tag": "span"
},
"li": {},
"td": {
"check_attributes": {
"rowspan": "numbers",
"colspan": "numbers"
},
"add_class": {
"align": "align_text"
}
},
"object": {
"remove": 1
},
"div": {
"add_class": {
"align": "align_text"
}
},
"option": {
"rename_tag": "span"
},
"select": {
"rename_tag": "span"
},
"i": {},
"track": {
"remove": 1
},
"wbr": {
"remove": 1
},
"fieldset": {
"rename_tag": "div"
},
"big": {
"rename_tag": "span",
"set_class": "wysiwyg-font-size-larger"
},
"button": {
"rename_tag": "span"
},
"noscript": {
"remove": 1
},
"svg": {
"remove": 1
},
"input": {
"remove": 1
},
"table": {},
"keygen": {
"remove": 1
},
"h5": {
"add_class": {
"align": "align_text"
}
},
"meta": {
"remove": 1
},
"map": {
"rename_tag": "div"
},
"isindex": {
"remove": 1
},
"mark": {
"rename_tag": "span"
},
"caption": {
"add_class": {
"align": "align_text"
}
},
"tfoot": {
"add_class": {
"align": "align_text"
}
},
"base": {
"remove": 1
},
"video": {
"remove": 1
},
"strong": {},
"canvas": {
"remove": 1
},
"output": {
"rename_tag": "span"
},
"marquee": {
"rename_tag": "span"
},
"b": {},
"q": {
"check_attributes": {
"cite": "url"
}
},
"applet": {
"remove": 1
},
"span": {},
"rp": {
"rename_tag": "span"
},
"spacer": {
"remove": 1
},
"source": {
"remove": 1
},
"aside": {
"rename_tag": "div"
},
"frame": {
"remove": 1
},
"section": {
"rename_tag": "div"
},
"body": {
"rename_tag": "div"
},
"ol": {},
"nobr": {
"rename_tag": "span"
},
"html": {
"rename_tag": "div"
},
"summary": {
"rename_tag": "span"
},
"var": {
"rename_tag": "span"
},
"del": {
"remove": 1
},
"blockquote": {
"check_attributes": {
"cite": "url"
}
},
"style": {
"remove": 1
},
"device": {
"remove": 1
},
"meter": {
"rename_tag": "span"
},
"h3": {
"add_class": {
"align": "align_text"
}
},
"textarea": {
"rename_tag": "span"
},
"embed": {
"remove": 1
},
"hgroup": {
"rename_tag": "div"
},
"font": {
"rename_tag": "span",
"add_class": {
"size": "size_font"
}
},
"tt": {
"rename_tag": "span"
},
"noembed": {
"remove": 1
},
"thead": {
"add_class": {
"align": "align_text"
}
},
"blink": {
"rename_tag": "span"
},
"plaintext": {
"rename_tag": "span"
},
"xml": {
"remove": 1
},
"h6": {
"add_class": {
"align": "align_text"
}
},
"param": {
"remove": 1
},
"th": {
"check_attributes": {
"rowspan": "numbers",
"colspan": "numbers"
},
"add_class": {
"align": "align_text"
}
},
"legend": {
"rename_tag": "span"
},
"hr": {},
"label": {
"rename_tag": "span"
},
"dl": {
"rename_tag": "div"
},
"kbd": {
"rename_tag": "span"
},
"listing": {
"rename_tag": "div"
},
"dt": {
"rename_tag": "span"
},
"nextid": {
"remove": 1
},
"pre": {},
"center": {
"rename_tag": "div",
"set_class": "wysiwyg-text-align-center"
},
"audio": {
"remove": 1
},
"datalist": {
"rename_tag": "span"
},
"samp": {
"rename_tag": "span"
},
"col": {
"remove": 1
},
"article": {
"rename_tag": "div"
},
"cite": {},
"link": {
"remove": 1
},
"script": {
"remove": 1
},
"bdo": {
"rename_tag": "span"
},
"menu": {
"rename_tag": "ul"
},
"colgroup": {
"remove": 1
},
"ruby": {
"rename_tag": "span"
},
"h2": {
"add_class": {
"align": "align_text"
}
},
"ins": {
"rename_tag": "span"
},
"p": {
"add_class": {
"align": "align_text"
}
},
"sub": {},
"comment": {
"remove": 1
},
"frameset": {
"remove": 1
},
"optgroup": {
"rename_tag": "span"
},
"header": {
"rename_tag": "div"
},
"sup": {}
}
};
;
;
/*! wysihtml-toolbar.min.js */ 
;
;
/*! wysihtml - v0.5.2 (2015-11-10) */
var wysihtml5={version:"0.5.2",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};wysihtml5.polyfills=function(a,b){String.prototype.trim||!function(){var a=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(a,"")}}(),function(){var c="addEventListener",d="removeEventListener";b[c]||(a.Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){var b=b||a.event;b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},a.Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(a.Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(a.Element.prototype,"textContent").get&&!function(){var b=Object.getOwnPropertyDescriptor(a.Element.prototype,"innerText");Object.defineProperty(a.Element.prototype,"textContent",{get:function(){return b.get.call(this)},set:function(a){return b.set.call(this,a)}})}(),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=this.length,d=-1,e=b>>>0;~(c-e);d=this[--c]===a?c:d);return d}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(a){a.matches=a.matches||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return c[d]?!0:!1},a.closest=a.closest||function(a){for(var b=this;b&&!b.matches(a);)b=b.parentElement;return b}}(Element.prototype),"document"in a&&("classList"in b.createElement("_")?"DOMTokenList"in a&&!function(){"use strict";var c=b.createElement("_");if(c.classList.add("c1","c2"),!c.classList.contains("c2")){var d=function(b){var c=a.DOMTokenList.prototype[b];a.DOMTokenList.prototype[b]=function(a){var b,d=arguments.length;for(b=0;d>b;b++)a=arguments[b],c.call(this,a)}};d("add"),d("remove")}if(c.classList.toggle("c3",!1),c.classList.contains("c3")){var e=a.DOMTokenList.prototype.toggle;a.DOMTokenList.prototype.toggle=function(a,b){return 1 in arguments&&!this.contains(a)==!b?b:e.call(this,a)}}c=null}():!function(a){"use strict";if("Element"in a){var b="classList",c="prototype",d=a.Element[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.getAttribute("class")||""),c=b?b.split(/\s+/):[],d=0,e=c.length;e>d;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0);while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b,c=arguments,d=0,e=c.length,f=!1;do for(a=c[d]+"",b=i(this,a);-1!==b;)this.splice(b,1),f=!0,b=i(this,a);while(++d<e);f&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),b===!0||b===!1?b:!c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){-2146823252===n.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(a));var c=function(){if("createRange"in document&&"getSelection"in window){var a,b,c=document.createElement("div"),d=document.createTextNode("a"),e=document.createTextNode("a"),f=document.createTextNode("a"),g=document.createRange();return c.setAttribute("contenteditable","true"),c.appendChild(d),c.appendChild(e),c.appendChild(f),document.body.appendChild(c),g.setStart(e,1),g.setEnd(e,1),a=window.getSelection(),a.removeAllRanges(),a.addRange(g),c.normalize(),a=window.getSelection(),b=1!==c.childNodes.length||a.anchorNode!==c.firstChild||2!==a.anchorOffset,c.parentNode.removeChild(c),a.removeAllRanges(),b}},d=function(a){var b=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b.push(a):b=b.concat(d(a));return b},e=function(){var a=(Node.prototype.normalize,function(){var a=d(this),b=this.ownerDocument.defaultView.getSelection(),c=b.anchorNode,e=b.anchorOffset,f=c&&1===c.nodeType&&c.childNodes.length>0?c.childNodes[e]:void 0,g=b.focusNode,h=b.focusOffset,i=g&&1===g.nodeType&&h>0?g.childNodes[h-1]:void 0,j=this.ownerDocument.createRange(),k=a.shift(),l=k?a.shift():null;for(i&&3===i.nodeType&&(g=i,h=i.nodeValue.length,i=void 0),f&&3===f.nodeType&&(c=f,e=0,f=void 0),(c===g&&e>h||c!==g&&c.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_PRECEDING&&!(c.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_CONTAINS))&&(g=[c,c=g][0],h=[e,e=h][0]);k&&l;)l.previousSibling&&l.previousSibling===k?(c===l&&(c=k,e=k.nodeValue.length+e),g===l&&(g=k,h=k.nodeValue.length+h),k.nodeValue=k.nodeValue+l.nodeValue,l.parentNode.removeChild(l),l=a.shift()):(k=l,l=a.shift());i&&(h=Array.prototype.indexOf.call(i.parentNode.childNodes,i)+1),f&&(e=Array.prototype.indexOf.call(f.parentNode.childNodes,f)),c&&c.parentNode&&g&&g.parentNode&&(j.setStart(c,e),j.setEnd(g,h),b.removeAllRanges(),b.addRange(j))});Node.prototype.normalize=a},f=function(){window.removeEventListener("load",f),"Node"in window&&"normalize"in Node.prototype&&c()&&e()};"complete"!==b.readyState?window.addEventListener("load",f):f()},wysihtml5.polyfills(window,document),function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.rangy=a()}(function(){function a(a,b){var c=typeof a[b];return c==u||!(c!=t||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=t||!a[b])}function c(a,b){return typeof a[b]!=v}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&A(a,z)&&C(a,y)}function f(a){return b(a,"body")?a.body:a.getElementsByTagName("body")[0]}function g(b){typeof console!=v&&a(console,"log")&&console.log(b)}function h(a,b){F&&b?alert(a):g(a)}function i(a){H.initialized=!0,H.supported=!1,h("Rangy is not supported in this environment. Reason: "+a,H.config.alertOnFail)}function j(a){h("Rangy warning: "+a,H.config.alertOnWarn)}function k(a){return a.message||a.description||String(a)}function l(){if(F&&!H.initialized){var b,c=!1,d=!1;a(document,"createRange")&&(b=document.createRange(),A(b,x)&&C(b,w)&&(c=!0));var h=f(document);if(!h||"body"!=h.nodeName.toLowerCase())return void i("No body element found");if(h&&a(h,"createTextRange")&&(b=h.createTextRange(),e(b)&&(d=!0)),!c&&!d)return void i("Neither Range nor TextRange are available");H.initialized=!0,H.features={implementsDomRange:c,implementsTextRange:d};var j,l;for(var m in E)(j=E[m])instanceof p&&j.init(j,H);for(var n=0,o=K.length;o>n;++n)try{K[n](H)}catch(q){l="Rangy init listener threw an exception. Continuing. Detail: "+k(q),g(l)}}}function m(a,b,c){c&&(a+=" in module "+c.name),H.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}function n(a,b,c,d){a[b]=function(){return m(b,c,d),a[c].apply(a,G.toArray(arguments))}}function o(a){a=a||window,l();for(var b=0,c=L.length;c>b;++b)L[b](a)}function p(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function q(a,b,c){var d=new p(a,b,function(b){if(!b.initialized){b.initialized=!0;try{c(H,b),b.supported=!0}catch(d){var e="Module '"+a+"' failed to load: "+k(d);g(e),d.stack&&g(d.stack)}}});return E[a]=d,d}function r(){}function s(){}var t="object",u="function",v="undefined",w=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],y=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],z=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],A=d(a),B=d(b),C=d(c),D=[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c],c)},E={},F=typeof window!=v&&typeof document!=v,G={isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:A,areHostObjects:B,areHostProperties:C,isTextRange:e,getBody:f,forEach:D},H={version:"1.3.0",initialized:!1,isBrowser:F,supported:!0,util:G,features:{},modules:E,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==v?!0:rangyAutoInitialize}};H.fail=i,H.warn=j;var I;({}).hasOwnProperty?(G.extend=I=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&I(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a},G.createOptions=function(a,b){var c={};return I(c,b),a&&I(c,a),c}):i("hasOwnProperty not supported"),F||i("Rangy can only run in a browser"),function(){var a;if(F){var b=document.createElement("div");b.appendChild(document.createElement("span"));var c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(d){}}a||(a=function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=a[c];return b}),G.toArray=a}();var J;F&&(a(document,"addEventListener")?J=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?J=function(a,b,c){a.attachEvent("on"+b,c)}:i("Document does not have required addEventListener or attachEvent method"),G.addListener=J);var K=[];G.deprecationNotice=m,G.createAliasForDeprecatedMethod=n,H.init=l,H.addInitListener=function(a){H.initialized?a(H):K.push(a)};var L=[];H.addShimListener=function(a){L.push(a)},F&&(H.shim=H.createMissingNativeApi=o,n(H,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var a,b,c=this.dependencies||[],d=0,e=c.length;e>d;++d){if(b=c[d],a=E[b],!(a&&a instanceof p))throw new Error("required module '"+b+"' not found");if(a.init(),!a.supported)throw new Error("required module '"+b+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error(a)},warn:function(a){H.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){H.warn("DEPRECATED: "+a+" in module "+this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},H.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]);var d=q(a,c,b);H.initialized&&H.supported&&d.init()},H.createCoreModule=function(a,b,c){q(a,b,c)},H.RangePrototype=r,H.rangePrototype=new r,H.selectionPrototype=new s,H.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==F||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(K(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),m(d,a),c)for(var f,g=0;f=c[g++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return d}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=F)return a.ownerDocument;if(typeof a.document!=F)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=F)return c.defaultView;if(typeof c.parentWindow!=F)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=F)return a.contentDocument;if(typeof a.contentWindow!=F)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=F)return a.contentWindow;if(typeof a.contentDocument!=F)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&G.isHostMethod(a,"setTimeout")&&G.isHostObject(a,"document")}function t(a,b,c){var d;if(a?G.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:f>c?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw new Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){var b;try{return b=a.parentNode,!1}catch(c){return!0}}function x(a){if(!a)return"[No node]";if(L&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+e(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a,b,c){var d=H(a),e=a.createElement("div");e.contentEditable=""+!!c,b&&(e.innerHTML=b);var f=d.firstChild;return f?d.insertBefore(e,f):d.appendChild(e),e}function A(a){return a.parentNode.removeChild(a)}function B(a){this.root=a,this._next=a}function C(a){return new B(a)}function D(a,b){this.node=a,this.offset=b}function E(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var F="undefined",G=a.util,H=G.getBody;G.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),G.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var I=document.createElement("div");G.areHostMethods(I,["insertBefore","appendChild","cloneNode"]||!G.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),G.isHostProperty(I,"innerHTML")||b.fail("Element is missing innerHTML property");var J=document.createTextNode("test");G.areHostMethods(J,["splitText","deleteData","insertData","appendData","cloneNode"]||!G.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"])||!G.areHostProperties(J,["data"]))||b.fail("Incomplete Text Node implementation");var K=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},L=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br />",L=w(c),a.features.crashyTextNodes=L}();var M;typeof window.getComputedStyle!=F?M=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=F?M=function(a,b){return a.currentStyle?a.currentStyle[b]:""}:b.fail("No means of obtaining computed style properties found"),B.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},D.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},a.dom={arrayContains:K,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:H,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:M,createTestElement:z,removeNode:A,fragmentFromNodeChildren:y,createIterator:C,DomPosition:D},a.DOMException=E}),H.createCoreModule("DomRange",["DomUtil"],function(a,b){function c(a,b){return 3!=a.nodeType&&(P(a,b.startContainer)||P(a,b.endContainer))}function d(a){return a.document||Q(a.startContainer)}function e(a){return W(a.startContainer)}function f(a){return new L(a.parentNode,O(a))}function g(a){return new L(a.parentNode,O(a)+1)}function h(a,b,c){var d=11==a.nodeType?a.firstChild:a;return N(b)?c==b.length?J.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:S(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function i(a,b,c){if(z(a),z(b),d(b)!=d(a))throw new M("WRONG_DOCUMENT_ERR");var e=R(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=R(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?0>=e&&f>=0:0>e&&f>0}function j(a){for(var b,c,e,f=d(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(j(e)),e.detach()),10==c.nodeType)throw new M("HIERARCHY_REQUEST_ERR");f.appendChild(c)}return f}function k(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),k(g,b,c),g.detach(),c.stop)return}else for(d=J.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function l(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),l(b),b.detach()):a.remove()}function m(a){for(var b,c,e=d(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=a.getSubtreeIterator(),b.appendChild(m(c)),c.detach()):a.remove(),10==b.nodeType)throw new M("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function n(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return k(new p(a,!1),function(b){if((!e||d.test(b.nodeType))&&(!f||c(b))){var h=a.startContainer;if(b!=h||!N(h)||a.startOffset!=h.length){var i=a.endContainer;b==i&&N(i)&&0==a.endOffset||g.push(b)}}}),g}function o(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+J.inspectNode(a.startContainer)+":"+a.startOffset+", "+J.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function p(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&N(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||N(this.sc)?T(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||N(this.ec)?T(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,V(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(ea(a,b))throw new M("INVALID_NODE_TYPE_ERR")}function s(a,b){if(!V(b,a.nodeType))throw new M("INVALID_NODE_TYPE_ERR")}function t(a,b){if(0>b||b>(N(a)?a.length:a.childNodes.length))throw new M("INDEX_SIZE_ERR")}function u(a,b){if(ca(a,!0)!==ca(b,!0))throw new M("WRONG_DOCUMENT_ERR")}function v(a){if(da(a,!0))throw new M("NO_MODIFICATION_ALLOWED_ERR")}function w(a,b){if(!a)throw new M(b)}function x(a,b){return b<=(N(a)?a.length:a.childNodes.length)}function y(a){return!!a.startContainer&&!!a.endContainer&&!(X&&(J.isBrokenNode(a.startContainer)||J.isBrokenNode(a.endContainer)))&&W(a.startContainer)==W(a.endContainer)&&x(a.startContainer,a.startOffset)&&x(a.endContainer,a.endOffset)}function z(a){if(!y(a))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a.inspect()+")")}function A(a,b){z(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e;N(e)&&f>0&&f<e.length&&S(e,f,b),N(c)&&d>0&&d<c.length&&(c=S(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=O(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function B(a){z(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function C(a){a.START_TO_START=ka,a.START_TO_END=la,a.END_TO_END=ma,a.END_TO_START=na,a.NODE_BEFORE=oa,a.NODE_AFTER=pa,a.NODE_BEFORE_AND_AFTER=qa,a.NODE_INSIDE=ra}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){z(this);var c,d,e=this.startContainer,f=this.startOffset,h=this.commonAncestorContainer,i=new p(this,!0);e!==h&&(c=T(e,h,!0),d=g(c),e=d.node,f=d.offset),k(i,v),i.reset();var j=a(i);return i.detach(),b(this,e,f,e,f),j}}function F(b,d){function e(a,b){return function(c){s(c,Z),s(W(c),$);var d=(a?f:g)(c);(b?h:i)(this,d.node,d.offset)}}function h(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((W(b)!=W(e)||1==R(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function i(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((W(b)!=W(e)||-1==R(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}var j=function(){};j.prototype=a.rangePrototype,b.prototype=new j,K.extend(b.prototype,{setStart:function(a,b){r(a,!0),t(a,b),h(this,a,b)},setEnd:function(a,b){r(a,!0),t(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],e=b,f=c;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}d(this,b,c,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){z(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(a,!0),d(this,a,0,a,U(a))},selectNode:function(a){r(a,!1),s(a,Z);var b=f(a),c=g(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:E(m,d),deleteContents:E(l,d),canSurroundContents:function(){z(this),v(this.startContainer),v(this.endContainer);var a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},splitBoundaries:function(){A(this)},splitBoundariesPreservingPositions:function(a){A(this,a)},normalizeBoundaries:function(){z(this);var a,b=this.startContainer,c=this.startOffset,e=this.endContainer,f=this.endOffset,g=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(e=a,f=a.length,a.appendData(b.data),Y(b))},h=function(a){var d=a.previousSibling;if(d&&d.nodeType==a.nodeType){b=a;var g=a.length;if(c=d.length,a.insertData(0,d.data),Y(d),b==e)f+=c,e=b;else if(e==a.parentNode){var h=O(a);f==h?(e=a,f=g):f>h&&f--}}},i=!0;if(N(e))f==e.length?g(e):0==f&&(a=e.previousSibling,a&&a.nodeType==e.nodeType&&(f=a.length,b==e&&(i=!1),a.appendData(e.data),Y(e),e=a));else{if(f>0){var j=e.childNodes[f-1];j&&N(j)&&g(j)}i=!this.collapsed}if(i){if(N(b))0==c?h(b):c==b.length&&(a=b.nextSibling,a&&a.nodeType==b.nodeType&&(e==a&&(e=b,f+=b.length),b.appendData(a.data),Y(a)));else if(c<b.childNodes.length){var k=b.childNodes[c];k&&N(k)&&h(k)}}else b=e,c=f;d(this,b,c,e,f)},collapseToPoint:function(a,b){r(a,!0),t(a,b),this.setStartAndEnd(a,b)}}),D(b)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:J.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=J.getDocument(b),G(a)}function I(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,G(this)}var J=a.dom,K=a.util,L=J.DomPosition,M=a.DOMException,N=J.isCharacterDataNode,O=J.getNodeIndex,P=J.isOrIsAncestorOf,Q=J.getDocument,R=J.comparePoints,S=J.splitDataNode,T=J.getClosestAncestorIn,U=J.getNodeLength,V=J.arrayContains,W=J.getRootContainer,X=a.features.crashyTextNodes,Y=J.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,N(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!N(c)||c!==this.sc&&c!==this.ec?c.parentNode&&Y(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return c(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new I(d(this.range));var b=this._current,c=b,e=0,f=b,g=U(b);P(b,this.sc)&&(c=this.sc,e=this.so),P(b,this.ec)&&(f=this.ec,g=this.eo),H(a,c,e,f,g)}return new p(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Z=[1,3,4,5,7,8,10],$=[2,9,11],_=[5,6,10,12],aa=[1,3,4,5,7,8,10,11],ba=[1,3,4,5,7,8],ca=q([9,11]),da=q(_),ea=q([6,10,12]),fa=document.createElement("style"),ga=!1;try{fa.innerHTML="<b>x</b>",ga=3==fa.firstChild.nodeType}catch(ha){}a.features.htmlParsingConforms=ga;var ia=ga?function(a){var b=this.startContainer,c=Q(b);if(!b)throw new M("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:N(b)&&(d=J.parentElement(b)),d=null===d||"HTML"==d.nodeName&&J.isHtmlNamespace(Q(d).documentElement)&&J.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,J.fragmentFromNodeChildren(d)}:function(a){var b=d(this),c=b.createElement("body");return c.innerHTML=a,J.fragmentFromNodeChildren(c)},ja=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ka=0,la=1,ma=2,na=3,oa=0,pa=1,qa=2,ra=3;K.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){z(this),u(this.startContainer,b.startContainer);var c,d,e,f,g=a==na||a==ka?"start":"end",h=a==la||a==ka?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],R(c,d,e,f)},insertNode:function(a){if(z(this),s(a,aa),v(this.startContainer),P(a,this.startContainer))throw new M("HIERARCHY_REQUEST_ERR");var b=h(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){z(this);var a,b;if(this.collapsed)return d(this).createDocumentFragment();if(this.startContainer===this.endContainer&&N(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b;var c=new p(this,!0);return a=j(c),c.detach(),a},canSurroundContents:function(){z(this),v(this.startContainer),v(this.endContainer);var a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},surroundContents:function(a){if(s(a,ba),!this.canSurroundContents())throw new M("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);h(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){z(this);for(var a,b=new I(d(this)),c=ja.length;c--;)a=ja[c],b[a]=this[a];return b},toString:function(){z(this);var a=this.startContainer;if(a===this.endContainer&&N(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new p(this,!0);return k(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){z(this);var b=a.parentNode,c=O(a);if(!b)throw new M("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?qa:oa:e>0?pa:ra},comparePoint:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),R(a,b,this.startContainer,this.startOffset)<0?-1:R(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ia,toHtml:function(){return B(this)},intersectsNode:function(a,b){if(z(this),W(a)!=e(this))return!1;var c=a.parentNode,d=O(a);if(!c)return!0;var f=R(c,d,this.endContainer,this.endOffset),g=R(c,d+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),R(a,b,this.startContainer,this.startOffset)>=0&&R(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return i(this,a,!1)},intersectsOrTouchesRange:function(a){return i(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=R(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=R(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==R(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==R(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new M("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ra},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,U(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a);
},getNodes:function(a,b){return z(this),n(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var c=d(this),e=a.createRange(c);b=b||J.getBody(c),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var d,e,f,g,h=[b],i=!1,j=!1;!j&&(d=h.pop());)if(3==d.nodeType)e=c+d.length,!i&&a.start>=c&&a.start<=e&&(this.setStart(d,a.start-c),i=!0),i&&a.end>=c&&a.end<=e&&(this.setEnd(d,a.end-c),j=!0),c=e;else for(g=d.childNodes,f=g.length;f--;)h.push(g[f])},getName:function(){return"DomRange"},equals:function(a){return I.rangesEqual(this,a)},isValid:function(){return y(this)},inspect:function(){return o(this)},detach:function(){}}),F(I,H),K.extend(I,{rangeProperties:ja,RangeIterator:p,copyComparisonConstants:D,createPrototypeRange:F,inspect:o,toHtml:B,getRangeDocument:d,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=I}),H.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function d(a){for(var b,c=m.length;c--;)b=m[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function g(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var k,l,m=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},h.createPrototypeRange(c,g),k=c.prototype,k.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},k.cloneContents=function(){return this.nativeRange.cloneContents()},k.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},k.collapse=function(a){this.nativeRange.collapse(a),d(this)},k.cloneRange=function(){return new c(this.nativeRange.cloneRange())},k.refresh=function(){d(this)},k.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),k.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},k.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},l=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(p){k.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},k.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},l=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}k.setStartBefore=l("setStartBefore","setEndBefore"),k.setStartAfter=l("setStartAfter","setEndAfter"),k.setEndBefore=l("setEndBefore","setStartBefore"),k.setEndAfter=l("setEndAfter","setStartAfter"),k.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var q=document.createRange();q.selectNodeContents(n),q.setEnd(n,4),q.setStart(n,2),-1==o.compareBoundaryPoints(o.START_TO_END,q)&&1==o.compareBoundaryPoints(o.END_TO_START,q)?k.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:k.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var r=document.createElement("div");r.innerHTML="123";var s=r.firstChild,t=i(document);t.appendChild(r),o.setStart(s,1),o.setEnd(s,2),o.deleteContents(),"13"==s.data&&(k.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},k.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),t.removeChild(r),t=null,f.isHostMethod(o,"createContextualFragment")&&(k.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),k.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&e.removeNode(l);for(var m,n,o,p,q,r=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(r,a),0==m||s==u)break;if(-1==m){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(q=l.nextSibling,-1==m&&q&&k(q)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(q.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);-1==(m=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=h.text.length;p=new g(q,w)}else n=(d||!c)&&l.previousSibling,o=(d||c)&&l.nextSibling,p=o&&k(o)?new g(o,0):n&&k(n)?new g(n,n.data.length):new g(i,e.getNodeIndex(l));return e.removeNode(l),{boundaryPosition:p,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f,g,h=a.offset,j=e.getDocument(a.node),l=i(j).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(g=a.node.childNodes,c=h<g.length?g[h]:null,d=a.node),f=j.createElement("span"),f.innerHTML="&#feff;",c?d.insertBefore(f,c):d.appendChild(f),l.moveToElementText(f),l.collapse(!b),d.removeChild(f),m&&l[b?"moveStart":"moveEnd"]("character",h),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d);var p=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d};if(d.rangeToTextRange=p,d.prototype.toTextRange=function(){return p(this)},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var q=function(a){return a("return this;")()}(Function);"undefined"==typeof q.Range&&(q.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},f.createAliasForDeprecatedMethod(a,"createIframeRange","createRange"),f.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange"),a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),H.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(C.isWindow(a))return a;if(a instanceof r)return a.win;var d=C.getContentDocument(a,b,c);return C.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==C.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof F?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof G?c=b.nativeRange:J.implementsDomRange&&b instanceof C.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!C.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&"undefined"!=typeof a.text}function o(a,b){var c=new G(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(n(c))o(b,c);else{b.rangeCount=c.length;for(var d,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}}function q(a,c){for(var d=a.docSelection.createRange(),e=m(c),f=L(d.item(0)),g=M(f).createControlRange(),h=0,i=d.length;i>h;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=ba.length;e--;)if(c=ba[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(ba.splice(e,1),!0):d;return"deleteAll"==b&&(ba.length=0),null}function u(a,c){for(var d,e=L(c[0].startContainer),f=M(e).createControlRange(),g=0,h=c.length;h>g;++g){d=m(c[g]);try{f.add(d)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new H("WRONG_DOCUMENT_ERR")}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=F.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var y,z,A="boolean",B="number",C=a.dom,D=a.util,E=D.isHostMethod,F=a.DomRange,G=a.WrappedRange,H=a.DOMException,I=C.DomPosition,J=a.features,K="Control",L=C.getDocument,M=C.getBody,N=F.rangesEqual,O=E(window,"getSelection"),P=D.isHostObject(document,"selection");J.implementsWinGetSelection=O,J.implementsDocSelection=P;var Q=P&&(!O||a.config.preferTextRange);if(Q)y=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b};else{if(!O)return b.fail("Neither document.selection or window.getSelection() detected."),!1;y=e,a.isSelectionValid=function(){return!0}}a.getNativeSelection=y;var R=y();if(!R)return b.fail("Native selection was null (possibly issue 138?)"),!1;var S=a.createNativeRange(document),T=M(document),U=D.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);J.selectionHasAnchorAndFocus=U;var V=E(R,"extend");J.selectionHasExtend=V;var W=typeof R.rangeCount==B;J.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(b,c){var d=F.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null;D.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==B&&J.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,e=[],f=g(b),h=0;c>h;++h)e[h]=b.getRangeAt(h);var i=C.createTestElement(document,"",!1),j=i.appendChild(document.createTextNode("   ")),k=document.createRange();if(k.setStart(j,1),k.collapse(!0),b.removeAllRanges(),b.addRange(k),Y=1==b.rangeCount,b.removeAllRanges(),!d){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&parseInt(l[1])>=36)X=!1;else{var m=k.cloneRange();k.setStart(j,0),m.setEnd(j,3),m.setStart(j,2),b.addRange(k),b.addRange(m),X=2==b.rangeCount}}for(C.removeNode(i),b.removeAllRanges(),h=0;c>h;++h)0==h&&f?Z?Z(b,e[h]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(e[h])):b.addRange(e[h])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&E(T,"createControlRange")&&($=T.createControlRange(),D.areHostProperties($,["item","add"])&&(_=!0)),J.implementsControlRange=_,z=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var aa;E(R,"getRangeAt")?aa=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:U&&(aa=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype;var ba=[],ca=function(a){if(a&&a instanceof r)return a.refresh(),a;a=d(a,"getNativeSelection");var b=t(a),c=y(a),e=P?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),ba.push({win:a,selection:b})),b};a.getSelection=ca,D.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");var da=r.prototype;if(!Q&&U&&D.areHostMethods(R,["removeAllRanges","addRange"])){da.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)};var ea=function(a,b){Z(a.nativeSelection,b),a.refresh()};W?da.addRange=function(b,d){if(_&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)ea(this,b);else{var e;X?e=this.rangeCount:(this.removeAllRanges(),e=0);var f=k(b).cloneRange();try{this.nativeSelection.addRange(f)}catch(g){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1){if(a.config.checkSelectionRanges){var i=aa(this.nativeSelection,this.rangeCount-1);i&&!N(i,b)&&(b=new G(i))}this._ranges[this.rangeCount-1]=b,h(this,b,ha(this.nativeSelection)),this.isCollapsed=z(this)}else this.refresh()}}:da.addRange=function(a,b){c(b)&&V?ea(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},da.setRanges=function(a){if(_&&P&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(E(R,"empty")&&E(S,"select")&&_&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;da.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=L(this.anchorNode);else if(this.docSelection.type==K){var b=this.docSelection.createRange();b.length&&(a=L(b.item(0)))}if(a){var c=M(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}j(this)},da.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},da.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}da.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new H("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var fa;if(Q)fa=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(E(R,"getRangeAt")&&typeof R.rangeCount==B)fa=function(b){if(_&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],ha(b.nativeSelection)),b.isCollapsed=z(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=A||typeof S.collapsed!=A||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fa=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=aa(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=z(a)):j(a)}}da.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fa(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!N(b[e],this._ranges[e]))return!0;return!1}};var ga=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;e>d;++d)N(b,c[d])||a.addRange(c[d]);a.rangeCount||j(a)};_&&P?da.removeRange=function(a){if(this.docSelection.type==K){for(var b,c=this.docSelection.createRange(),d=m(a),e=L(c.item(0)),f=M(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),p(this)}else ga(this,a)}:da.removeRange=function(a){ga(this,a)};var ha;!Q&&U&&J.implementsDomRange?(ha=g,da.isBackward=function(){return ha(this)}):ha=da.isBackward=function(){return!1},da.isBackwards=da.isBackward,da.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},da.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},da.collapseToStart=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},da.collapseToEnd=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},da.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},da.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==K){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),C.removeNode(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}}},da.eachRange=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(a(this.getRangeAt(c)))return b},da.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},da.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},da.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b||[]))}),c},da.setStart=w(!0),da.setEnd=w(!1),a.rangePrototype.select=function(a){ca(this.getDocument()).setSingleRange(this,a)},da.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},da.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},da.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},da.moveToBookmark=function(b){for(var c,d,e=[],f=0;c=b.rangeBookmarks[f++];)d=a.createRange(this.win),d.moveToBookmark(c),e.push(d);b.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)},da.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},da.restoreRanges=function(a){this.removeAllRanges();for(var b,c=0;b=a.ranges[c];++c)this.addRange(b,a.backward&&0==c)},da.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(F.toHtml(b))}),a.join("")},J.implementsTextRange&&(da.getNativeTextRange=function(){var c;if(c=this.docSelection){var d=c.createRange();if(n(d))return d;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),da.getName=function(){return"WrappedSelection"},da.inspect=function(){return x(this)},da.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=da,a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ca(a)}),a=null})});var M=!1,N=function(a){M||(M=!0,!H.initialized&&H.config.autoInitialize&&l())};return F&&("complete"==document.readyState?N():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),J(window,"load",N))),H},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("TextRange",["WrappedSelection"],function(a,b){function c(a,b){function c(a,b,c){h.push({start:a,end:b,isWord:c})}for(var d,e,f,g=a.join(""),h=[],i=0;d=b.wordRegex.exec(g);){if(e=d.index,f=e+d[0].length,e>i&&c(i,e,!1),b.includeTrailingSpace)for(;$.test(a[f]);)++f;c(e,f,!0),i=f}return i<a.length&&c(i,a.length,!1),h}function d(a,b){for(var c=a.slice(b.start,b.end),d={isWord:b.isWord,chars:c,toString:function(){return c.join("")}},e=0,f=c.length;f>e;++e)c[e].token=d;return d}function e(a,b,c){for(var e,f=c(a,b),g=[],h=0;e=f[h++];)g.push(d(a,e));return g}function f(a){var b=a||"",c="string"==typeof b?b.split(""):b;return c.sort(function(a,b){return a.charCodeAt(0)-b.charCodeAt(0)}),c.join("").replace(/(.)\1+/g,"$1")}function g(a){var b,c;return a?(b=a.language||_,c={},U(c,ia[b]||ia[_]),U(c,a),c):ia[_]}function h(a,b){var c=V(a,b);return b.hasOwnProperty("wordOptions")&&(c.wordOptions=g(c.wordOptions)),b.hasOwnProperty("characterOptions")&&(c.characterOptions=V(c.characterOptions,ga)),c}function i(a,b){var c=na(a,"display",b),d=a.tagName.toLowerCase();return"block"==c&&fa&&oa.hasOwnProperty(d)?oa[d]:c}function j(a){for(var b=o(a),c=0,d=b.length;d>c;++c)if(1==b[c].nodeType&&"none"==i(b[c]))return!0;return!1}function k(a){var b;return 3==a.nodeType&&(b=a.parentNode)&&"hidden"==na(b,"visibility")}function l(a){return a&&(1==a.nodeType&&!/^(inline(-block|-table)?|none)$/.test(i(a))||9==a.nodeType||11==a.nodeType)}function m(a){return S.isCharacterDataNode(a)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(a.nodeName)}function n(a){for(var b=[];a.parentNode;)b.unshift(a.parentNode),a=a.parentNode;return b}function o(a){return n(a).concat([a])}function p(a){for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null}function q(a,b){return!b&&a.hasChildNodes()?a.firstChild:p(a)}function r(a){var b=a.previousSibling;if(b){for(a=b;a.hasChildNodes();)a=a.lastChild;return a}var c=a.parentNode;return c&&1==c.nodeType?c:null}function s(a){if(!a||3!=a.nodeType)return!1;var b=a.data;if(""===b)return!0;var c=a.parentNode;if(!c||1!=c.nodeType)return!1;var d=na(a.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(d)||/^[\t\r ]+$/.test(b)&&"pre-line"==d}function t(a){if(""===a.data)return!0;if(!s(a))return!1;var b=a.parentNode;return b?j(a)?!0:!1:!0}function u(a){var b=a.nodeType;return 7==b||8==b||j(a)||/^(script|style)$/i.test(a.nodeName)||k(a)||t(a)}function v(a,b){var c=a.nodeType;return 7==c||8==c||1==c&&"none"==i(a,b)}function w(){this.store={}}function x(a,b,c){return function(d){var e=this.cache;if(e.hasOwnProperty(a))return pa++,e[a];qa++;var f=b.call(this,c?this[c]:this,d);return e[a]=f,f}}function y(a,b){this.node=a,this.session=b,this.cache=new w,this.positions=new w}function z(a,b){this.offset=b,this.nodeWrapper=a,this.node=a.node,this.session=a.session,this.cache=new w}function A(){return"[Position("+S.inspectNode(this.node)+":"+this.offset+")]"}function B(){return D(),Da=new Ea}function C(){return Da||B()}function D(){Da&&Da.detach(),Da=null}function E(a,c,d,e){function f(){var a=null;return c?(a=h,i||(h=h.previousVisible(),i=!h||d&&h.equals(d))):i||(a=h=h.nextVisible(),i=!h||d&&h.equals(d)),i&&(h=null),a}d&&(c?u(d.node)&&(d=a.previousVisible()):u(d.node)&&(d=d.nextVisible()));var g,h=a,i=!1,j=!1;return{next:function(){if(j)return j=!1,g;for(var a,b;a=f();)if(b=a.getCharacter(e))return g=a,a;return null},rewind:function(){if(!g)throw b.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");j=!0},dispose:function(){a=d=null}}}function F(a,b,c){function d(a){for(var b,c,d=[],e=a?f:g,h=!1,i=!1;b=e.next();){if(c=b.character,Z.test(c))i&&(i=!1,h=!0);else{if(h){e.rewind();break}i=!0}d.push(b)}return d}var f=E(a,!1,null,b),g=E(a,!0,null,b),h=c.tokenizer,i=d(!0),j=d(!1).reverse(),k=e(j.concat(i),c,h),l=i.length?k.slice(Fa(k,i[0].token)):[],m=j.length?k.slice(0,Fa(k,j.pop().token)+1):[];return{nextEndToken:function(){for(var a,b;1==l.length&&!(a=l[0]).isWord&&(b=d(!0)).length>0;)l=e(a.chars.concat(b),c,h);return l.shift()},previousStartToken:function(){for(var a,b;1==m.length&&!(a=m[0]).isWord&&(b=d(!1)).length>0;)m=e(b.reverse().concat(a.chars),c,h);return m.pop()},dispose:function(){f.dispose(),g.dispose(),l=m=null}}}function G(a,b,c,d,e){var f,g,h,i,j=0,k=a,l=Math.abs(c);if(0!==c){var m=0>c;switch(b){case Q:for(g=E(a,m,null,d);(f=g.next())&&l>j;)++j,k=f;h=f,g.dispose();break;case R:for(var n=F(a,d,e),o=m?n.previousStartToken:n.nextEndToken;(i=o())&&l>j;)i.isWord&&(++j,k=m?i.chars[0]:i.chars[i.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+b+"' not implemented")}m?(k=k.previousVisible(),j=-j):k&&k.isLeadingSpace&&!k.isTrailingSpace&&(b==R&&(g=E(a,!1,null,d),h=g.next(),g.dispose()),h&&(k=h.previousVisible()))}return{position:k,unitsMoved:j}}function H(a,b,c,d){var e=a.getRangeBoundaryPosition(b,!0),f=a.getRangeBoundaryPosition(b,!1),g=d?f:e,h=d?e:f;return E(g,!!d,h,c)}function I(a,b,c){for(var d,e=[],f=H(a,b,c);d=f.next();)e.push(d);return f.dispose(),e}function J(b,c,d){var e=a.createRange(b.node);return e.setStartAndEnd(b.node,b.offset,c.node,c.offset),!e.expand("word",{wordOptions:d})}function K(a,b,c,d,e){function f(a,b){var c=p[a].previousVisible(),d=p[b-1],f=!e.wholeWordsOnly||J(c,d,e.wordOptions);return{startPos:c,endPos:d,valid:f}}for(var g,h,i,j,k,l,m=aa(e.direction),n=E(a,m,a.session.getRangeBoundaryPosition(d,m),e.characterOptions),o="",p=[],q=null;g=n.next();)if(h=g.character,c||e.caseSensitive||(h=h.toLowerCase()),m?(p.unshift(g),o=h+o):(p.push(g),o+=h),c){if(k=b.exec(o))if(i=k.index,j=i+k[0].length,l){if(!m&&j<o.length||m&&i>0){q=f(i,j);break}}else l=!0}else if(-1!=(i=o.indexOf(b))){q=f(i,i+b.length);break}return l&&(q=f(i,j)),n.dispose(),q}function L(a){return function(){var b=!!Da,c=C(),d=[c].concat(T.toArray(arguments)),e=a.apply(this,d);return b||D(),e}}function M(a,b){return L(function(c,d,e,f){typeof e==P&&(e=d,d=Q),f=h(f,ka);var g=a;b&&(g=e>=0,this.collapse(!g));var i=G(c.getRangeBoundaryPosition(this,g),d,e,f.characterOptions,f.wordOptions),j=i.position;return this[g?"setStart":"setEnd"](j.node,j.offset),i.unitsMoved})}function N(a){return L(function(b,c){c=V(c,ga);for(var d,e=H(b,this,c,!a),f=0;(d=e.next())&&Z.test(d.character);)++f;e.dispose();var g=f>0;return g&&this[a?"moveStart":"moveEnd"]("character",a?f:-f,{characterOptions:c}),g})}function O(a){return L(function(b,c){var d=!1;return this.changeEachRange(function(b){d=b[a](c)||d}),d})}var P="undefined",Q="character",R="word",S=a.dom,T=a.util,U=T.extend,V=T.createOptions,W=S.getBody,X=/^[ \t\f\r\n]+$/,Y=/^[ \t\f\r]+$/,Z=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,$=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,_="en",aa=a.Selection.isDirectionBackward,ba=!1,ca=!1,da=!1,ea=!0;!function(){var b=S.createTestElement(document,"<p>1 </p><p></p>",!0),c=b.firstChild,d=a.getSelection();d.collapse(c.lastChild,2),d.setStart(c.firstChild,0),ba=1==(""+d).length,b.innerHTML="1 <br />",d.collapse(b,2),d.setStart(b.firstChild,0),ca=1==(""+d).length,b.innerHTML="1 <p>1</p>",d.collapse(b,2),d.setStart(b.firstChild,0),da=1==(""+d).length,S.removeNode(b),d.removeAllRanges()}();var fa,ga={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},ha={includeBlockContentTrailingSpace:!ea,includeSpaceBeforeBr:!ca,includeSpaceBeforeBlock:!da,includePreLineTrailingSpace:!0},ia={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:c}},ja={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},ka={wordOptions:null,characterOptions:null},la={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ma={wordOptions:null,characterOptions:null,direction:"forward"},na=S.getComputedStyleProperty;!function(){var a=document.createElement("table"),b=W(document);b.appendChild(a),fa="block"==na(a,"display"),b.removeChild(a)}();var oa={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};w.prototype={get:function(a){return this.store.hasOwnProperty(a)?this.store[a]:null},set:function(a,b){return this.store[a]=b}};var pa=0,qa=0,ra={getPosition:function(a){var b=this.positions;return b.get(a)||b.set(a,new z(this,a))},toString:function(){return"[NodeWrapper("+S.inspectNode(this.node)+")]"}};y.prototype=ra;var sa="EMPTY",ta="NON_SPACE",ua="UNCOLLAPSIBLE_SPACE",va="COLLAPSIBLE_SPACE",wa="TRAILING_SPACE_BEFORE_BLOCK",xa="TRAILING_SPACE_IN_BLOCK",ya="TRAILING_SPACE_BEFORE_BR",za="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Aa="TRAILING_LINE_BREAK_AFTER_BR",Ba="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";U(ra,{isCharacterDataNode:x("isCharacterDataNode",S.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",S.getNodeIndex,"node"),getLength:x("nodeLength",S.getNodeLength,"node"),containsPositions:x("containsPositions",m,"node"),isWhitespace:x("isWhitespace",s,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",t,"node"),getComputedDisplay:x("computedDisplay",i,"node"),isCollapsed:x("collapsed",u,"node"),isIgnored:x("ignored",v,"node"),next:x("nextPos",q,"node"),previous:x("previous",r,"node"),getTextNodeInfo:x("textNodeInfo",function(a){var b=null,c=!1,d=na(a.parentNode,"whiteSpace"),e="pre-line"==d;return e?(b=Y,c=!0):("normal"==d||"nowrap"==d)&&(b=X,c=!0),{node:a,text:a.data,spaceRegex:b,collapseSpaces:c,preLine:e}},"node"),hasInnerText:x("hasInnerText",function(a,b){for(var c=this.session,d=c.getPosition(a.parentNode,this.getNodeIndex()+1),e=c.getPosition(a,0),f=b?d:e,g=b?e:d;f!==g;){
if(f.prepopulateChar(),f.isDefinitelyNonEmpty())return!0;f=b?f.previousVisible():f.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(a){for(var b=a.getElementsByTagName("br"),c=0,d=b.length;d>c;++c)if(!u(b[c]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(a){if("br"==a.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var b=a.lastChild;b;){if(!v(b))return 1==b.nodeType?this.session.getNodeWrapper(b).getTrailingSpace():"";b=b.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(a){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var Ca={character:"",characterType:sa,isBr:!1,prepopulateChar:function(){var a=this;if(!a.prepopulatedChar){var b=a.node,c=a.offset,d="",e=sa,f=!1;if(c>0)if(3==b.nodeType){var g=b.data,h=g.charAt(c-1),i=a.nodeWrapper.getTextNodeInfo(),j=i.spaceRegex;i.collapseSpaces?j.test(h)?c>1&&j.test(g.charAt(c-2))||(i.preLine&&"\n"===g.charAt(c)?(d=" ",e=za):(d=" ",e=va)):(d=h,e=ta,f=!0):(d=h,e=ua,f=!0)}else{var k=b.childNodes[c-1];if(k&&1==k.nodeType&&!u(k)&&("br"==k.tagName.toLowerCase()?(d="\n",a.isBr=!0,e=va,f=!1):a.checkForTrailingSpace=!0),!d){var l=b.childNodes[c];l&&1==l.nodeType&&!u(l)&&(a.checkForLeadingSpace=!0)}}a.prepopulatedChar=!0,a.character=d,a.characterType=e,a.isCharInvariant=f}},isDefinitelyNonEmpty:function(){var a=this.characterType;return a==ta||a==ua},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var a=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();a&&(this.isTrailingSpace=!0,this.character=a,this.characterType=va),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var b=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();b&&(this.isLeadingSpace=!0,this.character=b,this.characterType=va),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(a){for(var b,c=this;c=c.previousVisible();)if(b=c.getCharacter(a),""!==b)return c;return null},getCharacter:function(a){function b(){return n||(k=o.getPrecedingUncollapsedPosition(a),n=!0),k}this.resolveLeadingAndTrailingSpaces();var c,d=this.character,e=f(a.ignoreCharacters),g=""!==d&&e.indexOf(d)>-1;if(this.isCharInvariant)return c=g?"":d;var h=["character",a.includeSpaceBeforeBr,a.includeBlockContentTrailingSpace,a.includePreLineTrailingSpace,e].join("_"),i=this.cache.get(h);if(null!==i)return i;var j,k,l="",m=this.characterType==va,n=!1,o=this;return m&&(this.type==Ba?l="\n":" "==d&&(!b()||k.isTrailingSpace||"\n"==k.character||" "==k.character&&k.characterType==va)||("\n"==d&&this.isLeadingSpace?b()&&"\n"!=k.character&&(l="\n"):(j=this.nextUncollapsed(),j&&(j.isBr?this.type=ya:j.isTrailingSpace&&"\n"==j.character?this.type=xa:j.isLeadingSpace&&"\n"==j.character&&(this.type=wa),"\n"==j.character?(this.type!=ya||a.includeSpaceBeforeBr)&&(this.type!=wa||a.includeSpaceBeforeBlock)&&(this.type==xa&&j.isTrailingSpace&&!a.includeBlockContentTrailingSpace||(this.type!=za||j.type!=ta||a.includePreLineTrailingSpace)&&("\n"==d?j.isTrailingSpace?this.isTrailingSpace||this.isBr&&(j.type=Aa,b()&&k.isLeadingSpace&&!k.isTrailingSpace&&"\n"==k.character?j.character="":j.type=Ba):l="\n":" "==d&&(l=" "))):l=d)))),e.indexOf(l)>-1&&(l=""),this.cache.set(h,l),l},equals:function(a){return!!a&&this.node===a.node&&this.offset===a.offset},inspect:A,toString:function(){return this.character}};z.prototype=Ca,U(Ca,{next:x("nextPos",function(a){var b=a.nodeWrapper,c=a.node,d=a.offset,e=b.session;if(!c)return null;var f,g,h;return d==b.getLength()?(f=c.parentNode,g=f?b.getNodeIndex()+1:0):b.isCharacterDataNode()?(f=c,g=d+1):(h=c.childNodes[d],e.getNodeWrapper(h).containsPositions()?(f=h,g=0):(f=c,g=d+1)),f?e.getPosition(f,g):null}),previous:x("previous",function(a){var b,c,d,e=a.nodeWrapper,f=a.node,g=a.offset,h=e.session;return 0==g?(b=f.parentNode,c=b?e.getNodeIndex():0):e.isCharacterDataNode()?(b=f,c=g-1):(d=f.childNodes[g-1],h.getNodeWrapper(d).containsPositions()?(b=d,c=S.getNodeLength(d)):(b=f,c=g-1)),b?h.getPosition(b,c):null}),nextVisible:x("nextVisible",function(a){var b=a.next();if(!b)return null;var c=b.nodeWrapper,d=b.node,e=b;return c.isCollapsed()&&(e=c.session.getPosition(d.parentNode,c.getNodeIndex()+1)),e}),nextUncollapsed:x("nextUncollapsed",function(a){for(var b=a;b=b.nextVisible();)if(b.resolveLeadingAndTrailingSpaces(),""!==b.character)return b;return null}),previousVisible:x("previousVisible",function(a){var b=a.previous();if(!b)return null;var c=b.nodeWrapper,d=b.node,e=b;return c.isCollapsed()&&(e=c.session.getPosition(d.parentNode,c.getNodeIndex())),e})});var Da=null,Ea=function(){function a(a){var b=new w;return{get:function(c){var d=b.get(c[a]);if(d)for(var e,f=0;e=d[f++];)if(e.node===c)return e;return null},set:function(c){var d=c.node[a],e=b.get(d)||b.set(d,[]);e.push(c)}}}function b(){this.initCaches()}var c=T.isHostProperty(document.documentElement,"uniqueID");return b.prototype={initCaches:function(){this.elementCache=c?function(){var a=new w;return{get:function(b){return a.get(b.uniqueID)},set:function(b){a.set(b.node.uniqueID,b)}}}():a("tagName"),this.textNodeCache=a("data"),this.otherNodeCache=a("nodeName")},getNodeWrapper:function(a){var b;switch(a.nodeType){case 1:b=this.elementCache;break;case 3:b=this.textNodeCache;break;default:b=this.otherNodeCache}var c=b.get(a);return c||(c=new y(a,this),b.set(c)),c},getPosition:function(a,b){return this.getNodeWrapper(a).getPosition(b)},getRangeBoundaryPosition:function(a,b){var c=b?"start":"end";return this.getPosition(a[c+"Container"],a[c+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},b}();U(S,{nextNode:q,previousNode:r});var Fa=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]===b)return c;return-1};U(a.rangePrototype,{moveStart:M(!0,!1),moveEnd:M(!1,!1),move:M(!0,!0),trimStart:N(!0),trimEnd:N(!1),trim:L(function(a,b){var c=this.trimStart(b),d=this.trimEnd(b);return c||d}),expand:L(function(a,b,c){var d=!1;c=h(c,la);var e=c.characterOptions;if(b||(b=Q),b==R){var f,g,i=c.wordOptions,j=a.getRangeBoundaryPosition(this,!0),k=a.getRangeBoundaryPosition(this,!1),l=F(j,e,i),m=l.nextEndToken(),n=m.chars[0].previousVisible();if(this.collapsed)f=m;else{var o=F(k,e,i);f=o.previousStartToken()}return g=f.chars[f.chars.length-1],n.equals(j)||(this.setStart(n.node,n.offset),d=!0),g&&!g.equals(k)&&(this.setEnd(g.node,g.offset),d=!0),c.trim&&(c.trimStart&&(d=this.trimStart(e)||d),c.trimEnd&&(d=this.trimEnd(e)||d)),d}return this.moveEnd(Q,1,c)}),text:L(function(a,b){return this.collapsed?"":I(a,this,V(b,ga)).join("")}),selectCharacters:L(function(a,b,c,d,e){var f={characterOptions:e};b||(b=W(this.getDocument())),this.selectNodeContents(b),this.collapse(!0),this.moveStart("character",c,f),this.collapse(!0),this.moveEnd("character",d-c,f)}),toCharacterRange:L(function(a,b,c){b||(b=W(this.getDocument()));var d,e,f=b.parentNode,g=S.getNodeIndex(b),h=-1==S.comparePoints(this.startContainer,this.endContainer,f,g),i=this.cloneRange();return h?(i.setStartAndEnd(this.startContainer,this.startOffset,f,g),d=-i.text(c).length):(i.setStartAndEnd(f,g,this.startContainer,this.startOffset),d=i.text(c).length),e=d+this.text(c).length,{start:d,end:e}}),findText:L(function(b,c,d){d=h(d,ja),d.wholeWordsOnly&&(d.wordOptions.includeTrailingSpace=!1);var e=aa(d.direction),f=d.withinRange;f||(f=a.createRange(),f.selectNodeContents(this.getDocument()));var g=c,i=!1;"string"==typeof g?d.caseSensitive||(g=g.toLowerCase()):i=!0;var j=b.getRangeBoundaryPosition(this,!e),k=f.comparePoint(j.node,j.offset);-1===k?j=b.getRangeBoundaryPosition(f,!0):1===k&&(j=b.getRangeBoundaryPosition(f,!1));for(var l,m=j,n=!1;;)if(l=K(m,g,i,f,d)){if(l.valid)return this.setStartAndEnd(l.startPos.node,l.startPos.offset,l.endPos.node,l.endPos.offset),!0;m=e?l.startPos:l.endPos}else{if(!d.wrap||n)return!1;f=f.cloneRange(),m=b.getRangeBoundaryPosition(f,!e),f.setBoundary(j.node,j.offset,e),n=!0}}),pasteHtml:function(a){if(this.deleteContents(),a){var b=this.createContextualFragment(a),c=b.lastChild;this.insertNode(b),this.collapseAfter(c)}}}),U(a.selectionPrototype,{expand:L(function(a,b,c){this.changeEachRange(function(a){a.expand(b,c)})}),move:L(function(a,b,c,d){var e=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var f=this.getRangeAt(0);d||(d={}),d.characterOptions=V(d.characterOptions,ha),e=f.move(b,c,d),this.setSingleRange(f)}return e}),trimStart:O("trimStart"),trimEnd:O("trimEnd"),trim:O("trim"),selectCharacters:L(function(b,c,d,e,f,g){var h=a.createRange(c);h.selectCharacters(c,d,e,g),this.setSingleRange(h,f)}),saveCharacterRanges:L(function(a,b,c){for(var d=this.getAllRanges(),e=d.length,f=[],g=1==e&&this.isBackward(),h=0,i=d.length;i>h;++h)f[h]={characterRange:d[h].toCharacterRange(b,c),backward:g,characterOptions:c};return f}),restoreCharacterRanges:L(function(b,c,d){this.removeAllRanges();for(var e,f,g,h=0,i=d.length;i>h;++h)f=d[h],g=f.characterRange,e=a.createRange(c),e.selectCharacters(c,g.start,g.end,f.characterOptions),this.addRange(e,f.backward)}),text:L(function(a,b){for(var c=[],d=0,e=this.rangeCount;e>d;++d)c[d]=this.getRangeAt(d).text(b);return c.join("")})}),a.innerText=function(b,c){var d=a.createRange(b);d.selectNodeContents(b);var e=d.text(c);return e},a.createWordIterator=function(a,b,c){var d=C();c=h(c,ma);var e=d.getPosition(a,b),f=F(e,c.characterOptions,c.wordOptions),g=aa(c.direction);return{next:function(){return g?f.previousStartToken():f.nextEndToken()},dispose:function(){f.dispose(),this.next=function(){}}}},a.noMutation=function(a){var b=C();a(b),D()},a.noMutation.createEntryPointFunction=L,a.textRange={isBlockNode:l,isCollapsedWhitespaceNode:t,createPosition:L(function(a,b,c){return a.getPosition(b,c)})}}),a},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("SaveRestore",["WrappedRange"],function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=o.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(r)),f.insertNode(c),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),p(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(b,c){var e,f,g=a.DomRange.getRangeDocument(b),h=b.toString(),i=q(c);return b.collapsed?(f=d(b,!1),{document:g,markerId:f.id,collapsed:!0}):(f=d(b,!1),e=d(b,!0),{document:g,startMarkerId:e.id,endMarkerId:f.id,collapsed:!1,backward:i,toString:function(){return"original text: '"+h+"', new text: '"+b.toString()+"'"}})}function h(d,f){var g=d.document;"undefined"==typeof f&&(f=!0);var h=a.createRange(g);if(d.collapsed){var i=c(d.markerId,g);if(i){i.style.display="inline";var j=i.previousSibling;j&&3==j.nodeType?(p(i),h.collapseToPoint(j,j.length)):(h.collapseBefore(i),p(i))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(g,h,d.startMarkerId,!0),e(g,h,d.endMarkerId,!1);return f&&h.normalizeBoundaries(),h}function i(b,d){var e,h,i=[],j=q(d);b=b.slice(0),b.sort(f);for(var k=0,l=b.length;l>k;++k)i[k]=g(b[k],j);for(k=l-1;k>=0;--k)e=b[k],h=a.DomRange.getRangeDocument(e),e.collapsed?e.collapseAfter(c(i[k].markerId,h)):(e.setEndBefore(c(i[k].endMarkerId,h)),e.setStartAfter(c(i[k].startMarkerId,h)));return i}function j(c){if(!a.isSelectionValid(c))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(c),e=d.getAllRanges(),f=1==e.length&&d.isBackward(),g=i(e,f);return f?d.setSingleRange(e[0],f):d.setRanges(e),{win:c,rangeInfos:g,restored:!1}}function k(a){for(var b=[],c=a.length,d=c-1;d>=0;d--)b[d]=h(a[d],!0);return b}function l(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=k(d),g=d.length;1==g&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0}}function m(a,b){var d=c(b,a);d&&p(d)}function n(a){for(var b,c=a.rangeInfos,d=0,e=c.length;e>d;++d)b=c[d],b.collapsed?m(a.doc,b.markerId):(m(a.doc,b.startMarkerId),m(a.doc,b.endMarkerId))}var o=a.dom,p=o.removeNode,q=a.Selection.isDirectionBackward,r="\ufeff";a.util.extend(a,{saveRange:g,restoreRange:h,saveRanges:i,restoreRanges:k,saveSelection:j,restoreSelection:l,removeMarkerElement:m,removeMarkers:n})}),a},this);var Base=function(){};Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},Base.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;Base._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function a(a){return+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function b(a){return+(a.match(/android (\d+)/)||[void 0,0])[1]}function c(a,b){var c,d=-1;return"Microsoft Internet Explorer"==navigator.appName?c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(navigator.userAgent.indexOf("Trident")>-1?c=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(c=/Edge\/(\d+)./i)),c&&null!=c.exec(navigator.userAgent)&&(d=parseFloat(RegExp.$1)),-1===d?!1:a?b?"<"===b?d>a:">"===b?a>d:"<="===b?d>=a:">="===b?a>=d:void 0:a===d:!0}var d=navigator.userAgent,e=document.createElement("div"),f=-1!==d.indexOf("Gecko")&&-1===d.indexOf("KHTML"),g=-1!==d.indexOf("AppleWebKit/"),h=-1!==d.indexOf("Chrome/"),i=-1!==d.indexOf("Opera/");return{USER_AGENT:d,supported:function(){var c=this.USER_AGENT.toLowerCase(),d="contentEditable"in e,f=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,g=document.querySelector&&document.querySelectorAll,h=this.isIos()&&a(c)<5||this.isAndroid()&&b(c)<4||-1!==c.indexOf("opera mobi")||-1!==c.indexOf("hpwos/");return d&&f&&g&&!h},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return c()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return c(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in e},insertsLineBreaksOnReturn:function(){return f},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){return"on"+a in e||function(){return e.setAttribute("on"+a,"return;"),"function"==typeof e["on"+a]}()},supportsEventsInIframeCorrectly:function(){return!i},supportsHTML5Tags:function(a){var b=a.createElement("div"),c="<article>foo</article>";return b.innerHTML=c,b.innerHTML.toLowerCase()===c},supportsCommand:function(){var a={formatBlock:c(10,"<="),insertUnorderedList:c(9,">=")||c(12,"<="),insertOrderedList:c(9,">=")||c(12,"<=")},b={insertHTML:f};return function(c,d){var e=a[d];if(!e){try{return c.queryCommandSupported(d)}catch(f){}try{return c.queryCommandEnabled(d)}catch(g){return!!b[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return c()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return f||i||g},supportsGetAttributeCorrectly:function(){var a=document.createElement("td");return"1"!=a.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return f||c()||i},autoScrollsToCaret:function(){return!g},autoClosesUnclosedTags:function(){var a,b,c=e.cloneNode(!1);return c.innerHTML="<p><div></div>",b=c.innerHTML.toLowerCase(),a="<p></p><div></div>"===b||"<p><div></div></p>"===b,this.autoClosesUnclosedTags=function(){return a},a},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return i},supportsSpeechApiOn:function(a){var b=d.match(/Chrome\/(\d+)/)||[void 0,0];return b[1]>=11&&("onwebkitspeechchange"in a||"speech"in a)},crashesWhenDefineProperty:function(a){return c(9)&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return c(12,">")},hasProblemsSettingCaretAfterImg:function(){return c()},hasUndoInContextMenu:function(){return f||h||i},hasInsertNodeIssue:function(){return i},hasIframeFocusIssue:function(){return c()},createsNestedInvalidMarkupAfterPaste:function(){return g},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!c()},fixStyleKey:function(a){return"cssFloat"===a?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":a}}}(),wysihtml5.lang.array=function(a){return{contains:function(b){if(Array.isArray(b)){for(var c=b.length;c--;)if(-1!==wysihtml5.lang.array(a).indexOf(b[c]))return!0;return!1}return-1!==wysihtml5.lang.array(a).indexOf(b)},indexOf:function(b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},without:function(b){b=wysihtml5.lang.array(b);for(var c=[],d=0,e=a.length;e>d;d++)b.contains(a[d])||c.push(a[d]);return c},get:function(){for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b]);return d},map:function(b,c){if(Array.prototype.map)return a.map(b,c);for(var d=a.length>>>0,e=new Array(d),f=0;d>f;f++)e[f]=b.call(c,a[f],f,a);return e},unique:function(){for(var b=[],c=a.length,d=0;c>d;)wysihtml5.lang.array(b).contains(a[d])||b.push(a[d]),d++;return b}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(a,b){return this.events=this.events||{},this.events[a]=this.events[a]||[],this.events[a].push(b),this},off:function(a,b){this.events=this.events||{};var c,d,e=0;if(a){for(c=this.events[a]||[],d=[];e<c.length;e++)c[e]!==b&&b&&d.push(c[e]);this.events[a]=d}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var c=this.events[a]||[],d=0;d<c.length;d++)c[d].call(this,b);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(a){return{merge:function(b,c){for(var d in b)c&&wysihtml5.lang.object(b[d]).isPlainObject()&&("undefined"==typeof a[d]||wysihtml5.lang.object(a[d]).isPlainObject())?"undefined"==typeof a[d]?a[d]=wysihtml5.lang.object(b[d]).clone(!0):wysihtml5.lang.object(a[d]).merge(wysihtml5.lang.object(b[d]).clone(!0)):a[d]=wysihtml5.lang.object(b[d]).isPlainObject()?wysihtml5.lang.object(b[d]).clone(!0):b[d];return this},difference:function(b){var c={};for(var d in a)a.hasOwnProperty(d)&&(b.hasOwnProperty(d)||(c[d]=a[d]));for(var e in b)b.hasOwnProperty(e)&&(a.hasOwnProperty(e)&&a[e]===b[e]||(c[0]=a[0]));return c},get:function(){return a},clone:function(b){var c,d={};if(null===a||!wysihtml5.lang.object(a).isPlainObject())return a;for(c in a)a.hasOwnProperty(c)&&(b?d[c]=wysihtml5.lang.object(a[c]).clone(b):d[c]=a[c]);return d},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},isPlainObject:function(){return a&&"[object Object]"===Object.prototype.toString.call(a)&&!("Node"in window?a instanceof Node:a instanceof Element||a instanceof Text)},isEmpty:function(){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}}},function(){var a=/^\s+/,b=/\s+$/,c=/[&<>\t"]/g,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(e){return e=String(e),{trim:function(){return e.replace(a,"").replace(b,"")},interpolate:function(a){for(var b in a)e=this.replace("#{"+b+"}").by(a[b]);return e},replace:function(a){return{by:function(b){return e.split(a).join(b)}}},escapeHTML:function(a,b){var f=e.replace(c,function(a){return d[a]});return a&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),b&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(a){function b(a,b){return f(a,b)?a:(a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body),g(a,b))}function c(a){return a.replace(i,function(a,b){var c=(b.match(j)||[])[1]||"",d=l[c];b=b.replace(j,""),b.split(d).length>b.split(c).length&&(b+=c,c="");var e=b,f=b;return b.length>k&&(f=f.substr(0,k)+"..."),"www."===e.substr(0,4)&&(e="http://"+e),'<a href="'+e+'">'+f+"</a>"+c})}function d(a){var b=a._wysihtml5_tempElement;return b||(b=a._wysihtml5_tempElement=a.createElement("div")),b}function e(b){var e=b.parentNode,f=a.lang.string(b.data).escapeHTML(),g=d(e.ownerDocument);for(g.innerHTML="<span></span>"+c(f),g.removeChild(g.firstChild);g.firstChild;)e.insertBefore(g.firstChild,b);e.removeChild(b)}function f(b,c){for(var d;b.parentNode;){if(b=b.parentNode,d=b.nodeName,b.className&&a.lang.array(b.className.split(" ")).contains(c))return!0;if(h.contains(d))return!0;if("body"===d)return!1}return!1}function g(b,c){if(!(h.contains(b.nodeName)||b.className&&a.lang.array(b.className.split(" ")).contains(c))){if(b.nodeType===a.TEXT_NODE&&b.data.match(i))return void e(b);for(var d=a.lang.array(b.childNodes).get(),f=d.length,j=0;f>j;j++)g(d[j],c);return b}}var h=a.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),i=/((https?:\/\/|www\.)[^\s<]{3,})/gi,j=/([^\w\/\-](,?))$/i,k=100,l={")":"(","]":"[","}":"{"};a.dom.autoLink=b,a.dom.autoLink.URL_REG_EXP=i}(wysihtml5),function(a){var b=a.dom;b.addClass=function(a,c){var d=a.classList;return d?d.add(c):void(b.hasClass(a,c)||(a.className+=" "+c))},b.removeClass=function(a,b){var c=a.classList;return c?c.remove(b):void(a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))},b.hasClass=function(a,b){var c=a.classList;if(c)return c.contains(b);var d=a.className;return d.length>0&&(d==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(d))}}(wysihtml5),wysihtml5.dom.contains=function(){var a=document.documentElement;return a.contains?function(a,b){if(b.nodeType!==wysihtml5.ELEMENT_NODE){if(b.parentNode===a)return!0;b=b.parentNode}return a!==b&&a.contains(b)}:a.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:void 0}(),wysihtml5.dom.convertToList=function(){function a(a,b){var c=a.createElement("li");return b.appendChild(c),c}function b(a,b){return a.createElement(b)}function c(c,d,e){if("UL"===c.nodeName||"OL"===c.nodeName||"MENU"===c.nodeName)return c;var f,g,h,i,j,k,l,m,n,o=c.ownerDocument,p=b(o,d),q=c.querySelectorAll("br"),r=q.length;for(n=0;r>n;n++)for(i=q[n];(j=i.parentNode)&&j!==c&&j.lastChild===i;){if("block"===wysihtml5.dom.getStyle("display").from(j)){j.removeChild(i);break}wysihtml5.dom.insert(i).after(i.parentNode)}for(f=wysihtml5.lang.array(c.childNodes).get(),g=f.length,n=0;g>n;n++)m=m||a(o,p),h=f[n],k="block"===wysihtml5.dom.getStyle("display").from(h),l="BR"===h.nodeName,!k||e&&wysihtml5.dom.hasClass(h,e)?l?m=m.firstChild?null:m:m.appendChild(h):(m=m.firstChild?a(o,p):m,m.appendChild(h),m=null);return 0===f.length&&a(o,p),c.parentNode.replaceChild(p,c),p}return c}(),wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var d,e=0,f=a.length;f>e;e++)d=a[e],"undefined"!=typeof b[d]&&""!==b[d]&&(c[d]=b[d]);return{andTo:arguments.callee}}}}}},function(a){var b=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],c=function(b){return d(b)?parseInt(a.getStyle("width").from(b),10)<b.offsetWidth:!1},d=function(c){for(var d=0,e=b.length;e>d;d++)if("border-box"===a.getStyle(b[d]).from(c))return b[d]};a.copyStyles=function(d){return{from:function(e){c(e)&&(d=wysihtml5.lang.array(d).without(b));for(var f,g="",h=d.length,i=0;h>i;i++)f=d[i],g+=f+":"+a.getStyle(f).from(e)+";";return{to:function(b){return a.setStyles(g).on(b),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(a){a.dom.delegate=function(a,b,c,d){var e=function(c){for(var e=c.target,f=3===e.nodeType?e.parentNode:e,g=a.querySelectorAll(b),h=0,i=g.length;i>h;h++)g[h].contains(f)&&d.call(g[h],c)};return a.addEventListener(c,e,!1),{stop:function(){a.removeEventListener(c,e,!1)}}}}(wysihtml5),function(a){function b(a,b){for(var c=[a],d=a;b&&d&&d!==b||!b&&d;)c.unshift(d),d=d.parentNode;return c}function c(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")}a.dom.domNode=function(d){var e=[a.ELEMENT_NODE,a.TEXT_NODE];return{is:{emptyTextNode:function(b){var c=b?/^\s*$/g:/^[\r\n]*$/g;return d.nodeType===a.TEXT_NODE&&c.test(d.data)},visible:function(){var b=!/^\s*$/g.test(a.dom.getTextContent(d));return b||1===d.nodeType&&d.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(b=!0),b}},prev:function(b){var f=d.previousSibling,g=b&&b.nodeTypes?b.nodeTypes:e;return f?c(f)||!a.lang.array(g).contains(f.nodeType)||b&&b.ignoreBlankTexts&&a.dom.domNode(f).is.emptyTextNode(!0)?a.dom.domNode(f).prev(b):f:null},next:function(b){var f=d.nextSibling,g=b&&b.nodeTypes?b.nodeTypes:e;return f?c(f)||!a.lang.array(g).contains(f.nodeType)||b&&b.ignoreBlankTexts&&a.dom.domNode(f).is.emptyTextNode(!0)?a.dom.domNode(f).next(b):f:null},commonAncestor:function(a,c){var e=b(d,c),f=b(a,c);if(e[0]!=f[0])return null;for(var g=0;g<e.length;g++)if(e[g]!=f[g])return e[g-1];return null},lastLeafNode:function(b){var c;if(1!==d.nodeType)return d;if(c=d.lastChild,!c)return d;if(b&&b.leafClasses)for(var e=b.leafClasses.length;e--;)if(a.dom.hasClass(d,b.leafClasses[e]))return d;return a.dom.domNode(c).lastLeafNode(b)},escapeParent:function(b,c){var e,f,g,h=d;if(!a.dom.contains(b,d))throw new Error("Child is not a descendant of node.");do{for(e=h.parentNode,f=e.cloneNode(!1);e.lastChild&&e.lastChild!==h;)f.insertBefore(e.lastChild,f.firstChild);if(e!==b&&(g=e.cloneNode(!1),g.appendChild(h),h=g),e.parentNode.insertBefore(h,e.nextSibling),""!==f.innerHTML)if(/^\s+$/.test(f.innerHTML))for(;f.lastChild;)e.parentNode.insertBefore(f.lastChild,h.nextSibling);else e.parentNode.insertBefore(f,h.nextSibling);if(""===e.innerHTML)e.parentNode.removeChild(e);else if(/^\s+$/.test(e.innerHTML)){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}while(e&&e!==b);c&&h&&(h.parentNode.insertBefore(c,h),c.appendChild(h))},test:function(b){var c;if(!b)return!1;if(1!==d.nodeType)return!1;if(b.query&&!d.matches(b.query))return!1;if(b.nodeName&&d.nodeName.toLowerCase()!==b.nodeName.toLowerCase())return!1;if(b.className&&!d.classList.contains(b.className))return!1;if(b.classRegExp){var e=(d.className||"").match(b.classRegExp)||[];if(0===e.length)return!1}if(b.styleProperty&&b.styleProperty.length>0)for(var f=!1,g=Array.isArray(b.styleProperty)?b.styleProperty:[b.styleProperty],h=0,i=g.length;i>h;h++){if(c=a.browser.fixStyleKey(g[h]),d.style[c]){if(!b.styleValue){f=!0;break}if(b.styleValue instanceof RegExp){if(d.style[c].trim().match(b.styleValue).length>0){f=!0;break}}else if(Array.isArray(b.styleValue)){if(b.styleValue.indexOf(d.style[c].trim())){f=!0;break}}else if(b.styleValue===d.style[c].trim().replace(/, /g,",")){f=!0;break}}if(!f)return!1}if(b.attribute){var j=a.dom.getAttributes(d),k=[],l=!1;Array.isArray(b.attribute)?k=b.attribute:k[b.attribute]=b.attributeValue;for(var m in k)if(k.hasOwnProperty(m))if("undefined"==typeof k[m]){if("undefined"!=typeof j[m]){l=!0;break}}else if(j[m]===k[m]){l=!0;break}if(!l)return!1}return!0}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var a=function(a,b){var c=b.createElement("div");c.style.display="none",b.body.appendChild(c);try{c.innerHTML=a}catch(d){}return b.body.removeChild(c),c},b=function(a){if(!a._wysihtml5_supportsHTML5Tags){for(var b=0,d=c.length;d>b;b++)a.createElement(c[b]);a._wysihtml5_supportsHTML5Tags=!0}},c=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(c,d){d=d||document;var e;return"object"==typeof c&&c.nodeType?(e=d.createElement("div"),e.appendChild(c)):wysihtml5.browser.supportsHTML5Tags(d)?(e=d.createElement("div"),e.innerHTML=c):(b(d),e=a(c,d)),e}}(),wysihtml5.dom.getParentElement=function(){return function(a,b,c,d){for(c=c||50;c--&&a&&"BODY"!==a.nodeName&&(!d||a!==d);){if(wysihtml5.dom.domNode(a).test(b))return a;a=a.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function a(a){return a.replace(c,function(a){return a.charAt(1).toUpperCase()})}var b={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},c=/\-[a-z]/g;return function(c){return{from:function(d){if(d.nodeType===wysihtml5.ELEMENT_NODE){var e=d.ownerDocument,f=b[c]||a(c),g=d.style,h=d.currentStyle,i=g[f];if(i)return i;if(h)try{return h[f]}catch(j){}var k,l,m=e.defaultView||e.parentWindow,n=("height"===c||"width"===c)&&"TEXTAREA"===d.nodeName;return m.getComputedStyle?(n&&(k=g.overflow,g.overflow="hidden"),l=m.getComputedStyle(d,null).getPropertyValue(c),n&&(g.overflow=k||""),l):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(a,b){var c=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b&&/^\s*$/.test(a.innerText||a.textContent)||c.push(a):c=c.concat(wysihtml5.dom.getTextNodes(a,b));return c},wysihtml5.dom.hasElementWithTagName=function(){function a(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=c++)}var b={},c=1;return function(c,d){var e=a(c)+":"+d,f=b[e];return f||(f=b[e]=c.getElementsByTagName(d)),f.length>0}}(),function(a){function b(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=d++)}var c={},d=1;a.dom.hasElementWithClassName=function(d,e){if(!a.browser.supportsNativeGetElementsByClassName())return!!d.querySelector("."+e);var f=b(d)+":"+e,g=c[f];return g||(g=c[f]=d.getElementsByClassName(e)),
g.length>0}}(wysihtml5),wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}},wysihtml5.dom.insertCSS=function(a){return a=a.join("\n"),{into:function(b){var c=b.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(b.createTextNode(a));var d=b.querySelector("head link");if(d)return void d.parentNode.insertBefore(c,d);var e=b.querySelector("head");e&&e.appendChild(c)}}},function(a){a.dom.lineBreaks=function(b){function c(a){return"BR"===a.nodeName}function d(b){return c(b)?!0:"block"===a.dom.getStyle("display").from(b)?!0:!1}return{add:function(c){var e=b.ownerDocument,f=a.dom.domNode(b).next({ignoreBlankTexts:!0}),g=a.dom.domNode(b).prev({ignoreBlankTexts:!0});f&&!d(f)&&a.dom.insert(e.createElement("br")).after(b),g&&!d(g)&&a.dom.insert(e.createElement("br")).before(b)},remove:function(d){var e=a.dom.domNode(b).next({ignoreBlankTexts:!0}),f=a.dom.domNode(b).prev({ignoreBlankTexts:!0});e&&c(e)&&e.parentNode.removeChild(e),f&&c(f)&&f.parentNode.removeChild(f)}}}}(wysihtml5),wysihtml5.dom.observe=function(a,b,c){b="string"==typeof b?[b]:b;for(var d,e,f=0,g=b.length;g>f;f++)e=b[f],a.addEventListener?a.addEventListener(e,c,!1):(d=function(b){"target"in b||(b.target=b.srcElement),b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},c.call(a,b)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=b.length;g>f;f++)e=b[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+e,d)}}},wysihtml5.dom.parse=function(a,b){function c(a,b){wysihtml5.lang.object(t).merge(s).merge(b.rules).get();var c,f,g,h=b.context||a.ownerDocument||document,i=h.createDocumentFragment(),j="string"==typeof a,k=!1;for(b.clearInternals===!0&&(k=!0),c=j?wysihtml5.dom.getAsDom(a,h):a,t.selectors&&e(c,t.selectors);c.firstChild;)g=c.firstChild,f=d(g,b.cleanUp,k,b.uneditableClass),f&&i.appendChild(f),g!==f&&c.removeChild(g);if(b.unjoinNbsps)for(var l=wysihtml5.dom.getTextNodes(i),m=l.length;m--;)l[m].nodeValue=l[m].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return c.innerHTML="",c.appendChild(i),j?wysihtml5.quirks.getCorrectInnerHTML(c):c}function d(a,b,c,e){var f,g,h,i,j=a.nodeType,k=a.childNodes,l=k.length,m=p[j],n=0;if(e&&1===j&&wysihtml5.dom.hasClass(a,e))return a;if(g=m&&m(a,c),!g){if(g===!1){for(f=a.ownerDocument.createDocumentFragment(),n=l;n--;)k[n]&&(h=d(k[n],b,c,e),h&&(k[n]===h&&n--,f.insertBefore(h,f.firstChild)));return i=wysihtml5.dom.getStyle("display").from(a),""===i&&(i=wysihtml5.lang.array(u).contains(a.tagName)?"block":""),wysihtml5.lang.array(["block","flex","table"]).contains(i)&&f.appendChild(a.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(a.nodeName.toLowerCase())&&a.parentNode.lastChild!==a&&(a.nextSibling&&3===a.nextSibling.nodeType&&/^\s/.test(a.nextSibling.nodeValue)||f.appendChild(a.ownerDocument.createTextNode(" "))),f.normalize&&f.normalize(),f}return null}for(n=0;l>n;n++)k[n]&&(h=d(k[n],b,c,e),h&&(k[n]===h&&n--,g.appendChild(h)));if(b&&g.nodeName.toLowerCase()===q&&(!g.childNodes.length||/^\s*$/gi.test(g.innerHTML)&&(c||"_wysihtml5-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className)||!g.attributes.length)){for(f=g.ownerDocument.createDocumentFragment();g.firstChild;)f.appendChild(g.firstChild);return f.normalize&&f.normalize(),f}return g.normalize&&g.normalize(),g}function e(a,b){var c,d,e;for(c in b)if(b.hasOwnProperty(c)){wysihtml5.lang.object(b[c]).isFunction()?d=b[c]:"string"==typeof b[c]&&z[b[c]]&&(d=z[b[c]]),e=a.querySelectorAll(c);for(var f=e.length;f--;)d(e[f])}}function f(a,b){var c,d,e,f=t.tags,h=a.nodeName.toLowerCase(),j=a.scopeName;if(a._wysihtml5)return null;if(a._wysihtml5=1,"wysihtml5-temp"===a.className)return null;if(j&&"HTML"!=j&&(h=j+":"+h),"outerHTML"in a&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(h="div")),h in f){if(c=f[h],!c||c.remove)return null;if(c.unwrap)return!1;c="string"==typeof c?{rename_tag:c}:c}else{if(!a.firstChild)return null;c={rename_tag:q}}if(c.one_of_type&&!g(a,t,c.one_of_type,b)){if(!c.remove_action)return null;if("unwrap"===c.remove_action)return!1;if("rename"!==c.remove_action)return null;e=c.remove_action_rename_to||q}return d=a.ownerDocument.createElement(e||c.rename_tag||h),m(a,d,c,b),i(a,d,c),a=null,d.normalize&&d.normalize(),d}function g(a,b,c,d){var e,f;if("SPAN"===a.nodeName&&!d&&("_wysihtml5-temp-placeholder"===a.className||"rangySelectionBoundary"===a.className))return!0;for(f in c)if(c.hasOwnProperty(f)&&b.type_definitions&&b.type_definitions[f]&&(e=b.type_definitions[f],h(a,e)))return!0;return!1}function h(a,b){var c,d,e,f,g,h=a.getAttribute("class"),i=a.getAttribute("style");if(b.methods)for(var j in b.methods)if(b.methods.hasOwnProperty(j)&&y[j]&&y[j](a))return!0;if(h&&b.classes){h=h.replace(/^\s+/g,"").replace(/\s+$/g,"").split(r),c=h.length;for(var k=0;c>k;k++)if(b.classes[h[k]])return!0}if(i&&b.styles){i=i.split(";");for(d in b.styles)if(b.styles.hasOwnProperty(d))for(var l=i.length;l--;)if(g=i[l].split(":"),g[0].replace(/\s/g,"").toLowerCase()===d&&(b.styles[d]===!0||1===b.styles[d]||wysihtml5.lang.array(b.styles[d]).contains(g[1].replace(/\s/g,"").toLowerCase())))return!0}if(b.attrs)for(e in b.attrs)if(b.attrs.hasOwnProperty(e)&&(f=wysihtml5.dom.getAttribute(a,e),"string"==typeof f&&f.search(b.attrs[e])>-1))return!0;return!1}function i(a,b,c){var d,e;if(c&&c.keep_styles)for(d in c.keep_styles)if(c.keep_styles.hasOwnProperty(d)){if(e="float"===d?a.style.styleFloat||a.style.cssFloat:a.style[d],c.keep_styles[d]instanceof RegExp&&!c.keep_styles[d].test(e))continue;"float"===d?b.style[a.style.styleFloat?"styleFloat":"cssFloat"]=e:a.style[d]&&(b.style[d]=e)}}function j(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&0===d.indexOf(a)&&c.push(d);return c}function k(a,b,c,d){var e,f=wysihtml5.lang.object(c).isFunction()?c:v[c];return f&&(e=f(b,d),"string"==typeof e)?e:!1}function l(a,b){var c,d,e,f=wysihtml5.lang.object(t.attributes||{}).clone(),g=wysihtml5.lang.object(f).merge(wysihtml5.lang.object(b||{}).clone()).get(),h={},i=wysihtml5.dom.getAttributes(a);for(c in g)if(/\*$/.test(c)){e=j(c.slice(0,-1),i);for(var l=0,m=e.length;m>l;l++)d=k(e[l],i[e[l]],g[c],a.nodeName),d!==!1&&(h[e[l]]=d)}else d=k(c,i[c],g[c],a.nodeName),d!==!1&&(h[c]=d);return h}function m(a,b,c,d){var e,f,g,h,i,j={},k=c.set_class,m=c.add_class,n=c.add_style,o=c.set_attributes,p=t.classes,q=0,s=[],u=[],v=[],y=[];if(o&&(j=wysihtml5.lang.object(o).clone()),j=wysihtml5.lang.object(j).merge(l(a,c.check_attributes)).get(),k&&s.push(k),m)for(h in m)i=x[m[h]],i&&(g=i(wysihtml5.dom.getAttribute(a,h)),"string"==typeof g&&s.push(g));if(n)for(h in n)i=w[n[h]],i&&(newStyle=i(wysihtml5.dom.getAttribute(a,h)),"string"==typeof newStyle&&u.push(newStyle));if("string"==typeof p&&"any"===p)if(a.getAttribute("class"))if(t.classes_blacklist){for(y=a.getAttribute("class"),y&&(s=s.concat(y.split(r))),e=s.length;e>q;q++)f=s[q],t.classes_blacklist[f]||v.push(f);v.length&&(j["class"]=wysihtml5.lang.array(v).unique().join(" "))}else j["class"]=a.getAttribute("class");else s&&s.length>0&&(j["class"]=wysihtml5.lang.array(s).unique().join(" "));else{for(d||(p["_wysihtml5-temp-placeholder"]=1,p._rangySelectionBoundary=1,p["wysiwyg-tmp-selected-cell"]=1),y=a.getAttribute("class"),y&&(s=s.concat(y.split(r))),e=s.length;e>q;q++)f=s[q],p[f]&&v.push(f);v.length&&(j["class"]=wysihtml5.lang.array(v).unique().join(" "))}j["class"]&&d&&(j["class"]=j["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(j["class"])&&delete j["class"]),u.length&&(j.style=wysihtml5.lang.array(u).unique().join(" "));for(h in j)try{b.setAttribute(h,j[h])}catch(z){}j.src&&("undefined"!=typeof j.width&&b.setAttribute("width",j.width),"undefined"!=typeof j.height&&b.setAttribute("height",j.height))}function n(a){var b=a.nextSibling;if(!b||b.nodeType!==wysihtml5.TEXT_NODE){var c=a.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"");return a.ownerDocument.createTextNode(c)}b.data=a.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")+b.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")}function o(a){return t.comments?a.ownerDocument.createComment(a.nodeValue):void 0}var p={1:f,3:n,8:o},q="span",r=/\s+/,s={tags:{},classes:{}},t={},u=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],v={url:function(){var a=/^https?:\/\//i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b,c){return b?b.replace(a,""):"IMG"===c?"":null}}(),numbers:function(){var a=/\D/g;return function(b){return b=(b||"").replace(a,""),b||null}}(),dimension:function(){var a=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(b){return b=(b||"").replace(a,"$1$2$3"),b||null}}(),any:function(){return function(a){return a?a:null}}()},w={align_text:function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(b){return a[String(b).toLowerCase()]}}()},x={align_img:function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[String(b).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[String(b).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[String(b).toLowerCase()]}}(),size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[String(b).charAt(0)]}}()},y={has_visible_contet:function(){var a,b=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(c){if(a=(c.innerText||c.textContent).replace(/\s/g,""),a&&a.length>0)return!0;for(var d=b.length;d--;)if(c.querySelector(b[d]))return!0;return c.offsetWidth&&c.offsetWidth>0&&c.offsetHeight&&c.offsetHeight>0?!0:!1}}()},z={unwrap:function(a){wysihtml5.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return c(a,b)},wysihtml5.dom.removeEmptyTextNodes=function(a){for(var b,c=wysihtml5.lang.array(a.childNodes).get(),d=c.length,e=0;d>e;e++)b=c[e],b.nodeType===wysihtml5.TEXT_NODE&&/^[\n\r]*$/.test(b.data)&&b.parentNode.removeChild(b)},wysihtml5.dom.renameElement=function(a,b){for(var c,d=a.ownerDocument.createElement(b);c=a.firstChild;)d.appendChild(c);return wysihtml5.dom.copyAttributes(["align","className"]).from(a).to(d),a.parentNode&&a.parentNode.replaceChild(d,a),d},wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(!a.firstChild)return void a.parentNode.removeChild(a);for(var b=a.ownerDocument.createDocumentFragment();a.firstChild;)b.appendChild(a.firstChild);a.parentNode.replaceChild(b,a),a=b=null}},function(a){function b(b){return"block"===a.getStyle("display").from(b)}function c(a){return"BR"===a.nodeName}function d(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}function e(a,e){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var f,g,h,i,j,k,l,m=a.ownerDocument,n=m.createDocumentFragment(),o=wysihtml5.dom.domNode(a).prev({ignoreBlankTexts:!0}),p=wysihtml5.dom.domNode(a).next({ignoreBlankTexts:!0}),q=a.lastElementChild||a.lastChild;if(e)for(!o||b(o)||c(o)||d(n);k=a.firstElementChild||a.firstChild;){for(g=k.lastChild,l=k===q;f=k.firstChild;)h=f===g,i=(!l||p&&!b(p))&&h&&!b(f)&&!c(f),n.appendChild(f),i&&d(n);k.parentNode.removeChild(k)}else for(;k=a.firstElementChild||a.firstChild;){if(k.querySelector&&k.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;f=k.firstChild;)n.appendChild(f);else{for(j=m.createElement("p");f=k.firstChild;)j.appendChild(f);n.appendChild(j)}k.parentNode.removeChild(k)}a.parentNode.replaceChild(n,a)}}a.resolveList=e}(wysihtml5.dom),function(a){var b=document,c=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],d=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],e=["referrer","write","open","close"];a.dom.Sandbox=Base.extend({constructor:function(b,c){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.editableArea=this._createIframe()},insertInto:function(a){"string"==typeof a&&(a=b.getElementById(a)),a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var c=this,d=b.createElement("iframe");return d.className=this.config.className,a.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(d),a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(d.src="javascript:'<html></html>'"),d.onload=function(){d.onreadystatechange=d.onload=null,c._onLoadIframe(d)},d.onreadystatechange=function(){/loaded|complete/.test(d.readyState)&&(d.onreadystatechange=d.onload=null,c._onLoadIframe(d))},d},_onLoadIframe:function(f){if(a.dom.contains(b.documentElement,f)){var g=this,h=f.contentWindow,i=f.contentWindow.document,j=b.characterSet||b.charset||"utf-8",k=this._getHtml({charset:j,stylesheets:this.config.stylesheets});if(i.open("text/html","replace"),i.write(k),i.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(a,b,c){throw new Error("wysihtml5.Sandbox: "+a,b,c)},!a.browser.supportsSandboxedIframes()){var l,m;for(l=0,m=c.length;m>l;l++)this._unset(h,c[l]);for(l=0,m=d.length;m>l;l++)this._unset(h,d[l],a.EMPTY_FUNCTION);for(l=0,m=e.length;m>l;l++)this._unset(i,e[l]);this._unset(i,"cookie","",!0)}a.polyfills&&a.polyfills(h,i),this.loaded=!0,setTimeout(function(){g.callback(g)},0)}},_getHtml:function(b){var c,d=b.stylesheets,e="",f=0;if(d="string"==typeof d?[d]:d)for(c=d.length;c>f;f++)e+='<link rel="stylesheet" href="'+d[f]+'">';return b.stylesheets=e,a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(b,c,d,e){try{b[c]=d}catch(f){}try{b.__defineGetter__(c,function(){return d})}catch(f){}if(e)try{b.__defineSetter__(c,function(){})}catch(f){}if(!a.browser.crashesWhenDefineProperty(c))try{var g={get:function(){return d}};e&&(g.set=function(){}),Object.defineProperty(b,c,g)}catch(f){}}})}(wysihtml5),function(a){var b=document;a.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(b,c,d){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),d?this.element=this._bindElement(d):this.element=this._createElement()},destroy:function(){},_createElement:function(){var a=b.createElement("div");return a.className=this.config.className,this._loadElement(a),a},_bindElement:function(a){return a.className=a.className?a.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(a,!0),a},_loadElement:function(a,b){var c=this;if(!b){var d=this._getHtml();a.innerHTML=d}this.loaded=!0,setTimeout(function(){c.callback(c)},0)},_getHtml:function(a){return""}})}(wysihtml5),function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var d in b)c.setAttribute(a[d]||d,b[d])}}}}(),wysihtml5.dom.setStyles=function(a){return{on:function(b){var c=b.style;if("string"==typeof a)return void(c.cssText+=";"+a);for(var d in a)"float"===d?(c.cssFloat=a[d],c.styleFloat=a[d]):c[d]=a[d]}}},function(a){a.simulatePlaceholder=function(b,c,d,e){var f=e||"wysihtml5-placeholder",g=function(){var b=c.element.offsetWidth>0&&c.element.offsetHeight>0;c.hasPlaceholderSet()&&(c.clear(),c.element.focus(),b&&setTimeout(function(){var a=c.selection.getSelection();a.focusNode&&a.anchorNode||c.selection.selectNode(c.element.firstChild||c.element)},0)),c.placeholderSet=!1,a.removeClass(c.element,f)},h=function(){c.isEmpty()&&!c.placeholderSet&&(c.placeholderSet=!0,c.setValue(d,!1),a.addClass(c.element,f))};b.on("set_placeholder",h).on("unset_placeholder",g).on("focus:composer",g).on("paste:composer",g).on("blur:composer",h),h()}}(wysihtml5.dom),function(a){var b=document.documentElement;"textContent"in b?(a.setTextContent=function(a,b){a.textContent=b},a.getTextContent=function(a){return a.textContent}):"innerText"in b?(a.setTextContent=function(a,b){a.innerText=b},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,b){a.nodeValue=b},a.getTextContent=function(a){return a.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(a,b){var c=!wysihtml5.browser.supportsGetAttributeCorrectly();b=b.toLowerCase();var d=a.nodeName;if("IMG"==d&&"src"==b&&wysihtml5.dom.isLoadedImage(a)===!0)return a.src;if(c&&"outerHTML"in a){var e=a.outerHTML.toLowerCase(),f=-1!=e.indexOf(" "+b+"=");return f?a.getAttribute(b):null}return a.getAttribute(b)},wysihtml5.dom.getAttributes=function(a){var b,c=!wysihtml5.browser.supportsGetAttributeCorrectly(),d=a.nodeName,e=[];for(b in a.attributes)(a.attributes.hasOwnProperty&&a.attributes.hasOwnProperty(b)||!a.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(a.attributes,b))&&a.attributes[b].specified&&("IMG"==d&&"src"==a.attributes[b].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(a)===!0?e.src=a.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(a.attributes[b].name.toLowerCase())&&c?1!==a.attributes[b].value&&(e[a.attributes[b].name]=a.attributes[b].value):e[a.attributes[b].name]=a.attributes[b].value);return e},wysihtml5.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(b){if(a.complete&&"complete"===a.readyState)return!0}},function(a){function b(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)if(c=a[e].querySelectorAll(b))for(var g=c.length;g--;d.unshift(c[g]));return d}function d(a){a.parentNode.removeChild(a)}function e(a,b){a.parentNode.insertBefore(b,a.nextSibling)}function f(a,b){for(var c=a.nextSibling;1!=c.nodeType;)if(c=c.nextSibling,!b||b==c.tagName.toLowerCase())return c;return null}var g=a.dom,h=function(a){this.el=a,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},i=function(a,b){a?(this.cell=a,this.table=g.getParentElement(a,{query:"table"})):b&&(this.table=b,this.cell=this.table.querySelectorAll("th, td")[0])};i.prototype={addSpannedCellToMap:function(a,b,c,d,e,f){for(var g=[],i=c+(f?parseInt(f,10)-1:0),j=d+(e?parseInt(e,10)-1:0),k=c;i>=k;k++){"undefined"==typeof b[k]&&(b[k]=[]);for(var l=d;j>=l;l++)b[k][l]=new h(a),b[k][l].isColspan=e&&parseInt(e,10)>1,b[k][l].isRowspan=f&&parseInt(f,10)>1,b[k][l].firstCol=l==d,b[k][l].lastCol=l==j,b[k][l].firstRow=k==c,b[k][l].lastRow=k==i,b[k][l].isReal=l==d&&k==c,b[k][l].spanCollection=g,g.push(b[k][l])}},setCellAsModified:function(a){if(a.modified=!0,a.spanCollection.length>0)for(var b=0,c=a.spanCollection.length;c>b;b++)a.spanCollection[b].modified=!0},setTableMap:function(){var a,b,c,d,e,f,i,j,k=[],l=this.getTableRows();for(a=0;a<l.length;a++)for(b=l[a],c=this.getRowCells(b),f=0,"undefined"==typeof k[a]&&(k[a]=[]),d=0;d<c.length;d++){for(e=c[d];"undefined"!=typeof k[a][f];)f++;i=g.getAttribute(e,"colspan"),j=g.getAttribute(e,"rowspan"),i||j?(this.addSpannedCellToMap(e,k,a,f,i,j),f+=i?parseInt(i,10):1):(k[a][f]=new h(e),f++)}return this.map=k,k},getRowCells:function(c){var d=this.table.querySelectorAll("table"),e=d?b(d,"th, td"):[],f=c.querySelectorAll("th, td"),g=e.length>0?a.lang.array(f).without(e):f;return g},getTableRows:function(){var c=this.table.querySelectorAll("table"),d=c?b(c,"tr"):[],e=this.table.querySelectorAll("tr"),f=d.length>0?a.lang.array(e).without(d):e;return f},getMapIndex:function(a){for(var b=this.map.length,c=this.map&&this.map[0]?this.map[0].length:0,d=0;b>d;d++)for(var e=0;c>e;e++)if(this.map[d][e].el===a)return{row:d,col:e};return!1},getElementAtIndex:function(a){return this.setTableMap(),this.map[a.row]&&this.map[a.row][a.col]&&this.map[a.row][a.col].el?this.map[a.row][a.col].el:null},getMapElsTo:function(a){var b=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var c=this.idx_start;this.idx_start=this.idx_end,this.idx_end=c}if(this.idx_start.col>this.idx_end.col){var d=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=d}if(null!=this.idx_start&&null!=this.idx_end)for(var e=this.idx_start.row,f=this.idx_end.row;f>=e;e++)for(var g=this.idx_start.col,h=this.idx_end.col;h>=g;g++)b.push(this.map[e][g].el);return b},orderSelectionEnds:function(a){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var b=this.idx_start;this.idx_start=this.idx_end,this.idx_end=b}if(this.idx_start.col>this.idx_end.col){var c=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=c}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(a,b,c){for(var d,e=this.table.ownerDocument,f=e.createDocumentFragment(),g=0;b>g;g++){if(d=e.createElement(a),c)for(var h in c)c.hasOwnProperty(h)&&d.setAttribute(h,c[h]);d.appendChild(document.createTextNode(" ")),f.appendChild(d)}return f},correctColIndexForUnreals:function(a,b){for(var c=this.map[b],d=-1,e=0;a>e;e++)c[e].isReal&&d++;return d},getLastNewCellOnRow:function(a,b){for(var c,d,e=this.getRowCells(a),f=0,g=e.length;g>f;f++)if(c=e[f],d=this.getMapIndex(c),d===!1||"undefined"!=typeof b&&d.row!=b)return c;return null},removeEmptyTable:function(){var a=this.table.querySelectorAll("td, th");return a&&0!=a.length?!1:(d(this.table),!0)},splitRowToCells:function(a){if(a.isColspan){var b=parseInt(g.getAttribute(a.el,"colspan")||1,10),c=a.el.tagName.toLowerCase();if(b>1){var d=this.createCells(c,b-1);e(a.el,d)}a.el.removeAttribute("colspan")}},getRealRowEl:function(a,b){var c=null,d=null;b=b||this.idx;for(var e=0,f=this.map[b.row].length;f>e;e++)if(d=this.map[b.row][e],d.isReal&&(c=g.getParentElement(d.el,{query:"tr"})))return c;return null===c&&a&&(c=g.getParentElement(this.map[b.row][b.col].el,{query:"tr"})||null),c},injectRowAt:function(a,b,c,d,f){var h=this.getRealRowEl(!1,{row:a,col:b}),i=this.createCells(d,c);if(h){var j=this.correctColIndexForUnreals(b,a);j>=0?e(this.getRowCells(h)[j],i):h.insertBefore(i,h.firstChild)}else{var k=this.table.ownerDocument.createElement("tr");k.appendChild(i),e(g.getParentElement(f.el,{query:"tr"}),k)}},canMerge:function(a){if(this.to=a,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var b=this.idx_start;this.idx_start=this.idx_end,this.idx_end=b}if(this.idx_start.col>this.idx_end.col){var c=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=c}for(var d=this.idx_start.row,e=this.idx_end.row;e>=d;d++)for(var f=this.idx_start.col,g=this.idx_end.col;g>=f;f++)if(this.map[d][f].isColspan||this.map[d][f].isRowspan)return!1;return!0},decreaseCellSpan:function(a,b){var c=parseInt(g.getAttribute(a.el,b),10)-1;c>=1?a.el.setAttribute(b,c):(a.el.removeAttribute(b),"colspan"==b&&(a.isColspan=!1),"rowspan"==b&&(a.isRowspan=!1),a.firstCol=!0,a.lastCol=!0,a.firstRow=!0,a.lastRow=!0,a.isReal=!0)},removeSurplusLines:function(){var a,b,c,e,f,h,i;if(this.setTableMap(),this.map){for(c=0,e=this.map.length;e>c;c++){for(a=this.map[c],i=!0,f=0,h=a.length;h>f;f++)if(b=a[f],!(g.getAttribute(b.el,"rowspan")&&parseInt(g.getAttribute(b.el,"rowspan"),10)>1&&b.firstRow!==!0)){i=!1;break}if(i)for(f=0;h>f;f++)this.decreaseCellSpan(a[f],"rowspan")}var j=this.getTableRows();for(c=0,e=j.length;e>c;c++)a=j[c],0==a.childNodes.length&&/^\s*$/.test(a.textContent||a.innerText)&&d(a)}},fillMissingCells:function(){var a=0,b=0,c=null;if(this.setTableMap(),this.map){a=this.map.length;for(var d=0;a>d;d++)this.map[d].length>b&&(b=this.map[d].length);for(var f=0;a>f;f++)for(var g=0;b>g;g++)this.map[f]&&!this.map[f][g]&&g>0&&(this.map[f][g]=new h(this.createCells("td",1)),c=this.map[f][g-1],c&&c.el&&c.el.parent&&e(this.map[f][g-1].el,this.map[f][g].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var a=this.map[this.idx.row][this.idx.col],b=g.getAttribute(a.el,"colspan")?parseInt(g.getAttribute(a.el,"colspan"),10):1,c=a.el.tagName.toLowerCase();if(a.isRowspan){var d=parseInt(g.getAttribute(a.el,"rowspan"),10);if(d>1)for(var e=1,f=d-1;f>=e;e++)this.injectRowAt(this.idx.row+e,this.idx.col,b,c,a);a.el.removeAttribute("rowspan")}this.splitRowToCells(a)}},merge:function(a){if(this.rectify())if(this.canMerge(a)){for(var b=this.idx_end.row-this.idx_start.row+1,c=this.idx_end.col-this.idx_start.col+1,e=this.idx_start.row,f=this.idx_end.row;f>=e;e++)for(var g=this.idx_start.col,h=this.idx_end.col;h>=g;g++)e==this.idx_start.row&&g==this.idx_start.col?(b>1&&this.map[e][g].el.setAttribute("rowspan",b),c>1&&this.map[e][g].el.setAttribute("colspan",c)):(/^\s*<br\/?>\s*$/.test(this.map[e][g].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[e][g].el.innerHTML),d(this.map[e][g].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(a){var b=this.getMapIndex(a.el),c=b.row+1,d={row:c,col:b.col};if(c<this.map.length){var f=this.getRealRowEl(!1,d);if(null!==f){var h=this.correctColIndexForUnreals(d.col,d.row);if(h>=0)e(this.getRowCells(f)[h],a.el);else{var i=this.getLastNewCellOnRow(f,c);null!==i?e(i,a.el):f.insertBefore(a.el,f.firstChild)}parseInt(g.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")}}},removeRowCell:function(a){a.isReal?a.isRowspan?this.collapseCellToNextRow(a):d(a.el):parseInt(g.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var a=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=this.map[this.idx.row],c=0,d=b.length;d>c;c++)b[c].isReal&&a.push(b[c].el);return a},getColumnElementsByCell:function(){var a=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=0,c=this.map.length;c>b;b++)this.map[b][this.idx.col]&&this.map[b][this.idx.col].isReal&&a.push(this.map[b][this.idx.col].el);return a},removeRow:function(){var a=g.getParentElement(this.cell,{query:"tr"});if(a){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=this.map[this.idx.row],c=0,e=b.length;e>c;c++)b[c].modified||(this.setCellAsModified(b[c]),this.removeRowCell(b[c]));d(a)}},removeColCell:function(a){a.isColspan?parseInt(g.getAttribute(a.el,"colspan"),10)>2?a.el.setAttribute("colspan",parseInt(g.getAttribute(a.el,"colspan"),10)-1):a.el.removeAttribute("colspan"):a.isReal&&d(a.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var a=0,b=this.map.length;b>a;a++)this.map[a][this.idx.col].modified||(this.setCellAsModified(this.map[a][this.idx.col]),this.removeColCell(this.map[a][this.idx.col]))},remove:function(a){if(this.rectify()){switch(a){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(a){var b=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==a&&g.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(g.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var c=this.map[this.idx.row],d=b.createElement("tr"),f=0,h=c.length;h>f;f++)c[f].modified||(this.setCellAsModified(c[f]),this.addRowCell(c[f],d,a));switch(a){case"below":e(this.getRealRowEl(!0),d);break;case"above":var i=g.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});i&&i.parentNode.insertBefore(d,i)}}},addRowCell:function(a,b,d){var e=a.isColspan?{colspan:g.getAttribute(a.el,"colspan")}:null;a.isReal?"above"!=d&&a.isRowspan?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)+1):b.appendChild(this.createCells("td",1,e)):"above"!=d&&a.isRowspan&&a.lastRow?b.appendChild(this.createCells("td",1,e)):c.isRowspan&&a.el.attr("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)+1)},add:function(a){this.rectify()&&(("below"==a||"above"==a)&&this.addRow(a),("before"==a||"after"==a)&&this.addColumn(a))},addColCell:function(a,b,d){var f,h=a.el.tagName.toLowerCase();switch(d){case"before":f=!a.isColspan||a.firstCol;break;case"after":f=!a.isColspan||a.lastCol||a.isColspan&&c.el==this.cell}if(f){switch(d){case"before":a.el.parentNode.insertBefore(this.createCells(h,1),a.el);break;case"after":e(a.el,this.createCells(h,1))}a.isRowspan&&this.handleCellAddWithRowspan(a,b+1,d)}else a.el.setAttribute("colspan",parseInt(g.getAttribute(a.el,"colspan"),10)+1)},addColumn:function(a){var b,c;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==a&&g.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(g.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var d=0,e=this.map.length;e>d;d++)b=this.map[d],b[this.idx.col]&&(c=b[this.idx.col],c.modified||(this.setCellAsModified(c),this.addColCell(c,d,a)))},handleCellAddWithRowspan:function(a,b,c){for(var d,h,i,j=parseInt(g.getAttribute(this.cell,"rowspan"),10)-1,k=g.getParentElement(a.el,{query:"tr"}),l=a.el.tagName.toLowerCase(),m=this.table.ownerDocument,n=0;j>n;n++)if(d=this.correctColIndexForUnreals(this.idx.col,b+n),k=f(k,"tr"))if(d>0)switch(c){case"before":h=this.getRowCells(k),d>0&&this.map[b+n][this.idx.col].el!=h[d]&&d==h.length-1?e(h[d],this.createCells(l,1)):h[d].parentNode.insertBefore(this.createCells(l,1),h[d]);break;case"after":e(this.getRowCells(k)[d],this.createCells(l,1))}else k.insertBefore(this.createCells(l,1),k.firstChild);else i=m.createElement("tr"),i.appendChild(this.createCells(l,1)),
this.table.appendChild(i)}},g.table={getCellsBetween:function(a,b){var c=new i(a);return c.getMapElsTo(b)},addCells:function(a,b){var c=new i(a);c.add(b)},removeCells:function(a,b){var c=new i(a);c.remove(b)},mergeCellsBetween:function(a,b){var c=new i(a);c.merge(b)},unmergeCell:function(a){var b=new i(a);b.unmerge()},orderSelectionEnds:function(a,b){var c=new i(a);return c.orderSelectionEnds(b)},indexOf:function(a){var b=new i(a);return b.setTableMap(),b.getMapIndex(a)},findCell:function(a,b){var c=new i(null,a);return c.getElementAtIndex(b)},findRowByCell:function(a){var b=new i(a);return b.getRowElementsByCell()},findColumnByCell:function(a){var b=new i(a);return b.getColumnElementsByCell()},canMerge:function(a,b){var c=new i(a);return c.canMerge(b)}}}(wysihtml5),wysihtml5.dom.query=function(a,b){var c,d=[];a.nodeType&&(a=[a]);for(var e=0,f=a.length;f>e;e++)if(c=a[e].querySelectorAll(b))for(var g=c.length;g--;d.unshift(c[g]));return d},wysihtml5.dom.compareDocumentPosition=function(){var a=document.documentElement;return a.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)}:function(a,b){var c,d;if(c=9===a.nodeType?a:a.ownerDocument,d=9===b.nodeType?b:b.ownerDocument,a===b)return 0;if(a===b.ownerDocument)return 20;if(a.ownerDocument===b)return 10;if(c!==d)return 1;if(2===a.nodeType&&a.childNodes&&-1!==wysihtml5.lang.array(a.childNodes).indexOf(b))return 20;if(2===b.nodeType&&b.childNodes&&-1!==wysihtml5.lang.array(b.childNodes).indexOf(a))return 10;for(var e=a,f=[],g=null;e;){if(e==b)return 10;f.push(e),e=e.parentNode}for(e=b,g=null;e;){if(e==a)return 20;var h=wysihtml5.lang.array(f).indexOf(e);if(-1!==h){var i=f[h],j=wysihtml5.lang.array(i.childNodes).indexOf(f[h-1]),k=wysihtml5.lang.array(i.childNodes).indexOf(g);return j>k?2:4}g=e,e=e.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(a){var b=[];if(a.parentNode){for(;a.lastChild;)b.unshift(a.lastChild),wysihtml5.dom.insert(a.lastChild).after(a);a.parentNode.removeChild(a)}return b},wysihtml5.dom.getPastedHtml=function(a){var b;return wysihtml5.browser.supportsModernPaste()&&a.clipboardData&&(wysihtml5.lang.array(a.clipboardData.types).contains("text/html")?b=a.clipboardData.getData("text/html"):wysihtml5.lang.array(a.clipboardData.types).contains("text/plain")&&(b=wysihtml5.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),b},wysihtml5.dom.getPastedHtmlWithDiv=function(a,b){var c=a.selection.getBookmark(),d=a.element.ownerDocument,e=d.createElement("DIV"),f=a.getScrollPos();d.body.appendChild(e),e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.style.position="absolute",e.style.top=f.y+"px",e.style.left=f.x+"px",e.setAttribute("contenteditable","true"),e.focus(),setTimeout(function(){var d;a.selection.setBookmark(c),d=e.innerHTML,d&&/^<br\/?>$/i.test(d.trim())&&(d=!1),b(d),e.parentNode.removeChild(e)},0)},wysihtml5.dom.removeInvisibleSpaces=function(a){for(var b=wysihtml5.dom.getTextNodes(a),c=b.length;c--;)b[c].nodeValue=b[c].nodeValue.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")},wysihtml5.quirks.cleanPastedHTML=function(){var a=function(a){var b=wysihtml5.lang.string(a).trim(),c=b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+c+"$).)*$","i")},b=function(b,c){var d,e,f=wysihtml5.lang.object(b).clone(!0);for(d in f.tags)if(f.tags.hasOwnProperty(d)&&f.tags[d].keep_styles)for(e in f.tags[d].keep_styles)f.tags[d].keep_styles.hasOwnProperty(e)&&c[e]&&(f.tags[d].keep_styles[e]=a(c[e]));return f},c=function(a,b){var c;if(!a)return null;for(var d=0,e=a.length;e>d;d++)if(a[d].condition||(c=a[d].set),a[d].condition&&a[d].condition.test(b))return a[d].set;return c};return function(a,d){var e,f={color:wysihtml5.dom.getStyle("color").from(d.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(d.referenceNode)},g=b(c(d.rules,a)||{},f);return e=wysihtml5.dom.parse(a,{rules:g,cleanUp:!0,context:d.referenceNode.ownerDocument,uneditableClass:d.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();("<p>&nbsp;</p>"==b||"<p>&nbsp;</p><p>&nbsp;</p>"==b)&&(a.innerHTML="")},0)};return function(b){wysihtml5.dom.observe(b.element,["cut","keydown"],a)}}(),function(a){var b="%7E";a.quirks.getCorrectInnerHTML=function(c){var d=c.innerHTML;if(-1===d.indexOf(b))return d;var e,f,g,h,i=c.querySelectorAll("[href*='~'], [src*='~']");for(h=0,g=i.length;g>h;h++)e=i[h].href||i[h].src,f=a.lang.string(e).replace("~").by(b),d=a.lang.string(d).replace(f).by(e);return d}}(wysihtml5),function(a){var b="wysihtml5-quirks-redraw";a.quirks.redraw=function(c){a.dom.addClass(c,b),a.dom.removeClass(c,b);try{var d=c.ownerDocument;d.execCommand("italic",!1,null),d.execCommand("italic",!1,null)}catch(e){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(a,b){function c(){return a.addEventListener("mousedown",n),l}function d(c){l.start=c,l.end=c,l.cells=[c],l.table=k.getParentElement(l.start,{query:"table"},!1,a),l.table&&(e(),k.addClass(c,m),a.addEventListener("mousemove",g),a.addEventListener("mouseup",h),b.fire("tableselectstart").fire("tableselectstart:composer"))}function e(){if(a){var b=a.querySelectorAll("."+m);if(b.length>0)for(var c=0;c<b.length;c++)k.removeClass(b[c],m)}}function f(a){for(var b=0;b<a.length;b++)k.addClass(a[b],m)}function g(c){var d,g=null,h=k.getParentElement(c.target,{query:"td, th"},!1,a);h&&l.table&&l.start&&(g=k.getParentElement(h,{query:"table"},!1,a),g&&g===l.table&&(e(),d=l.end,l.end=h,l.cells=k.table.getCellsBetween(l.start,h),l.cells.length>1&&b.composer.selection.deselect(),f(l.cells),l.end!==d&&b.fire("tableselectchange").fire("tableselectchange:composer")))}function h(c){a.removeEventListener("mousemove",g),a.removeEventListener("mouseup",h),b.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){i()},0)}function i(){a.ownerDocument.addEventListener("click",o)}function j(c,d){l.start=c,l.end=d,l.table=k.getParentElement(l.start,{query:"table"},!1,a),selectedCells=k.table.getCellsBetween(l.start,l.end),f(selectedCells),i(),b.fire("tableselect").fire("tableselect:composer")}var k=wysihtml5.dom,l={table:null,start:null,end:null,cells:null,select:j},m="wysiwyg-tmp-selected-cell",n=function(b){var c=wysihtml5.dom.getParentElement(b.target,{query:"td, th"},!1,a);c&&d(c)},o=function(c){a.ownerDocument.removeEventListener("click",o),k.getParentElement(c.target,{query:"table"},!1,a)!=l.table&&(e(),l.table=null,l.start=null,l.end=null,b.fire("tableunselect").fire("tableunselect:composer"))};return c()},function(a){function b(a){var b,c;for(b in d)if(d.hasOwnProperty(b)&&(c=d[b],c.regex.test(a)))return c}function c(a){var c=b(a);return c?c.name:void 0}var d={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},e=function(a){return new RegExp("(^|\\s|;)"+a+"\\s*:\\s*[^;$]+","gi")};a.quirks.styleParser={getColorParseMethod:b,getColorFormat:c,parseColor:function(c,f){var g,h,i,j,k,l=c;if(f){if(g=e(f),!(h=c.match(g)))return!1;h=h.pop().split(":")[1],l=a.lang.string(h).trim()}return(i=b(l))&&(j=l.match(i.regex))?(k=i.radix||10,i===d.hex3?(j.shift(),j.push(1),a.lang.array(j).map(function(a,b){return 3>b?parseInt(a,k)*k+parseInt(a,k):parseFloat(a)})):(j.shift(),j[3]||j.push(1),a.lang.array(j).map(function(a,b){return 3>b?parseInt(a,k):parseFloat(a)}))):!1},unparseColor:function(a,b){var c=16;return"hex"===b?(a[0].toString(c)+a[1].toString(c)+a[2].toString(c)).toUpperCase():"hash"===b?"#"+(a[0].toString(c)+a[1].toString(c)+a[2].toString(c)).toUpperCase():"rgb"===b?"rgb("+a[0]+","+a[1]+","+a[2]+")":"rgba"===b?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"csv"===b?a[0]+","+a[1]+","+a[2]+","+a[3]:a[3]&&1!==a[3]?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"rgb("+a[0]+","+a[1]+","+a[2]+")"},parseFontSize:function(b){var c=b.match(e("font-size"));return c?a.lang.string(c[c.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(a){function b(a){var b=0;if(a.parentNode)do b+=a.offsetTop||0,a=a.offsetParent;while(a);return b}function c(a,b){for(var c=0;b!==a;)if(c++,b=b.parentNode,!b)throw new Error("not a descendant of ancestor!");return c}function d(b){var c=document.createElement("span"),d=function(a){b.removeEventListener("mouseup",d),b.removeEventListener("keydown",d),b.removeEventListener("touchstart",d),b.removeEventListener("focus",d),b.removeEventListener("blur",d),b.removeEventListener("paste",e),b.removeEventListener("drop",e),b.removeEventListener("beforepaste",e),c&&c.parentNode&&c.parentNode.removeChild(c)},e=function(a){c&&c.parentNode&&setTimeout(d,0)};return c.appendChild(document.createTextNode(a.INVISIBLE_SPACE)),c.className="_wysihtml5-temp-caret-fix",c.style.display="block",c.style.minWidth="1px",c.style.height="0px",b.addEventListener("mouseup",d),b.addEventListener("keydown",d),b.addEventListener("touchstart",d),b.addEventListener("focus",d),b.addEventListener("blur",d),b.addEventListener("paste",e),b.addEventListener("drop",e),b.addEventListener("beforepaste",e),c}function e(a){if(!a.canSurroundContents())for(var b=a.commonAncestorContainer,d=c(b,a.startContainer),e=c(b,a.endContainer);!a.canSurroundContents();)d>e?(a.setStartBefore(a.startContainer),d=c(b,a.startContainer)):(a.setEndAfter(a.endContainer),e=c(b,a.endContainer))}var f=a.dom;a.Selection=Base.extend({constructor:function(a,b,c){window.rangy.init(),this.editor=a,this.composer=a.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=b,this.unselectableClass=c||!1},getBookmark:function(){var a=this.getRange();return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);return b.setStartBefore(a),b.setEndBefore(a),this.setSelection(b)},createTemporaryCaretSpaceAfter:function(b){var c=this.doc.createElement("span"),d=this.doc.createTextNode(a.INVISIBLE_SPACE),e=function(b){var d;this.contain.removeEventListener("mouseup",e),this.contain.removeEventListener("keydown",g),this.contain.removeEventListener("touchstart",e),this.contain.removeEventListener("focus",e),this.contain.removeEventListener("blur",e),this.contain.removeEventListener("paste",f),this.contain.removeEventListener("drop",f),this.contain.removeEventListener("beforepaste",f),c&&c.parentNode&&(c.innerHTML=c.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(c.innerHTML)?(d=c.lastChild,a.dom.unwrap(c),this.setAfter(d)):c.parentNode.removeChild(c))}.bind(this),f=function(a){c&&c.parentNode&&setTimeout(e,0)},g=function(a){8===a.which||91===a.which||17===a.which||86===a.which&&(a.ctrlKey||a.metaKey)||e()};return c.className="_wysihtml5-temp-caret-fix",c.style.position="absolute",c.style.display="block",c.style.minWidth="1px",c.style.zIndex="99999",c.appendChild(d),b.parentNode.insertBefore(c,b.nextSibling),this.setBefore(d),this.contain.addEventListener("mouseup",e),this.contain.addEventListener("keydown",g),this.contain.addEventListener("touchstart",e),this.contain.addEventListener("focus",e),this.contain.addEventListener("blur",e),this.contain.addEventListener("paste",f),this.contain.addEventListener("drop",f),this.contain.addEventListener("beforepaste",f),c},setAfter:function(b,c,d){var e,f=this.win,g=rangy.createRange(this.doc),h=function(){var d=b.parentNode,g=d?d.childNodes[d.childNodes.length-1]:null;if(!e||g===b&&1===b.nodeType&&"block"===f.getComputedStyle(b).display)if(c){var h=this.doc.createTextNode(a.INVISIBLE_SPACE);b.parentNode.insertBefore(h,b.nextSibling),this.selectNode(h),setTimeout(function(){h&&h.parentNode&&h.parentNode.removeChild(h)},0)}else this.createTemporaryCaretSpaceAfter(b)}.bind(this);if(g.setStartAfter(b),g.setEndAfter(b),document.activeElement&&document.activeElement===this.composer.element)e=this.setSelection(g),h(),d&&d(e);else{var i=this.composer.getScrollPos();this.composer.element.focus(),this.composer.setScrollPos(i),setTimeout(function(){e=this.setSelection(g),h(),d&&d(e)}.bind(this),0)}},selectNode:function(b,c){var d=rangy.createRange(this.doc),e=b.nodeType===a.ELEMENT_NODE,g="canHaveHTML"in b?b.canHaveHTML:"IMG"!==b.nodeName,h=e?b.innerHTML:b.data,i=""===h||h===a.INVISIBLE_SPACE,j=f.getStyle("display").from(b),k="block"===j||"list-item"===j;if(i&&e&&g&&!c)try{b.innerHTML=a.INVISIBLE_SPACE}catch(l){}g?d.selectNodeContents(b):d.selectNode(b),g&&i&&e?d.collapse(k):g&&i&&(d.setStartAfter(b),d.setEndAfter(b)),this.setSelection(d)},getSelectedNode:function(a){var b,c;return a&&this.doc.selection&&"Control"===this.doc.selection.type&&(c=this.doc.selection.createRange(),c&&c.length)?c.item(0):(b=this.getSelection(this.doc),b.focusNode===b.anchorNode?b.focusNode:(c=this.getRange(this.doc),c?c.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var a=this.getRange();e(a),this.setSelection(a)},getSelectedOwnNodes:function(a){for(var b=this.getOwnRanges(),c=[],d=0,e=b.length;e>d;d++)c.push(b[d].commonAncestorContainer||this.doc.body);return c},findNodesInSelection:function(b){for(var c,d=this.getOwnRanges(),e=[],f=0,g=d.length;g>f;f++)c=d[f].getNodes([1],function(c){return a.lang.array(b).contains(c.nodeName)}),e=e.concat(c);return e},filterElements:function(a){for(var b,c=this.getOwnRanges(),d=[],e=0,f=c.length;f>e;e++)b=c[e].getNodes([1],function(b){return a(b,c[e])}),d=d.concat(b);return d},containsUneditable:function(){for(var a=this.getOwnUneditables(),b=this.getSelection(),c=0,d=a.length;d>c;c++)if(b.containsNode(a[c]))return!0;return!1},deleteContents:function(){var a=this.getRange();this.deleteRangeContents(a),this.setSelection(a)},deleteRangeContents:function(b){var c,d,e,f;if(this.unselectableClass){(c=a.dom.getParentElement(b.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&b.setStartBefore(c),(d=a.dom.getParentElement(b.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&b.setEndAfter(d),e=b.getNodes([1],function(b){return a.dom.hasClass(b,this.unselectableClass)}.bind(this));for(var g=e.length;g--;)try{f=new CustomEvent("wysihtml5:uneditable:delete"),e[g].dispatchEvent(f)}catch(h){}}b.deleteContents()},getPreviousNode:function(b,c){var d;if(!b){var e=this.getSelection();b=e.anchorNode}if(b===this.contain)return!1;var f,g=b.previousSibling;return g===this.contain?!1:(g&&3!==g.nodeType&&1!==g.nodeType?g=this.getPreviousNode(g,c):g&&3===g.nodeType&&/^\s*$/.test(g.textContent)?g=this.getPreviousNode(g,c):c&&g&&1===g.nodeType?(d=a.dom.getStyle("display").from(g),a.lang.array(["BR","HR","IMG"]).contains(g.nodeName)||a.lang.array(["block","inline-block","flex","list-item","table"]).contains(d)||!/^[\s]*$/.test(g.innerHTML)||(g=this.getPreviousNode(g,c))):g||b===this.contain||(f=b.parentNode,f!==this.contain&&(g=this.getPreviousNode(f,c))),g!==this.contain?g:!1)},getSelectionParentsByTag:function(b){for(var c,d=this.getSelectedOwnNodes(),e=[],f=0,g=d.length;g>f;f++)c=d[f].nodeName&&"LI"===d[f].nodeName?d[f]:a.dom.getParentElement(d[f],{query:"li"},!1,this.contain),c&&e.push(c);return e.length?e:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var a=this.getRange(),b=a.startContainer,c=a.startOffset,d=rangy.createRange(this.doc);return d.selectNodeContents(b),d.setStart(b,c),d}},caretIsLastInSelection:function(){var a=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),b=a.textContent;return/^\s*$/.test(b)},caretIsFirstInSelection:function(){var b=rangy.createRange(this.doc),c=this.getSelection(),d=this.getRange(),e=d.startContainer;return e?e.nodeType===a.TEXT_NODE?this.isCollapsed()&&e.nodeType===a.TEXT_NODE&&/^\s*$/.test(e.data.substr(0,d.startOffset)):(b.selectNodeContents(this.getRange().commonAncestorContainer),b.collapse(!0),this.isCollapsed()&&(b.startContainer===c.anchorNode||b.endContainer===c.anchorNode)&&b.startOffset===c.anchorOffset):void 0},caretIsInTheBeginnig:function(b){var c=this.getSelection(),d=c.anchorNode,e=c.anchorOffset;return b&&d?0===e&&(d.nodeName&&d.nodeName===b.toUpperCase()||a.dom.getParentElement(d.parentNode,{query:b},1)):d?0===e&&!this.getPreviousNode(d,!0):void 0},getBeforeSelection:function(b){var c,d,e=this.getSelection(),f=e.isBackwards()?e.focusNode:e.anchorNode,g=e.isBackwards()?e.focusOffset:e.anchorOffset,h=this.createRange();if(d=a.dom.getParentElement(f,{query:"._wysihtml5-temp-caret-fix"},1),d&&(f=d.parentNode,g=Array.prototype.indexOf.call(f.childNodes,d)),f){if(g>0)return 3===f.nodeType?(h.setStart(f,0),h.setEnd(f,g),{type:"text",range:h,offset:g,node:f}):(h.setStartBefore(f.childNodes[0]),c=f.childNodes[g-1],h.setEndAfter(c),{type:"element",range:h,offset:g,node:c});if(h.setStartAndEnd(f,0),b){var i=this.getPreviousNode(f,!0),j=null;if(i&&(j=1===i.nodeType&&a.dom.hasClass(i,this.unselectableClass)?i:a.dom.domNode(i).lastLeafNode()),j)return{type:"leafnode",range:h,offset:g,node:j}}return{type:"none",range:h,offset:g,node:f}}return null},executeAndRestoreRangy:function(a,b){var c=rangy.saveSelection(this.win);if(c)try{a()}catch(d){setTimeout(function(){throw d},0)}else a();rangy.restoreSelection(c)},executeAndRestore:function(b,c){var d,e,g,h,i,j,k,l,m=this.doc.body,n=c&&m.scrollTop,o=c&&m.scrollLeft,p="_wysihtml5-temp-placeholder",q='<span class="'+p+'">'+a.INVISIBLE_SPACE+"</span>",r=this.getRange(!0);if(!r)return void b(m,m);r.collapsed||(k=r.cloneRange(),j=k.createContextualFragment(q),k.collapse(!1),k.insertNode(j),k.detach()),i=r.createContextualFragment(q),r.insertNode(i),j&&(d=this.contain.querySelectorAll("."+p),r.setStartBefore(d[0]),r.setEndAfter(d[d.length-1])),this.setSelection(r);try{b(r.startContainer,r.endContainer)}catch(s){setTimeout(function(){throw s},0)}if(d=this.contain.querySelectorAll("."+p),d&&d.length){l=rangy.createRange(this.doc),g=d[0].nextSibling,d.length>1&&(h=d[d.length-1].previousSibling),h&&g?(l.setStartBefore(g),l.setEndAfter(h)):(e=this.doc.createTextNode(a.INVISIBLE_SPACE),f.insert(e).after(d[0]),l.setStartBefore(e),l.setEndAfter(e)),this.setSelection(l);for(var t=d.length;t--;)d[t].parentNode.removeChild(d[t])}else this.contain.focus();c&&(m.scrollTop=n,m.scrollLeft=o);try{d.parentNode.removeChild(d)}catch(u){}},set:function(a,b){var c=rangy.createRange(this.doc);c.setStart(a,b||0),this.setSelection(c)},insertHTML:function(a){var b,c,d=this.getRange(),e=this.doc.createElement("DIV"),f=this.doc.createDocumentFragment();if(d){for(d.deleteContents(),e.innerHTML=a,b=e.lastChild;e.firstChild;)f.appendChild(e.firstChild);for(d.insertNode(f),c=this.contain.lastChild;c&&3===c.nodeType&&c.previousSibling&&/^\s*$/.test(c.data);)c=c.previousSibling;b&&(c&&b===c&&1===b.nodeType&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(b))}},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},canAppendChild:function(a){var b,c,d=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],e=this.getRange();return b=a||e.startContainer,b&&(c=(b.tagName||b.nodeName).toLowerCase()),-1===d.indexOf(c)},splitElementAtCaret:function(b,c){var d,e,f,g,h,i=this.getSelection();if(i.rangeCount>0){d=i.getRangeAt(0).cloneRange(),d.setEndAfter(b),e=d.extractContents(),h=e.childNodes;for(var j=h.length;j--;)a.dom.domNode(h[j]).is.visible()||e.removeChild(h[j]);b.parentNode.insertBefore(e,b.nextSibling),c?(f=c.firstChild||c,g=c.lastChild||c,b.parentNode.insertBefore(c,b.nextSibling),f&&g&&(d.setStartBefore(f),d.setEndAfter(g),this.setSelection(d))):(d.setStartAfter(b),d.setEndAfter(b)),a.dom.domNode(b).is.visible()||(""===a.dom.getTextContent(b)?b.parentNode.removeChild(b):b.parentNode.replaceChild(this.doc.createTextNode(" "),b))}},surround:function(a){var b,c=this.getOwnRanges(),d=[];if(0==c.length)return d;for(var e=c.length;e--;){b=this.doc.createElement(a.nodeName),d.push(b),a.className&&(b.className=a.className),a.cssStyle&&b.setAttribute("style",a.cssStyle);try{c[e].surroundContents(b),this.selectNode(b)}catch(f){b.appendChild(c[e].extractContents()),c[e].insertNode(b)}}return d},deblockAndSurround:function(b){var c,d,e,f=this.doc.createElement("div"),g=rangy.createRange(this.doc);if(f.className=b.className,this.composer.commands.exec("formatBlock",b),c=this.contain.querySelectorAll("."+b.className),c[0])for(c[0].parentNode.insertBefore(f,c[0]),g.setStartBefore(c[0]),g.setEndAfter(c[c.length-1]),d=g.extractContents();d.firstChild;)if(e=d.firstChild,1==e.nodeType&&a.dom.hasClass(e,b.className)){for(;e.firstChild;)f.appendChild(e.firstChild);"BR"!==e.nodeName&&f.appendChild(this.doc.createElement("br")),d.removeChild(e)}else f.appendChild(e);else f=null;return f},scrollIntoView:function(){var c,d=this.doc,e=5,f=d.documentElement.scrollHeight>d.documentElement.offsetHeight,g=d._wysihtml5ScrollIntoViewElement=d._wysihtml5ScrollIntoViewElement||function(){var b=d.createElement("span");return b.innerHTML=a.INVISIBLE_SPACE,b}();f&&(this.insertNode(g),c=b(g),g.parentNode.removeChild(g),c>=d.body.scrollTop+d.documentElement.offsetHeight-e&&(d.body.scrollTop=c))},selectLine:function(){var b=rangy.createRange();a.browser.supportsSelectionModify()?this._selectLine_W3C():b.nativeRange&&b.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var a=this.getSelection(),b=a.getRangeAt(0),c=function(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")},d=function(a){return 1===a.nodeType?a.childNodes&&a.childNodes.length||0:a.data&&a.data.length||0},e=1===a.anchorNode.nodeType?a.anchorNode.childNodes[a.anchorOffset]:a.anchorNode,f=1===a.focusNode.nodeType?a.focusNode.childNodes[a.focusOffset]:a.focusNode;f&&a.focusOffset===d(f)&&f.nextSibling&&c(f.nextSibling)&&b.setEndAfter(f.nextSibling),e&&0===a.anchorOffset&&e.previousSibling&&c(e.previousSibling)&&b.setStartBefore(e.previousSibling),b.select()},_selectLine_W3C:function(){var a=this.win.getSelection(),b=[a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset];a.modify("move","left","lineboundary"),a.modify("extend","right","lineboundary"),a.anchorNode===b[0]&&a.anchorOffset===b[1]&&a.focusNode===b[2]&&a.focusOffset===b[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function(b,c){if(c="undefined"==typeof c?!1:c,a.browser.supportsSelectionModify()){var d=this.win.getSelection();d.modify("extend",b,"lineboundary"),c&&("left"===b?d.collapseToStart():"right"===b&&d.collapseToEnd())}},getRangeRect:function(a){var b,c=(this.doc.createTextNode("i"),this.doc.createTextNode("i"));return a.collapsed?(a.insertNode(c),a.selectNode(c),b=a.nativeRange.getBoundingClientRect(),a.deleteContents()):b=a.nativeRange.getBoundingClientRect(),b},_selectLineUniversal:function(){var b,c,d,e,f,g,h=this.getSelection(),i=h.getRangeAt(0),j=0,k=this,l=function(b){return b&&1===b.nodeType&&("block"===k.win.getComputedStyle(b).display||a.lang.array(["BR","HR"]).contains(b.nodeName))},m=function(a){var b=a;if(b)for(;b&&(1===b.nodeType&&b.classList.contains("rangySelectionBoundary")||3===b.nodeType&&/^\s*$/.test(b.data));)b=b.previousSibling;return b};c=i.cloneRange(),d=i.cloneRange(),i.collapsed&&(3===i.startContainer.nodeType&&i.startOffset<i.startContainer.data.length?i.moveEnd("character",1):1===i.startContainer.nodeType&&i.startContainer.childNodes[i.startOffset]&&3===i.startContainer.childNodes[i.startOffset].nodeType&&i.startContainer.childNodes[i.startOffset].data.length>0?i.moveEnd("character",1):i.startOffset>0&&(3===i.startContainer.nodeType||1===i.startContainer.nodeType&&!l(m(i.startContainer.childNodes[i.startOffset-1])))&&i.moveStart("character",-1)),i.collapsed||i.insertNode(this.doc.createTextNode(a.INVISIBLE_SPACE)),b=i.nativeRange.getBoundingClientRect();do e=i.moveStart("character",-1),f=i.nativeRange.getBoundingClientRect(),f&&Math.floor(f.top)===Math.floor(b.top)||(i.moveStart("character",1),g=!0),j++;while(0!==e&&!g&&2e3>j);j=0,g=!1,b=i.nativeRange.getBoundingClientRect();do e=i.moveEnd("character",1),f=i.nativeRange.getBoundingClientRect(),f&&Math.floor(f.bottom)===Math.floor(b.bottom)||(i.moveEnd("character",-1),i.endContainer&&1===i.endContainer.nodeType&&i.endContainer.childNodes[i.endOffset]&&1===i.endContainer.childNodes[i.endOffset].nodeType&&"BR"===i.endContainer.childNodes[i.endOffset].nodeName&&i.endContainer.childNodes[i.endOffset].previousSibling&&(1===i.endContainer.childNodes[i.endOffset].previousSibling.nodeType?i.setEnd(i.endContainer.childNodes[i.endOffset].previousSibling,i.endContainer.childNodes[i.endOffset].previousSibling.childNodes.length):3===i.endContainer.childNodes[i.endOffset].previousSibling.nodeType&&i.setEnd(i.endContainer.childNodes[i.endOffset].previousSibling,i.endContainer.childNodes[i.endOffset].previousSibling.data.length)),g=!0),j++;while(0!==e&&!g&&2e3>j);i.select(),this.includeRangyRangeHelpers()},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(a,b){var c=this.getRange();return c?c.getNodes(Array.isArray(a)?a:[a],b):[]},getOwnNodes:function(a,b,c){for(var d=this.getOwnRanges(),e=[],f=0,g=d.length;g>f;f++)d[f]&&(c&&d[f].splitBoundaries(),e=e.concat(d[f].getNodes(Array.isArray(a)?a:[a],b)));return e},fixRangeOverflow:function(a){if(this.contain&&this.contain.firstChild&&a){var b=a.compareNode(this.contain);if(2!==b)1===b&&a.setStartBefore(this.contain.firstChild),0===b&&a.setEndAfter(this.contain.lastChild),3===b&&(a.setStartBefore(this.contain.firstChild),a.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(a)){var c=a.endContainer.previousElementSibling;c&&a.setEnd(c,this._endOffsetForNode(c))}}},_endOffsetForNode:function(a){var b=document.createRange();return b.selectNodeContents(a),b.endOffset},_detectInlineRangeProblems:function(a){var b=f.compareDocumentPosition(a.startContainer,a.endContainer);return 0==a.endOffset&&4&b},getRange:function(a){var b=this.getSelection(),c=b&&b.rangeCount&&b.getRangeAt(0);return a!==!0&&this.fixRangeOverflow(c),c},getOwnUneditables:function(){var b=f.query(this.contain,"."+this.unselectableClass),c=f.query(b,"."+this.unselectableClass);return a.lang.array(b).without(c)},getOwnRanges:function(){var a,b=[],c=this.getRange();if(c&&b.push(c),this.unselectableClass&&this.contain&&c){var d,e=this.getOwnUneditables();if(e.length>0)for(var f=0,g=e.length;g>f;f++){a=[];for(var h=0,i=b.length;i>h;h++){if(b[h])switch(b[h].compareNode(e[f])){case 2:break;case 3:d=b[h].cloneRange(),d.setEndBefore(e[f]),a.push(d),d=b[h].cloneRange(),d.setStartAfter(e[f]),a.push(d);break;default:a.push(b[h])}b=a}}}return b},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(a){var b=rangy.getSelection(this.win);return b.setSingleRange(a),b&&b.anchorNode&&b.focusNode?b:null},selectAll:function(){var b,c=this.createRange(),e=this.composer,f=this,g=d(this.composer.element),h=d(this.composer.element),i=function(){c.setStart(e.element,0),c.setEnd(e.element,e.element.childNodes.length),b=f.setSelection(c)},j=function(){return!b||b.nativeSelection&&b.nativeSelection.type&&("Caret"===b.nativeSelection.type||"None"===b.nativeSelection.type)};a.dom.removeInvisibleSpaces(this.composer.element),i(),this.composer.element.firstChild&&j()&&(this.composer.element.appendChild(g),i(),j()&&(g.parentNode.removeChild(g),this.composer.element.insertBefore(h,this.composer.element.firstChild),i(),j()&&(this.composer.element.appendChild(g),i())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(b){var c=this.getRange(),d=c.commonAncestorContainer,e=c.startContainer,f=c.endContainer;if(d.nodeType===a.TEXT_NODE&&(d=d.parentNode),e.nodeType===a.TEXT_NODE&&!/^\s*$/.test(e.data.substr(c.startOffset)))return!1;if(f.nodeType===a.TEXT_NODE&&!/^\s*$/.test(f.data.substr(c.endOffset)))return!1;for(;e&&e!==d;){if(e.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,e))return!1;if(a.dom.domNode(e).prev({ignoreBlankTexts:!0}))return!1;e=e.parentNode}for(;f&&f!==d;){if(f.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,f))return!1;if(a.dom.domNode(f).next({ignoreBlankTexts:!0}))return!1;f=f.parentNode}return a.lang.array(b).contains(d.nodeName)?d:!1},isInThisEditable:function(){var b=this.getSelection(),c=b.focusNode,d=b.anchorNode;return c&&1!==c.nodeType&&(c=c.parentNode),d&&1!==d.nodeType&&(d=d.parentNode),d&&c&&(a.dom.contains(this.composer.element,c)||this.composer.element===c)&&(a.dom.contains(this.composer.element,d)||this.composer.element===d)},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})}(wysihtml5),function(a,b){function c(a,b,c){if(!a.className)return!1;var d=a.className.match(c)||[];return d[d.length-1]===b}function d(a,b){if(!a.getAttribute||!a.getAttribute("style"))return!1;a.getAttribute("style").match(b);return a.getAttribute("style").match(b)?!0:!1}function e(a,b,c){a.getAttribute("style")?(h(a,c),a.getAttribute("style")&&!/^\s*$/.test(a.getAttribute("style"))?a.setAttribute("style",b+";"+a.getAttribute("style")):a.setAttribute("style",b)):a.setAttribute("style",b)}function f(a,b,c){a.className?(g(a,c),a.className+=" "+b):a.className=b}function g(a,b){a.className&&(a.className=a.className.replace(b,""))}function h(a,b){var c,d=[];if(a.getAttribute("style")){c=a.getAttribute("style").split(";");for(var e=c.length;e--;)c[e].match(b)||/^\s*$/.test(c[e])||d.push(c[e]);d.length?a.setAttribute("style",d.join(";")):a.removeAttribute("style")}}function i(a,b){var c=[],d=b.split(";"),e=a.getAttribute("style");if(e){e=e.replace(/\s/gi,"").toLowerCase(),c.push(new RegExp("(^|\\s|;)"+b.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var f=d.length;f-->0;)/^\s*$/.test(d[f])||c.push(new RegExp("(^|\\s|;)"+d[f].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var g=0,h=c.length;h>g;g++)if(e.match(c[g]))return c[g]}return!1}function j(c,d,e,f){return e?i(c,e):f?a.dom.hasClass(c,f):b.dom.arrayContains(d,c.tagName.toLowerCase())}function k(a,b,c,d){for(var e=a.length;e--;)if(!j(a[e],b,c,d))return!1;return a.length?!0:!1}function l(a,b,c){var d=i(a,b);return d?(h(a,d),"remove"):(e(a,b,c),"change")}function m(a,b){return a.className.replace(u," ")==b.className.replace(u," ")}function n(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a)}function o(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c,d,e,f=0,g=a.attributes.length;g>f;++f)if(c=a.attributes[f],e=c.name,"class"!=e){if(d=b.attributes.getNamedItem(e),c.specified!=d.specified)return!1;if(c.specified&&c.nodeValue!==d.nodeValue)return!1}return!0}function p(a,c){return b.dom.isCharacterDataNode(a)?0==c?!!a.previousSibling:c==a.length?!!a.nextSibling:!0:c>0&&c<a.childNodes.length}function q(a,c,d,e){var f;if(b.dom.isCharacterDataNode(c)&&(0==d?(d=b.dom.getNodeIndex(c),c=c.parentNode):d==c.length?(d=b.dom.getNodeIndex(c)+1,c=c.parentNode):f=b.dom.splitDataNode(c,d)),!(f||e&&c===e)){f=c.cloneNode(!1),f.id&&f.removeAttribute("id");for(var g;g=c.childNodes[d];)f.appendChild(g);b.dom.insertAfter(f,c)}return c==a?f:q(a,f.parentNode,b.dom.getNodeIndex(f),e)}function r(b){this.isElementMerge=b.nodeType==a.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?b.lastChild:b,this.textNodes=[this.firstTextNode]}function s(a,b,c,d,e,f,g){this.tagNames=a||[t],this.cssClass=b||(b===!1?!1:""),this.similarClassRegExp=c,this.cssStyle=e||"",this.similarStyleRegExp=f,this.normalize=d,this.applyToAnyTagName=!1,this.container=g}var t="span",u=/\s+/g;
r.prototype={doMerge:function(){for(var a,b,c,d=[],e=0,f=this.textNodes.length;f>e;++e)a=this.textNodes[e],b=a.parentNode,d[e]=a.data,e&&(b.removeChild(a),b.hasChildNodes()||b.parentNode.removeChild(b));return this.firstTextNode.data=c=d.join(""),c},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;c>b;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}},s.prototype={getAncestorWithClass:function(d){for(var e;d;){if(e=this.cssClass?c(d,this.cssClass,this.similarClassRegExp):""!==this.cssStyle?!1:!0,d.nodeType==a.ELEMENT_NODE&&"false"!=d.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,d.tagName.toLowerCase())&&e)return d;d=d.parentNode}return!1},getAncestorWithStyle:function(c){for(var e;c;){if(e=this.cssStyle?d(c,this.similarStyleRegExp):!1,c.nodeType==a.ELEMENT_NODE&&"false"!=c.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&e)return c;c=c.parentNode}return!1},getMatchingAncestor:function(a){var b=this.getAncestorWithClass(a),c=!1;return b?this.cssStyle&&(c="class"):(b=this.getAncestorWithStyle(a),b&&(c="style")),{element:b,type:c}},postApply:function(a,b){for(var c,d,e,f=a[0],g=a[a.length-1],h=[],i=f,j=g,k=0,l=g.length,m=0,n=a.length;n>m;++m)d=a[m],e=null,d&&d.parentNode&&(e=this.getAdjacentMergeableTextNode(d.parentNode,!1)),e?(c||(c=new r(e),h.push(c)),c.textNodes.push(d),d===f&&(i=c.firstTextNode,k=i.length),d===g&&(j=c.firstTextNode,l=c.getLength())):c=null;if(g&&g.parentNode){var o=this.getAdjacentMergeableTextNode(g.parentNode,!0);o&&(c||(c=new r(g),h.push(c)),c.textNodes.push(o))}if(h.length){for(m=0,n=h.length;n>m;++m)h[m].doMerge();b.setStart(i,k),b.setEnd(j,l)}},getAdjacentMergeableTextNode:function(b,c){var d,e=b.nodeType==a.TEXT_NODE,f=e?b.parentNode:b,g=c?"nextSibling":"previousSibling";if(e){if(d=b[g],d&&d.nodeType==a.TEXT_NODE)return d}else if(d=f[g],d&&this.areElementsMergeable(b,d))return d[c?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,c){return b.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&b.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())&&m(a,c)&&o(a,c)},createContainer:function(a){var b=a.createElement(this.tagNames[0]);return this.cssClass&&(b.className=this.cssClass),this.cssStyle&&b.setAttribute("style",this.cssStyle),b},applyToTextNode:function(a){var c=a.parentNode;if(1==c.childNodes.length&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase()))this.cssClass&&f(c,this.cssClass,this.similarClassRegExp),this.cssStyle&&e(c,this.cssStyle,this.similarStyleRegExp);else{var d=this.createContainer(b.dom.getDocument(a));a.parentNode.insertBefore(d,a),d.appendChild(a)}},isRemovable:function(c){return b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&""===a.lang.string(c.className).trim()&&(!c.getAttribute("style")||""===a.lang.string(c.getAttribute("style")).trim())},undoToTextNode:function(a,b,c,d){var e=c?!1:!0,f=c||d,h=!1;if(!b.containsNode(f)){var i=b.cloneRange();i.selectNode(f),i.isPointInRange(b.endContainer,b.endOffset)&&p(b.endContainer,b.endOffset)&&(q(f,b.endContainer,b.endOffset,this.container),b.setEndAfter(f)),i.isPointInRange(b.startContainer,b.startOffset)&&p(b.startContainer,b.startOffset)&&(f=q(f,b.startContainer,b.startOffset,this.container))}!e&&this.similarClassRegExp&&g(f,this.similarClassRegExp),e&&this.similarStyleRegExp&&(h="change"===l(f,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(f)&&!h&&n(f)},applyToRange:function(b){for(var c,d=b.length;d--;){if(c=b[d].getNodes([a.TEXT_NODE]),!c.length)try{var e=this.createContainer(b[d].endContainer.ownerDocument);return b[d].surroundContents(e),void this.selectNode(b[d],e)}catch(f){}if(b[d].splitBoundaries(),c=b[d].getNodes([a.TEXT_NODE]),c.length){for(var g,h=0,i=c.length;i>h;++h)g=c[h],this.getMatchingAncestor(g).element||this.applyToTextNode(g);b[d].setStart(c[0],0),g=c[c.length-1],b[d].setEnd(g,g.length),this.normalize&&this.postApply(c,b[d])}}},undoToRange:function(b){for(var c,d,e,f=b.length;f--;){if(c=b[f].getNodes([a.TEXT_NODE]),c.length)b[f].splitBoundaries(),c=b[f].getNodes([a.TEXT_NODE]);else{var g=b[f].endContainer.ownerDocument,h=g.createTextNode(a.INVISIBLE_SPACE);b[f].insertNode(h),b[f].selectNode(h),c=[h]}for(var i=0,j=c.length;j>i;++i)b[f].isValid()&&(d=c[i],e=this.getMatchingAncestor(d),"style"===e.type?this.undoToTextNode(d,b[f],!1,e.element):e.element&&this.undoToTextNode(d,b[f],e.element));1==j?this.selectNode(b[f],c[0]):(b[f].setStart(c[0],0),d=c[c.length-1],b[f].setEnd(d,d.length),this.normalize&&this.postApply(c,b[f]))}},selectNode:function(b,c){var d=c.nodeType===a.ELEMENT_NODE,e="canHaveHTML"in c?c.canHaveHTML:!0,f=d?c.innerHTML:c.data,g=""===f||f===a.INVISIBLE_SPACE;if(g&&d&&e)try{c.innerHTML=a.INVISIBLE_SPACE}catch(h){}b.selectNodeContents(c),g&&d?b.collapse(!1):g&&(b.setStartAfter(c),b.setEndAfter(c))},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b),e=d?d.toString():"";return c.detach(),e},isAppliedToRange:function(b){for(var c,d,e=[],f="full",g=b.length;g--;){if(d=b[g].getNodes([a.TEXT_NODE]),!d.length)return c=this.getMatchingAncestor(b[g].startContainer).element,c?{elements:[c],coverage:f}:!1;for(var h,i=0,j=d.length;j>i;++i)h=this.getTextSelectedByRange(d[i],b[g]),c=this.getMatchingAncestor(d[i]).element,c&&""!=h?(e.push(c),1===a.dom.getTextNodes(c,!0).length?f="full":"full"===f&&(f="inline")):c||(f="partial")}return e.length?{elements:e,coverage:f}:!1},toggleRange:function(a){var b,c=this.isAppliedToRange(a);c?"full"===c.coverage?this.undoToRange(a):"inline"===c.coverage?(b=k(c.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(a),b||this.applyToRange(a)):(k(c.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(a),this.applyToRange(a)):this.applyToRange(a)}},a.selection.HTMLApplier=s}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.exec,f=null;if(this.composer.hasPlaceholderSet()&&!wysihtml5.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(a)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),e)d.unshift(this.composer),f=e.apply(c,d);else try{f=this.doc.execCommand(a,!1,b)}catch(g){}return this.editor.fire("aftercommand:composer"),f},remove:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.remove;return e?(d.unshift(this.composer),e.apply(c,d)):void 0},state:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.state;if(e)return d.unshift(this.composer),e.apply(c,d);try{return this.doc.queryCommandState(a)}catch(f){return!1}},stateValue:function(a){var b=wysihtml5.commands[a],c=wysihtml5.lang.array(arguments).get(),d=b&&b.stateValue;return d?(c.unshift(this.composer),d.apply(b,c)):!1}}),function(a){var b={nodeName:"B",toggle:!0};a.commands.bold={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){function b(b){return a.lang.object({}).merge(c).merge({attribute:b}).get()}var c={nodeName:"A",toggle:!1};a.commands.createLink={exec:function(c,d,e){var f=b(e);if(c.selection.isCollapsed()&&!this.state(c,d)){var g=c.doc.createTextNode(f.attribute.href);c.selection.insertNode(g),c.selection.selectNode(g)}a.commands.formatInline.exec(c,d,f)},state:function(b,d){return a.commands.formatInline.state(b,d,c)}}}(wysihtml5),function(a){var b={nodeName:"A"};a.commands.removeLink={exec:function(c,d){a.commands.formatInline.remove(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(c,d,e){a.commands.formatInline.exec(c,d,{className:"wysiwyg-font-size-"+e,classRegExp:b,toggle:!0})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{className:"wysiwyg-font-size-"+d})}}}(wysihtml5),function(a){a.commands.fontSizeStyle={exec:function(b,c,d){d=d.size||d,/^\s*$/.test(d)||a.commands.formatInline.exec(b,c,{styleProperty:"fontSize",styleValue:d,toggle:!1})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{styleProperty:"fontSize",styleValue:d||void 0})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"fontSize"})},stateValue:function(b,c){var d,e=this.state(b,c);return e&&a.lang.object(e).isArray()&&(e=e[0]),e&&(d=e.getAttribute("style"))?a.quirks.styleParser.parseFontSize(d):!1}}}(wysihtml5),function(a){var b=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(c,d,e){a.commands.formatInline.exec(c,d,{className:"wysiwyg-color-"+e,classRegExp:b,toggle:!0})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{className:"wysiwyg-color-"+d})}}}(wysihtml5),function(a){a.commands.foreColorStyle={exec:function(b,c,d){var e,f;d&&(e=a.quirks.styleParser.parseColor("color:"+(d.color||d),"color"),e&&(f=(1===e[3]?"rgb("+[e[0],e[1],e[2]].join(", "):"rgba("+e.join(", "))+")",a.commands.formatInline.exec(b,c,{styleProperty:"color",styleValue:f})))},state:function(b,c,d){var e,f=d?a.quirks.styleParser.parseColor("color:"+(d.color||d),"color"):null;return f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")"),a.commands.formatInline.state(b,c,{styleProperty:"color",styleValue:e})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"color"})},stateValue:function(b,c,d){var e,f=this.state(b,c),g=!1;return f&&a.lang.object(f).isArray()&&(f=f[0]),f&&(e=f.getAttribute("style"))?(g=a.quirks.styleParser.parseColor(e,"color"),a.quirks.styleParser.unparseColor(g,d)):!1}}}(wysihtml5),function(a){a.commands.bgColorStyle={exec:function(b,c,d){var e,f=a.quirks.styleParser.parseColor("background-color:"+(d.color||d),"background-color");f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")",a.commands.formatInline.exec(b,c,{styleProperty:"backgroundColor",styleValue:e}))},state:function(b,c,d){var e,f=d?a.quirks.styleParser.parseColor("background-color:"+(d.color||d),"background-color"):null;return f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")"),a.commands.formatInline.state(b,c,{styleProperty:"backgroundColor",styleValue:e})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"backgroundColor"})},stateValue:function(b,c,d){var e,f=this.state(b,c),g=!1;return f&&a.lang.object(f).isArray()&&(f=f[0]),f&&(e=f.getAttribute("style"))?(g=a.quirks.styleParser.parseColor(e,"background-color"),a.quirks.styleParser.unparseColor(g,d)):!1}}}(wysihtml5),function(a){function b(a){return{nodeName:a.nodeName||null,className:a.classRegExp?null:a.className||null,classRegExp:a.classRegExp||null,styleProperty:a.styleProperty||null}}function c(a,b){return 3===a.nodeType?a:a.childNodes[b]||a}function d(a){return a&&1===a.nodeType&&"BR"===a.nodeName}function e(a,b){return a&&1===a.nodeType&&"block"===b.win.getComputedStyle(a).display}function f(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")}function g(a,b){return d(a)||e(a,b)}function h(b,c){a.dom.removeInvisibleSpaces(b.element);for(var d,e=b.element,f=e.querySelectorAll(D),g=b.config.classNames.uneditableContainer+[""].concat(D.split(",")).join(", "+b.config.classNames.uneditableContainer+" "),h=e.querySelectorAll(g),i=a.lang.array(f).without(h),j=i.length;j--;)""===i[j].innerHTML.replace(/[\uFEFF]/g,"")&&(d=a.lang.array(c).indexOf(i[j]),d>-1&&c.splice(d,1),i[j].parentNode.removeChild(i[j]));return c}function i(a){return a.config.useLineBreaks?"DIV":"P"}function j(a,b,c){for(var d=a,e=null;d&&b&&d!==b;)1===d.nodeType&&d.matches(c?D:C)&&(e=d),d=d.parentNode;return e}function k(a,b){for(var c,d,e,f=a,g=null;f&&b&&f!==b;)1===f.nodeType&&f.matches(E)&&(d=f,null===g?(g=f.cloneNode(!1),c=g):(e=f.cloneNode(!1),e.appendChild(g),g=e)),f=f.parentNode;return{parent:d,outerNode:g,innerNode:c}}function l(b,c,d){return b||(b=d.doc.createElement(c.nodeName||i(d)),b.appendChild(d.doc.createTextNode(a.INVISIBLE_SPACE))),c.nodeName&&b.nodeName!==c.nodeName&&(b=B.renameElement(b,c.nodeName)),c.classRegExp&&(b.className=b.className.replace(c.classRegExp,"")),c.className&&b.classList.add(c.className),c.styleProperty&&"undefined"!=typeof c.styleValue&&(b.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue),b}function m(b,c,d){var e,f=b.previousSibling,g=b.nextSibling,h=!1;c.styleProperty&&(b.style[a.browser.fixStyleKey(c.styleProperty)]=""),c.className&&b.classList.remove(c.className),c.classRegExp&&(b.className=b.className.replace(c.classRegExp,"")),null!==b.getAttribute("class")&&""===b.getAttribute("class").trim()&&b.removeAttribute("class"),c.nodeName&&b.nodeName.toLowerCase()===c.nodeName.toLowerCase()&&(e=b.getAttribute("style"),e&&""!==e.trim()?b=B.renameElement(b,i(d)):(B.unwrap(b),h=!0)),null!==b.getAttribute("style")&&""===b.getAttribute("style").trim()&&b.removeAttribute("style"),h&&u(f,g,d)}function n(b){for(var c,d,e=b.querySelectorAll(D)||[],f=e.length;f--;)c=a.dom.domNode(e[f]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),d=a.dom.domNode(e[f]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(e[f].innerHTML||e[f].nodeValue||"").trim()&&e[f].parentNode.insertBefore(e[f].ownerDocument.createElement("BR"),c),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(e[f].innerHTML||e[f].nodeValue||"").trim()&&e[f].parentNode.insertBefore(e[f].ownerDocument.createElement("BR"),c),a.dom.unwrap(e[f])}function o(a,b){var c,d=a.startContainer,e=a.endContainer;return d&&1===d.nodeType&&d===e?void(d.firstChild===d.lastChild&&1===a.endOffset&&d!==b.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&(a.setStartBefore(d),a.setEndAfter(e))):d&&1===d.nodeType&&3===e.nodeType?void(d.firstChild===e&&a.endOffset===e.data.length&&d!==b.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&a.setEndAfter(d)):e&&1===e.nodeType&&3===d.nodeType?void(e.firstChild===d&&0===a.startOffset&&e!==b.element&&"LI"!==e.nodeName&&"TD"!==e.nodeName&&a.setStartBefore(e)):d&&3===d.nodeType&&d===e&&1===d.parentNode.childNodes.length?void(a.endOffset==e.data.length&&0===a.startOffset&&(c=d.parentNode,c!==b.element&&"LI"!==c.nodeName&&"TD"!==c.nodeName&&(a.setStartBefore(c),a.setEndAfter(c)))):void 0}function p(b){for(var c,d,e,f,g,h,i=[],j=0,k=b.length;k>j;j++)if(1===b[j].startContainer.nodeType&&b[j].startContainer.matches("ul, ol")&&b[j].setStart(b[j].startContainer.childNodes[b[j].startOffset],0),1===b[j].endContainer.nodeType&&b[j].endContainer.matches("ul, ol")&&(h=b[j].endContainer.childNodes[Math.max(b[j].endOffset-1,0)],h.childNodes&&b[j].setEnd(h,h.childNodes.length)),c=b[j].getNodes([1],function(a){return"LI"===a.nodeName}),c.length>0){for(d=0,e=c.length;e>d;d++)g=b[j].compareNode(c[d]),(g===b[j].NODE_AFTER||g===b[j].NODE_INSIDE)&&(f=b[j].cloneRange(),h=a.dom.domNode(c[d]).prev({nodeTypes:[1]}),h?f.setEnd(h,h.childNodes.length):c[d].closest("ul, ol")?f.setEndBefore(c[d].closest("ul, ol")):f.setEndBefore(c[d]),i.push(f),b[j].setStart(c[d],0)),(g===b[j].NODE_BEFORE||g===b[j].NODE_INSIDE)&&(f=b[j].cloneRange(),f.setEnd(c[d],c[d].childNodes.length),i.push(f),h=a.dom.domNode(c[d]).next({nodeTypes:[1]}),h?b[j].setStart(h,0):c[d].closest("ul, ol")?b[j].setStartAfter(c[d].closest("ul, ol")):b[j].setStartAfter(c[d]));i.push(b[j])}else i.push(b[j]);return i}function q(b,c,d){var e=b?a.lang.object(b).clone(!0):null;return e&&(e.nodeName=e.nodeName||c||i(d)),e}function r(b,c,d,e){var f,h,i,l,m,n=c.startContainer,e=e||j(n,d.element,!0);if(e)h=b.firstChild,i=b.lastChild,d.selection.splitElementAtCaret(e,b),m=a.dom.domNode(i).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),l=a.dom.domNode(h).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),h&&!g(h,d)&&l&&!g(l,d)&&h.parentNode.insertBefore(d.doc.createElement("br"),h),i&&!g(i,d)&&m&&!g(m,d)&&m.parentNode.insertBefore(d.doc.createElement("br"),m);else if(f=k(n,d.element),f.outerNode&&f.innerNode&&f.parent){if(1===b.childNodes.length){for(;b.firstChild.firstChild;)f.innerNode.appendChild(b.firstChild.firstChild);b.firstChild.appendChild(f.outerNode)}d.selection.splitElementAtCaret(f.parent,b)}else c.insertNode(b)}function s(b,d,e){for(var f,h,i=b.cloneRange(),j=c(i.startContainer,i.startOffset).previousSibling,k=c(i.endContainer,i.endOffset).nextSibling,l=i.extractContents(),m=e.doc.createDocumentFragment(),o=!0;l.firstChild;){if(1===l.firstChild.nodeType&&l.firstChild.matches(D)){n(l.firstChild),f=a.dom.unwrap(l.firstChild),f.length>0&&(m.lastChild&&(1!==m.lastChild.nodeType||!g(m.lastChild,e))||!m.lastChild&&j&&(1!==j.nodeType||g(j,e)))&&m.appendChild(e.doc.createElement("BR"));for(var p=0,q=f.length;q>p;p++)m.appendChild(f[p]);f.length>0&&(1===m.lastChild.nodeType&&g(m.lastChild,e)||(k||m.lastChild!==l.lastChild)&&m.appendChild(e.doc.createElement("BR")))}else m.appendChild(l.firstChild);o=!1}return h=a.lang.array(m.childNodes).get(),r(m,i,e),h}function t(b,c,e){var f=b&&a.dom.domNode(b).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});d(c)&&c.parentNode.removeChild(c),!d(b)||f&&1===f.nodeType&&"block"===e.win.getComputedStyle(f).display||b.parentNode.removeChild(b)}function u(a,b,c){var e;a&&f(a)&&(a=a.previousSibling),b&&f(b)&&(b=b.nextSibling),e=a&&a.previousSibling,a&&(1!==a.nodeType||"block"!==c.win.getComputedStyle(a).display&&!d(a))&&a.parentNode&&a.parentNode.insertBefore(c.doc.createElement("br"),a.nextSibling),b&&(1!==b.nodeType||"block"!==c.win.getComputedStyle(b).display)&&b.parentNode&&b.parentNode.insertBefore(c.doc.createElement("br"),b)}function v(d,e,f,g){var h,i,k=e?b(e):null,m=d.cloneRange(),o=m.startContainer,p=a.dom.domNode(c(m.startContainer,m.startOffset)).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),s=a.dom.domNode(c(m.endContainer,m.endOffset)).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),u=m.extractContents(),v=g.doc.createDocumentFragment(),w=k?a.dom.getParentElement(o,k,null,g.element):null,x=!f||!e||"BLOCKQUOTE"===e.nodeName&&"BLOCKQUOTE"===f,y=w||j(o,g.element,x);if(e&&"BLOCKQUOTE"===e.nodeName){var z=l(null,e,g);z.appendChild(u),v.appendChild(z),i=[z]}else{if(u.firstChild)for(;u.firstChild;)if(1==u.firstChild.nodeType&&u.firstChild.matches(D))l(u.firstChild,e,g),u.firstChild.matches(C)&&n(u.firstChild),v.appendChild(u.firstChild);else{for(h=l(null,q(e,f,g),g);u.firstChild&&(1!==u.firstChild.nodeType||!u.firstChild.matches(D));)1==u.firstChild.nodeType&&h.matches(C)&&n(u.firstChild),h.appendChild(u.firstChild);v.appendChild(h)}else v.appendChild(l(null,e,g));i=a.lang.array(v.childNodes).get()}return r(v,m,g,y),t(p,s,g),i}function w(b,c){var d=a.dom.getParentElement(b,{query:D},null,c.element);return d?d.nodeName:null}function x(b,c){var d,e=a.dom.getParentElement(b.selection.getOwnRanges()[0].startContainer,{query:C+", "+(c?c.toLowerCase():"div")},null,b.element);e?(d=b.selection.createRange(),d.selectNode(e),b.selection.setSelection(d)):b.isEmpty()||b.selection.selectLine()}function y(a,b){var c=b.selection.createRange(),d=a[a.length-1],e=1===d.nodeType&&d.childNodes?0|d.childNodes.length:d.length||0;c.setStart(a[0],0),c.setEnd(d,e),c.select()}function z(a,b,c){var d,e=b.selection.getOwnRanges(),f=[];e=p(e);for(var g=e.length;g--;)o(e[g],b),d=w(e[g].startContainer,b),f="remove"===a?f.concat(s(e[g],d,b)):f.concat(v(e[g],c,d,b));return f}function A(a){return"string"==typeof a&&(a={nodeName:a.toUpperCase()}),a}var B=a.dom,C="h1, h2, h3, h4, h5, h6, p, pre",D="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",E="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u";a.commands.formatBlock={exec:function(a,b,c){c=A(c);var d,e,f=[];if(c&&c.toggle&&(e=this.state(a,b,c)),e){d=rangy.saveSelection(a.win);for(var g=0,i=e.length;i>g;g++)m(e[g],c,a)}else a.selection.isCollapsed()&&(d=rangy.saveSelection(a.win),x(a,c&&c.nodeName?c.nodeName.toUpperCase():void 0)),f=c?z("apply",a,c):z("remove",a);f=h(a,f),d?rangy.restoreSelection(d):y(f,a)},remove:function(a,b,c){c=A(c);var d,e;a.selection.isCollapsed()&&(e=rangy.saveSelection(a.win),x(a,c&&c.nodeName?c.nodeName.toUpperCase():void 0)),d=z("remove",a),d=h(a,d),e?rangy.restoreSelection(e):y(d,a)},state:function(b,c,d){d=A(d);for(var e,f=b.selection.filterElements(function(b){return a.dom.domNode(b).test(d||{query:D})}.bind(this)),g=b.selection.getSelectedOwnNodes(),h=0,i=g.length;i>h;h++)e=B.getParentElement(g[h],d||{query:D},null,b.element),e&&-1===f.indexOf(e)&&f.push(e);return 0===f.length?!1:f}}}(wysihtml5),function(a){a.commands.formatCode={exec:function(b,c,d){var e,f,g,h=this.state(b)[0];h?b.selection.executeAndRestore(function(){e=h.querySelector("code"),a.dom.replaceWithChildNodes(h),e&&a.dom.replaceWithChildNodes(e)}):(f=b.selection.getRange(),g=f.extractContents(),h=b.doc.createElement("pre"),e=b.doc.createElement("code"),d&&(e.className=d),h.appendChild(e),e.appendChild(g),f.insertNode(h),b.selection.selectNode(h))},state:function(b){var c,d=b.selection.getSelectedNode();return d&&d.nodeName&&"PRE"==d.nodeName&&d.firstChild&&d.firstChild.nodeName&&"CODE"==d.firstChild.nodeName?[d]:(c=a.dom.getParentElement(d,{query:"pre code"}),c?[c.parentNode]:!1)}}}(wysihtml5),function(a){function b(a){return/^\s*$/.test(a.className)}function c(a){return!a.getAttribute("style")||/^\s*$/.test(a.getAttribute("style"))}function d(b){var c=a.dom.getAttributes(b);return a.lang.object(c).isEmpty()}function e(b,c){var d,e,f,g;return 1!==b.nodeType||1!==c.nodeType?!1:b.nodeName!==c.nodeName?!1:(d=b.className.trim().replace(/\s+/g," ").split(" "),e=c.className.trim().replace(/\s+/g," ").split(" "),a.lang.array(d).without(e).length>0?!1:(f=a.dom.getAttributes(b),g=a.dom.getAttributes(c),f.length===g.length&&a.lang.object(a.lang.object(f).difference(g)).isEmpty()?!0:!1))}function f(b,c){var d=c&&c.nodeName||F,e=b.ownerDocument.createElement(d);if(c.classRegExp&&(e.className=e.className.replace(c.classRegExp,"")),c.className&&e.classList.add(c.className),c.styleProperty&&"undefined"!=typeof c.styleValue&&(e.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue),c.attribute)if("object"==typeof c.attribute)for(var f in c.attribute)c.attribute.hasOwnProperty(f)&&e.setAttribute(f,c.attribute[f]);else"undefined"!=typeof c.attributeValue&&e.setAttribute(c.attribute,c.attributeValue);return e}function g(a,b){for(var c in a)if(a.hasOwnProperty(c)&&(void 0===typeof b[c]||b[c]!==a[c]))return!1;return!0}function h(b,c,d){var e,f=a.dom.getAttributes(b),h=g(c,f);a.lang.object(f).difference(c);if(h&&d!==!1)for(e in c)c.hasOwnProperty(e)&&b.removeAttribute(e);else for(e in c)c.hasOwnProperty(e)&&b.setAttribute(e,c[e])}function i(e,f){var g,i,j;f.className&&(f.toggle!==!1&&e.classList.contains(f.className)?e.classList.remove(f.className):(f.classRegExp&&(e.className=e.className.replace(f.classRegExp,"")),e.classList.add(f.className)),b(e)&&e.removeAttribute("class")),f.styleProperty&&(f.toggle!==!1&&e.style[a.browser.fixStyleKey(f.styleProperty)].trim().replace(/, /g,",")===f.styleValue?e.style[a.browser.fixStyleKey(f.styleProperty)]="":e.style[a.browser.fixStyleKey(f.styleProperty)]=f.styleValue),c(e)&&e.removeAttribute("style"),f.attribute&&("object"==typeof f.attribute?g=f.attribute:(g={},g[f.attribute]=f.attributeValue||""),h(e,g,f.toggle)),i=f.nodeName?H[f.nodeName.toLowerCase()]||f.nodeName.toLowerCase():null,j=i?a.dom.domNode(e).test({query:i}):!1,(!f.nodeName||f.nodeName===F||j)&&(f.toggle!==!1&&j||!f.nodeName&&e.nodeName===F)&&b(e)&&c(e)&&d(e)&&a.dom.unwrap(e)}function j(b,c){var d=[];return b.isCollapsed()||(d=d.concat(b.getOwnNodes([3],function(b){return!a.dom.domNode(b).is.emptyTextNode()},c))),d}function k(a,b,c,d){var e=a,f=d?b:l(b);do{if(1===e.nodeType&&m(e,f))return e;e=e.parentNode}while(e&&e!==c);return null}function l(a){return{nodeName:a.nodeName||null,className:a.classRegExp?null:a.className||null,classRegExp:a.classRegExp||null,styleProperty:a.styleProperty||null}}function m(b,c){var d;if(c.nodeName){var e=H[c.nodeName.toLowerCase()]||c.nodeName.toLowerCase();return a.dom.domNode(b).test({query:e})}return d=a.lang.object(c).clone(),d.query=G,a.dom.domNode(b).test(d)}function n(b,c){var d=document.documentElement||document.body,e=d.scrollTop,f=d.scrollLeft;rangy.getSelection(b.win);rangy.getSelection(b.win).removeAllRanges();try{rangy.getSelection(b.win).addRange(c)}catch(g){}b.doc.activeElement&&a.dom.contains(b.element,b.doc.activeElement)||(b.element.focus(),d.scrollTop=e,d.scrollLeft=f,rangy.getSelection(b.win).addRange(c))}function o(a,b){var c=rangy.createRange(b.doc),d=a[a.length-1];a[0]&&d&&(c.setStart(a[0],0),c.setEnd(d,d.length),n(b,c))}function p(a,b,c,d){var e=rangy.createRange(a.doc);b&&(e.setStart(b,c),e.setEnd(b,"undefined"!=typeof d?d:c),n(a,e))}function q(a,b,c){var d,e,f,g=j(a.selection),h=[],i=!1;if(a.selection.isInThisEditable()){if(0===g.length&&a.selection.isCollapsed()){if(f=a.selection.getSelection().anchorNode,!f)return{nodes:[],partial:!1};3===f.nodeType&&(g=[f])}g.length||(e=a.selection.getOwnRanges()[0],e&&(g=[e.endContainer]));for(var l=0,m=g.length;m>l;l++)d=k(g[l],b,a.element,c),d?h.push(d):i=!0}return{nodes:h,partial:i}}function r(a){var b,c,d,e;return a&&(b=a.anchorNode,c=a.anchorOffset,b&&3===b.nodeType&&c>0&&c<b.data.length)?(d=b.data[c-1],e=b.data[c],/\w/.test(d)&&/\w/.test(e)):!1}function s(b){var c,d,e,f,g,h,i=[];if(b&&(c=b.anchorNode,d=g=h=b.anchorOffset,e=c.ownerDocument,f=rangy.createRange(e),c&&3===c.nodeType)){for(;g>0&&/\w/.test(c.data[g-1]);)g--;for(;h<c.data.length&&/\w/.test(c.data[h]);)h++;return f.setStartAndEnd(c,g,h),f.splitBoundaries(),i=f.getNodes([3],function(b){return!a.dom.domNode(b).is.emptyTextNode()}),{wordOffset:d-g,range:f,textNode:i[0]}}return!1}function t(a,b){for(;b.firstChild;)a.appendChild(b.firstChild);b.parentNode.removeChild(b)}function u(a){for(var b=a.length;b--;)a[b]&&a[b].parentNode&&(a[b].nextSibling&&e(a[b],a[b].nextSibling)&&t(a[b],a[b].nextSibling),a[b].previousSibling&&e(a[b],a[b].previousSibling)&&t(a[b].previousSibling,a[b]))}function v(a,b,c){b.length>0&&o(b,a),u(q(a,c).nodes),b.length>0&&o(b,a)}function w(a,b,c,d){p(a,b,c),u(q(a,d).nodes),p(a,b,c)}function x(a,b){var c=f(a,b);a.parentNode.insertBefore(c,a),c.appendChild(a)}function y(b,c,d){var e,f=c.element,g=k(b,d,f);g&&(e=g.cloneNode(!1),a.dom.domNode(b).escapeParent(g,e),i(e,d))}function z(b,c,d){var e=c.element,f=k(b,d,e);f&&a.dom.domNode(b).escapeParent(f)}function A(a,b,c){var d=f(a.endContainer,c);a.surroundContents(d),b.selection.selectNode(d)}function B(b,c,d,e){var f,g,h,j,l=q(b,e,!0),m=b.selection.getSelection();if(c.length){if(l.partial||e.toggle===!1)for(j=c.length;j--;)k(c[j],e,b.element)&&y(c[j],b,e),k(c[j],e,b.element)||x(c[j],e);else for(j=c.length;j--;)y(c[j],b,e);v(b,c,e)}else if(e.toggle!==!1)if(r(m))f=s(m),g=f.textNode,y(f.textNode,b,e),w(b,f.textNode,f.wordOffset,e);else{g=b.doc.createTextNode(a.INVISIBLE_SPACE),h=d.nodes[0].cloneNode(!1),h.appendChild(g),b.selection.splitElementAtCaret(d.nodes[0],h),i(h,e),v(b,[g],e);var n=b.selection.getSelection();if(n.anchorNode&&n.focusNode)try{n.collapseToEnd()}catch(o){}}else for(j=d.nodes.length;j--;)i(d.nodes[j],e)}function C(b,c,d,e){var f,g,h,i=b.selection.getSelection();if(c.length){for(h=c.length;h--;)z(c[h],b,e);v(b,c,e)}else{for(f=i.anchorNode,g=i.anchorOffset,h=d.nodes.length;h--;)a.dom.unwrap(d.nodes[h]);w(b,f,g,e)}}function D(a,b,c){var d,e,f=a.selection.getSelection();if(b.length){for(e=b.length;e--;)x(b[e],c);v(a,b,c)}else if(r(f))d=s(f),x(d.textNode,c),w(a,d.textNode,d.wordOffset,c);else{var g=a.selection.getOwnRanges()[0];g&&A(g,a,c)}}function E(a){return a="string"==typeof a?{nodeName:a}:a,a.nodeName&&(a.nodeName=a.nodeName.toUpperCase()),a}var F="SPAN",G="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",H={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};a.commands.formatInline={exec:function(a,b,c){c=E(c),a.element.normalize();var d=j(a.selection,!0),e=q(a,c);e.nodes.length>0?B(a,d,e,c):D(a,d,c),a.element.normalize()},remove:function(a,b,c){c=E(c),a.element.normalize();var d=j(a.selection,!0),e=q(a,c);e.nodes.length>0&&C(a,d,e,c),a.element.normalize()},state:function(a,b,c){c=E(c);var d=q(a,c,!0).nodes;return 0===d.length?!1:d}}}(wysihtml5),function(a){var b={nodeName:"BLOCKQUOTE",toggle:!0};a.commands.insertBlockQuote={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){a.commands.insertHTML={exec:function(a,b,c){a.selection.insertHTML(c)},state:function(){return!1}}}(wysihtml5),function(a){var b="IMG";a.commands.insertImage={exec:function(c,d,e){e="object"==typeof e?e:{src:e};var f,g,h=c.doc,i=this.state(c);if(i&&!e.src)return c.selection.setBefore(i),g=i.parentNode,g.removeChild(i),a.dom.removeEmptyTextNodes(g),"A"!==g.nodeName||g.firstChild||(c.selection.setAfter(g),g.parentNode.removeChild(g)),void a.quirks.redraw(c.element);if(i)for(var j in e)e.hasOwnProperty(j)&&i.setAttribute("className"===j?"class":j,e[j]);else{i=h.createElement(b);for(var k in e)i.setAttribute("className"===k?"class":k,e[k]);c.selection.insertNode(i),a.browser.hasProblemsSettingCaretAfterImg()?(f=h.createTextNode(a.INVISIBLE_SPACE),c.selection.insertNode(f),c.selection.setAfter(f)):c.selection.setAfter(i)}},state:function(c){var d,e,f,g=c.doc;return a.dom.hasElementWithTagName(g,b)&&(d=c.selection.getSelectedNode())?d.nodeName===b?d:d.nodeType!==a.ELEMENT_NODE?!1:(e=c.selection.getText(),(e=a.lang.string(e).trim())?!1:(f=c.selection.getNodes(a.ELEMENT_NODE,function(a){return"IMG"===a.nodeName}),1!==f.length?!1:f[0])):!1}}}(wysihtml5),function(a){var b="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(a,c){a.selection.insertHTML(b)},state:function(){return!1}}}(wysihtml5),function(a){a.commands.insertOrderedList={exec:function(b,c){a.commands.insertList.exec(b,c,"OL")},state:function(b,c){return a.commands.insertList.state(b,c,"OL")}}}(wysihtml5),function(a){a.commands.insertUnorderedList={exec:function(b,c){a.commands.insertList.exec(b,c,"UL")},state:function(b,c){return a.commands.insertList.state(b,c,"UL")}}}(wysihtml5),wysihtml5.commands.insertList=function(a){var b=function(a,b){if(a&&a.nodeName){"string"==typeof b&&(b=[b]);for(var c=b.length;c--;)if(a.nodeName===b[c])return!0}return!1},c=function(c,d,e){var f={el:null,other:!1};if(c){var g=a.dom.getParentElement(c,{query:"li"},!1,e.element),h="UL"===d?"OL":"UL";b(c,d)?f.el=c:b(c,h)?f={el:c,other:!0}:g&&(b(g.parentNode,d)?f.el=g.parentNode:b(g.parentNode,h)&&(f={el:g.parentNode,other:!0}))}return f.el&&!e.element.contains(f.el)&&(f.el=null),f},d=function(b,c,d){var e,g,h="UL"===c?"OL":"UL";d.selection.executeAndRestoreRangy(function(){if(e=f(h,d),e.length)for(var i=e.length;i--;)a.dom.renameElement(e[i],c.toLowerCase());else{g=f(["OL","UL"],d);for(var j=g.length;j--;)a.dom.resolveList(g[j],d.config.useLineBreaks);a.dom.resolveList(b,d.config.useLineBreaks)}})},e=function(b,c,d){var e="UL"===c?"OL":"UL";d.selection.executeAndRestoreRangy(function(){for(var g=[b].concat(f(e,d)),h=g.length;h--;)a.dom.renameElement(g[h],c.toLowerCase())})},f=function(a,c){for(var d=c.selection.getOwnRanges(),e=[],f=d.length;f--;)e=e.concat(d[f].getNodes([1],function(c){return b(c,a)}));return e},g=function(b,c){var d;c.selection.isCollapsed()||(d=rangy.saveSelection(c.win));var e,f,g="_wysihtml5-temp-"+(new Date).getTime(),h=c.selection.deblockAndSurround({nodeName:"div",
className:g});h.innerHTML=h.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,""),h&&(e=/^(\s|(<br>))+$/i.test(h.innerHTML),f=a.dom.convertToList(h,b.toLowerCase(),c.parent.config.classNames.uneditableContainer),d&&rangy.restoreSelection(d),e&&c.selection.selectNode(f.querySelector("li"),!0))};return{exec:function(a,b,f){var h=a.doc,i="OL"===f?"insertOrderedList":"insertUnorderedList",j=a.selection.getSelectedNode(),k=c(j,f,a);k.el?k.other?e(k.el,f,a):d(k.el,f,a):a.commands.support(i)?h.execCommand(i,!1,null):g(f,a)},state:function(a,b,d){var e=a.selection.getSelectedNode(),f=c(e,d,a);return f.el&&!f.other?f.el:!1}}}(wysihtml5),function(a){var b={nodeName:"I",toggle:!0};a.commands.italic={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyCenter={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyLeft={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyRight={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyFull={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"right",toggle:!0};a.commands.alignRightStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"left",toggle:!0};a.commands.alignLeftStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"center",toggle:!0};a.commands.alignCenterStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"justify",toggle:!0};a.commands.alignJustifyStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){a.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}}}(wysihtml5),function(a){var b={nodeName:"U",toggle:!0};a.commands.underline={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){a.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}}}(wysihtml5),function(a){a.commands.createTable={exec:function(a,b,c){var d,e,f;if(c&&c.cols&&c.rows&&parseInt(c.cols,10)>0&&parseInt(c.rows,10)>0){for(f=c.tableStyle?'<table style="'+c.tableStyle+'">':"<table>",f+="<tbody>",e=0;e<c.rows;e++){for(f+="<tr>",d=0;d<c.cols;d++)f+="<td><br></td>";f+="</tr>"}f+="</tbody></table>",a.commands.exec("insertHTML",f)}},state:function(a,b){return!1}}}(wysihtml5),function(a){a.commands.mergeTableCells={exec:function(b,c){b.tableSelection&&b.tableSelection.start&&b.tableSelection.end&&(this.state(b,c)?a.dom.table.unmergeCell(b.tableSelection.start):a.dom.table.mergeCellsBetween(b.tableSelection.start,b.tableSelection.end))},state:function(b,c){if(b.tableSelection){var d=b.tableSelection.start,e=b.tableSelection.end;if(d&&e&&d==e&&(a.dom.getAttribute(d,"colspan")&&parseInt(a.dom.getAttribute(d,"colspan"),10)>1||a.dom.getAttribute(d,"rowspan")&&parseInt(a.dom.getAttribute(d,"rowspan"),10)>1))return[d]}return!1}}}(wysihtml5),function(a){a.commands.addTableCells={exec:function(b,c,d){if(b.tableSelection&&b.tableSelection.start&&b.tableSelection.end){var e=a.dom.table.orderSelectionEnds(b.tableSelection.start,b.tableSelection.end);"before"==d||"above"==d?a.dom.table.addCells(e.start,d):("after"==d||"below"==d)&&a.dom.table.addCells(e.end,d),setTimeout(function(){b.tableSelection.select(e.start,e.end)},0)}},state:function(a,b){return!1}}}(wysihtml5),function(a){a.commands.deleteTableCells={exec:function(b,c,d){if(b.tableSelection&&b.tableSelection.start&&b.tableSelection.end){var e,f=a.dom.table.orderSelectionEnds(b.tableSelection.start,b.tableSelection.end),g=a.dom.table.indexOf(f.start),h=b.tableSelection.table;a.dom.table.removeCells(f.start,d),setTimeout(function(){e=a.dom.table.findCell(h,g),e||("row"==d&&(e=a.dom.table.findCell(h,{row:g.row-1,col:g.col})),"column"==d&&(e=a.dom.table.findCell(h,{row:g.row,col:g.col-1}))),e&&b.tableSelection.select(e,e)},0)}},state:function(a,b){return!1}}}(wysihtml5),function(a){a.commands.indentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return d?this.tryToPushLiLevel(d,a.selection):!1},state:function(a,b){return!1},tryToPushLiLevel:function(b,c){var d,e,f,g,h,i=!1;return c.executeAndRestoreRangy(function(){for(var c=b.length;c--;)g=b[c],d="OL"===g.parentNode.nodeName?"OL":"UL",e=g.ownerDocument.createElement(d),f=a.dom.domNode(g).prev({nodeTypes:[a.ELEMENT_NODE]}),h=f?f.querySelector("ul, ol"):null,f&&(h?h.appendChild(g):(e.appendChild(g),f.appendChild(e)),i=!0)}),i}}}(wysihtml5),function(a){a.commands.outdentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return d?this.tryToPullLiLevel(d,a):!1},state:function(a,b){return!1},tryToPullLiLevel:function(b,c){var d,e,f,g,h,i=!1,j=this;return c.selection.executeAndRestoreRangy(function(){for(var k=b.length;k--;)if(g=b[k],g.parentNode&&(d=g.parentNode,"OL"===d.tagName||"UL"===d.tagName)){if(i=!0,e=a.dom.getParentElement(d.parentNode,{query:"ol, ul"},!1,c.element),f=a.dom.getParentElement(d.parentNode,{query:"li"},!1,c.element),e&&f)g.nextSibling&&(h=j.getAfterList(d,g),g.appendChild(h)),e.insertBefore(g,f.nextSibling);else{g.nextSibling&&(h=j.getAfterList(d,g),g.appendChild(h));for(var l=g.childNodes.length;l--;)d.parentNode.insertBefore(g.childNodes[l],d.nextSibling);d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),g.parentNode.removeChild(g)}0===d.childNodes.length&&d.parentNode.removeChild(d)}}),i},getAfterList:function(a,b){for(var c=a.nodeName,d=document.createElement(c);b.nextSibling;)d.appendChild(b.nextSibling);return d}}}(wysihtml5),function(a){var b={nodeName:"SUB",toggle:!0};a.commands.subscript={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b={nodeName:"SUP",toggle:!0};a.commands.superscript={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b=90,c=89,d=8,e=46,f=25,g="data-wysihtml5-selection-node",h="data-wysihtml5-selection-offset",i=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",a.dom);a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var a,f=this;this.composer.sandbox.getDocument();i.observe(this.element,"keydown",function(a){if(!a.altKey&&(a.ctrlKey||a.metaKey)){var d=a.keyCode,e=d===b&&!a.shiftKey,g=d===b&&a.shiftKey||d===c;e?(f.undo(),a.preventDefault()):g&&(f.redo(),a.preventDefault())}}),i.observe(this.element,"keydown",function(b){var c=b.keyCode;c!==a&&(a=c,(c===d||c===e)&&f.transact())}),this.editor.on("newword:composer",function(){f.transact()}).on("beforecommand:composer",function(){f.transact()})},transact:function(){var b,c,d,e,i,j=this.historyStr[this.position-1],k=this.composer.getValue(!1,!1),l=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(k!==j){var m=this.historyStr.length=this.historyDom.length=this.position;m>f&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,l&&(b=this.composer.selection.getRange(),c=b&&b.startContainer?b.startContainer:this.element,d=b&&b.startOffset?b.startOffset:0,c.nodeType===a.ELEMENT_NODE?e=c:(e=c.parentNode,i=this.getChildNodeIndex(e,c)),e.setAttribute(h,d),"undefined"!=typeof i&&e.setAttribute(g,i));var n=this.element.cloneNode(!!k);this.historyDom.push(n),this.historyStr.push(k),e&&(e.removeAttribute(h),e.removeAttribute(g))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";for(var b=0,c=a.childNodes,d=a.childNodes.length;d>b;b++)this.element.appendChild(c[b].cloneNode(!0));var e,f,i;a.hasAttribute(h)?(e=a.getAttribute(h),i=a.getAttribute(g),f=this.element):(f=this.element.querySelector("["+h+"]")||this.element,e=f.getAttribute(h),i=f.getAttribute(g),f.removeAttribute(h),f.removeAttribute(g)),null!==i&&(f=this.getChildNodeByIndex(f,+i)),this.composer.selection.set(f,e)},getChildNodeIndex:function(a,b){for(var c=0,d=a.childNodes,e=d.length;e>c;c++)if(d[c]===b)return c},getChildNodeByIndex:function(a,b){return a.childNodes[b]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(a,b,c){this.parent=a,this.element=b,this.config=c,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(a){var b=a.dom,c=a.browser;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,b,c){this.base(a,b,c),this.config.noTextarea?this.editableArea=b:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=c.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(b,c){var d=this.isEmpty()?"":a.quirks.getCorrectInnerHTML(this.element);return b!==!1&&(d=this.parent.parse(d,c===!1?!1:!0)),d},setValue:function(a,b){b!==!1&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(c){this.element.innerText=a}},cleanUp:function(a){var b;this.selection&&this.selection.isInThisEditable()&&(b=rangy.saveSelection(this.win)),this.parent.parse(this.element,void 0,a),b&&rangy.restoreSelection(b)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=b.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(b){a.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var c=this.element.lastChild;b&&c&&this.selection&&("BR"===c.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var a={};return"undefined"!=typeof this.win.pageYOffset?a.y=this.win.pageYOffset:a.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,"undefined"!=typeof this.win.pageXOffset?a.x=this.win.pageXOffset:a.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,a}},setScrollPos:function(a){a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y&&this.win.scrollTo(a.x,a.y)},getTextContent:function(){return b.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(a)||""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===a||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;this.config.noTextarea?this.sandbox=new b.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new b.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),b.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var a=this;this.sandbox=new b.Sandbox(function(){a._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var c=this.textarea.element;b.insert(this.editableArea).after(c),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden",a.name="_wysihtml5_mode",a.value=1,b.insert(a).after(this.textarea.element)}},_create:function(){var d=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new a.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new a.Commands(this.parent),this.config.noTextarea||b.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),this._initAutoLinking(),b.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var e=this.config.name;e&&(b.addClass(this.element,e),this.config.contentEditableMode||b.addClass(this.editableArea,e)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var f="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");f&&b.simulatePlaceholder(this.parent,this,f,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||c.isIos()||setTimeout(function(){d.focus(!0)},100),c.clearsContentEditableCorrectly()||a.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var d=this,e=c.canDisableAutoLinking(),f=c.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink){(!f||f&&e)&&(this.parent.on("newword:composer",function(){if(b.getTextContent(d.element).match(b.autoLink.URL_REG_EXP)){for(var c=d.selection.getSelectedNode(),e=d.element.querySelectorAll("."+d.config.classNames.uneditableContainer),f=!1,g=e.length;g--;)a.dom.contains(e[g],c)&&(f=!0);f||b.autoLink(c,[d.config.classNames.uneditableContainer])}}),b.observe(this.element,"blur",function(){b.autoLink(d.element,[d.config.classNames.uneditableContainer])}));var g=this.sandbox.getDocument().getElementsByTagName("a"),h=b.autoLink.URL_REG_EXP,i=function(c){var d=a.lang.string(b.getTextContent(c)).trim();return"www."===d.substr(0,4)&&(d="http://"+d),d};b.observe(this.element,"keydown",function(a){if(g.length){var c,e=d.selection.getSelectedNode(a.target.ownerDocument),f=b.getParentElement(e,{query:"a"},4);f&&(c=i(f),setTimeout(function(){var a=i(f);a!==c&&a.match(h)&&f.setAttribute("href",a)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),c.supportsEvent("resizeend")){var d=["width","height"],e=d.length,f=this.element;b.observe(f,"resizeend",function(b){var c,g=b.target||b.srcElement,h=g.style,i=0;if("IMG"===g.nodeName){for(;e>i;i++)c=d[i],h[c]&&(g.setAttribute(c,parseInt(h[c],10)),h[c]="");a.quirks.redraw(f)}})}},_initUndoManager:function(){this.undoManager=new a.UndoManager(this.parent)},_initLineBreaking:function(){function d(a){var c=b.getParentElement(a,{query:"p, div"},2);c&&b.contains(e.element,c)&&e.selection.executeAndRestore(function(){e.config.useLineBreaks?b.replaceWithChildNodes(c):"P"!==c.nodeName&&b.renameElement(c,"p")})}var e=this,f="li, p, h1, h2, h3, h4, h5, h6",g="ul, ol, menu";this.config.useLineBreaks||b.observe(this.element,["focus","keydown"],function(){if(e.isEmpty()){var a=e.doc.createElement("P");e.element.innerHTML="",e.element.appendChild(a),c.displaysCaretInEmptyContentEditableCorrectly()?e.selection.selectNode(a,!0):(a.innerHTML="<br>",e.selection.setBefore(a.firstChild))}}),b.observe(this.element,"keydown",function(c){var h=c.keyCode;if(!c.shiftKey&&(h===a.ENTER_KEY||h===a.BACKSPACE_KEY)){var i=b.getParentElement(e.selection.getSelectedNode(),{query:f},4);return i?void setTimeout(function(){var c,f=e.selection.getSelectedNode();if("LI"===i.nodeName){if(!f)return;c=b.getParentElement(f,{query:g},2),c||d(f)}h===a.ENTER_KEY&&i.nodeName.match(/^H[1-6]$/)&&d(f)},0):void(e.config.useLineBreaks&&h===a.ENTER_KEY&&!a.browser.insertsLineBreaksOnReturn()&&(c.preventDefault(),e.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(a){var b=a.dom,c=document,d=window,e=c.createElement("div"),f=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],g=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],i=function(a){if(a.setActive)try{a.setActive()}catch(e){}else{var f=a.style,g=c.documentElement.scrollTop||c.body.scrollTop,h=c.documentElement.scrollLeft||c.body.scrollLeft,i={position:f.position,top:f.top,left:f.left,WebkitUserSelect:f.WebkitUserSelect};b.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a),a.focus(),b.setStyles(i).on(a),d.scrollTo&&d.scrollTo(h,g)}};a.views.Composer.prototype.style=function(){var d,j=this,k=c.querySelector(":focus"),l=this.textarea.element,m=l.hasAttribute("placeholder"),n=m&&l.getAttribute("placeholder"),o=l.style.display,p=l.disabled;this.focusStylesHost=e.cloneNode(!1),this.blurStylesHost=e.cloneNode(!1),this.disabledStylesHost=e.cloneNode(!1),m&&l.removeAttribute("placeholder"),l===k&&l.blur(),l.disabled=!1,l.style.display=d="none",(l.getAttribute("rows")&&"auto"===b.getStyle("height").from(l)||l.getAttribute("cols")&&"auto"===b.getStyle("width").from(l))&&(l.style.display=d=o),b.copyStyles(g).from(l).to(this.editableArea).andTo(this.blurStylesHost),b.copyStyles(f).from(l).to(this.element).andTo(this.blurStylesHost),b.insertCSS(h).into(this.element.ownerDocument),l.disabled=!0,b.copyStyles(g).from(l).to(this.disabledStylesHost),b.copyStyles(f).from(l).to(this.disabledStylesHost),l.disabled=p,l.style.display=o,i(l),l.style.display=d,b.copyStyles(g).from(l).to(this.focusStylesHost),b.copyStyles(f).from(l).to(this.focusStylesHost),l.style.display=o,b.copyStyles(["display"]).from(l).to(this.editableArea);var q=a.lang.array(g).without(["display"]);return k?k.focus():l.blur(),m&&l.setAttribute("placeholder",n),this.parent.on("focus:composer",function(){b.copyStyles(q).from(j.focusStylesHost).to(j.editableArea),b.copyStyles(f).from(j.focusStylesHost).to(j.element)}),this.parent.on("blur:composer",function(){b.copyStyles(q).from(j.blurStylesHost).to(j.editableArea),b.copyStyles(f).from(j.blurStylesHost).to(j.element)}),this.parent.observe("disable:composer",function(){b.copyStyles(q).from(j.disabledStylesHost).to(j.editableArea),b.copyStyles(f).from(j.disabledStylesHost).to(j.element)}),this.parent.observe("enable:composer",function(){b.copyStyles(q).from(j.blurStylesHost).to(j.editableArea),b.copyStyles(f).from(j.blurStylesHost).to(j.element)}),this}}(wysihtml5),function(a){var b=a.dom,c=a.browser,d={66:"bold",73:"italic",85:"underline"},e=function(a,b,c){for(var d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c,!1)},f=function(a,b,c){for(var d=0,e=b.length;e>d;d++)a.removeEventListener(b[d],c,!1)},g=function(b,c){if(b.selection.caretIsLastInSelection()){var d=b.selection.getSelection(),e=d.anchorNode;if(e&&1===e.nodeType&&(a.dom.getParentElement(e,{query:"td, th"},!1,b.element)||c)){var f=e.childNodes[d.anchorOffset];if(f&&1===f.nodeType&"BR"===f.nodeName)return f.parentNode.removeChild(f),!0}}return!1},h=function(a){var b=a.selection.getBeforeSelection(!0);if(b&&("element"===b.type||"leafnode"===b.type)&&1===b.node.nodeType&&b.node.classList.contains(a.config.classNames.uneditableContainer)){if(g(a,!0))return!0;try{var c=new CustomEvent("wysihtml5:uneditable:delete");b.node.dispatchEvent(c)}catch(d){}return b.node.parentNode.removeChild(b.node),!0}return!1},i=function(b){var c=b.selection,d=c.getPreviousNode();if(c.caretIsFirstInSelection()&&d&&1===d.nodeType&&/block/.test(b.win.getComputedStyle(d).display)){if(/^\s*$/.test(d.textContent||d.innerText))return d.parentNode.removeChild(d),!0;if(d.lastChild){var e=d.lastChild,f=c.getSelectedNode(),g=a.dom.domNode(d).commonAncestor(f,b.element);if(curNode=g?a.dom.getParentElement(f,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,g):null,curNode){for(;curNode.firstChild;)d.appendChild(curNode.firstChild);return c.setAfter(e),!0}if(3===f.nodeType)return d.appendChild(f),c.setAfter(e),!0}}return!1},j=function(a,b){var c=b.selection;b.element;if(c.isCollapsed()){if(i(b))return void a.preventDefault();if(g(b))return void a.preventDefault();if(h(b))return void a.preventDefault()}else c.containsUneditable()&&(a.preventDefault(),c.deleteContents())},k=function(a,b,c){if(a.selection.isCollapsed()){if(a.selection.caretIsInTheBeginnig("li"))if(c){if(a.commands.exec("outdentList"))return}else if(a.commands.exec("indentList"))return}else a.selection.deleteContents();a.commands.exec("insertHTML","&emsp;")},l=function(a){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},m=function(a){this.parent.fire("beforeinteraction",a).fire("beforeinteraction:composer",a),setTimeout(function(){this.parent.fire("interaction",a).fire("interaction:composer",a)}.bind(this),0)},n=function(a){this.parent.fire("focus",a).fire("focus:composer",a),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},o=function(a){if(this.focusState!==this.getValue(!1,!1)){var b=a;"function"==typeof Object.create&&(b=Object.create(a,{type:{value:"change"}})),this.parent.fire("change",b).fire("change:composer",b)}this.parent.fire("blur",a).fire("blur:composer",a)},p=function(a){this.parent.fire(a.type,a).fire(a.type+":composer",a),"paste"===a.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},q=function(b){this.config.copyedFromMarking&&(a.browser.supportsModernPaste()&&(b.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),b.clipboardData.setData("text/plain",this.selection.getPlainText()),b.preventDefault()),this.parent.fire(b.type,b).fire(b.type+":composer",b))},r=function(b){var c=b.keyCode;(c===a.SPACE_KEY||c===a.ENTER_KEY)&&this.parent.fire("newword:composer")},s=function(b){if(!c.canSelectImagesInContentEditable()){var d=b.target,e=this.element.querySelectorAll("img"),f=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),g=a.lang.array(e).without(f);"IMG"===d.nodeName&&a.lang.array(g).contains(d)&&this.selection.selectNode(d)}},t=function(a){var b,c={IMG:"Image: ",A:"Link: "},d=a.target,e=d.nodeName;("A"===e||"IMG"===e)&&(d.hasAttribute("title")||(b=c[e]+(d.getAttribute("href")||d.getAttribute("src")),d.setAttribute("title",b)))},u=function(b){if(this.config.classNames.uneditableContainer){var c=a.dom.getParentElement(b.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);c&&this.selection.setAfter(c)}},v=function(a){c.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},w=function(b){var c,e,f=b.keyCode,g=d[f];return!b.ctrlKey&&!b.metaKey||b.altKey||65!==f?((b.ctrlKey||b.metaKey)&&!b.altKey&&g&&(this.commands.exec(g),b.preventDefault()),f===a.BACKSPACE_KEY&&j(b,this),(f===a.BACKSPACE_KEY||f===a.DELETE_KEY)&&(c=this.selection.getSelectedNode(!0),c&&"IMG"===c.nodeName&&(b.preventDefault(),e=c.parentNode,e.removeChild(c),"A"!==e.nodeName||e.firstChild||e.parentNode.removeChild(e),setTimeout(function(){a.quirks.redraw(this.element)}.bind(this),0))),void(this.config.handleTabKey&&f===a.TAB_KEY&&(b.preventDefault(),k(this,this.element,b.shiftKey)))):(this.selection.selectAll(),void b.preventDefault())},x=function(){var b=function(){window.removeEventListener("load",b),this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),c=function(){b.call(this),f(this.sandbox.getIframe(),["focus","mouseup","mouseover"],c)}.bind(this);this.doc.execCommand&&a.browser.supportsCommand(this.doc,"enableObjectResizing")&&a.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?e(this.sandbox.getIframe(),["focus","mouseup","mouseover"],c):window.addEventListener("load",b)),this.tableSelection=a.quirks.tableCellsSelection(this.element,this.parent)};a.views.Composer.prototype.observe=function(){var a=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),d=(this.element,c.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),a.addEventListener(["DOMNodeRemoved"],l.bind(this),!1),c.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){b.contains(document.documentElement,a)||l.call(this)},250)),this.config.handleTables&&x.call(this),e(d,["drop","paste","mouseup","focus","keyup"],m.bind(this)),d.addEventListener("focus",n.bind(this),!1),d.addEventListener("blur",o.bind(this),!1),e(this.element,["drop","paste","beforepaste"],p.bind(this),!1),this.element.addEventListener("copy",q.bind(this),!1),this.element.addEventListener("mousedown",s.bind(this),!1),this.element.addEventListener("mouseover",t.bind(this),!1),this.element.addEventListener("click",u.bind(this),!1),this.element.addEventListener("drop",v.bind(this),!1),this.element.addEventListener("keyup",r.bind(this),!1),this.element.addEventListener("keydown",w.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(wysihtml5),function(a){var b=400;a.views.Synchronizer=Base.extend({constructor:function(a,b,c){this.editor=a,this.textarea=b,this.composer=c,this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),b)},fromTextareaToComposer:function(a){var b=this.textarea.getValue(!1,!1);b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a):this.fromComposerToTextarea(a)},_observe:function(){var c,d=this,e=this.textarea.element.form,f=function(){c=setInterval(function(){d.fromComposerToTextarea()},b)},g=function(){clearInterval(c),c=null};f(),e&&(a.dom.observe(e,"submit",function(){d.sync(!0)}),a.dom.observe(e,"reset",function(){setTimeout(function(){d.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(a){"composer"!==a||c?"textarea"===a&&(d.fromComposerToTextarea(!0),g()):(d.fromTextareaToComposer(!0),f())}),this.editor.on("destroy:composer",g)}})}(wysihtml5),function(a){a.views.SourceView=Base.extend({constructor:function(a,b){this.editor=a,this.composer=b,this._observe()},switchToTextarea:function(a){var b=this.composer.win.getComputedStyle(this.composer.element),c=parseFloat(b.width),d=Math.max(parseFloat(b.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml5-source-view"),this.textarea.style.width=c+"px",this.textarea.style.height=d+"px",this.textarea.value=this.editor.getValue(a,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(a){var b=this.textarea.value;b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(a){"composer"===a?this.switchToComposer(!0):"textarea"===a&&this.switchToTextarea(!0)}.bind(this))}})}(wysihtml5),
wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(a,b,c){this.base(a,b,c),this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;return a!==!1&&(b=this.parent.parse(b)),b},setValue:function(a,b){b!==!1&&(a=this.parent.parse(a)),this.element.value=a},cleanUp:function(a){var b=this.parent.parse(this.element.value,void 0,a);this.element.value=b},hasPlaceholderSet:function(){var a=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),b=this.element.getAttribute("placeholder")||null,c=this.element.value,d=!c;return a&&d||c===b},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,b=this.parent,c={focusin:"focus",focusout:"blur"},d=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];b.on("beforeload",function(){wysihtml5.dom.observe(a,d,function(a){var d=c[a.type]||a.type;b.fire(d).fire(d+":textarea")}),wysihtml5.dom.observe(a,["paste","drop"],function(){setTimeout(function(){b.fire("paste").fire("paste:textarea")},0)})})}}),function(a){var b,c={name:b,style:!0,toolbar:b,showToolbarAfterInit:!0,showToolbarDialogsOnSelection:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:a.dom.parse,useLineBreaks:!0,stylesheets:[],placeholderText:b,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml5-editor",body:"wysihtml5-supported",sandbox:"wysihtml5-sandbox",placeholder:"wysihtml5-placeholder",uneditableContainer:"wysihtml5-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,d){if(this.editableElement="string"==typeof b?document.getElementById(b):b,this.config=a.lang.object({}).merge(c).merge(d).get(),this._isCompatible=a.browser.supported(),d&&d.classNames&&a.lang.object(this.config.classNames).merge(d.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new a.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var e=this;return void setTimeout(function(){e.fire("beforeload").fire("load")},0)}a.dom.addClass(document.body,this.config.classNames.body),this.composer=new a.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new a.views.SourceView(this,this.composer):this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(a,b){return this.currentView.getValue(a,b)},setValue:function(a,b){return this.fire("unset_placeholder"),a?(this.currentView.setValue(a,b),this):this.clear()},cleanUp:function(a){this.currentView.cleanUp(a)},focus:function(a){return this.currentView.focus(a),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.toolbar&&this.toolbar.destroy(),this.off()},parse:function(b,c,d){var e=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,f=this.config.parser(b,{rules:d||this.config.parserRules,cleanUp:this.config.cleanUp,context:e,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:c});return"object"==typeof b&&a.quirks.redraw(b),f},_initParser:function(){var b;a.browser.supportsModernPaste()?this.on("paste:composer",function(c){c.preventDefault(),b=a.dom.getPastedHtml(c),b&&this._cleanAndPaste(b)}.bind(this)):this.on("beforepaste:composer",function(b){b.preventDefault();var c=this.composer.getScrollPos();a.dom.getPastedHtmlWithDiv(this.composer,function(a){a&&this._cleanAndPaste(a),this.composer.setScrollPos(c)}.bind(this))}.bind(this))},_cleanAndPaste:function(b){var c=a.quirks.cleanPastedHTML(b,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(c)}})}(wysihtml5),function(a){var b=a.dom,c="wysihtml5-command-dialog-opened",d="input, select, textarea",e="[data-wysihtml5-dialog-field]",f="data-wysihtml5-dialog-field";a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(a,b){this.link=a,this.container=b},_observe:function(){if(!this._observed){var d=this,e=function(a){var b=d._serialize();d.fire("save",b),d.hide(),a.preventDefault(),a.stopPropagation()};b.observe(d.link,"click",function(){b.hasClass(d.link,c)&&setTimeout(function(){d.hide()},0)}),b.observe(this.container,"keydown",function(b){var c=b.keyCode;c===a.ENTER_KEY&&e(b),c===a.ESCAPE_KEY&&d.cancel()}),b.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",e),b.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(a){d.cancel(),a.preventDefault(),a.stopPropagation()}),this._observed=!0}},_serialize:function(){for(var a={},b=this.container.querySelectorAll(e),c=b.length,d=0;c>d;d++)a[b[d].getAttribute(f)]=b[d].value;return a},_interpolate:function(a){for(var b,c,d,g=document.querySelector(":focus"),h=this.container.querySelectorAll(e),i=h.length,j=0;i>j;j++)b=h[j],b!==g&&(a&&"hidden"===b.type||(c=b.getAttribute(f),d=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(c)||"":b.defaultValue,b.value=d))},update:function(a){this.elementToChange=a?a:this.elementToChange,this._interpolate()},show:function(a){var e=this.container.querySelector(d);if(this._observe(),this.update(a),b.addClass(this.link,c),this.container.style.display="",this.isOpen=!0,this.fire("show"),e&&!a)try{e.focus()}catch(f){}},_hide:function(a){this.elementToChange=null,b.removeClass(this.link,c),this.container.style.display="none",this.isOpen=!1},hide:function(){this._hide(),this.fire("hide")},cancel:function(){this._hide(),this.fire("cancel")}})}(wysihtml5),function(a){var b=a.dom,c={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},e={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};a.toolbar.Speech=function(g,h){var i=document.createElement("input");if(!a.browser.supportsSpeechApiOn(i))return void(h.style.display="none");var j=g.editor.textarea.element.getAttribute("lang");j&&(f.lang=j);var k=document.createElement("div");a.lang.object(d).merge({width:h.offsetWidth+"px",height:h.offsetHeight+"px"}),b.insert(i).into(k),b.insert(k).into(h),b.setStyles(e).on(i),b.setAttributes(f).on(i),b.setStyles(d).on(k),b.setStyles(c).on(h);var l="onwebkitspeechchange"in i?"webkitspeechchange":"speechchange";b.observe(i,l,function(){g.execCommand("insertText",i.value),i.value=""}),b.observe(i,"click",function(a){b.hasClass(h,"wysihtml5-command-disabled")&&a.preventDefault(),a.stopPropagation()})}}(wysihtml5),function(a){function b(b,c){var d=b.commands.state(c.name,c.value);return!c.dialog.multiselect&&a.lang.object(d).isArray()&&(d=1===d.length?d[0]:!0),d}var c="wysihtml5-command-disabled",d="wysihtml5-commands-disabled",e="wysihtml5-command-active",f="wysihtml5-action-active",g=a.dom;a.toolbar.Toolbar=Base.extend({constructor:function(b,g,h){this.editor=b,this.container="string"==typeof g?document.getElementById(g):g,this.composer=b.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),h&&this.show(),null!=b.config.classNameCommandDisabled&&(c=b.config.classNameCommandDisabled),null!=b.config.classNameCommandsDisabled&&(d=b.config.classNameCommandsDisabled),null!=b.config.classNameCommandActive&&(e=b.config.classNameCommandActive),null!=b.config.classNameActionActive&&(f=b.config.classNameActionActive);for(var i=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),j=i.length,k=0;j>k;k++)new a.toolbar.Speech(this,i[k])},_getLinks:function(b){for(var c,d,e,f,g,h,i=this[b+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+b+"]")).get(),j=i.length,k=0,l=this[b+"Mapping"]={};j>k;k++)c=i[k],e=c.getAttribute("data-wysihtml5-"+b),f=c.getAttribute("data-wysihtml5-"+b+"-value"),h=c.getAttribute("data-wysihtml5-"+b+"-blank-value"),d=this.container.querySelector("[data-wysihtml5-"+b+"-group='"+e+"']"),g=this._getDialog(c,e),l[e+":"+f]={link:c,group:d,name:e,value:f,tracksBlankValue:h,dialog:g,state:!1}},_getDialog:function(b,c){var d,e,f=this,g=this.container.querySelector("[data-wysihtml5-dialog='"+c+"']");return g&&(d=a.toolbar["Dialog_"+c]?new a.toolbar["Dialog_"+c](b,g):new a.toolbar.Dialog(b,g),d.on("show",function(){e=f.composer.selection.getBookmark(),f.editor.fire("show:dialog",{command:c,dialogContainer:g,commandLink:b})}),d.on("save",function(a){e&&f.composer.selection.setBookmark(e),f._execCommand(c,a),f.editor.fire("save:dialog",{command:c,dialogContainer:g,commandLink:b}),f._hideAllDialogs(),f._preventInstantFocus(),e=void 0}),d.on("cancel",function(){e&&f.composer.selection.setBookmark(e),f.editor.fire("cancel:dialog",{command:c,dialogContainer:g,commandLink:b}),e=void 0,f._preventInstantFocus()}),d.on("hide",function(){f.editor.fire("hide:dialog",{command:c,dialogContainer:g,commandLink:b}),e=void 0})),d},execCommand:function(a,b){this.commandsDisabled||this._execCommand(a,b)},_execCommand:function(a,b){this.editor.focus(!1),this.composer.commands.exec(a,b),this._updateLinkStates()},execAction:function(a){var b=this.editor;"change_view"===a&&(b.currentView===b.textarea||"source"===b.currentView?b.fire("change_view","composer"):b.fire("change_view","textarea")),"showSource"==a&&b.fire("showSource")},_observe:function(){for(var c=this,e=this.editor,f=this.container,h=this.commandLinks.concat(this.actionLinks),i=h.length,j=0;i>j;j++)"A"===h[j].nodeName?g.setAttributes({href:"javascript:;",unselectable:"on"}).on(h[j]):g.setAttributes({unselectable:"on"}).on(h[j]);g.delegate(f,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(a){a.preventDefault()}),g.delegate(f,"[data-wysihtml5-command]","click",function(a){var d,e=this,f=e.getAttribute("data-wysihtml5-command"),g=e.getAttribute("data-wysihtml5-command-value"),h=c.commandMapping[f+":"+g];g||!h.dialog?c.execCommand(f,g):(d=b(c.composer,h),h.dialog.show(d)),a.preventDefault()}),g.delegate(f,"[data-wysihtml5-action]","click",function(a){var b=this.getAttribute("data-wysihtml5-action");c.execAction(b),a.preventDefault()}),e.on("interaction:composer",function(a){c.preventFocus||c._updateLinkStates()}),this._ownerDocumentClick=function(b){a.dom.contains(c.container,b.target)||a.dom.contains(c.composer.element,b.target)||(c._updateLinkStates(),c._preventInstantFocus())},this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1),this.editor.on("destroy:composer",this.destroy.bind(this)),this.editor.config.handleTables&&(e.on("tableselect:composer",function(){c.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),e.on("tableunselect:composer",function(){c.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),e.on("change_view",function(a){setTimeout(function(){c.commandsDisabled="composer"!==a,c._updateLinkStates(),c.commandsDisabled?g.addClass(f,d):g.removeClass(f,d)},0)})},destroy:function(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function(){var a=this.commandMapping;for(var b in a)a[b].dialog&&a[b].dialog.hide()},_preventInstantFocus:function(){this.preventFocus=!0,setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var a,d,h,i,j,k=this.commandMapping,l=this.composer,m=this.actionMapping;for(a in k)i=k[a],this.commandsDisabled?(d=!1,g.removeClass(i.link,e),i.group&&g.removeClass(i.group,e),i.dialog&&i.dialog.hide()):(d=this.composer.commands.state(i.name,i.value),g.removeClass(i.link,c),i.group&&g.removeClass(i.group,c)),(i.state!==d||i.tracksBlankValue)&&(i.state=d,d?i.tracksBlankValue?g.removeClass(i.link,e):(g.addClass(i.link,e),i.group&&g.addClass(i.group,e),!i.dialog||"undefined"!=typeof i.value&&null!==i.value||(d&&"object"==typeof d?(d=b(l,i),i.state=d,j=i.dialog.container.dataset?i.dialog.container.dataset.showdialogonselection:!1,l.config.showToolbarDialogsOnSelection||j?i.dialog.show(d):i.dialog.update(d)):i.dialog.hide())):i.tracksBlankValue?g.addClass(i.link,e):(g.removeClass(i.link,e),i.group&&g.removeClass(i.group,e),i.dialog&&!i.value&&i.dialog.hide()));for(a in m)h=m[a],"change_view"===h.name&&(h.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,h.state?g.addClass(h.link,f):g.removeClass(h.link,f))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(a){a.toolbar.Dialog_createTable=a.toolbar.Dialog.extend({show:function(a){this.base(a)}})}(wysihtml5),function(a){var b="[data-wysihtml5-dialog-field]",c="data-wysihtml5-dialog-field";a.toolbar.Dialog_foreColorStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var a={},d=this.container.querySelectorAll(b),e=d.length,f=0;e>f;f++)a[d[f].getAttribute(c)]=d[f].value;return a},_interpolate:function(d){for(var e,f,g=a.quirks.styleParser,h=document.querySelector(":focus"),i=this.container.querySelectorAll(b),j=i.length,k=0,l=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,m=l?l.getAttribute("style"):null,n=m?g.parseColor(m,"color"):null;j>k;k++)e=i[k],e!==h&&(d&&"hidden"===e.type||"color"===e.getAttribute(c)&&(f=(e.dataset.colormode||"rgb").toLowerCase(),f="hex"===f?"hash":f,n?e.value=g.unparseColor(n,f):e.value=g.unparseColor([0,0,0],f)))}})}(wysihtml5),function(a){a.dom;a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(b){var c=document.querySelector(":focus"),d=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),e=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,f=e?e.getAttribute("style"):null,g=f?a.quirks.styleParser.parseFontSize(f):null;d&&d!==c&&g&&!/^\s*$/.test(g)&&(d.value=g)}})}(wysihtml5);

;
;
/*! wysihtml.min.js */ 
;
;
/*! wysihtml - v0.5.2 (2015-11-10) */
var wysihtml5={version:"0.5.2",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};wysihtml5.polyfills=function(a,b){String.prototype.trim||!function(){var a=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(a,"")}}(),function(){var c="addEventListener",d="removeEventListener";b[c]||(a.Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){var b=b||a.event;b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},a.Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(a.Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(a.Element.prototype,"textContent").get&&!function(){var b=Object.getOwnPropertyDescriptor(a.Element.prototype,"innerText");Object.defineProperty(a.Element.prototype,"textContent",{get:function(){return b.get.call(this)},set:function(a){return b.set.call(this,a)}})}(),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=this.length,d=-1,e=b>>>0;~(c-e);d=this[--c]===a?c:d);return d}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(a){a.matches=a.matches||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return c[d]?!0:!1},a.closest=a.closest||function(a){for(var b=this;b&&!b.matches(a);)b=b.parentElement;return b}}(Element.prototype),"document"in a&&("classList"in b.createElement("_")?"DOMTokenList"in a&&!function(){"use strict";var c=b.createElement("_");if(c.classList.add("c1","c2"),!c.classList.contains("c2")){var d=function(b){var c=a.DOMTokenList.prototype[b];a.DOMTokenList.prototype[b]=function(a){var b,d=arguments.length;for(b=0;d>b;b++)a=arguments[b],c.call(this,a)}};d("add"),d("remove")}if(c.classList.toggle("c3",!1),c.classList.contains("c3")){var e=a.DOMTokenList.prototype.toggle;a.DOMTokenList.prototype.toggle=function(a,b){return 1 in arguments&&!this.contains(a)==!b?b:e.call(this,a)}}c=null}():!function(a){"use strict";if("Element"in a){var b="classList",c="prototype",d=a.Element[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.getAttribute("class")||""),c=b?b.split(/\s+/):[],d=0,e=c.length;e>d;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0);while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b,c=arguments,d=0,e=c.length,f=!1;do for(a=c[d]+"",b=i(this,a);-1!==b;)this.splice(b,1),f=!0,b=i(this,a);while(++d<e);f&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),b===!0||b===!1?b:!c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){-2146823252===n.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(a));var c=function(){if("createRange"in document&&"getSelection"in window){var a,b,c=document.createElement("div"),d=document.createTextNode("a"),e=document.createTextNode("a"),f=document.createTextNode("a"),g=document.createRange();return c.setAttribute("contenteditable","true"),c.appendChild(d),c.appendChild(e),c.appendChild(f),document.body.appendChild(c),g.setStart(e,1),g.setEnd(e,1),a=window.getSelection(),a.removeAllRanges(),a.addRange(g),c.normalize(),a=window.getSelection(),b=1!==c.childNodes.length||a.anchorNode!==c.firstChild||2!==a.anchorOffset,c.parentNode.removeChild(c),a.removeAllRanges(),b}},d=function(a){var b=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b.push(a):b=b.concat(d(a));return b},e=function(){var a=(Node.prototype.normalize,function(){var a=d(this),b=this.ownerDocument.defaultView.getSelection(),c=b.anchorNode,e=b.anchorOffset,f=c&&1===c.nodeType&&c.childNodes.length>0?c.childNodes[e]:void 0,g=b.focusNode,h=b.focusOffset,i=g&&1===g.nodeType&&h>0?g.childNodes[h-1]:void 0,j=this.ownerDocument.createRange(),k=a.shift(),l=k?a.shift():null;for(i&&3===i.nodeType&&(g=i,h=i.nodeValue.length,i=void 0),f&&3===f.nodeType&&(c=f,e=0,f=void 0),(c===g&&e>h||c!==g&&c.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_PRECEDING&&!(c.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_CONTAINS))&&(g=[c,c=g][0],h=[e,e=h][0]);k&&l;)l.previousSibling&&l.previousSibling===k?(c===l&&(c=k,e=k.nodeValue.length+e),g===l&&(g=k,h=k.nodeValue.length+h),k.nodeValue=k.nodeValue+l.nodeValue,l.parentNode.removeChild(l),l=a.shift()):(k=l,l=a.shift());i&&(h=Array.prototype.indexOf.call(i.parentNode.childNodes,i)+1),f&&(e=Array.prototype.indexOf.call(f.parentNode.childNodes,f)),c&&c.parentNode&&g&&g.parentNode&&(j.setStart(c,e),j.setEnd(g,h),b.removeAllRanges(),b.addRange(j))});Node.prototype.normalize=a},f=function(){window.removeEventListener("load",f),"Node"in window&&"normalize"in Node.prototype&&c()&&e()};"complete"!==b.readyState?window.addEventListener("load",f):f()},wysihtml5.polyfills(window,document),function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.rangy=a()}(function(){function a(a,b){var c=typeof a[b];return c==u||!(c!=t||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=t||!a[b])}function c(a,b){return typeof a[b]!=v}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&A(a,z)&&C(a,y)}function f(a){return b(a,"body")?a.body:a.getElementsByTagName("body")[0]}function g(b){typeof console!=v&&a(console,"log")&&console.log(b)}function h(a,b){F&&b?alert(a):g(a)}function i(a){H.initialized=!0,H.supported=!1,h("Rangy is not supported in this environment. Reason: "+a,H.config.alertOnFail)}function j(a){h("Rangy warning: "+a,H.config.alertOnWarn)}function k(a){return a.message||a.description||String(a)}function l(){if(F&&!H.initialized){var b,c=!1,d=!1;a(document,"createRange")&&(b=document.createRange(),A(b,x)&&C(b,w)&&(c=!0));var h=f(document);if(!h||"body"!=h.nodeName.toLowerCase())return void i("No body element found");if(h&&a(h,"createTextRange")&&(b=h.createTextRange(),e(b)&&(d=!0)),!c&&!d)return void i("Neither Range nor TextRange are available");H.initialized=!0,H.features={implementsDomRange:c,implementsTextRange:d};var j,l;for(var m in E)(j=E[m])instanceof p&&j.init(j,H);for(var n=0,o=K.length;o>n;++n)try{K[n](H)}catch(q){l="Rangy init listener threw an exception. Continuing. Detail: "+k(q),g(l)}}}function m(a,b,c){c&&(a+=" in module "+c.name),H.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}function n(a,b,c,d){a[b]=function(){return m(b,c,d),a[c].apply(a,G.toArray(arguments))}}function o(a){a=a||window,l();for(var b=0,c=L.length;c>b;++b)L[b](a)}function p(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function q(a,b,c){var d=new p(a,b,function(b){if(!b.initialized){b.initialized=!0;try{c(H,b),b.supported=!0}catch(d){var e="Module '"+a+"' failed to load: "+k(d);g(e),d.stack&&g(d.stack)}}});return E[a]=d,d}function r(){}function s(){}var t="object",u="function",v="undefined",w=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],y=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],z=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],A=d(a),B=d(b),C=d(c),D=[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c],c)},E={},F=typeof window!=v&&typeof document!=v,G={isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:A,areHostObjects:B,areHostProperties:C,isTextRange:e,getBody:f,forEach:D},H={version:"1.3.0",initialized:!1,isBrowser:F,supported:!0,util:G,features:{},modules:E,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==v?!0:rangyAutoInitialize}};H.fail=i,H.warn=j;var I;({}).hasOwnProperty?(G.extend=I=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&I(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a},G.createOptions=function(a,b){var c={};return I(c,b),a&&I(c,a),c}):i("hasOwnProperty not supported"),F||i("Rangy can only run in a browser"),function(){var a;if(F){var b=document.createElement("div");b.appendChild(document.createElement("span"));var c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(d){}}a||(a=function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=a[c];return b}),G.toArray=a}();var J;F&&(a(document,"addEventListener")?J=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?J=function(a,b,c){a.attachEvent("on"+b,c)}:i("Document does not have required addEventListener or attachEvent method"),G.addListener=J);var K=[];G.deprecationNotice=m,G.createAliasForDeprecatedMethod=n,H.init=l,H.addInitListener=function(a){H.initialized?a(H):K.push(a)};var L=[];H.addShimListener=function(a){L.push(a)},F&&(H.shim=H.createMissingNativeApi=o,n(H,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var a,b,c=this.dependencies||[],d=0,e=c.length;e>d;++d){if(b=c[d],a=E[b],!(a&&a instanceof p))throw new Error("required module '"+b+"' not found");if(a.init(),!a.supported)throw new Error("required module '"+b+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error(a)},warn:function(a){H.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){H.warn("DEPRECATED: "+a+" in module "+this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},H.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]);var d=q(a,c,b);H.initialized&&H.supported&&d.init()},H.createCoreModule=function(a,b,c){q(a,b,c)},H.RangePrototype=r,H.rangePrototype=new r,H.selectionPrototype=new s,H.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==F||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(K(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),m(d,a),c)for(var f,g=0;f=c[g++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return d}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=F)return a.ownerDocument;if(typeof a.document!=F)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=F)return c.defaultView;if(typeof c.parentWindow!=F)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=F)return a.contentDocument;if(typeof a.contentWindow!=F)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=F)return a.contentWindow;if(typeof a.contentDocument!=F)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&G.isHostMethod(a,"setTimeout")&&G.isHostObject(a,"document")}function t(a,b,c){var d;if(a?G.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:f>c?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw new Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){var b;try{return b=a.parentNode,!1}catch(c){return!0}}function x(a){if(!a)return"[No node]";if(L&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+e(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a,b,c){var d=H(a),e=a.createElement("div");e.contentEditable=""+!!c,b&&(e.innerHTML=b);var f=d.firstChild;return f?d.insertBefore(e,f):d.appendChild(e),e}function A(a){return a.parentNode.removeChild(a)}function B(a){this.root=a,this._next=a}function C(a){return new B(a)}function D(a,b){this.node=a,this.offset=b}function E(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var F="undefined",G=a.util,H=G.getBody;G.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),G.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var I=document.createElement("div");G.areHostMethods(I,["insertBefore","appendChild","cloneNode"]||!G.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),G.isHostProperty(I,"innerHTML")||b.fail("Element is missing innerHTML property");var J=document.createTextNode("test");G.areHostMethods(J,["splitText","deleteData","insertData","appendData","cloneNode"]||!G.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"])||!G.areHostProperties(J,["data"]))||b.fail("Incomplete Text Node implementation");var K=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},L=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br />",L=w(c),a.features.crashyTextNodes=L}();var M;typeof window.getComputedStyle!=F?M=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=F?M=function(a,b){return a.currentStyle?a.currentStyle[b]:""}:b.fail("No means of obtaining computed style properties found"),B.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},D.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},a.dom={arrayContains:K,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:H,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:M,createTestElement:z,removeNode:A,fragmentFromNodeChildren:y,createIterator:C,DomPosition:D},a.DOMException=E}),H.createCoreModule("DomRange",["DomUtil"],function(a,b){function c(a,b){return 3!=a.nodeType&&(P(a,b.startContainer)||P(a,b.endContainer))}function d(a){return a.document||Q(a.startContainer)}function e(a){return W(a.startContainer)}function f(a){return new L(a.parentNode,O(a))}function g(a){return new L(a.parentNode,O(a)+1)}function h(a,b,c){var d=11==a.nodeType?a.firstChild:a;return N(b)?c==b.length?J.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:S(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function i(a,b,c){if(z(a),z(b),d(b)!=d(a))throw new M("WRONG_DOCUMENT_ERR");var e=R(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=R(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?0>=e&&f>=0:0>e&&f>0}function j(a){for(var b,c,e,f=d(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(j(e)),e.detach()),10==c.nodeType)throw new M("HIERARCHY_REQUEST_ERR");f.appendChild(c)}return f}function k(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),k(g,b,c),g.detach(),c.stop)return}else for(d=J.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function l(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),l(b),b.detach()):a.remove()}function m(a){for(var b,c,e=d(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=a.getSubtreeIterator(),b.appendChild(m(c)),c.detach()):a.remove(),10==b.nodeType)throw new M("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function n(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return k(new p(a,!1),function(b){if((!e||d.test(b.nodeType))&&(!f||c(b))){var h=a.startContainer;if(b!=h||!N(h)||a.startOffset!=h.length){var i=a.endContainer;b==i&&N(i)&&0==a.endOffset||g.push(b)}}}),g}function o(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+J.inspectNode(a.startContainer)+":"+a.startOffset+", "+J.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function p(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&N(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||N(this.sc)?T(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||N(this.ec)?T(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,V(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(ea(a,b))throw new M("INVALID_NODE_TYPE_ERR")}function s(a,b){if(!V(b,a.nodeType))throw new M("INVALID_NODE_TYPE_ERR")}function t(a,b){if(0>b||b>(N(a)?a.length:a.childNodes.length))throw new M("INDEX_SIZE_ERR")}function u(a,b){if(ca(a,!0)!==ca(b,!0))throw new M("WRONG_DOCUMENT_ERR")}function v(a){if(da(a,!0))throw new M("NO_MODIFICATION_ALLOWED_ERR")}function w(a,b){if(!a)throw new M(b)}function x(a,b){return b<=(N(a)?a.length:a.childNodes.length)}function y(a){return!!a.startContainer&&!!a.endContainer&&!(X&&(J.isBrokenNode(a.startContainer)||J.isBrokenNode(a.endContainer)))&&W(a.startContainer)==W(a.endContainer)&&x(a.startContainer,a.startOffset)&&x(a.endContainer,a.endOffset)}function z(a){if(!y(a))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a.inspect()+")")}function A(a,b){z(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e;N(e)&&f>0&&f<e.length&&S(e,f,b),N(c)&&d>0&&d<c.length&&(c=S(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=O(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function B(a){z(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function C(a){a.START_TO_START=ka,a.START_TO_END=la,a.END_TO_END=ma,a.END_TO_START=na,a.NODE_BEFORE=oa,a.NODE_AFTER=pa,a.NODE_BEFORE_AND_AFTER=qa,a.NODE_INSIDE=ra}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){z(this);var c,d,e=this.startContainer,f=this.startOffset,h=this.commonAncestorContainer,i=new p(this,!0);e!==h&&(c=T(e,h,!0),d=g(c),e=d.node,f=d.offset),k(i,v),i.reset();var j=a(i);return i.detach(),b(this,e,f,e,f),j}}function F(b,d){function e(a,b){return function(c){s(c,Z),s(W(c),$);var d=(a?f:g)(c);(b?h:i)(this,d.node,d.offset)}}function h(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((W(b)!=W(e)||1==R(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function i(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((W(b)!=W(e)||-1==R(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}var j=function(){};j.prototype=a.rangePrototype,b.prototype=new j,K.extend(b.prototype,{setStart:function(a,b){r(a,!0),t(a,b),h(this,a,b)},setEnd:function(a,b){r(a,!0),t(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],e=b,f=c;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}d(this,b,c,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){z(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(a,!0),d(this,a,0,a,U(a))},selectNode:function(a){r(a,!1),s(a,Z);var b=f(a),c=g(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:E(m,d),deleteContents:E(l,d),canSurroundContents:function(){z(this),v(this.startContainer),v(this.endContainer);var a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},splitBoundaries:function(){A(this)},splitBoundariesPreservingPositions:function(a){A(this,a)},normalizeBoundaries:function(){z(this);var a,b=this.startContainer,c=this.startOffset,e=this.endContainer,f=this.endOffset,g=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(e=a,f=a.length,a.appendData(b.data),Y(b))},h=function(a){var d=a.previousSibling;if(d&&d.nodeType==a.nodeType){b=a;var g=a.length;if(c=d.length,a.insertData(0,d.data),Y(d),b==e)f+=c,e=b;else if(e==a.parentNode){var h=O(a);f==h?(e=a,f=g):f>h&&f--}}},i=!0;if(N(e))f==e.length?g(e):0==f&&(a=e.previousSibling,a&&a.nodeType==e.nodeType&&(f=a.length,b==e&&(i=!1),a.appendData(e.data),Y(e),e=a));else{if(f>0){var j=e.childNodes[f-1];j&&N(j)&&g(j)}i=!this.collapsed}if(i){if(N(b))0==c?h(b):c==b.length&&(a=b.nextSibling,a&&a.nodeType==b.nodeType&&(e==a&&(e=b,f+=b.length),b.appendData(a.data),Y(a)));else if(c<b.childNodes.length){var k=b.childNodes[c];k&&N(k)&&h(k)}}else b=e,c=f;d(this,b,c,e,f)},collapseToPoint:function(a,b){r(a,!0),t(a,b),this.setStartAndEnd(a,b)}}),D(b)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:J.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=J.getDocument(b),G(a)}function I(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,G(this)}var J=a.dom,K=a.util,L=J.DomPosition,M=a.DOMException,N=J.isCharacterDataNode,O=J.getNodeIndex,P=J.isOrIsAncestorOf,Q=J.getDocument,R=J.comparePoints,S=J.splitDataNode,T=J.getClosestAncestorIn,U=J.getNodeLength,V=J.arrayContains,W=J.getRootContainer,X=a.features.crashyTextNodes,Y=J.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,N(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!N(c)||c!==this.sc&&c!==this.ec?c.parentNode&&Y(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return c(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new I(d(this.range));var b=this._current,c=b,e=0,f=b,g=U(b);P(b,this.sc)&&(c=this.sc,e=this.so),P(b,this.ec)&&(f=this.ec,g=this.eo),H(a,c,e,f,g)}return new p(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Z=[1,3,4,5,7,8,10],$=[2,9,11],_=[5,6,10,12],aa=[1,3,4,5,7,8,10,11],ba=[1,3,4,5,7,8],ca=q([9,11]),da=q(_),ea=q([6,10,12]),fa=document.createElement("style"),ga=!1;try{fa.innerHTML="<b>x</b>",ga=3==fa.firstChild.nodeType}catch(ha){}a.features.htmlParsingConforms=ga;var ia=ga?function(a){var b=this.startContainer,c=Q(b);if(!b)throw new M("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:N(b)&&(d=J.parentElement(b)),d=null===d||"HTML"==d.nodeName&&J.isHtmlNamespace(Q(d).documentElement)&&J.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,J.fragmentFromNodeChildren(d)}:function(a){var b=d(this),c=b.createElement("body");return c.innerHTML=a,J.fragmentFromNodeChildren(c)},ja=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ka=0,la=1,ma=2,na=3,oa=0,pa=1,qa=2,ra=3;K.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){z(this),u(this.startContainer,b.startContainer);var c,d,e,f,g=a==na||a==ka?"start":"end",h=a==la||a==ka?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],R(c,d,e,f)},insertNode:function(a){if(z(this),s(a,aa),v(this.startContainer),P(a,this.startContainer))throw new M("HIERARCHY_REQUEST_ERR");var b=h(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){z(this);var a,b;if(this.collapsed)return d(this).createDocumentFragment();if(this.startContainer===this.endContainer&&N(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b;var c=new p(this,!0);return a=j(c),c.detach(),a},canSurroundContents:function(){z(this),v(this.startContainer),v(this.endContainer);var a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},surroundContents:function(a){if(s(a,ba),!this.canSurroundContents())throw new M("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);h(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){z(this);for(var a,b=new I(d(this)),c=ja.length;c--;)a=ja[c],b[a]=this[a];return b},toString:function(){z(this);var a=this.startContainer;if(a===this.endContainer&&N(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new p(this,!0);return k(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){z(this);var b=a.parentNode,c=O(a);if(!b)throw new M("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?qa:oa:e>0?pa:ra},comparePoint:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),R(a,b,this.startContainer,this.startOffset)<0?-1:R(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ia,toHtml:function(){return B(this)},intersectsNode:function(a,b){if(z(this),W(a)!=e(this))return!1;var c=a.parentNode,d=O(a);if(!c)return!0;var f=R(c,d,this.endContainer,this.endOffset),g=R(c,d+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),R(a,b,this.startContainer,this.startOffset)>=0&&R(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return i(this,a,!1)},intersectsOrTouchesRange:function(a){return i(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=R(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=R(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==R(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==R(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new M("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ra},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,U(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a);
},getNodes:function(a,b){return z(this),n(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var c=d(this),e=a.createRange(c);b=b||J.getBody(c),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var d,e,f,g,h=[b],i=!1,j=!1;!j&&(d=h.pop());)if(3==d.nodeType)e=c+d.length,!i&&a.start>=c&&a.start<=e&&(this.setStart(d,a.start-c),i=!0),i&&a.end>=c&&a.end<=e&&(this.setEnd(d,a.end-c),j=!0),c=e;else for(g=d.childNodes,f=g.length;f--;)h.push(g[f])},getName:function(){return"DomRange"},equals:function(a){return I.rangesEqual(this,a)},isValid:function(){return y(this)},inspect:function(){return o(this)},detach:function(){}}),F(I,H),K.extend(I,{rangeProperties:ja,RangeIterator:p,copyComparisonConstants:D,createPrototypeRange:F,inspect:o,toHtml:B,getRangeDocument:d,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=I}),H.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function d(a){for(var b,c=m.length;c--;)b=m[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function g(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var k,l,m=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},h.createPrototypeRange(c,g),k=c.prototype,k.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},k.cloneContents=function(){return this.nativeRange.cloneContents()},k.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},k.collapse=function(a){this.nativeRange.collapse(a),d(this)},k.cloneRange=function(){return new c(this.nativeRange.cloneRange())},k.refresh=function(){d(this)},k.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),k.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},k.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},l=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(p){k.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},k.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},l=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}k.setStartBefore=l("setStartBefore","setEndBefore"),k.setStartAfter=l("setStartAfter","setEndAfter"),k.setEndBefore=l("setEndBefore","setStartBefore"),k.setEndAfter=l("setEndAfter","setStartAfter"),k.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var q=document.createRange();q.selectNodeContents(n),q.setEnd(n,4),q.setStart(n,2),-1==o.compareBoundaryPoints(o.START_TO_END,q)&&1==o.compareBoundaryPoints(o.END_TO_START,q)?k.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:k.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var r=document.createElement("div");r.innerHTML="123";var s=r.firstChild,t=i(document);t.appendChild(r),o.setStart(s,1),o.setEnd(s,2),o.deleteContents(),"13"==s.data&&(k.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},k.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),t.removeChild(r),t=null,f.isHostMethod(o,"createContextualFragment")&&(k.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),k.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&e.removeNode(l);for(var m,n,o,p,q,r=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(r,a),0==m||s==u)break;if(-1==m){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(q=l.nextSibling,-1==m&&q&&k(q)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(q.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);-1==(m=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=h.text.length;p=new g(q,w)}else n=(d||!c)&&l.previousSibling,o=(d||c)&&l.nextSibling,p=o&&k(o)?new g(o,0):n&&k(n)?new g(n,n.data.length):new g(i,e.getNodeIndex(l));return e.removeNode(l),{boundaryPosition:p,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f,g,h=a.offset,j=e.getDocument(a.node),l=i(j).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(g=a.node.childNodes,c=h<g.length?g[h]:null,d=a.node),f=j.createElement("span"),f.innerHTML="&#feff;",c?d.insertBefore(f,c):d.appendChild(f),l.moveToElementText(f),l.collapse(!b),d.removeChild(f),m&&l[b?"moveStart":"moveEnd"]("character",h),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d);var p=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d};if(d.rangeToTextRange=p,d.prototype.toTextRange=function(){return p(this)},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var q=function(a){return a("return this;")()}(Function);"undefined"==typeof q.Range&&(q.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},f.createAliasForDeprecatedMethod(a,"createIframeRange","createRange"),f.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange"),a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),H.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(C.isWindow(a))return a;if(a instanceof r)return a.win;var d=C.getContentDocument(a,b,c);return C.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==C.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof F?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof G?c=b.nativeRange:J.implementsDomRange&&b instanceof C.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!C.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&"undefined"!=typeof a.text}function o(a,b){var c=new G(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(n(c))o(b,c);else{b.rangeCount=c.length;for(var d,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}}function q(a,c){for(var d=a.docSelection.createRange(),e=m(c),f=L(d.item(0)),g=M(f).createControlRange(),h=0,i=d.length;i>h;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=ba.length;e--;)if(c=ba[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(ba.splice(e,1),!0):d;return"deleteAll"==b&&(ba.length=0),null}function u(a,c){for(var d,e=L(c[0].startContainer),f=M(e).createControlRange(),g=0,h=c.length;h>g;++g){d=m(c[g]);try{f.add(d)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new H("WRONG_DOCUMENT_ERR")}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=F.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var y,z,A="boolean",B="number",C=a.dom,D=a.util,E=D.isHostMethod,F=a.DomRange,G=a.WrappedRange,H=a.DOMException,I=C.DomPosition,J=a.features,K="Control",L=C.getDocument,M=C.getBody,N=F.rangesEqual,O=E(window,"getSelection"),P=D.isHostObject(document,"selection");J.implementsWinGetSelection=O,J.implementsDocSelection=P;var Q=P&&(!O||a.config.preferTextRange);if(Q)y=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b};else{if(!O)return b.fail("Neither document.selection or window.getSelection() detected."),!1;y=e,a.isSelectionValid=function(){return!0}}a.getNativeSelection=y;var R=y();if(!R)return b.fail("Native selection was null (possibly issue 138?)"),!1;var S=a.createNativeRange(document),T=M(document),U=D.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);J.selectionHasAnchorAndFocus=U;var V=E(R,"extend");J.selectionHasExtend=V;var W=typeof R.rangeCount==B;J.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(b,c){var d=F.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null;D.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==B&&J.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,e=[],f=g(b),h=0;c>h;++h)e[h]=b.getRangeAt(h);var i=C.createTestElement(document,"",!1),j=i.appendChild(document.createTextNode("   ")),k=document.createRange();if(k.setStart(j,1),k.collapse(!0),b.removeAllRanges(),b.addRange(k),Y=1==b.rangeCount,b.removeAllRanges(),!d){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&parseInt(l[1])>=36)X=!1;else{var m=k.cloneRange();k.setStart(j,0),m.setEnd(j,3),m.setStart(j,2),b.addRange(k),b.addRange(m),X=2==b.rangeCount}}for(C.removeNode(i),b.removeAllRanges(),h=0;c>h;++h)0==h&&f?Z?Z(b,e[h]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(e[h])):b.addRange(e[h])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&E(T,"createControlRange")&&($=T.createControlRange(),D.areHostProperties($,["item","add"])&&(_=!0)),J.implementsControlRange=_,z=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var aa;E(R,"getRangeAt")?aa=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:U&&(aa=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype;var ba=[],ca=function(a){if(a&&a instanceof r)return a.refresh(),a;a=d(a,"getNativeSelection");var b=t(a),c=y(a),e=P?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),ba.push({win:a,selection:b})),b};a.getSelection=ca,D.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");var da=r.prototype;if(!Q&&U&&D.areHostMethods(R,["removeAllRanges","addRange"])){da.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)};var ea=function(a,b){Z(a.nativeSelection,b),a.refresh()};W?da.addRange=function(b,d){if(_&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)ea(this,b);else{var e;X?e=this.rangeCount:(this.removeAllRanges(),e=0);var f=k(b).cloneRange();try{this.nativeSelection.addRange(f)}catch(g){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1){if(a.config.checkSelectionRanges){var i=aa(this.nativeSelection,this.rangeCount-1);i&&!N(i,b)&&(b=new G(i))}this._ranges[this.rangeCount-1]=b,h(this,b,ha(this.nativeSelection)),this.isCollapsed=z(this)}else this.refresh()}}:da.addRange=function(a,b){c(b)&&V?ea(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},da.setRanges=function(a){if(_&&P&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(E(R,"empty")&&E(S,"select")&&_&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;da.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=L(this.anchorNode);else if(this.docSelection.type==K){var b=this.docSelection.createRange();b.length&&(a=L(b.item(0)))}if(a){var c=M(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}j(this)},da.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},da.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}da.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new H("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var fa;if(Q)fa=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(E(R,"getRangeAt")&&typeof R.rangeCount==B)fa=function(b){if(_&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],ha(b.nativeSelection)),b.isCollapsed=z(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=A||typeof S.collapsed!=A||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fa=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=aa(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=z(a)):j(a)}}da.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fa(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!N(b[e],this._ranges[e]))return!0;return!1}};var ga=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;e>d;++d)N(b,c[d])||a.addRange(c[d]);a.rangeCount||j(a)};_&&P?da.removeRange=function(a){if(this.docSelection.type==K){for(var b,c=this.docSelection.createRange(),d=m(a),e=L(c.item(0)),f=M(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),p(this)}else ga(this,a)}:da.removeRange=function(a){ga(this,a)};var ha;!Q&&U&&J.implementsDomRange?(ha=g,da.isBackward=function(){return ha(this)}):ha=da.isBackward=function(){return!1},da.isBackwards=da.isBackward,da.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},da.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},da.collapseToStart=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},da.collapseToEnd=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},da.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},da.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==K){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),C.removeNode(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}}},da.eachRange=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(a(this.getRangeAt(c)))return b},da.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},da.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},da.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b||[]))}),c},da.setStart=w(!0),da.setEnd=w(!1),a.rangePrototype.select=function(a){ca(this.getDocument()).setSingleRange(this,a)},da.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},da.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},da.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},da.moveToBookmark=function(b){for(var c,d,e=[],f=0;c=b.rangeBookmarks[f++];)d=a.createRange(this.win),d.moveToBookmark(c),e.push(d);b.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)},da.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},da.restoreRanges=function(a){this.removeAllRanges();for(var b,c=0;b=a.ranges[c];++c)this.addRange(b,a.backward&&0==c)},da.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(F.toHtml(b))}),a.join("")},J.implementsTextRange&&(da.getNativeTextRange=function(){var c;if(c=this.docSelection){var d=c.createRange();if(n(d))return d;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),da.getName=function(){return"WrappedSelection"},da.inspect=function(){return x(this)},da.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=da,a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ca(a)}),a=null})});var M=!1,N=function(a){M||(M=!0,!H.initialized&&H.config.autoInitialize&&l())};return F&&("complete"==document.readyState?N():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),J(window,"load",N))),H},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("TextRange",["WrappedSelection"],function(a,b){function c(a,b){function c(a,b,c){h.push({start:a,end:b,isWord:c})}for(var d,e,f,g=a.join(""),h=[],i=0;d=b.wordRegex.exec(g);){if(e=d.index,f=e+d[0].length,e>i&&c(i,e,!1),b.includeTrailingSpace)for(;$.test(a[f]);)++f;c(e,f,!0),i=f}return i<a.length&&c(i,a.length,!1),h}function d(a,b){for(var c=a.slice(b.start,b.end),d={isWord:b.isWord,chars:c,toString:function(){return c.join("")}},e=0,f=c.length;f>e;++e)c[e].token=d;return d}function e(a,b,c){for(var e,f=c(a,b),g=[],h=0;e=f[h++];)g.push(d(a,e));return g}function f(a){var b=a||"",c="string"==typeof b?b.split(""):b;return c.sort(function(a,b){return a.charCodeAt(0)-b.charCodeAt(0)}),c.join("").replace(/(.)\1+/g,"$1")}function g(a){var b,c;return a?(b=a.language||_,c={},U(c,ia[b]||ia[_]),U(c,a),c):ia[_]}function h(a,b){var c=V(a,b);return b.hasOwnProperty("wordOptions")&&(c.wordOptions=g(c.wordOptions)),b.hasOwnProperty("characterOptions")&&(c.characterOptions=V(c.characterOptions,ga)),c}function i(a,b){var c=na(a,"display",b),d=a.tagName.toLowerCase();return"block"==c&&fa&&oa.hasOwnProperty(d)?oa[d]:c}function j(a){for(var b=o(a),c=0,d=b.length;d>c;++c)if(1==b[c].nodeType&&"none"==i(b[c]))return!0;return!1}function k(a){var b;return 3==a.nodeType&&(b=a.parentNode)&&"hidden"==na(b,"visibility")}function l(a){return a&&(1==a.nodeType&&!/^(inline(-block|-table)?|none)$/.test(i(a))||9==a.nodeType||11==a.nodeType)}function m(a){return S.isCharacterDataNode(a)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(a.nodeName)}function n(a){for(var b=[];a.parentNode;)b.unshift(a.parentNode),a=a.parentNode;return b}function o(a){return n(a).concat([a])}function p(a){for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null}function q(a,b){return!b&&a.hasChildNodes()?a.firstChild:p(a)}function r(a){var b=a.previousSibling;if(b){for(a=b;a.hasChildNodes();)a=a.lastChild;return a}var c=a.parentNode;return c&&1==c.nodeType?c:null}function s(a){if(!a||3!=a.nodeType)return!1;var b=a.data;if(""===b)return!0;var c=a.parentNode;if(!c||1!=c.nodeType)return!1;var d=na(a.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(d)||/^[\t\r ]+$/.test(b)&&"pre-line"==d}function t(a){if(""===a.data)return!0;if(!s(a))return!1;var b=a.parentNode;return b?j(a)?!0:!1:!0}function u(a){var b=a.nodeType;return 7==b||8==b||j(a)||/^(script|style)$/i.test(a.nodeName)||k(a)||t(a)}function v(a,b){var c=a.nodeType;return 7==c||8==c||1==c&&"none"==i(a,b)}function w(){this.store={}}function x(a,b,c){return function(d){var e=this.cache;if(e.hasOwnProperty(a))return pa++,e[a];qa++;var f=b.call(this,c?this[c]:this,d);return e[a]=f,f}}function y(a,b){this.node=a,this.session=b,this.cache=new w,this.positions=new w}function z(a,b){this.offset=b,this.nodeWrapper=a,this.node=a.node,this.session=a.session,this.cache=new w}function A(){return"[Position("+S.inspectNode(this.node)+":"+this.offset+")]"}function B(){return D(),Da=new Ea}function C(){return Da||B()}function D(){Da&&Da.detach(),Da=null}function E(a,c,d,e){function f(){var a=null;return c?(a=h,i||(h=h.previousVisible(),i=!h||d&&h.equals(d))):i||(a=h=h.nextVisible(),i=!h||d&&h.equals(d)),i&&(h=null),a}d&&(c?u(d.node)&&(d=a.previousVisible()):u(d.node)&&(d=d.nextVisible()));var g,h=a,i=!1,j=!1;return{next:function(){if(j)return j=!1,g;for(var a,b;a=f();)if(b=a.getCharacter(e))return g=a,a;return null},rewind:function(){if(!g)throw b.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");j=!0},dispose:function(){a=d=null}}}function F(a,b,c){function d(a){for(var b,c,d=[],e=a?f:g,h=!1,i=!1;b=e.next();){if(c=b.character,Z.test(c))i&&(i=!1,h=!0);else{if(h){e.rewind();break}i=!0}d.push(b)}return d}var f=E(a,!1,null,b),g=E(a,!0,null,b),h=c.tokenizer,i=d(!0),j=d(!1).reverse(),k=e(j.concat(i),c,h),l=i.length?k.slice(Fa(k,i[0].token)):[],m=j.length?k.slice(0,Fa(k,j.pop().token)+1):[];return{nextEndToken:function(){for(var a,b;1==l.length&&!(a=l[0]).isWord&&(b=d(!0)).length>0;)l=e(a.chars.concat(b),c,h);return l.shift()},previousStartToken:function(){for(var a,b;1==m.length&&!(a=m[0]).isWord&&(b=d(!1)).length>0;)m=e(b.reverse().concat(a.chars),c,h);return m.pop()},dispose:function(){f.dispose(),g.dispose(),l=m=null}}}function G(a,b,c,d,e){var f,g,h,i,j=0,k=a,l=Math.abs(c);if(0!==c){var m=0>c;switch(b){case Q:for(g=E(a,m,null,d);(f=g.next())&&l>j;)++j,k=f;h=f,g.dispose();break;case R:for(var n=F(a,d,e),o=m?n.previousStartToken:n.nextEndToken;(i=o())&&l>j;)i.isWord&&(++j,k=m?i.chars[0]:i.chars[i.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+b+"' not implemented")}m?(k=k.previousVisible(),j=-j):k&&k.isLeadingSpace&&!k.isTrailingSpace&&(b==R&&(g=E(a,!1,null,d),h=g.next(),g.dispose()),h&&(k=h.previousVisible()))}return{position:k,unitsMoved:j}}function H(a,b,c,d){var e=a.getRangeBoundaryPosition(b,!0),f=a.getRangeBoundaryPosition(b,!1),g=d?f:e,h=d?e:f;return E(g,!!d,h,c)}function I(a,b,c){for(var d,e=[],f=H(a,b,c);d=f.next();)e.push(d);return f.dispose(),e}function J(b,c,d){var e=a.createRange(b.node);return e.setStartAndEnd(b.node,b.offset,c.node,c.offset),!e.expand("word",{wordOptions:d})}function K(a,b,c,d,e){function f(a,b){var c=p[a].previousVisible(),d=p[b-1],f=!e.wholeWordsOnly||J(c,d,e.wordOptions);return{startPos:c,endPos:d,valid:f}}for(var g,h,i,j,k,l,m=aa(e.direction),n=E(a,m,a.session.getRangeBoundaryPosition(d,m),e.characterOptions),o="",p=[],q=null;g=n.next();)if(h=g.character,c||e.caseSensitive||(h=h.toLowerCase()),m?(p.unshift(g),o=h+o):(p.push(g),o+=h),c){if(k=b.exec(o))if(i=k.index,j=i+k[0].length,l){if(!m&&j<o.length||m&&i>0){q=f(i,j);break}}else l=!0}else if(-1!=(i=o.indexOf(b))){q=f(i,i+b.length);break}return l&&(q=f(i,j)),n.dispose(),q}function L(a){return function(){var b=!!Da,c=C(),d=[c].concat(T.toArray(arguments)),e=a.apply(this,d);return b||D(),e}}function M(a,b){return L(function(c,d,e,f){typeof e==P&&(e=d,d=Q),f=h(f,ka);var g=a;b&&(g=e>=0,this.collapse(!g));var i=G(c.getRangeBoundaryPosition(this,g),d,e,f.characterOptions,f.wordOptions),j=i.position;return this[g?"setStart":"setEnd"](j.node,j.offset),i.unitsMoved})}function N(a){return L(function(b,c){c=V(c,ga);for(var d,e=H(b,this,c,!a),f=0;(d=e.next())&&Z.test(d.character);)++f;e.dispose();var g=f>0;return g&&this[a?"moveStart":"moveEnd"]("character",a?f:-f,{characterOptions:c}),g})}function O(a){return L(function(b,c){var d=!1;return this.changeEachRange(function(b){d=b[a](c)||d}),d})}var P="undefined",Q="character",R="word",S=a.dom,T=a.util,U=T.extend,V=T.createOptions,W=S.getBody,X=/^[ \t\f\r\n]+$/,Y=/^[ \t\f\r]+$/,Z=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,$=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,_="en",aa=a.Selection.isDirectionBackward,ba=!1,ca=!1,da=!1,ea=!0;!function(){var b=S.createTestElement(document,"<p>1 </p><p></p>",!0),c=b.firstChild,d=a.getSelection();d.collapse(c.lastChild,2),d.setStart(c.firstChild,0),ba=1==(""+d).length,b.innerHTML="1 <br />",d.collapse(b,2),d.setStart(b.firstChild,0),ca=1==(""+d).length,b.innerHTML="1 <p>1</p>",d.collapse(b,2),d.setStart(b.firstChild,0),da=1==(""+d).length,S.removeNode(b),d.removeAllRanges()}();var fa,ga={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},ha={includeBlockContentTrailingSpace:!ea,includeSpaceBeforeBr:!ca,includeSpaceBeforeBlock:!da,includePreLineTrailingSpace:!0},ia={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:c}},ja={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},ka={wordOptions:null,characterOptions:null},la={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ma={wordOptions:null,characterOptions:null,direction:"forward"},na=S.getComputedStyleProperty;!function(){var a=document.createElement("table"),b=W(document);b.appendChild(a),fa="block"==na(a,"display"),b.removeChild(a)}();var oa={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};w.prototype={get:function(a){return this.store.hasOwnProperty(a)?this.store[a]:null},set:function(a,b){return this.store[a]=b}};var pa=0,qa=0,ra={getPosition:function(a){var b=this.positions;return b.get(a)||b.set(a,new z(this,a))},toString:function(){return"[NodeWrapper("+S.inspectNode(this.node)+")]"}};y.prototype=ra;var sa="EMPTY",ta="NON_SPACE",ua="UNCOLLAPSIBLE_SPACE",va="COLLAPSIBLE_SPACE",wa="TRAILING_SPACE_BEFORE_BLOCK",xa="TRAILING_SPACE_IN_BLOCK",ya="TRAILING_SPACE_BEFORE_BR",za="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Aa="TRAILING_LINE_BREAK_AFTER_BR",Ba="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";U(ra,{isCharacterDataNode:x("isCharacterDataNode",S.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",S.getNodeIndex,"node"),getLength:x("nodeLength",S.getNodeLength,"node"),containsPositions:x("containsPositions",m,"node"),isWhitespace:x("isWhitespace",s,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",t,"node"),getComputedDisplay:x("computedDisplay",i,"node"),isCollapsed:x("collapsed",u,"node"),isIgnored:x("ignored",v,"node"),next:x("nextPos",q,"node"),previous:x("previous",r,"node"),getTextNodeInfo:x("textNodeInfo",function(a){var b=null,c=!1,d=na(a.parentNode,"whiteSpace"),e="pre-line"==d;return e?(b=Y,c=!0):("normal"==d||"nowrap"==d)&&(b=X,c=!0),{node:a,text:a.data,spaceRegex:b,collapseSpaces:c,preLine:e}},"node"),hasInnerText:x("hasInnerText",function(a,b){for(var c=this.session,d=c.getPosition(a.parentNode,this.getNodeIndex()+1),e=c.getPosition(a,0),f=b?d:e,g=b?e:d;f!==g;){
if(f.prepopulateChar(),f.isDefinitelyNonEmpty())return!0;f=b?f.previousVisible():f.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(a){for(var b=a.getElementsByTagName("br"),c=0,d=b.length;d>c;++c)if(!u(b[c]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(a){if("br"==a.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var b=a.lastChild;b;){if(!v(b))return 1==b.nodeType?this.session.getNodeWrapper(b).getTrailingSpace():"";b=b.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(a){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var Ca={character:"",characterType:sa,isBr:!1,prepopulateChar:function(){var a=this;if(!a.prepopulatedChar){var b=a.node,c=a.offset,d="",e=sa,f=!1;if(c>0)if(3==b.nodeType){var g=b.data,h=g.charAt(c-1),i=a.nodeWrapper.getTextNodeInfo(),j=i.spaceRegex;i.collapseSpaces?j.test(h)?c>1&&j.test(g.charAt(c-2))||(i.preLine&&"\n"===g.charAt(c)?(d=" ",e=za):(d=" ",e=va)):(d=h,e=ta,f=!0):(d=h,e=ua,f=!0)}else{var k=b.childNodes[c-1];if(k&&1==k.nodeType&&!u(k)&&("br"==k.tagName.toLowerCase()?(d="\n",a.isBr=!0,e=va,f=!1):a.checkForTrailingSpace=!0),!d){var l=b.childNodes[c];l&&1==l.nodeType&&!u(l)&&(a.checkForLeadingSpace=!0)}}a.prepopulatedChar=!0,a.character=d,a.characterType=e,a.isCharInvariant=f}},isDefinitelyNonEmpty:function(){var a=this.characterType;return a==ta||a==ua},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var a=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();a&&(this.isTrailingSpace=!0,this.character=a,this.characterType=va),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var b=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();b&&(this.isLeadingSpace=!0,this.character=b,this.characterType=va),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(a){for(var b,c=this;c=c.previousVisible();)if(b=c.getCharacter(a),""!==b)return c;return null},getCharacter:function(a){function b(){return n||(k=o.getPrecedingUncollapsedPosition(a),n=!0),k}this.resolveLeadingAndTrailingSpaces();var c,d=this.character,e=f(a.ignoreCharacters),g=""!==d&&e.indexOf(d)>-1;if(this.isCharInvariant)return c=g?"":d;var h=["character",a.includeSpaceBeforeBr,a.includeBlockContentTrailingSpace,a.includePreLineTrailingSpace,e].join("_"),i=this.cache.get(h);if(null!==i)return i;var j,k,l="",m=this.characterType==va,n=!1,o=this;return m&&(this.type==Ba?l="\n":" "==d&&(!b()||k.isTrailingSpace||"\n"==k.character||" "==k.character&&k.characterType==va)||("\n"==d&&this.isLeadingSpace?b()&&"\n"!=k.character&&(l="\n"):(j=this.nextUncollapsed(),j&&(j.isBr?this.type=ya:j.isTrailingSpace&&"\n"==j.character?this.type=xa:j.isLeadingSpace&&"\n"==j.character&&(this.type=wa),"\n"==j.character?(this.type!=ya||a.includeSpaceBeforeBr)&&(this.type!=wa||a.includeSpaceBeforeBlock)&&(this.type==xa&&j.isTrailingSpace&&!a.includeBlockContentTrailingSpace||(this.type!=za||j.type!=ta||a.includePreLineTrailingSpace)&&("\n"==d?j.isTrailingSpace?this.isTrailingSpace||this.isBr&&(j.type=Aa,b()&&k.isLeadingSpace&&!k.isTrailingSpace&&"\n"==k.character?j.character="":j.type=Ba):l="\n":" "==d&&(l=" "))):l=d)))),e.indexOf(l)>-1&&(l=""),this.cache.set(h,l),l},equals:function(a){return!!a&&this.node===a.node&&this.offset===a.offset},inspect:A,toString:function(){return this.character}};z.prototype=Ca,U(Ca,{next:x("nextPos",function(a){var b=a.nodeWrapper,c=a.node,d=a.offset,e=b.session;if(!c)return null;var f,g,h;return d==b.getLength()?(f=c.parentNode,g=f?b.getNodeIndex()+1:0):b.isCharacterDataNode()?(f=c,g=d+1):(h=c.childNodes[d],e.getNodeWrapper(h).containsPositions()?(f=h,g=0):(f=c,g=d+1)),f?e.getPosition(f,g):null}),previous:x("previous",function(a){var b,c,d,e=a.nodeWrapper,f=a.node,g=a.offset,h=e.session;return 0==g?(b=f.parentNode,c=b?e.getNodeIndex():0):e.isCharacterDataNode()?(b=f,c=g-1):(d=f.childNodes[g-1],h.getNodeWrapper(d).containsPositions()?(b=d,c=S.getNodeLength(d)):(b=f,c=g-1)),b?h.getPosition(b,c):null}),nextVisible:x("nextVisible",function(a){var b=a.next();if(!b)return null;var c=b.nodeWrapper,d=b.node,e=b;return c.isCollapsed()&&(e=c.session.getPosition(d.parentNode,c.getNodeIndex()+1)),e}),nextUncollapsed:x("nextUncollapsed",function(a){for(var b=a;b=b.nextVisible();)if(b.resolveLeadingAndTrailingSpaces(),""!==b.character)return b;return null}),previousVisible:x("previousVisible",function(a){var b=a.previous();if(!b)return null;var c=b.nodeWrapper,d=b.node,e=b;return c.isCollapsed()&&(e=c.session.getPosition(d.parentNode,c.getNodeIndex())),e})});var Da=null,Ea=function(){function a(a){var b=new w;return{get:function(c){var d=b.get(c[a]);if(d)for(var e,f=0;e=d[f++];)if(e.node===c)return e;return null},set:function(c){var d=c.node[a],e=b.get(d)||b.set(d,[]);e.push(c)}}}function b(){this.initCaches()}var c=T.isHostProperty(document.documentElement,"uniqueID");return b.prototype={initCaches:function(){this.elementCache=c?function(){var a=new w;return{get:function(b){return a.get(b.uniqueID)},set:function(b){a.set(b.node.uniqueID,b)}}}():a("tagName"),this.textNodeCache=a("data"),this.otherNodeCache=a("nodeName")},getNodeWrapper:function(a){var b;switch(a.nodeType){case 1:b=this.elementCache;break;case 3:b=this.textNodeCache;break;default:b=this.otherNodeCache}var c=b.get(a);return c||(c=new y(a,this),b.set(c)),c},getPosition:function(a,b){return this.getNodeWrapper(a).getPosition(b)},getRangeBoundaryPosition:function(a,b){var c=b?"start":"end";return this.getPosition(a[c+"Container"],a[c+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},b}();U(S,{nextNode:q,previousNode:r});var Fa=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]===b)return c;return-1};U(a.rangePrototype,{moveStart:M(!0,!1),moveEnd:M(!1,!1),move:M(!0,!0),trimStart:N(!0),trimEnd:N(!1),trim:L(function(a,b){var c=this.trimStart(b),d=this.trimEnd(b);return c||d}),expand:L(function(a,b,c){var d=!1;c=h(c,la);var e=c.characterOptions;if(b||(b=Q),b==R){var f,g,i=c.wordOptions,j=a.getRangeBoundaryPosition(this,!0),k=a.getRangeBoundaryPosition(this,!1),l=F(j,e,i),m=l.nextEndToken(),n=m.chars[0].previousVisible();if(this.collapsed)f=m;else{var o=F(k,e,i);f=o.previousStartToken()}return g=f.chars[f.chars.length-1],n.equals(j)||(this.setStart(n.node,n.offset),d=!0),g&&!g.equals(k)&&(this.setEnd(g.node,g.offset),d=!0),c.trim&&(c.trimStart&&(d=this.trimStart(e)||d),c.trimEnd&&(d=this.trimEnd(e)||d)),d}return this.moveEnd(Q,1,c)}),text:L(function(a,b){return this.collapsed?"":I(a,this,V(b,ga)).join("")}),selectCharacters:L(function(a,b,c,d,e){var f={characterOptions:e};b||(b=W(this.getDocument())),this.selectNodeContents(b),this.collapse(!0),this.moveStart("character",c,f),this.collapse(!0),this.moveEnd("character",d-c,f)}),toCharacterRange:L(function(a,b,c){b||(b=W(this.getDocument()));var d,e,f=b.parentNode,g=S.getNodeIndex(b),h=-1==S.comparePoints(this.startContainer,this.endContainer,f,g),i=this.cloneRange();return h?(i.setStartAndEnd(this.startContainer,this.startOffset,f,g),d=-i.text(c).length):(i.setStartAndEnd(f,g,this.startContainer,this.startOffset),d=i.text(c).length),e=d+this.text(c).length,{start:d,end:e}}),findText:L(function(b,c,d){d=h(d,ja),d.wholeWordsOnly&&(d.wordOptions.includeTrailingSpace=!1);var e=aa(d.direction),f=d.withinRange;f||(f=a.createRange(),f.selectNodeContents(this.getDocument()));var g=c,i=!1;"string"==typeof g?d.caseSensitive||(g=g.toLowerCase()):i=!0;var j=b.getRangeBoundaryPosition(this,!e),k=f.comparePoint(j.node,j.offset);-1===k?j=b.getRangeBoundaryPosition(f,!0):1===k&&(j=b.getRangeBoundaryPosition(f,!1));for(var l,m=j,n=!1;;)if(l=K(m,g,i,f,d)){if(l.valid)return this.setStartAndEnd(l.startPos.node,l.startPos.offset,l.endPos.node,l.endPos.offset),!0;m=e?l.startPos:l.endPos}else{if(!d.wrap||n)return!1;f=f.cloneRange(),m=b.getRangeBoundaryPosition(f,!e),f.setBoundary(j.node,j.offset,e),n=!0}}),pasteHtml:function(a){if(this.deleteContents(),a){var b=this.createContextualFragment(a),c=b.lastChild;this.insertNode(b),this.collapseAfter(c)}}}),U(a.selectionPrototype,{expand:L(function(a,b,c){this.changeEachRange(function(a){a.expand(b,c)})}),move:L(function(a,b,c,d){var e=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var f=this.getRangeAt(0);d||(d={}),d.characterOptions=V(d.characterOptions,ha),e=f.move(b,c,d),this.setSingleRange(f)}return e}),trimStart:O("trimStart"),trimEnd:O("trimEnd"),trim:O("trim"),selectCharacters:L(function(b,c,d,e,f,g){var h=a.createRange(c);h.selectCharacters(c,d,e,g),this.setSingleRange(h,f)}),saveCharacterRanges:L(function(a,b,c){for(var d=this.getAllRanges(),e=d.length,f=[],g=1==e&&this.isBackward(),h=0,i=d.length;i>h;++h)f[h]={characterRange:d[h].toCharacterRange(b,c),backward:g,characterOptions:c};return f}),restoreCharacterRanges:L(function(b,c,d){this.removeAllRanges();for(var e,f,g,h=0,i=d.length;i>h;++h)f=d[h],g=f.characterRange,e=a.createRange(c),e.selectCharacters(c,g.start,g.end,f.characterOptions),this.addRange(e,f.backward)}),text:L(function(a,b){for(var c=[],d=0,e=this.rangeCount;e>d;++d)c[d]=this.getRangeAt(d).text(b);return c.join("")})}),a.innerText=function(b,c){var d=a.createRange(b);d.selectNodeContents(b);var e=d.text(c);return e},a.createWordIterator=function(a,b,c){var d=C();c=h(c,ma);var e=d.getPosition(a,b),f=F(e,c.characterOptions,c.wordOptions),g=aa(c.direction);return{next:function(){return g?f.previousStartToken():f.nextEndToken()},dispose:function(){f.dispose(),this.next=function(){}}}},a.noMutation=function(a){var b=C();a(b),D()},a.noMutation.createEntryPointFunction=L,a.textRange={isBlockNode:l,isCollapsedWhitespaceNode:t,createPosition:L(function(a,b,c){return a.getPosition(b,c)})}}),a},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("SaveRestore",["WrappedRange"],function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=o.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(r)),f.insertNode(c),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),p(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(b,c){var e,f,g=a.DomRange.getRangeDocument(b),h=b.toString(),i=q(c);return b.collapsed?(f=d(b,!1),{document:g,markerId:f.id,collapsed:!0}):(f=d(b,!1),e=d(b,!0),{document:g,startMarkerId:e.id,endMarkerId:f.id,collapsed:!1,backward:i,toString:function(){return"original text: '"+h+"', new text: '"+b.toString()+"'"}})}function h(d,f){var g=d.document;"undefined"==typeof f&&(f=!0);var h=a.createRange(g);if(d.collapsed){var i=c(d.markerId,g);if(i){i.style.display="inline";var j=i.previousSibling;j&&3==j.nodeType?(p(i),h.collapseToPoint(j,j.length)):(h.collapseBefore(i),p(i))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(g,h,d.startMarkerId,!0),e(g,h,d.endMarkerId,!1);return f&&h.normalizeBoundaries(),h}function i(b,d){var e,h,i=[],j=q(d);b=b.slice(0),b.sort(f);for(var k=0,l=b.length;l>k;++k)i[k]=g(b[k],j);for(k=l-1;k>=0;--k)e=b[k],h=a.DomRange.getRangeDocument(e),e.collapsed?e.collapseAfter(c(i[k].markerId,h)):(e.setEndBefore(c(i[k].endMarkerId,h)),e.setStartAfter(c(i[k].startMarkerId,h)));return i}function j(c){if(!a.isSelectionValid(c))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(c),e=d.getAllRanges(),f=1==e.length&&d.isBackward(),g=i(e,f);return f?d.setSingleRange(e[0],f):d.setRanges(e),{win:c,rangeInfos:g,restored:!1}}function k(a){for(var b=[],c=a.length,d=c-1;d>=0;d--)b[d]=h(a[d],!0);return b}function l(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=k(d),g=d.length;1==g&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0}}function m(a,b){var d=c(b,a);d&&p(d)}function n(a){for(var b,c=a.rangeInfos,d=0,e=c.length;e>d;++d)b=c[d],b.collapsed?m(a.doc,b.markerId):(m(a.doc,b.startMarkerId),m(a.doc,b.endMarkerId))}var o=a.dom,p=o.removeNode,q=a.Selection.isDirectionBackward,r="\ufeff";a.util.extend(a,{saveRange:g,restoreRange:h,saveRanges:i,restoreRanges:k,saveSelection:j,restoreSelection:l,removeMarkerElement:m,removeMarkers:n})}),a},this);var Base=function(){};Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},Base.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;Base._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function a(a){return+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function b(a){return+(a.match(/android (\d+)/)||[void 0,0])[1]}function c(a,b){var c,d=-1;return"Microsoft Internet Explorer"==navigator.appName?c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(navigator.userAgent.indexOf("Trident")>-1?c=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(c=/Edge\/(\d+)./i)),c&&null!=c.exec(navigator.userAgent)&&(d=parseFloat(RegExp.$1)),-1===d?!1:a?b?"<"===b?d>a:">"===b?a>d:"<="===b?d>=a:">="===b?a>=d:void 0:a===d:!0}var d=navigator.userAgent,e=document.createElement("div"),f=-1!==d.indexOf("Gecko")&&-1===d.indexOf("KHTML"),g=-1!==d.indexOf("AppleWebKit/"),h=-1!==d.indexOf("Chrome/"),i=-1!==d.indexOf("Opera/");return{USER_AGENT:d,supported:function(){var c=this.USER_AGENT.toLowerCase(),d="contentEditable"in e,f=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,g=document.querySelector&&document.querySelectorAll,h=this.isIos()&&a(c)<5||this.isAndroid()&&b(c)<4||-1!==c.indexOf("opera mobi")||-1!==c.indexOf("hpwos/");return d&&f&&g&&!h},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return c()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return c(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in e},insertsLineBreaksOnReturn:function(){return f},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){return"on"+a in e||function(){return e.setAttribute("on"+a,"return;"),"function"==typeof e["on"+a]}()},supportsEventsInIframeCorrectly:function(){return!i},supportsHTML5Tags:function(a){var b=a.createElement("div"),c="<article>foo</article>";return b.innerHTML=c,b.innerHTML.toLowerCase()===c},supportsCommand:function(){var a={formatBlock:c(10,"<="),insertUnorderedList:c(9,">=")||c(12,"<="),insertOrderedList:c(9,">=")||c(12,"<=")},b={insertHTML:f};return function(c,d){var e=a[d];if(!e){try{return c.queryCommandSupported(d)}catch(f){}try{return c.queryCommandEnabled(d)}catch(g){return!!b[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return c()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return f||i||g},supportsGetAttributeCorrectly:function(){var a=document.createElement("td");return"1"!=a.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return f||c()||i},autoScrollsToCaret:function(){return!g},autoClosesUnclosedTags:function(){var a,b,c=e.cloneNode(!1);return c.innerHTML="<p><div></div>",b=c.innerHTML.toLowerCase(),a="<p></p><div></div>"===b||"<p><div></div></p>"===b,this.autoClosesUnclosedTags=function(){return a},a},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return i},supportsSpeechApiOn:function(a){var b=d.match(/Chrome\/(\d+)/)||[void 0,0];return b[1]>=11&&("onwebkitspeechchange"in a||"speech"in a)},crashesWhenDefineProperty:function(a){return c(9)&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return c(12,">")},hasProblemsSettingCaretAfterImg:function(){return c()},hasUndoInContextMenu:function(){return f||h||i},hasInsertNodeIssue:function(){return i},hasIframeFocusIssue:function(){return c()},createsNestedInvalidMarkupAfterPaste:function(){return g},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!c()},fixStyleKey:function(a){return"cssFloat"===a?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":a}}}(),wysihtml5.lang.array=function(a){return{contains:function(b){if(Array.isArray(b)){for(var c=b.length;c--;)if(-1!==wysihtml5.lang.array(a).indexOf(b[c]))return!0;return!1}return-1!==wysihtml5.lang.array(a).indexOf(b)},indexOf:function(b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},without:function(b){b=wysihtml5.lang.array(b);for(var c=[],d=0,e=a.length;e>d;d++)b.contains(a[d])||c.push(a[d]);return c},get:function(){for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b]);return d},map:function(b,c){if(Array.prototype.map)return a.map(b,c);for(var d=a.length>>>0,e=new Array(d),f=0;d>f;f++)e[f]=b.call(c,a[f],f,a);return e},unique:function(){for(var b=[],c=a.length,d=0;c>d;)wysihtml5.lang.array(b).contains(a[d])||b.push(a[d]),d++;return b}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(a,b){return this.events=this.events||{},this.events[a]=this.events[a]||[],this.events[a].push(b),this},off:function(a,b){this.events=this.events||{};var c,d,e=0;if(a){for(c=this.events[a]||[],d=[];e<c.length;e++)c[e]!==b&&b&&d.push(c[e]);this.events[a]=d}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var c=this.events[a]||[],d=0;d<c.length;d++)c[d].call(this,b);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(a){return{merge:function(b,c){for(var d in b)c&&wysihtml5.lang.object(b[d]).isPlainObject()&&("undefined"==typeof a[d]||wysihtml5.lang.object(a[d]).isPlainObject())?"undefined"==typeof a[d]?a[d]=wysihtml5.lang.object(b[d]).clone(!0):wysihtml5.lang.object(a[d]).merge(wysihtml5.lang.object(b[d]).clone(!0)):a[d]=wysihtml5.lang.object(b[d]).isPlainObject()?wysihtml5.lang.object(b[d]).clone(!0):b[d];return this},difference:function(b){var c={};for(var d in a)a.hasOwnProperty(d)&&(b.hasOwnProperty(d)||(c[d]=a[d]));for(var e in b)b.hasOwnProperty(e)&&(a.hasOwnProperty(e)&&a[e]===b[e]||(c[0]=a[0]));return c},get:function(){return a},clone:function(b){var c,d={};if(null===a||!wysihtml5.lang.object(a).isPlainObject())return a;for(c in a)a.hasOwnProperty(c)&&(b?d[c]=wysihtml5.lang.object(a[c]).clone(b):d[c]=a[c]);return d},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},isPlainObject:function(){return a&&"[object Object]"===Object.prototype.toString.call(a)&&!("Node"in window?a instanceof Node:a instanceof Element||a instanceof Text)},isEmpty:function(){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}}},function(){var a=/^\s+/,b=/\s+$/,c=/[&<>\t"]/g,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(e){return e=String(e),{trim:function(){return e.replace(a,"").replace(b,"")},interpolate:function(a){for(var b in a)e=this.replace("#{"+b+"}").by(a[b]);return e},replace:function(a){return{by:function(b){return e.split(a).join(b)}}},escapeHTML:function(a,b){var f=e.replace(c,function(a){return d[a]});return a&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),b&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(a){function b(a,b){return f(a,b)?a:(a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body),g(a,b))}function c(a){return a.replace(i,function(a,b){var c=(b.match(j)||[])[1]||"",d=l[c];b=b.replace(j,""),b.split(d).length>b.split(c).length&&(b+=c,c="");var e=b,f=b;return b.length>k&&(f=f.substr(0,k)+"..."),"www."===e.substr(0,4)&&(e="http://"+e),'<a href="'+e+'">'+f+"</a>"+c})}function d(a){var b=a._wysihtml5_tempElement;return b||(b=a._wysihtml5_tempElement=a.createElement("div")),b}function e(b){var e=b.parentNode,f=a.lang.string(b.data).escapeHTML(),g=d(e.ownerDocument);for(g.innerHTML="<span></span>"+c(f),g.removeChild(g.firstChild);g.firstChild;)e.insertBefore(g.firstChild,b);e.removeChild(b)}function f(b,c){for(var d;b.parentNode;){if(b=b.parentNode,d=b.nodeName,b.className&&a.lang.array(b.className.split(" ")).contains(c))return!0;if(h.contains(d))return!0;if("body"===d)return!1}return!1}function g(b,c){if(!(h.contains(b.nodeName)||b.className&&a.lang.array(b.className.split(" ")).contains(c))){if(b.nodeType===a.TEXT_NODE&&b.data.match(i))return void e(b);for(var d=a.lang.array(b.childNodes).get(),f=d.length,j=0;f>j;j++)g(d[j],c);return b}}var h=a.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),i=/((https?:\/\/|www\.)[^\s<]{3,})/gi,j=/([^\w\/\-](,?))$/i,k=100,l={")":"(","]":"[","}":"{"};a.dom.autoLink=b,a.dom.autoLink.URL_REG_EXP=i}(wysihtml5),function(a){var b=a.dom;b.addClass=function(a,c){var d=a.classList;return d?d.add(c):void(b.hasClass(a,c)||(a.className+=" "+c))},b.removeClass=function(a,b){var c=a.classList;return c?c.remove(b):void(a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))},b.hasClass=function(a,b){var c=a.classList;if(c)return c.contains(b);var d=a.className;return d.length>0&&(d==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(d))}}(wysihtml5),wysihtml5.dom.contains=function(){var a=document.documentElement;return a.contains?function(a,b){if(b.nodeType!==wysihtml5.ELEMENT_NODE){if(b.parentNode===a)return!0;b=b.parentNode}return a!==b&&a.contains(b)}:a.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:void 0}(),wysihtml5.dom.convertToList=function(){function a(a,b){var c=a.createElement("li");return b.appendChild(c),c}function b(a,b){return a.createElement(b)}function c(c,d,e){if("UL"===c.nodeName||"OL"===c.nodeName||"MENU"===c.nodeName)return c;var f,g,h,i,j,k,l,m,n,o=c.ownerDocument,p=b(o,d),q=c.querySelectorAll("br"),r=q.length;for(n=0;r>n;n++)for(i=q[n];(j=i.parentNode)&&j!==c&&j.lastChild===i;){if("block"===wysihtml5.dom.getStyle("display").from(j)){j.removeChild(i);break}wysihtml5.dom.insert(i).after(i.parentNode)}for(f=wysihtml5.lang.array(c.childNodes).get(),g=f.length,n=0;g>n;n++)m=m||a(o,p),h=f[n],k="block"===wysihtml5.dom.getStyle("display").from(h),l="BR"===h.nodeName,!k||e&&wysihtml5.dom.hasClass(h,e)?l?m=m.firstChild?null:m:m.appendChild(h):(m=m.firstChild?a(o,p):m,m.appendChild(h),m=null);return 0===f.length&&a(o,p),c.parentNode.replaceChild(p,c),p}return c}(),wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var d,e=0,f=a.length;f>e;e++)d=a[e],"undefined"!=typeof b[d]&&""!==b[d]&&(c[d]=b[d]);return{andTo:arguments.callee}}}}}},function(a){var b=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],c=function(b){return d(b)?parseInt(a.getStyle("width").from(b),10)<b.offsetWidth:!1},d=function(c){for(var d=0,e=b.length;e>d;d++)if("border-box"===a.getStyle(b[d]).from(c))return b[d]};a.copyStyles=function(d){return{from:function(e){c(e)&&(d=wysihtml5.lang.array(d).without(b));for(var f,g="",h=d.length,i=0;h>i;i++)f=d[i],g+=f+":"+a.getStyle(f).from(e)+";";return{to:function(b){return a.setStyles(g).on(b),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(a){a.dom.delegate=function(a,b,c,d){var e=function(c){for(var e=c.target,f=3===e.nodeType?e.parentNode:e,g=a.querySelectorAll(b),h=0,i=g.length;i>h;h++)g[h].contains(f)&&d.call(g[h],c)};return a.addEventListener(c,e,!1),{stop:function(){a.removeEventListener(c,e,!1)}}}}(wysihtml5),function(a){function b(a,b){for(var c=[a],d=a;b&&d&&d!==b||!b&&d;)c.unshift(d),d=d.parentNode;return c}function c(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")}a.dom.domNode=function(d){var e=[a.ELEMENT_NODE,a.TEXT_NODE];return{is:{emptyTextNode:function(b){var c=b?/^\s*$/g:/^[\r\n]*$/g;return d.nodeType===a.TEXT_NODE&&c.test(d.data)},visible:function(){var b=!/^\s*$/g.test(a.dom.getTextContent(d));return b||1===d.nodeType&&d.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(b=!0),b}},prev:function(b){var f=d.previousSibling,g=b&&b.nodeTypes?b.nodeTypes:e;return f?c(f)||!a.lang.array(g).contains(f.nodeType)||b&&b.ignoreBlankTexts&&a.dom.domNode(f).is.emptyTextNode(!0)?a.dom.domNode(f).prev(b):f:null},next:function(b){var f=d.nextSibling,g=b&&b.nodeTypes?b.nodeTypes:e;return f?c(f)||!a.lang.array(g).contains(f.nodeType)||b&&b.ignoreBlankTexts&&a.dom.domNode(f).is.emptyTextNode(!0)?a.dom.domNode(f).next(b):f:null},commonAncestor:function(a,c){var e=b(d,c),f=b(a,c);if(e[0]!=f[0])return null;for(var g=0;g<e.length;g++)if(e[g]!=f[g])return e[g-1];return null},lastLeafNode:function(b){var c;if(1!==d.nodeType)return d;if(c=d.lastChild,!c)return d;if(b&&b.leafClasses)for(var e=b.leafClasses.length;e--;)if(a.dom.hasClass(d,b.leafClasses[e]))return d;return a.dom.domNode(c).lastLeafNode(b)},escapeParent:function(b,c){var e,f,g,h=d;if(!a.dom.contains(b,d))throw new Error("Child is not a descendant of node.");do{for(e=h.parentNode,f=e.cloneNode(!1);e.lastChild&&e.lastChild!==h;)f.insertBefore(e.lastChild,f.firstChild);if(e!==b&&(g=e.cloneNode(!1),g.appendChild(h),h=g),e.parentNode.insertBefore(h,e.nextSibling),""!==f.innerHTML)if(/^\s+$/.test(f.innerHTML))for(;f.lastChild;)e.parentNode.insertBefore(f.lastChild,h.nextSibling);else e.parentNode.insertBefore(f,h.nextSibling);if(""===e.innerHTML)e.parentNode.removeChild(e);else if(/^\s+$/.test(e.innerHTML)){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}while(e&&e!==b);c&&h&&(h.parentNode.insertBefore(c,h),c.appendChild(h))},test:function(b){var c;if(!b)return!1;if(1!==d.nodeType)return!1;if(b.query&&!d.matches(b.query))return!1;if(b.nodeName&&d.nodeName.toLowerCase()!==b.nodeName.toLowerCase())return!1;if(b.className&&!d.classList.contains(b.className))return!1;if(b.classRegExp){var e=(d.className||"").match(b.classRegExp)||[];if(0===e.length)return!1}if(b.styleProperty&&b.styleProperty.length>0)for(var f=!1,g=Array.isArray(b.styleProperty)?b.styleProperty:[b.styleProperty],h=0,i=g.length;i>h;h++){if(c=a.browser.fixStyleKey(g[h]),d.style[c]){if(!b.styleValue){f=!0;break}if(b.styleValue instanceof RegExp){if(d.style[c].trim().match(b.styleValue).length>0){f=!0;break}}else if(Array.isArray(b.styleValue)){if(b.styleValue.indexOf(d.style[c].trim())){f=!0;break}}else if(b.styleValue===d.style[c].trim().replace(/, /g,",")){f=!0;break}}if(!f)return!1}if(b.attribute){var j=a.dom.getAttributes(d),k=[],l=!1;Array.isArray(b.attribute)?k=b.attribute:k[b.attribute]=b.attributeValue;for(var m in k)if(k.hasOwnProperty(m))if("undefined"==typeof k[m]){if("undefined"!=typeof j[m]){l=!0;break}}else if(j[m]===k[m]){l=!0;break}if(!l)return!1}return!0}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var a=function(a,b){var c=b.createElement("div");c.style.display="none",b.body.appendChild(c);try{c.innerHTML=a}catch(d){}return b.body.removeChild(c),c},b=function(a){if(!a._wysihtml5_supportsHTML5Tags){for(var b=0,d=c.length;d>b;b++)a.createElement(c[b]);a._wysihtml5_supportsHTML5Tags=!0}},c=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(c,d){d=d||document;var e;return"object"==typeof c&&c.nodeType?(e=d.createElement("div"),e.appendChild(c)):wysihtml5.browser.supportsHTML5Tags(d)?(e=d.createElement("div"),e.innerHTML=c):(b(d),e=a(c,d)),e}}(),wysihtml5.dom.getParentElement=function(){return function(a,b,c,d){for(c=c||50;c--&&a&&"BODY"!==a.nodeName&&(!d||a!==d);){if(wysihtml5.dom.domNode(a).test(b))return a;a=a.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function a(a){return a.replace(c,function(a){return a.charAt(1).toUpperCase()})}var b={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},c=/\-[a-z]/g;return function(c){return{from:function(d){if(d.nodeType===wysihtml5.ELEMENT_NODE){var e=d.ownerDocument,f=b[c]||a(c),g=d.style,h=d.currentStyle,i=g[f];if(i)return i;if(h)try{return h[f]}catch(j){}var k,l,m=e.defaultView||e.parentWindow,n=("height"===c||"width"===c)&&"TEXTAREA"===d.nodeName;return m.getComputedStyle?(n&&(k=g.overflow,g.overflow="hidden"),l=m.getComputedStyle(d,null).getPropertyValue(c),n&&(g.overflow=k||""),l):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(a,b){var c=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b&&/^\s*$/.test(a.innerText||a.textContent)||c.push(a):c=c.concat(wysihtml5.dom.getTextNodes(a,b));return c},wysihtml5.dom.hasElementWithTagName=function(){function a(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=c++)}var b={},c=1;return function(c,d){var e=a(c)+":"+d,f=b[e];return f||(f=b[e]=c.getElementsByTagName(d)),f.length>0}}(),function(a){function b(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=d++)}var c={},d=1;a.dom.hasElementWithClassName=function(d,e){if(!a.browser.supportsNativeGetElementsByClassName())return!!d.querySelector("."+e);var f=b(d)+":"+e,g=c[f];return g||(g=c[f]=d.getElementsByClassName(e)),
g.length>0}}(wysihtml5),wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}},wysihtml5.dom.insertCSS=function(a){return a=a.join("\n"),{into:function(b){var c=b.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(b.createTextNode(a));var d=b.querySelector("head link");if(d)return void d.parentNode.insertBefore(c,d);var e=b.querySelector("head");e&&e.appendChild(c)}}},function(a){a.dom.lineBreaks=function(b){function c(a){return"BR"===a.nodeName}function d(b){return c(b)?!0:"block"===a.dom.getStyle("display").from(b)?!0:!1}return{add:function(c){var e=b.ownerDocument,f=a.dom.domNode(b).next({ignoreBlankTexts:!0}),g=a.dom.domNode(b).prev({ignoreBlankTexts:!0});f&&!d(f)&&a.dom.insert(e.createElement("br")).after(b),g&&!d(g)&&a.dom.insert(e.createElement("br")).before(b)},remove:function(d){var e=a.dom.domNode(b).next({ignoreBlankTexts:!0}),f=a.dom.domNode(b).prev({ignoreBlankTexts:!0});e&&c(e)&&e.parentNode.removeChild(e),f&&c(f)&&f.parentNode.removeChild(f)}}}}(wysihtml5),wysihtml5.dom.observe=function(a,b,c){b="string"==typeof b?[b]:b;for(var d,e,f=0,g=b.length;g>f;f++)e=b[f],a.addEventListener?a.addEventListener(e,c,!1):(d=function(b){"target"in b||(b.target=b.srcElement),b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},c.call(a,b)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=b.length;g>f;f++)e=b[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+e,d)}}},wysihtml5.dom.parse=function(a,b){function c(a,b){wysihtml5.lang.object(t).merge(s).merge(b.rules).get();var c,f,g,h=b.context||a.ownerDocument||document,i=h.createDocumentFragment(),j="string"==typeof a,k=!1;for(b.clearInternals===!0&&(k=!0),c=j?wysihtml5.dom.getAsDom(a,h):a,t.selectors&&e(c,t.selectors);c.firstChild;)g=c.firstChild,f=d(g,b.cleanUp,k,b.uneditableClass),f&&i.appendChild(f),g!==f&&c.removeChild(g);if(b.unjoinNbsps)for(var l=wysihtml5.dom.getTextNodes(i),m=l.length;m--;)l[m].nodeValue=l[m].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return c.innerHTML="",c.appendChild(i),j?wysihtml5.quirks.getCorrectInnerHTML(c):c}function d(a,b,c,e){var f,g,h,i,j=a.nodeType,k=a.childNodes,l=k.length,m=p[j],n=0;if(e&&1===j&&wysihtml5.dom.hasClass(a,e))return a;if(g=m&&m(a,c),!g){if(g===!1){for(f=a.ownerDocument.createDocumentFragment(),n=l;n--;)k[n]&&(h=d(k[n],b,c,e),h&&(k[n]===h&&n--,f.insertBefore(h,f.firstChild)));return i=wysihtml5.dom.getStyle("display").from(a),""===i&&(i=wysihtml5.lang.array(u).contains(a.tagName)?"block":""),wysihtml5.lang.array(["block","flex","table"]).contains(i)&&f.appendChild(a.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(a.nodeName.toLowerCase())&&a.parentNode.lastChild!==a&&(a.nextSibling&&3===a.nextSibling.nodeType&&/^\s/.test(a.nextSibling.nodeValue)||f.appendChild(a.ownerDocument.createTextNode(" "))),f.normalize&&f.normalize(),f}return null}for(n=0;l>n;n++)k[n]&&(h=d(k[n],b,c,e),h&&(k[n]===h&&n--,g.appendChild(h)));if(b&&g.nodeName.toLowerCase()===q&&(!g.childNodes.length||/^\s*$/gi.test(g.innerHTML)&&(c||"_wysihtml5-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className)||!g.attributes.length)){for(f=g.ownerDocument.createDocumentFragment();g.firstChild;)f.appendChild(g.firstChild);return f.normalize&&f.normalize(),f}return g.normalize&&g.normalize(),g}function e(a,b){var c,d,e;for(c in b)if(b.hasOwnProperty(c)){wysihtml5.lang.object(b[c]).isFunction()?d=b[c]:"string"==typeof b[c]&&z[b[c]]&&(d=z[b[c]]),e=a.querySelectorAll(c);for(var f=e.length;f--;)d(e[f])}}function f(a,b){var c,d,e,f=t.tags,h=a.nodeName.toLowerCase(),j=a.scopeName;if(a._wysihtml5)return null;if(a._wysihtml5=1,"wysihtml5-temp"===a.className)return null;if(j&&"HTML"!=j&&(h=j+":"+h),"outerHTML"in a&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(h="div")),h in f){if(c=f[h],!c||c.remove)return null;if(c.unwrap)return!1;c="string"==typeof c?{rename_tag:c}:c}else{if(!a.firstChild)return null;c={rename_tag:q}}if(c.one_of_type&&!g(a,t,c.one_of_type,b)){if(!c.remove_action)return null;if("unwrap"===c.remove_action)return!1;if("rename"!==c.remove_action)return null;e=c.remove_action_rename_to||q}return d=a.ownerDocument.createElement(e||c.rename_tag||h),m(a,d,c,b),i(a,d,c),a=null,d.normalize&&d.normalize(),d}function g(a,b,c,d){var e,f;if("SPAN"===a.nodeName&&!d&&("_wysihtml5-temp-placeholder"===a.className||"rangySelectionBoundary"===a.className))return!0;for(f in c)if(c.hasOwnProperty(f)&&b.type_definitions&&b.type_definitions[f]&&(e=b.type_definitions[f],h(a,e)))return!0;return!1}function h(a,b){var c,d,e,f,g,h=a.getAttribute("class"),i=a.getAttribute("style");if(b.methods)for(var j in b.methods)if(b.methods.hasOwnProperty(j)&&y[j]&&y[j](a))return!0;if(h&&b.classes){h=h.replace(/^\s+/g,"").replace(/\s+$/g,"").split(r),c=h.length;for(var k=0;c>k;k++)if(b.classes[h[k]])return!0}if(i&&b.styles){i=i.split(";");for(d in b.styles)if(b.styles.hasOwnProperty(d))for(var l=i.length;l--;)if(g=i[l].split(":"),g[0].replace(/\s/g,"").toLowerCase()===d&&(b.styles[d]===!0||1===b.styles[d]||wysihtml5.lang.array(b.styles[d]).contains(g[1].replace(/\s/g,"").toLowerCase())))return!0}if(b.attrs)for(e in b.attrs)if(b.attrs.hasOwnProperty(e)&&(f=wysihtml5.dom.getAttribute(a,e),"string"==typeof f&&f.search(b.attrs[e])>-1))return!0;return!1}function i(a,b,c){var d,e;if(c&&c.keep_styles)for(d in c.keep_styles)if(c.keep_styles.hasOwnProperty(d)){if(e="float"===d?a.style.styleFloat||a.style.cssFloat:a.style[d],c.keep_styles[d]instanceof RegExp&&!c.keep_styles[d].test(e))continue;"float"===d?b.style[a.style.styleFloat?"styleFloat":"cssFloat"]=e:a.style[d]&&(b.style[d]=e)}}function j(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&0===d.indexOf(a)&&c.push(d);return c}function k(a,b,c,d){var e,f=wysihtml5.lang.object(c).isFunction()?c:v[c];return f&&(e=f(b,d),"string"==typeof e)?e:!1}function l(a,b){var c,d,e,f=wysihtml5.lang.object(t.attributes||{}).clone(),g=wysihtml5.lang.object(f).merge(wysihtml5.lang.object(b||{}).clone()).get(),h={},i=wysihtml5.dom.getAttributes(a);for(c in g)if(/\*$/.test(c)){e=j(c.slice(0,-1),i);for(var l=0,m=e.length;m>l;l++)d=k(e[l],i[e[l]],g[c],a.nodeName),d!==!1&&(h[e[l]]=d)}else d=k(c,i[c],g[c],a.nodeName),d!==!1&&(h[c]=d);return h}function m(a,b,c,d){var e,f,g,h,i,j={},k=c.set_class,m=c.add_class,n=c.add_style,o=c.set_attributes,p=t.classes,q=0,s=[],u=[],v=[],y=[];if(o&&(j=wysihtml5.lang.object(o).clone()),j=wysihtml5.lang.object(j).merge(l(a,c.check_attributes)).get(),k&&s.push(k),m)for(h in m)i=x[m[h]],i&&(g=i(wysihtml5.dom.getAttribute(a,h)),"string"==typeof g&&s.push(g));if(n)for(h in n)i=w[n[h]],i&&(newStyle=i(wysihtml5.dom.getAttribute(a,h)),"string"==typeof newStyle&&u.push(newStyle));if("string"==typeof p&&"any"===p)if(a.getAttribute("class"))if(t.classes_blacklist){for(y=a.getAttribute("class"),y&&(s=s.concat(y.split(r))),e=s.length;e>q;q++)f=s[q],t.classes_blacklist[f]||v.push(f);v.length&&(j["class"]=wysihtml5.lang.array(v).unique().join(" "))}else j["class"]=a.getAttribute("class");else s&&s.length>0&&(j["class"]=wysihtml5.lang.array(s).unique().join(" "));else{for(d||(p["_wysihtml5-temp-placeholder"]=1,p._rangySelectionBoundary=1,p["wysiwyg-tmp-selected-cell"]=1),y=a.getAttribute("class"),y&&(s=s.concat(y.split(r))),e=s.length;e>q;q++)f=s[q],p[f]&&v.push(f);v.length&&(j["class"]=wysihtml5.lang.array(v).unique().join(" "))}j["class"]&&d&&(j["class"]=j["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(j["class"])&&delete j["class"]),u.length&&(j.style=wysihtml5.lang.array(u).unique().join(" "));for(h in j)try{b.setAttribute(h,j[h])}catch(z){}j.src&&("undefined"!=typeof j.width&&b.setAttribute("width",j.width),"undefined"!=typeof j.height&&b.setAttribute("height",j.height))}function n(a){var b=a.nextSibling;if(!b||b.nodeType!==wysihtml5.TEXT_NODE){var c=a.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"");return a.ownerDocument.createTextNode(c)}b.data=a.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")+b.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")}function o(a){return t.comments?a.ownerDocument.createComment(a.nodeValue):void 0}var p={1:f,3:n,8:o},q="span",r=/\s+/,s={tags:{},classes:{}},t={},u=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],v={url:function(){var a=/^https?:\/\//i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b,c){return b?b.replace(a,""):"IMG"===c?"":null}}(),numbers:function(){var a=/\D/g;return function(b){return b=(b||"").replace(a,""),b||null}}(),dimension:function(){var a=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(b){return b=(b||"").replace(a,"$1$2$3"),b||null}}(),any:function(){return function(a){return a?a:null}}()},w={align_text:function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(b){return a[String(b).toLowerCase()]}}()},x={align_img:function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[String(b).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[String(b).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[String(b).toLowerCase()]}}(),size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[String(b).charAt(0)]}}()},y={has_visible_contet:function(){var a,b=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(c){if(a=(c.innerText||c.textContent).replace(/\s/g,""),a&&a.length>0)return!0;for(var d=b.length;d--;)if(c.querySelector(b[d]))return!0;return c.offsetWidth&&c.offsetWidth>0&&c.offsetHeight&&c.offsetHeight>0?!0:!1}}()},z={unwrap:function(a){wysihtml5.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return c(a,b)},wysihtml5.dom.removeEmptyTextNodes=function(a){for(var b,c=wysihtml5.lang.array(a.childNodes).get(),d=c.length,e=0;d>e;e++)b=c[e],b.nodeType===wysihtml5.TEXT_NODE&&/^[\n\r]*$/.test(b.data)&&b.parentNode.removeChild(b)},wysihtml5.dom.renameElement=function(a,b){for(var c,d=a.ownerDocument.createElement(b);c=a.firstChild;)d.appendChild(c);return wysihtml5.dom.copyAttributes(["align","className"]).from(a).to(d),a.parentNode&&a.parentNode.replaceChild(d,a),d},wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(!a.firstChild)return void a.parentNode.removeChild(a);for(var b=a.ownerDocument.createDocumentFragment();a.firstChild;)b.appendChild(a.firstChild);a.parentNode.replaceChild(b,a),a=b=null}},function(a){function b(b){return"block"===a.getStyle("display").from(b)}function c(a){return"BR"===a.nodeName}function d(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}function e(a,e){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var f,g,h,i,j,k,l,m=a.ownerDocument,n=m.createDocumentFragment(),o=wysihtml5.dom.domNode(a).prev({ignoreBlankTexts:!0}),p=wysihtml5.dom.domNode(a).next({ignoreBlankTexts:!0}),q=a.lastElementChild||a.lastChild;if(e)for(!o||b(o)||c(o)||d(n);k=a.firstElementChild||a.firstChild;){for(g=k.lastChild,l=k===q;f=k.firstChild;)h=f===g,i=(!l||p&&!b(p))&&h&&!b(f)&&!c(f),n.appendChild(f),i&&d(n);k.parentNode.removeChild(k)}else for(;k=a.firstElementChild||a.firstChild;){if(k.querySelector&&k.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;f=k.firstChild;)n.appendChild(f);else{for(j=m.createElement("p");f=k.firstChild;)j.appendChild(f);n.appendChild(j)}k.parentNode.removeChild(k)}a.parentNode.replaceChild(n,a)}}a.resolveList=e}(wysihtml5.dom),function(a){var b=document,c=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],d=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],e=["referrer","write","open","close"];a.dom.Sandbox=Base.extend({constructor:function(b,c){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.editableArea=this._createIframe()},insertInto:function(a){"string"==typeof a&&(a=b.getElementById(a)),a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var c=this,d=b.createElement("iframe");return d.className=this.config.className,a.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(d),a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(d.src="javascript:'<html></html>'"),d.onload=function(){d.onreadystatechange=d.onload=null,c._onLoadIframe(d)},d.onreadystatechange=function(){/loaded|complete/.test(d.readyState)&&(d.onreadystatechange=d.onload=null,c._onLoadIframe(d))},d},_onLoadIframe:function(f){if(a.dom.contains(b.documentElement,f)){var g=this,h=f.contentWindow,i=f.contentWindow.document,j=b.characterSet||b.charset||"utf-8",k=this._getHtml({charset:j,stylesheets:this.config.stylesheets});if(i.open("text/html","replace"),i.write(k),i.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(a,b,c){throw new Error("wysihtml5.Sandbox: "+a,b,c)},!a.browser.supportsSandboxedIframes()){var l,m;for(l=0,m=c.length;m>l;l++)this._unset(h,c[l]);for(l=0,m=d.length;m>l;l++)this._unset(h,d[l],a.EMPTY_FUNCTION);for(l=0,m=e.length;m>l;l++)this._unset(i,e[l]);this._unset(i,"cookie","",!0)}a.polyfills&&a.polyfills(h,i),this.loaded=!0,setTimeout(function(){g.callback(g)},0)}},_getHtml:function(b){var c,d=b.stylesheets,e="",f=0;if(d="string"==typeof d?[d]:d)for(c=d.length;c>f;f++)e+='<link rel="stylesheet" href="'+d[f]+'">';return b.stylesheets=e,a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(b,c,d,e){try{b[c]=d}catch(f){}try{b.__defineGetter__(c,function(){return d})}catch(f){}if(e)try{b.__defineSetter__(c,function(){})}catch(f){}if(!a.browser.crashesWhenDefineProperty(c))try{var g={get:function(){return d}};e&&(g.set=function(){}),Object.defineProperty(b,c,g)}catch(f){}}})}(wysihtml5),function(a){var b=document;a.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(b,c,d){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),d?this.element=this._bindElement(d):this.element=this._createElement()},destroy:function(){},_createElement:function(){var a=b.createElement("div");return a.className=this.config.className,this._loadElement(a),a},_bindElement:function(a){return a.className=a.className?a.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(a,!0),a},_loadElement:function(a,b){var c=this;if(!b){var d=this._getHtml();a.innerHTML=d}this.loaded=!0,setTimeout(function(){c.callback(c)},0)},_getHtml:function(a){return""}})}(wysihtml5),function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var d in b)c.setAttribute(a[d]||d,b[d])}}}}(),wysihtml5.dom.setStyles=function(a){return{on:function(b){var c=b.style;if("string"==typeof a)return void(c.cssText+=";"+a);for(var d in a)"float"===d?(c.cssFloat=a[d],c.styleFloat=a[d]):c[d]=a[d]}}},function(a){a.simulatePlaceholder=function(b,c,d,e){var f=e||"wysihtml5-placeholder",g=function(){var b=c.element.offsetWidth>0&&c.element.offsetHeight>0;c.hasPlaceholderSet()&&(c.clear(),c.element.focus(),b&&setTimeout(function(){var a=c.selection.getSelection();a.focusNode&&a.anchorNode||c.selection.selectNode(c.element.firstChild||c.element)},0)),c.placeholderSet=!1,a.removeClass(c.element,f)},h=function(){c.isEmpty()&&!c.placeholderSet&&(c.placeholderSet=!0,c.setValue(d,!1),a.addClass(c.element,f))};b.on("set_placeholder",h).on("unset_placeholder",g).on("focus:composer",g).on("paste:composer",g).on("blur:composer",h),h()}}(wysihtml5.dom),function(a){var b=document.documentElement;"textContent"in b?(a.setTextContent=function(a,b){a.textContent=b},a.getTextContent=function(a){return a.textContent}):"innerText"in b?(a.setTextContent=function(a,b){a.innerText=b},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,b){a.nodeValue=b},a.getTextContent=function(a){return a.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(a,b){var c=!wysihtml5.browser.supportsGetAttributeCorrectly();b=b.toLowerCase();var d=a.nodeName;if("IMG"==d&&"src"==b&&wysihtml5.dom.isLoadedImage(a)===!0)return a.src;if(c&&"outerHTML"in a){var e=a.outerHTML.toLowerCase(),f=-1!=e.indexOf(" "+b+"=");return f?a.getAttribute(b):null}return a.getAttribute(b)},wysihtml5.dom.getAttributes=function(a){var b,c=!wysihtml5.browser.supportsGetAttributeCorrectly(),d=a.nodeName,e=[];for(b in a.attributes)(a.attributes.hasOwnProperty&&a.attributes.hasOwnProperty(b)||!a.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(a.attributes,b))&&a.attributes[b].specified&&("IMG"==d&&"src"==a.attributes[b].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(a)===!0?e.src=a.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(a.attributes[b].name.toLowerCase())&&c?1!==a.attributes[b].value&&(e[a.attributes[b].name]=a.attributes[b].value):e[a.attributes[b].name]=a.attributes[b].value);return e},wysihtml5.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(b){if(a.complete&&"complete"===a.readyState)return!0}},function(a){function b(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)if(c=a[e].querySelectorAll(b))for(var g=c.length;g--;d.unshift(c[g]));return d}function d(a){a.parentNode.removeChild(a)}function e(a,b){a.parentNode.insertBefore(b,a.nextSibling)}function f(a,b){for(var c=a.nextSibling;1!=c.nodeType;)if(c=c.nextSibling,!b||b==c.tagName.toLowerCase())return c;return null}var g=a.dom,h=function(a){this.el=a,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},i=function(a,b){a?(this.cell=a,this.table=g.getParentElement(a,{query:"table"})):b&&(this.table=b,this.cell=this.table.querySelectorAll("th, td")[0])};i.prototype={addSpannedCellToMap:function(a,b,c,d,e,f){for(var g=[],i=c+(f?parseInt(f,10)-1:0),j=d+(e?parseInt(e,10)-1:0),k=c;i>=k;k++){"undefined"==typeof b[k]&&(b[k]=[]);for(var l=d;j>=l;l++)b[k][l]=new h(a),b[k][l].isColspan=e&&parseInt(e,10)>1,b[k][l].isRowspan=f&&parseInt(f,10)>1,b[k][l].firstCol=l==d,b[k][l].lastCol=l==j,b[k][l].firstRow=k==c,b[k][l].lastRow=k==i,b[k][l].isReal=l==d&&k==c,b[k][l].spanCollection=g,g.push(b[k][l])}},setCellAsModified:function(a){if(a.modified=!0,a.spanCollection.length>0)for(var b=0,c=a.spanCollection.length;c>b;b++)a.spanCollection[b].modified=!0},setTableMap:function(){var a,b,c,d,e,f,i,j,k=[],l=this.getTableRows();for(a=0;a<l.length;a++)for(b=l[a],c=this.getRowCells(b),f=0,"undefined"==typeof k[a]&&(k[a]=[]),d=0;d<c.length;d++){for(e=c[d];"undefined"!=typeof k[a][f];)f++;i=g.getAttribute(e,"colspan"),j=g.getAttribute(e,"rowspan"),i||j?(this.addSpannedCellToMap(e,k,a,f,i,j),f+=i?parseInt(i,10):1):(k[a][f]=new h(e),f++)}return this.map=k,k},getRowCells:function(c){var d=this.table.querySelectorAll("table"),e=d?b(d,"th, td"):[],f=c.querySelectorAll("th, td"),g=e.length>0?a.lang.array(f).without(e):f;return g},getTableRows:function(){var c=this.table.querySelectorAll("table"),d=c?b(c,"tr"):[],e=this.table.querySelectorAll("tr"),f=d.length>0?a.lang.array(e).without(d):e;return f},getMapIndex:function(a){for(var b=this.map.length,c=this.map&&this.map[0]?this.map[0].length:0,d=0;b>d;d++)for(var e=0;c>e;e++)if(this.map[d][e].el===a)return{row:d,col:e};return!1},getElementAtIndex:function(a){return this.setTableMap(),this.map[a.row]&&this.map[a.row][a.col]&&this.map[a.row][a.col].el?this.map[a.row][a.col].el:null},getMapElsTo:function(a){var b=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var c=this.idx_start;this.idx_start=this.idx_end,this.idx_end=c}if(this.idx_start.col>this.idx_end.col){var d=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=d}if(null!=this.idx_start&&null!=this.idx_end)for(var e=this.idx_start.row,f=this.idx_end.row;f>=e;e++)for(var g=this.idx_start.col,h=this.idx_end.col;h>=g;g++)b.push(this.map[e][g].el);return b},orderSelectionEnds:function(a){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var b=this.idx_start;this.idx_start=this.idx_end,this.idx_end=b}if(this.idx_start.col>this.idx_end.col){var c=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=c}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(a,b,c){for(var d,e=this.table.ownerDocument,f=e.createDocumentFragment(),g=0;b>g;g++){if(d=e.createElement(a),c)for(var h in c)c.hasOwnProperty(h)&&d.setAttribute(h,c[h]);d.appendChild(document.createTextNode(" ")),f.appendChild(d)}return f},correctColIndexForUnreals:function(a,b){for(var c=this.map[b],d=-1,e=0;a>e;e++)c[e].isReal&&d++;return d},getLastNewCellOnRow:function(a,b){for(var c,d,e=this.getRowCells(a),f=0,g=e.length;g>f;f++)if(c=e[f],d=this.getMapIndex(c),d===!1||"undefined"!=typeof b&&d.row!=b)return c;return null},removeEmptyTable:function(){var a=this.table.querySelectorAll("td, th");return a&&0!=a.length?!1:(d(this.table),!0)},splitRowToCells:function(a){if(a.isColspan){var b=parseInt(g.getAttribute(a.el,"colspan")||1,10),c=a.el.tagName.toLowerCase();if(b>1){var d=this.createCells(c,b-1);e(a.el,d)}a.el.removeAttribute("colspan")}},getRealRowEl:function(a,b){var c=null,d=null;b=b||this.idx;for(var e=0,f=this.map[b.row].length;f>e;e++)if(d=this.map[b.row][e],d.isReal&&(c=g.getParentElement(d.el,{query:"tr"})))return c;return null===c&&a&&(c=g.getParentElement(this.map[b.row][b.col].el,{query:"tr"})||null),c},injectRowAt:function(a,b,c,d,f){var h=this.getRealRowEl(!1,{row:a,col:b}),i=this.createCells(d,c);if(h){var j=this.correctColIndexForUnreals(b,a);j>=0?e(this.getRowCells(h)[j],i):h.insertBefore(i,h.firstChild)}else{var k=this.table.ownerDocument.createElement("tr");k.appendChild(i),e(g.getParentElement(f.el,{query:"tr"}),k)}},canMerge:function(a){if(this.to=a,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var b=this.idx_start;this.idx_start=this.idx_end,this.idx_end=b}if(this.idx_start.col>this.idx_end.col){var c=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=c}for(var d=this.idx_start.row,e=this.idx_end.row;e>=d;d++)for(var f=this.idx_start.col,g=this.idx_end.col;g>=f;f++)if(this.map[d][f].isColspan||this.map[d][f].isRowspan)return!1;return!0},decreaseCellSpan:function(a,b){var c=parseInt(g.getAttribute(a.el,b),10)-1;c>=1?a.el.setAttribute(b,c):(a.el.removeAttribute(b),"colspan"==b&&(a.isColspan=!1),"rowspan"==b&&(a.isRowspan=!1),a.firstCol=!0,a.lastCol=!0,a.firstRow=!0,a.lastRow=!0,a.isReal=!0)},removeSurplusLines:function(){var a,b,c,e,f,h,i;if(this.setTableMap(),this.map){for(c=0,e=this.map.length;e>c;c++){for(a=this.map[c],i=!0,f=0,h=a.length;h>f;f++)if(b=a[f],!(g.getAttribute(b.el,"rowspan")&&parseInt(g.getAttribute(b.el,"rowspan"),10)>1&&b.firstRow!==!0)){i=!1;break}if(i)for(f=0;h>f;f++)this.decreaseCellSpan(a[f],"rowspan")}var j=this.getTableRows();for(c=0,e=j.length;e>c;c++)a=j[c],0==a.childNodes.length&&/^\s*$/.test(a.textContent||a.innerText)&&d(a)}},fillMissingCells:function(){var a=0,b=0,c=null;if(this.setTableMap(),this.map){a=this.map.length;for(var d=0;a>d;d++)this.map[d].length>b&&(b=this.map[d].length);for(var f=0;a>f;f++)for(var g=0;b>g;g++)this.map[f]&&!this.map[f][g]&&g>0&&(this.map[f][g]=new h(this.createCells("td",1)),c=this.map[f][g-1],c&&c.el&&c.el.parent&&e(this.map[f][g-1].el,this.map[f][g].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var a=this.map[this.idx.row][this.idx.col],b=g.getAttribute(a.el,"colspan")?parseInt(g.getAttribute(a.el,"colspan"),10):1,c=a.el.tagName.toLowerCase();if(a.isRowspan){var d=parseInt(g.getAttribute(a.el,"rowspan"),10);if(d>1)for(var e=1,f=d-1;f>=e;e++)this.injectRowAt(this.idx.row+e,this.idx.col,b,c,a);a.el.removeAttribute("rowspan")}this.splitRowToCells(a)}},merge:function(a){if(this.rectify())if(this.canMerge(a)){for(var b=this.idx_end.row-this.idx_start.row+1,c=this.idx_end.col-this.idx_start.col+1,e=this.idx_start.row,f=this.idx_end.row;f>=e;e++)for(var g=this.idx_start.col,h=this.idx_end.col;h>=g;g++)e==this.idx_start.row&&g==this.idx_start.col?(b>1&&this.map[e][g].el.setAttribute("rowspan",b),c>1&&this.map[e][g].el.setAttribute("colspan",c)):(/^\s*<br\/?>\s*$/.test(this.map[e][g].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[e][g].el.innerHTML),d(this.map[e][g].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(a){var b=this.getMapIndex(a.el),c=b.row+1,d={row:c,col:b.col};if(c<this.map.length){var f=this.getRealRowEl(!1,d);if(null!==f){var h=this.correctColIndexForUnreals(d.col,d.row);if(h>=0)e(this.getRowCells(f)[h],a.el);else{var i=this.getLastNewCellOnRow(f,c);null!==i?e(i,a.el):f.insertBefore(a.el,f.firstChild)}parseInt(g.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")}}},removeRowCell:function(a){a.isReal?a.isRowspan?this.collapseCellToNextRow(a):d(a.el):parseInt(g.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var a=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=this.map[this.idx.row],c=0,d=b.length;d>c;c++)b[c].isReal&&a.push(b[c].el);return a},getColumnElementsByCell:function(){var a=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=0,c=this.map.length;c>b;b++)this.map[b][this.idx.col]&&this.map[b][this.idx.col].isReal&&a.push(this.map[b][this.idx.col].el);return a},removeRow:function(){var a=g.getParentElement(this.cell,{query:"tr"});if(a){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=this.map[this.idx.row],c=0,e=b.length;e>c;c++)b[c].modified||(this.setCellAsModified(b[c]),this.removeRowCell(b[c]));d(a)}},removeColCell:function(a){a.isColspan?parseInt(g.getAttribute(a.el,"colspan"),10)>2?a.el.setAttribute("colspan",parseInt(g.getAttribute(a.el,"colspan"),10)-1):a.el.removeAttribute("colspan"):a.isReal&&d(a.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var a=0,b=this.map.length;b>a;a++)this.map[a][this.idx.col].modified||(this.setCellAsModified(this.map[a][this.idx.col]),this.removeColCell(this.map[a][this.idx.col]))},remove:function(a){if(this.rectify()){switch(a){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(a){var b=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==a&&g.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(g.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var c=this.map[this.idx.row],d=b.createElement("tr"),f=0,h=c.length;h>f;f++)c[f].modified||(this.setCellAsModified(c[f]),this.addRowCell(c[f],d,a));switch(a){case"below":e(this.getRealRowEl(!0),d);break;case"above":var i=g.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});i&&i.parentNode.insertBefore(d,i)}}},addRowCell:function(a,b,d){var e=a.isColspan?{colspan:g.getAttribute(a.el,"colspan")}:null;a.isReal?"above"!=d&&a.isRowspan?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)+1):b.appendChild(this.createCells("td",1,e)):"above"!=d&&a.isRowspan&&a.lastRow?b.appendChild(this.createCells("td",1,e)):c.isRowspan&&a.el.attr("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)+1)},add:function(a){this.rectify()&&(("below"==a||"above"==a)&&this.addRow(a),("before"==a||"after"==a)&&this.addColumn(a))},addColCell:function(a,b,d){var f,h=a.el.tagName.toLowerCase();switch(d){case"before":f=!a.isColspan||a.firstCol;break;case"after":f=!a.isColspan||a.lastCol||a.isColspan&&c.el==this.cell}if(f){switch(d){case"before":a.el.parentNode.insertBefore(this.createCells(h,1),a.el);break;case"after":e(a.el,this.createCells(h,1))}a.isRowspan&&this.handleCellAddWithRowspan(a,b+1,d)}else a.el.setAttribute("colspan",parseInt(g.getAttribute(a.el,"colspan"),10)+1)},addColumn:function(a){var b,c;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==a&&g.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(g.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var d=0,e=this.map.length;e>d;d++)b=this.map[d],b[this.idx.col]&&(c=b[this.idx.col],c.modified||(this.setCellAsModified(c),this.addColCell(c,d,a)))},handleCellAddWithRowspan:function(a,b,c){for(var d,h,i,j=parseInt(g.getAttribute(this.cell,"rowspan"),10)-1,k=g.getParentElement(a.el,{query:"tr"}),l=a.el.tagName.toLowerCase(),m=this.table.ownerDocument,n=0;j>n;n++)if(d=this.correctColIndexForUnreals(this.idx.col,b+n),k=f(k,"tr"))if(d>0)switch(c){case"before":h=this.getRowCells(k),d>0&&this.map[b+n][this.idx.col].el!=h[d]&&d==h.length-1?e(h[d],this.createCells(l,1)):h[d].parentNode.insertBefore(this.createCells(l,1),h[d]);break;case"after":e(this.getRowCells(k)[d],this.createCells(l,1))}else k.insertBefore(this.createCells(l,1),k.firstChild);else i=m.createElement("tr"),i.appendChild(this.createCells(l,1)),
this.table.appendChild(i)}},g.table={getCellsBetween:function(a,b){var c=new i(a);return c.getMapElsTo(b)},addCells:function(a,b){var c=new i(a);c.add(b)},removeCells:function(a,b){var c=new i(a);c.remove(b)},mergeCellsBetween:function(a,b){var c=new i(a);c.merge(b)},unmergeCell:function(a){var b=new i(a);b.unmerge()},orderSelectionEnds:function(a,b){var c=new i(a);return c.orderSelectionEnds(b)},indexOf:function(a){var b=new i(a);return b.setTableMap(),b.getMapIndex(a)},findCell:function(a,b){var c=new i(null,a);return c.getElementAtIndex(b)},findRowByCell:function(a){var b=new i(a);return b.getRowElementsByCell()},findColumnByCell:function(a){var b=new i(a);return b.getColumnElementsByCell()},canMerge:function(a,b){var c=new i(a);return c.canMerge(b)}}}(wysihtml5),wysihtml5.dom.query=function(a,b){var c,d=[];a.nodeType&&(a=[a]);for(var e=0,f=a.length;f>e;e++)if(c=a[e].querySelectorAll(b))for(var g=c.length;g--;d.unshift(c[g]));return d},wysihtml5.dom.compareDocumentPosition=function(){var a=document.documentElement;return a.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)}:function(a,b){var c,d;if(c=9===a.nodeType?a:a.ownerDocument,d=9===b.nodeType?b:b.ownerDocument,a===b)return 0;if(a===b.ownerDocument)return 20;if(a.ownerDocument===b)return 10;if(c!==d)return 1;if(2===a.nodeType&&a.childNodes&&-1!==wysihtml5.lang.array(a.childNodes).indexOf(b))return 20;if(2===b.nodeType&&b.childNodes&&-1!==wysihtml5.lang.array(b.childNodes).indexOf(a))return 10;for(var e=a,f=[],g=null;e;){if(e==b)return 10;f.push(e),e=e.parentNode}for(e=b,g=null;e;){if(e==a)return 20;var h=wysihtml5.lang.array(f).indexOf(e);if(-1!==h){var i=f[h],j=wysihtml5.lang.array(i.childNodes).indexOf(f[h-1]),k=wysihtml5.lang.array(i.childNodes).indexOf(g);return j>k?2:4}g=e,e=e.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(a){var b=[];if(a.parentNode){for(;a.lastChild;)b.unshift(a.lastChild),wysihtml5.dom.insert(a.lastChild).after(a);a.parentNode.removeChild(a)}return b},wysihtml5.dom.getPastedHtml=function(a){var b;return wysihtml5.browser.supportsModernPaste()&&a.clipboardData&&(wysihtml5.lang.array(a.clipboardData.types).contains("text/html")?b=a.clipboardData.getData("text/html"):wysihtml5.lang.array(a.clipboardData.types).contains("text/plain")&&(b=wysihtml5.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),b},wysihtml5.dom.getPastedHtmlWithDiv=function(a,b){var c=a.selection.getBookmark(),d=a.element.ownerDocument,e=d.createElement("DIV"),f=a.getScrollPos();d.body.appendChild(e),e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.style.position="absolute",e.style.top=f.y+"px",e.style.left=f.x+"px",e.setAttribute("contenteditable","true"),e.focus(),setTimeout(function(){var d;a.selection.setBookmark(c),d=e.innerHTML,d&&/^<br\/?>$/i.test(d.trim())&&(d=!1),b(d),e.parentNode.removeChild(e)},0)},wysihtml5.dom.removeInvisibleSpaces=function(a){for(var b=wysihtml5.dom.getTextNodes(a),c=b.length;c--;)b[c].nodeValue=b[c].nodeValue.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")},wysihtml5.quirks.cleanPastedHTML=function(){var a=function(a){var b=wysihtml5.lang.string(a).trim(),c=b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+c+"$).)*$","i")},b=function(b,c){var d,e,f=wysihtml5.lang.object(b).clone(!0);for(d in f.tags)if(f.tags.hasOwnProperty(d)&&f.tags[d].keep_styles)for(e in f.tags[d].keep_styles)f.tags[d].keep_styles.hasOwnProperty(e)&&c[e]&&(f.tags[d].keep_styles[e]=a(c[e]));return f},c=function(a,b){var c;if(!a)return null;for(var d=0,e=a.length;e>d;d++)if(a[d].condition||(c=a[d].set),a[d].condition&&a[d].condition.test(b))return a[d].set;return c};return function(a,d){var e,f={color:wysihtml5.dom.getStyle("color").from(d.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(d.referenceNode)},g=b(c(d.rules,a)||{},f);return e=wysihtml5.dom.parse(a,{rules:g,cleanUp:!0,context:d.referenceNode.ownerDocument,uneditableClass:d.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();("<p>&nbsp;</p>"==b||"<p>&nbsp;</p><p>&nbsp;</p>"==b)&&(a.innerHTML="")},0)};return function(b){wysihtml5.dom.observe(b.element,["cut","keydown"],a)}}(),function(a){var b="%7E";a.quirks.getCorrectInnerHTML=function(c){var d=c.innerHTML;if(-1===d.indexOf(b))return d;var e,f,g,h,i=c.querySelectorAll("[href*='~'], [src*='~']");for(h=0,g=i.length;g>h;h++)e=i[h].href||i[h].src,f=a.lang.string(e).replace("~").by(b),d=a.lang.string(d).replace(f).by(e);return d}}(wysihtml5),function(a){var b="wysihtml5-quirks-redraw";a.quirks.redraw=function(c){a.dom.addClass(c,b),a.dom.removeClass(c,b);try{var d=c.ownerDocument;d.execCommand("italic",!1,null),d.execCommand("italic",!1,null)}catch(e){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(a,b){function c(){return a.addEventListener("mousedown",n),l}function d(c){l.start=c,l.end=c,l.cells=[c],l.table=k.getParentElement(l.start,{query:"table"},!1,a),l.table&&(e(),k.addClass(c,m),a.addEventListener("mousemove",g),a.addEventListener("mouseup",h),b.fire("tableselectstart").fire("tableselectstart:composer"))}function e(){if(a){var b=a.querySelectorAll("."+m);if(b.length>0)for(var c=0;c<b.length;c++)k.removeClass(b[c],m)}}function f(a){for(var b=0;b<a.length;b++)k.addClass(a[b],m)}function g(c){var d,g=null,h=k.getParentElement(c.target,{query:"td, th"},!1,a);h&&l.table&&l.start&&(g=k.getParentElement(h,{query:"table"},!1,a),g&&g===l.table&&(e(),d=l.end,l.end=h,l.cells=k.table.getCellsBetween(l.start,h),l.cells.length>1&&b.composer.selection.deselect(),f(l.cells),l.end!==d&&b.fire("tableselectchange").fire("tableselectchange:composer")))}function h(c){a.removeEventListener("mousemove",g),a.removeEventListener("mouseup",h),b.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){i()},0)}function i(){a.ownerDocument.addEventListener("click",o)}function j(c,d){l.start=c,l.end=d,l.table=k.getParentElement(l.start,{query:"table"},!1,a),selectedCells=k.table.getCellsBetween(l.start,l.end),f(selectedCells),i(),b.fire("tableselect").fire("tableselect:composer")}var k=wysihtml5.dom,l={table:null,start:null,end:null,cells:null,select:j},m="wysiwyg-tmp-selected-cell",n=function(b){var c=wysihtml5.dom.getParentElement(b.target,{query:"td, th"},!1,a);c&&d(c)},o=function(c){a.ownerDocument.removeEventListener("click",o),k.getParentElement(c.target,{query:"table"},!1,a)!=l.table&&(e(),l.table=null,l.start=null,l.end=null,b.fire("tableunselect").fire("tableunselect:composer"))};return c()},function(a){function b(a){var b,c;for(b in d)if(d.hasOwnProperty(b)&&(c=d[b],c.regex.test(a)))return c}function c(a){var c=b(a);return c?c.name:void 0}var d={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},e=function(a){return new RegExp("(^|\\s|;)"+a+"\\s*:\\s*[^;$]+","gi")};a.quirks.styleParser={getColorParseMethod:b,getColorFormat:c,parseColor:function(c,f){var g,h,i,j,k,l=c;if(f){if(g=e(f),!(h=c.match(g)))return!1;h=h.pop().split(":")[1],l=a.lang.string(h).trim()}return(i=b(l))&&(j=l.match(i.regex))?(k=i.radix||10,i===d.hex3?(j.shift(),j.push(1),a.lang.array(j).map(function(a,b){return 3>b?parseInt(a,k)*k+parseInt(a,k):parseFloat(a)})):(j.shift(),j[3]||j.push(1),a.lang.array(j).map(function(a,b){return 3>b?parseInt(a,k):parseFloat(a)}))):!1},unparseColor:function(a,b){var c=16;return"hex"===b?(a[0].toString(c)+a[1].toString(c)+a[2].toString(c)).toUpperCase():"hash"===b?"#"+(a[0].toString(c)+a[1].toString(c)+a[2].toString(c)).toUpperCase():"rgb"===b?"rgb("+a[0]+","+a[1]+","+a[2]+")":"rgba"===b?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"csv"===b?a[0]+","+a[1]+","+a[2]+","+a[3]:a[3]&&1!==a[3]?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"rgb("+a[0]+","+a[1]+","+a[2]+")"},parseFontSize:function(b){var c=b.match(e("font-size"));return c?a.lang.string(c[c.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(a){function b(a){var b=0;if(a.parentNode)do b+=a.offsetTop||0,a=a.offsetParent;while(a);return b}function c(a,b){for(var c=0;b!==a;)if(c++,b=b.parentNode,!b)throw new Error("not a descendant of ancestor!");return c}function d(b){var c=document.createElement("span"),d=function(a){b.removeEventListener("mouseup",d),b.removeEventListener("keydown",d),b.removeEventListener("touchstart",d),b.removeEventListener("focus",d),b.removeEventListener("blur",d),b.removeEventListener("paste",e),b.removeEventListener("drop",e),b.removeEventListener("beforepaste",e),c&&c.parentNode&&c.parentNode.removeChild(c)},e=function(a){c&&c.parentNode&&setTimeout(d,0)};return c.appendChild(document.createTextNode(a.INVISIBLE_SPACE)),c.className="_wysihtml5-temp-caret-fix",c.style.display="block",c.style.minWidth="1px",c.style.height="0px",b.addEventListener("mouseup",d),b.addEventListener("keydown",d),b.addEventListener("touchstart",d),b.addEventListener("focus",d),b.addEventListener("blur",d),b.addEventListener("paste",e),b.addEventListener("drop",e),b.addEventListener("beforepaste",e),c}function e(a){if(!a.canSurroundContents())for(var b=a.commonAncestorContainer,d=c(b,a.startContainer),e=c(b,a.endContainer);!a.canSurroundContents();)d>e?(a.setStartBefore(a.startContainer),d=c(b,a.startContainer)):(a.setEndAfter(a.endContainer),e=c(b,a.endContainer))}var f=a.dom;a.Selection=Base.extend({constructor:function(a,b,c){window.rangy.init(),this.editor=a,this.composer=a.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=b,this.unselectableClass=c||!1},getBookmark:function(){var a=this.getRange();return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);return b.setStartBefore(a),b.setEndBefore(a),this.setSelection(b)},createTemporaryCaretSpaceAfter:function(b){var c=this.doc.createElement("span"),d=this.doc.createTextNode(a.INVISIBLE_SPACE),e=function(b){var d;this.contain.removeEventListener("mouseup",e),this.contain.removeEventListener("keydown",g),this.contain.removeEventListener("touchstart",e),this.contain.removeEventListener("focus",e),this.contain.removeEventListener("blur",e),this.contain.removeEventListener("paste",f),this.contain.removeEventListener("drop",f),this.contain.removeEventListener("beforepaste",f),c&&c.parentNode&&(c.innerHTML=c.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(c.innerHTML)?(d=c.lastChild,a.dom.unwrap(c),this.setAfter(d)):c.parentNode.removeChild(c))}.bind(this),f=function(a){c&&c.parentNode&&setTimeout(e,0)},g=function(a){8===a.which||91===a.which||17===a.which||86===a.which&&(a.ctrlKey||a.metaKey)||e()};return c.className="_wysihtml5-temp-caret-fix",c.style.position="absolute",c.style.display="block",c.style.minWidth="1px",c.style.zIndex="99999",c.appendChild(d),b.parentNode.insertBefore(c,b.nextSibling),this.setBefore(d),this.contain.addEventListener("mouseup",e),this.contain.addEventListener("keydown",g),this.contain.addEventListener("touchstart",e),this.contain.addEventListener("focus",e),this.contain.addEventListener("blur",e),this.contain.addEventListener("paste",f),this.contain.addEventListener("drop",f),this.contain.addEventListener("beforepaste",f),c},setAfter:function(b,c,d){var e,f=this.win,g=rangy.createRange(this.doc),h=function(){var d=b.parentNode,g=d?d.childNodes[d.childNodes.length-1]:null;if(!e||g===b&&1===b.nodeType&&"block"===f.getComputedStyle(b).display)if(c){var h=this.doc.createTextNode(a.INVISIBLE_SPACE);b.parentNode.insertBefore(h,b.nextSibling),this.selectNode(h),setTimeout(function(){h&&h.parentNode&&h.parentNode.removeChild(h)},0)}else this.createTemporaryCaretSpaceAfter(b)}.bind(this);if(g.setStartAfter(b),g.setEndAfter(b),document.activeElement&&document.activeElement===this.composer.element)e=this.setSelection(g),h(),d&&d(e);else{var i=this.composer.getScrollPos();this.composer.element.focus(),this.composer.setScrollPos(i),setTimeout(function(){e=this.setSelection(g),h(),d&&d(e)}.bind(this),0)}},selectNode:function(b,c){var d=rangy.createRange(this.doc),e=b.nodeType===a.ELEMENT_NODE,g="canHaveHTML"in b?b.canHaveHTML:"IMG"!==b.nodeName,h=e?b.innerHTML:b.data,i=""===h||h===a.INVISIBLE_SPACE,j=f.getStyle("display").from(b),k="block"===j||"list-item"===j;if(i&&e&&g&&!c)try{b.innerHTML=a.INVISIBLE_SPACE}catch(l){}g?d.selectNodeContents(b):d.selectNode(b),g&&i&&e?d.collapse(k):g&&i&&(d.setStartAfter(b),d.setEndAfter(b)),this.setSelection(d)},getSelectedNode:function(a){var b,c;return a&&this.doc.selection&&"Control"===this.doc.selection.type&&(c=this.doc.selection.createRange(),c&&c.length)?c.item(0):(b=this.getSelection(this.doc),b.focusNode===b.anchorNode?b.focusNode:(c=this.getRange(this.doc),c?c.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var a=this.getRange();e(a),this.setSelection(a)},getSelectedOwnNodes:function(a){for(var b=this.getOwnRanges(),c=[],d=0,e=b.length;e>d;d++)c.push(b[d].commonAncestorContainer||this.doc.body);return c},findNodesInSelection:function(b){for(var c,d=this.getOwnRanges(),e=[],f=0,g=d.length;g>f;f++)c=d[f].getNodes([1],function(c){return a.lang.array(b).contains(c.nodeName)}),e=e.concat(c);return e},filterElements:function(a){for(var b,c=this.getOwnRanges(),d=[],e=0,f=c.length;f>e;e++)b=c[e].getNodes([1],function(b){return a(b,c[e])}),d=d.concat(b);return d},containsUneditable:function(){for(var a=this.getOwnUneditables(),b=this.getSelection(),c=0,d=a.length;d>c;c++)if(b.containsNode(a[c]))return!0;return!1},deleteContents:function(){var a=this.getRange();this.deleteRangeContents(a),this.setSelection(a)},deleteRangeContents:function(b){var c,d,e,f;if(this.unselectableClass){(c=a.dom.getParentElement(b.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&b.setStartBefore(c),(d=a.dom.getParentElement(b.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&b.setEndAfter(d),e=b.getNodes([1],function(b){return a.dom.hasClass(b,this.unselectableClass)}.bind(this));for(var g=e.length;g--;)try{f=new CustomEvent("wysihtml5:uneditable:delete"),e[g].dispatchEvent(f)}catch(h){}}b.deleteContents()},getPreviousNode:function(b,c){var d;if(!b){var e=this.getSelection();b=e.anchorNode}if(b===this.contain)return!1;var f,g=b.previousSibling;return g===this.contain?!1:(g&&3!==g.nodeType&&1!==g.nodeType?g=this.getPreviousNode(g,c):g&&3===g.nodeType&&/^\s*$/.test(g.textContent)?g=this.getPreviousNode(g,c):c&&g&&1===g.nodeType?(d=a.dom.getStyle("display").from(g),a.lang.array(["BR","HR","IMG"]).contains(g.nodeName)||a.lang.array(["block","inline-block","flex","list-item","table"]).contains(d)||!/^[\s]*$/.test(g.innerHTML)||(g=this.getPreviousNode(g,c))):g||b===this.contain||(f=b.parentNode,f!==this.contain&&(g=this.getPreviousNode(f,c))),g!==this.contain?g:!1)},getSelectionParentsByTag:function(b){for(var c,d=this.getSelectedOwnNodes(),e=[],f=0,g=d.length;g>f;f++)c=d[f].nodeName&&"LI"===d[f].nodeName?d[f]:a.dom.getParentElement(d[f],{query:"li"},!1,this.contain),c&&e.push(c);return e.length?e:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var a=this.getRange(),b=a.startContainer,c=a.startOffset,d=rangy.createRange(this.doc);return d.selectNodeContents(b),d.setStart(b,c),d}},caretIsLastInSelection:function(){var a=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),b=a.textContent;return/^\s*$/.test(b)},caretIsFirstInSelection:function(){var b=rangy.createRange(this.doc),c=this.getSelection(),d=this.getRange(),e=d.startContainer;return e?e.nodeType===a.TEXT_NODE?this.isCollapsed()&&e.nodeType===a.TEXT_NODE&&/^\s*$/.test(e.data.substr(0,d.startOffset)):(b.selectNodeContents(this.getRange().commonAncestorContainer),b.collapse(!0),this.isCollapsed()&&(b.startContainer===c.anchorNode||b.endContainer===c.anchorNode)&&b.startOffset===c.anchorOffset):void 0},caretIsInTheBeginnig:function(b){var c=this.getSelection(),d=c.anchorNode,e=c.anchorOffset;return b&&d?0===e&&(d.nodeName&&d.nodeName===b.toUpperCase()||a.dom.getParentElement(d.parentNode,{query:b},1)):d?0===e&&!this.getPreviousNode(d,!0):void 0},getBeforeSelection:function(b){var c,d,e=this.getSelection(),f=e.isBackwards()?e.focusNode:e.anchorNode,g=e.isBackwards()?e.focusOffset:e.anchorOffset,h=this.createRange();if(d=a.dom.getParentElement(f,{query:"._wysihtml5-temp-caret-fix"},1),d&&(f=d.parentNode,g=Array.prototype.indexOf.call(f.childNodes,d)),f){if(g>0)return 3===f.nodeType?(h.setStart(f,0),h.setEnd(f,g),{type:"text",range:h,offset:g,node:f}):(h.setStartBefore(f.childNodes[0]),c=f.childNodes[g-1],h.setEndAfter(c),{type:"element",range:h,offset:g,node:c});if(h.setStartAndEnd(f,0),b){var i=this.getPreviousNode(f,!0),j=null;if(i&&(j=1===i.nodeType&&a.dom.hasClass(i,this.unselectableClass)?i:a.dom.domNode(i).lastLeafNode()),j)return{type:"leafnode",range:h,offset:g,node:j}}return{type:"none",range:h,offset:g,node:f}}return null},executeAndRestoreRangy:function(a,b){var c=rangy.saveSelection(this.win);if(c)try{a()}catch(d){setTimeout(function(){throw d},0)}else a();rangy.restoreSelection(c)},executeAndRestore:function(b,c){var d,e,g,h,i,j,k,l,m=this.doc.body,n=c&&m.scrollTop,o=c&&m.scrollLeft,p="_wysihtml5-temp-placeholder",q='<span class="'+p+'">'+a.INVISIBLE_SPACE+"</span>",r=this.getRange(!0);if(!r)return void b(m,m);r.collapsed||(k=r.cloneRange(),j=k.createContextualFragment(q),k.collapse(!1),k.insertNode(j),k.detach()),i=r.createContextualFragment(q),r.insertNode(i),j&&(d=this.contain.querySelectorAll("."+p),r.setStartBefore(d[0]),r.setEndAfter(d[d.length-1])),this.setSelection(r);try{b(r.startContainer,r.endContainer)}catch(s){setTimeout(function(){throw s},0)}if(d=this.contain.querySelectorAll("."+p),d&&d.length){l=rangy.createRange(this.doc),g=d[0].nextSibling,d.length>1&&(h=d[d.length-1].previousSibling),h&&g?(l.setStartBefore(g),l.setEndAfter(h)):(e=this.doc.createTextNode(a.INVISIBLE_SPACE),f.insert(e).after(d[0]),l.setStartBefore(e),l.setEndAfter(e)),this.setSelection(l);for(var t=d.length;t--;)d[t].parentNode.removeChild(d[t])}else this.contain.focus();c&&(m.scrollTop=n,m.scrollLeft=o);try{d.parentNode.removeChild(d)}catch(u){}},set:function(a,b){var c=rangy.createRange(this.doc);c.setStart(a,b||0),this.setSelection(c)},insertHTML:function(a){var b,c,d=this.getRange(),e=this.doc.createElement("DIV"),f=this.doc.createDocumentFragment();if(d){for(d.deleteContents(),e.innerHTML=a,b=e.lastChild;e.firstChild;)f.appendChild(e.firstChild);for(d.insertNode(f),c=this.contain.lastChild;c&&3===c.nodeType&&c.previousSibling&&/^\s*$/.test(c.data);)c=c.previousSibling;b&&(c&&b===c&&1===b.nodeType&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(b))}},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},canAppendChild:function(a){var b,c,d=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],e=this.getRange();return b=a||e.startContainer,b&&(c=(b.tagName||b.nodeName).toLowerCase()),-1===d.indexOf(c)},splitElementAtCaret:function(b,c){var d,e,f,g,h,i=this.getSelection();if(i.rangeCount>0){d=i.getRangeAt(0).cloneRange(),d.setEndAfter(b),e=d.extractContents(),h=e.childNodes;for(var j=h.length;j--;)a.dom.domNode(h[j]).is.visible()||e.removeChild(h[j]);b.parentNode.insertBefore(e,b.nextSibling),c?(f=c.firstChild||c,g=c.lastChild||c,b.parentNode.insertBefore(c,b.nextSibling),f&&g&&(d.setStartBefore(f),d.setEndAfter(g),this.setSelection(d))):(d.setStartAfter(b),d.setEndAfter(b)),a.dom.domNode(b).is.visible()||(""===a.dom.getTextContent(b)?b.parentNode.removeChild(b):b.parentNode.replaceChild(this.doc.createTextNode(" "),b))}},surround:function(a){var b,c=this.getOwnRanges(),d=[];if(0==c.length)return d;for(var e=c.length;e--;){b=this.doc.createElement(a.nodeName),d.push(b),a.className&&(b.className=a.className),a.cssStyle&&b.setAttribute("style",a.cssStyle);try{c[e].surroundContents(b),this.selectNode(b)}catch(f){b.appendChild(c[e].extractContents()),c[e].insertNode(b)}}return d},deblockAndSurround:function(b){var c,d,e,f=this.doc.createElement("div"),g=rangy.createRange(this.doc);if(f.className=b.className,this.composer.commands.exec("formatBlock",b),c=this.contain.querySelectorAll("."+b.className),c[0])for(c[0].parentNode.insertBefore(f,c[0]),g.setStartBefore(c[0]),g.setEndAfter(c[c.length-1]),d=g.extractContents();d.firstChild;)if(e=d.firstChild,1==e.nodeType&&a.dom.hasClass(e,b.className)){for(;e.firstChild;)f.appendChild(e.firstChild);"BR"!==e.nodeName&&f.appendChild(this.doc.createElement("br")),d.removeChild(e)}else f.appendChild(e);else f=null;return f},scrollIntoView:function(){var c,d=this.doc,e=5,f=d.documentElement.scrollHeight>d.documentElement.offsetHeight,g=d._wysihtml5ScrollIntoViewElement=d._wysihtml5ScrollIntoViewElement||function(){var b=d.createElement("span");return b.innerHTML=a.INVISIBLE_SPACE,b}();f&&(this.insertNode(g),c=b(g),g.parentNode.removeChild(g),c>=d.body.scrollTop+d.documentElement.offsetHeight-e&&(d.body.scrollTop=c))},selectLine:function(){var b=rangy.createRange();a.browser.supportsSelectionModify()?this._selectLine_W3C():b.nativeRange&&b.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var a=this.getSelection(),b=a.getRangeAt(0),c=function(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")},d=function(a){return 1===a.nodeType?a.childNodes&&a.childNodes.length||0:a.data&&a.data.length||0},e=1===a.anchorNode.nodeType?a.anchorNode.childNodes[a.anchorOffset]:a.anchorNode,f=1===a.focusNode.nodeType?a.focusNode.childNodes[a.focusOffset]:a.focusNode;f&&a.focusOffset===d(f)&&f.nextSibling&&c(f.nextSibling)&&b.setEndAfter(f.nextSibling),e&&0===a.anchorOffset&&e.previousSibling&&c(e.previousSibling)&&b.setStartBefore(e.previousSibling),b.select()},_selectLine_W3C:function(){var a=this.win.getSelection(),b=[a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset];a.modify("move","left","lineboundary"),a.modify("extend","right","lineboundary"),a.anchorNode===b[0]&&a.anchorOffset===b[1]&&a.focusNode===b[2]&&a.focusOffset===b[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function(b,c){if(c="undefined"==typeof c?!1:c,a.browser.supportsSelectionModify()){var d=this.win.getSelection();d.modify("extend",b,"lineboundary"),c&&("left"===b?d.collapseToStart():"right"===b&&d.collapseToEnd())}},getRangeRect:function(a){var b,c=(this.doc.createTextNode("i"),this.doc.createTextNode("i"));return a.collapsed?(a.insertNode(c),a.selectNode(c),b=a.nativeRange.getBoundingClientRect(),a.deleteContents()):b=a.nativeRange.getBoundingClientRect(),b},_selectLineUniversal:function(){var b,c,d,e,f,g,h=this.getSelection(),i=h.getRangeAt(0),j=0,k=this,l=function(b){return b&&1===b.nodeType&&("block"===k.win.getComputedStyle(b).display||a.lang.array(["BR","HR"]).contains(b.nodeName))},m=function(a){var b=a;if(b)for(;b&&(1===b.nodeType&&b.classList.contains("rangySelectionBoundary")||3===b.nodeType&&/^\s*$/.test(b.data));)b=b.previousSibling;return b};c=i.cloneRange(),d=i.cloneRange(),i.collapsed&&(3===i.startContainer.nodeType&&i.startOffset<i.startContainer.data.length?i.moveEnd("character",1):1===i.startContainer.nodeType&&i.startContainer.childNodes[i.startOffset]&&3===i.startContainer.childNodes[i.startOffset].nodeType&&i.startContainer.childNodes[i.startOffset].data.length>0?i.moveEnd("character",1):i.startOffset>0&&(3===i.startContainer.nodeType||1===i.startContainer.nodeType&&!l(m(i.startContainer.childNodes[i.startOffset-1])))&&i.moveStart("character",-1)),i.collapsed||i.insertNode(this.doc.createTextNode(a.INVISIBLE_SPACE)),b=i.nativeRange.getBoundingClientRect();do e=i.moveStart("character",-1),f=i.nativeRange.getBoundingClientRect(),f&&Math.floor(f.top)===Math.floor(b.top)||(i.moveStart("character",1),g=!0),j++;while(0!==e&&!g&&2e3>j);j=0,g=!1,b=i.nativeRange.getBoundingClientRect();do e=i.moveEnd("character",1),f=i.nativeRange.getBoundingClientRect(),f&&Math.floor(f.bottom)===Math.floor(b.bottom)||(i.moveEnd("character",-1),i.endContainer&&1===i.endContainer.nodeType&&i.endContainer.childNodes[i.endOffset]&&1===i.endContainer.childNodes[i.endOffset].nodeType&&"BR"===i.endContainer.childNodes[i.endOffset].nodeName&&i.endContainer.childNodes[i.endOffset].previousSibling&&(1===i.endContainer.childNodes[i.endOffset].previousSibling.nodeType?i.setEnd(i.endContainer.childNodes[i.endOffset].previousSibling,i.endContainer.childNodes[i.endOffset].previousSibling.childNodes.length):3===i.endContainer.childNodes[i.endOffset].previousSibling.nodeType&&i.setEnd(i.endContainer.childNodes[i.endOffset].previousSibling,i.endContainer.childNodes[i.endOffset].previousSibling.data.length)),g=!0),j++;while(0!==e&&!g&&2e3>j);i.select(),this.includeRangyRangeHelpers()},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(a,b){var c=this.getRange();return c?c.getNodes(Array.isArray(a)?a:[a],b):[]},getOwnNodes:function(a,b,c){for(var d=this.getOwnRanges(),e=[],f=0,g=d.length;g>f;f++)d[f]&&(c&&d[f].splitBoundaries(),e=e.concat(d[f].getNodes(Array.isArray(a)?a:[a],b)));return e},fixRangeOverflow:function(a){if(this.contain&&this.contain.firstChild&&a){var b=a.compareNode(this.contain);if(2!==b)1===b&&a.setStartBefore(this.contain.firstChild),0===b&&a.setEndAfter(this.contain.lastChild),3===b&&(a.setStartBefore(this.contain.firstChild),a.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(a)){var c=a.endContainer.previousElementSibling;c&&a.setEnd(c,this._endOffsetForNode(c))}}},_endOffsetForNode:function(a){var b=document.createRange();return b.selectNodeContents(a),b.endOffset},_detectInlineRangeProblems:function(a){var b=f.compareDocumentPosition(a.startContainer,a.endContainer);return 0==a.endOffset&&4&b},getRange:function(a){var b=this.getSelection(),c=b&&b.rangeCount&&b.getRangeAt(0);return a!==!0&&this.fixRangeOverflow(c),c},getOwnUneditables:function(){var b=f.query(this.contain,"."+this.unselectableClass),c=f.query(b,"."+this.unselectableClass);return a.lang.array(b).without(c)},getOwnRanges:function(){var a,b=[],c=this.getRange();if(c&&b.push(c),this.unselectableClass&&this.contain&&c){var d,e=this.getOwnUneditables();if(e.length>0)for(var f=0,g=e.length;g>f;f++){a=[];for(var h=0,i=b.length;i>h;h++){if(b[h])switch(b[h].compareNode(e[f])){case 2:break;case 3:d=b[h].cloneRange(),d.setEndBefore(e[f]),a.push(d),d=b[h].cloneRange(),d.setStartAfter(e[f]),a.push(d);break;default:a.push(b[h])}b=a}}}return b},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(a){var b=rangy.getSelection(this.win);return b.setSingleRange(a),b&&b.anchorNode&&b.focusNode?b:null},selectAll:function(){var b,c=this.createRange(),e=this.composer,f=this,g=d(this.composer.element),h=d(this.composer.element),i=function(){c.setStart(e.element,0),c.setEnd(e.element,e.element.childNodes.length),b=f.setSelection(c)},j=function(){return!b||b.nativeSelection&&b.nativeSelection.type&&("Caret"===b.nativeSelection.type||"None"===b.nativeSelection.type)};a.dom.removeInvisibleSpaces(this.composer.element),i(),this.composer.element.firstChild&&j()&&(this.composer.element.appendChild(g),i(),j()&&(g.parentNode.removeChild(g),this.composer.element.insertBefore(h,this.composer.element.firstChild),i(),j()&&(this.composer.element.appendChild(g),i())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(b){var c=this.getRange(),d=c.commonAncestorContainer,e=c.startContainer,f=c.endContainer;if(d.nodeType===a.TEXT_NODE&&(d=d.parentNode),e.nodeType===a.TEXT_NODE&&!/^\s*$/.test(e.data.substr(c.startOffset)))return!1;if(f.nodeType===a.TEXT_NODE&&!/^\s*$/.test(f.data.substr(c.endOffset)))return!1;for(;e&&e!==d;){if(e.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,e))return!1;if(a.dom.domNode(e).prev({ignoreBlankTexts:!0}))return!1;e=e.parentNode}for(;f&&f!==d;){if(f.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,f))return!1;if(a.dom.domNode(f).next({ignoreBlankTexts:!0}))return!1;f=f.parentNode}return a.lang.array(b).contains(d.nodeName)?d:!1},isInThisEditable:function(){var b=this.getSelection(),c=b.focusNode,d=b.anchorNode;return c&&1!==c.nodeType&&(c=c.parentNode),d&&1!==d.nodeType&&(d=d.parentNode),d&&c&&(a.dom.contains(this.composer.element,c)||this.composer.element===c)&&(a.dom.contains(this.composer.element,d)||this.composer.element===d)},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})}(wysihtml5),function(a,b){function c(a,b,c){if(!a.className)return!1;var d=a.className.match(c)||[];return d[d.length-1]===b}function d(a,b){if(!a.getAttribute||!a.getAttribute("style"))return!1;a.getAttribute("style").match(b);return a.getAttribute("style").match(b)?!0:!1}function e(a,b,c){a.getAttribute("style")?(h(a,c),a.getAttribute("style")&&!/^\s*$/.test(a.getAttribute("style"))?a.setAttribute("style",b+";"+a.getAttribute("style")):a.setAttribute("style",b)):a.setAttribute("style",b)}function f(a,b,c){a.className?(g(a,c),a.className+=" "+b):a.className=b}function g(a,b){a.className&&(a.className=a.className.replace(b,""))}function h(a,b){var c,d=[];if(a.getAttribute("style")){c=a.getAttribute("style").split(";");for(var e=c.length;e--;)c[e].match(b)||/^\s*$/.test(c[e])||d.push(c[e]);d.length?a.setAttribute("style",d.join(";")):a.removeAttribute("style")}}function i(a,b){var c=[],d=b.split(";"),e=a.getAttribute("style");if(e){e=e.replace(/\s/gi,"").toLowerCase(),c.push(new RegExp("(^|\\s|;)"+b.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var f=d.length;f-->0;)/^\s*$/.test(d[f])||c.push(new RegExp("(^|\\s|;)"+d[f].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var g=0,h=c.length;h>g;g++)if(e.match(c[g]))return c[g]}return!1}function j(c,d,e,f){return e?i(c,e):f?a.dom.hasClass(c,f):b.dom.arrayContains(d,c.tagName.toLowerCase())}function k(a,b,c,d){for(var e=a.length;e--;)if(!j(a[e],b,c,d))return!1;return a.length?!0:!1}function l(a,b,c){var d=i(a,b);return d?(h(a,d),"remove"):(e(a,b,c),"change")}function m(a,b){return a.className.replace(u," ")==b.className.replace(u," ")}function n(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a)}function o(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c,d,e,f=0,g=a.attributes.length;g>f;++f)if(c=a.attributes[f],e=c.name,"class"!=e){if(d=b.attributes.getNamedItem(e),c.specified!=d.specified)return!1;if(c.specified&&c.nodeValue!==d.nodeValue)return!1}return!0}function p(a,c){return b.dom.isCharacterDataNode(a)?0==c?!!a.previousSibling:c==a.length?!!a.nextSibling:!0:c>0&&c<a.childNodes.length}function q(a,c,d,e){var f;if(b.dom.isCharacterDataNode(c)&&(0==d?(d=b.dom.getNodeIndex(c),c=c.parentNode):d==c.length?(d=b.dom.getNodeIndex(c)+1,c=c.parentNode):f=b.dom.splitDataNode(c,d)),!(f||e&&c===e)){f=c.cloneNode(!1),f.id&&f.removeAttribute("id");for(var g;g=c.childNodes[d];)f.appendChild(g);b.dom.insertAfter(f,c)}return c==a?f:q(a,f.parentNode,b.dom.getNodeIndex(f),e)}function r(b){this.isElementMerge=b.nodeType==a.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?b.lastChild:b,this.textNodes=[this.firstTextNode]}function s(a,b,c,d,e,f,g){this.tagNames=a||[t],this.cssClass=b||(b===!1?!1:""),this.similarClassRegExp=c,this.cssStyle=e||"",this.similarStyleRegExp=f,this.normalize=d,this.applyToAnyTagName=!1,this.container=g}var t="span",u=/\s+/g;
r.prototype={doMerge:function(){for(var a,b,c,d=[],e=0,f=this.textNodes.length;f>e;++e)a=this.textNodes[e],b=a.parentNode,d[e]=a.data,e&&(b.removeChild(a),b.hasChildNodes()||b.parentNode.removeChild(b));return this.firstTextNode.data=c=d.join(""),c},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;c>b;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}},s.prototype={getAncestorWithClass:function(d){for(var e;d;){if(e=this.cssClass?c(d,this.cssClass,this.similarClassRegExp):""!==this.cssStyle?!1:!0,d.nodeType==a.ELEMENT_NODE&&"false"!=d.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,d.tagName.toLowerCase())&&e)return d;d=d.parentNode}return!1},getAncestorWithStyle:function(c){for(var e;c;){if(e=this.cssStyle?d(c,this.similarStyleRegExp):!1,c.nodeType==a.ELEMENT_NODE&&"false"!=c.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&e)return c;c=c.parentNode}return!1},getMatchingAncestor:function(a){var b=this.getAncestorWithClass(a),c=!1;return b?this.cssStyle&&(c="class"):(b=this.getAncestorWithStyle(a),b&&(c="style")),{element:b,type:c}},postApply:function(a,b){for(var c,d,e,f=a[0],g=a[a.length-1],h=[],i=f,j=g,k=0,l=g.length,m=0,n=a.length;n>m;++m)d=a[m],e=null,d&&d.parentNode&&(e=this.getAdjacentMergeableTextNode(d.parentNode,!1)),e?(c||(c=new r(e),h.push(c)),c.textNodes.push(d),d===f&&(i=c.firstTextNode,k=i.length),d===g&&(j=c.firstTextNode,l=c.getLength())):c=null;if(g&&g.parentNode){var o=this.getAdjacentMergeableTextNode(g.parentNode,!0);o&&(c||(c=new r(g),h.push(c)),c.textNodes.push(o))}if(h.length){for(m=0,n=h.length;n>m;++m)h[m].doMerge();b.setStart(i,k),b.setEnd(j,l)}},getAdjacentMergeableTextNode:function(b,c){var d,e=b.nodeType==a.TEXT_NODE,f=e?b.parentNode:b,g=c?"nextSibling":"previousSibling";if(e){if(d=b[g],d&&d.nodeType==a.TEXT_NODE)return d}else if(d=f[g],d&&this.areElementsMergeable(b,d))return d[c?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,c){return b.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&b.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())&&m(a,c)&&o(a,c)},createContainer:function(a){var b=a.createElement(this.tagNames[0]);return this.cssClass&&(b.className=this.cssClass),this.cssStyle&&b.setAttribute("style",this.cssStyle),b},applyToTextNode:function(a){var c=a.parentNode;if(1==c.childNodes.length&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase()))this.cssClass&&f(c,this.cssClass,this.similarClassRegExp),this.cssStyle&&e(c,this.cssStyle,this.similarStyleRegExp);else{var d=this.createContainer(b.dom.getDocument(a));a.parentNode.insertBefore(d,a),d.appendChild(a)}},isRemovable:function(c){return b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&""===a.lang.string(c.className).trim()&&(!c.getAttribute("style")||""===a.lang.string(c.getAttribute("style")).trim())},undoToTextNode:function(a,b,c,d){var e=c?!1:!0,f=c||d,h=!1;if(!b.containsNode(f)){var i=b.cloneRange();i.selectNode(f),i.isPointInRange(b.endContainer,b.endOffset)&&p(b.endContainer,b.endOffset)&&(q(f,b.endContainer,b.endOffset,this.container),b.setEndAfter(f)),i.isPointInRange(b.startContainer,b.startOffset)&&p(b.startContainer,b.startOffset)&&(f=q(f,b.startContainer,b.startOffset,this.container))}!e&&this.similarClassRegExp&&g(f,this.similarClassRegExp),e&&this.similarStyleRegExp&&(h="change"===l(f,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(f)&&!h&&n(f)},applyToRange:function(b){for(var c,d=b.length;d--;){if(c=b[d].getNodes([a.TEXT_NODE]),!c.length)try{var e=this.createContainer(b[d].endContainer.ownerDocument);return b[d].surroundContents(e),void this.selectNode(b[d],e)}catch(f){}if(b[d].splitBoundaries(),c=b[d].getNodes([a.TEXT_NODE]),c.length){for(var g,h=0,i=c.length;i>h;++h)g=c[h],this.getMatchingAncestor(g).element||this.applyToTextNode(g);b[d].setStart(c[0],0),g=c[c.length-1],b[d].setEnd(g,g.length),this.normalize&&this.postApply(c,b[d])}}},undoToRange:function(b){for(var c,d,e,f=b.length;f--;){if(c=b[f].getNodes([a.TEXT_NODE]),c.length)b[f].splitBoundaries(),c=b[f].getNodes([a.TEXT_NODE]);else{var g=b[f].endContainer.ownerDocument,h=g.createTextNode(a.INVISIBLE_SPACE);b[f].insertNode(h),b[f].selectNode(h),c=[h]}for(var i=0,j=c.length;j>i;++i)b[f].isValid()&&(d=c[i],e=this.getMatchingAncestor(d),"style"===e.type?this.undoToTextNode(d,b[f],!1,e.element):e.element&&this.undoToTextNode(d,b[f],e.element));1==j?this.selectNode(b[f],c[0]):(b[f].setStart(c[0],0),d=c[c.length-1],b[f].setEnd(d,d.length),this.normalize&&this.postApply(c,b[f]))}},selectNode:function(b,c){var d=c.nodeType===a.ELEMENT_NODE,e="canHaveHTML"in c?c.canHaveHTML:!0,f=d?c.innerHTML:c.data,g=""===f||f===a.INVISIBLE_SPACE;if(g&&d&&e)try{c.innerHTML=a.INVISIBLE_SPACE}catch(h){}b.selectNodeContents(c),g&&d?b.collapse(!1):g&&(b.setStartAfter(c),b.setEndAfter(c))},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b),e=d?d.toString():"";return c.detach(),e},isAppliedToRange:function(b){for(var c,d,e=[],f="full",g=b.length;g--;){if(d=b[g].getNodes([a.TEXT_NODE]),!d.length)return c=this.getMatchingAncestor(b[g].startContainer).element,c?{elements:[c],coverage:f}:!1;for(var h,i=0,j=d.length;j>i;++i)h=this.getTextSelectedByRange(d[i],b[g]),c=this.getMatchingAncestor(d[i]).element,c&&""!=h?(e.push(c),1===a.dom.getTextNodes(c,!0).length?f="full":"full"===f&&(f="inline")):c||(f="partial")}return e.length?{elements:e,coverage:f}:!1},toggleRange:function(a){var b,c=this.isAppliedToRange(a);c?"full"===c.coverage?this.undoToRange(a):"inline"===c.coverage?(b=k(c.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(a),b||this.applyToRange(a)):(k(c.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(a),this.applyToRange(a)):this.applyToRange(a)}},a.selection.HTMLApplier=s}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.exec,f=null;if(this.composer.hasPlaceholderSet()&&!wysihtml5.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(a)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),e)d.unshift(this.composer),f=e.apply(c,d);else try{f=this.doc.execCommand(a,!1,b)}catch(g){}return this.editor.fire("aftercommand:composer"),f},remove:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.remove;return e?(d.unshift(this.composer),e.apply(c,d)):void 0},state:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.state;if(e)return d.unshift(this.composer),e.apply(c,d);try{return this.doc.queryCommandState(a)}catch(f){return!1}},stateValue:function(a){var b=wysihtml5.commands[a],c=wysihtml5.lang.array(arguments).get(),d=b&&b.stateValue;return d?(c.unshift(this.composer),d.apply(b,c)):!1}}),function(a){var b={nodeName:"B",toggle:!0};a.commands.bold={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){function b(b){return a.lang.object({}).merge(c).merge({attribute:b}).get()}var c={nodeName:"A",toggle:!1};a.commands.createLink={exec:function(c,d,e){var f=b(e);if(c.selection.isCollapsed()&&!this.state(c,d)){var g=c.doc.createTextNode(f.attribute.href);c.selection.insertNode(g),c.selection.selectNode(g)}a.commands.formatInline.exec(c,d,f)},state:function(b,d){return a.commands.formatInline.state(b,d,c)}}}(wysihtml5),function(a){var b={nodeName:"A"};a.commands.removeLink={exec:function(c,d){a.commands.formatInline.remove(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(c,d,e){a.commands.formatInline.exec(c,d,{className:"wysiwyg-font-size-"+e,classRegExp:b,toggle:!0})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{className:"wysiwyg-font-size-"+d})}}}(wysihtml5),function(a){a.commands.fontSizeStyle={exec:function(b,c,d){d=d.size||d,/^\s*$/.test(d)||a.commands.formatInline.exec(b,c,{styleProperty:"fontSize",styleValue:d,toggle:!1})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{styleProperty:"fontSize",styleValue:d||void 0})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"fontSize"})},stateValue:function(b,c){var d,e=this.state(b,c);return e&&a.lang.object(e).isArray()&&(e=e[0]),e&&(d=e.getAttribute("style"))?a.quirks.styleParser.parseFontSize(d):!1}}}(wysihtml5),function(a){var b=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(c,d,e){a.commands.formatInline.exec(c,d,{className:"wysiwyg-color-"+e,classRegExp:b,toggle:!0})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{className:"wysiwyg-color-"+d})}}}(wysihtml5),function(a){a.commands.foreColorStyle={exec:function(b,c,d){var e,f;d&&(e=a.quirks.styleParser.parseColor("color:"+(d.color||d),"color"),e&&(f=(1===e[3]?"rgb("+[e[0],e[1],e[2]].join(", "):"rgba("+e.join(", "))+")",a.commands.formatInline.exec(b,c,{styleProperty:"color",styleValue:f})))},state:function(b,c,d){var e,f=d?a.quirks.styleParser.parseColor("color:"+(d.color||d),"color"):null;return f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")"),a.commands.formatInline.state(b,c,{styleProperty:"color",styleValue:e})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"color"})},stateValue:function(b,c,d){var e,f=this.state(b,c),g=!1;return f&&a.lang.object(f).isArray()&&(f=f[0]),f&&(e=f.getAttribute("style"))?(g=a.quirks.styleParser.parseColor(e,"color"),a.quirks.styleParser.unparseColor(g,d)):!1}}}(wysihtml5),function(a){a.commands.bgColorStyle={exec:function(b,c,d){var e,f=a.quirks.styleParser.parseColor("background-color:"+(d.color||d),"background-color");f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")",a.commands.formatInline.exec(b,c,{styleProperty:"backgroundColor",styleValue:e}))},state:function(b,c,d){var e,f=d?a.quirks.styleParser.parseColor("background-color:"+(d.color||d),"background-color"):null;return f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")"),a.commands.formatInline.state(b,c,{styleProperty:"backgroundColor",styleValue:e})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"backgroundColor"})},stateValue:function(b,c,d){var e,f=this.state(b,c),g=!1;return f&&a.lang.object(f).isArray()&&(f=f[0]),f&&(e=f.getAttribute("style"))?(g=a.quirks.styleParser.parseColor(e,"background-color"),a.quirks.styleParser.unparseColor(g,d)):!1}}}(wysihtml5),function(a){function b(a){return{nodeName:a.nodeName||null,className:a.classRegExp?null:a.className||null,classRegExp:a.classRegExp||null,styleProperty:a.styleProperty||null}}function c(a,b){return 3===a.nodeType?a:a.childNodes[b]||a}function d(a){return a&&1===a.nodeType&&"BR"===a.nodeName}function e(a,b){return a&&1===a.nodeType&&"block"===b.win.getComputedStyle(a).display}function f(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")}function g(a,b){return d(a)||e(a,b)}function h(b,c){a.dom.removeInvisibleSpaces(b.element);for(var d,e=b.element,f=e.querySelectorAll(D),g=b.config.classNames.uneditableContainer+[""].concat(D.split(",")).join(", "+b.config.classNames.uneditableContainer+" "),h=e.querySelectorAll(g),i=a.lang.array(f).without(h),j=i.length;j--;)""===i[j].innerHTML.replace(/[\uFEFF]/g,"")&&(d=a.lang.array(c).indexOf(i[j]),d>-1&&c.splice(d,1),i[j].parentNode.removeChild(i[j]));return c}function i(a){return a.config.useLineBreaks?"DIV":"P"}function j(a,b,c){for(var d=a,e=null;d&&b&&d!==b;)1===d.nodeType&&d.matches(c?D:C)&&(e=d),d=d.parentNode;return e}function k(a,b){for(var c,d,e,f=a,g=null;f&&b&&f!==b;)1===f.nodeType&&f.matches(E)&&(d=f,null===g?(g=f.cloneNode(!1),c=g):(e=f.cloneNode(!1),e.appendChild(g),g=e)),f=f.parentNode;return{parent:d,outerNode:g,innerNode:c}}function l(b,c,d){return b||(b=d.doc.createElement(c.nodeName||i(d)),b.appendChild(d.doc.createTextNode(a.INVISIBLE_SPACE))),c.nodeName&&b.nodeName!==c.nodeName&&(b=B.renameElement(b,c.nodeName)),c.classRegExp&&(b.className=b.className.replace(c.classRegExp,"")),c.className&&b.classList.add(c.className),c.styleProperty&&"undefined"!=typeof c.styleValue&&(b.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue),b}function m(b,c,d){var e,f=b.previousSibling,g=b.nextSibling,h=!1;c.styleProperty&&(b.style[a.browser.fixStyleKey(c.styleProperty)]=""),c.className&&b.classList.remove(c.className),c.classRegExp&&(b.className=b.className.replace(c.classRegExp,"")),null!==b.getAttribute("class")&&""===b.getAttribute("class").trim()&&b.removeAttribute("class"),c.nodeName&&b.nodeName.toLowerCase()===c.nodeName.toLowerCase()&&(e=b.getAttribute("style"),e&&""!==e.trim()?b=B.renameElement(b,i(d)):(B.unwrap(b),h=!0)),null!==b.getAttribute("style")&&""===b.getAttribute("style").trim()&&b.removeAttribute("style"),h&&u(f,g,d)}function n(b){for(var c,d,e=b.querySelectorAll(D)||[],f=e.length;f--;)c=a.dom.domNode(e[f]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),d=a.dom.domNode(e[f]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(e[f].innerHTML||e[f].nodeValue||"").trim()&&e[f].parentNode.insertBefore(e[f].ownerDocument.createElement("BR"),c),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(e[f].innerHTML||e[f].nodeValue||"").trim()&&e[f].parentNode.insertBefore(e[f].ownerDocument.createElement("BR"),c),a.dom.unwrap(e[f])}function o(a,b){var c,d=a.startContainer,e=a.endContainer;return d&&1===d.nodeType&&d===e?void(d.firstChild===d.lastChild&&1===a.endOffset&&d!==b.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&(a.setStartBefore(d),a.setEndAfter(e))):d&&1===d.nodeType&&3===e.nodeType?void(d.firstChild===e&&a.endOffset===e.data.length&&d!==b.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&a.setEndAfter(d)):e&&1===e.nodeType&&3===d.nodeType?void(e.firstChild===d&&0===a.startOffset&&e!==b.element&&"LI"!==e.nodeName&&"TD"!==e.nodeName&&a.setStartBefore(e)):d&&3===d.nodeType&&d===e&&1===d.parentNode.childNodes.length?void(a.endOffset==e.data.length&&0===a.startOffset&&(c=d.parentNode,c!==b.element&&"LI"!==c.nodeName&&"TD"!==c.nodeName&&(a.setStartBefore(c),a.setEndAfter(c)))):void 0}function p(b){for(var c,d,e,f,g,h,i=[],j=0,k=b.length;k>j;j++)if(1===b[j].startContainer.nodeType&&b[j].startContainer.matches("ul, ol")&&b[j].setStart(b[j].startContainer.childNodes[b[j].startOffset],0),1===b[j].endContainer.nodeType&&b[j].endContainer.matches("ul, ol")&&(h=b[j].endContainer.childNodes[Math.max(b[j].endOffset-1,0)],h.childNodes&&b[j].setEnd(h,h.childNodes.length)),c=b[j].getNodes([1],function(a){return"LI"===a.nodeName}),c.length>0){for(d=0,e=c.length;e>d;d++)g=b[j].compareNode(c[d]),(g===b[j].NODE_AFTER||g===b[j].NODE_INSIDE)&&(f=b[j].cloneRange(),h=a.dom.domNode(c[d]).prev({nodeTypes:[1]}),h?f.setEnd(h,h.childNodes.length):c[d].closest("ul, ol")?f.setEndBefore(c[d].closest("ul, ol")):f.setEndBefore(c[d]),i.push(f),b[j].setStart(c[d],0)),(g===b[j].NODE_BEFORE||g===b[j].NODE_INSIDE)&&(f=b[j].cloneRange(),f.setEnd(c[d],c[d].childNodes.length),i.push(f),h=a.dom.domNode(c[d]).next({nodeTypes:[1]}),h?b[j].setStart(h,0):c[d].closest("ul, ol")?b[j].setStartAfter(c[d].closest("ul, ol")):b[j].setStartAfter(c[d]));i.push(b[j])}else i.push(b[j]);return i}function q(b,c,d){var e=b?a.lang.object(b).clone(!0):null;return e&&(e.nodeName=e.nodeName||c||i(d)),e}function r(b,c,d,e){var f,h,i,l,m,n=c.startContainer,e=e||j(n,d.element,!0);if(e)h=b.firstChild,i=b.lastChild,d.selection.splitElementAtCaret(e,b),m=a.dom.domNode(i).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),l=a.dom.domNode(h).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),h&&!g(h,d)&&l&&!g(l,d)&&h.parentNode.insertBefore(d.doc.createElement("br"),h),i&&!g(i,d)&&m&&!g(m,d)&&m.parentNode.insertBefore(d.doc.createElement("br"),m);else if(f=k(n,d.element),f.outerNode&&f.innerNode&&f.parent){if(1===b.childNodes.length){for(;b.firstChild.firstChild;)f.innerNode.appendChild(b.firstChild.firstChild);b.firstChild.appendChild(f.outerNode)}d.selection.splitElementAtCaret(f.parent,b)}else c.insertNode(b)}function s(b,d,e){for(var f,h,i=b.cloneRange(),j=c(i.startContainer,i.startOffset).previousSibling,k=c(i.endContainer,i.endOffset).nextSibling,l=i.extractContents(),m=e.doc.createDocumentFragment(),o=!0;l.firstChild;){if(1===l.firstChild.nodeType&&l.firstChild.matches(D)){n(l.firstChild),f=a.dom.unwrap(l.firstChild),f.length>0&&(m.lastChild&&(1!==m.lastChild.nodeType||!g(m.lastChild,e))||!m.lastChild&&j&&(1!==j.nodeType||g(j,e)))&&m.appendChild(e.doc.createElement("BR"));for(var p=0,q=f.length;q>p;p++)m.appendChild(f[p]);f.length>0&&(1===m.lastChild.nodeType&&g(m.lastChild,e)||(k||m.lastChild!==l.lastChild)&&m.appendChild(e.doc.createElement("BR")))}else m.appendChild(l.firstChild);o=!1}return h=a.lang.array(m.childNodes).get(),r(m,i,e),h}function t(b,c,e){var f=b&&a.dom.domNode(b).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});d(c)&&c.parentNode.removeChild(c),!d(b)||f&&1===f.nodeType&&"block"===e.win.getComputedStyle(f).display||b.parentNode.removeChild(b)}function u(a,b,c){var e;a&&f(a)&&(a=a.previousSibling),b&&f(b)&&(b=b.nextSibling),e=a&&a.previousSibling,a&&(1!==a.nodeType||"block"!==c.win.getComputedStyle(a).display&&!d(a))&&a.parentNode&&a.parentNode.insertBefore(c.doc.createElement("br"),a.nextSibling),b&&(1!==b.nodeType||"block"!==c.win.getComputedStyle(b).display)&&b.parentNode&&b.parentNode.insertBefore(c.doc.createElement("br"),b)}function v(d,e,f,g){var h,i,k=e?b(e):null,m=d.cloneRange(),o=m.startContainer,p=a.dom.domNode(c(m.startContainer,m.startOffset)).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),s=a.dom.domNode(c(m.endContainer,m.endOffset)).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),u=m.extractContents(),v=g.doc.createDocumentFragment(),w=k?a.dom.getParentElement(o,k,null,g.element):null,x=!f||!e||"BLOCKQUOTE"===e.nodeName&&"BLOCKQUOTE"===f,y=w||j(o,g.element,x);if(e&&"BLOCKQUOTE"===e.nodeName){var z=l(null,e,g);z.appendChild(u),v.appendChild(z),i=[z]}else{if(u.firstChild)for(;u.firstChild;)if(1==u.firstChild.nodeType&&u.firstChild.matches(D))l(u.firstChild,e,g),u.firstChild.matches(C)&&n(u.firstChild),v.appendChild(u.firstChild);else{for(h=l(null,q(e,f,g),g);u.firstChild&&(1!==u.firstChild.nodeType||!u.firstChild.matches(D));)1==u.firstChild.nodeType&&h.matches(C)&&n(u.firstChild),h.appendChild(u.firstChild);v.appendChild(h)}else v.appendChild(l(null,e,g));i=a.lang.array(v.childNodes).get()}return r(v,m,g,y),t(p,s,g),i}function w(b,c){var d=a.dom.getParentElement(b,{query:D},null,c.element);return d?d.nodeName:null}function x(b,c){var d,e=a.dom.getParentElement(b.selection.getOwnRanges()[0].startContainer,{query:C+", "+(c?c.toLowerCase():"div")},null,b.element);e?(d=b.selection.createRange(),d.selectNode(e),b.selection.setSelection(d)):b.isEmpty()||b.selection.selectLine()}function y(a,b){var c=b.selection.createRange(),d=a[a.length-1],e=1===d.nodeType&&d.childNodes?0|d.childNodes.length:d.length||0;c.setStart(a[0],0),c.setEnd(d,e),c.select()}function z(a,b,c){var d,e=b.selection.getOwnRanges(),f=[];e=p(e);for(var g=e.length;g--;)o(e[g],b),d=w(e[g].startContainer,b),f="remove"===a?f.concat(s(e[g],d,b)):f.concat(v(e[g],c,d,b));return f}function A(a){return"string"==typeof a&&(a={nodeName:a.toUpperCase()}),a}var B=a.dom,C="h1, h2, h3, h4, h5, h6, p, pre",D="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",E="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u";a.commands.formatBlock={exec:function(a,b,c){c=A(c);var d,e,f=[];if(c&&c.toggle&&(e=this.state(a,b,c)),e){d=rangy.saveSelection(a.win);for(var g=0,i=e.length;i>g;g++)m(e[g],c,a)}else a.selection.isCollapsed()&&(d=rangy.saveSelection(a.win),x(a,c&&c.nodeName?c.nodeName.toUpperCase():void 0)),f=c?z("apply",a,c):z("remove",a);f=h(a,f),d?rangy.restoreSelection(d):y(f,a)},remove:function(a,b,c){c=A(c);var d,e;a.selection.isCollapsed()&&(e=rangy.saveSelection(a.win),x(a,c&&c.nodeName?c.nodeName.toUpperCase():void 0)),d=z("remove",a),d=h(a,d),e?rangy.restoreSelection(e):y(d,a)},state:function(b,c,d){d=A(d);for(var e,f=b.selection.filterElements(function(b){return a.dom.domNode(b).test(d||{query:D})}.bind(this)),g=b.selection.getSelectedOwnNodes(),h=0,i=g.length;i>h;h++)e=B.getParentElement(g[h],d||{query:D},null,b.element),e&&-1===f.indexOf(e)&&f.push(e);return 0===f.length?!1:f}}}(wysihtml5),function(a){a.commands.formatCode={exec:function(b,c,d){var e,f,g,h=this.state(b)[0];h?b.selection.executeAndRestore(function(){e=h.querySelector("code"),a.dom.replaceWithChildNodes(h),e&&a.dom.replaceWithChildNodes(e)}):(f=b.selection.getRange(),g=f.extractContents(),h=b.doc.createElement("pre"),e=b.doc.createElement("code"),d&&(e.className=d),h.appendChild(e),e.appendChild(g),f.insertNode(h),b.selection.selectNode(h))},state:function(b){var c,d=b.selection.getSelectedNode();return d&&d.nodeName&&"PRE"==d.nodeName&&d.firstChild&&d.firstChild.nodeName&&"CODE"==d.firstChild.nodeName?[d]:(c=a.dom.getParentElement(d,{query:"pre code"}),c?[c.parentNode]:!1)}}}(wysihtml5),function(a){function b(a){return/^\s*$/.test(a.className)}function c(a){return!a.getAttribute("style")||/^\s*$/.test(a.getAttribute("style"))}function d(b){var c=a.dom.getAttributes(b);return a.lang.object(c).isEmpty()}function e(b,c){var d,e,f,g;return 1!==b.nodeType||1!==c.nodeType?!1:b.nodeName!==c.nodeName?!1:(d=b.className.trim().replace(/\s+/g," ").split(" "),e=c.className.trim().replace(/\s+/g," ").split(" "),a.lang.array(d).without(e).length>0?!1:(f=a.dom.getAttributes(b),g=a.dom.getAttributes(c),f.length===g.length&&a.lang.object(a.lang.object(f).difference(g)).isEmpty()?!0:!1))}function f(b,c){var d=c&&c.nodeName||F,e=b.ownerDocument.createElement(d);if(c.classRegExp&&(e.className=e.className.replace(c.classRegExp,"")),c.className&&e.classList.add(c.className),c.styleProperty&&"undefined"!=typeof c.styleValue&&(e.style[a.browser.fixStyleKey(c.styleProperty)]=c.styleValue),c.attribute)if("object"==typeof c.attribute)for(var f in c.attribute)c.attribute.hasOwnProperty(f)&&e.setAttribute(f,c.attribute[f]);else"undefined"!=typeof c.attributeValue&&e.setAttribute(c.attribute,c.attributeValue);return e}function g(a,b){for(var c in a)if(a.hasOwnProperty(c)&&(void 0===typeof b[c]||b[c]!==a[c]))return!1;return!0}function h(b,c,d){var e,f=a.dom.getAttributes(b),h=g(c,f);a.lang.object(f).difference(c);if(h&&d!==!1)for(e in c)c.hasOwnProperty(e)&&b.removeAttribute(e);else for(e in c)c.hasOwnProperty(e)&&b.setAttribute(e,c[e])}function i(e,f){var g,i,j;f.className&&(f.toggle!==!1&&e.classList.contains(f.className)?e.classList.remove(f.className):(f.classRegExp&&(e.className=e.className.replace(f.classRegExp,"")),e.classList.add(f.className)),b(e)&&e.removeAttribute("class")),f.styleProperty&&(f.toggle!==!1&&e.style[a.browser.fixStyleKey(f.styleProperty)].trim().replace(/, /g,",")===f.styleValue?e.style[a.browser.fixStyleKey(f.styleProperty)]="":e.style[a.browser.fixStyleKey(f.styleProperty)]=f.styleValue),c(e)&&e.removeAttribute("style"),f.attribute&&("object"==typeof f.attribute?g=f.attribute:(g={},g[f.attribute]=f.attributeValue||""),h(e,g,f.toggle)),i=f.nodeName?H[f.nodeName.toLowerCase()]||f.nodeName.toLowerCase():null,j=i?a.dom.domNode(e).test({query:i}):!1,(!f.nodeName||f.nodeName===F||j)&&(f.toggle!==!1&&j||!f.nodeName&&e.nodeName===F)&&b(e)&&c(e)&&d(e)&&a.dom.unwrap(e)}function j(b,c){var d=[];return b.isCollapsed()||(d=d.concat(b.getOwnNodes([3],function(b){return!a.dom.domNode(b).is.emptyTextNode()},c))),d}function k(a,b,c,d){var e=a,f=d?b:l(b);do{if(1===e.nodeType&&m(e,f))return e;e=e.parentNode}while(e&&e!==c);return null}function l(a){return{nodeName:a.nodeName||null,className:a.classRegExp?null:a.className||null,classRegExp:a.classRegExp||null,styleProperty:a.styleProperty||null}}function m(b,c){var d;if(c.nodeName){var e=H[c.nodeName.toLowerCase()]||c.nodeName.toLowerCase();return a.dom.domNode(b).test({query:e})}return d=a.lang.object(c).clone(),d.query=G,a.dom.domNode(b).test(d)}function n(b,c){var d=document.documentElement||document.body,e=d.scrollTop,f=d.scrollLeft;rangy.getSelection(b.win);rangy.getSelection(b.win).removeAllRanges();try{rangy.getSelection(b.win).addRange(c)}catch(g){}b.doc.activeElement&&a.dom.contains(b.element,b.doc.activeElement)||(b.element.focus(),d.scrollTop=e,d.scrollLeft=f,rangy.getSelection(b.win).addRange(c))}function o(a,b){var c=rangy.createRange(b.doc),d=a[a.length-1];a[0]&&d&&(c.setStart(a[0],0),c.setEnd(d,d.length),n(b,c))}function p(a,b,c,d){var e=rangy.createRange(a.doc);b&&(e.setStart(b,c),e.setEnd(b,"undefined"!=typeof d?d:c),n(a,e))}function q(a,b,c){var d,e,f,g=j(a.selection),h=[],i=!1;if(a.selection.isInThisEditable()){if(0===g.length&&a.selection.isCollapsed()){if(f=a.selection.getSelection().anchorNode,!f)return{nodes:[],partial:!1};3===f.nodeType&&(g=[f])}g.length||(e=a.selection.getOwnRanges()[0],e&&(g=[e.endContainer]));for(var l=0,m=g.length;m>l;l++)d=k(g[l],b,a.element,c),d?h.push(d):i=!0}return{nodes:h,partial:i}}function r(a){var b,c,d,e;return a&&(b=a.anchorNode,c=a.anchorOffset,b&&3===b.nodeType&&c>0&&c<b.data.length)?(d=b.data[c-1],e=b.data[c],/\w/.test(d)&&/\w/.test(e)):!1}function s(b){var c,d,e,f,g,h,i=[];if(b&&(c=b.anchorNode,d=g=h=b.anchorOffset,e=c.ownerDocument,f=rangy.createRange(e),c&&3===c.nodeType)){for(;g>0&&/\w/.test(c.data[g-1]);)g--;for(;h<c.data.length&&/\w/.test(c.data[h]);)h++;return f.setStartAndEnd(c,g,h),f.splitBoundaries(),i=f.getNodes([3],function(b){return!a.dom.domNode(b).is.emptyTextNode()}),{wordOffset:d-g,range:f,textNode:i[0]}}return!1}function t(a,b){for(;b.firstChild;)a.appendChild(b.firstChild);b.parentNode.removeChild(b)}function u(a){for(var b=a.length;b--;)a[b]&&a[b].parentNode&&(a[b].nextSibling&&e(a[b],a[b].nextSibling)&&t(a[b],a[b].nextSibling),a[b].previousSibling&&e(a[b],a[b].previousSibling)&&t(a[b].previousSibling,a[b]))}function v(a,b,c){b.length>0&&o(b,a),u(q(a,c).nodes),b.length>0&&o(b,a)}function w(a,b,c,d){p(a,b,c),u(q(a,d).nodes),p(a,b,c)}function x(a,b){var c=f(a,b);a.parentNode.insertBefore(c,a),c.appendChild(a)}function y(b,c,d){var e,f=c.element,g=k(b,d,f);g&&(e=g.cloneNode(!1),a.dom.domNode(b).escapeParent(g,e),i(e,d))}function z(b,c,d){var e=c.element,f=k(b,d,e);f&&a.dom.domNode(b).escapeParent(f)}function A(a,b,c){var d=f(a.endContainer,c);a.surroundContents(d),b.selection.selectNode(d)}function B(b,c,d,e){var f,g,h,j,l=q(b,e,!0),m=b.selection.getSelection();if(c.length){if(l.partial||e.toggle===!1)for(j=c.length;j--;)k(c[j],e,b.element)&&y(c[j],b,e),k(c[j],e,b.element)||x(c[j],e);else for(j=c.length;j--;)y(c[j],b,e);v(b,c,e)}else if(e.toggle!==!1)if(r(m))f=s(m),g=f.textNode,y(f.textNode,b,e),w(b,f.textNode,f.wordOffset,e);else{g=b.doc.createTextNode(a.INVISIBLE_SPACE),h=d.nodes[0].cloneNode(!1),h.appendChild(g),b.selection.splitElementAtCaret(d.nodes[0],h),i(h,e),v(b,[g],e);var n=b.selection.getSelection();if(n.anchorNode&&n.focusNode)try{n.collapseToEnd()}catch(o){}}else for(j=d.nodes.length;j--;)i(d.nodes[j],e)}function C(b,c,d,e){var f,g,h,i=b.selection.getSelection();if(c.length){for(h=c.length;h--;)z(c[h],b,e);v(b,c,e)}else{for(f=i.anchorNode,g=i.anchorOffset,h=d.nodes.length;h--;)a.dom.unwrap(d.nodes[h]);w(b,f,g,e)}}function D(a,b,c){var d,e,f=a.selection.getSelection();if(b.length){for(e=b.length;e--;)x(b[e],c);v(a,b,c)}else if(r(f))d=s(f),x(d.textNode,c),w(a,d.textNode,d.wordOffset,c);else{var g=a.selection.getOwnRanges()[0];g&&A(g,a,c)}}function E(a){return a="string"==typeof a?{nodeName:a}:a,a.nodeName&&(a.nodeName=a.nodeName.toUpperCase()),a}var F="SPAN",G="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",H={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};a.commands.formatInline={exec:function(a,b,c){c=E(c),a.element.normalize();var d=j(a.selection,!0),e=q(a,c);e.nodes.length>0?B(a,d,e,c):D(a,d,c),a.element.normalize()},remove:function(a,b,c){c=E(c),a.element.normalize();var d=j(a.selection,!0),e=q(a,c);e.nodes.length>0&&C(a,d,e,c),a.element.normalize()},state:function(a,b,c){c=E(c);var d=q(a,c,!0).nodes;return 0===d.length?!1:d}}}(wysihtml5),function(a){var b={nodeName:"BLOCKQUOTE",toggle:!0};a.commands.insertBlockQuote={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){a.commands.insertHTML={exec:function(a,b,c){a.selection.insertHTML(c)},state:function(){return!1}}}(wysihtml5),function(a){var b="IMG";a.commands.insertImage={exec:function(c,d,e){e="object"==typeof e?e:{src:e};var f,g,h=c.doc,i=this.state(c);if(i&&!e.src)return c.selection.setBefore(i),g=i.parentNode,g.removeChild(i),a.dom.removeEmptyTextNodes(g),"A"!==g.nodeName||g.firstChild||(c.selection.setAfter(g),g.parentNode.removeChild(g)),void a.quirks.redraw(c.element);if(i)for(var j in e)e.hasOwnProperty(j)&&i.setAttribute("className"===j?"class":j,e[j]);else{i=h.createElement(b);for(var k in e)i.setAttribute("className"===k?"class":k,e[k]);c.selection.insertNode(i),a.browser.hasProblemsSettingCaretAfterImg()?(f=h.createTextNode(a.INVISIBLE_SPACE),c.selection.insertNode(f),c.selection.setAfter(f)):c.selection.setAfter(i)}},state:function(c){var d,e,f,g=c.doc;return a.dom.hasElementWithTagName(g,b)&&(d=c.selection.getSelectedNode())?d.nodeName===b?d:d.nodeType!==a.ELEMENT_NODE?!1:(e=c.selection.getText(),(e=a.lang.string(e).trim())?!1:(f=c.selection.getNodes(a.ELEMENT_NODE,function(a){return"IMG"===a.nodeName}),1!==f.length?!1:f[0])):!1}}}(wysihtml5),function(a){var b="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(a,c){a.selection.insertHTML(b)},state:function(){return!1}}}(wysihtml5),function(a){a.commands.insertOrderedList={exec:function(b,c){a.commands.insertList.exec(b,c,"OL")},state:function(b,c){return a.commands.insertList.state(b,c,"OL")}}}(wysihtml5),function(a){a.commands.insertUnorderedList={exec:function(b,c){a.commands.insertList.exec(b,c,"UL")},state:function(b,c){return a.commands.insertList.state(b,c,"UL")}}}(wysihtml5),wysihtml5.commands.insertList=function(a){var b=function(a,b){if(a&&a.nodeName){"string"==typeof b&&(b=[b]);for(var c=b.length;c--;)if(a.nodeName===b[c])return!0}return!1},c=function(c,d,e){var f={el:null,other:!1};if(c){var g=a.dom.getParentElement(c,{query:"li"},!1,e.element),h="UL"===d?"OL":"UL";b(c,d)?f.el=c:b(c,h)?f={el:c,other:!0}:g&&(b(g.parentNode,d)?f.el=g.parentNode:b(g.parentNode,h)&&(f={el:g.parentNode,other:!0}))}return f.el&&!e.element.contains(f.el)&&(f.el=null),f},d=function(b,c,d){var e,g,h="UL"===c?"OL":"UL";d.selection.executeAndRestoreRangy(function(){if(e=f(h,d),e.length)for(var i=e.length;i--;)a.dom.renameElement(e[i],c.toLowerCase());else{g=f(["OL","UL"],d);for(var j=g.length;j--;)a.dom.resolveList(g[j],d.config.useLineBreaks);a.dom.resolveList(b,d.config.useLineBreaks)}})},e=function(b,c,d){var e="UL"===c?"OL":"UL";d.selection.executeAndRestoreRangy(function(){for(var g=[b].concat(f(e,d)),h=g.length;h--;)a.dom.renameElement(g[h],c.toLowerCase())})},f=function(a,c){for(var d=c.selection.getOwnRanges(),e=[],f=d.length;f--;)e=e.concat(d[f].getNodes([1],function(c){return b(c,a)}));return e},g=function(b,c){var d;c.selection.isCollapsed()||(d=rangy.saveSelection(c.win));var e,f,g="_wysihtml5-temp-"+(new Date).getTime(),h=c.selection.deblockAndSurround({nodeName:"div",
className:g});h.innerHTML=h.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,""),h&&(e=/^(\s|(<br>))+$/i.test(h.innerHTML),f=a.dom.convertToList(h,b.toLowerCase(),c.parent.config.classNames.uneditableContainer),d&&rangy.restoreSelection(d),e&&c.selection.selectNode(f.querySelector("li"),!0))};return{exec:function(a,b,f){var h=a.doc,i="OL"===f?"insertOrderedList":"insertUnorderedList",j=a.selection.getSelectedNode(),k=c(j,f,a);k.el?k.other?e(k.el,f,a):d(k.el,f,a):a.commands.support(i)?h.execCommand(i,!1,null):g(f,a)},state:function(a,b,d){var e=a.selection.getSelectedNode(),f=c(e,d,a);return f.el&&!f.other?f.el:!1}}}(wysihtml5),function(a){var b={nodeName:"I",toggle:!0};a.commands.italic={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyCenter={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyLeft={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyRight={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyFull={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"right",toggle:!0};a.commands.alignRightStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"left",toggle:!0};a.commands.alignLeftStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"center",toggle:!0};a.commands.alignCenterStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){var b={styleProperty:"textAlign",styleValue:"justify",toggle:!0};a.commands.alignJustifyStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(wysihtml5),function(a){a.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}}}(wysihtml5),function(a){var b={nodeName:"U",toggle:!0};a.commands.underline={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){a.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}}}(wysihtml5),function(a){a.commands.createTable={exec:function(a,b,c){var d,e,f;if(c&&c.cols&&c.rows&&parseInt(c.cols,10)>0&&parseInt(c.rows,10)>0){for(f=c.tableStyle?'<table style="'+c.tableStyle+'">':"<table>",f+="<tbody>",e=0;e<c.rows;e++){for(f+="<tr>",d=0;d<c.cols;d++)f+="<td><br></td>";f+="</tr>"}f+="</tbody></table>",a.commands.exec("insertHTML",f)}},state:function(a,b){return!1}}}(wysihtml5),function(a){a.commands.mergeTableCells={exec:function(b,c){b.tableSelection&&b.tableSelection.start&&b.tableSelection.end&&(this.state(b,c)?a.dom.table.unmergeCell(b.tableSelection.start):a.dom.table.mergeCellsBetween(b.tableSelection.start,b.tableSelection.end))},state:function(b,c){if(b.tableSelection){var d=b.tableSelection.start,e=b.tableSelection.end;if(d&&e&&d==e&&(a.dom.getAttribute(d,"colspan")&&parseInt(a.dom.getAttribute(d,"colspan"),10)>1||a.dom.getAttribute(d,"rowspan")&&parseInt(a.dom.getAttribute(d,"rowspan"),10)>1))return[d]}return!1}}}(wysihtml5),function(a){a.commands.addTableCells={exec:function(b,c,d){if(b.tableSelection&&b.tableSelection.start&&b.tableSelection.end){var e=a.dom.table.orderSelectionEnds(b.tableSelection.start,b.tableSelection.end);"before"==d||"above"==d?a.dom.table.addCells(e.start,d):("after"==d||"below"==d)&&a.dom.table.addCells(e.end,d),setTimeout(function(){b.tableSelection.select(e.start,e.end)},0)}},state:function(a,b){return!1}}}(wysihtml5),function(a){a.commands.deleteTableCells={exec:function(b,c,d){if(b.tableSelection&&b.tableSelection.start&&b.tableSelection.end){var e,f=a.dom.table.orderSelectionEnds(b.tableSelection.start,b.tableSelection.end),g=a.dom.table.indexOf(f.start),h=b.tableSelection.table;a.dom.table.removeCells(f.start,d),setTimeout(function(){e=a.dom.table.findCell(h,g),e||("row"==d&&(e=a.dom.table.findCell(h,{row:g.row-1,col:g.col})),"column"==d&&(e=a.dom.table.findCell(h,{row:g.row,col:g.col-1}))),e&&b.tableSelection.select(e,e)},0)}},state:function(a,b){return!1}}}(wysihtml5),function(a){a.commands.indentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return d?this.tryToPushLiLevel(d,a.selection):!1},state:function(a,b){return!1},tryToPushLiLevel:function(b,c){var d,e,f,g,h,i=!1;return c.executeAndRestoreRangy(function(){for(var c=b.length;c--;)g=b[c],d="OL"===g.parentNode.nodeName?"OL":"UL",e=g.ownerDocument.createElement(d),f=a.dom.domNode(g).prev({nodeTypes:[a.ELEMENT_NODE]}),h=f?f.querySelector("ul, ol"):null,f&&(h?h.appendChild(g):(e.appendChild(g),f.appendChild(e)),i=!0)}),i}}}(wysihtml5),function(a){a.commands.outdentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return d?this.tryToPullLiLevel(d,a):!1},state:function(a,b){return!1},tryToPullLiLevel:function(b,c){var d,e,f,g,h,i=!1,j=this;return c.selection.executeAndRestoreRangy(function(){for(var k=b.length;k--;)if(g=b[k],g.parentNode&&(d=g.parentNode,"OL"===d.tagName||"UL"===d.tagName)){if(i=!0,e=a.dom.getParentElement(d.parentNode,{query:"ol, ul"},!1,c.element),f=a.dom.getParentElement(d.parentNode,{query:"li"},!1,c.element),e&&f)g.nextSibling&&(h=j.getAfterList(d,g),g.appendChild(h)),e.insertBefore(g,f.nextSibling);else{g.nextSibling&&(h=j.getAfterList(d,g),g.appendChild(h));for(var l=g.childNodes.length;l--;)d.parentNode.insertBefore(g.childNodes[l],d.nextSibling);d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),g.parentNode.removeChild(g)}0===d.childNodes.length&&d.parentNode.removeChild(d)}}),i},getAfterList:function(a,b){for(var c=a.nodeName,d=document.createElement(c);b.nextSibling;)d.appendChild(b.nextSibling);return d}}}(wysihtml5),function(a){var b={nodeName:"SUB",toggle:!0};a.commands.subscript={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b={nodeName:"SUP",toggle:!0};a.commands.superscript={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(wysihtml5),function(a){var b=90,c=89,d=8,e=46,f=25,g="data-wysihtml5-selection-node",h="data-wysihtml5-selection-offset",i=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",a.dom);a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var a,f=this;this.composer.sandbox.getDocument();i.observe(this.element,"keydown",function(a){if(!a.altKey&&(a.ctrlKey||a.metaKey)){var d=a.keyCode,e=d===b&&!a.shiftKey,g=d===b&&a.shiftKey||d===c;e?(f.undo(),a.preventDefault()):g&&(f.redo(),a.preventDefault())}}),i.observe(this.element,"keydown",function(b){var c=b.keyCode;c!==a&&(a=c,(c===d||c===e)&&f.transact())}),this.editor.on("newword:composer",function(){f.transact()}).on("beforecommand:composer",function(){f.transact()})},transact:function(){var b,c,d,e,i,j=this.historyStr[this.position-1],k=this.composer.getValue(!1,!1),l=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(k!==j){var m=this.historyStr.length=this.historyDom.length=this.position;m>f&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,l&&(b=this.composer.selection.getRange(),c=b&&b.startContainer?b.startContainer:this.element,d=b&&b.startOffset?b.startOffset:0,c.nodeType===a.ELEMENT_NODE?e=c:(e=c.parentNode,i=this.getChildNodeIndex(e,c)),e.setAttribute(h,d),"undefined"!=typeof i&&e.setAttribute(g,i));var n=this.element.cloneNode(!!k);this.historyDom.push(n),this.historyStr.push(k),e&&(e.removeAttribute(h),e.removeAttribute(g))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";for(var b=0,c=a.childNodes,d=a.childNodes.length;d>b;b++)this.element.appendChild(c[b].cloneNode(!0));var e,f,i;a.hasAttribute(h)?(e=a.getAttribute(h),i=a.getAttribute(g),f=this.element):(f=this.element.querySelector("["+h+"]")||this.element,e=f.getAttribute(h),i=f.getAttribute(g),f.removeAttribute(h),f.removeAttribute(g)),null!==i&&(f=this.getChildNodeByIndex(f,+i)),this.composer.selection.set(f,e)},getChildNodeIndex:function(a,b){for(var c=0,d=a.childNodes,e=d.length;e>c;c++)if(d[c]===b)return c},getChildNodeByIndex:function(a,b){return a.childNodes[b]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(a,b,c){this.parent=a,this.element=b,this.config=c,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(a){var b=a.dom,c=a.browser;a.views.Composer=a.views.View.extend({name:"composer",constructor:function(a,b,c){this.base(a,b,c),this.config.noTextarea?this.editableArea=b:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=c.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(b,c){var d=this.isEmpty()?"":a.quirks.getCorrectInnerHTML(this.element);return b!==!1&&(d=this.parent.parse(d,c===!1?!1:!0)),d},setValue:function(a,b){b!==!1&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(c){this.element.innerText=a}},cleanUp:function(a){var b;this.selection&&this.selection.isInThisEditable()&&(b=rangy.saveSelection(this.win)),this.parent.parse(this.element,void 0,a),b&&rangy.restoreSelection(b)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=b.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(b){a.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var c=this.element.lastChild;b&&c&&this.selection&&("BR"===c.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var a={};return"undefined"!=typeof this.win.pageYOffset?a.y=this.win.pageYOffset:a.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,"undefined"!=typeof this.win.pageXOffset?a.x=this.win.pageXOffset:a.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,a}},setScrollPos:function(a){a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y&&this.win.scrollTo(a.x,a.y)},getTextContent:function(){return b.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(a)||""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===a||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;this.config.noTextarea?this.sandbox=new b.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new b.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),b.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var a=this;this.sandbox=new b.Sandbox(function(){a._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var c=this.textarea.element;b.insert(this.editableArea).after(c),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden",a.name="_wysihtml5_mode",a.value=1,b.insert(a).after(this.textarea.element)}},_create:function(){var d=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new a.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new a.Commands(this.parent),this.config.noTextarea||b.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),this._initAutoLinking(),b.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var e=this.config.name;e&&(b.addClass(this.element,e),this.config.contentEditableMode||b.addClass(this.editableArea,e)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var f="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");f&&b.simulatePlaceholder(this.parent,this,f,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||c.isIos()||setTimeout(function(){d.focus(!0)},100),c.clearsContentEditableCorrectly()||a.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var d=this,e=c.canDisableAutoLinking(),f=c.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink){(!f||f&&e)&&(this.parent.on("newword:composer",function(){if(b.getTextContent(d.element).match(b.autoLink.URL_REG_EXP)){for(var c=d.selection.getSelectedNode(),e=d.element.querySelectorAll("."+d.config.classNames.uneditableContainer),f=!1,g=e.length;g--;)a.dom.contains(e[g],c)&&(f=!0);f||b.autoLink(c,[d.config.classNames.uneditableContainer])}}),b.observe(this.element,"blur",function(){b.autoLink(d.element,[d.config.classNames.uneditableContainer])}));var g=this.sandbox.getDocument().getElementsByTagName("a"),h=b.autoLink.URL_REG_EXP,i=function(c){var d=a.lang.string(b.getTextContent(c)).trim();return"www."===d.substr(0,4)&&(d="http://"+d),d};b.observe(this.element,"keydown",function(a){if(g.length){var c,e=d.selection.getSelectedNode(a.target.ownerDocument),f=b.getParentElement(e,{query:"a"},4);f&&(c=i(f),setTimeout(function(){var a=i(f);a!==c&&a.match(h)&&f.setAttribute("href",a)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),c.supportsEvent("resizeend")){var d=["width","height"],e=d.length,f=this.element;b.observe(f,"resizeend",function(b){var c,g=b.target||b.srcElement,h=g.style,i=0;if("IMG"===g.nodeName){for(;e>i;i++)c=d[i],h[c]&&(g.setAttribute(c,parseInt(h[c],10)),h[c]="");a.quirks.redraw(f)}})}},_initUndoManager:function(){this.undoManager=new a.UndoManager(this.parent)},_initLineBreaking:function(){function d(a){var c=b.getParentElement(a,{query:"p, div"},2);c&&b.contains(e.element,c)&&e.selection.executeAndRestore(function(){e.config.useLineBreaks?b.replaceWithChildNodes(c):"P"!==c.nodeName&&b.renameElement(c,"p")})}var e=this,f="li, p, h1, h2, h3, h4, h5, h6",g="ul, ol, menu";this.config.useLineBreaks||b.observe(this.element,["focus","keydown"],function(){if(e.isEmpty()){var a=e.doc.createElement("P");e.element.innerHTML="",e.element.appendChild(a),c.displaysCaretInEmptyContentEditableCorrectly()?e.selection.selectNode(a,!0):(a.innerHTML="<br>",e.selection.setBefore(a.firstChild))}}),b.observe(this.element,"keydown",function(c){var h=c.keyCode;if(!c.shiftKey&&(h===a.ENTER_KEY||h===a.BACKSPACE_KEY)){var i=b.getParentElement(e.selection.getSelectedNode(),{query:f},4);return i?void setTimeout(function(){var c,f=e.selection.getSelectedNode();if("LI"===i.nodeName){if(!f)return;c=b.getParentElement(f,{query:g},2),c||d(f)}h===a.ENTER_KEY&&i.nodeName.match(/^H[1-6]$/)&&d(f)},0):void(e.config.useLineBreaks&&h===a.ENTER_KEY&&!a.browser.insertsLineBreaksOnReturn()&&(c.preventDefault(),e.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(a){var b=a.dom,c=document,d=window,e=c.createElement("div"),f=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],g=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],i=function(a){if(a.setActive)try{a.setActive()}catch(e){}else{var f=a.style,g=c.documentElement.scrollTop||c.body.scrollTop,h=c.documentElement.scrollLeft||c.body.scrollLeft,i={position:f.position,top:f.top,left:f.left,WebkitUserSelect:f.WebkitUserSelect};b.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a),a.focus(),b.setStyles(i).on(a),d.scrollTo&&d.scrollTo(h,g)}};a.views.Composer.prototype.style=function(){var d,j=this,k=c.querySelector(":focus"),l=this.textarea.element,m=l.hasAttribute("placeholder"),n=m&&l.getAttribute("placeholder"),o=l.style.display,p=l.disabled;this.focusStylesHost=e.cloneNode(!1),this.blurStylesHost=e.cloneNode(!1),this.disabledStylesHost=e.cloneNode(!1),m&&l.removeAttribute("placeholder"),l===k&&l.blur(),l.disabled=!1,l.style.display=d="none",(l.getAttribute("rows")&&"auto"===b.getStyle("height").from(l)||l.getAttribute("cols")&&"auto"===b.getStyle("width").from(l))&&(l.style.display=d=o),b.copyStyles(g).from(l).to(this.editableArea).andTo(this.blurStylesHost),b.copyStyles(f).from(l).to(this.element).andTo(this.blurStylesHost),b.insertCSS(h).into(this.element.ownerDocument),l.disabled=!0,b.copyStyles(g).from(l).to(this.disabledStylesHost),b.copyStyles(f).from(l).to(this.disabledStylesHost),l.disabled=p,l.style.display=o,i(l),l.style.display=d,b.copyStyles(g).from(l).to(this.focusStylesHost),b.copyStyles(f).from(l).to(this.focusStylesHost),l.style.display=o,b.copyStyles(["display"]).from(l).to(this.editableArea);var q=a.lang.array(g).without(["display"]);return k?k.focus():l.blur(),m&&l.setAttribute("placeholder",n),this.parent.on("focus:composer",function(){b.copyStyles(q).from(j.focusStylesHost).to(j.editableArea),b.copyStyles(f).from(j.focusStylesHost).to(j.element)}),this.parent.on("blur:composer",function(){b.copyStyles(q).from(j.blurStylesHost).to(j.editableArea),b.copyStyles(f).from(j.blurStylesHost).to(j.element)}),this.parent.observe("disable:composer",function(){b.copyStyles(q).from(j.disabledStylesHost).to(j.editableArea),b.copyStyles(f).from(j.disabledStylesHost).to(j.element)}),this.parent.observe("enable:composer",function(){b.copyStyles(q).from(j.blurStylesHost).to(j.editableArea),b.copyStyles(f).from(j.blurStylesHost).to(j.element)}),this}}(wysihtml5),function(a){var b=a.dom,c=a.browser,d={66:"bold",73:"italic",85:"underline"},e=function(a,b,c){for(var d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c,!1)},f=function(a,b,c){for(var d=0,e=b.length;e>d;d++)a.removeEventListener(b[d],c,!1)},g=function(b,c){if(b.selection.caretIsLastInSelection()){var d=b.selection.getSelection(),e=d.anchorNode;if(e&&1===e.nodeType&&(a.dom.getParentElement(e,{query:"td, th"},!1,b.element)||c)){var f=e.childNodes[d.anchorOffset];if(f&&1===f.nodeType&"BR"===f.nodeName)return f.parentNode.removeChild(f),!0}}return!1},h=function(a){var b=a.selection.getBeforeSelection(!0);if(b&&("element"===b.type||"leafnode"===b.type)&&1===b.node.nodeType&&b.node.classList.contains(a.config.classNames.uneditableContainer)){if(g(a,!0))return!0;try{var c=new CustomEvent("wysihtml5:uneditable:delete");b.node.dispatchEvent(c)}catch(d){}return b.node.parentNode.removeChild(b.node),!0}return!1},i=function(b){var c=b.selection,d=c.getPreviousNode();if(c.caretIsFirstInSelection()&&d&&1===d.nodeType&&/block/.test(b.win.getComputedStyle(d).display)){if(/^\s*$/.test(d.textContent||d.innerText))return d.parentNode.removeChild(d),!0;if(d.lastChild){var e=d.lastChild,f=c.getSelectedNode(),g=a.dom.domNode(d).commonAncestor(f,b.element);if(curNode=g?a.dom.getParentElement(f,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,g):null,curNode){for(;curNode.firstChild;)d.appendChild(curNode.firstChild);return c.setAfter(e),!0}if(3===f.nodeType)return d.appendChild(f),c.setAfter(e),!0}}return!1},j=function(a,b){var c=b.selection;b.element;if(c.isCollapsed()){if(i(b))return void a.preventDefault();if(g(b))return void a.preventDefault();if(h(b))return void a.preventDefault()}else c.containsUneditable()&&(a.preventDefault(),c.deleteContents())},k=function(a,b,c){if(a.selection.isCollapsed()){if(a.selection.caretIsInTheBeginnig("li"))if(c){if(a.commands.exec("outdentList"))return}else if(a.commands.exec("indentList"))return}else a.selection.deleteContents();a.commands.exec("insertHTML","&emsp;")},l=function(a){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},m=function(a){this.parent.fire("beforeinteraction",a).fire("beforeinteraction:composer",a),setTimeout(function(){this.parent.fire("interaction",a).fire("interaction:composer",a)}.bind(this),0)},n=function(a){this.parent.fire("focus",a).fire("focus:composer",a),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},o=function(a){if(this.focusState!==this.getValue(!1,!1)){var b=a;"function"==typeof Object.create&&(b=Object.create(a,{type:{value:"change"}})),this.parent.fire("change",b).fire("change:composer",b)}this.parent.fire("blur",a).fire("blur:composer",a)},p=function(a){this.parent.fire(a.type,a).fire(a.type+":composer",a),"paste"===a.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},q=function(b){this.config.copyedFromMarking&&(a.browser.supportsModernPaste()&&(b.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),b.clipboardData.setData("text/plain",this.selection.getPlainText()),b.preventDefault()),this.parent.fire(b.type,b).fire(b.type+":composer",b))},r=function(b){var c=b.keyCode;(c===a.SPACE_KEY||c===a.ENTER_KEY)&&this.parent.fire("newword:composer")},s=function(b){if(!c.canSelectImagesInContentEditable()){var d=b.target,e=this.element.querySelectorAll("img"),f=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),g=a.lang.array(e).without(f);"IMG"===d.nodeName&&a.lang.array(g).contains(d)&&this.selection.selectNode(d)}},t=function(a){var b,c={IMG:"Image: ",A:"Link: "},d=a.target,e=d.nodeName;("A"===e||"IMG"===e)&&(d.hasAttribute("title")||(b=c[e]+(d.getAttribute("href")||d.getAttribute("src")),d.setAttribute("title",b)))},u=function(b){if(this.config.classNames.uneditableContainer){var c=a.dom.getParentElement(b.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);c&&this.selection.setAfter(c)}},v=function(a){c.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},w=function(b){var c,e,f=b.keyCode,g=d[f];return!b.ctrlKey&&!b.metaKey||b.altKey||65!==f?((b.ctrlKey||b.metaKey)&&!b.altKey&&g&&(this.commands.exec(g),b.preventDefault()),f===a.BACKSPACE_KEY&&j(b,this),(f===a.BACKSPACE_KEY||f===a.DELETE_KEY)&&(c=this.selection.getSelectedNode(!0),c&&"IMG"===c.nodeName&&(b.preventDefault(),e=c.parentNode,e.removeChild(c),"A"!==e.nodeName||e.firstChild||e.parentNode.removeChild(e),setTimeout(function(){a.quirks.redraw(this.element)}.bind(this),0))),void(this.config.handleTabKey&&f===a.TAB_KEY&&(b.preventDefault(),k(this,this.element,b.shiftKey)))):(this.selection.selectAll(),void b.preventDefault())},x=function(){var b=function(){window.removeEventListener("load",b),this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),c=function(){b.call(this),f(this.sandbox.getIframe(),["focus","mouseup","mouseover"],c)}.bind(this);this.doc.execCommand&&a.browser.supportsCommand(this.doc,"enableObjectResizing")&&a.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?e(this.sandbox.getIframe(),["focus","mouseup","mouseover"],c):window.addEventListener("load",b)),this.tableSelection=a.quirks.tableCellsSelection(this.element,this.parent)};a.views.Composer.prototype.observe=function(){var a=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),d=(this.element,c.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),a.addEventListener(["DOMNodeRemoved"],l.bind(this),!1),c.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){b.contains(document.documentElement,a)||l.call(this)},250)),this.config.handleTables&&x.call(this),e(d,["drop","paste","mouseup","focus","keyup"],m.bind(this)),d.addEventListener("focus",n.bind(this),!1),d.addEventListener("blur",o.bind(this),!1),e(this.element,["drop","paste","beforepaste"],p.bind(this),!1),this.element.addEventListener("copy",q.bind(this),!1),this.element.addEventListener("mousedown",s.bind(this),!1),this.element.addEventListener("mouseover",t.bind(this),!1),this.element.addEventListener("click",u.bind(this),!1),this.element.addEventListener("drop",v.bind(this),!1),this.element.addEventListener("keyup",r.bind(this),!1),this.element.addEventListener("keydown",w.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(wysihtml5),function(a){var b=400;a.views.Synchronizer=Base.extend({constructor:function(a,b,c){this.editor=a,this.textarea=b,this.composer=c,this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),b)},fromTextareaToComposer:function(a){var b=this.textarea.getValue(!1,!1);b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a):this.fromComposerToTextarea(a)},_observe:function(){var c,d=this,e=this.textarea.element.form,f=function(){c=setInterval(function(){d.fromComposerToTextarea()},b)},g=function(){clearInterval(c),c=null};f(),e&&(a.dom.observe(e,"submit",function(){d.sync(!0)}),a.dom.observe(e,"reset",function(){setTimeout(function(){d.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(a){"composer"!==a||c?"textarea"===a&&(d.fromComposerToTextarea(!0),g()):(d.fromTextareaToComposer(!0),f())}),this.editor.on("destroy:composer",g)}})}(wysihtml5),function(a){a.views.SourceView=Base.extend({constructor:function(a,b){this.editor=a,this.composer=b,this._observe()},switchToTextarea:function(a){var b=this.composer.win.getComputedStyle(this.composer.element),c=parseFloat(b.width),d=Math.max(parseFloat(b.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml5-source-view"),this.textarea.style.width=c+"px",this.textarea.style.height=d+"px",this.textarea.value=this.editor.getValue(a,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(a){var b=this.textarea.value;b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(a){"composer"===a?this.switchToComposer(!0):"textarea"===a&&this.switchToTextarea(!0)}.bind(this))}})}(wysihtml5),
wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(a,b,c){this.base(a,b,c),this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;return a!==!1&&(b=this.parent.parse(b)),b},setValue:function(a,b){b!==!1&&(a=this.parent.parse(a)),this.element.value=a},cleanUp:function(a){var b=this.parent.parse(this.element.value,void 0,a);this.element.value=b},hasPlaceholderSet:function(){var a=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),b=this.element.getAttribute("placeholder")||null,c=this.element.value,d=!c;return a&&d||c===b},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,b=this.parent,c={focusin:"focus",focusout:"blur"},d=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];b.on("beforeload",function(){wysihtml5.dom.observe(a,d,function(a){var d=c[a.type]||a.type;b.fire(d).fire(d+":textarea")}),wysihtml5.dom.observe(a,["paste","drop"],function(){setTimeout(function(){b.fire("paste").fire("paste:textarea")},0)})})}}),function(a){var b,c={name:b,style:!0,toolbar:b,showToolbarAfterInit:!0,showToolbarDialogsOnSelection:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:a.dom.parse,useLineBreaks:!0,stylesheets:[],placeholderText:b,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml5-editor",body:"wysihtml5-supported",sandbox:"wysihtml5-sandbox",placeholder:"wysihtml5-placeholder",uneditableContainer:"wysihtml5-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,d){if(this.editableElement="string"==typeof b?document.getElementById(b):b,this.config=a.lang.object({}).merge(c).merge(d).get(),this._isCompatible=a.browser.supported(),d&&d.classNames&&a.lang.object(this.config.classNames).merge(d.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new a.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var e=this;return void setTimeout(function(){e.fire("beforeload").fire("load")},0)}a.dom.addClass(document.body,this.config.classNames.body),this.composer=new a.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new a.views.SourceView(this,this.composer):this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(a,b){return this.currentView.getValue(a,b)},setValue:function(a,b){return this.fire("unset_placeholder"),a?(this.currentView.setValue(a,b),this):this.clear()},cleanUp:function(a){this.currentView.cleanUp(a)},focus:function(a){return this.currentView.focus(a),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.toolbar&&this.toolbar.destroy(),this.off()},parse:function(b,c,d){var e=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,f=this.config.parser(b,{rules:d||this.config.parserRules,cleanUp:this.config.cleanUp,context:e,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:c});return"object"==typeof b&&a.quirks.redraw(b),f},_initParser:function(){var b;a.browser.supportsModernPaste()?this.on("paste:composer",function(c){c.preventDefault(),b=a.dom.getPastedHtml(c),b&&this._cleanAndPaste(b)}.bind(this)):this.on("beforepaste:composer",function(b){b.preventDefault();var c=this.composer.getScrollPos();a.dom.getPastedHtmlWithDiv(this.composer,function(a){a&&this._cleanAndPaste(a),this.composer.setScrollPos(c)}.bind(this))}.bind(this))},_cleanAndPaste:function(b){var c=a.quirks.cleanPastedHTML(b,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(c)}})}(wysihtml5);

;
;
/*! fontdetect.js */ 
;
;
/**
* FontDetect - A simple library to detect if an internal font is present or an external font got loaded.
*
* TO USE:
*     Include this file. If desired, you can load this file after the BODY.
*
*     After you load the fonts you want to test, call either of these methods:
*
*         // Checks that the font is loaded now.
*         isLoaded = FontDetect.isFontLoaded(fontname);
*
*         // Polls for the font getting loaded and calls a callback when it does.
*         FontDetect.onFontLoaded(fontname, callback [, {onFail: xxx, msInterval: yyy, msTimeout: zzz}]);
*
*     Note: For externally loaded fonts, you may have to wait for more than a second to get a reliable
*     answer. Internal browser fonts can be detected immediately.
*
*         // Determines which font in the font stack is being used for a given element.
*         fontname = FontDetect.whichFont(element); // DOM element, or can be a $(expression) if jQuery is loaded
*
* @author     Jennifer Simonds
* @copyright  2014 Jennifer Simonds
* @license    MIT License http://opensource.org/licenses/MIT
*/
FontDetect = function()
{
var _isInitialized = false;
var _aFallbackFonts = ['serif', 'sans-serif', 'monospace', 'cursive', 'fantasy'];
var span = null;
function _init ()
{
if (_isInitialized)
{	return;
}
_isInitialized = true;
var body = document.body;
var firstChild = document.body.firstChild;
var div = document.createElement('div');
div.id = 'fontdetectHelper';
span = document.createElement('span');
span.innerText = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
div.appendChild(span);
body.insertBefore(div,firstChild);
div.style.position   = 'absolute';
div.style.visibility = 'hidden';
div.style.top        = '-200px';
div.style.left       = '-100000px';
div.style.width      = '100000px';
div.style.height     = '200px';
div.style.fontSize   = '100px';
}
function _getCss (p_element, p_cssStyle)
{
if (p_element instanceof Element)
{   return window.getComputedStyle(p_element).getPropertyValue(p_cssStyle);
}
else if (window.jQuery)
{   return $(p_element).css(p_cssStyle);
}
else // p_element might be a jQuery expression & caller was expecting jQuery to be loaded,
{   return '';
}
}
return {
/**
* Polls 10 times/second until a font gets loaded or until it times out. (Default = 2 secs) It
* calls a callback on load, & optionally calls another function if it times out without loading.
*
* NOTE: You must specify at least one callback - for success or failure.
*
* @param string		The font name to check for.
* @param function		The function to call if it gets loaded within the timeout period.
* @param options		An optional object with named parameters:
*     @param onFail       The function to call if the font doesn't load within the timeout period.
*     @param msInterval   How many milliseconds for the polling interval. Default = 100.
*     @param msTimeout    How many milliseconds until we time out & call onFail. Default = 2000.
*/
onFontLoaded: function (p_cssFontName, p_onLoad, p_onFail, p_options)
{
if (!p_cssFontName)
{	return;
}
var msInterval = (p_options && p_options.msInterval) ? p_options.msInterval : 100;
var msTimeout  = (p_options && p_options.msTimeout) ? p_options.msTimeout : 2000;
if (!p_onLoad && !p_onFail)
{	// Caller must specify at least one callback.
return;
}
if (!_isInitialized)
{	_init ();
}
if (this.isFontLoaded(p_cssFontName))
{	// It's already here, so no need to poll.
if (p_onLoad)
{	p_onLoad(p_cssFontName);
}
return;
}
var outerThis = this;
var utStart = new Date().getTime();
var idInterval = setInterval (
function()
{
if (outerThis.isFontLoaded(p_cssFontName))
{	// It's now loaded.
clearInterval (idInterval);
p_onLoad(p_cssFontName);
return;
}
else
{	// Still not loaded.
var utNow = new Date().getTime();
if ((utNow - utStart) > msTimeout)
{
clearInterval (idInterval);
if (p_onFail)
{	p_onFail(p_cssFontName);
}
}
}
},
msInterval
);
},
/**
* Determines if a font has gotten loaded.
*
* @param string		The font name to check for.
*
* @returns bool		true if it's loaded, else false if the browser had to use a fallback font.
*/
isFontLoaded: function (p_cssFontName)
{
var wThisFont = 0;
var wPrevFont = 0;
if (!_isInitialized)
{	_init ();
}
for(var ix = 0; ix < _aFallbackFonts.length; ++ix)
{
span.style.fontFamily = '"' + p_cssFontName + '",' + _aFallbackFonts[ix];
wThisFont = span.offsetWidth;
if (ix > 0 && wThisFont != wPrevFont)
{// This iteration's font was different than the previous iteration's font, so it must
return false;
}
wPrevFont = wThisFont;
}
return true;
},
/**
* Determines which font is being used for a given element.
*
* @param string/object		The element to examine. If it's a string, it's a jQuery selector. If it's
*							an object, it's taken as a DOM element.
*
* @returns string			The name of the font that's being used - either one of the fonts
*							listed in the element's font-family css value, or null.
*/
whichFont: function (p_element)
{
var sStack = _getCss(p_element, 'font-family');
var aStack = sStack.split(',');
var sFont = aStack.shift();
while (sFont)
{
sFont = sFont.replace(/^\s*['"]?\s*([^'"]*)\s*['"]?\s*$/, '$1');
for (var ix=0; ix < _aFallbackFonts.length; ix++)
{
if (sFont == _aFallbackFonts[ix])
{return sFont;
}
}
if (this.isFontLoaded(sFont))
{	return sFont;
}
sFont = aStack.shift();
}
return null;
}
};
}();
;
;
/*! color-thief.min.js */ 
;
;
/*!
* Color Thief v2.0
* by Lokesh Dhakar - http://www.lokeshdhakar.com
*
* License
* -------
* Creative Commons Attribution 2.5 License:
* http://creativecommons.org/licenses/by/2.5/
*
* Thanks
* ------
* Nick Rabinowitz - For creating quantize.js.
* John Schulz - For clean up and optimization. @JFSIII
* Nathan Spady - For adding drag and drop support to the demo page.
*
*/
/*
CanvasImage Class
Class that wraps the html image element and canvas.
It also simplifies some of the canvas context manipulation
with a set of helper functions.
*/
var CanvasImage = function (image, whiteBackground) {
whiteBackground = !! whiteBackground;
this.canvas  = document.createElement('canvas');
this.context = this.canvas.getContext('2d');
document.body.appendChild(this.canvas);
this.width  = this.canvas.width  = image.width;
this.height = this.canvas.height = image.height;
if( !! whiteBackground ) {
this.context.fillStyle = "white";
this.context.fillRect(0, 0, this.width, this.height);
}
this.context.drawImage(image, 0, 0, this.width, this.height);
};
CanvasImage.prototype.clear = function () {
this.context.clearRect(0, 0, this.width, this.height);
};
CanvasImage.prototype.update = function (imageData) {
this.context.putImageData(imageData, 0, 0);
};
CanvasImage.prototype.getPixelCount = function () {
return this.width * this.height;
};
CanvasImage.prototype.getImageData = function () {
return this.context.getImageData(0, 0, this.width, this.height);
};
CanvasImage.prototype.removeCanvas = function () {
this.canvas.parentNode.removeChild(this.canvas);
};
var ColorThief = function () {};
/*
* getColor(sourceImage[, quality])
* returns {r: num, g: num, b: num}
*
* Use the median cut algorithm provided by quantize.js to cluster similar
* colors and return the base color from the largest cluster.
*
* Quality is an optional argument. It needs to be an integer. 1 is the highest quality settings.
* 10 is the default. There is a trade-off between quality and speed. The bigger the number, the
* faster a color will be returned but the greater the likelihood that it will not be the visually
* most dominant color.
*
* */
ColorThief.prototype.getColor = function(sourceImage, quality) {
var palette       = this.getPalette(sourceImage, 5, quality);
var dominantColor = palette[0];
return dominantColor;
};
/*
* getPalette(sourceImage[, colorCount, quality])
* returns array[ {r: num, g: num, b: num}, {r: num, g: num, b: num}, ...]
*
* Use the median cut algorithm provided by quantize.js to cluster similar colors.
*
* colorCount determines the size of the palette; the number of colors returned. If not set, it
* defaults to 10.
*
* BUGGY: Function does not always return the requested amount of colors. It can be +/- 2.
*
* quality is an optional argument. It needs to be an integer. 1 is the highest quality settings.
* 10 is the default. There is a trade-off between quality and speed. The bigger the number, the
* faster the palette generation but the greater the likelihood that colors will be missed.
*
*
*/
ColorThief.prototype.getPalette = function(sourceImage, colorCount, quality) {
if (typeof colorCount === 'undefined') {
colorCount = 10;
}
if (typeof quality === 'undefined' || quality < 1) {
quality = 10;
}
var image      = new CanvasImage(sourceImage);
var imageData  = image.getImageData();
var pixels     = imageData.data;
var pixelCount = image.getPixelCount();
var pixelArray = [];
for (var i = 0, offset, r, g, b, a; i < pixelCount; i = i + quality) {
offset = i * 4;
r = pixels[offset + 0];
g = pixels[offset + 1];
b = pixels[offset + 2];
a = pixels[offset + 3];
if (a >= 125) {
if (!(r > 250 && g > 250 && b > 250)) {
pixelArray.push([r, g, b]);
}
}
}
if( pixelArray.length === 0 ) {
image.removeCanvas();
image      = new CanvasImage(sourceImage, true);
imageData  = image.getImageData();
pixels     = imageData.data;
pixelCount = image.getPixelCount();
for (i = 0, offset, r, g, b, a; i < pixelCount; i = i + quality) {
offset = i * 4;
r = pixels[offset + 0];
g = pixels[offset + 1];
b = pixels[offset + 2];
a = pixels[offset + 3];
if (a >= 125) {
pixelArray.push([r, g, b]);
}
}
}
if( ! pixelArray || pixelArray.length === 0 ) {
image.removeCanvas();
return [];
}
var cmap    = MMCQ.quantize(pixelArray, colorCount);
var palette = cmap? cmap.palette() : null;
image.removeCanvas();
return palette;
};
/*!
* quantize.js Copyright 2008 Nick Rabinowitz.
* Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
*/
/*!
* Block below copied from Protovis: http://mbostock.github.com/protovis/
* Copyright 2010 Stanford Visualization Group
* Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
*/
if (!pv) {
var pv = {
map: function(array, f) {
var o = {};
return f ? array.map(function(d, i) { o.index = i; return f.call(o, d); }) : array.slice();
},
naturalOrder: function(a, b) {
return (a < b) ? -1 : ((a > b) ? 1 : 0);
},
sum: function(array, f) {
var o = {};
return array.reduce(f ? function(p, d, i) { o.index = i; return p + f.call(o, d); } : function(p, d) { return p + d; }, 0);
},
max: function(array, f) {
return Math.max.apply(null, f ? pv.map(array, f) : array);
}
};
}
/**
* Basic Javascript port of the MMCQ (modified median cut quantization)
* algorithm from the Leptonica library (http://www.leptonica.com/).
* Returns a color map you can use to map original pixels to the reduced
* palette. Still a work in progress.
*
* @author Nick Rabinowitz
* @example
var myPixels = [[190,197,190], [202,204,200], [207,214,210], [211,214,211], [205,207,207]
];
var maxColors = 4;
var cmap = MMCQ.quantize(myPixels, maxColors);
var newPalette = cmap.palette();
var newPixels = myPixels.map(function(p) {
return cmap.map(p);
});
*/
var MMCQ = (function() {
var sigbits = 5,
rshift = 8 - sigbits,
maxIterations = 1000,
fractByPopulations = 0.75;
function getColorIndex(r, g, b) {
return (r << (2 * sigbits)) + (g << sigbits) + b;
}
function PQueue(comparator) {
var contents = [],
sorted = false;
function sort() {
contents.sort(comparator);
sorted = true;
}
return {
push: function(o) {
contents.push(o);
sorted = false;
},
peek: function(index) {
if (!sorted) sort();
if (index===undefined) index = contents.length - 1;
return contents[index];
},
pop: function() {
if (!sorted) sort();
return contents.pop();
},
size: function() {
return contents.length;
},
map: function(f) {
return contents.map(f);
},
debug: function() {
if (!sorted) sort();
return contents;
}
};
}
function VBox(r1, r2, g1, g2, b1, b2, histo) {
var vbox = this;
vbox.r1 = r1;
vbox.r2 = r2;
vbox.g1 = g1;
vbox.g2 = g2;
vbox.b1 = b1;
vbox.b2 = b2;
vbox.histo = histo;
}
VBox.prototype = {
volume: function(force) {
var vbox = this;
if (!vbox._volume || force) {
vbox._volume = ((vbox.r2 - vbox.r1 + 1) * (vbox.g2 - vbox.g1 + 1) * (vbox.b2 - vbox.b1 + 1));
}
return vbox._volume;
},
count: function(force) {
var vbox = this,
histo = vbox.histo;
if (!vbox._count_set || force) {
var npix = 0,
i, j, k;
for (i = vbox.r1; i <= vbox.r2; i++) {
for (j = vbox.g1; j <= vbox.g2; j++) {
for (k = vbox.b1; k <= vbox.b2; k++) {
index = getColorIndex(i,j,k);
npix += (histo[index] || 0);
}
}
}
vbox._count = npix;
vbox._count_set = true;
}
return vbox._count;
},
copy: function() {
var vbox = this;
return new VBox(vbox.r1, vbox.r2, vbox.g1, vbox.g2, vbox.b1, vbox.b2, vbox.histo);
},
avg: function(force) {
var vbox = this,
histo = vbox.histo;
if (!vbox._avg || force) {
var ntot = 0,
mult = 1 << (8 - sigbits),
rsum = 0,
gsum = 0,
bsum = 0,
hval,
i, j, k, histoindex;
for (i = vbox.r1; i <= vbox.r2; i++) {
for (j = vbox.g1; j <= vbox.g2; j++) {
for (k = vbox.b1; k <= vbox.b2; k++) {
histoindex = getColorIndex(i,j,k);
hval = histo[histoindex] || 0;
ntot += hval;
rsum += (hval * (i + 0.5) * mult);
gsum += (hval * (j + 0.5) * mult);
bsum += (hval * (k + 0.5) * mult);
}
}
}
if (ntot) {
vbox._avg = [~~(rsum/ntot), ~~(gsum/ntot), ~~(bsum/ntot)];
} else {
vbox._avg = [
~~(mult * (vbox.r1 + vbox.r2 + 1) / 2),
~~(mult * (vbox.g1 + vbox.g2 + 1) / 2),
~~(mult * (vbox.b1 + vbox.b2 + 1) / 2)
];
}
}
return vbox._avg;
},
contains: function(pixel) {
var vbox = this,
rval = pixel[0] >> rshift;
gval = pixel[1] >> rshift;
bval = pixel[2] >> rshift;
return (rval >= vbox.r1 && rval <= vbox.r2 &&
gval >= vbox.g1 && gval <= vbox.g2 &&
bval >= vbox.b1 && bval <= vbox.b2);
}
};
function CMap() {
this.vboxes = new PQueue(function(a,b) {
return pv.naturalOrder(
a.vbox.count()*a.vbox.volume(),
b.vbox.count()*b.vbox.volume()
);
});
}
CMap.prototype = {
push: function(vbox) {
this.vboxes.push({
vbox: vbox,
color: vbox.avg()
});
},
palette: function() {
return this.vboxes.map(function(vb) { return vb.color; });
},
size: function() {
return this.vboxes.size();
},
map: function(color) {
var vboxes = this.vboxes;
for (var i=0; i<vboxes.size(); i++) {
if (vboxes.peek(i).vbox.contains(color)) {
return vboxes.peek(i).color;
}
}
return this.nearest(color);
},
nearest: function(color) {
var vboxes = this.vboxes,
d1, d2, pColor;
for (var i=0; i<vboxes.size(); i++) {
d2 = Math.sqrt(
Math.pow(color[0] - vboxes.peek(i).color[0], 2) +
Math.pow(color[1] - vboxes.peek(i).color[1], 2) +
Math.pow(color[2] - vboxes.peek(i).color[2], 2)
);
if (d2 < d1 || d1 === undefined) {
d1 = d2;
pColor = vboxes.peek(i).color;
}
}
return pColor;
},
forcebw: function() {
var vboxes = this.vboxes;
vboxes.sort(function(a,b) { return pv.naturalOrder(pv.sum(a.color), pv.sum(b.color));});
var lowest = vboxes[0].color;
if (lowest[0] < 5 && lowest[1] < 5 && lowest[2] < 5)
vboxes[0].color = [0,0,0];
var idx = vboxes.length-1,
highest = vboxes[idx].color;
if (highest[0] > 251 && highest[1] > 251 && highest[2] > 251)
vboxes[idx].color = [255,255,255];
}
};
function getHisto(pixels) {
var histosize = 1 << (3 * sigbits),
histo = new Array(histosize),
index, rval, gval, bval;
pixels.forEach(function(pixel) {
rval = pixel[0] >> rshift;
gval = pixel[1] >> rshift;
bval = pixel[2] >> rshift;
index = getColorIndex(rval, gval, bval);
histo[index] = (histo[index] || 0) + 1;
});
return histo;
}
function vboxFromPixels(pixels, histo) {
var rmin=1000000, rmax=0,
gmin=1000000, gmax=0,
bmin=1000000, bmax=0,
rval, gval, bval;
pixels.forEach(function(pixel) {
rval = pixel[0] >> rshift;
gval = pixel[1] >> rshift;
bval = pixel[2] >> rshift;
if (rval < rmin) rmin = rval;
else if (rval > rmax) rmax = rval;
if (gval < gmin) gmin = gval;
else if (gval > gmax) gmax = gval;
if (bval < bmin) bmin = bval;
else if (bval > bmax)  bmax = bval;
});
return new VBox(rmin, rmax, gmin, gmax, bmin, bmax, histo);
}
function medianCutApply(histo, vbox) {
if (!vbox.count()) return;
var rw = vbox.r2 - vbox.r1 + 1,
gw = vbox.g2 - vbox.g1 + 1,
bw = vbox.b2 - vbox.b1 + 1,
maxw = pv.max([rw, gw, bw]);
if (vbox.count() == 1) {
return [vbox.copy()];
}
/* Find the partial sum arrays along the selected axis. */
var total = 0,
partialsum = [],
lookaheadsum = [],
i, j, k, sum, index;
if (maxw == rw) {
for (i = vbox.r1; i <= vbox.r2; i++) {
sum = 0;
for (j = vbox.g1; j <= vbox.g2; j++) {
for (k = vbox.b1; k <= vbox.b2; k++) {
index = getColorIndex(i,j,k);
sum += (histo[index] || 0);
}
}
total += sum;
partialsum[i] = total;
}
}
else if (maxw == gw) {
for (i = vbox.g1; i <= vbox.g2; i++) {
sum = 0;
for (j = vbox.r1; j <= vbox.r2; j++) {
for (k = vbox.b1; k <= vbox.b2; k++) {
index = getColorIndex(j,i,k);
sum += (histo[index] || 0);
}
}
total += sum;
partialsum[i] = total;
}
}
else {  /* maxw == bw */
for (i = vbox.b1; i <= vbox.b2; i++) {
sum = 0;
for (j = vbox.r1; j <= vbox.r2; j++) {
for (k = vbox.g1; k <= vbox.g2; k++) {
index = getColorIndex(j,k,i);
sum += (histo[index] || 0);
}
}
total += sum;
partialsum[i] = total;
}
}
partialsum.forEach(function(d,i) {
lookaheadsum[i] = total-d;
});
function doCut(color) {
var dim1 = color + '1',
dim2 = color + '2',
left, right, vbox1, vbox2, d2, count2=0;
for (i = vbox[dim1]; i <= vbox[dim2]; i++) {
if (partialsum[i] > total / 2) {
vbox1 = vbox.copy();
vbox2 = vbox.copy();
left = i - vbox[dim1];
right = vbox[dim2] - i;
if (left <= right)
d2 = Math.min(vbox[dim2] - 1, ~~(i + right / 2));
else d2 = Math.max(vbox[dim1], ~~(i - 1 - left / 2));
while (!partialsum[d2]) d2++;
count2 = lookaheadsum[d2];
while (!count2 && partialsum[d2-1]) count2 = lookaheadsum[--d2];
vbox1[dim2] = d2;
vbox2[dim1] = vbox1[dim2] + 1;
return [vbox1, vbox2];
}
}
}
return maxw == rw ? doCut('r') :
maxw == gw ? doCut('g') :
doCut('b');
}
function quantize(pixels, maxcolors) {
if (!pixels.length || maxcolors < 2 || maxcolors > 256) {
return false;
}
var histo = getHisto(pixels),
histosize = 1 << (3 * sigbits);
var nColors = 0;
histo.forEach(function() { nColors++; });
if (nColors <= maxcolors) {
}
var vbox = vboxFromPixels(pixels, histo),
pq = new PQueue(function(a,b) { return pv.naturalOrder(a.count(), b.count()); });
pq.push(vbox);
function iter(lh, target) {
var ncolors = 1,
niters = 0,
vbox;
while (niters < maxIterations) {
vbox = lh.pop();
if (!vbox.count())  { /* just put it back */
lh.push(vbox);
niters++;
continue;
}
var vboxes = medianCutApply(histo, vbox),
vbox1 = vboxes[0],
vbox2 = vboxes[1];
if (!vbox1) {
return;
}
lh.push(vbox1);
if (vbox2) {  /* vbox2 can be null */
lh.push(vbox2);
ncolors++;
}
if (ncolors >= target) return;
if (niters++ > maxIterations) {
return;
}
}
}
iter(pq, fractByPopulations * maxcolors);
var pq2 = new PQueue(function(a,b) {
return pv.naturalOrder(a.count()*a.volume(), b.count()*b.volume());
});
while (pq.size()) {
pq2.push(pq.pop());
}
iter(pq2, maxcolors - pq2.size());
var cmap = new CMap();
while (pq2.size()) {
cmap.push(pq2.pop());
}
return cmap;
}
return {
quantize: quantize
};
})();
;
;
/*! tooltip.min.js */ 
;
;
/*! tooltip 0.1.0 - 18th Dec 2013 | https://github.com/darsain/tooltip */
!function(){function a(b,c,d){var e=a.resolve(b);if(null==e){d=d||b,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=a.modules[e];if(!g._resolving&&!g.exports){var h={};h.exports={},h.client=h.component=!0,g._resolving=!0,g.call(this,h.exports,a.relative(e),h),delete g._resolving,g.exports=h.exports}return g.exports}a.modules={},a.aliases={},a.resolve=function(b){"/"===b.charAt(0)&&(b=b.slice(1));for(var c=[b,b+".js",b+".json",b+"/index.js",b+"/index.json"],d=0;d<c.length;d++){var b=c[d];if(a.modules.hasOwnProperty(b))return b;if(a.aliases.hasOwnProperty(b))return a.aliases[b]}},a.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!=b[d]&&""!=b[d]&&c.push(b[d]);return a.concat(c).join("/")},a.register=function(b,c){a.modules[b]=c},a.alias=function(b,c){if(!a.modules.hasOwnProperty(b))throw new Error('Failed to alias "'+b+'", it does not exist');a.aliases[c]=b},a.relative=function(b){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function d(c){var e=d.resolve(c);return a(e,b,c)}var e=a.normalize(b,"..");return d.resolve=function(d){var f=d.charAt(0);if("/"==f)return d.slice(1);if("."==f)return a.normalize(e,d);var g=b.split("/"),h=c(g,"deps")+1;return h||(h=0),d=g.slice(0,h+1).join("/")+"/deps/"+d},d.exists=function(b){return a.modules.hasOwnProperty(d.resolve(b))},d},a.register("darsain-event/index.js",function(a){"use strict";a.bind=window.addEventListener?function(a,b,c,d){return a.addEventListener(b,c,d||!1),c}:function(a,b,c){var d=b+c;return a[d]=a[d]||function(){var b=window.event;b.target=b.srcElement,b.preventDefault=function(){b.returnValue=!1},b.stopPropagation=function(){b.cancelBubble=!0},c.call(a,b)},a.attachEvent("on"+b,a[d]),c},a.unbind=window.removeEventListener?function(a,b,c,d){return a.removeEventListener(b,c,d||!1),c}:function(a,b,c){var d=b+c;a.detachEvent("on"+b,a[d]);try{delete a[d]}catch(e){a[d]=void 0}return c}}),a.register("darsain-position/index.js",function(a,b,c){"use strict";function d(a,b){for(var c in b)a[c]=b[c];return a}function e(a){return a&&null!=a.setInterval}function f(a){var b=g.pageYOffset||i.scrollTop,c=g.pageXOffset||i.scrollLeft,f={left:0,right:0,top:0,bottom:0,width:0,height:0};if(e(a))f.width=g.innerWidth||i.clientWidth,f.height=g.innerHeight||i.clientHeight;else{if(!i.contains(a)||null==a.getBoundingClientRect)return f;d(f,a.getBoundingClientRect()),f.width=f.right-f.left,f.height=f.bottom-f.top}return f.top=f.top+b-i.clientTop,f.left=f.left+c-i.clientLeft,f.right=f.left+f.width,f.bottom=f.top+f.height,f}c.exports=f;var g=window,h=g.document,i=h.documentElement}),a.register("component-classes/index.js",function(a,b,c){function d(a){if(!a)throw new Error("A DOM element reference is required");this.el=a,this.list=a.classList}var e=b("indexof"),f=/\s+/,g=Object.prototype.toString;c.exports=function(a){return new d(a)},d.prototype.add=function(a){if(this.list)return this.list.add(a),this;var b=this.array(),c=e(b,a);return~c||b.push(a),this.el.className=b.join(" "),this},d.prototype.remove=function(a){if("[object RegExp]"==g.call(a))return this.removeMatching(a);if(this.list)return this.list.remove(a),this;var b=this.array(),c=e(b,a);return~c&&b.splice(c,1),this.el.className=b.join(" "),this},d.prototype.removeMatching=function(a){for(var b=this.array(),c=0;c<b.length;c++)a.test(b[c])&&this.remove(b[c]);return this},d.prototype.toggle=function(a){return this.list?(this.list.toggle(a),this):(this.has(a)?this.remove(a):this.add(a),this)},d.prototype.array=function(){var a=this.el.className.replace(/^\s+|\s+$/g,""),b=a.split(f);return""===b[0]&&b.shift(),b},d.prototype.has=d.prototype.contains=function(a){return this.list?this.list.contains(a):!!~e(this.array(),a)}}),a.register("component-indexof/index.js",function(a,b,c){c.exports=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}}),a.register("tooltip/index.js",function(a,b,c){"use strict";function d(a,b){for(var c in b)a[c]=b[c];return a}function e(a){return 0|Math.round(String(a).replace(/[^\-0-9.]/g,""))}function f(a){var b=String(q(a,f.propName)),c=b.match(/([0-9.]+)([ms]{1,2})/);return c&&(b=Number(c[1]),"s"===c[2]&&(b*=1e3)),0|b}function g(a,b){return this instanceof g?(this.hidden=1,this.options=d(p(g.defaults),b),this._createElement(),this.content(a),void 0):new g(a,b)}var h=b("event"),i=b("classes"),j=b("indexof"),k=b("position"),l=window,m=l.document,n=m.body,o=["top","bottom"];c.exports=g;var p=Object.create||function(){function a(){}return function(b){return a.prototype=b,new a}}(),q=l.getComputedStyle?function(a,b){return l.getComputedStyle(a,null)[b]}:function(a,b){return a.currentStyle[b]};f.propName=function(){for(var a=m.createElement("div"),b=["transitionDuration","webkitTransitionDuration"],c="1s",d=0;d<b.length;d++)if(a.style[b[d]]=c,a.style[b[d]]===c)return b[d]}(),g.prototype._createElement=function(){this.element=m.createElement("div"),this.classes=i(this.element),this.classes.add(this.options.baseClass);for(var a,b=0;b<g.classTypes.length;b++)a=g.classTypes[b]+"Class",this.options[a]&&this.classes.add(this.options[a])},g.prototype.type=function(a){return this.changeClassType("type",a)},g.prototype.effect=function(a){return this.changeClassType("effect",a)},g.prototype.changeClassType=function(a,b){return a+="Class",this.options[a]&&this.classes.remove(this.options[a]),this.options[a]=b,b&&this.classes.add(b),this},g.prototype.updateSize=function(){return this.hidden&&(this.element.style.visibility="hidden",n.appendChild(this.element)),this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,null==this.spacing&&(this.spacing=null!=this.options.spacing?this.options.spacing:e(q(this.element,"top"))),this.hidden?(n.removeChild(this.element),this.element.style.visibility=""):this.position(),this},g.prototype.content=function(a){return"object"==typeof a?(this.element.innerHTML="",this.element.appendChild(a)):this.element.innerHTML=a,this.updateSize(),this},g.prototype.place=function(a){return this.options.place=a,this.hidden||this.position(),this},g.prototype.attach=function(a){return this.attachedTo=a,this.hidden||this.position(),this},g.prototype.detach=function(){return this.hide(),this.attachedTo=null,this},g.prototype._pickPlace=function(a){if(!this.options.auto)return this.options.place;var b=k(l),c=this.options.place.split("-"),d=this.spacing;if(~j(o,c[0]))switch(a.top-this.height-d<=b.top?c[0]="bottom":a.bottom+this.height+d>=b.bottom&&(c[0]="top"),c[1]){case"left":a.right-this.width<=b.left&&(c[1]="right");break;case"right":a.left+this.width>=b.right&&(c[1]="left");break;default:a.left+a.width/2+this.width/2>=b.right?c[1]="left":a.right-a.width/2-this.width/2<=b.left&&(c[1]="right")}else switch(a.left-this.width-d<=b.left?c[0]="right":a.right+this.width+d>=b.right&&(c[0]="left"),c[1]){case"top":a.bottom-this.height<=b.top&&(c[1]="bottom");break;case"bottom":a.top+this.height>=b.bottom&&(c[1]="top");break;default:a.top+a.height/2+this.height/2>=b.bottom?c[1]="top":a.bottom-a.height/2-this.height/2<=b.top&&(c[1]="bottom")}return c.join("-")},g.prototype.position=function(a,b){this.attachedTo&&(a=this.attachedTo),null==a&&this._p?(a=this._p[0],b=this._p[1]):this._p=arguments;var c="number"==typeof a?{left:0|a,right:0|a,top:0|b,bottom:0|b,width:0,height:0}:k(a),d=this.spacing,e=this._pickPlace(c);e!==this.curPlace&&(this.curPlace&&this.classes.remove(this.curPlace),this.classes.add(e),this.curPlace=e);var f,g;switch(this.curPlace){case"top":f=c.top-this.height-d,g=c.left+c.width/2-this.width/2;break;case"top-left":f=c.top-this.height-d,g=c.right-this.width;break;case"top-right":f=c.top-this.height-d,g=c.left;break;case"bottom":f=c.bottom+d,g=c.left+c.width/2-this.width/2;break;case"bottom-left":f=c.bottom+d,g=c.right-this.width;break;case"bottom-right":f=c.bottom+d,g=c.left;break;case"left":f=c.top+c.height/2-this.height/2,g=c.left-this.width-d;break;case"left-top":f=c.bottom-this.height,g=c.left-this.width-d;break;case"left-bottom":f=c.top,g=c.left-this.width-d;break;case"right":f=c.top+c.height/2-this.height/2,g=c.right+d;break;case"right-top":f=c.bottom-this.height,g=c.right+d;break;case"right-bottom":f=c.top,g=c.right+d}return this.element.style.top=Math.round(f)+"px",this.element.style.left=Math.round(g)+"px",this},g.prototype.show=function(a,b){return a=this.attachedTo?this.attachedTo:a,clearTimeout(this.aIndex),null!=a&&this.position(a,b),this.hidden&&(this.hidden=0,n.appendChild(this.element)),this.attachedTo&&this._aware(),this.options.inClass&&(this.options.effectClass&&void this.element.clientHeight,this.classes.add(this.options.inClass)),this},g.prototype.hide=function(){if(!this.hidden){var a=this,b=0;return this.options.inClass&&(this.classes.remove(this.options.inClass),this.options.effectClass&&(b=f(this.element))),this.attachedTo&&this._unaware(),clearTimeout(this.aIndex),this.aIndex=setTimeout(function(){a.aIndex=0,n.removeChild(a.element),a.hidden=1},b),this}},g.prototype.toggle=function(a,b){return this[this.hidden?"show":"hide"](a,b)},g.prototype.destroy=function(){clearTimeout(this.aIndex),this._unaware(),this.hidden||n.removeChild(this.element),this.element=this.options=null},g.prototype._aware=function(){var a=j(g.winAware,this);~a||g.winAware.push(this)},g.prototype._unaware=function(){var a=j(g.winAware,this);~a&&g.winAware.splice(a,1)},g.reposition=function(){function a(){!c&&g.winAware.length&&(c=d(b,17))}function b(){c=0;for(var a,b=0,d=g.winAware.length;d>b;b++)a=g.winAware[b],a.position()}var c,d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return setTimeout(a,17)};return a}(),g.winAware=[],h.bind(window,"resize",g.reposition),h.bind(window,"scroll",g.reposition),g.classTypes=["type","effect"],g.defaults={baseClass:"tooltip",typeClass:null,effectClass:null,inClass:"in",place:"top",spacing:null,auto:0}}),a.alias("darsain-event/index.js","tooltip/deps/event/index.js"),a.alias("darsain-event/index.js","event/index.js"),a.alias("darsain-position/index.js","tooltip/deps/position/index.js"),a.alias("darsain-position/index.js","position/index.js"),a.alias("component-classes/index.js","tooltip/deps/classes/index.js"),a.alias("component-classes/index.js","classes/index.js"),a.alias("component-indexof/index.js","component-classes/deps/indexof/index.js"),a.alias("component-indexof/index.js","tooltip/deps/indexof/index.js"),a.alias("component-indexof/index.js","indexof/index.js"),"object"==typeof exports?module.exports=a("tooltip"):"function"==typeof define&&define.amd?define(function(){return a("tooltip")}):this.Tooltip=a("tooltip")}();
;
;
/*! fabric.js */ 
;
;
/* build: `node build.js modules=ALL exclude=gestures,cufon,json minifier=uglifyjs` */
/*! Fabric.js Copyright 2008-2013, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric = fabric || { version: "1.4.0" };
if (typeof exports !== 'undefined') {
exports.fabric = fabric;
}
if (typeof document !== 'undefined' && typeof window !== 'undefined') {
fabric.document = document;
fabric.window = window;
}
else {
fabric.document = require("jsdom")
.jsdom("<!DOCTYPE html><html><head></head><body></body></html>");
fabric.window = fabric.document.createWindow();
}
/**
* True when in environment that supports touch events
* @type boolean
*/
fabric.isTouchSupported = "ontouchstart" in fabric.document.documentElement;
/**
* True when in environment that's probably Node.js
* @type boolean
*/
fabric.isLikelyNode = typeof Buffer !== 'undefined' &&
typeof window === 'undefined';
/**
* Attributes parsed from all SVG elements
* @type array
*/
fabric.SHARED_ATTRIBUTES = [
"transform",
"fill", "fill-opacity", "fill-rule",
"opacity",
"stroke", "stroke-dasharray", "stroke-linecap",
"stroke-linejoin", "stroke-miterlimit",
"stroke-opacity", "stroke-width"
];
(function(){
/**
* @private
* @param {String} eventName
* @param {Function} handler
*/
function _removeEventListener(eventName, handler) {
if (!this.__eventListeners[eventName]) return;
if (handler) {
fabric.util.removeFromArray(this.__eventListeners[eventName], handler);
}
else {
this.__eventListeners[eventName].length = 0;
}
}
/**
* Observes specified event
* @deprecated `observe` deprecated since 0.8.34 (use `on` instead)
* @memberOf fabric.Observable
* @alias on
* @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})
* @param {Function} handler Function that receives a notification when an event of the specified type occurs
* @return {Self} thisArg
* @chainable
*/
function observe(eventName, handler) {
if (!this.__eventListeners) {
this.__eventListeners = { };
}
if (arguments.length === 1) {
for (var prop in eventName) {
this.on(prop, eventName[prop]);
}
}
else {
if (!this.__eventListeners[eventName]) {
this.__eventListeners[eventName] = [ ];
}
this.__eventListeners[eventName].push(handler);
}
return this;
}
/**
* Stops event observing for a particular event handler. Calling this method
* without arguments removes all handlers for all events
* @deprecated `stopObserving` deprecated since 0.8.34 (use `off` instead)
* @memberOf fabric.Observable
* @alias off
* @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})
* @param {Function} handler Function to be deleted from EventListeners
* @return {Self} thisArg
* @chainable
*/
function stopObserving(eventName, handler) {
if (!this.__eventListeners) return;
if (arguments.length === 0) {
this.__eventListeners = { };
}
else if (arguments.length === 1 && typeof arguments[0] === 'object') {
for (var prop in eventName) {
_removeEventListener.call(this, prop, eventName[prop]);
}
}
else {
_removeEventListener.call(this, eventName, handler);
}
return this;
}
/**
* Fires event with an optional options object
* @deprecated `fire` deprecated since 1.0.7 (use `trigger` instead)
* @memberOf fabric.Observable
* @alias trigger
* @param {String} eventName Event name to fire
* @param {Object} [options] Options object
* @return {Self} thisArg
* @chainable
*/
function fire(eventName, options) {
if (!this.__eventListeners) return;
var listenersForEvent = this.__eventListeners[eventName];
if (!listenersForEvent) return;
for (var i = 0, len = listenersForEvent.length; i < len; i++) {
listenersForEvent[i].call(this, options || { });
}
return this;
}
/**
* @namespace fabric.Observable
* @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#events}
* @see {@link http://fabricjs.com/events/|Events demo}
*/
fabric.Observable = {
observe: observe,
stopObserving: stopObserving,
fire: fire,
on: observe,
off: stopObserving,
trigger: fire
};
})();
/**
* @namespace fabric.Collection
*/
fabric.Collection = {
/**
* Adds objects to collection, then renders canvas (if `renderOnAddRemove` is not `false`)
* Objects should be instances of (or inherit from) fabric.Object
* @param [...] Zero or more fabric instances
* @return {Self} thisArg
*/
add: function () {
this._objects.push.apply(this._objects, arguments);
for (var i = arguments.length; i--; ) {
this._onObjectAdded(arguments[i]);
}
this.renderOnAddRemove && this.renderAll();
return this;
},
/**
* Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)
* An object should be an instance of (or inherit from) fabric.Object
* @param {Object} object Object to insert
* @param {Number} index Index to insert object at
* @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs
* @return {Self} thisArg
*/
insertAt: function (object, index, nonSplicing) {
var objects = this.getObjects();
if (nonSplicing) {
objects[index] = object;
}
else {
objects.splice(index, 0, object);
}
this._onObjectAdded(object);
this.renderOnAddRemove && this.renderAll();
return this;
},
/**
* Removes an object from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)
* @param {Object} object Object to remove
* @return {Self} thisArg
*/
remove: function(object) {
var objects = this.getObjects(),
index = objects.indexOf(object);
if (index !== -1) {
objects.splice(index, 1);
this._onObjectRemoved(object);
}
this.renderOnAddRemove && this.renderAll();
return object;
},
/**
* Executes given function for each object in this group
* @param {Function} callback
*                   Callback invoked with current object as first argument,
*                   index - as second and an array of all objects - as third.
*                   Iteration happens in reverse order (for performance reasons).
*                   Callback is invoked in a context of Global Object (e.g. `window`)
*                   when no `context` argument is given
*
* @param {Object} context Context (aka thisObject)
* @return {Self} thisArg
*/
forEachObject: function(callback, context) {
var objects = this.getObjects(),
i = objects.length;
while (i--) {
callback.call(context, objects[i], i, objects);
}
return this;
},
/**
* Returns an array of children objects of this instance
* Type parameter introduced in 1.3.10
* @param {String} [type] When specified, only objects of this type are returned
* @return {Array}
*/
getObjects: function(type) {
if (typeof type === 'undefined') {
return this._objects;
}
return this._objects.filter(function(o) {
return o.type === type;
});
},
/**
* Returns object at specified index
* @param {Number} index
* @return {Self} thisArg
*/
item: function (index) {
return this.getObjects()[index];
},
/**
* Returns true if collection contains no objects
* @return {Boolean} true if collection is empty
*/
isEmpty: function () {
return this.getObjects().length === 0;
},
/**
* Returns a size of a collection (i.e: length of an array containing its objects)
* @return {Number} Collection size
*/
size: function() {
return this.getObjects().length;
},
/**
* Returns true if collection contains an object
* @param {Object} object Object to check against
* @return {Boolean} `true` if collection contains an object
*/
contains: function(object) {
return this.getObjects().indexOf(object) > -1;
},
/**
* Returns number representation of a collection complexity
* @return {Number} complexity
*/
complexity: function () {
return this.getObjects().reduce(function (memo, current) {
memo += current.complexity ? current.complexity() : 0;
return memo;
}, 0);
}
};
(function(global) {
var sqrt = Math.sqrt,
atan2 = Math.atan2,
PiBy180 = Math.PI / 180;
/**
* @namespace fabric.util
*/
fabric.util = {
/**
* Removes value from an array.
* Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`
* @static
* @memberOf fabric.util
* @param {Array} array
* @param {Any} value
* @return {Array} original array
*/
removeFromArray: function(array, value) {
var idx = array.indexOf(value);
if (idx !== -1) {
array.splice(idx, 1);
}
return array;
},
/**
* Returns random number between 2 specified ones.
* @static
* @memberOf fabric.util
* @param {Number} min lower limit
* @param {Number} max upper limit
* @return {Number} random value (between min and max)
*/
getRandomInt: function(min, max) {
return Math.floor(Math.random() * (max - min + 1)) + min;
},
/**
* Transforms degrees to radians.
* @static
* @memberOf fabric.util
* @param {Number} degrees value in degrees
* @return {Number} value in radians
*/
degreesToRadians: function(degrees) {
return degrees * PiBy180;
},
/**
* Transforms radians to degrees.
* @static
* @memberOf fabric.util
* @param {Number} radians value in radians
* @return {Number} value in degrees
*/
radiansToDegrees: function(radians) {
return radians / PiBy180;
},
/**
* Rotates `point` around `origin` with `radians`
* @static
* @memberOf fabric.util
* @param {fabric.Point} The point to rotate
* @param {fabric.Point} The origin of the rotation
* @param {Number} The radians of the angle for the rotation
* @return {fabric.Point} The new rotated point
*/
rotatePoint: function(point, origin, radians) {
var sin = Math.sin(radians),
cos = Math.cos(radians);
point.subtractEquals(origin);
var rx = point.x * cos - point.y * sin,
ry = point.x * sin + point.y * cos;
return new fabric.Point(rx, ry).addEquals(origin);
},
/**
* A wrapper around Number#toFixed, which contrary to native method returns number, not string.
* @static
* @memberOf fabric.util
* @param {Number | String} number number to operate on
* @param {Number} fractionDigits number of fraction digits to "leave"
* @return {Number}
*/
toFixed: function(number, fractionDigits) {
return parseFloat(Number(number).toFixed(fractionDigits));
},
/**
* Function which always returns `false`.
* @static
* @memberOf fabric.util
* @return {Boolean}
*/
falseFunction: function() {
return false;
},
/**
* Returns klass "Class" object of given namespace
* @memberOf fabric.util
* @param {String} type Type of object (eg. 'circle')
* @param {String} namespace Namespace to get klass "Class" object from
* @return {Object} klass "Class"
*/
getKlass: function(type, namespace) {
type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));
return fabric.util.resolveNamespace(namespace)[type];
},
/**
* Returns object of given namespace
* @memberOf fabric.util
* @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'
* @return {Object} Object for given namespace (default fabric)
*/
resolveNamespace: function(namespace) {
if (!namespace) return fabric;
var parts = namespace.split('.'),
len = parts.length,
obj = global || fabric.window;
for (var i = 0; i < len; ++i) {
obj = obj[parts[i]];
}
return obj;
},
/**
* Loads image element from given url and passes it to a callback
* @memberOf fabric.util
* @param {String} url URL representing an image
* @param {Function} callback Callback; invoked with loaded image
* @param {Any} [context] Context to invoke callback in
* @param {Object} [crossOrigin] crossOrigin value to set image element to
*/
loadImage: function(url, callback, context, crossOrigin) {
if (!url) {
callback && callback.call(context, url);
return;
}
var img = fabric.util.createImage();
/** @ignore */
img.onload = function () {
callback && callback.call(context, img);
img = img.onload = img.onerror = null;
};
/** @ignore */
img.onerror = function() {
fabric.log('Error loading ' + img.src);
callback && callback.call(context, null, true);
img = img.onload = img.onerror = null;
};
if (url.indexOf('data') !== 0 && typeof crossOrigin !== 'undefined') {
img.crossOrigin = crossOrigin;
}
img.src = url;
},
/**
* Creates corresponding fabric instances from their object representations
* @static
* @memberOf fabric.util
* @param {Array} objects Objects to enliven
* @param {Function} callback Callback to invoke when all objects are created
* @param {Function} [reviver] Method for further parsing of object elements,
* called after each fabric object created.
*/
enlivenObjects: function(objects, callback, namespace, reviver) {
objects = objects || [ ];
function onLoaded() {
if (++numLoadedObjects === numTotalObjects) {
callback && callback(enlivenedObjects);
}
}
var enlivenedObjects = [ ],
numLoadedObjects = 0,
numTotalObjects = objects.length;
if (!numTotalObjects) {
callback && callback(enlivenedObjects);
return;
}
objects.forEach(function (o, index) {
if (!o || !o.type) {
onLoaded();
return;
}
var klass = fabric.util.getKlass(o.type, namespace);
if (klass.async) {
klass.fromObject(o, function (obj, error) {
if (!error) {
enlivenedObjects[index] = obj;
reviver && reviver(o, enlivenedObjects[index]);
}
onLoaded();
});
}
else {
enlivenedObjects[index] = klass.fromObject(o);
reviver && reviver(o, enlivenedObjects[index]);
onLoaded();
}
});
},
/**
* Groups SVG elements (usually those retrieved from SVG document)
* @static
* @memberOf fabric.util
* @param {Array} elements SVG elements to group
* @param {Object} [options] Options object
* @return {fabric.Object|fabric.PathGroup}
*/
groupSVGElements: function(elements, options, path) {
var object;
if (elements.length > 1) {
object = new fabric.PathGroup(elements, options);
}
else {
object = elements[0];
}
if (typeof path !== 'undefined') {
object.setSourcePath(path);
}
return object;
},
/**
* Populates an object with properties of another object
* @static
* @memberOf fabric.util
* @param {Object} source Source object
* @param {Object} destination Destination object
* @return {Array} properties Propertie names to include
*/
populateWithProperties: function(source, destination, properties) {
if (properties && Object.prototype.toString.call(properties) === '[object Array]') {
for (var i = 0, len = properties.length; i < len; i++) {
if (properties[i] in source) {
destination[properties[i]] = source[properties[i]];
}
}
}
},
/**
* Draws a dashed line between two points
*
* This method is used to draw dashed line around selection area.
* See <a href="http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas">dotted stroke in canvas</a>
*
* @param {CanvasRenderingContext2D} ctx context
* @param {Number} x  start x coordinate
* @param {Number} y start y coordinate
* @param {Number} x2 end x coordinate
* @param {Number} y2 end y coordinate
* @param {Array} da dash array pattern
*/
drawDashedLine: function(ctx, x, y, x2, y2, da) {
var dx = x2 - x,
dy = y2 - y,
len = sqrt(dx*dx + dy*dy),
rot = atan2(dy, dx),
dc = da.length,
di = 0,
draw = true;
ctx.save();
ctx.translate(x, y);
ctx.moveTo(0, 0);
ctx.rotate(rot);
x = 0;
while (len > x) {
x += da[di++ % dc];
if (x > len) {
x = len;
}
ctx[draw ? 'lineTo' : 'moveTo'](x, 0);
draw = !draw;
}
ctx.restore();
},
/**
* Creates canvas element and initializes it via excanvas if necessary
* @static
* @memberOf fabric.util
* @param {CanvasElement} [canvasEl] optional canvas element to initialize;
* when not given, element is created implicitly
* @return {CanvasElement} initialized canvas element
*/
createCanvasElement: function(canvasEl) {
canvasEl || (canvasEl = fabric.document.createElement('canvas'));
if (!canvasEl.getContext && typeof G_vmlCanvasManager !== 'undefined') {
G_vmlCanvasManager.initElement(canvasEl);
}
return canvasEl;
},
/**
* Creates image element (works on client and node)
* @static
* @memberOf fabric.util
* @return {HTMLImageElement} HTML image element
*/
createImage: function() {
return fabric.isLikelyNode
? new (require('canvas').Image)()
: fabric.document.createElement('img');
},
/**
* Creates accessors (getXXX, setXXX) for a "class", based on "stateProperties" array
* @static
* @memberOf fabric.util
* @param {Object} klass "Class" to create accessors for
*/
createAccessors: function(klass) {
var proto = klass.prototype;
for (var i = proto.stateProperties.length; i--; ) {
var propName = proto.stateProperties[i],
capitalizedPropName = propName.charAt(0).toUpperCase() + propName.slice(1),
setterName = 'set' + capitalizedPropName,
getterName = 'get' + capitalizedPropName;
if (!proto[getterName]) {
proto[getterName] = (function(property) {
return new Function('return this.get("' + property + '")');
})(propName);
}
if (!proto[setterName]) {
proto[setterName] = (function(property) {
return new Function('value', 'return this.set("' + property + '", value)');
})(propName);
}
}
},
/**
* @static
* @memberOf fabric.util
* @param {fabric.Object} receiver Object implementing `clipTo` method
* @param {CanvasRenderingContext2D} ctx Context to clip
*/
clipContext: function(receiver, ctx) {
ctx.save();
ctx.beginPath();
receiver.clipTo(ctx);
ctx.clip();
},
/**
* Multiply matrix A by matrix B to nest transformations
* @static
* @memberOf fabric.util
* @param  {Array} matrixA First transformMatrix
* @param  {Array} matrixB Second transformMatrix
* @return {Array} The product of the two transform matrices
*/
multiplyTransformMatrices: function(matrixA, matrixB) {
var a = [
[matrixA[0], matrixA[2], matrixA[4]],
[matrixA[1], matrixA[3], matrixA[5]],
[0         , 0         , 1         ]
];
var b = [
[matrixB[0], matrixB[2], matrixB[4]],
[matrixB[1], matrixB[3], matrixB[5]],
[0         , 0         , 1         ]
];
var result = [];
for (var r=0; r<3; r++) {
result[r] = [];
for (var c=0; c<3; c++) {
var sum = 0;
for (var k=0; k<3; k++) {
sum += a[r][k]*b[k][c];
}
result[r][c] = sum;
}
}
return [
result[0][0],
result[1][0],
result[0][1],
result[1][1],
result[0][2],
result[1][2]
];
},
/**
* Returns string representation of function body
* @param {Function} fn Function to get body of
* @return {String} Function body
*/
getFunctionBody: function(fn) {
return (String(fn).match(/function[^{]*\{([\s\S]*)\}/) || {})[1];
},
/**
* Normalizes polygon/polyline points according to their dimensions
* @param {Array} points
* @param {Object} options
*/
normalizePoints: function(points, options) {
var minX = fabric.util.array.min(points, 'x'),
minY = fabric.util.array.min(points, 'y');
minX = minX < 0 ? minX : 0;
minY = minX < 0 ? minY : 0;
for (var i = 0, len = points.length; i < len; i++) {
points[i].x -= (options.width / 2 + minX) || 0;
points[i].y -= (options.height / 2 + minY) || 0;
}
},
/**
* Returns true if context has transparent pixel
* at specified location (taking tolerance into account)
* @param {CanvasRenderingContext2D} ctx context
* @param {Number} x x coordinate
* @param {Number} y y coordinate
* @param {Number} tolerance Tolerance
*/
isTransparent: function(ctx, x, y, tolerance) {
if (tolerance > 0) {
if (x > tolerance) {
x -= tolerance;
}
else {
x = 0;
}
if (y > tolerance) {
y -= tolerance;
}
else {
y = 0;
}
}
var _isTransparent = true;
var imageData = ctx.getImageData(
x, y, (tolerance * 2) || 1, (tolerance * 2) || 1);
for (var i = 3, l = imageData.data.length; i < l; i += 4) {
var temp = imageData.data[i];
_isTransparent = temp <= 0;
if (_isTransparent === false) break; // Stop if colour found
}
imageData = null;
return _isTransparent;
}
};
})(typeof exports !== 'undefined' ? exports : this);
(function() {
var arcToSegmentsCache = { },
segmentToBezierCache = { },
_join = Array.prototype.join,
argsString;
function arcToSegments(x, y, rx, ry, large, sweep, rotateX, ox, oy) {
argsString = _join.call(arguments);
if (arcToSegmentsCache[argsString]) {
return arcToSegmentsCache[argsString];
}
var coords = getXYCoords(rotateX, rx, ry, ox, oy, x, y);
var d = (coords.x1-coords.x0) * (coords.x1-coords.x0) +
(coords.y1-coords.y0) * (coords.y1-coords.y0);
var sfactor_sq = 1 / d - 0.25;
if (sfactor_sq < 0) sfactor_sq = 0;
var sfactor = Math.sqrt(sfactor_sq);
if (sweep === large) sfactor = -sfactor;
var xc = 0.5 * (coords.x0 + coords.x1) - sfactor * (coords.y1-coords.y0);
var yc = 0.5 * (coords.y0 + coords.y1) + sfactor * (coords.x1-coords.x0);
var th0 = Math.atan2(coords.y0-yc, coords.x0-xc);
var th1 = Math.atan2(coords.y1-yc, coords.x1-xc);
var th_arc = th1-th0;
if (th_arc < 0 && sweep === 1) {
th_arc += 2*Math.PI;
}
else if (th_arc > 0 && sweep === 0) {
th_arc -= 2 * Math.PI;
}
var segments = Math.ceil(Math.abs(th_arc / (Math.PI * 0.5 + 0.001)));
var result = [];
for (var i=0; i<segments; i++) {
var th2 = th0 + i * th_arc / segments;
var th3 = th0 + (i+1) * th_arc / segments;
result[i] = [xc, yc, th2, th3, rx, ry, coords.sin_th, coords.cos_th];
}
arcToSegmentsCache[argsString] = result;
return result;
}
function getXYCoords(rotateX, rx, ry, ox, oy, x, y) {
var th = rotateX * (Math.PI/180);
var sin_th = Math.sin(th);
var cos_th = Math.cos(th);
rx = Math.abs(rx);
ry = Math.abs(ry);
var px = cos_th * (ox - x) * 0.5 + sin_th * (oy - y) * 0.5;
var py = cos_th * (oy - y) * 0.5 - sin_th * (ox - x) * 0.5;
var pl = (px*px) / (rx*rx) + (py*py) / (ry*ry);
if (pl > 1) {
pl = Math.sqrt(pl);
rx *= pl;
ry *= pl;
}
var a00 = cos_th / rx;
var a01 = sin_th / rx;
var a10 = (-sin_th) / ry;
var a11 = (cos_th) / ry;
return {
x0: a00 * ox + a01 * oy,
y0: a10 * ox + a11 * oy,
x1: a00 * x + a01 * y,
y1: a10 * x + a11 * y,
sin_th: sin_th,
cos_th: cos_th
};
}
function segmentToBezier(cx, cy, th0, th1, rx, ry, sin_th, cos_th) {
argsString = _join.call(arguments);
if (segmentToBezierCache[argsString]) {
return segmentToBezierCache[argsString];
}
var a00 = cos_th * rx;
var a01 = -sin_th * ry;
var a10 = sin_th * rx;
var a11 = cos_th * ry;
var th_half = 0.5 * (th1 - th0);
var t = (8/3) * Math.sin(th_half * 0.5) *
Math.sin(th_half * 0.5) / Math.sin(th_half);
var x1 = cx + Math.cos(th0) - t * Math.sin(th0);
var y1 = cy + Math.sin(th0) + t * Math.cos(th0);
var x3 = cx + Math.cos(th1);
var y3 = cy + Math.sin(th1);
var x2 = x3 + t * Math.sin(th1);
var y2 = y3 - t * Math.cos(th1);
segmentToBezierCache[argsString] = [
a00 * x1 + a01 * y1,      a10 * x1 + a11 * y1,
a00 * x2 + a01 * y2,      a10 * x2 + a11 * y2,
a00 * x3 + a01 * y3,      a10 * x3 + a11 * y3
];
return segmentToBezierCache[argsString];
}
/**
* Draws arc
* @param {CanvasRenderingContext2D} ctx
* @param {Number} x
* @param {Number} y
* @param {Array} coords
*/
fabric.util.drawArc = function(ctx, x, y, coords) {
var rx = coords[0];
var ry = coords[1];
var rot = coords[2];
var large = coords[3];
var sweep = coords[4];
var ex = coords[5];
var ey = coords[6];
var segs = arcToSegments(ex, ey, rx, ry, large, sweep, rot, x, y);
for (var i=0; i<segs.length; i++) {
var bez = segmentToBezier.apply(this, segs[i]);
ctx.bezierCurveTo.apply(ctx, bez);
}
};
})();
(function() {
var slice = Array.prototype.slice;
/* _ES5_COMPAT_START_ */
if (!Array.prototype.indexOf) {
/**
* Finds index of an element in an array
* @param {Any} searchElement
* @param {Number} [fromIndex]
* @return {Number}
*/
Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
if (this === void 0 || this === null) {
throw new TypeError();
}
var t = Object(this), len = t.length >>> 0;
if (len === 0) {
return -1;
}
var n = 0;
if (arguments.length > 0) {
n = Number(arguments[1]);
if (n !== n) { // shortcut for verifying if it's NaN
n = 0;
}
else if (n !== 0 && n !== Number.POSITIVE_INFINITY && n !== Number.NEGATIVE_INFINITY) {
n = (n > 0 || -1) * Math.floor(Math.abs(n));
}
}
if (n >= len) {
return -1;
}
var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
for (; k < len; k++) {
if (k in t && t[k] === searchElement) {
return k;
}
}
return -1;
};
}
if (!Array.prototype.forEach) {
/**
* Iterates an array, invoking callback for each element
* @param {Function} fn Callback to invoke for each element
* @param {Object} [context] Context to invoke callback in
* @return {Array}
*/
Array.prototype.forEach = function(fn, context) {
for (var i = 0, len = this.length >>> 0; i < len; i++) {
if (i in this) {
fn.call(context, this[i], i, this);
}
}
};
}
if (!Array.prototype.map) {
/**
* Returns a result of iterating over an array, invoking callback for each element
* @param {Function} fn Callback to invoke for each element
* @param {Object} [context] Context to invoke callback in
* @return {Array}
*/
Array.prototype.map = function(fn, context) {
var result = [ ];
for (var i = 0, len = this.length >>> 0; i < len; i++) {
if (i in this) {
result[i] = fn.call(context, this[i], i, this);
}
}
return result;
};
}
if (!Array.prototype.every) {
/**
* Returns true if a callback returns truthy value for all elements in an array
* @param {Function} fn Callback to invoke for each element
* @param {Object} [context] Context to invoke callback in
* @return {Boolean}
*/
Array.prototype.every = function(fn, context) {
for (var i = 0, len = this.length >>> 0; i < len; i++) {
if (i in this && !fn.call(context, this[i], i, this)) {
return false;
}
}
return true;
};
}
if (!Array.prototype.some) {
/**
* Returns true if a callback returns truthy value for at least one element in an array
* @param {Function} fn Callback to invoke for each element
* @param {Object} [context] Context to invoke callback in
* @return {Boolean}
*/
Array.prototype.some = function(fn, context) {
for (var i = 0, len = this.length >>> 0; i < len; i++) {
if (i in this && fn.call(context, this[i], i, this)) {
return true;
}
}
return false;
};
}
if (!Array.prototype.filter) {
/**
* Returns the result of iterating over elements in an array
* @param {Function} fn Callback to invoke for each element
* @param {Object} [context] Context to invoke callback in
* @return {Array}
*/
Array.prototype.filter = function(fn, context) {
var result = [ ], val;
for (var i = 0, len = this.length >>> 0; i < len; i++) {
if (i in this) {
val = this[i]; // in case fn mutates this
if (fn.call(context, val, i, this)) {
result.push(val);
}
}
}
return result;
};
}
if (!Array.prototype.reduce) {
/**
* Returns "folded" (reduced) result of iterating over elements in an array
* @param {Function} fn Callback to invoke for each element
* @param {Object} [context] Context to invoke callback in
* @return {Any}
*/
Array.prototype.reduce = function(fn /*, initial*/) {
var len = this.length >>> 0,
i = 0,
rv;
if (arguments.length > 1) {
rv = arguments[1];
}
else {
do {
if (i in this) {
rv = this[i++];
break;
}
if (++i >= len) {
throw new TypeError();
}
}
while (true);
}
for (; i < len; i++) {
if (i in this) {
rv = fn.call(null, rv, this[i], i, this);
}
}
return rv;
};
}
/* _ES5_COMPAT_END_ */
/**
* Invokes method on all items in a given array
* @memberOf fabric.util.array
* @param {Array} array Array to iterate over
* @param {String} method Name of a method to invoke
* @return {Array}
*/
function invoke(array, method) {
var args = slice.call(arguments, 2), result = [ ];
for (var i = 0, len = array.length; i < len; i++) {
result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);
}
return result;
}
/**
* Finds maximum value in array (not necessarily "first" one)
* @memberOf fabric.util.array
* @param {Array} array Array to iterate over
* @param {String} byProperty
* @return {Any}
*/
function max(array, byProperty) {
return find(array, byProperty, function(value1, value2) {
return value1 >= value2;
});
}
/**
* Finds minimum value in array (not necessarily "first" one)
* @memberOf fabric.util.array
* @param {Array} array Array to iterate over
* @param {String} byProperty
* @return {Any}
*/
function min(array, byProperty) {
return find(array, byProperty, function(value1, value2) {
return value1 < value2;
});
}
/**
* @private
*/
function find(array, byProperty, condition) {
if (!array || array.length === 0) return undefined;
var i = array.length - 1,
result = byProperty ? array[i][byProperty] : array[i];
if (byProperty) {
while (i--) {
if (condition(array[i][byProperty], result)) {
result = array[i][byProperty];
}
}
}
else {
while (i--) {
if (condition(array[i], result)) {
result = array[i];
}
}
}
return result;
}
/**
* @namespace fabric.util.array
*/
fabric.util.array = {
invoke: invoke,
min: min,
max: max
};
})();
(function(){
/**
* Copies all enumerable properties of one object to another
* @memberOf fabric.util.object
* @param {Object} destination Where to copy to
* @param {Object} source Where to copy from
* @return {Object}
*/
function extend(destination, source) {
for (var property in source) {
destination[property] = source[property];
}
return destination;
}
/**
* Creates an empty object and copies all enumerable properties of another object to it
* @memberOf fabric.util.object
* @param {Object} object Object to clone
* @return {Object}
*/
function clone(object) {
return extend({ }, object);
}
/** @namespace fabric.util.object */
fabric.util.object = {
extend: extend,
clone: clone
};
})();
(function() {
/* _ES5_COMPAT_START_ */
if (!String.prototype.trim) {
/**
* Trims a string (removing whitespace from the beginning and the end)
* @function external:String#trim
* @see <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/Trim">String#trim on MDN</a>
*/
String.prototype.trim = function () {
return this.replace(/^[\s\xA0]+/, '').replace(/[\s\xA0]+$/, '');
};
}
/* _ES5_COMPAT_END_ */
/**
* Camelizes a string
* @memberOf fabric.util.string
* @param {String} string String to camelize
* @return {String} Camelized version of a string
*/
function camelize(string) {
return string.replace(/-+(.)?/g, function(match, character) {
return character ? character.toUpperCase() : '';
});
}
/**
* Capitalizes a string
* @memberOf fabric.util.string
* @param {String} string String to capitalize
* @param {Boolean} [firstLetterOnly] If true only first letter is capitalized
* and other letters stay untouched, if false first letter is capitalized
* and other letters are converted to lowercase.
* @return {String} Capitalized version of a string
*/
function capitalize(string, firstLetterOnly) {
return string.charAt(0).toUpperCase() +
(firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());
}
/**
* Escapes XML in a string
* @memberOf fabric.util.string
* @param {String} string String to escape
* @return {String} Escaped version of a string
*/
function escapeXml(string) {
return string.replace(/&/g, '&amp;')
.replace(/"/g, '&quot;')
.replace(/'/g, '&apos;')
.replace(/</g, '&lt;')
.replace(/>/g, '&gt;');
}
/**
* String utilities
* @namespace fabric.util.string
*/
fabric.util.string = {
camelize: camelize,
capitalize: capitalize,
escapeXml: escapeXml
};
}());
/* _ES5_COMPAT_START_ */
(function() {
var slice = Array.prototype.slice,
apply = Function.prototype.apply,
Dummy = function() { };
if (!Function.prototype.bind) {
/**
* Cross-browser approximation of ES5 Function.prototype.bind (not fully spec conforming)
* @see <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind">Function#bind on MDN</a>
* @param {Object} thisArg Object to bind function to
* @param {Any[]} [...] Values to pass to a bound function
* @return {Function}
*/
Function.prototype.bind = function(thisArg) {
var fn = this, args = slice.call(arguments, 1), bound;
if (args.length) {
bound = function() {
return apply.call(fn, this instanceof Dummy ? this : thisArg, args.concat(slice.call(arguments)));
};
}
else {
/** @ignore */
bound = function() {
return apply.call(fn, this instanceof Dummy ? this : thisArg, arguments);
};
}
Dummy.prototype = this.prototype;
bound.prototype = new Dummy();
return bound;
};
}
})();
/* _ES5_COMPAT_END_ */
(function() {
var slice = Array.prototype.slice, emptyFunction = function() { };
var IS_DONTENUM_BUGGY = (function(){
for (var p in { toString: 1 }) {
if (p === 'toString') return false;
}
return true;
})();
/** @ignore */
var addMethods = function(klass, source, parent) {
for (var property in source) {
if (property in klass.prototype &&
typeof klass.prototype[property] === 'function' &&
(source[property] + '').indexOf('callSuper') > -1) {
klass.prototype[property] = (function(property) {
return function() {
var superclass = this.constructor.superclass;
this.constructor.superclass = parent;
var returnValue = source[property].apply(this, arguments);
this.constructor.superclass = superclass;
if (property !== 'initialize') {
return returnValue;
}
};
})(property);
}
else {
klass.prototype[property] = source[property];
}
if (IS_DONTENUM_BUGGY) {
if (source.toString !== Object.prototype.toString) {
klass.prototype.toString = source.toString;
}
if (source.valueOf !== Object.prototype.valueOf) {
klass.prototype.valueOf = source.valueOf;
}
}
}
};
function Subclass() { }
function callSuper(methodName) {
var fn = this.constructor.superclass.prototype[methodName];
return (arguments.length > 1)
? fn.apply(this, slice.call(arguments, 1))
: fn.call(this);
}
/**
* Helper for creation of "classes".
* @memberOf fabric.util
* @param parent optional "Class" to inherit from
* @param properties Properties shared by all instances of this class
*                  (be careful modifying objects defined here as this would affect all instances)
*/
function createClass() {
var parent = null,
properties = slice.call(arguments, 0);
if (typeof properties[0] === 'function') {
parent = properties.shift();
}
function klass() {
this.initialize.apply(this, arguments);
}
klass.superclass = parent;
klass.subclasses = [ ];
if (parent) {
Subclass.prototype = parent.prototype;
klass.prototype = new Subclass();
parent.subclasses.push(klass);
}
for (var i = 0, length = properties.length; i < length; i++) {
addMethods(klass, properties[i], parent);
}
if (!klass.prototype.initialize) {
klass.prototype.initialize = emptyFunction;
}
klass.prototype.constructor = klass;
klass.prototype.callSuper = callSuper;
return klass;
}
fabric.util.createClass = createClass;
})();
(function () {
var unknown = 'unknown';
/* EVENT HANDLING */
function areHostMethods(object) {
var methodNames = Array.prototype.slice.call(arguments, 1),
t, i, len = methodNames.length;
for (i = 0; i < len; i++) {
t = typeof object[methodNames[i]];
if (!(/^(?:function|object|unknown)$/).test(t)) return false;
}
return true;
}
var getUniqueId = (function () {
var uid = 0;
return function (element) {
return element.__uniqueID || (element.__uniqueID = 'uniqueID__' + uid++);
};
})();
/** @ignore */
var getElement, setElement;
(function () {
var elements = { };
/** @ignore */
getElement = function (uid) {
return elements[uid];
};
/** @ignore */
setElement = function (uid, element) {
elements[uid] = element;
};
})();
function createListener(uid, handler) {
return {
handler: handler,
wrappedHandler: createWrappedHandler(uid, handler)
};
}
function createWrappedHandler(uid, handler) {
return function (e) {
handler.call(getElement(uid), e || fabric.window.event);
};
}
function createDispatcher(uid, eventName) {
return function (e) {
if (handlers[uid] && handlers[uid][eventName]) {
var handlersForEvent = handlers[uid][eventName];
for (var i = 0, len = handlersForEvent.length; i < len; i++) {
handlersForEvent[i].call(this, e || fabric.window.event);
}
}
};
}
var shouldUseAddListenerRemoveListener = (
areHostMethods(fabric.document.documentElement, 'addEventListener', 'removeEventListener') &&
areHostMethods(fabric.window, 'addEventListener', 'removeEventListener')),
shouldUseAttachEventDetachEvent = (
areHostMethods(fabric.document.documentElement, 'attachEvent', 'detachEvent') &&
areHostMethods(fabric.window, 'attachEvent', 'detachEvent')),
listeners = { },
handlers = { },
addListener, removeListener;
if (shouldUseAddListenerRemoveListener) {
/** @ignore */
addListener = function (element, eventName, handler) {
element.addEventListener(eventName, handler, false);
};
/** @ignore */
removeListener = function (element, eventName, handler) {
element.removeEventListener(eventName, handler, false);
};
}
else if (shouldUseAttachEventDetachEvent) {
/** @ignore */
addListener = function (element, eventName, handler) {
var uid = getUniqueId(element);
setElement(uid, element);
if (!listeners[uid]) {
listeners[uid] = { };
}
if (!listeners[uid][eventName]) {
listeners[uid][eventName] = [ ];
}
var listener = createListener(uid, handler);
listeners[uid][eventName].push(listener);
element.attachEvent('on' + eventName, listener.wrappedHandler);
};
/** @ignore */
removeListener = function (element, eventName, handler) {
var uid = getUniqueId(element), listener;
if (listeners[uid] && listeners[uid][eventName]) {
for (var i = 0, len = listeners[uid][eventName].length; i < len; i++) {
listener = listeners[uid][eventName][i];
if (listener && listener.handler === handler) {
element.detachEvent('on' + eventName, listener.wrappedHandler);
listeners[uid][eventName][i] = null;
}
}
}
};
}
else {
/** @ignore */
addListener = function (element, eventName, handler) {
var uid = getUniqueId(element);
if (!handlers[uid]) {
handlers[uid] = { };
}
if (!handlers[uid][eventName]) {
handlers[uid][eventName] = [ ];
var existingHandler = element['on' + eventName];
if (existingHandler) {
handlers[uid][eventName].push(existingHandler);
}
element['on' + eventName] = createDispatcher(uid, eventName);
}
handlers[uid][eventName].push(handler);
};
/** @ignore */
removeListener = function (element, eventName, handler) {
var uid = getUniqueId(element);
if (handlers[uid] && handlers[uid][eventName]) {
var handlersForEvent = handlers[uid][eventName];
for (var i = 0, len = handlersForEvent.length; i < len; i++) {
if (handlersForEvent[i] === handler) {
handlersForEvent.splice(i, 1);
}
}
}
};
}
/**
* Adds an event listener to an element
* @function
* @memberOf fabric.util
* @param {HTMLElement} element
* @param {String} eventName
* @param {Function} handler
*/
fabric.util.addListener = addListener;
/**
* Removes an event listener from an element
* @function
* @memberOf fabric.util
* @param {HTMLElement} element
* @param {String} eventName
* @param {Function} handler
*/
fabric.util.removeListener = removeListener;
/**
* Cross-browser wrapper for getting event's coordinates
* @memberOf fabric.util
* @param {Event} event Event object
* @param {HTMLCanvasElement} upperCanvasEl &lt;canvas> element on which object selection is drawn
*/
function getPointer(event, upperCanvasEl) {
event || (event = fabric.window.event);
var element = event.target ||
(typeof event.srcElement !== unknown ? event.srcElement : null);
var scroll = fabric.util.getScrollLeftTop(element, upperCanvasEl);
return {
x: pointerX(event) + scroll.left,
y: pointerY(event) + scroll.top
};
}
var pointerX = function(event) {
return (typeof event.clientX !== unknown ? event.clientX : 0);
};
var pointerY = function(event) {
return (typeof event.clientY !== unknown ? event.clientY : 0);
};
function _getPointer(event, pageProp, clientProp) {
var touchProp = event.type === 'touchend' ? 'changedTouches' : 'touches';
return (event[touchProp] && event[touchProp][0]
? (event[touchProp][0][pageProp] - (event[touchProp][0][pageProp] - event[touchProp][0][clientProp]))
|| event[clientProp]
: event[clientProp]);
}
if (fabric.isTouchSupported) {
pointerX = function(event) {
return _getPointer(event, 'pageX', 'clientX');
};
pointerY = function(event) {
return _getPointer(event, 'pageY', 'clientY');
};
}
fabric.util.getPointer = getPointer;
fabric.util.object.extend(fabric.util, fabric.Observable);
})();
(function () {
/**
* Cross-browser wrapper for setting element's style
* @memberOf fabric.util
* @param {HTMLElement} element
* @param {Object} styles
* @return {HTMLElement} Element that was passed as a first argument
*/
function setStyle(element, styles) {
var elementStyle = element.style;
if (!elementStyle) {
return element;
}
if (typeof styles === 'string') {
element.style.cssText += ';' + styles;
return styles.indexOf('opacity') > -1
? setOpacity(element, styles.match(/opacity:\s*(\d?\.?\d*)/)[1])
: element;
}
for (var property in styles) {
if (property === 'opacity') {
setOpacity(element, styles[property]);
}
else {
var normalizedProperty = (property === 'float' || property === 'cssFloat')
? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')
: property;
elementStyle[normalizedProperty] = styles[property];
}
}
return element;
}
var parseEl = fabric.document.createElement('div'),
supportsOpacity = typeof parseEl.style.opacity === 'string',
supportsFilters = typeof parseEl.style.filter === 'string',
reOpacity = /alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,
/** @ignore */
setOpacity = function (element) { return element; };
if (supportsOpacity) {
/** @ignore */
setOpacity = function(element, value) {
element.style.opacity = value;
return element;
};
}
else if (supportsFilters) {
/** @ignore */
setOpacity = function(element, value) {
var es = element.style;
if (element.currentStyle && !element.currentStyle.hasLayout) {
es.zoom = 1;
}
if (reOpacity.test(es.filter)) {
value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');
es.filter = es.filter.replace(reOpacity, value);
}
else {
es.filter += ' alpha(opacity=' + (value * 100) + ')';
}
return element;
};
}
fabric.util.setStyle = setStyle;
})();
(function() {
var _slice = Array.prototype.slice;
/**
* Takes id and returns an element with that id (if one exists in a document)
* @memberOf fabric.util
* @param {String|HTMLElement} id
* @return {HTMLElement|null}
*/
function getById(id) {
return typeof id === 'string' ? fabric.document.getElementById(id) : id;
}
/**
* Converts an array-like object (e.g. arguments or NodeList) to an array
* @memberOf fabric.util
* @param {Object} arrayLike
* @return {Array}
*/
var toArray = function(arrayLike) {
return _slice.call(arrayLike, 0);
};
var sliceCanConvertNodelists;
try {
sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;
}
catch(err) { }
if (!sliceCanConvertNodelists) {
toArray = function(arrayLike) {
var arr = new Array(arrayLike.length), i = arrayLike.length;
while (i--) {
arr[i] = arrayLike[i];
}
return arr;
};
}
/**
* Creates specified element with specified attributes
* @memberOf fabric.util
* @param {String} tagName Type of an element to create
* @param {Object} [attributes] Attributes to set on an element
* @return {HTMLElement} Newly created element
*/
function makeElement(tagName, attributes) {
var el = fabric.document.createElement(tagName);
for (var prop in attributes) {
if (prop === 'class') {
el.className = attributes[prop];
}
else if (prop === 'for') {
el.htmlFor = attributes[prop];
}
else {
el.setAttribute(prop, attributes[prop]);
}
}
return el;
}
/**
* Adds class to an element
* @memberOf fabric.util
* @param {HTMLElement} element Element to add class to
* @param {String} className Class to add to an element
*/
function addClass(element, className) {
if ((' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {
element.className += (element.className ? ' ' : '') + className;
}
}
/**
* Wraps element with another element
* @memberOf fabric.util
* @param {HTMLElement} element Element to wrap
* @param {HTMLElement|String} wrapper Element to wrap with
* @param {Object} [attributes] Attributes to set on a wrapper
* @return {HTMLElement} wrapper
*/
function wrapElement(element, wrapper, attributes) {
if (typeof wrapper === 'string') {
wrapper = makeElement(wrapper, attributes);
}
if (element.parentNode) {
element.parentNode.replaceChild(wrapper, element);
}
wrapper.appendChild(element);
return wrapper;
}
function getScrollLeftTop(element, upperCanvasEl) {
var firstFixedAncestor,
origElement,
left = 0,
top = 0,
docElement = fabric.document.documentElement,
body = fabric.document.body || {
scrollLeft: 0, scrollTop: 0
};
origElement = element;
while (element && element.parentNode && !firstFixedAncestor) {
element = element.parentNode;
if (element !== fabric.document &&
fabric.util.getElementStyle(element, 'position') === 'fixed') {
firstFixedAncestor = element;
}
if (element !== fabric.document &&
origElement !== upperCanvasEl &&
fabric.util.getElementStyle(element, 'position') === 'absolute') {
left = 0;
top = 0;
}
else if (element === fabric.document) {
left = window.scrollLeft || body.scrollLeft || docElement.scrollLeft || 0;
top = window.scrollTop || body.scrollTop  || docElement.scrollTop  || 0;
left += element.scrollLeft || 0;
top += element.scrollTop || 0;
}
else {
left += element.scrollLeft || 0;
top += element.scrollTop || 0;
}
}
return { left: left, top: top };
}
/**
* Returns offset for a given element
* @function
* @memberOf fabric.util
* @param {HTMLElement} element Element to get offset for
* @return {Object} Object with "left" and "top" properties
*/
function getElementOffset(element) {
var docElem,
box = {left: 0, top: 0},
doc = element && element.ownerDocument,
offset = {left: 0, top: 0},
scrollLeftTop,
offsetAttributes = {
'borderLeftWidth': 'left',
'borderTopWidth':  'top',
'paddingLeft':     'left',
'paddingTop':      'top'
};
if (!doc){
return {left: 0, top: 0};
}
for (var attr in offsetAttributes) {
offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;
}
docElem = doc.documentElement;
if ( typeof element.getBoundingClientRect !== "undefined" ) {
box = element.getBoundingClientRect();
}
scrollLeftTop = fabric.util.getScrollLeftTop(element, null);
return {
left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,
top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top
};
}
/**
* Returns style attribute value of a given element
* @memberOf fabric.util
* @param {HTMLElement} element Element to get style attribute for
* @param {String} attr Style attribute to get for element
* @return {String} Style attribute value of the given element.
*/
function getElementStyle(element, attr) {
if (!element.style) {
element.style = { };
}
if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {
return fabric.document.defaultView.getComputedStyle(element, null)[attr];
}
else {
var value = element.style[attr];
if (!value && element.currentStyle) value = element.currentStyle[attr];
return value;
}
}
(function () {
var style = fabric.document.documentElement.style;
var selectProp = 'userSelect' in style
? 'userSelect'
: 'MozUserSelect' in style
? 'MozUserSelect'
: 'WebkitUserSelect' in style
? 'WebkitUserSelect'
: 'KhtmlUserSelect' in style
? 'KhtmlUserSelect'
: '';
/**
* Makes element unselectable
* @memberOf fabric.util
* @param {HTMLElement} element Element to make unselectable
* @return {HTMLElement} Element that was passed in
*/
function makeElementUnselectable(element) {
if (typeof element.onselectstart !== 'undefined') {
element.onselectstart = fabric.util.falseFunction;
}
if (selectProp) {
element.style[selectProp] = 'none';
}
else if (typeof element.unselectable === 'string') {
element.unselectable = 'on';
}
return element;
}
/**
* Makes element selectable
* @memberOf fabric.util
* @param {HTMLElement} element Element to make selectable
* @return {HTMLElement} Element that was passed in
*/
function makeElementSelectable(element) {
if (typeof element.onselectstart !== 'undefined') {
element.onselectstart = null;
}
if (selectProp) {
element.style[selectProp] = '';
}
else if (typeof element.unselectable === 'string') {
element.unselectable = '';
}
return element;
}
fabric.util.makeElementUnselectable = makeElementUnselectable;
fabric.util.makeElementSelectable = makeElementSelectable;
})();
(function() {
/**
* Inserts a script element with a given url into a document; invokes callback, when that script is finished loading
* @memberOf fabric.util
* @param {String} url URL of a script to load
* @param {Function} callback Callback to execute when script is finished loading
*/
function getScript(url, callback) {
var headEl = fabric.document.getElementsByTagName("head")[0],
scriptEl = fabric.document.createElement('script'),
loading = true;
/** @ignore */
scriptEl.onload = /** @ignore */ scriptEl.onreadystatechange = function(e) {
if (loading) {
if (typeof this.readyState === 'string' &&
this.readyState !== 'loaded' &&
this.readyState !== 'complete') return;
loading = false;
callback(e || fabric.window.event);
scriptEl = scriptEl.onload = scriptEl.onreadystatechange = null;
}
};
scriptEl.src = url;
headEl.appendChild(scriptEl);
}
fabric.util.getScript = getScript;
})();
fabric.util.getById = getById;
fabric.util.toArray = toArray;
fabric.util.makeElement = makeElement;
fabric.util.addClass = addClass;
fabric.util.wrapElement = wrapElement;
fabric.util.getScrollLeftTop = getScrollLeftTop;
fabric.util.getElementOffset = getElementOffset;
fabric.util.getElementStyle = getElementStyle;
})();
(function(){
function addParamToUrl(url, param) {
return url + (/\?/.test(url) ? '&' : '?') + param;
}
var makeXHR = (function() {
var factories = [
function() { return new ActiveXObject("Microsoft.XMLHTTP"); },
function() { return new ActiveXObject("Msxml2.XMLHTTP"); },
function() { return new ActiveXObject("Msxml2.XMLHTTP.3.0"); },
function() { return new XMLHttpRequest(); }
];
for (var i = factories.length; i--; ) {
try {
var req = factories[i]();
if (req) {
return factories[i];
}
}
catch (err) { }
}
})();
function emptyFn() { }
/**
* Cross-browser abstraction for sending XMLHttpRequest
* @memberOf fabric.util
* @param {String} url URL to send XMLHttpRequest to
* @param {Object} [options] Options object
* @param {String} [options.method="GET"]
* @param {Function} options.onComplete Callback to invoke when request is completed
* @return {XMLHttpRequest} request
*/
function request(url, options) {
options || (options = { });
var method = options.method ? options.method.toUpperCase() : 'GET',
onComplete = options.onComplete || function() { },
xhr = makeXHR(),
body;
/** @ignore */
xhr.onreadystatechange = function() {
if (xhr.readyState === 4) {
onComplete(xhr);
xhr.onreadystatechange = emptyFn;
}
};
if (method === 'GET') {
body = null;
if (typeof options.parameters === 'string') {
url = addParamToUrl(url, options.parameters);
}
}
xhr.open(method, url, true);
if (method === 'POST' || method === 'PUT') {
xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
}
xhr.send(body);
return xhr;
}
fabric.util.request = request;
})();
/**
* Wrapper around `console.log` (when available)
* @param {Any} values Values to log
*/
fabric.log = function() { };
/**
* Wrapper around `console.warn` (when available)
* @param {Any} Values to log as a warning
*/
fabric.warn = function() { };
if (typeof console !== 'undefined') {
['log', 'warn'].forEach(function(methodName) {
if (typeof console[methodName] !== 'undefined' && console[methodName].apply) {
fabric[methodName] = function() {
return console[methodName].apply(console, arguments);
};
}
});
}
(function() {
/**
* Changes value from one to another within certain period of time, invoking callbacks as value is being changed.
* @memberOf fabric.util
* @param {Object} [options] Animation options
* @param {Function} [options.onChange] Callback; invoked on every value change
* @param {Function} [options.onComplete] Callback; invoked when value change is completed
* @param {Number} [options.startValue=0] Starting value
* @param {Number} [options.endValue=100] Ending value
* @param {Number} [options.byValue=100] Value to modify the property by
* @param {Function} [options.easing] Easing function
* @param {Number} [options.duration=500] Duration of change
*/
function animate(options) {
requestAnimFrame(function(timestamp) {
options || (options = { });
var start = timestamp || +new Date(),
duration = options.duration || 500,
finish = start + duration, time,
onChange = options.onChange || function() { },
abort = options.abort || function() { return false; },
easing = options.easing || function(t, b, c, d) {return -c * Math.cos(t/d * (Math.PI/2)) + c + b;},
startValue = 'startValue' in options ? options.startValue : 0,
endValue = 'endValue' in options ? options.endValue : 100,
byValue = options.byValue || endValue - startValue;
options.onStart && options.onStart();
(function tick(ticktime) {
time = ticktime || +new Date();
var currentTime = time > finish ? duration : (time - start);
if (abort()) {
options.onComplete && options.onComplete();
return;
}
onChange(easing(currentTime, startValue, byValue, duration));
if (time > finish) {
options.onComplete && options.onComplete();
return;
}
requestAnimFrame(tick);
})(start);
});
}
var _requestAnimFrame = fabric.window.requestAnimationFrame       ||
fabric.window.webkitRequestAnimationFrame ||
fabric.window.mozRequestAnimationFrame    ||
fabric.window.oRequestAnimationFrame      ||
fabric.window.msRequestAnimationFrame     ||
function(callback) {
fabric.window.setTimeout(callback, 1000 / 60);
};
/**
* requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/
* In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method
* @memberOf fabric.util
* @param {Function} callback Callback to invoke
* @param {DOMElement} element optional Element to associate with animation
*/
var requestAnimFrame = function() {
return _requestAnimFrame.apply(fabric.window, arguments);
};
fabric.util.animate = animate;
fabric.util.requestAnimFrame = requestAnimFrame;
})();
(function() {
function normalize(a, c, p, s) {
if (a < Math.abs(c)) { a=c; s=p/4; }
else s = p/(2*Math.PI) * Math.asin (c/a);
return { a: a, c: c, p: p, s: s };
}
function elastic(opts, t, d) {
return opts.a *
Math.pow(2, 10 * (t -= 1)) *
Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );
}
/**
* Cubic easing out
* @memberOf fabric.util.ease
*/
function easeOutCubic(t, b, c, d) {
return c*((t=t/d-1)*t*t + 1) + b;
}
/**
* Cubic easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutCubic(t, b, c, d) {
t /= d/2;
if (t < 1) return c/2*t*t*t + b;
return c/2*((t-=2)*t*t + 2) + b;
}
/**
* Quartic easing in
* @memberOf fabric.util.ease
*/
function easeInQuart(t, b, c, d) {
return c*(t/=d)*t*t*t + b;
}
/**
* Quartic easing out
* @memberOf fabric.util.ease
*/
function easeOutQuart(t, b, c, d) {
return -c * ((t=t/d-1)*t*t*t - 1) + b;
}
/**
* Quartic easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutQuart(t, b, c, d) {
t /= d/2;
if (t < 1) return c/2*t*t*t*t + b;
return -c/2 * ((t-=2)*t*t*t - 2) + b;
}
/**
* Quintic easing in
* @memberOf fabric.util.ease
*/
function easeInQuint(t, b, c, d) {
return c*(t/=d)*t*t*t*t + b;
}
/**
* Quintic easing out
* @memberOf fabric.util.ease
*/
function easeOutQuint(t, b, c, d) {
return c*((t=t/d-1)*t*t*t*t + 1) + b;
}
/**
* Quintic easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutQuint(t, b, c, d) {
t /= d/2;
if (t < 1) return c/2*t*t*t*t*t + b;
return c/2*((t-=2)*t*t*t*t + 2) + b;
}
/**
* Sinusoidal easing in
* @memberOf fabric.util.ease
*/
function easeInSine(t, b, c, d) {
return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
}
/**
* Sinusoidal easing out
* @memberOf fabric.util.ease
*/
function easeOutSine(t, b, c, d) {
return c * Math.sin(t/d * (Math.PI/2)) + b;
}
/**
* Sinusoidal easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutSine(t, b, c, d) {
return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
}
/**
* Exponential easing in
* @memberOf fabric.util.ease
*/
function easeInExpo(t, b, c, d) {
return (t===0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
}
/**
* Exponential easing out
* @memberOf fabric.util.ease
*/
function easeOutExpo(t, b, c, d) {
return (t===d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
}
/**
* Exponential easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutExpo(t, b, c, d) {
if (t===0) return b;
if (t===d) return b+c;
t /= d/2;
if (t < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
}
/**
* Circular easing in
* @memberOf fabric.util.ease
*/
function easeInCirc(t, b, c, d) {
return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
}
/**
* Circular easing out
* @memberOf fabric.util.ease
*/
function easeOutCirc(t, b, c, d) {
return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
}
/**
* Circular easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutCirc(t, b, c, d) {
t /= d/2;
if (t < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
}
/**
* Elastic easing in
* @memberOf fabric.util.ease
*/
function easeInElastic(t, b, c, d) {
var s=1.70158;var p=0;var a=c;
if (t===0) return b;
t /= d;
if (t===1) return b+c;
if (!p) p=d*0.3;
var opts = normalize(a, c, p, s);
return -elastic(opts, t, d) + b;
}
/**
* Elastic easing out
* @memberOf fabric.util.ease
*/
function easeOutElastic(t, b, c, d) {
var s=1.70158;var p=0;var a=c;
if (t===0) return b;
t /= d;
if (t===1) return b+c;
if (!p) p=d*0.3;
var opts = normalize(a, c, p, s);
return opts.a*Math.pow(2,-10*t) * Math.sin( (t*d-opts.s)*(2*Math.PI)/opts.p ) + opts.c + b;
}
/**
* Elastic easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutElastic(t, b, c, d) {
var s=1.70158;var p=0;var a=c;
if (t===0) return b;
t /= d/2;
if (t===2) return b+c;
if (!p) p=d*(0.3*1.5);
var opts = normalize(a, c, p, s);
if (t < 1) return -0.5 * elastic(opts, t, d) + b;
return opts.a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-opts.s)*(2*Math.PI)/opts.p )*0.5 + opts.c + b;
}
/**
* Backwards easing in
* @memberOf fabric.util.ease
*/
function easeInBack(t, b, c, d, s) {
if (s === undefined) s = 1.70158;
return c*(t/=d)*t*((s+1)*t - s) + b;
}
/**
* Backwards easing out
* @memberOf fabric.util.ease
*/
function easeOutBack(t, b, c, d, s) {
if (s === undefined) s = 1.70158;
return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
}
/**
* Backwards easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutBack(t, b, c, d, s) {
if (s === undefined) s = 1.70158;
t /= d/2;
if (t < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
}
/**
* Bouncing easing in
* @memberOf fabric.util.ease
*/
function easeInBounce(t, b, c, d) {
return c - easeOutBounce (d-t, 0, c, d) + b;
}
/**
* Bouncing easing out
* @memberOf fabric.util.ease
*/
function easeOutBounce(t, b, c, d) {
if ((t/=d) < (1/2.75)) {
return c*(7.5625*t*t) + b;
} else if (t < (2/2.75)) {
return c*(7.5625*(t-=(1.5/2.75))*t + 0.75) + b;
} else if (t < (2.5/2.75)) {
return c*(7.5625*(t-=(2.25/2.75))*t + 0.9375) + b;
} else {
return c*(7.5625*(t-=(2.625/2.75))*t + 0.984375) + b;
}
}
/**
* Bouncing easing in and out
* @memberOf fabric.util.ease
*/
function easeInOutBounce(t, b, c, d) {
if (t < d/2) return easeInBounce (t*2, 0, c, d) * 0.5 + b;
return easeOutBounce (t*2-d, 0, c, d) * 0.5 + c*0.5 + b;
}
/**
* Easing functions
* See <a href="http://gizma.com/easing/">Easing Equations by Robert Penner</a>
* @namespace fabric.util.ease
*/
fabric.util.ease = {
/**
* Quadratic easing in
* @memberOf fabric.util.ease
*/
easeInQuad: function(t, b, c, d) {
return c*(t/=d)*t + b;
},
/**
* Quadratic easing out
* @memberOf fabric.util.ease
*/
easeOutQuad: function(t, b, c, d) {
return -c *(t/=d)*(t-2) + b;
},
/**
* Quadratic easing in and out
* @memberOf fabric.util.ease
*/
easeInOutQuad: function(t, b, c, d) {
t /= (d/2);
if (t < 1) return c/2*t*t + b;
return -c/2 * ((--t)*(t-2) - 1) + b;
},
/**
* Cubic easing in
* @memberOf fabric.util.ease
*/
easeInCubic: function(t, b, c, d) {
return c*(t/=d)*t*t + b;
},
easeOutCubic: easeOutCubic,
easeInOutCubic: easeInOutCubic,
easeInQuart: easeInQuart,
easeOutQuart: easeOutQuart,
easeInOutQuart: easeInOutQuart,
easeInQuint: easeInQuint,
easeOutQuint: easeOutQuint,
easeInOutQuint: easeInOutQuint,
easeInSine: easeInSine,
easeOutSine: easeOutSine,
easeInOutSine: easeInOutSine,
easeInExpo: easeInExpo,
easeOutExpo: easeOutExpo,
easeInOutExpo: easeInOutExpo,
easeInCirc: easeInCirc,
easeOutCirc: easeOutCirc,
easeInOutCirc: easeInOutCirc,
easeInElastic: easeInElastic,
easeOutElastic: easeOutElastic,
easeInOutElastic: easeInOutElastic,
easeInBack: easeInBack,
easeOutBack: easeOutBack,
easeInOutBack: easeInOutBack,
easeInBounce: easeInBounce,
easeOutBounce: easeOutBounce,
easeInOutBounce: easeInOutBounce
};
}());
(function(global) {
"use strict";
/**
* @name fabric
* @namespace
*/
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
capitalize = fabric.util.string.capitalize,
clone = fabric.util.object.clone,
toFixed = fabric.util.toFixed,
multiplyTransformMatrices = fabric.util.multiplyTransformMatrices;
var attributesMap = {
'fill-opacity':     'fillOpacity',
'fill-rule':        'fillRule',
'font-family':      'fontFamily',
'font-size':        'fontSize',
'font-style':       'fontStyle',
'font-weight':      'fontWeight',
'cx':               'left',
'x':                'left',
'r':                'radius',
'stroke-dasharray': 'strokeDashArray',
'stroke-linecap':   'strokeLineCap',
'stroke-linejoin':  'strokeLineJoin',
'stroke-miterlimit':'strokeMiterLimit',
'stroke-opacity':   'strokeOpacity',
'stroke-width':     'strokeWidth',
'text-decoration':  'textDecoration',
'cy':               'top',
'y':                'top',
'transform':        'transformMatrix'
};
var colorAttributes = {
'stroke': 'strokeOpacity',
'fill':   'fillOpacity'
};
function normalizeAttr(attr) {
if (attr in attributesMap) {
return attributesMap[attr];
}
return attr;
}
function normalizeValue(attr, value, parentAttributes) {
var isArray;
if ((attr === 'fill' || attr === 'stroke') && value === 'none') {
value = '';
}
else if (attr === 'fillRule') {
value = (value === 'evenodd') ? 'destination-over' : value;
}
else if (attr === 'strokeDashArray') {
value = value.replace(/,/g, ' ').split(/\s+/);
}
else if (attr === 'transformMatrix') {
if (parentAttributes && parentAttributes.transformMatrix) {
value = multiplyTransformMatrices(
parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));
}
else {
value = fabric.parseTransformAttribute(value);
}
}
isArray = Object.prototype.toString.call(value) === '[object Array]';
var parsed = isArray ? value.map(parseFloat) : parseFloat(value);
return (!isArray && isNaN(parsed) ? value : parsed);
}
/**
* @private
* @param {Object} attributes Array of attributes to parse
*/
function _setStrokeFillOpacity(attributes) {
for (var attr in colorAttributes) {
if (!attributes[attr] || typeof attributes[colorAttributes[attr]] === 'undefined') continue;
if (attributes[attr].indexOf('url(') === 0) continue;
var color = new fabric.Color(attributes[attr]);
attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();
delete attributes[colorAttributes[attr]];
}
return attributes;
}
/**
* Parses "transform" attribute, returning an array of values
* @static
* @function
* @memberOf fabric
* @param {String} attributeValue String containing attribute value
* @return {Array} Array of 6 elements representing transformation matrix
*/
fabric.parseTransformAttribute = (function() {
function rotateMatrix(matrix, args) {
var angle = args[0];
matrix[0] = Math.cos(angle);
matrix[1] = Math.sin(angle);
matrix[2] = -Math.sin(angle);
matrix[3] = Math.cos(angle);
}
function scaleMatrix(matrix, args) {
var multiplierX = args[0],
multiplierY = (args.length === 2) ? args[1] : args[0];
matrix[0] = multiplierX;
matrix[3] = multiplierY;
}
function skewXMatrix(matrix, args) {
matrix[2] = args[0];
}
function skewYMatrix(matrix, args) {
matrix[1] = args[0];
}
function translateMatrix(matrix, args) {
matrix[4] = args[0];
if (args.length === 2) {
matrix[5] = args[1];
}
}
var iMatrix = [
1, // a
0, // b
0, // c
1, // d
0, // e
0  // f
],
number = '(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)',
comma_wsp = '(?:\\s+,?\\s*|,\\s*)',
skewX = '(?:(skewX)\\s*\\(\\s*(' + number + ')\\s*\\))',
skewY = '(?:(skewY)\\s*\\(\\s*(' + number + ')\\s*\\))',
rotate = '(?:(rotate)\\s*\\(\\s*(' + number + ')(?:' +
comma_wsp + '(' + number + ')' +
comma_wsp + '(' + number + '))?\\s*\\))',
scale = '(?:(scale)\\s*\\(\\s*(' + number + ')(?:' +
comma_wsp + '(' + number + '))?\\s*\\))',
translate = '(?:(translate)\\s*\\(\\s*(' + number + ')(?:' +
comma_wsp + '(' + number + '))?\\s*\\))',
matrix = '(?:(matrix)\\s*\\(\\s*' +
'(' + number + ')' + comma_wsp +
'(' + number + ')' + comma_wsp +
'(' + number + ')' + comma_wsp +
'(' + number + ')' + comma_wsp +
'(' + number + ')' + comma_wsp +
'(' + number + ')' +
'\\s*\\))',
transform = '(?:' +
matrix + '|' +
translate + '|' +
scale + '|' +
rotate + '|' +
skewX + '|' +
skewY +
')',
transforms = '(?:' + transform + '(?:' + comma_wsp + transform + ')*' + ')',
transform_list = '^\\s*(?:' + transforms + '?)\\s*$',
reTransformList = new RegExp(transform_list),
reTransform = new RegExp(transform, 'g');
return function(attributeValue) {
var matrix = iMatrix.concat();
var matrices = [ ];
if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {
return matrix;
}
attributeValue.replace(reTransform, function(match) {
var m = new RegExp(transform).exec(match).filter(function (match) {
return (match !== '' && match != null);
}),
operation = m[1],
args = m.slice(2).map(parseFloat);
switch(operation) {
case 'translate':
translateMatrix(matrix, args);
break;
case 'rotate':
rotateMatrix(matrix, args);
break;
case 'scale':
scaleMatrix(matrix, args);
break;
case 'skewX':
skewXMatrix(matrix, args);
break;
case 'skewY':
skewYMatrix(matrix, args);
break;
case 'matrix':
matrix = args;
break;
}
matrices.push(matrix.concat());
matrix = iMatrix.concat();
});
var combinedMatrix = matrices[0];
while (matrices.length > 1) {
matrices.shift();
combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);
}
return combinedMatrix;
};
})();
function parseFontDeclaration(value, oStyle) {
var match = value.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);
if (!match) return;
var fontStyle = match[1];
var fontWeight = match[3];
var fontSize = match[4];
var lineHeight = match[5];
var fontFamily = match[6];
if (fontStyle) {
oStyle.fontStyle = fontStyle;
}
if (fontWeight) {
oStyle.fontSize = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);
}
if (fontSize) {
oStyle.fontSize = parseFloat(fontSize);
}
if (fontFamily) {
oStyle.fontFamily = fontFamily;
}
if (lineHeight) {
oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;
}
}
/**
* @private
*/
function parseStyleString(style, oStyle) {
var attr, value;
style.replace(/;$/, '').split(';').forEach(function (chunk) {
var pair = chunk.split(':');
attr = normalizeAttr(pair[0].trim().toLowerCase());
value = normalizeValue(attr, pair[1].trim());
if (attr === 'font') {
parseFontDeclaration(value, oStyle);
}
else {
oStyle[attr] = value;
}
});
}
/**
* @private
*/
function parseStyleObject(style, oStyle) {
var attr, value;
for (var prop in style) {
if (typeof style[prop] === 'undefined') continue;
attr = normalizeAttr(prop.toLowerCase());
value = normalizeValue(attr, style[prop]);
if (attr === 'font') {
parseFontDeclaration(value, oStyle);
}
else {
oStyle[attr] = value;
}
}
}
/**
* @private
*/
function getGlobalStylesForElement(element) {
var nodeName = element.nodeName,
className = element.getAttribute('class'),
id = element.getAttribute('id'),
styles = { };
for (var rule in fabric.cssRules) {
var ruleMatchesElement = (className && new RegExp('^\\.' + className).test(rule)) ||
(id && new RegExp('^#' + id).test(rule)) ||
(new RegExp('^' + nodeName).test(rule));
if (ruleMatchesElement) {
for (var property in fabric.cssRules[rule]) {
styles[property] = fabric.cssRules[rule][property];
}
}
}
return styles;
}
/**
* Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback
* @static
* @function
* @memberOf fabric
* @param {SVGDocument} doc SVG document to parse
* @param {Function} callback Callback to call when parsing is finished; It's being passed an array of elements (parsed from a document).
* @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.
*/
fabric.parseSVGDocument = (function() {
var reAllowedSVGTagNames = /^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/;
var reNum = '(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)';
var reViewBoxAttrValue = new RegExp(
'^' +
'\\s*(' + reNum + '+)\\s*,?' +
'\\s*(' + reNum + '+)\\s*,?' +
'\\s*(' + reNum + '+)\\s*,?' +
'\\s*(' + reNum + '+)\\s*' +
'$'
);
function hasAncestorWithNodeName(element, nodeName) {
while (element && (element = element.parentNode)) {
if (nodeName.test(element.nodeName)) {
return true;
}
}
return false;
}
return function(doc, callback, reviver) {
if (!doc) return;
var startTime = new Date(),
descendants = fabric.util.toArray(doc.getElementsByTagName('*'));
if (descendants.length === 0) {
descendants = doc.selectNodes("//*[name(.)!='svg']");
var arr = [ ];
for (var i = 0, len = descendants.length; i < len; i++) {
arr[i] = descendants[i];
}
descendants = arr;
}
var elements = descendants.filter(function(el) {
return reAllowedSVGTagNames.test(el.tagName) &&
!hasAncestorWithNodeName(el, /^(?:pattern|defs)$/); // http://www.w3.org/TR/SVG/struct.html#DefsElement
});
if (!elements || (elements && !elements.length)) return;
var viewBoxAttr = doc.getAttribute('viewBox'),
widthAttr = doc.getAttribute('width'),
heightAttr = doc.getAttribute('height'),
width = null,
height = null,
minX,
minY;
if (viewBoxAttr && (viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))) {
minX = parseInt(viewBoxAttr[1], 10);
minY = parseInt(viewBoxAttr[2], 10);
width = parseInt(viewBoxAttr[3], 10);
height = parseInt(viewBoxAttr[4], 10);
}
width = widthAttr ? parseFloat(widthAttr) : width;
height = heightAttr ? parseFloat(heightAttr) : height;
var options = {
width: width,
height: height
};
fabric.gradientDefs = fabric.getGradientDefs(doc);
fabric.cssRules = fabric.getCSSRules(doc);
fabric.parseElements(elements, function(instances) {
fabric.documentParsingTime = new Date() - startTime;
if (callback) {
callback(instances, options);
}
}, clone(options), reviver);
};
})();
/**
* Used for caching SVG documents (loaded via `fabric.Canvas#loadSVGFromURL`)
* @namespace
*/
var svgCache = {
/**
* @param {String} name
* @param {Function} callback
*/
has: function (name, callback) {
callback(false);
},
/**
* @param {String} url
* @param {Function} callback
*/
get: function () {
/* NOOP */
},
/**
* @param {String} url
* @param {Object} object
*/
set: function () {
/* NOOP */
}
};
/**
* @private
*/
function _enlivenCachedObject(cachedObject) {
var objects = cachedObject.objects,
options = cachedObject.options;
objects = objects.map(function (o) {
return fabric[capitalize(o.type)].fromObject(o);
});
return ({ objects: objects, options: options });
}
/**
* @private
*/
function _createSVGPattern(markup, canvas, property) {
if (canvas[property] && canvas[property].toSVG) {
markup.push(
'<pattern x="0" y="0" id="', property, 'Pattern" ',
'width="', canvas[property].source.width,
'" height="', canvas[property].source.height,
'" patternUnits="userSpaceOnUse">',
'<image x="0" y="0" ',
'width="', canvas[property].source.width,
'" height="', canvas[property].source.height,
'" xlink:href="', canvas[property].source.src,
'"></image></pattern>'
);
}
}
extend(fabric, {
/**
* Initializes gradients on instances, according to gradients parsed from a document
* @param {Array} instances
*/
resolveGradients: function(instances) {
for (var i = instances.length; i--; ) {
var instanceFillValue = instances[i].get('fill');
if (!(/^url\(/).test(instanceFillValue)) continue;
var gradientId = instanceFillValue.slice(5, instanceFillValue.length - 1);
if (fabric.gradientDefs[gradientId]) {
instances[i].set('fill',
fabric.Gradient.fromElement(fabric.gradientDefs[gradientId], instances[i]));
}
}
},
/**
* Parses an SVG document, returning all of the gradient declarations found in it
* @static
* @function
* @memberOf fabric
* @param {SVGDocument} doc SVG document to parse
* @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element
*/
getGradientDefs: function(doc) {
var linearGradientEls = doc.getElementsByTagName('linearGradient'),
radialGradientEls = doc.getElementsByTagName('radialGradient'),
el, i,
gradientDefs = { };
i = linearGradientEls.length;
for (; i--; ) {
el = linearGradientEls[i];
gradientDefs[el.getAttribute('id')] = el;
}
i = radialGradientEls.length;
for (; i--; ) {
el = radialGradientEls[i];
gradientDefs[el.getAttribute('id')] = el;
}
return gradientDefs;
},
/**
* Returns an object of attributes' name/value, given element and an array of attribute names;
* Parses parent "g" nodes recursively upwards.
* @static
* @memberOf fabric
* @param {DOMElement} element Element to parse
* @param {Array} attributes Array of attributes to parse
* @return {Object} object containing parsed attributes' names/values
*/
parseAttributes: function(element, attributes) {
if (!element) {
return;
}
var value,
parentAttributes = { };
if (element.parentNode && /^g$/i.test(element.parentNode.nodeName)) {
parentAttributes = fabric.parseAttributes(element.parentNode, attributes);
}
var ownAttributes = attributes.reduce(function(memo, attr) {
value = element.getAttribute(attr);
if (value) {
attr = normalizeAttr(attr);
value = normalizeValue(attr, value, parentAttributes);
memo[attr] = value;
}
return memo;
}, { });
ownAttributes = extend(ownAttributes,
extend(getGlobalStylesForElement(element), fabric.parseStyleAttribute(element)));
return _setStrokeFillOpacity(extend(parentAttributes, ownAttributes));
},
/**
* Transforms an array of svg elements to corresponding fabric.* instances
* @static
* @memberOf fabric
* @param {Array} elements Array of elements to parse
* @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)
* @param {Object} [options] Options object
* @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.
*/
parseElements: function(elements, callback, options, reviver) {
fabric.ElementsParser.parse(elements, callback, options, reviver);
},
/**
* Parses "style" attribute, retuning an object with values
* @static
* @memberOf fabric
* @param {SVGElement} element Element to parse
* @return {Object} Objects with values parsed from style attribute of an element
*/
parseStyleAttribute: function(element) {
var oStyle = { },
style = element.getAttribute('style');
if (!style) return oStyle;
if (typeof style === 'string') {
parseStyleString(style, oStyle);
}
else {
parseStyleObject(style, oStyle);
}
return oStyle;
},
/**
* Parses "points" attribute, returning an array of values
* @static
* @memberOf fabric
* @param points {String} points attribute string
* @return {Array} array of points
*/
parsePointsAttribute: function(points) {
if (!points) return null;
points = points.trim();
var asPairs = points.indexOf(',') > -1;
points = points.split(/\s+/);
var parsedPoints = [ ], i, len;
if (asPairs) {
i = 0;
len = points.length;
for (; i < len; i++) {
var pair = points[i].split(',');
parsedPoints.push({ x: parseFloat(pair[0]), y: parseFloat(pair[1]) });
}
}
else {
i = 0;
len = points.length;
for (; i < len; i+=2) {
parsedPoints.push({ x: parseFloat(points[i]), y: parseFloat(points[i+1]) });
}
}
if (parsedPoints.length % 2 !== 0) {
}
return parsedPoints;
},
/**
* Returns CSS rules for a given SVG document
* @static
* @function
* @memberOf fabric
* @param {SVGDocument} doc SVG document to parse
* @return {Object} CSS rules of this document
*/
getCSSRules: function(doc) {
var styles = doc.getElementsByTagName('style'),
allRules = { },
rules;
for (var i = 0, len = styles.length; i < len; i++) {
var styleContents = styles[0].textContent;
styleContents = styleContents.replace(/\/\*[\s\S]*?\*\//g, '');
rules = styleContents.match(/[^{]*\{[\s\S]*?\}/g);
rules = rules.map(function(rule) { return rule.trim(); });
rules.forEach(function(rule) {
var match = rule.match(/([\s\S]*?)\s*\{([^}]*)\}/);
rule = match[1];
var declaration = match[2].trim(),
propertyValuePairs = declaration.replace(/;$/, '').split(/\s*;\s*/);
if (!allRules[rule]) {
allRules[rule] = { };
}
for (var i = 0, len = propertyValuePairs.length; i < len; i++) {
var pair = propertyValuePairs[i].split(/\s*:\s*/),
property = pair[0],
value = pair[1];
allRules[rule][property] = value;
}
});
}
return allRules;
},
/**
* Takes url corresponding to an SVG document, and parses it into a set of fabric objects. Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)
* @memberof fabric
* @param {String} url
* @param {Function} callback
* @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.
*/
loadSVGFromURL: function(url, callback, reviver) {
url = url.replace(/^\n\s*/, '').trim();
svgCache.has(url, function (hasUrl) {
if (hasUrl) {
svgCache.get(url, function (value) {
var enlivedRecord = _enlivenCachedObject(value);
callback(enlivedRecord.objects, enlivedRecord.options);
});
}
else {
new fabric.util.request(url, {
method: 'get',
onComplete: onComplete
});
}
});
function onComplete(r) {
var xml = r.responseXML;
if (!xml.documentElement && fabric.window.ActiveXObject && r.responseText) {
xml = new ActiveXObject('Microsoft.XMLDOM');
xml.async = 'false';
xml.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,''));
}
if (!xml.documentElement) return;
fabric.parseSVGDocument(xml.documentElement, function (results, options) {
svgCache.set(url, {
objects: fabric.util.array.invoke(results, 'toObject'),
options: options
});
callback(results, options);
}, reviver);
}
},
/**
* Takes string corresponding to an SVG document, and parses it into a set of fabric objects
* @memberof fabric
* @param {String} string
* @param {Function} callback
* @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.
*/
loadSVGFromString: function(string, callback, reviver) {
string = string.trim();
var doc;
if (typeof DOMParser !== 'undefined') {
var parser = new DOMParser();
if (parser && parser.parseFromString) {
doc = parser.parseFromString(string, 'text/xml');
}
}
else if (fabric.window.ActiveXObject) {
doc = new ActiveXObject('Microsoft.XMLDOM');
doc.async = 'false';
doc.loadXML(string.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,''));
}
fabric.parseSVGDocument(doc.documentElement, function (results, options) {
callback(results, options);
}, reviver);
},
/**
* Creates markup containing SVG font faces
* @param {Array} objects Array of fabric objects
* @return {String}
*/
createSVGFontFacesMarkup: function(objects) {
var markup = '';
for (var i = 0, len = objects.length; i < len; i++) {
if (objects[i].type !== 'text' || !objects[i].path) continue;
markup += [
'@font-face {',
'font-family: ', objects[i].fontFamily, '; ',
'src: url(\'', objects[i].path, '\')',
'}'
].join('');
}
if (markup) {
markup = [
'<style type="text/css">',
'<![CDATA[',
markup,
']]>',
'</style>'
].join('');
}
return markup;
},
/**
* Creates markup containing SVG referenced elements like patterns, gradients etc.
* @param {fabric.Canvas} canvas instance of fabric.Canvas
* @return {String}
*/
createSVGRefElementsMarkup: function(canvas) {
var markup = [ ];
_createSVGPattern(markup, canvas, 'backgroundColor');
_createSVGPattern(markup, canvas, 'overlayColor');
return markup.join('');
}
});
})(typeof exports !== 'undefined' ? exports : this);
fabric.ElementsParser = {
parse: function(elements, callback, options, reviver) {
this.elements = elements;
this.callback = callback;
this.options = options;
this.reviver = reviver;
this.instances = new Array(elements.length);
this.numElements = elements.length;
this.createObjects();
},
createObjects: function() {
for (var i = 0, len = this.elements.length; i < len; i++) {
this.createObject(this.elements[i], i);
}
},
createObject: function(el, index) {
var klass = fabric[fabric.util.string.capitalize(el.tagName)];
if (klass && klass.fromElement) {
try {
this._createObject(klass, el, index);
}
catch(err) {
fabric.log(err);
}
}
else {
this.checkIfDone();
}
},
_createObject: function(klass, el, index) {
if (klass.async) {
klass.fromElement(el, this.createCallback(index, el), this.options);
}
else {
var obj = klass.fromElement(el, this.options);
this.reviver && this.reviver(el, obj);
this.instances.splice(index, 0, obj);
this.checkIfDone();
}
},
createCallback: function(index, el) {
var _this = this;
return function(obj) {
_this.reviver && _this.reviver(el, obj);
_this.instances.splice(index, 0, obj);
_this.checkIfDone();
};
},
checkIfDone: function() {
if (--this.numElements === 0) {
this.instances = this.instances.filter(function(el) {
return el != null;
});
fabric.resolveGradients(this.instances);
this.callback(this.instances);
}
}
};
(function(global) {
"use strict";
/* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */
var fabric = global.fabric || (global.fabric = { });
if (fabric.Point) {
fabric.warn('fabric.Point is already defined');
return;
}
fabric.Point = Point;
/**
* Point class
* @class fabric.Point
* @memberOf fabric
* @constructor
* @param {Number} x
* @param {Number} y
* @return {fabric.Point} thisArg
*/
function Point(x, y) {
this.x = x;
this.y = y;
}
Point.prototype = /** @lends fabric.Point.prototype */ {
constructor: Point,
/**
* Adds another point to this one and returns another one
* @param {fabric.Point} that
* @return {fabric.Point} new Point instance with added values
*/
add: function (that) {
return new Point(this.x + that.x, this.y + that.y);
},
/**
* Adds another point to this one
* @param {fabric.Point} that
* @return {fabric.Point} thisArg
*/
addEquals: function (that) {
this.x += that.x;
this.y += that.y;
return this;
},
/**
* Adds value to this point and returns a new one
* @param {Number} scalar
* @return {fabric.Point} new Point with added value
*/
scalarAdd: function (scalar) {
return new Point(this.x + scalar, this.y + scalar);
},
/**
* Adds value to this point
* @param {Number} scalar
* @param {fabric.Point} thisArg
*/
scalarAddEquals: function (scalar) {
this.x += scalar;
this.y += scalar;
return this;
},
/**
* Subtracts another point from this point and returns a new one
* @param {fabric.Point} that
* @return {fabric.Point} new Point object with subtracted values
*/
subtract: function (that) {
return new Point(this.x - that.x, this.y - that.y);
},
/**
* Subtracts another point from this point
* @param {fabric.Point} that
* @return {fabric.Point} thisArg
*/
subtractEquals: function (that) {
this.x -= that.x;
this.y -= that.y;
return this;
},
/**
* Subtracts value from this point and returns a new one
* @param {Number} scalar
* @return {fabric.Point}
*/
scalarSubtract: function (scalar) {
return new Point(this.x - scalar, this.y - scalar);
},
/**
* Subtracts value from this point
* @param {Number} scalar
* @return {fabric.Point} thisArg
*/
scalarSubtractEquals: function (scalar) {
this.x -= scalar;
this.y -= scalar;
return this;
},
/**
* Miltiplies this point by a value and returns a new one
* @param {Number} scalar
* @return {fabric.Point}
*/
multiply: function (scalar) {
return new Point(this.x * scalar, this.y * scalar);
},
/**
* Miltiplies this point by a value
* @param {Number} scalar
* @return {fabric.Point} thisArg
*/
multiplyEquals: function (scalar) {
this.x *= scalar;
this.y *= scalar;
return this;
},
/**
* Divides this point by a value and returns a new one
* @param {Number} scalar
* @return {fabric.Point}
*/
divide: function (scalar) {
return new Point(this.x / scalar, this.y / scalar);
},
/**
* Divides this point by a value
* @param {Number} scalar
* @return {fabric.Point} thisArg
*/
divideEquals: function (scalar) {
this.x /= scalar;
this.y /= scalar;
return this;
},
/**
* Returns true if this point is equal to another one
* @param {fabric.Point} that
* @return {Boolean}
*/
eq: function (that) {
return (this.x === that.x && this.y === that.y);
},
/**
* Returns true if this point is less than another one
* @param {fabric.Point} that
* @return {Boolean}
*/
lt: function (that) {
return (this.x < that.x && this.y < that.y);
},
/**
* Returns true if this point is less than or equal to another one
* @param {fabric.Point} that
* @return {Boolean}
*/
lte: function (that) {
return (this.x <= that.x && this.y <= that.y);
},
/**
* Returns true if this point is greater another one
* @param {fabric.Point} that
* @return {Boolean}
*/
gt: function (that) {
return (this.x > that.x && this.y > that.y);
},
/**
* Returns true if this point is greater than or equal to another one
* @param {fabric.Point} that
* @return {Boolean}
*/
gte: function (that) {
return (this.x >= that.x && this.y >= that.y);
},
/**
* Returns new point which is the result of linear interpolation with this one and another one
* @param {fabric.Point} that
* @param {Number} t
* @return {fabric.Point}
*/
lerp: function (that, t) {
return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);
},
/**
* Returns distance from this point and another one
* @param {fabric.Point} that
* @return {Number}
*/
distanceFrom: function (that) {
var dx = this.x - that.x,
dy = this.y - that.y;
return Math.sqrt(dx * dx + dy * dy);
},
/**
* Returns the point between this point and another one
* @param {fabric.Point} that
* @return {fabric.Point}
*/
midPointFrom: function (that) {
return new Point(this.x + (that.x - this.x)/2, this.y + (that.y - this.y)/2);
},
/**
* Returns a new point which is the min of this and another one
* @param {fabric.Point} that
* @return {fabric.Point}
*/
min: function (that) {
return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));
},
/**
* Returns a new point which is the max of this and another one
* @param {fabric.Point} that
* @return {fabric.Point}
*/
max: function (that) {
return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));
},
/**
* Returns string representation of this point
* @return {String}
*/
toString: function () {
return this.x + "," + this.y;
},
/**
* Sets x/y of this point
* @param {Number} x
* @return {Number} y
*/
setXY: function (x, y) {
this.x = x;
this.y = y;
},
/**
* Sets x/y of this point from another point
* @param {fabric.Point} that
*/
setFromPoint: function (that) {
this.x = that.x;
this.y = that.y;
},
/**
* Swaps x/y of this point and another point
* @param {fabric.Point} that
*/
swap: function (that) {
var x = this.x,
y = this.y;
this.x = that.x;
this.y = that.y;
that.x = x;
that.y = y;
}
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
/* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */
var fabric = global.fabric || (global.fabric = { });
if (fabric.Intersection) {
fabric.warn('fabric.Intersection is already defined');
return;
}
/**
* Intersection class
* @class fabric.Intersection
* @memberOf fabric
* @constructor
*/
function Intersection(status) {
this.status = status;
this.points = [];
}
fabric.Intersection = Intersection;
fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {
/**
* Appends a point to intersection
* @param {fabric.Point} point
*/
appendPoint: function (point) {
this.points.push(point);
},
/**
* Appends points to intersection
* @param {Array} points
*/
appendPoints: function (points) {
this.points = this.points.concat(points);
}
};
/**
* Checks if one line intersects another
* @static
* @param {fabric.Point} a1
* @param {fabric.Point} a2
* @param {fabric.Point} b1
* @param {fabric.Point} b2
* @return {fabric.Intersection}
*/
fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {
var result,
ua_t = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),
ub_t = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),
u_b = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);
if (u_b !== 0) {
var ua = ua_t / u_b,
ub = ub_t / u_b;
if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {
result = new Intersection("Intersection");
result.points.push(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));
}
else {
result = new Intersection();
}
}
else {
if (ua_t === 0 || ub_t === 0) {
result = new Intersection("Coincident");
}
else {
result = new Intersection("Parallel");
}
}
return result;
};
/**
* Checks if line intersects polygon
* @static
* @param {fabric.Point} a1
* @param {fabric.Point} a2
* @param {Array} points
* @return {fabric.Intersection}
*/
fabric.Intersection.intersectLinePolygon = function(a1,a2,points){
var result = new Intersection(),
length = points.length;
for (var i = 0; i < length; i++) {
var b1 = points[i],
b2 = points[(i+1) % length],
inter = Intersection.intersectLineLine(a1, a2, b1, b2);
result.appendPoints(inter.points);
}
if (result.points.length > 0) {
result.status = "Intersection";
}
return result;
};
/**
* Checks if polygon intersects another polygon
* @static
* @param {Array} points1
* @param {Array} points2
* @return {fabric.Intersection}
*/
fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {
var result = new Intersection(),
length = points1.length;
for (var i = 0; i < length; i++) {
var a1 = points1[i],
a2 = points1[(i+1) % length],
inter = Intersection.intersectLinePolygon(a1, a2, points2);
result.appendPoints(inter.points);
}
if (result.points.length > 0) {
result.status = "Intersection";
}
return result;
};
/**
* Checks if polygon intersects rectangle
* @static
* @param {Array} points
* @param {Number} r1
* @param {Number} r2
* @return {fabric.Intersection}
*/
fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {
var min = r1.min(r2),
max = r1.max(r2),
topRight = new fabric.Point(max.x, min.y),
bottomLeft = new fabric.Point(min.x, max.y),
inter1 = Intersection.intersectLinePolygon(min, topRight, points),
inter2 = Intersection.intersectLinePolygon(topRight, max, points),
inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),
inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),
result = new Intersection();
result.appendPoints(inter1.points);
result.appendPoints(inter2.points);
result.appendPoints(inter3.points);
result.appendPoints(inter4.points);
if (result.points.length > 0) {
result.status = "Intersection";
}
return result;
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { });
if (fabric.Color) {
fabric.warn('fabric.Color is already defined.');
return;
}
/**
* Color class
* The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;
* {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.
*
* @class fabric.Color
* @param {String} color optional in hex or rgb(a) format
* @return {fabric.Color} thisArg
* @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}
*/
function Color(color) {
if (!color) {
this.setSource([0, 0, 0, 1]);
}
else {
this._tryParsingColor(color);
}
}
fabric.Color = Color;
fabric.Color.prototype = /** @lends fabric.Color.prototype */ {
/**
* @private
* @param {String|Array} color Color value to parse
*/
_tryParsingColor: function(color) {
var source;
if (color in Color.colorNameMap) {
color = Color.colorNameMap[color];
}
source = Color.sourceFromHex(color);
if (!source) {
source = Color.sourceFromRgb(color);
}
if (!source) {
source = Color.sourceFromHsl(color);
}
if (source) {
this.setSource(source);
}
},
/**
* Adapted from <a href="https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html">https://github.com/mjijackson</a>
* @private
* @param {Number} r Red color value
* @param {Number} g Green color value
* @param {Number} b Blue color value
* @return {Array} Hsl color
*/
_rgbToHsl: function(r, g, b) {
r /= 255, g /= 255, b /= 255;
var h, s, l,
max = fabric.util.array.max([r, g, b]),
min = fabric.util.array.min([r, g, b]);
l = (max + min) / 2;
if (max === min) {
h = s = 0; // achromatic
}
else {
var d = max - min;
s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
switch (max) {
case r:
h = (g - b) / d + (g < b ? 6 : 0);
break;
case g:
h = (b - r) / d + 2;
break;
case b:
h = (r - g) / d + 4;
break;
}
h /= 6;
}
return [
Math.round(h * 360),
Math.round(s * 100),
Math.round(l * 100)
];
},
/**
* Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])
* @return {Array}
*/
getSource: function() {
return this._source;
},
/**
* Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])
* @param {Array} source
*/
setSource: function(source) {
this._source = source;
},
/**
* Returns color represenation in RGB format
* @return {String} ex: rgb(0-255,0-255,0-255)
*/
toRgb: function() {
var source = this.getSource();
return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';
},
/**
* Returns color represenation in RGBA format
* @return {String} ex: rgba(0-255,0-255,0-255,0-1)
*/
toRgba: function() {
var source = this.getSource();
return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';
},
/**
* Returns color represenation in HSL format
* @return {String} ex: hsl(0-360,0%-100%,0%-100%)
*/
toHsl: function() {
var source = this.getSource(),
hsl = this._rgbToHsl(source[0], source[1], source[2]);
return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';
},
/**
* Returns color represenation in HSLA format
* @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)
*/
toHsla: function() {
var source = this.getSource(),
hsl = this._rgbToHsl(source[0], source[1], source[2]);
return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';
},
/**
* Returns color represenation in HEX format
* @return {String} ex: FF5555
*/
toHex: function() {
var source = this.getSource();
var r = source[0].toString(16);
r = (r.length === 1) ? ('0' + r) : r;
var g = source[1].toString(16);
g = (g.length === 1) ? ('0' + g) : g;
var b = source[2].toString(16);
b = (b.length === 1) ? ('0' + b) : b;
return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();
},
/**
* Gets value of alpha channel for this color
* @return {Number} 0-1
*/
getAlpha: function() {
return this.getSource()[3];
},
/**
* Sets value of alpha channel for this color
* @param {Number} alpha Alpha value 0-1
* @return {fabric.Color} thisArg
*/
setAlpha: function(alpha) {
var source = this.getSource();
source[3] = alpha;
this.setSource(source);
return this;
},
/**
* Transforms color to its grayscale representation
* @return {fabric.Color} thisArg
*/
toGrayscale: function() {
var source = this.getSource(),
average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),
currentAlpha = source[3];
this.setSource([average, average, average, currentAlpha]);
return this;
},
/**
* Transforms color to its black and white representation
* @param {Number} threshold
* @return {fabric.Color} thisArg
*/
toBlackWhite: function(threshold) {
var source = this.getSource(),
average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),
currentAlpha = source[3];
threshold = threshold || 127;
average = (Number(average) < Number(threshold)) ? 0 : 255;
this.setSource([average, average, average, currentAlpha]);
return this;
},
/**
* Overlays color with another color
* @param {String|fabric.Color} otherColor
* @return {fabric.Color} thisArg
*/
overlayWith: function(otherColor) {
if (!(otherColor instanceof Color)) {
otherColor = new Color(otherColor);
}
var result = [],
alpha = this.getAlpha(),
otherAlpha = 0.5,
source = this.getSource(),
otherSource = otherColor.getSource();
for (var i = 0; i < 3; i++) {
result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));
}
result[3] = alpha;
this.setSource(result);
return this;
}
};
/**
* Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))
* @static
* @field
* @memberOf fabric.Color
*/
fabric.Color.reRGBa = /^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;
/**
* Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))
* @static
* @field
* @memberOf fabric.Color
*/
fabric.Color.reHSLa = /^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;
/**
* Regex matching color in HEX format (ex: #FF5555, 010155, aff)
* @static
* @field
* @memberOf fabric.Color
*/
fabric.Color.reHex = /^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;
/**
* Map of the 17 basic color names with HEX code
* @static
* @field
* @memberOf fabric.Color
* @see: http://www.w3.org/TR/CSS2/syndata.html#color-units
*/
fabric.Color.colorNameMap = {
'aqua':    '#00FFFF',
'black':   '#000000',
'blue':    '#0000FF',
'fuchsia': '#FF00FF',
'gray':    '#808080',
'green':   '#008000',
'lime':    '#00FF00',
'maroon':  '#800000',
'navy':    '#000080',
'olive':   '#808000',
'orange':  '#FFA500',
'purple':  '#800080',
'red':     '#FF0000',
'silver':  '#C0C0C0',
'teal':    '#008080',
'white':   '#FFFFFF',
'yellow':  '#FFFF00'
};
/**
* @private
* @param {Number} p
* @param {Number} q
* @param {Number} t
* @return {Number}
*/
function hue2rgb(p, q, t){
if (t < 0) t += 1;
if (t > 1) t -= 1;
if (t < 1/6) return p + (q - p) * 6 * t;
if (t < 1/2) return q;
if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
return p;
}
/**
* Returns new color object, when given a color in RGB format
* @memberOf fabric.Color
* @param {String} color Color value ex: rgb(0-255,0-255,0-255)
* @return {fabric.Color}
*/
fabric.Color.fromRgb = function(color) {
return Color.fromSource(Color.sourceFromRgb(color));
};
/**
* Returns array represenatation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format
* @memberOf fabric.Color
* @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)
* @return {Array} source
*/
fabric.Color.sourceFromRgb = function(color) {
var match = color.match(Color.reRGBa);
if (match) {
var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),
g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),
b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);
return [
parseInt(r, 10),
parseInt(g, 10),
parseInt(b, 10),
match[4] ? parseFloat(match[4]) : 1
];
}
};
/**
* Returns new color object, when given a color in RGBA format
* @static
* @function
* @memberOf fabric.Color
* @param {String} color
* @return {fabric.Color}
*/
fabric.Color.fromRgba = Color.fromRgb;
/**
* Returns new color object, when given a color in HSL format
* @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)
* @memberOf fabric.Color
* @return {fabric.Color}
*/
fabric.Color.fromHsl = function(color) {
return Color.fromSource(Color.sourceFromHsl(color));
};
/**
* Returns array represenatation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.
* Adapted from <a href="https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html">https://github.com/mjijackson</a>
* @memberOf fabric.Color
* @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)
* @return {Array} source
* @see http://http://www.w3.org/TR/css3-color/#hsl-color
*/
fabric.Color.sourceFromHsl = function(color) {
var match = color.match(Color.reHSLa);
if (!match) return;
var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,
s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),
l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),
r, g, b;
if (s === 0) {
r = g = b = l;
}
else {
var q = l <= 0.5 ? l * (s + 1) : l + s - l * s;
var p = l * 2 - q;
r = hue2rgb(p, q, h + 1/3);
g = hue2rgb(p, q, h);
b = hue2rgb(p, q, h - 1/3);
}
return [
Math.round(r * 255),
Math.round(g * 255),
Math.round(b * 255),
match[4] ? parseFloat(match[4]) : 1
];
};
/**
* Returns new color object, when given a color in HSLA format
* @static
* @function
* @memberOf fabric.Color
* @param {String} color
* @return {fabric.Color}
*/
fabric.Color.fromHsla = Color.fromHsl;
/**
* Returns new color object, when given a color in HEX format
* @static
* @memberOf fabric.Color
* @param {String} color Color value ex: FF5555
* @return {fabric.Color}
*/
fabric.Color.fromHex = function(color) {
return Color.fromSource(Color.sourceFromHex(color));
};
/**
* Returns array represenatation (ex: [100, 100, 200, 1]) of a color that's in HEX format
* @static
* @memberOf fabric.Color
* @param {String} color ex: FF5555
* @return {Array} source
*/
fabric.Color.sourceFromHex = function(color) {
if (color.match(Color.reHex)) {
var value = color.slice(color.indexOf('#') + 1),
isShortNotation = (value.length === 3),
r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),
g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),
b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6);
return [
parseInt(r, 16),
parseInt(g, 16),
parseInt(b, 16),
1
];
}
};
/**
* Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])
* @static
* @memberOf fabric.Color
* @param {Array} source
* @return {fabric.Color}
*/
fabric.Color.fromSource = function(source) {
var oColor = new Color();
oColor.setSource(source);
return oColor;
};
})(typeof exports !== 'undefined' ? exports : this);
(function() {
/* _FROM_SVG_START_ */
function getColorStop(el) {
var style = el.getAttribute('style'),
offset = el.getAttribute('offset'),
color, opacity;
offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);
if (style) {
var keyValuePairs = style.split(/\s*;\s*/);
if (keyValuePairs[keyValuePairs.length-1] === '') {
keyValuePairs.pop();
}
for (var i = keyValuePairs.length; i--; ) {
var split = keyValuePairs[i].split(/\s*:\s*/),
key = split[0].trim(),
value = split[1].trim();
if (key === 'stop-color') {
color = value;
}
else if (key === 'stop-opacity') {
opacity = value;
}
}
}
if (!color) {
color = el.getAttribute('stop-color') || 'rgb(0,0,0)';
}
if (!opacity) {
opacity = el.getAttribute('stop-opacity');
}
color = new fabric.Color(color).toRgb();
return {
offset: offset,
color: color,
opacity: isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity)
};
}
function getLinearCoords(el) {
return {
x1: el.getAttribute('x1') || 0,
y1: el.getAttribute('y1') || 0,
x2: el.getAttribute('x2') || '100%',
y2: el.getAttribute('y2') || 0
};
}
function getRadialCoords(el) {
return {
x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',
y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',
r1: 0,
x2: el.getAttribute('cx') || '50%',
y2: el.getAttribute('cy') || '50%',
r2: el.getAttribute('r') || '50%'
};
}
/* _FROM_SVG_END_ */
/**
* Gradient class
* @class fabric.Gradient
* @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#gradients}
* @see {@link fabric.Gradient#initialize} for constructor definition
*/
fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {
/**
* Constructor
* @param {Object} [options] Options object with type, coords, gradientUnits and colorStops
* @return {fabric.Gradient} thisArg
*/
initialize: function(options) {
options || (options = { });
var coords = { };
this.id = fabric.Object.__uid++;
this.type = options.type || 'linear';
coords = {
x1: options.coords.x1 || 0,
y1: options.coords.y1 || 0,
x2: options.coords.x2 || 0,
y2: options.coords.y2 || 0
};
if (this.type === 'radial') {
coords.r1 = options.coords.r1 || 0;
coords.r2 = options.coords.r2 || 0;
}
this.coords = coords;
this.gradientUnits = options.gradientUnits || 'objectBoundingBox';
this.colorStops = options.colorStops.slice();
},
/**
* Adds another colorStop
* @param {Object} colorStop Object with offset and color
* @return {fabric.Gradient} thisArg
*/
addColorStop: function(colorStop) {
for (var position in colorStop) {
var color = new fabric.Color(colorStop[position]);
this.colorStops.push({offset: position, color: color.toRgb(), opacity: color.getAlpha()});
}
return this;
},
/**
* Returns object representation of a gradient
* @return {Object}
*/
toObject: function() {
return {
type: this.type,
coords: this.coords,
gradientUnits: this.gradientUnits,
colorStops: this.colorStops
};
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of an gradient
* @param {Object} object Object to create a gradient for
* @param {Boolean} normalize Whether coords should be normalized
* @return {String} SVG representation of an gradient (linear/radial)
*/
toSVG: function(object, normalize) {
var coords = fabric.util.object.clone(this.coords),
markup;
this.colorStops.sort(function(a, b) {
return a.offset - b.offset;
});
if (normalize && this.gradientUnits === 'userSpaceOnUse') {
coords.x1 += object.width / 2;
coords.y1 += object.height / 2;
coords.x2 += object.width / 2;
coords.y2 += object.height / 2;
}
else if (this.gradientUnits === 'objectBoundingBox') {
_convertValuesToPercentUnits(object, coords);
}
if (this.type === 'linear') {
markup = [
'<linearGradient ',
'id="SVGID_', this.id,
'" gradientUnits="', this.gradientUnits,
'" x1="', coords.x1,
'" y1="', coords.y1,
'" x2="', coords.x2,
'" y2="', coords.y2,
'">'
];
}
else if (this.type === 'radial') {
markup = [
'<radialGradient ',
'id="SVGID_', this.id,
'" gradientUnits="', this.gradientUnits,
'" cx="', coords.x2,
'" cy="', coords.y2,
'" r="', coords.r2,
'" fx="', coords.x1,
'" fy="', coords.y1,
'">'
];
}
for (var i = 0; i < this.colorStops.length; i++) {
markup.push(
'<stop ',
'offset="', (this.colorStops[i].offset * 100) + '%',
'" style="stop-color:', this.colorStops[i].color,
(this.colorStops[i].opacity ? ';stop-opacity: ' + this.colorStops[i].opacity : ';'),
'"/>'
);
}
markup.push((this.type === 'linear' ? '</linearGradient>' : '</radialGradient>'));
return markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns an instance of CanvasGradient
* @param {CanvasRenderingContext2D} ctx Context to render on
* @return {CanvasGradient}
*/
toLive: function(ctx) {
var gradient;
if (!this.type) return;
if (this.type === 'linear') {
gradient = ctx.createLinearGradient(
this.coords.x1, this.coords.y1, this.coords.x2, this.coords.y2);
}
else if (this.type === 'radial') {
gradient = ctx.createRadialGradient(
this.coords.x1, this.coords.y1, this.coords.r1, this.coords.x2, this.coords.y2, this.coords.r2);
}
for (var i = 0, len = this.colorStops.length; i < len; i++) {
var color = this.colorStops[i].color,
opacity = this.colorStops[i].opacity,
offset = this.colorStops[i].offset;
if (typeof opacity !== 'undefined') {
color = new fabric.Color(color).setAlpha(opacity).toRgba();
}
gradient.addColorStop(parseFloat(offset), color);
}
return gradient;
}
});
fabric.util.object.extend(fabric.Gradient, {
/* _FROM_SVG_START_ */
/**
* Returns {@link fabric.Gradient} instance from an SVG element
* @static
* @memberof fabric.Gradient
* @param {SVGGradientElement} el SVG gradient element
* @param {fabric.Object} instance
* @return {fabric.Gradient} Gradient instance
* @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement
* @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement
*/
fromElement: function(el, instance) {
/**
*  @example:
*
*  <linearGradient id="linearGrad1">
*    <stop offset="0%" stop-color="white"/>
*    <stop offset="100%" stop-color="black"/>
*  </linearGradient>
*
*  OR
*
*  <linearGradient id="linearGrad2">
*    <stop offset="0" style="stop-color:rgb(255,255,255)"/>
*    <stop offset="1" style="stop-color:rgb(0,0,0)"/>
*  </linearGradient>
*
*  OR
*
*  <radialGradient id="radialGrad1">
*    <stop offset="0%" stop-color="white" stop-opacity="1" />
*    <stop offset="50%" stop-color="black" stop-opacity="0.5" />
*    <stop offset="100%" stop-color="white" stop-opacity="1" />
*  </radialGradient>
*
*  OR
*
*  <radialGradient id="radialGrad2">
*    <stop offset="0" stop-color="rgb(255,255,255)" />
*    <stop offset="0.5" stop-color="rgb(0,0,0)" />
*    <stop offset="1" stop-color="rgb(255,255,255)" />
*  </radialGradient>
*
*/
var colorStopEls = el.getElementsByTagName('stop'),
type = (el.nodeName === 'linearGradient' ? 'linear' : 'radial'),
gradientUnits = el.getAttribute('gradientUnits') || 'objectBoundingBox',
colorStops = [],
coords = { };
if (type === 'linear') {
coords = getLinearCoords(el);
}
else if (type === 'radial') {
coords = getRadialCoords(el);
}
for (var i = colorStopEls.length; i--; ) {
colorStops.push(getColorStop(colorStopEls[i]));
}
_convertPercentUnitsToValues(instance, coords);
return new fabric.Gradient({
type: type,
coords: coords,
gradientUnits: gradientUnits,
colorStops: colorStops
});
},
/* _FROM_SVG_END_ */
/**
* Returns {@link fabric.Gradient} instance from its object representation
* @static
* @memberof fabric.Gradient
* @param {Object} obj
* @param {Object} [options] Options object
*/
forObject: function(obj, options) {
options || (options = { });
_convertPercentUnitsToValues(obj, options);
return new fabric.Gradient(options);
}
});
/**
* @private
*/
function _convertPercentUnitsToValues(object, options) {
for (var prop in options) {
if (typeof options[prop] === 'string' && /^\d+%$/.test(options[prop])) {
var percents = parseFloat(options[prop], 10);
if (prop === 'x1' || prop === 'x2' || prop === 'r2') {
options[prop] = fabric.util.toFixed(object.width * percents / 100, 2);
}
else if (prop === 'y1' || prop === 'y2') {
options[prop] = fabric.util.toFixed(object.height * percents / 100, 2);
}
}
normalize(options, prop, object);
}
}
function normalize(options, prop, object) {
if (prop === 'x1' || prop === 'x2') {
options[prop] -= fabric.util.toFixed(object.width / 2, 2);
}
else if (prop === 'y1' || prop === 'y2') {
options[prop] -= fabric.util.toFixed(object.height / 2, 2);
}
}
/* _TO_SVG_START_ */
/**
* @private
*/
function _convertValuesToPercentUnits(object, options) {
for (var prop in options) {
normalize(options, prop, object);
if (prop === 'x1' || prop === 'x2' || prop === 'r2') {
options[prop] = fabric.util.toFixed(options[prop] / object.width * 100, 2) + '%';
}
else if (prop === 'y1' || prop === 'y2') {
options[prop] = fabric.util.toFixed(options[prop] / object.height * 100, 2) + '%';
}
}
}
/* _TO_SVG_END_ */
})();
/**
* Pattern class
* @class fabric.Pattern
* @see {@link http://fabricjs.com/patterns/|Pattern demo}
* @see {@link http://fabricjs.com/dynamic-patterns/|DynamicPattern demo}
* @see {@link fabric.Pattern#initialize} for constructor definition
*/
fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {
/**
* Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)
* @type String
* @default
*/
repeat: 'repeat',
/**
* Pattern horizontal offset from object's left/top corner
* @type Number
* @default
*/
offsetX: 0,
/**
* Pattern vertical offset from object's left/top corner
* @type Number
* @default
*/
offsetY: 0,
/**
* Constructor
* @param {Object} [options] Options object
* @return {fabric.Pattern} thisArg
*/
initialize: function(options) {
options || (options = { });
this.id = fabric.Object.__uid++;
if (options.source) {
if (typeof options.source === 'string') {
if (typeof fabric.util.getFunctionBody(options.source) !== 'undefined') {
this.source = new Function(fabric.util.getFunctionBody(options.source));
}
else {
var _this = this;
this.source = fabric.util.createImage();
fabric.util.loadImage(options.source, function(img) {
_this.source = img;
});
}
}
else {
this.source = options.source;
}
}
if (options.repeat) {
this.repeat = options.repeat;
}
if (options.offsetX) {
this.offsetX = options.offsetX;
}
if (options.offsetY) {
this.offsetY = options.offsetY;
}
},
/**
* Returns object representation of a pattern
* @return {Object} Object representation of a pattern instance
*/
toObject: function() {
var source;
if (typeof this.source === 'function') {
source = String(this.source);
}
else if (typeof this.source.src === 'string') {
source = this.source.src;
}
return {
source: source,
repeat: this.repeat,
offsetX: this.offsetX,
offsetY: this.offsetY
};
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of a pattern
* @param {fabric.Object} object
* @return {String} SVG representation of a pattern
*/
toSVG: function(object) {
var patternSource = typeof this.source === 'function' ? this.source() : this.source;
var patternWidth = patternSource.width / object.getWidth();
var patternHeight = patternSource.height / object.getHeight();
var patternImgSrc = '';
if (patternSource.src) {
patternImgSrc = patternSource.src;
}
else if (patternSource.toDataURL) {
patternImgSrc = patternSource.toDataURL();
}
return '<pattern id="SVGID_' + this.id +
'" x="' + this.offsetX +
'" y="' + this.offsetY +
'" width="' + patternWidth +
'" height="' + patternHeight + '">' +
'<image x="0" y="0"' +
' width="' + patternSource.width +
'" height="' + patternSource.height +
'" xlink:href="' + patternImgSrc +
'"></image>' +
'</pattern>';
},
/* _TO_SVG_END_ */
/**
* Returns an instance of CanvasPattern
* @param {CanvasRenderingContext2D} ctx Context to create pattern
* @return {CanvasPattern}
*/
toLive: function(ctx) {
var source = typeof this.source === 'function' ? this.source() : this.source;
if (typeof source.src !== 'undefined') {
if (!source.complete) return '';
if (source.naturalWidth === 0 || source.naturalHeight === 0) return '';
}
return ctx.createPattern(source, this.repeat);
}
});
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { });
if (fabric.Shadow) {
fabric.warn('fabric.Shadow is already defined.');
return;
}
/**
* Shadow class
* @class fabric.Shadow
* @see {@link http://fabricjs.com/shadows/|Shadow demo}
* @see {@link fabric.Shadow#initialize} for constructor definition
*/
fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {
/**
* Shadow color
* @type String
* @default
*/
color: 'rgb(0,0,0)',
/**
* Shadow blur
* @type Number
*/
blur: 0,
/**
* Shadow horizontal offset
* @type Number
* @default
*/
offsetX: 0,
/**
* Shadow vertical offset
* @type Number
* @default
*/
offsetY: 0,
/**
* Whether the shadow should affect stroke operations
* @type Boolean
* @default
*/
affectStroke: false,
/**
* Indicates whether toObject should include default values
* @type Boolean
* @default
*/
includeDefaultValues: true,
/**
* Constructor
* @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetX properties or string (e.g. "rgba(0,0,0,0.2) 2px 2px 10px, "2px 2px 10px rgba(0,0,0,0.2)")
* @return {fabric.Shadow} thisArg
*/
initialize: function(options) {
if (typeof options === 'string') {
options = this._parseShadow(options);
}
for (var prop in options) {
this[prop] = options[prop];
}
this.id = fabric.Object.__uid++;
},
/**
* @private
* @param {String} shadow Shadow value to parse
* @return {Object} Shadow object with color, offsetX, offsetY and blur
*/
_parseShadow: function(shadow) {
var shadowStr = shadow.trim();
var offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [ ],
color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';
return {
color: color.trim(),
offsetX: parseInt(offsetsAndBlur[1], 10) || 0,
offsetY: parseInt(offsetsAndBlur[2], 10) || 0,
blur: parseInt(offsetsAndBlur[3], 10) || 0
};
},
/**
* Returns a string representation of an instance
* @see http://www.w3.org/TR/css-text-decor-3/#text-shadow
* @return {String} Returns CSS3 text-shadow declaration
*/
toString: function() {
return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of a shadow
* @param {fabric.Object} object
* @return {String} SVG representation of a shadow
*/
toSVG: function(object) {
var mode = 'SourceAlpha';
if (object && (object.fill === this.color || object.stroke === this.color)) {
mode = 'SourceGraphic';
}
return (
'<filter id="SVGID_' + this.id + '" y="-40%" height="180%">' +
'<feGaussianBlur in="' + mode + '" stdDeviation="' +
(this.blur ? this.blur / 3 : 0) +
'"></feGaussianBlur>' +
'<feOffset dx="' + this.offsetX + '" dy="' + this.offsetY + '"></feOffset>' +
'<feMerge>' +
'<feMergeNode></feMergeNode>' +
'<feMergeNode in="SourceGraphic"></feMergeNode>' +
'</feMerge>' +
'</filter>');
},
/* _TO_SVG_END_ */
/**
* Returns object representation of a shadow
* @return {Object} Object representation of a shadow instance
*/
toObject: function() {
if (this.includeDefaultValues) {
return {
color: this.color,
blur: this.blur,
offsetX: this.offsetX,
offsetY: this.offsetY
};
}
var obj = { }, proto = fabric.Shadow.prototype;
if (this.color !== proto.color) {
obj.color = this.color;
}
if (this.blur !== proto.blur) {
obj.blur = this.blur;
}
if (this.offsetX !== proto.offsetX) {
obj.offsetX = this.offsetX;
}
if (this.offsetY !== proto.offsetY) {
obj.offsetY = this.offsetY;
}
return obj;
}
});
/**
* Regex matching shadow offsetX, offsetY and blur (ex: "2px 2px 10px rgba(0,0,0,0.2)", "rgb(0,255,0) 2px 2px")
* @static
* @field
* @memberOf fabric.Shadow
*/
fabric.Shadow.reOffsetsAndBlur = /(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/;
})(typeof exports !== 'undefined' ? exports : this);
(function () {
"use strict";
if (fabric.StaticCanvas) {
fabric.warn('fabric.StaticCanvas is already defined.');
return;
}
var extend = fabric.util.object.extend,
getElementOffset = fabric.util.getElementOffset,
removeFromArray = fabric.util.removeFromArray,
CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');
/**
* Static canvas class
* @class fabric.StaticCanvas
* @mixes fabric.Collection
* @mixes fabric.Observable
* @see {@link http://fabricjs.com/static_canvas/|StaticCanvas demo}
* @see {@link fabric.StaticCanvas#initialize} for constructor definition
* @fires before:render
* @fires after:render
* @fires canvas:cleared
* @fires object:added
* @fires object:removed
*/
fabric.StaticCanvas = fabric.util.createClass(/** @lends fabric.StaticCanvas.prototype */ {
/**
* Constructor
* @param {HTMLElement | String} el &lt;canvas> element to initialize instance on
* @param {Object} [options] Options object
* @return {Object} thisArg
*/
initialize: function(el, options) {
options || (options = { });
this._initStatic(el, options);
fabric.StaticCanvas.activeInstance = this;
},
/**
* Background color of canvas instance.
* Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.
* @type {(String|fabric.Pattern)}
* @default
*/
backgroundColor: '',
/**
* Background image of canvas instance.
* Should be set via {@link fabric.StaticCanvas#setBackgroundImage}.
* <b>Backwards incompatibility note:</b> The "backgroundImageOpacity"
* and "backgroundImageStretch" properties are deprecated since 1.3.9.
* Use {@link fabric.Image#opacity}, {@link fabric.Image#width} and {@link fabric.Image#height}.
* @type fabric.Image
* @default
*/
backgroundImage: null,
/**
* Overlay color of canvas instance.
* Should be set via {@link fabric.StaticCanvas#setOverlayColor}
* @since 1.3.9
* @type {(String|fabric.Pattern)}
* @default
*/
overlayColor: '',
/**
* Overlay image of canvas instance.
* Should be set via {@link fabric.StaticCanvas#setOverlayImage}.
* <b>Backwards incompatibility note:</b> The "overlayImageLeft"
* and "overlayImageTop" properties are deprecated since 1.3.9.
* Use {@link fabric.Image#left} and {@link fabric.Image#top}.
* @type fabric.Image
* @default
*/
overlayImage: null,
/**
* Indicates whether toObject/toDatalessObject should include default values
* @type Boolean
* @default
*/
includeDefaultValues: true,
/**
* Indicates whether objects' state should be saved
* @type Boolean
* @default
*/
stateful: true,
/**
* Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove} should also re-render canvas.
* Disabling this option could give a great performance boost when adding/removing a lot of objects to/from canvas at once
* (followed by a manual rendering after addition/deletion)
* @type Boolean
* @default
*/
renderOnAddRemove: true,
/**
* Function that determines clipping of entire canvas area
* Being passed context as first argument. See clipping canvas area in {@link https://github.com/kangax/fabric.js/wiki/FAQ}
* @type Function
* @default
*/
clipTo: null,
/**
* Indicates whether object controls (borders/controls) are rendered above overlay image
* @type Boolean
* @default
*/
controlsAboveOverlay: false,
/**
* Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas
* @type Boolean
* @default
*/
allowTouchScrolling: false,
/**
* Callback; invoked right before object is about to be scaled/rotated
* @param {fabric.Object} target Object that's about to be scaled/rotated
*/
onBeforeScaleRotate: function () {
/* NOOP */
},
/**
* @private
* @param {HTMLElement | String} el &lt;canvas> element to initialize instance on
* @param {Object} [options] Options object
*/
_initStatic: function(el, options) {
this._objects = [];
this._createLowerCanvas(el);
this._initOptions(options);
if (options.overlayImage) {
this.setOverlayImage(options.overlayImage, this.renderAll.bind(this));
}
if (options.backgroundImage) {
this.setBackgroundImage(options.backgroundImage, this.renderAll.bind(this));
}
if (options.backgroundColor) {
this.setBackgroundColor(options.backgroundColor, this.renderAll.bind(this));
}
if (options.overlayColor) {
this.setOverlayColor(options.overlayColor, this.renderAll.bind(this));
}
this.calcOffset();
},
/**
* Calculates canvas element offset relative to the document
* This method is also attached as "resize" event handler of window
* @return {fabric.Canvas} instance
* @chainable
*/
calcOffset: function () {
this._offset = getElementOffset(this.lowerCanvasEl);
return this;
},
/**
* Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas
* @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to
* @param {Function} callback callback to invoke when image is loaded and set as an overlay
* @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.
* @return {fabric.Canvas} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}
* @example <caption>Normal overlayImage with left/top = 0</caption>
* canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {
*   // Needed to position overlayImage at 0/0
*   originX: 'left',
*   originY: 'top'
* });
* @example <caption>overlayImage with different properties</caption>
* canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {
*   opacity: 0.5,
*   angle: 45,
*   left: 400,
*   top: 400,
*   originX: 'left',
*   originY: 'top'
* });
* @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>
* fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img) {
*    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});
*    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));
* });
* @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>
* canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {
*   width: canvas.width,
*   height: canvas.height,
*   // Needed to position overlayImage at 0/0
*   originX: 'left',
*   originY: 'top'
* });
*/
setOverlayImage: function (image, callback, options) {
return this.__setBgOverlayImage('overlayImage', image, callback, options);
},
/**
* Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas
* @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to
* @param {Function} callback Callback to invoke when image is loaded and set as background
* @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.
* @return {fabric.Canvas} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/YH9yD/|jsFiddle demo}
* @example <caption>Normal backgroundImage with left/top = 0</caption>
* canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {
*   // Needed to position backgroundImage at 0/0
*   originX: 'left',
*   originY: 'top'
* });
* @example <caption>backgroundImage with different properties</caption>
* canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {
*   opacity: 0.5,
*   angle: 45,
*   left: 400,
*   top: 400,
*   originX: 'left',
*   originY: 'top'
* });
* @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>
* fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img) {
*    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});
*    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
* });
* @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>
* canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {
*   width: canvas.width,
*   height: canvas.height,
*   // Needed to position backgroundImage at 0/0
*   originX: 'left',
*   originY: 'top'
* });
*/
setBackgroundImage: function (image, callback, options) {
return this.__setBgOverlayImage('backgroundImage', image, callback, options);
},
/**
* Sets {@link fabric.StaticCanvas#overlayColor|background color} for this canvas
* @param {(String|fabric.Pattern)} overlayColor Color or pattern to set background color to
* @param {Function} callback Callback to invoke when background color is set
* @return {fabric.Canvas} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}
* @example <caption>Normal overlayColor - color value</caption>
* canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));
* @example <caption>fabric.Pattern used as overlayColor</caption>
* canvas.setOverlayColor({
*   source: 'http://fabricjs.com/assets/escheresque_ste.png'
* }, canvas.renderAll.bind(canvas));
* @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>
* canvas.setOverlayColor({
*   source: 'http://fabricjs.com/assets/escheresque_ste.png',
*   repeat: 'repeat',
*   offsetX: 200,
*   offsetY: 100
* }, canvas.renderAll.bind(canvas));
*/
setOverlayColor: function(overlayColor, callback) {
return this.__setBgOverlayColor('overlayColor', overlayColor, callback);
},
/**
* Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas
* @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to
* @param {Function} callback Callback to invoke when background color is set
* @return {fabric.Canvas} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}
* @example <caption>Normal backgroundColor - color value</caption>
* canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));
* @example <caption>fabric.Pattern used as backgroundColor</caption>
* canvas.setBackgroundColor({
*   source: 'http://fabricjs.com/assets/escheresque_ste.png'
* }, canvas.renderAll.bind(canvas));
* @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>
* canvas.setBackgroundColor({
*   source: 'http://fabricjs.com/assets/escheresque_ste.png',
*   repeat: 'repeat',
*   offsetX: 200,
*   offsetY: 100
* }, canvas.renderAll.bind(canvas));
*/
setBackgroundColor: function(backgroundColor, callback) {
return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);
},
/**
* @private
* @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}
* or {@link fabric.StaticCanvas#overlayImage|overlayImage})
* @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background or overlay to
* @param {Function} callback Callback to invoke when image is loaded and set as background or overlay
* @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.
*/
__setBgOverlayImage: function(property, image, callback, options) {
if (typeof image === 'string') {
fabric.util.loadImage(image, function(img) {
this[property] = new fabric.Image(img, options);
callback && callback();
}, this);
}
else {
this[property] = image;
callback && callback();
}
return this;
},
/**
* @private
* @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}
* or {@link fabric.StaticCanvas#overlayColor|overlayColor})
* @param {(Object|String)} color Object with pattern information or color value
* @param {Function} [callback] Callback is invoked when color is set
*/
__setBgOverlayColor: function(property, color, callback) {
if (color.source) {
var _this = this;
fabric.util.loadImage(color.source, function(img) {
_this[property] = new fabric.Pattern({
source: img,
repeat: color.repeat,
offsetX: color.offsetX,
offsetY: color.offsetY
});
callback && callback();
});
}
else {
this[property] = color;
callback && callback();
}
return this;
},
/**
* @private
*/
_createCanvasElement: function() {
var element = fabric.document.createElement('canvas');
if (!element.style) {
element.style = { };
}
if (!element) {
throw CANVAS_INIT_ERROR;
}
this._initCanvasElement(element);
return element;
},
/**
* @private
* @param {HTMLElement} element
*/
_initCanvasElement: function(element) {
fabric.util.createCanvasElement(element);
if (typeof element.getContext === 'undefined') {
throw CANVAS_INIT_ERROR;
}
},
/**
* @private
* @param {Object} [options] Options object
*/
_initOptions: function (options) {
for (var prop in options) {
this[prop] = options[prop];
}
this.width = parseInt(this.lowerCanvasEl.width, 10) || 0;
this.height = parseInt(this.lowerCanvasEl.height, 10) || 0;
if (!this.lowerCanvasEl.style) return;
this.lowerCanvasEl.style.width = this.width + 'px';
this.lowerCanvasEl.style.height = this.height + 'px';
},
/**
* Creates a bottom canvas
* @private
* @param {HTMLElement} [canvasEl]
*/
_createLowerCanvas: function (canvasEl) {
this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();
this._initCanvasElement(this.lowerCanvasEl);
fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');
if (this.interactive) {
this._applyCanvasStyle(this.lowerCanvasEl);
}
this.contextContainer = this.lowerCanvasEl.getContext('2d');
},
/**
* Returns canvas width (in px)
* @return {Number}
*/
getWidth: function () {
return this.width;
},
/**
* Returns canvas height (in px)
* @return {Number}
*/
getHeight: function () {
return this.height;
},
/**
* Sets width of this canvas instance
* @param {Number} width value to set width to
* @return {fabric.Canvas} instance
* @chainable true
*/
setWidth: function (value) {
return this._setDimension('width', value);
},
/**
* Sets height of this canvas instance
* @param {Number} height value to set height to
* @return {fabric.Canvas} instance
* @chainable true
*/
setHeight: function (value) {
return this._setDimension('height', value);
},
/**
* Sets dimensions (width, height) of this canvas instance
* @param {Object} dimensions Object with width/height properties
* @param {Number} [dimensions.width] Width of canvas element
* @param {Number} [dimensions.height] Height of canvas element
* @return {fabric.Canvas} thisArg
* @chainable
*/
setDimensions: function(dimensions) {
for (var prop in dimensions) {
this._setDimension(prop, dimensions[prop]);
}
return this;
},
/**
* Helper for setting width/height
* @private
* @param {String} prop property (width|height)
* @param {Number} value value to set property to
* @return {fabric.Canvas} instance
* @chainable true
*/
_setDimension: function (prop, value) {
this.lowerCanvasEl[prop] = value;
this.lowerCanvasEl.style[prop] = value + 'px';
if (this.upperCanvasEl) {
this.upperCanvasEl[prop] = value;
this.upperCanvasEl.style[prop] = value + 'px';
}
if (this.cacheCanvasEl) {
this.cacheCanvasEl[prop] = value;
}
if (this.wrapperEl) {
this.wrapperEl.style[prop] = value + 'px';
}
this[prop] = value;
this.calcOffset();
this.renderAll();
return this;
},
/**
* Returns &lt;canvas> element corresponding to this instance
* @return {HTMLCanvasElement}
*/
getElement: function () {
return this.lowerCanvasEl;
},
/**
* Returns currently selected object, if any
* @return {fabric.Object}
*/
getActiveObject: function() {
return null;
},
/**
* Returns currently selected group of object, if any
* @return {fabric.Group}
*/
getActiveGroup: function() {
return null;
},
/**
* Given a context, renders an object on that context
* @param {CanvasRenderingContext2D} ctx Context to render object on
* @param {fabric.Object} object Object to render
* @private
*/
_draw: function (ctx, object) {
if (!object) return;
if (this.controlsAboveOverlay) {
var hasBorders = object.hasBorders, hasControls = object.hasControls;
object.hasBorders = object.hasControls = false;
object.render(ctx);
object.hasBorders = hasBorders;
object.hasControls = hasControls;
}
else {
object.render(ctx);
}
},
/**
* @private
* @param {fabric.Object} obj Object that was added
*/
_onObjectAdded: function(obj) {
this.stateful && obj.setupState();
obj.setCoords();
obj.canvas = this;
this.fire('object:added', { target: obj });
obj.fire('added');
},
/**
* @private
* @param {fabric.Object} obj Object that was removed
*/
_onObjectRemoved: function(obj) {
if (this.getActiveObject() === obj) {
this.fire('before:selection:cleared', { target: obj });
this._discardActiveObject();
this.fire('selection:cleared');
}
this.fire('object:removed', { target: obj });
obj.fire('removed');
},
/**
* Clears specified context of canvas element
* @param {CanvasRenderingContext2D} ctx Context to clear
* @return {fabric.Canvas} thisArg
* @chainable
*/
clearContext: function(ctx) {
ctx.clearRect(0, 0, this.width, this.height);
return this;
},
/**
* Returns context of canvas where objects are drawn
* @return {CanvasRenderingContext2D}
*/
getContext: function () {
return this.contextContainer;
},
/**
* Clears all contexts (background, main, top) of an instance
* @return {fabric.Canvas} thisArg
* @chainable
*/
clear: function () {
this._objects.length = 0;
if (this.discardActiveGroup) {
this.discardActiveGroup();
}
if (this.discardActiveObject) {
this.discardActiveObject();
}
this.clearContext(this.contextContainer);
if (this.contextTop) {
this.clearContext(this.contextTop);
}
this.fire('canvas:cleared');
this.renderAll();
return this;
},
/**
* Renders both the top canvas and the secondary container canvas.
* @param {Boolean} [allOnTop] Whether we want to force all images to be rendered on the top canvas
* @return {fabric.Canvas} instance
* @chainable
*/
renderAll: function (allOnTop) {
var canvasToDrawOn = this[(allOnTop === true && this.interactive) ? 'contextTop' : 'contextContainer'];
var activeGroup = this.getActiveGroup();
if (this.contextTop && this.selection && !this._groupSelector) {
this.clearContext(this.contextTop);
}
if (!allOnTop) {
this.clearContext(canvasToDrawOn);
}
this.fire('before:render');
if (this.clipTo) {
fabric.util.clipContext(this, canvasToDrawOn);
}
this._renderBackground(canvasToDrawOn);
this._renderObjects(canvasToDrawOn, activeGroup);
this._renderActiveGroup(canvasToDrawOn, activeGroup);
if (this.clipTo) {
canvasToDrawOn.restore();
}
this._renderOverlay(canvasToDrawOn);
if (this.controlsAboveOverlay && this.interactive) {
this.drawControls(canvasToDrawOn);
}
this.fire('after:render');
return this;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {fabric.Group} activeGroup
*/
_renderObjects: function(ctx, activeGroup) {
for (var i = 0, length = this._objects.length; i < length; ++i) {
if (!activeGroup ||
(activeGroup && this._objects[i] && !activeGroup.contains(this._objects[i]))) {
this._draw(ctx, this._objects[i]);
}
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {fabric.Group} activeGroup
*/
_renderActiveGroup: function(ctx, activeGroup) {
if (activeGroup) {
var sortedObjects = [];
this.forEachObject(function (object) {
if (activeGroup.contains(object)) {
sortedObjects.push(object);
}
});
activeGroup._set('objects', sortedObjects);
this._draw(ctx, activeGroup);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderBackground: function(ctx) {
if (this.backgroundColor) {
ctx.fillStyle = this.backgroundColor.toLive
? this.backgroundColor.toLive(ctx)
: this.backgroundColor;
ctx.fillRect(
this.backgroundColor.offsetX || 0,
this.backgroundColor.offsetY || 0,
this.width,
this.height);
}
if (this.backgroundImage) {
this.backgroundImage.render(ctx);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderOverlay: function(ctx) {
if (this.overlayColor) {
ctx.fillStyle = this.overlayColor.toLive
? this.overlayColor.toLive(ctx)
: this.overlayColor;
ctx.fillRect(
this.overlayColor.offsetX || 0,
this.overlayColor.offsetY || 0,
this.width,
this.height);
}
if (this.overlayImage) {
this.overlayImage.render(ctx);
}
},
/**
* Method to render only the top canvas.
* Also used to render the group selection box.
* @return {fabric.Canvas} thisArg
* @chainable
*/
renderTop: function () {
var ctx = this.contextTop || this.contextContainer;
this.clearContext(ctx);
if (this.selection && this._groupSelector) {
this._drawSelection();
}
var activeGroup = this.getActiveGroup();
if (activeGroup) {
activeGroup.render(ctx);
}
if (this.overlayImage) {
ctx.drawImage(this.overlayImage, this.overlayImageLeft, this.overlayImageTop);
}
this.fire('after:render');
return this;
},
/**
* Returns coordinates of a center of canvas.
* Returned value is an object with top and left properties
* @return {Object} object with "top" and "left" number values
*/
getCenter: function () {
return {
top: this.getHeight() / 2,
left: this.getWidth() / 2
};
},
/**
* Centers object horizontally.
* You might need to call `setCoords` on an object after centering, to update controls area.
* @param {fabric.Object} object Object to center horizontally
* @return {fabric.Canvas} thisArg
*/
centerObjectH: function (object) {
this._centerObject(object, new fabric.Point(this.getCenter().left, object.getCenterPoint().y));
this.renderAll();
return this;
},
/**
* Centers object vertically.
* You might need to call `setCoords` on an object after centering, to update controls area.
* @param {fabric.Object} object Object to center vertically
* @return {fabric.Canvas} thisArg
* @chainable
*/
centerObjectV: function (object) {
this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenter().top));
this.renderAll();
return this;
},
/**
* Centers object vertically and horizontally.
* You might need to call `setCoords` on an object after centering, to update controls area.
* @param {fabric.Object} object Object to center vertically and horizontally
* @return {fabric.Canvas} thisArg
* @chainable
*/
centerObject: function(object) {
var center = this.getCenter();
this._centerObject(object, new fabric.Point(center.left, center.top));
this.renderAll();
return this;
},
/**
* @private
* @param {fabric.Object} object Object to center
* @param {fabric.Point} center Center point
* @return {fabric.Canvas} thisArg
* @chainable
*/
_centerObject: function(object, center) {
object.setPositionByOrigin(center, 'center', 'center');
return this;
},
/**
* Returs dataless JSON representation of canvas
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {String} json string
*/
toDatalessJSON: function (propertiesToInclude) {
return this.toDatalessObject(propertiesToInclude);
},
/**
* Returns object representation of canvas
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function (propertiesToInclude) {
return this._toObjectMethod('toObject', propertiesToInclude);
},
/**
* Returns dataless object representation of canvas
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toDatalessObject: function (propertiesToInclude) {
return this._toObjectMethod('toDatalessObject', propertiesToInclude);
},
/**
* @private
*/
_toObjectMethod: function (methodName, propertiesToInclude) {
var activeGroup = this.getActiveGroup();
if (activeGroup) {
this.discardActiveGroup();
}
var data = {
objects: this._toObjects(methodName, propertiesToInclude)
};
extend(data, this.__serializeBgOverlay());
fabric.util.populateWithProperties(this, data, propertiesToInclude);
if (activeGroup) {
this.setActiveGroup(new fabric.Group(activeGroup.getObjects()));
activeGroup.forEachObject(function(o) {
o.set('active', true);
});
}
return data;
},
/**
* @private
*/
_toObjects: function(methodName, propertiesToInclude) {
return this.getObjects().map(function(instance) {
return this._toObject(instance, methodName, propertiesToInclude);
}, this);
},
/**
* @private
*/
_toObject: function(instance, methodName, propertiesToInclude) {
var originalValue;
if (!this.includeDefaultValues) {
originalValue = instance.includeDefaultValues;
instance.includeDefaultValues = false;
}
var object = instance[methodName](propertiesToInclude);
if (!this.includeDefaultValues) {
instance.includeDefaultValues = originalValue;
}
return object;
},
/**
* @private
*/
__serializeBgOverlay: function() {
var data = {
background: (this.backgroundColor && this.backgroundColor.toObject)
? this.backgroundColor.toObject()
: this.backgroundColor
};
if (this.overlayColor) {
data.overlay = this.overlayColor.toObject
? this.overlayColor.toObject()
: this.overlayColor;
}
if (this.backgroundImage) {
data.backgroundImage = this.backgroundImage.toObject();
}
if (this.overlayImage) {
data.overlayImage = this.overlayImage.toObject();
}
return data;
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of canvas
* @function
* @param {Object} [options] Options object for SVG output
* @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included
* @param {Object} [options.viewBox] SVG viewbox object
* @param {Number} [options.viewBox.x] x-cooridnate of viewbox
* @param {Number} [options.viewBox.y] y-coordinate of viewbox
* @param {Number} [options.viewBox.width] Width of viewbox
* @param {Number} [options.viewBox.height] Height of viewbox
* @param {String} [options.encoding=UTF-8] Encoding of SVG output
* @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.
* @return {String} SVG string
* @tutorial {@link http://fabricjs.com/fabric-intro-part-3/#serialization}
* @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}
* @example <caption>Normal SVG output</caption>
* var svg = canvas.toSVG();
* @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>
* var svg = canvas.toSVG({suppressPreamble: true});
* @example <caption>SVG output with viewBox attribute</caption>
* var svg = canvas.toSVG({
*   viewBox: {
*     x: 100,
*     y: 100,
*     width: 200,
*     height: 300
*   }
* });
* @example <caption>SVG output with different encoding (default: UTF-8)</caption>
* var svg = canvas.toSVG({encoding: 'ISO-8859-1'});
* @example <caption>Modify SVG output with reviver function</caption>
* var svg = canvas.toSVG(null, function(svg) {
*   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');
* });
*/
toSVG: function(options, reviver) {
options || (options = { });
var markup = [];
this._setSVGPreamble(markup, options);
this._setSVGHeader(markup, options);
this._setSVGBgOverlayColor(markup, 'backgroundColor');
this._setSVGBgOverlayImage(markup, 'backgroundImage');
this._setSVGObjects(markup, reviver);
this._setSVGBgOverlayColor(markup, 'overlayColor');
this._setSVGBgOverlayImage(markup, 'overlayImage');
markup.push('</svg>');
return markup.join('');
},
/**
* @private
*/
_setSVGPreamble: function(markup, options) {
if (!options.suppressPreamble) {
markup.push(
'<?xml version="1.0" encoding="', (options.encoding || 'UTF-8'), '" standalone="no" ?>',
'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',
'"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'
);
}
},
/**
* @private
*/
_setSVGHeader: function(markup, options) {
markup.push(
'<svg ',
'xmlns="http://www.w3.org/2000/svg" ',
'xmlns:xlink="http://www.w3.org/1999/xlink" ',
'version="1.1" ',
'width="', (options.viewBox ? options.viewBox.width : this.width), '" ',
'height="', (options.viewBox ? options.viewBox.height : this.height), '" ',
(this.backgroundColor && !this.backgroundColor.toLive
? 'style="background-color: ' + this.backgroundColor +'" '
: null),
(options.viewBox
? 'viewBox="' +
options.viewBox.x + ' ' +
options.viewBox.y + ' ' +
options.viewBox.width + ' ' +
options.viewBox.height + '" '
: null),
'xml:space="preserve">',
'<desc>Created with Fabric.js ', fabric.version, '</desc>',
'<defs>',
fabric.createSVGFontFacesMarkup(this.getObjects()),
fabric.createSVGRefElementsMarkup(this),
'</defs>'
);
},
/**
* @private
*/
_setSVGObjects: function(markup, reviver) {
var activeGroup = this.getActiveGroup();
if (activeGroup) {
this.discardActiveGroup();
}
for (var i = 0, objects = this.getObjects(), len = objects.length; i < len; i++) {
markup.push(objects[i].toSVG(reviver));
}
if (activeGroup) {
this.setActiveGroup(new fabric.Group(activeGroup.getObjects()));
activeGroup.forEachObject(function(o) {
o.set('active', true);
});
}
},
/**
* @private
*/
_setSVGBgOverlayImage: function(markup, property) {
if (this[property] && this[property].toSVG) {
markup.push(this[property].toSVG());
}
},
/**
* @private
*/
_setSVGBgOverlayColor: function(markup, property) {
if (this[property] && this[property].source) {
markup.push(
'<rect x="', this[property].offsetX, '" y="', this[property].offsetY, '" ',
'width="',
(this[property].repeat === 'repeat-y' || this[property].repeat === 'no-repeat'
? this[property].source.width
: this.width),
'" height="',
(this[property].repeat === 'repeat-x' || this[property].repeat === 'no-repeat'
? this[property].source.height
: this.height),
'" fill="url(#' + property + 'Pattern)"',
'></rect>'
);
}
else if (this[property] && property === 'overlayColor') {
markup.push(
'<rect x="0" y="0" ',
'width="', this.width,
'" height="', this.height,
'" fill="', this[property], '"',
'></rect>'
);
}
},
/* _TO_SVG_END_ */
/**
* Moves an object to the bottom of the stack of drawn objects
* @param {fabric.Object} object Object to send to back
* @return {fabric.Canvas} thisArg
* @chainable
*/
sendToBack: function (object) {
removeFromArray(this._objects, object);
this._objects.unshift(object);
return this.renderAll && this.renderAll();
},
/**
* Moves an object to the top of the stack of drawn objects
* @param {fabric.Object} object Object to send
* @return {fabric.Canvas} thisArg
* @chainable
*/
bringToFront: function (object) {
removeFromArray(this._objects, object);
this._objects.push(object);
return this.renderAll && this.renderAll();
},
/**
* Moves an object down in stack of drawn objects
* @param {fabric.Object} object Object to send
* @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object
* @return {fabric.Canvas} thisArg
* @chainable
*/
sendBackwards: function (object, intersecting) {
var idx = this._objects.indexOf(object);
if (idx !== 0) {
var newIdx = this._findNewLowerIndex(object, idx, intersecting);
removeFromArray(this._objects, object);
this._objects.splice(newIdx, 0, object);
this.renderAll && this.renderAll();
}
return this;
},
/**
* @private
*/
_findNewLowerIndex: function(object, idx, intersecting) {
var newIdx;
if (intersecting) {
newIdx = idx;
for (var i=idx-1; i>=0; --i) {
var isIntersecting = object.intersectsWithObject(this._objects[i]) ||
object.isContainedWithinObject(this._objects[i]) ||
this._objects[i].isContainedWithinObject(object);
if (isIntersecting) {
newIdx = i;
break;
}
}
}
else {
newIdx = idx - 1;
}
return newIdx;
},
/**
* Moves an object up in stack of drawn objects
* @param {fabric.Object} object Object to send
* @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object
* @return {fabric.Canvas} thisArg
* @chainable
*/
bringForward: function (object, intersecting) {
var idx = this._objects.indexOf(object);
if (idx !== this._objects.length-1) {
var newIdx = this._findNewUpperIndex(object, idx, intersecting);
removeFromArray(this._objects, object);
this._objects.splice(newIdx, 0, object);
this.renderAll && this.renderAll();
}
return this;
},
/**
* @private
*/
_findNewUpperIndex: function(object, idx, intersecting) {
var newIdx;
if (intersecting) {
newIdx = idx;
for (var i = idx + 1; i < this._objects.length; ++i) {
var isIntersecting = object.intersectsWithObject(this._objects[i]) ||
object.isContainedWithinObject(this._objects[i]) ||
this._objects[i].isContainedWithinObject(object);
if (isIntersecting) {
newIdx = i;
break;
}
}
}
else {
newIdx = idx+1;
}
return newIdx;
},
/**
* Moves an object to specified level in stack of drawn objects
* @param {fabric.Object} object Object to send
* @param {Number} index Position to move to
* @return {fabric.Canvas} thisArg
* @chainable
*/
moveTo: function (object, index) {
removeFromArray(this._objects, object);
this._objects.splice(index, 0, object);
return this.renderAll && this.renderAll();
},
/**
* Clears a canvas element and removes all event listeners
* @return {fabric.Canvas} thisArg
* @chainable
*/
dispose: function () {
this.clear();
this.interactive && this.removeListeners();
return this;
},
/**
* Returns a string representation of an instance
* @return {String} string representation of an instance
*/
toString: function () {
return '#<fabric.Canvas (' + this.complexity() + '): '+
'{ objects: ' + this.getObjects().length + ' }>';
}
});
extend(fabric.StaticCanvas.prototype, fabric.Observable);
extend(fabric.StaticCanvas.prototype, fabric.Collection);
extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);
extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {
/**
* @static
* @type String
* @default
*/
EMPTY_JSON: '{"objects": [], "background": "white"}',
/**
* Provides a way to check support of some of the canvas methods
* (either those of HTMLCanvasElement itself, or rendering context)
*
* @param methodName {String} Method to check support for;
*                            Could be one of "getImageData", "toDataURL", "toDataURLWithQuality" or "setLineDash"
* @return {Boolean | null} `true` if method is supported (or at least exists),
*                          `null` if canvas element or context can not be initialized
*/
supports: function (methodName) {
var el = fabric.util.createCanvasElement();
if (!el || !el.getContext) {
return null;
}
var ctx = el.getContext('2d');
if (!ctx) {
return null;
}
switch (methodName) {
case 'getImageData':
return typeof ctx.getImageData !== 'undefined';
case 'setLineDash':
return typeof ctx.setLineDash !== 'undefined';
case 'toDataURL':
return typeof el.toDataURL !== 'undefined';
case 'toDataURLWithQuality':
try {
el.toDataURL('image/jpeg', 0);
return true;
}
catch (e) { }
return false;
default:
return null;
}
}
});
/**
* Returns JSON representation of canvas
* @function
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {String} JSON string
* @tutorial {@link http://fabricjs.com/fabric-intro-part-3/#serialization}
* @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}
* @example <caption>JSON without additional properties</caption>
* var json = canvas.toJSON();
* @example <caption>JSON with additional properties included</caption>
* var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling']);
* @example <caption>JSON without default values</caption>
* canvas.includeDefaultValues = false;
* var json = canvas.toJSON();
*/
fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;
})();
/**
* BaseBrush class
* @class fabric.BaseBrush
* @see {@link http://fabricjs.com/freedrawing/|Freedrawing demo}
*/
fabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {
/**
* Color of a brush
* @type String
* @default
*/
color:            'rgb(0, 0, 0)',
/**
* Width of a brush
* @type Number
* @default
*/
width:            1,
/**
* Shadow object representing shadow of this shape.
* <b>Backwards incompatibility note:</b> This property replaces "shadowColor" (String), "shadowOffsetX" (Number),
* "shadowOffsetY" (Number) and "shadowBlur" (Number) since v1.2.12
* @type fabric.Shadow
* @default
*/
shadow:          null,
/**
* Line endings style of a brush (one of "butt", "round", "square")
* @type String
* @default
*/
strokeLineCap:    'round',
/**
* Corner style of a brush (one of "bevil", "round", "miter")
* @type String
* @default
*/
strokeLineJoin:   'round',
/**
* Sets shadow of an object
* @param {Object|String} [options] Options object or string (e.g. "2px 2px 10px rgba(0,0,0,0.2)")
* @return {fabric.Object} thisArg
* @chainable
*/
setShadow: function(options) {
this.shadow = new fabric.Shadow(options);
return this;
},
/**
* Sets brush styles
* @private
*/
_setBrushStyles: function() {
var ctx = this.canvas.contextTop;
ctx.strokeStyle = this.color;
ctx.lineWidth = this.width;
ctx.lineCap = this.strokeLineCap;
ctx.lineJoin = this.strokeLineJoin;
},
/**
* Sets brush shadow styles
* @private
*/
_setShadow: function() {
if (!this.shadow) return;
var ctx = this.canvas.contextTop;
ctx.shadowColor = this.shadow.color;
ctx.shadowBlur = this.shadow.blur;
ctx.shadowOffsetX = this.shadow.offsetX;
ctx.shadowOffsetY = this.shadow.offsetY;
},
/**
* Removes brush shadow styles
* @private
*/
_resetShadow: function() {
var ctx = this.canvas.contextTop;
ctx.shadowColor = '';
ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;
}
});
(function() {
var utilMin = fabric.util.array.min,
utilMax = fabric.util.array.max;
/**
* PencilBrush class
* @class fabric.PencilBrush
* @extends fabric.BaseBrush
*/
fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {
/**
* Constructor
* @param {fabric.Canvas} canvas
* @return {fabric.PencilBrush} Instance of a pencil brush
*/
initialize: function(canvas) {
this.canvas = canvas;
this._points = [ ];
},
/**
* Inovoked on mouse down
* @param {Object} pointer
*/
onMouseDown: function(pointer) {
this._prepareForDrawing(pointer);
this._captureDrawingPath(pointer);
this._render();
},
/**
* Inovoked on mouse move
* @param {Object} pointer
*/
onMouseMove: function(pointer) {
this._captureDrawingPath(pointer);
this.canvas.clearContext(this.canvas.contextTop);
this._render();
},
/**
* Invoked on mouse up
*/
onMouseUp: function() {
this._finalizeAndAddPath();
},
/**
* @param {Object} pointer
*/
_prepareForDrawing: function(pointer) {
var p = new fabric.Point(pointer.x, pointer.y);
this._reset();
this._addPoint(p);
this.canvas.contextTop.moveTo(p.x, p.y);
},
/**
* @private
* @param {fabric.Point} point
*/
_addPoint: function(point) {
this._points.push(point);
},
/**
* Clear points array and set contextTop canvas
* style.
*
* @private
*
*/
_reset: function() {
this._points.length = 0;
this._setBrushStyles();
this._setShadow();
},
/**
* @private
*
* @param point {pointer} (fabric.util.pointer) actual mouse position
*   related to the canvas.
*/
_captureDrawingPath: function(pointer) {
var pointerPoint = new fabric.Point(pointer.x, pointer.y);
this._addPoint(pointerPoint);
},
/**
* Draw a smooth path on the topCanvas using quadraticCurveTo
*
* @private
*/
_render: function() {
var ctx  = this.canvas.contextTop;
ctx.beginPath();
var p1 = this._points[0];
var p2 = this._points[1];
if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {
p1.x -= 0.5;
p2.x += 0.5;
}
ctx.moveTo(p1.x, p1.y);
for (var i = 1, len = this._points.length; i < len; i++) {
var midPoint = p1.midPointFrom(p2);
ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);
p1 = this._points[i];
p2 = this._points[i+1];
}
ctx.lineTo(p1.x, p1.y);
ctx.stroke();
},
/**
* Return an SVG path based on our captured points and their bounding box
*
* @private
*/
_getSVGPathData: function() {
this.box = this.getPathBoundingBox(this._points);
return this.convertPointsToSVGPath(
this._points, this.box.minx, this.box.maxx, this.box.miny, this.box.maxy);
},
/**
* Returns bounding box of a path based on given points
* @param {Array} points
* @return {Object} object with minx, miny, maxx, maxy
*/
getPathBoundingBox: function(points) {
var xBounds = [],
yBounds = [],
p1 = points[0],
p2 = points[1],
startPoint = p1;
for (var i = 1, len = points.length; i < len; i++) {
var midPoint = p1.midPointFrom(p2);
xBounds.push(startPoint.x);
xBounds.push(midPoint.x);
yBounds.push(startPoint.y);
yBounds.push(midPoint.y);
p1 = points[i];
p2 = points[i+1];
startPoint = midPoint;
} // end for
xBounds.push(p1.x);
yBounds.push(p1.y);
return {
minx: utilMin(xBounds),
miny: utilMin(yBounds),
maxx: utilMax(xBounds),
maxy: utilMax(yBounds)
};
},
/**
* Converts points to SVG path
* @param {Array} points Array of points
* @return {String} SVG path
*/
convertPointsToSVGPath: function(points, minX, maxX, minY) {
var path = [];
var p1 = new fabric.Point(points[0].x - minX, points[0].y - minY);
var p2 = new fabric.Point(points[1].x - minX, points[1].y - minY);
path.push('M ', points[0].x - minX, ' ', points[0].y - minY, ' ');
for (var i = 1, len = points.length; i < len; i++) {
var midPoint = p1.midPointFrom(p2);
path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');
p1 = new fabric.Point(points[i].x - minX, points[i].y - minY);
if ((i+1) < points.length) {
p2 = new fabric.Point(points[i+1].x - minX, points[i+1].y - minY);
}
}
path.push('L ', p1.x, ' ', p1.y, ' ');
return path;
},
/**
* Creates fabric.Path object to add on canvas
* @param {String} pathData Path data
* @return {fabric.Path} path to add on canvas
*/
createPath: function(pathData) {
var path = new fabric.Path(pathData);
path.fill = null;
path.stroke = this.color;
path.strokeWidth = this.width;
path.strokeLineCap = this.strokeLineCap;
path.strokeLineJoin = this.strokeLineJoin;
if (this.shadow) {
this.shadow.affectStroke = true;
path.setShadow(this.shadow);
}
return path;
},
/**
* On mouseup after drawing the path on contextTop canvas
* we use the points captured to create an new fabric path object
* and add it to the fabric canvas.
*
*/
_finalizeAndAddPath: function() {
var ctx = this.canvas.contextTop;
ctx.closePath();
var pathData = this._getSVGPathData().join('');
if (pathData === "M 0 0 Q 0 0 0 0 L 0 0") {
this.canvas.renderAll();
return;
}
var originLeft = this.box.minx  + (this.box.maxx - this.box.minx) /2;
var originTop = this.box.miny  + (this.box.maxy - this.box.miny) /2;
this.canvas.contextTop.arc(originLeft, originTop, 3, 0, Math.PI * 2, false);
var path = this.createPath(pathData);
path.set({
left: originLeft,
top: originTop,
originX: 'center',
originY: 'center'
});
this.canvas.add(path);
path.setCoords();
this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();
this.canvas.renderAll();
this.canvas.fire('path:created', { path: path });
}
});
})();
/**
* CircleBrush class
* @class fabric.CircleBrush
*/
fabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {
/**
* Width of a brush
* @type Number
* @default
*/
width: 10,
/**
* Constructor
* @param {fabric.Canvas} canvas
* @return {fabric.CircleBrush} Instance of a circle brush
*/
initialize: function(canvas) {
this.canvas = canvas;
this.points = [ ];
},
/**
* Invoked inside on mouse down and mouse move
* @param {Object} pointer
*/
drawDot: function(pointer) {
var point = this.addPoint(pointer);
var ctx = this.canvas.contextTop;
ctx.fillStyle = point.fill;
ctx.beginPath();
ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);
ctx.closePath();
ctx.fill();
},
/**
* Invoked on mouse down
*/
onMouseDown: function(pointer) {
this.points.length = 0;
this.canvas.clearContext(this.canvas.contextTop);
this._setShadow();
this.drawDot(pointer);
},
/**
* Invoked on mouse move
* @param {Object} pointer
*/
onMouseMove: function(pointer) {
this.drawDot(pointer);
},
/**
* Invoked on mouse up
*/
onMouseUp: function() {
var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;
this.canvas.renderOnAddRemove = false;
var circles = [ ];
for (var i = 0, len = this.points.length; i < len; i++) {
var point = this.points[i];
var circle = new fabric.Circle({
radius: point.radius,
left: point.x,
top: point.y,
originX: 'center',
originY: 'center',
fill: point.fill
});
this.shadow && circle.setShadow(this.shadow);
circles.push(circle);
}
var group = new fabric.Group(circles, { originX: 'center', originY: 'center' });
this.canvas.add(group);
this.canvas.fire('path:created', { path: group });
this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();
this.canvas.renderOnAddRemove = originalRenderOnAddRemove;
this.canvas.renderAll();
},
/**
* @param {Object} pointer
* @return {fabric.Point} Just added pointer point
*/
addPoint: function(pointer) {
var pointerPoint = new fabric.Point(pointer.x, pointer.y);
var circleRadius = fabric.util.getRandomInt(
Math.max(0, this.width - 20), this.width + 20) / 2;
var circleColor = new fabric.Color(this.color)
.setAlpha(fabric.util.getRandomInt(0, 100) / 100)
.toRgba();
pointerPoint.radius = circleRadius;
pointerPoint.fill = circleColor;
this.points.push(pointerPoint);
return pointerPoint;
}
});
/**
* SprayBrush class
* @class fabric.SprayBrush
*/
fabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {
/**
* Width of a spray
* @type Number
* @default
*/
width:              10,
/**
* Density of a spray (number of dots per chunk)
* @type Number
* @default
*/
density:            20,
/**
* Width of spray dots
* @type Number
* @default
*/
dotWidth:           1,
/**
* Width variance of spray dots
* @type Number
* @default
*/
dotWidthVariance:   1,
/**
* Whether opacity of a dot should be random
* @type Boolean
* @default
*/
randomOpacity:        false,
/**
* Whether overlapping dots (rectangles) should be removed (for performance reasons)
* @type Boolean
* @default
*/
optimizeOverlapping:  true,
/**
* Constructor
* @param {fabric.Canvas} canvas
* @return {fabric.SprayBrush} Instance of a spray brush
*/
initialize: function(canvas) {
this.canvas = canvas;
this.sprayChunks = [ ];
},
/**
* Invoked on mouse down
* @param {Object} pointer
*/
onMouseDown: function(pointer) {
this.sprayChunks.length = 0;
this.canvas.clearContext(this.canvas.contextTop);
this._setShadow();
this.addSprayChunk(pointer);
this.render();
},
/**
* Invoked on mouse move
* @param {Object} pointer
*/
onMouseMove: function(pointer) {
this.addSprayChunk(pointer);
this.render();
},
/**
* Invoked on mouse up
*/
onMouseUp: function() {
var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;
this.canvas.renderOnAddRemove = false;
var rects = [ ];
for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {
var sprayChunk = this.sprayChunks[i];
for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {
var rect = new fabric.Rect({
width: sprayChunk[j].width,
height: sprayChunk[j].width,
left: sprayChunk[j].x + 1,
top: sprayChunk[j].y + 1,
originX: 'center',
originY: 'center',
fill: this.color
});
this.shadow && rect.setShadow(this.shadow);
rects.push(rect);
}
}
if (this.optimizeOverlapping) {
rects = this._getOptimizedRects(rects);
}
var group = new fabric.Group(rects, { originX: 'center', originY: 'center' });
this.canvas.add(group);
this.canvas.fire('path:created', { path: group });
this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();
this.canvas.renderOnAddRemove = originalRenderOnAddRemove;
this.canvas.renderAll();
},
_getOptimizedRects: function(rects) {
var uniqueRects = { }, key;
for (var i = 0, len = rects.length; i < len; i++) {
key = rects[i].left + '' + rects[i].top;
if (!uniqueRects[key]) {
uniqueRects[key] = rects[i];
}
}
var uniqueRectsArray = [ ];
for (key in uniqueRects) {
uniqueRectsArray.push(uniqueRects[key]);
}
return uniqueRectsArray;
},
/**
* Renders brush
*/
render: function() {
var ctx = this.canvas.contextTop;
ctx.fillStyle = this.color;
ctx.save();
for (var i = 0, len = this.sprayChunkPoints.length; i < len; i++) {
var point = this.sprayChunkPoints[i];
if (typeof point.opacity !== 'undefined') {
ctx.globalAlpha = point.opacity;
}
ctx.fillRect(point.x, point.y, point.width, point.width);
}
ctx.restore();
},
/**
* @param {Object} pointer
*/
addSprayChunk: function(pointer) {
this.sprayChunkPoints = [ ];
var x, y, width, radius = this.width / 2;
for (var i = 0; i < this.density; i++) {
x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);
y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);
if (this.dotWidthVariance) {
width = fabric.util.getRandomInt(
Math.max(1, this.dotWidth - this.dotWidthVariance),
this.dotWidth + this.dotWidthVariance);
}
else {
width = this.dotWidth;
}
var point = { x: x, y: y, width: width };
if (this.randomOpacity) {
point.opacity = fabric.util.getRandomInt(0, 100) / 100;
}
this.sprayChunkPoints.push(point);
}
this.sprayChunks.push(this.sprayChunkPoints);
}
});
/**
* PatternBrush class
* @class fabric.PatternBrush
* @extends fabric.BaseBrush
*/
fabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {
getPatternSrc: function() {
var dotWidth = 20,
dotDistance = 5,
patternCanvas = fabric.document.createElement('canvas'),
patternCtx = patternCanvas.getContext('2d');
patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;
patternCtx.fillStyle = this.color;
patternCtx.beginPath();
patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);
patternCtx.closePath();
patternCtx.fill();
return patternCanvas;
},
getPatternSrcFunction: function() {
return String(this.getPatternSrc).replace('this.color', '"' + this.color + '"');
},
/**
* Creates "pattern" instance property
*/
getPattern: function() {
return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), 'repeat');
},
/**
* Sets brush styles
*/
_setBrushStyles: function() {
this.callSuper('_setBrushStyles');
this.canvas.contextTop.strokeStyle = this.getPattern();
},
/**
* Creates path
*/
createPath: function(pathData) {
var path = this.callSuper('createPath', pathData);
path.stroke = new fabric.Pattern({
source: this.source || this.getPatternSrcFunction()
});
return path;
}
});
(function() {
var getPointer = fabric.util.getPointer,
degreesToRadians = fabric.util.degreesToRadians,
radiansToDegrees = fabric.util.radiansToDegrees,
atan2 = Math.atan2,
abs = Math.abs,
STROKE_OFFSET = 0.5;
/**
* Canvas class
* @class fabric.Canvas
* @extends fabric.StaticCanvas
* @tutorial {@link http://fabricjs.com/fabric-intro-part-1/#canvas}
* @see {@link fabric.Canvas#initialize} for constructor definition
*
* @fires object:modified
* @fires object:rotating
* @fires object:scaling
* @fires object:moving
* @fires object:selected
*
* @fires before:selection:cleared
* @fires selection:cleared
* @fires selection:created
*
* @fires path:created
* @fires mouse:down
* @fires mouse:move
* @fires mouse:up
*
*/
fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {
/**
* Constructor
* @param {HTMLElement | String} el &lt;canvas> element to initialize instance on
* @param {Object} [options] Options object
* @return {Object} thisArg
*/
initialize: function(el, options) {
options || (options = { });
this._initStatic(el, options);
this._initInteractive();
this._createCacheCanvas();
fabric.Canvas.activeInstance = this;
},
/**
* When true, objects can be transformed by one side (unproportionally)
* @type Boolean
* @default
*/
uniScaleTransform:      false,
/**
* When true, objects use center point as the origin of scale transformation.
* <b>Backwards incompatibility note:</b> This property replaces "centerTransform" (Boolean).
* @since 1.3.4
* @type Boolean
* @default
*/
centeredScaling:        false,
/**
* When true, objects use center point as the origin of rotate transformation.
* <b>Backwards incompatibility note:</b> This property replaces "centerTransform" (Boolean).
* @since 1.3.4
* @type Boolean
* @default
*/
centeredRotation:       false,
/**
* Indicates that canvas is interactive. This property should not be changed.
* @type Boolean
* @default
*/
interactive:            true,
/**
* Indicates whether group selection should be enabled
* @type Boolean
* @default
*/
selection:              true,
/**
* Color of selection
* @type String
* @default
*/
selectionColor:         'rgba(100, 100, 255, 0.3)', // blue
/**
* Default dash array pattern
* If not empty the selection border is dashed
* @type Array
*/
selectionDashArray:     [ ],
/**
* Color of the border of selection (usually slightly darker than color of selection itself)
* @type String
* @default
*/
selectionBorderColor:   'rgba(255, 255, 255, 0.3)',
/**
* Width of a line used in object/group selection
* @type Number
* @default
*/
selectionLineWidth:     1,
/**
* Default cursor value used when hovering over an object on canvas
* @type String
* @default
*/
hoverCursor:            'move',
/**
* Default cursor value used when moving an object on canvas
* @type String
* @default
*/
moveCursor:             'move',
/**
* Default cursor value used for the entire canvas
* @type String
* @default
*/
defaultCursor:          'default',
/**
* Cursor value used during free drawing
* @type String
* @default
*/
freeDrawingCursor:      'crosshair',
/**
* Cursor value used for rotation point
* @type String
* @default
*/
rotationCursor:         'crosshair',
/**
* Default element class that's given to wrapper (div) element of canvas
* @type String
* @default
*/
containerClass:         'canvas-container',
/**
* When true, object detection happens on per-pixel basis rather than on per-bounding-box
* @type Boolean
* @default
*/
perPixelTargetFind:     false,
/**
* Number of pixels around target pixel to tolerate (consider active) during object detection
* @type Number
* @default
*/
targetFindTolerance:    0,
/**
* When true, target detection is skipped when hovering over canvas. This can be used to improve performance.
* @type Boolean
* @default
*/
skipTargetFind:         false,
/**
* @private
*/
_initInteractive: function() {
this._currentTransform = null;
this._groupSelector = null;
this._initWrapperElement();
this._createUpperCanvas();
this._initEventListeners();
this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);
this.calcOffset();
},
/**
* Resets the current transform to its original values and chooses the type of resizing based on the event
* @private
* @param {Event} e Event object fired on mousemove
*/
_resetCurrentTransform: function(e) {
var t = this._currentTransform;
t.target.set({
'scaleX': t.original.scaleX,
'scaleY': t.original.scaleY,
'left': t.original.left,
'top': t.original.top
});
if (this._shouldCenterTransform(e, t.target)) {
if (t.action === 'rotate') {
this._setOriginToCenter(t.target);
}
else {
if (t.originX !== 'center') {
if (t.originX === 'right') {
t.mouseXSign = -1;
}
else {
t.mouseXSign = 1;
}
}
if (t.originY !== 'center') {
if (t.originY === 'bottom') {
t.mouseYSign = -1;
}
else {
t.mouseYSign = 1;
}
}
t.originX = 'center';
t.originY = 'center';
}
}
else {
t.originX = t.original.originX;
t.originY = t.original.originY;
}
},
/**
* Checks if point is contained within an area of given object
* @param {Event} e Event object
* @param {fabric.Object} target Object to test against
* @return {Boolean} true if point is contained within an area of given object
*/
containsPoint: function (e, target) {
var pointer = this.getPointer(e),
xy = this._normalizePointer(target, pointer);
return (target.containsPoint(xy) || target._findTargetCorner(e, this._offset));
},
/**
* @private
*/
_normalizePointer: function (object, pointer) {
var activeGroup = this.getActiveGroup(),
x = pointer.x,
y = pointer.y;
var isObjectInGroup = (
activeGroup &&
object.type !== 'group' &&
activeGroup.contains(object)
);
if (isObjectInGroup) {
x -= activeGroup.left;
y -= activeGroup.top;
}
return { x: x, y: y };
},
/**
* Returns true if object is transparent at a certain location
* @param {fabric.Object} target Object to check
* @param {Number} x Left coordinate
* @param {Number} y Top coordinate
* @return {Boolean}
*/
isTargetTransparent: function (target, x, y) {
var hasBorders = target.hasBorders,
transparentCorners = target.transparentCorners;
target.hasBorders = target.transparentCorners = false;
this._draw(this.contextCache, target);
target.hasBorders = hasBorders;
target.transparentCorners = transparentCorners;
var isTransparent = fabric.util.isTransparent(
this.contextCache, x, y, this.targetFindTolerance);
this.clearContext(this.contextCache);
return isTransparent;
},
/**
* @private
* @param {Event} e Event object
* @param {fabric.Object} target
*/
_shouldClearSelection: function (e, target) {
var activeGroup = this.getActiveGroup(),
activeObject = this.getActiveObject();
return (
!target
||
(target &&
activeGroup &&
!activeGroup.contains(target) &&
activeGroup !== target &&
!e.shiftKey)
||
(target && !target.evented)
||
(target &&
!target.selectable &&
activeObject &&
activeObject !== target)
);
},
/**
* @private
* @param {Event} e Event object
* @param {fabric.Object} target
*/
_shouldCenterTransform: function (e, target) {
if (!target) return;
var t = this._currentTransform,
centerTransform;
if (t.action === 'scale' || t.action === 'scaleX' || t.action === 'scaleY') {
centerTransform = this.centeredScaling || target.centeredScaling;
}
else if (t.action === 'rotate') {
centerTransform = this.centeredRotation || target.centeredRotation;
}
return centerTransform ? !e.altKey : e.altKey;
},
/**
* @private
*/
_getOriginFromCorner: function(target, corner) {
var origin = {
x: target.originX,
y: target.originY
};
if (corner === 'ml' || corner === 'tl' || corner === 'bl') {
origin.x = 'right';
}
else if (corner === 'mr' || corner === 'tr' || corner === 'br') {
origin.x = 'left';
}
if (corner === 'tl' || corner === 'mt' || corner === 'tr') {
origin.y = 'bottom';
}
else if (corner === 'bl' || corner === 'mb' || corner === 'br') {
origin.y = 'top';
}
return origin;
},
/**
* @private
*/
_getActionFromCorner: function(target, corner) {
var action = 'drag';
if (corner) {
action = (corner === 'ml' || corner === 'mr')
? 'scaleX'
: (corner === 'mt' || corner === 'mb')
? 'scaleY'
: corner === 'mtr'
? 'rotate'
: 'scale';
}
return action;
},
/**
* @private
* @param {Event} e Event object
* @param {fabric.Object} target
*/
_setupCurrentTransform: function (e, target) {
if (!target) return;
var corner = target._findTargetCorner(e, this._offset),
pointer = getPointer(e, target.canvas.upperCanvasEl),
action = this._getActionFromCorner(target, corner),
origin = this._getOriginFromCorner(target, corner);
this._currentTransform = {
target: target,
action: action,
scaleX: target.scaleX,
scaleY: target.scaleY,
offsetX: pointer.x - target.left,
offsetY: pointer.y - target.top,
originX: origin.x,
originY: origin.y,
ex: pointer.x,
ey: pointer.y,
left: target.left,
top: target.top,
theta: degreesToRadians(target.angle),
width: target.width * target.scaleX,
mouseXSign: 1,
mouseYSign: 1
};
this._currentTransform.original = {
left: target.left,
top: target.top,
scaleX: target.scaleX,
scaleY: target.scaleY,
originX: origin.x,
originY: origin.y
};
this._resetCurrentTransform(e);
},
/**
* Translates object by "setting" its left/top
* @private
* @param x {Number} pointer's x coordinate
* @param y {Number} pointer's y coordinate
*/
_translateObject: function (x, y) {
var target = this._currentTransform.target;
if (!target.get('lockMovementX')) {
target.set('left', x - this._currentTransform.offsetX);
}
if (!target.get('lockMovementY')) {
target.set('top', y - this._currentTransform.offsetY);
}
},
/**
* Scales object by invoking its scaleX/scaleY methods
* @private
* @param x {Number} pointer's x coordinate
* @param y {Number} pointer's y coordinate
* @param by {String} Either 'x' or 'y' - specifies dimension constraint by which to scale an object.
*                    When not provided, an object is scaled by both dimensions equally
*/
_scaleObject: function (x, y, by) {
var t = this._currentTransform,
offset = this._offset,
target = t.target,
lockScalingX = target.get('lockScalingX'),
lockScalingY = target.get('lockScalingY');
if (lockScalingX && lockScalingY) return;
var constraintPosition = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);
var localMouse = target.toLocalPoint(new fabric.Point(x - offset.left, y - offset.top), t.originX, t.originY);
this._setLocalMouse(localMouse, t);
this._setObjectScale(localMouse, t, lockScalingX, lockScalingY, by);
target.setPositionByOrigin(constraintPosition, t.originX, t.originY);
},
/**
* @private
*/
_setObjectScale: function(localMouse, transform, lockScalingX, lockScalingY, by) {
var target = transform.target;
transform.newScaleX = target.scaleX;
transform.newScaleY = target.scaleY;
if (by === 'equally' && !lockScalingX && !lockScalingY) {
this._scaleObjectEqually(localMouse, target, transform);
}
else if (!by) {
transform.newScaleX = localMouse.x / (target.width + target.strokeWidth);
transform.newScaleY = localMouse.y / (target.height + target.strokeWidth);
lockScalingX || target.set('scaleX', transform.newScaleX);
lockScalingY || target.set('scaleY', transform.newScaleY);
}
else if (by === 'x' && !target.get('lockUniScaling')) {
transform.newScaleX = localMouse.x / (target.width + target.strokeWidth);
lockScalingX || target.set('scaleX', transform.newScaleX);
}
else if (by === 'y' && !target.get('lockUniScaling')) {
transform.newScaleY = localMouse.y / (target.height + target.strokeWidth);
lockScalingY || target.set('scaleY', transform.newScaleY);
}
this._flipObject(transform);
},
/**
* @private
*/
_scaleObjectEqually: function(localMouse, target, transform) {
var dist = localMouse.y + localMouse.x;
var lastDist = (target.height + (target.strokeWidth)) * transform.original.scaleY +
(target.width + (target.strokeWidth)) * transform.original.scaleX;
transform.newScaleX = transform.original.scaleX * dist / lastDist;
transform.newScaleY = transform.original.scaleY * dist / lastDist;
target.set('scaleX', transform.newScaleX);
target.set('scaleY', transform.newScaleY);
},
/**
* @private
*/
_flipObject: function(transform) {
if (transform.newScaleX < 0) {
if (transform.originX === 'left') {
transform.originX = 'right';
}
else if (transform.originX === 'right') {
transform.originX = 'left';
}
}
if (transform.newScaleY < 0) {
if (transform.originY === 'top') {
transform.originY = 'bottom';
}
else if (transform.originY === 'bottom') {
transform.originY = 'top';
}
}
},
/**
* @private
*/
_setLocalMouse: function(localMouse, t) {
var target = t.target;
if (t.originX === 'right') {
localMouse.x *= -1;
}
else if (t.originX === 'center') {
localMouse.x *= t.mouseXSign * 2;
if (localMouse.x < 0) {
t.mouseXSign = -t.mouseXSign;
}
}
if (t.originY === 'bottom') {
localMouse.y *= -1;
}
else if (t.originY === 'center') {
localMouse.y *= t.mouseYSign * 2;
if (localMouse.y < 0) {
t.mouseYSign = -t.mouseYSign;
}
}
if (abs(localMouse.x) > target.padding) {
if (localMouse.x < 0) {
localMouse.x += target.padding;
}
else {
localMouse.x -= target.padding;
}
}
else { // mouse is within the padding, set to 0
localMouse.x = 0;
}
if (abs(localMouse.y) > target.padding) {
if (localMouse.y < 0) {
localMouse.y += target.padding;
}
else {
localMouse.y -= target.padding;
}
}
else {
localMouse.y = 0;
}
},
/**
* Rotates object by invoking its rotate method
* @private
* @param x {Number} pointer's x coordinate
* @param y {Number} pointer's y coordinate
*/
_rotateObject: function (x, y) {
var t = this._currentTransform,
o = this._offset;
if (t.target.get('lockRotation')) return;
var lastAngle = atan2(t.ey - t.top - o.top, t.ex - t.left - o.left),
curAngle = atan2(y - t.top - o.top, x - t.left - o.left),
angle = radiansToDegrees(curAngle - lastAngle + t.theta);
if (angle < 0) {
angle = 360 + angle;
}
t.target.angle = angle;
},
/**
* @private
*/
_setCursor: function (value) {
this.upperCanvasEl.style.cursor = value;
},
/**
* @private
*/
_resetObjectTransform: function (target) {
target.scaleX = 1;
target.scaleY = 1;
target.setAngle(0);
},
/**
* @private
*/
_drawSelection: function () {
var ctx = this.contextTop,
groupSelector = this._groupSelector,
left = groupSelector.left,
top = groupSelector.top,
aleft = abs(left),
atop = abs(top);
ctx.fillStyle = this.selectionColor;
ctx.fillRect(
groupSelector.ex - ((left > 0) ? 0 : -left),
groupSelector.ey - ((top > 0) ? 0 : -top),
aleft,
atop
);
ctx.lineWidth = this.selectionLineWidth;
ctx.strokeStyle = this.selectionBorderColor;
if (this.selectionDashArray.length > 1) {
var px = groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0: aleft);
var py = groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0: atop);
ctx.beginPath();
fabric.util.drawDashedLine(ctx, px, py, px+aleft, py, this.selectionDashArray);
fabric.util.drawDashedLine(ctx, px, py+atop-1, px+aleft, py+atop-1, this.selectionDashArray);
fabric.util.drawDashedLine(ctx, px, py, px, py+atop, this.selectionDashArray);
fabric.util.drawDashedLine(ctx, px+aleft-1, py, px+aleft-1, py+atop, this.selectionDashArray);
ctx.closePath();
ctx.stroke();
}
else {
ctx.strokeRect(
groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),
groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),
aleft,
atop
);
}
},
/**
* @private
*/
_isLastRenderedObject: function(e) {
return (
this.controlsAboveOverlay &&
this.lastRenderedObjectWithControlsAboveOverlay &&
this.lastRenderedObjectWithControlsAboveOverlay.visible &&
this.containsPoint(e, this.lastRenderedObjectWithControlsAboveOverlay) &&
this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(e, this._offset));
},
/**
* Method that determines what object we are clicking on
* @param {Event} e mouse event
* @param {Boolean} skipGroup when true, group is skipped and only objects are traversed through
*/
findTarget: function (e, skipGroup) {
if (this.skipTargetFind) return;
if (this._isLastRenderedObject(e)) {
return this.lastRenderedObjectWithControlsAboveOverlay;
}
var activeGroup = this.getActiveGroup();
if (activeGroup && !skipGroup && this.containsPoint(e, activeGroup)) {
return activeGroup;
}
return this._searchPossibleTargets(e);
},
/**
* @private
*/
_searchPossibleTargets: function(e) {
var possibleTargets = [],
target,
pointer = this.getPointer(e);
for (var i = this._objects.length; i--; ) {
if (this._objects[i] &&
this._objects[i].visible &&
this._objects[i].evented &&
this.containsPoint(e, this._objects[i])) {
if (this.perPixelTargetFind || this._objects[i].perPixelTargetFind) {
possibleTargets[possibleTargets.length] = this._objects[i];
}
else {
target = this._objects[i];
this.relatedTarget = target;
break;
}
}
}
for (var j = 0, len = possibleTargets.length; j < len; j++) {
pointer = this.getPointer(e);
var isTransparent = this.isTargetTransparent(possibleTargets[j], pointer.x, pointer.y);
if (!isTransparent) {
target = possibleTargets[j];
this.relatedTarget = target;
break;
}
}
return target;
},
/**
* Returns pointer coordinates relative to canvas.
* @param {Event} e
* @return {Object} object with "x" and "y" number values
*/
getPointer: function (e) {
var pointer = getPointer(e, this.upperCanvasEl);
return {
x: pointer.x - this._offset.left,
y: pointer.y - this._offset.top
};
},
/**
* @private
* @param {HTMLElement|String} canvasEl Canvas element
* @throws {CANVAS_INIT_ERROR} If canvas can not be initialized
*/
_createUpperCanvas: function () {
var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/, '');
this.upperCanvasEl = this._createCanvasElement();
fabric.util.addClass(this.upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);
this.wrapperEl.appendChild(this.upperCanvasEl);
this._copyCanvasStyle(this.lowerCanvasEl, this.upperCanvasEl);
this._applyCanvasStyle(this.upperCanvasEl);
this.contextTop = this.upperCanvasEl.getContext('2d');
},
/**
* @private
*/
_createCacheCanvas: function () {
this.cacheCanvasEl = this._createCanvasElement();
this.cacheCanvasEl.setAttribute('width', this.width);
this.cacheCanvasEl.setAttribute('height', this.height);
this.contextCache = this.cacheCanvasEl.getContext('2d');
},
/**
* @private
* @param {Number} width
* @param {Number} height
*/
_initWrapperElement: function () {
this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {
'class': this.containerClass
});
fabric.util.setStyle(this.wrapperEl, {
width: this.getWidth() + 'px',
height: this.getHeight() + 'px',
position: 'relative'
});
fabric.util.makeElementUnselectable(this.wrapperEl);
},
/**
* @private
* @param {Element} element
*/
_applyCanvasStyle: function (element) {
var width = this.getWidth() || element.width,
height = this.getHeight() || element.height;
fabric.util.setStyle(element, {
position: 'absolute',
width: width + 'px',
height: height + 'px',
left: 0,
top: 0
});
element.width = width;
element.height = height;
fabric.util.makeElementUnselectable(element);
},
/**
* Copys the the entire inline style from one element (fromEl) to another (toEl)
* @private
* @param {Element} fromEl Element style is copied from
* @param {Element} toEl Element copied style is applied to
*/
_copyCanvasStyle: function (fromEl, toEl) {
toEl.style.cssText = fromEl.style.cssText;
},
/**
* Returns context of canvas where object selection is drawn
* @return {CanvasRenderingContext2D}
*/
getSelectionContext: function() {
return this.contextTop;
},
/**
* Returns &lt;canvas> element on which object selection is drawn
* @return {HTMLCanvasElement}
*/
getSelectionElement: function () {
return this.upperCanvasEl;
},
/**
* @private
* @param {Object} object
*/
_setActiveObject: function(object) {
if (this._activeObject) {
this._activeObject.set('active', false);
}
this._activeObject = object;
object.set('active', true);
},
/**
* Sets given object as the only active object on canvas
* @param {fabric.Object} object Object to set as an active one
* @param {Event} [e] Event (passed along when firing "object:selected")
* @return {fabric.Canvas} thisArg
* @chainable
*/
setActiveObject: function (object, e) {
this._setActiveObject(object);
this.renderAll();
this.fire('object:selected', { target: object, e: e });
object.fire('selected', { e: e });
return this;
},
/**
* Returns currently active object
* @return {fabric.Object} active object
*/
getActiveObject: function () {
return this._activeObject;
},
/**
* @private
*/
_discardActiveObject: function() {
if (this._activeObject) {
this._activeObject.set('active', false);
}
this._activeObject = null;
},
/**
* Discards currently active object
* @return {fabric.Canvas} thisArg
* @chainable
*/
discardActiveObject: function (e) {
this._discardActiveObject();
this.renderAll();
this.fire('selection:cleared', { e: e });
return this;
},
/**
* @private
* @param {fabric.Group} group
*/
_setActiveGroup: function(group) {
this._activeGroup = group;
if (group) {
group.canvas = this;
group.set('active', true);
}
},
/**
* Sets active group to a speicified one
* @param {fabric.Group} group Group to set as a current one
* @return {fabric.Canvas} thisArg
* @chainable
*/
setActiveGroup: function (group, e) {
this._setActiveGroup(group);
if (group) {
this.fire('object:selected', { target: group, e: e });
group.fire('selected', { e: e });
}
return this;
},
/**
* Returns currently active group
* @return {fabric.Group} Current group
*/
getActiveGroup: function () {
return this._activeGroup;
},
/**
* @private
*/
_discardActiveGroup: function() {
var g = this.getActiveGroup();
if (g) {
g.destroy();
}
this.setActiveGroup(null);
},
/**
* Discards currently active group
* @return {fabric.Canvas} thisArg
*/
discardActiveGroup: function (e) {
this._discardActiveGroup();
this.fire('selection:cleared', { e: e });
return this;
},
/**
* Deactivates all objects on canvas, removing any active group or object
* @return {fabric.Canvas} thisArg
*/
deactivateAll: function () {
var allObjects = this.getObjects(),
i = 0,
len = allObjects.length;
for ( ; i < len; i++) {
allObjects[i].set('active', false);
}
this._discardActiveGroup();
this._discardActiveObject();
return this;
},
/**
* Deactivates all objects and dispatches appropriate events
* @return {fabric.Canvas} thisArg
*/
deactivateAllWithDispatch: function (e) {
var activeObject = this.getActiveGroup() || this.getActiveObject();
if (activeObject) {
this.fire('before:selection:cleared', { target: activeObject, e: e });
}
this.deactivateAll();
if (activeObject) {
this.fire('selection:cleared', { e: e });
}
return this;
},
/**
* Draws objects' controls (borders/controls)
* @param {CanvasRenderingContext2D} ctx Context to render controls on
*/
drawControls: function(ctx) {
var activeGroup = this.getActiveGroup();
if (activeGroup) {
this._drawGroupControls(ctx, activeGroup);
}
else {
this._drawObjectsControls(ctx);
}
},
/**
* @private
*/
_drawGroupControls: function(ctx, activeGroup) {
this._drawControls(ctx, activeGroup, 'Group');
},
/**
* @private
*/
_drawObjectsControls: function(ctx) {
for (var i = 0, len = this._objects.length; i < len; ++i) {
if (!this._objects[i] || !this._objects[i].active) continue;
this._drawControls(ctx, this._objects[i], 'Object');
this.lastRenderedObjectWithControlsAboveOverlay = this._objects[i];
}
},
/**
* @private
*/
_drawControls: function(ctx, object, klass) {
ctx.save();
fabric[klass].prototype.transform.call(object, ctx);
object.drawBorders(ctx).drawControls(ctx);
ctx.restore();
}
});
for (var prop in fabric.StaticCanvas) {
if (prop !== 'prototype') {
fabric.Canvas[prop] = fabric.StaticCanvas[prop];
}
}
if (fabric.isTouchSupported) {
/** @ignore */
fabric.Canvas.prototype._setCursorFromEvent = function() { };
}
/**
* @class fabric.Element
* @alias fabric.Canvas
* @deprecated Use {@link fabric.Canvas} instead.
* @constructor
*/
fabric.Element = fabric.Canvas;
})();
(function(){
var cursorMap = [
'n-resize',
'ne-resize',
'e-resize',
'se-resize',
's-resize',
'sw-resize',
'w-resize',
'nw-resize'
],
cursorOffset = {
'mt': 0, // n
'tr': 1, // ne
'mr': 2, // e
'br': 3, // se
'mb': 4, // s
'bl': 5, // sw
'ml': 6, // w
'tl': 7 // nw
},
addListener = fabric.util.addListener,
removeListener = fabric.util.removeListener,
getPointer = fabric.util.getPointer;
fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {
/**
* Adds mouse listeners to canvas
* @private
*/
_initEventListeners: function () {
this._bindEvents();
addListener(fabric.window, 'resize', this._onResize);
addListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);
addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);
addListener(this.upperCanvasEl, 'mousewheel', this._onMouseWheel);
addListener(this.upperCanvasEl, 'touchstart', this._onMouseDown);
addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);
if (typeof Event !== 'undefined' && 'add' in Event) {
Event.add(this.upperCanvasEl, 'gesture', this._onGesture);
Event.add(this.upperCanvasEl, 'drag', this._onDrag);
Event.add(this.upperCanvasEl, 'orientation', this._onOrientationChange);
Event.add(this.upperCanvasEl, 'shake', this._onShake);
}
},
/**
* @private
*/
_bindEvents: function() {
this._onMouseDown = this._onMouseDown.bind(this);
this._onMouseMove = this._onMouseMove.bind(this);
this._onMouseUp = this._onMouseUp.bind(this);
this._onResize = this._onResize.bind(this);
this._onGesture = this._onGesture.bind(this);
this._onDrag = this._onDrag.bind(this);
this._onShake = this._onShake.bind(this);
this._onOrientationChange = this._onOrientationChange.bind(this);
this._onMouseWheel = this._onMouseWheel.bind(this);
},
/**
* Removes all event listeners
*/
removeListeners: function() {
removeListener(fabric.window, 'resize', this._onResize);
removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);
removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);
removeListener(this.upperCanvasEl, 'mousewheel', this._onMouseWheel);
removeListener(this.upperCanvasEl, 'touchstart', this._onMouseDown);
removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);
if (typeof Event !== 'undefined' && 'remove' in Event) {
Event.remove(this.upperCanvasEl, 'gesture', this._onGesture);
Event.remove(this.upperCanvasEl, 'drag', this._onDrag);
Event.remove(this.upperCanvasEl, 'orientation', this._onOrientationChange);
Event.remove(this.upperCanvasEl, 'shake', this._onShake);
}
},
/**
* @private
* @param {Event} [e] Event object fired on Event.js gesture
* @param {Event} [self] Inner Event object
*/
_onGesture: function(e, s) {
this.__onTransformGesture && this.__onTransformGesture(e, s);
},
/**
* @private
* @param {Event} [e] Event object fired on Event.js drag
* @param {Event} [self] Inner Event object
*/
_onDrag: function(e, s) {
this.__onDrag && this.__onDrag(e, s);
},
/**
* @private
* @param {Event} [e] Event object fired on Event.js wheel event
* @param {Event} [self] Inner Event object
*/
_onMouseWheel: function(e, s) {
this.__onMouseWheel && this.__onMouseWheel(e, s);
},
/**
* @private
* @param {Event} [e] Event object fired on Event.js orientation change
* @param {Event} [self] Inner Event object
*/
_onOrientationChange: function(e,s) {
this.__onOrientationChange && this.__onOrientationChange(e,s);
},
/**
* @private
* @param {Event} [e] Event object fired on Event.js shake
* @param {Event} [self] Inner Event object
*/
_onShake: function(e,s) {
this.__onShake && this.__onShake(e,s);
},
/**
* @private
* @param {Event} e Event object fired on mousedown
*/
_onMouseDown: function (e) {
this.__onMouseDown(e);
addListener(fabric.document, 'mouseup', this._onMouseUp);
addListener(fabric.document, 'touchend', this._onMouseUp);
addListener(fabric.document, 'mousemove', this._onMouseMove);
addListener(fabric.document, 'touchmove', this._onMouseMove);
removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);
removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);
},
/**
* @private
* @param {Event} e Event object fired on mouseup
*/
_onMouseUp: function (e) {
this.__onMouseUp(e);
removeListener(fabric.document, 'mouseup', this._onMouseUp);
removeListener(fabric.document, 'touchend', this._onMouseUp);
removeListener(fabric.document, 'mousemove', this._onMouseMove);
removeListener(fabric.document, 'touchmove', this._onMouseMove);
addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);
addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);
},
/**
* @private
* @param {Event} e Event object fired on mousemove
*/
_onMouseMove: function (e) {
!this.allowTouchScrolling && e.preventDefault && e.preventDefault();
this.__onMouseMove(e);
},
/**
* @private
*/
_onResize: function () {
this.calcOffset();
},
/**
* Decides whether the canvas should be redrawn in mouseup and mousedown events.
* @private
* @param {Object} target
* @param {Object} pointer
*/
_shouldRender: function(target, pointer) {
var activeObject = this.getActiveGroup() || this.getActiveObject();
return !!(
(target && (
target.isMoving ||
target !== activeObject))
||
(!target && !!activeObject)
||
(!target && !activeObject && !this._groupSelector)
||
(pointer &&
this._previousPointer &&
this.selection && (
pointer.x !== this._previousPointer.x ||
pointer.y !== this._previousPointer.y))
);
},
/**
* Method that defines the actions when mouse is released on canvas.
* The method resets the currentTransform parameters, store the image corner
* position in the image object and render the canvas on top.
* @private
* @param {Event} e Event object fired on mouseup
*/
__onMouseUp: function (e) {
var target;
if (this.isDrawingMode && this._isCurrentlyDrawing) {
this._onMouseUpInDrawingMode(e);
return;
}
if (this._currentTransform) {
this._finalizeCurrentTransform();
target = this._currentTransform.target;
}
else {
target = this.findTarget(e, true);
}
var shouldRender = this._shouldRender(target, this.getPointer(e));
this._maybeGroupObjects(e);
if (target) {
target.isMoving = false;
}
shouldRender && this.renderAll();
this._handleCursorAndEvent(e, target);
},
_handleCursorAndEvent: function(e, target) {
this._setCursorFromEvent(e, target);
var _this = this;
setTimeout(function () {
_this._setCursorFromEvent(e, target);
}, 50);
this.fire('mouse:up', { target: target, e: e });
target && target.fire('mouseup', { e: e });
},
/**
* @private
*/
_finalizeCurrentTransform: function() {
var transform = this._currentTransform;
var target = transform.target;
if (target._scaling) {
target._scaling = false;
}
target.setCoords();
if (this.stateful && target.hasStateChanged()) {
this.fire('object:modified', { target: target });
target.fire('modified');
}
this._restoreOriginXY(target);
},
/**
* @private
* @param {Object} target Object to restore
*/
_restoreOriginXY: function(target) {
if (this._previousOriginX && this._previousOriginY) {
var originPoint = target.translateToOriginPoint(
target.getCenterPoint(),
this._previousOriginX,
this._previousOriginY);
target.originX = this._previousOriginX;
target.originY = this._previousOriginY;
target.left = originPoint.x;
target.top = originPoint.y;
this._previousOriginX = null;
this._previousOriginY = null;
}
},
/**
* @private
* @param {Event} e Event object fired on mousedown
*/
_onMouseDownInDrawingMode: function(e) {
this._isCurrentlyDrawing = true;
this.discardActiveObject(e).renderAll();
if (this.clipTo) {
fabric.util.clipContext(this, this.contextTop);
}
this.freeDrawingBrush.onMouseDown(this.getPointer(e));
this.fire('mouse:down', { e: e });
},
/**
* @private
* @param {Event} e Event object fired on mousemove
*/
_onMouseMoveInDrawingMode: function(e) {
if (this._isCurrentlyDrawing) {
var pointer = this.getPointer(e);
this.freeDrawingBrush.onMouseMove(pointer);
}
this.upperCanvasEl.style.cursor = this.freeDrawingCursor;
this.fire('mouse:move', { e: e });
},
/**
* @private
* @param {Event} e Event object fired on mouseup
*/
_onMouseUpInDrawingMode: function(e) {
this._isCurrentlyDrawing = false;
if (this.clipTo) {
this.contextTop.restore();
}
this.freeDrawingBrush.onMouseUp();
this.fire('mouse:up', { e: e });
},
/**
* Method that defines the actions when mouse is clic ked on canvas.
* The method inits the currentTransform parameters and renders all the
* canvas so the current image can be placed on the top canvas and the rest
* in on the container one.
* @private
* @param {Event} e Event object fired on mousedown
*/
__onMouseDown: function (e) {
var isLeftClick  = 'which' in e ? e.which === 1 : e.button === 1;
if (!isLeftClick && !fabric.isTouchSupported) return;
if (this.isDrawingMode) {
this._onMouseDownInDrawingMode(e);
return;
}
if (this._currentTransform) return;
var target = this.findTarget(e),
pointer = this.getPointer(e);
this._previousPointer = pointer;
var shouldRender = this._shouldRender(target, pointer),
shouldGroup = this._shouldGroup(e, target);
if (this._shouldClearSelection(e, target)) {
this._clearSelection(e, target, pointer);
}
else if (shouldGroup) {
this._handleGrouping(e, target);
target = this.getActiveGroup();
}
if (target && target.selectable && !shouldGroup) {
this._beforeTransform(e, target);
this._setupCurrentTransform(e, target);
}
shouldRender && this.renderAll();
this.fire('mouse:down', { target: target, e: e });
target && target.fire('mousedown', { e: e });
},
/**
* @private
*/
_beforeTransform: function(e, target) {
var corner;
this.stateful && target.saveState();
if ((corner = target._findTargetCorner(e, this._offset))) {
this.onBeforeScaleRotate(target);
}
if (target !== this.getActiveGroup() && target !== this.getActiveObject()) {
this.deactivateAll();
this.setActiveObject(target, e);
}
},
/**
* @private
*/
_clearSelection: function(e, target, pointer) {
this.deactivateAllWithDispatch(e);
if (target && target.selectable) {
this.setActiveObject(target, e);
}
else if (this.selection) {
this._groupSelector = {
ex: pointer.x,
ey: pointer.y,
top: 0,
left: 0
};
}
},
/**
* @private
* @param {Object} target Object for that origin is set to center
*/
_setOriginToCenter: function(target) {
this._previousOriginX = this._currentTransform.target.originX;
this._previousOriginY = this._currentTransform.target.originY;
var center = target.getCenterPoint();
target.originX = 'center';
target.originY = 'center';
target.left = center.x;
target.top = center.y;
this._currentTransform.left = target.left;
this._currentTransform.top = target.top;
},
/**
* @private
* @param {Object} target Object for that center is set to origin
*/
_setCenterToOrigin: function(target) {
var originPoint = target.translateToOriginPoint(
target.getCenterPoint(),
this._previousOriginX,
this._previousOriginY);
target.originX = this._previousOriginX;
target.originY = this._previousOriginY;
target.left = originPoint.x;
target.top = originPoint.y;
this._previousOriginX = null;
this._previousOriginY = null;
},
/**
* Method that defines the actions when mouse is hovering the canvas.
* The currentTransform parameter will definde whether the user is rotating/scaling/translating
* an image or neither of them (only hovering). A group selection is also possible and would cancel
* all any other type of action.
* In case of an image transformation only the top canvas will be rendered.
* @private
* @param {Event} e Event object fired on mousemove
*/
__onMouseMove: function (e) {
var target, pointer;
if (this.isDrawingMode) {
this._onMouseMoveInDrawingMode(e);
return;
}
var groupSelector = this._groupSelector;
if (groupSelector) {
pointer = getPointer(e, this.upperCanvasEl);
groupSelector.left = pointer.x - this._offset.left - groupSelector.ex;
groupSelector.top = pointer.y - this._offset.top - groupSelector.ey;
this.renderTop();
}
else if (!this._currentTransform) {
target = this.findTarget(e);
if (!target || target && !target.selectable) {
this.upperCanvasEl.style.cursor = this.defaultCursor;
}
else {
this._setCursorFromEvent(e, target);
}
}
else {
this._transformObject(e);
}
this.fire('mouse:move', { target: target, e: e });
target && target.fire('mousemove', { e: e });
},
/**
* @private
* @param {Event} e Event fired on mousemove
*/
_transformObject: function(e) {
var pointer = getPointer(e, this.upperCanvasEl),
transform = this._currentTransform;
transform.reset = false,
transform.target.isMoving = true;
this._beforeScaleTransform(e, transform);
this._performTransformAction(e, transform, pointer);
this.renderAll();
},
/**
* @private
*/
_performTransformAction: function(e, transform, pointer) {
var x = pointer.x,
y = pointer.y,
target = transform.target,
action = transform.action;
if (action === 'rotate') {
this._rotateObject(x, y);
this._fire('rotating', target, e);
}
else if (action === 'scale') {
this._onScale(e, transform, x, y);
this._fire('scaling', target, e);
}
else if (action === 'scaleX') {
this._scaleObject(x, y, 'x');
this._fire('scaling', target, e);
}
else if (action === 'scaleY') {
this._scaleObject(x, y, 'y');
this._fire('scaling', target, e);
}
else {
this._translateObject(x, y);
this._fire('moving', target, e);
this._setCursor(this.moveCursor);
}
},
/**
* @private
*/
_fire: function(eventName, target, e) {
this.fire('object:' + eventName, { target: target, e: e});
target.fire(eventName, { e: e });
},
/**
* @private
*/
_beforeScaleTransform: function(e, transform) {
if (transform.action === 'scale' || transform.action === 'scaleX' || transform.action === 'scaleY') {
var centerTransform = this._shouldCenterTransform(e, transform.target);
if ((centerTransform && (transform.originX !== 'center' || transform.originY !== 'center')) ||
(!centerTransform && transform.originX === 'center' && transform.originY === 'center')
) {
this._resetCurrentTransform(e);
transform.reset = true;
}
}
},
/**
* @private
*/
_onScale: function(e, transform, x, y) {
if ((e.shiftKey || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {
transform.currentAction = 'scale';
this._scaleObject(x, y);
}
else {
if (!transform.reset && transform.currentAction === 'scale') {
this._resetCurrentTransform(e, transform.target);
}
transform.currentAction = 'scaleEqually';
this._scaleObject(x, y, 'equally');
}
},
/**
* Sets the cursor depending on where the canvas is being hovered.
* Note: very buggy in Opera
* @param {Event} e Event object
* @param {Object} target Object that the mouse is hovering, if so.
*/
_setCursorFromEvent: function (e, target) {
var style = this.upperCanvasEl.style;
if (!target || !target.selectable) {
style.cursor = this.defaultCursor;
return false;
}
else {
var activeGroup = this.getActiveGroup();
var corner = target._findTargetCorner
&& (!activeGroup || !activeGroup.contains(target))
&& target._findTargetCorner(e, this._offset);
if (!corner) {
style.cursor = target.hoverCursor || this.hoverCursor;
}
else {
this._setCornerCursor(corner, target);
}
}
return true;
},
/**
* @private
*/
_setCornerCursor: function(corner, target) {
var style = this.upperCanvasEl.style;
if (corner in cursorOffset) {
style.cursor = this._getRotatedCornerCursor(corner, target);
}
else if (corner === 'mtr' && target.hasRotatingPoint) {
style.cursor = this.rotationCursor;
}
else {
style.cursor = this.defaultCursor;
return false;
}
},
/**
* @private
*/
_getRotatedCornerCursor: function(corner, target) {
var n = Math.round((target.getAngle() % 360) / 45);
if (n < 0) {
n += 8; // full circle ahead
}
n += cursorOffset[corner];
n %= 8;
return cursorMap[n];
}
});
})();
(function(){
var min = Math.min,
max = Math.max;
fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {
/**
* @private
* @param {Event} e Event object
* @param {fabric.Object} target
* @return {Boolean}
*/
_shouldGroup: function(e, target) {
var activeObject = this.getActiveObject();
return e.shiftKey &&
(this.getActiveGroup() || (activeObject && activeObject !== target))
&& this.selection;
},
/**
* @private
* @param {Event} e Event object
* @param {fabric.Object} target
*/
_handleGrouping: function (e, target) {
if (target === this.getActiveGroup()) {
target = this.findTarget(e, true);
if (!target || target.isType('group')) {
return;
}
}
if (this.getActiveGroup()) {
this._updateActiveGroup(target, e);
}
else {
this._createActiveGroup(target, e);
}
if (this._activeGroup) {
this._activeGroup.saveCoords();
}
},
/**
* @private
*/
_updateActiveGroup: function(target, e) {
var activeGroup = this.getActiveGroup();
if (activeGroup.contains(target)) {
activeGroup.removeWithUpdate(target);
this._resetObjectTransform(activeGroup);
target.set('active', false);
if (activeGroup.size() === 1) {
this.discardActiveGroup(e);
this.setActiveObject(activeGroup.item(0));
return;
}
}
else {
activeGroup.addWithUpdate(target);
this._resetObjectTransform(activeGroup);
}
this.fire('selection:created', { target: activeGroup, e: e });
activeGroup.set('active', true);
},
/**
* @private
*/
_createActiveGroup: function(target, e) {
if (this._activeObject && target !== this._activeObject) {
var group = this._createGroup(target);
this.setActiveGroup(group);
this._activeObject = null;
this.fire('selection:created', { target: group, e: e });
}
target.set('active', true);
},
/**
* @private
* @param {Object} target
*/
_createGroup: function(target) {
var objects = this.getObjects();
var isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target);
var groupObjects = isActiveLower
? [ this._activeObject, target ]
: [ target, this._activeObject ];
return new fabric.Group(groupObjects, {
originX: 'center',
originY: 'center'
});
},
/**
* @private
* @param {Event} e mouse event
*/
_groupSelectedObjects: function (e) {
var group = this._collectObjects();
if (group.length === 1) {
this.setActiveObject(group[0], e);
}
else if (group.length > 1) {
group = new fabric.Group(group.reverse(), {
originX: 'center',
originY: 'center'
});
this.setActiveGroup(group, e);
group.saveCoords();
this.fire('selection:created', { target: group });
this.renderAll();
}
},
/**
* @private
*/
_collectObjects: function() {
var group = [ ],
currentObject,
x1 = this._groupSelector.ex,
y1 = this._groupSelector.ey,
x2 = x1 + this._groupSelector.left,
y2 = y1 + this._groupSelector.top,
selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),
selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),
isClick = x1 === x2 && y1 === y2;
for (var i = this._objects.length; i--; ) {
currentObject = this._objects[i];
if (!currentObject || !currentObject.selectable || !currentObject.visible) continue;
if (currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2) ||
currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||
currentObject.containsPoint(selectionX1Y1) ||
currentObject.containsPoint(selectionX2Y2)
) {
currentObject.set('active', true);
group.push(currentObject);
if (isClick) break;
}
}
return group;
},
/**
* @private
*/
_maybeGroupObjects: function(e) {
if (this.selection && this._groupSelector) {
this._groupSelectedObjects(e);
}
var activeGroup = this.getActiveGroup();
if (activeGroup) {
activeGroup.setObjectsCoords().setCoords();
activeGroup.isMoving = false;
this._setCursor(this.defaultCursor);
}
this._groupSelector = null;
this._currentTransform = null;
}
});
})();
fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {
/**
* Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately
* @param {Object} [options] Options object
* @param {String} [options.format=png] The format of the output image. Either "jpeg" or "png"
* @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.
* @param {Number} [options.multiplier=1] Multiplier to scale by
* @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14
* @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14
* @param {Number} [options.width] Cropping width. Introduced in v1.2.14
* @param {Number} [options.height] Cropping height. Introduced in v1.2.14
* @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format
* @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}
* @example <caption>Generate jpeg dataURL with lower quality</caption>
* var dataURL = canvas.toDataURL({
*   format: 'jpeg',
*   quality: 0.8
* });
* @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>
* var dataURL = canvas.toDataURL({
*   format: 'png',
*   left: 100,
*   top: 100,
*   width: 200,
*   height: 200
* });
* @example <caption>Generate double scaled png dataURL</caption>
* var dataURL = canvas.toDataURL({
*   format: 'png',
*   multiplier: 2
* });
*/
toDataURL: function (options) {
options || (options = { });
var format = options.format || 'png',
quality = options.quality || 1,
multiplier = options.multiplier || 1,
cropping = {
left: options.left,
top: options.top,
width: options.width,
height: options.height
};
if (multiplier !== 1) {
return this.__toDataURLWithMultiplier(format, quality, cropping, multiplier);
}
else {
return this.__toDataURL(format, quality, cropping);
}
},
/**
* @private
*/
__toDataURL: function(format, quality, cropping) {
this.renderAll(true);
var canvasEl = this.upperCanvasEl || this.lowerCanvasEl;
var croppedCanvasEl = this.__getCroppedCanvas(canvasEl, cropping);
if (format === 'jpg') {
format = 'jpeg';
}
var data = (fabric.StaticCanvas.supports('toDataURLWithQuality'))
? (croppedCanvasEl || canvasEl).toDataURL('image/' + format, quality)
: (croppedCanvasEl || canvasEl).toDataURL('image/' + format);
this.contextTop && this.clearContext(this.contextTop);
this.renderAll();
if (croppedCanvasEl) {
croppedCanvasEl = null;
}
return data;
},
/**
* @private
*/
__getCroppedCanvas: function(canvasEl, cropping) {
var croppedCanvasEl,
croppedCtx;
var shouldCrop = 'left' in cropping ||
'top' in cropping ||
'width' in cropping ||
'height' in cropping;
if (shouldCrop) {
croppedCanvasEl = fabric.util.createCanvasElement();
croppedCtx = croppedCanvasEl.getContext('2d');
croppedCanvasEl.width = cropping.width || this.width;
croppedCanvasEl.height = cropping.height || this.height;
croppedCtx.drawImage(canvasEl, -cropping.left || 0, -cropping.top || 0);
}
return croppedCanvasEl;
},
/**
* @private
*/
__toDataURLWithMultiplier: function(format, quality, cropping, multiplier) {
var origWidth = this.getWidth(),
origHeight = this.getHeight(),
scaledWidth = origWidth * multiplier,
scaledHeight = origHeight * multiplier,
activeObject = this.getActiveObject(),
activeGroup = this.getActiveGroup(),
ctx = this.contextTop || this.contextContainer;
this.setWidth(scaledWidth).setHeight(scaledHeight);
ctx.scale(multiplier, multiplier);
if (cropping.left) {
cropping.left *= multiplier;
}
if (cropping.top) {
cropping.top *= multiplier;
}
if (cropping.width) {
cropping.width *= multiplier;
}
if (cropping.height) {
cropping.height *= multiplier;
}
if (activeGroup) {
this._tempRemoveBordersControlsFromGroup(activeGroup);
}
else if (activeObject && this.deactivateAll) {
this.deactivateAll();
}
this.renderAll(true);
var data = this.__toDataURL(format, quality, cropping);
this.width = origWidth;
this.height = origHeight;
ctx.scale(1 / multiplier,  1 / multiplier);
this.setWidth(origWidth).setHeight(origHeight);
if (activeGroup) {
this._restoreBordersControlsOnGroup(activeGroup);
}
else if (activeObject && this.setActiveObject) {
this.setActiveObject(activeObject);
}
this.contextTop && this.clearContext(this.contextTop);
this.renderAll();
return data;
},
/**
* Exports canvas element to a dataurl image (allowing to change image size via multiplier).
* @deprecated since 1.0.13
* @param {String} format (png|jpeg)
* @param {Number} multiplier
* @param {Number} quality (0..1)
* @return {String}
*/
toDataURLWithMultiplier: function (format, multiplier, quality) {
return this.toDataURL({
format: format,
multiplier: multiplier,
quality: quality
});
},
/**
* @private
*/
_tempRemoveBordersControlsFromGroup: function(group) {
group.origHasControls = group.hasControls;
group.origBorderColor = group.borderColor;
group.hasControls = true;
group.borderColor = 'rgba(0,0,0,0)';
group.forEachObject(function(o) {
o.origBorderColor = o.borderColor;
o.borderColor = 'rgba(0,0,0,0)';
});
},
/**
* @private
*/
_restoreBordersControlsOnGroup: function(group) {
group.hideControls = group.origHideControls;
group.borderColor = group.origBorderColor;
group.forEachObject(function(o) {
o.borderColor = o.origBorderColor;
delete o.origBorderColor;
});
}
});
fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {
/**
* Populates canvas with data from the specified dataless JSON.
* JSON format must conform to the one of {@link fabric.Canvas#toDatalessJSON}
* @deprecated since 1.2.2
* @param {String|Object} json JSON string or object
* @param {Function} callback Callback, invoked when json is parsed
*                            and corresponding objects (e.g: {@link fabric.Image})
*                            are initialized
* @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.
* @return {fabric.Canvas} instance
* @chainable
* @tutorial {@link http://fabricjs.com/fabric-intro-part-3/#deserialization}
*/
loadFromDatalessJSON: function (json, callback, reviver) {
return this.loadFromJSON(json, callback, reviver);
},
/**
* Populates canvas with data from the specified JSON.
* JSON format must conform to the one of {@link fabric.Canvas#toJSON}
* @param {String|Object} json JSON string or object
* @param {Function} callback Callback, invoked when json is parsed
*                            and corresponding objects (e.g: {@link fabric.Image})
*                            are initialized
* @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.
* @return {fabric.Canvas} instance
* @chainable
* @tutorial {@link http://fabricjs.com/fabric-intro-part-3/#deserialization}
* @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}
* @example <caption>loadFromJSON</caption>
* canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));
* @example <caption>loadFromJSON with reviver</caption>
* canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {
*   // `o` = json object
*   // `object` = fabric.Object instance
*   // ... do some stuff ...
* });
*/
loadFromJSON: function (json, callback, reviver) {
if (!json) return;
var serialized = (typeof json === 'string')
? JSON.parse(json)
: json;
this.clear();
var _this = this;
this._enlivenObjects(serialized.objects, function () {
_this._setBgOverlay(serialized, callback);
}, reviver);
return this;
},
/**
* @private
* @param {Object} serialized Object with background and overlay information
* @param {Function} callback Invoked after all background and overlay images/patterns loaded
*/
_setBgOverlay: function(serialized, callback) {
var _this = this,
loaded = {
backgroundColor: false,
overlayColor: false,
backgroundImage: false,
overlayImage: false
};
if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {
callback && callback();
return;
}
var cbIfLoaded = function () {
if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {
_this.renderAll();
callback && callback();
}
};
this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);
this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);
this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);
this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);
cbIfLoaded();
},
/**
* @private
* @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)
* @param {(Object|String)} value Value to set
* @param {Object} loaded Set loaded property to true if property is set
* @param {Object} callback Callback function to invoke after property is set
*/
__setBgOverlay: function(property, value, loaded, callback) {
var _this = this;
if (!value) {
loaded[property] = true;
return;
}
if (property === 'backgroundImage' || property === 'overlayImage') {
fabric.Image.fromObject(value, function(img) {
_this[property] = img;
loaded[property] = true;
callback && callback();
});
}
else {
this['set' + fabric.util.string.capitalize(property, true)](value, function() {
loaded[property] = true;
callback && callback();
});
}
},
/**
* @private
* @param {Array} objects
* @param {Function} callback
* @param {Function} [reviver]
*/
_enlivenObjects: function (objects, callback, reviver) {
var _this = this;
if (objects.length === 0) {
callback && callback();
}
var renderOnAddRemove = this.renderOnAddRemove;
this.renderOnAddRemove = false;
fabric.util.enlivenObjects(objects, function(enlivenedObjects) {
enlivenedObjects.forEach(function(obj, index) {
_this.insertAt(obj, index, true);
});
_this.renderOnAddRemove = renderOnAddRemove;
callback && callback();
}, null, reviver);
},
/**
* @private
* @param {String} format
* @param {Function} callback
*/
_toDataURL: function (format, callback) {
this.clone(function (clone) {
callback(clone.toDataURL(format));
});
},
/**
* @private
* @param {String} format
* @param {Number} multiplier
* @param {Function} callback
*/
_toDataURLWithMultiplier: function (format, multiplier, callback) {
this.clone(function (clone) {
callback(clone.toDataURLWithMultiplier(format, multiplier));
});
},
/**
* Clones canvas instance
* @param {Object} [callback] Receives cloned instance as a first argument
* @param {Array} [properties] Array of properties to include in the cloned canvas and children
*/
clone: function (callback, properties) {
var data = JSON.stringify(this.toJSON(properties));
this.cloneWithoutData(function(clone) {
clone.loadFromJSON(data, function() {
callback && callback(clone);
});
});
},
/**
* Clones canvas instance without cloning existing data.
* This essentially copies canvas dimensions, clipping properties, etc.
* but leaves data empty (so that you can populate it with your own)
* @param {Object} [callback] Receives cloned instance as a first argument
*/
cloneWithoutData: function(callback) {
var el = fabric.document.createElement('canvas');
el.width = this.getWidth();
el.height = this.getHeight();
var clone = new fabric.Canvas(el);
clone.clipTo = this.clipTo;
if (this.backgroundImage) {
clone.setBackgroundImage(this.backgroundImage.src, function() {
clone.renderAll();
callback && callback(clone);
});
clone.backgroundImageOpacity = this.backgroundImageOpacity;
clone.backgroundImageStretch = this.backgroundImageStretch;
}
else {
callback && callback(clone);
}
}
});
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
toFixed = fabric.util.toFixed,
capitalize = fabric.util.string.capitalize,
degreesToRadians = fabric.util.degreesToRadians,
supportsLineDash = fabric.StaticCanvas.supports('setLineDash');
if (fabric.Object) {
return;
}
/**
* Root object class from which all 2d shape classes inherit from
* @class fabric.Object
* @tutorial {@link http://fabricjs.com/fabric-intro-part-1/#objects}
* @see {@link fabric.Object#initialize} for constructor definition
*
* @fires added
* @fires removed
*
* @fires selected
* @fires modified
* @fires rotating
* @fires scaling
* @fires moving
*
* @fires mousedown
* @fires mouseup
*/
fabric.Object = fabric.util.createClass(/** @lends fabric.Object.prototype */ {
/**
* Retrieves object's {@link fabric.Object#clipTo|clipping function}
* @method getClipTo
* @memberOf fabric.Object.prototype
* @return {Function}
*/
/**
* Sets object's {@link fabric.Object#clipTo|clipping function}
* @method setClipTo
* @memberOf fabric.Object.prototype
* @param {Function} clipTo Clipping function
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#transformMatrix|transformMatrix}
* @method getTransformMatrix
* @memberOf fabric.Object.prototype
* @return {Array} transformMatrix
*/
/**
* Sets object's {@link fabric.Object#transformMatrix|transformMatrix}
* @method setTransformMatrix
* @memberOf fabric.Object.prototype
* @param {Array} transformMatrix
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#visible|visible} state
* @method getVisible
* @memberOf fabric.Object.prototype
* @return {Boolean} True if visible
*/
/**
* Sets object's {@link fabric.Object#visible|visible} state
* @method setVisible
* @memberOf fabric.Object.prototype
* @param {Boolean} value visible value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#shadow|shadow}
* @method getShadow
* @memberOf fabric.Object.prototype
* @return {Object} Shadow instance
*/
/**
* Retrieves object's {@link fabric.Object#stroke|stroke}
* @method getStroke
* @memberOf fabric.Object.prototype
* @return {String} stroke value
*/
/**
* Sets object's {@link fabric.Object#stroke|stroke}
* @method setStroke
* @memberOf fabric.Object.prototype
* @param {String} value stroke value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#strokeWidth|strokeWidth}
* @method getStrokeWidth
* @memberOf fabric.Object.prototype
* @return {Number} strokeWidth value
*/
/**
* Sets object's {@link fabric.Object#strokeWidth|strokeWidth}
* @method setStrokeWidth
* @memberOf fabric.Object.prototype
* @param {Number} value strokeWidth value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#originX|originX}
* @method getOriginX
* @memberOf fabric.Object.prototype
* @return {String} originX value
*/
/**
* Sets object's {@link fabric.Object#originX|originX}
* @method setOriginX
* @memberOf fabric.Object.prototype
* @param {String} value originX value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#originY|originY}
* @method getOriginY
* @memberOf fabric.Object.prototype
* @return {String} originY value
*/
/**
* Sets object's {@link fabric.Object#originY|originY}
* @method setOriginY
* @memberOf fabric.Object.prototype
* @param {String} value originY value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#fill|fill}
* @method getFill
* @memberOf fabric.Object.prototype
* @return {String} Fill value
*/
/**
* Sets object's {@link fabric.Object#fill|fill}
* @method setFill
* @memberOf fabric.Object.prototype
* @param {String} value Fill value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#opacity|opacity}
* @method getOpacity
* @memberOf fabric.Object.prototype
* @return {Number} Opacity value (0-1)
*/
/**
* Sets object's {@link fabric.Object#opacity|opacity}
* @method setOpacity
* @memberOf fabric.Object.prototype
* @param {Number} value Opacity value (0-1)
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#angle|angle} (in degrees)
* @method getAngle
* @memberOf fabric.Object.prototype
* @return {Number}
*/
/**
* Sets object's {@link fabric.Object#angle|angle}
* @method setAngle
* @memberOf fabric.Object.prototype
* @param {Number} value Angle value (in degrees)
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#top|top position}
* @method getTop
* @memberOf fabric.Object.prototype
* @return {Number} Top value (in pixels)
*/
/**
* Sets object's {@link fabric.Object#top|top position}
* @method setTop
* @memberOf fabric.Object.prototype
* @param {Number} value Top value (in pixels)
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#left|left position}
* @method getLeft
* @memberOf fabric.Object.prototype
* @return {Number} Left value (in pixels)
*/
/**
* Sets object's {@link fabric.Object#left|left position}
* @method setLeft
* @memberOf fabric.Object.prototype
* @param {Number} value Left value (in pixels)
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#scaleX|scaleX} value
* @method getScaleX
* @memberOf fabric.Object.prototype
* @return {Number} scaleX value
*/
/**
* Sets object's {@link fabric.Object#scaleX|scaleX} value
* @method setScaleX
* @memberOf fabric.Object.prototype
* @param {Number} value scaleX value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#scaleY|scaleY} value
* @method getScaleY
* @memberOf fabric.Object.prototype
* @return {Number} scaleY value
*/
/**
* Sets object's {@link fabric.Object#scaleY|scaleY} value
* @method setScaleY
* @memberOf fabric.Object.prototype
* @param {Number} value scaleY value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#flipX|flipX} value
* @method getFlipX
* @memberOf fabric.Object.prototype
* @return {Boolean} flipX value
*/
/**
* Sets object's {@link fabric.Object#flipX|flipX} value
* @method setFlipX
* @memberOf fabric.Object.prototype
* @param {Boolean} value flipX value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Retrieves object's {@link fabric.Object#flipY|flipY} value
* @method getFlipY
* @memberOf fabric.Object.prototype
* @return {Boolean} flipY value
*/
/**
* Sets object's {@link fabric.Object#flipY|flipY} value
* @method setFlipY
* @memberOf fabric.Object.prototype
* @param {Boolean} value flipY value
* @return {fabric.Object} thisArg
* @chainable
*/
/**
* Type of an object (rect, circle, path, etc.)
* @type String
* @default
*/
type:                     'object',
/**
* Horizontal origin of transformation of an object (one of "left", "right", "center")
* @type String
* @default
*/
originX:                  'left',
/**
* Vertical origin of transformation of an object (one of "top", "bottom", "center")
* @type String
* @default
*/
originY:                  'top',
/**
* Top position of an object. Note that by default it's relative to object center. You can change this by setting originY={top/center/bottom}
* @type Number
* @default
*/
top:                      0,
/**
* Left position of an object. Note that by default it's relative to object center. You can change this by setting originX={left/center/right}
* @type Number
* @default
*/
left:                     0,
/**
* Object width
* @type Number
* @default
*/
width:                    0,
/**
* Object height
* @type Number
* @default
*/
height:                   0,
/**
* Object scale factor (horizontal)
* @type Number
* @default
*/
scaleX:                   1,
/**
* Object scale factor (vertical)
* @type Number
* @default
*/
scaleY:                   1,
/**
* When true, an object is rendered as flipped horizontally
* @type Boolean
* @default
*/
flipX:                    false,
/**
* When true, an object is rendered as flipped vertically
* @type Boolean
* @default
*/
flipY:                    false,
/**
* Opacity of an object
* @type Number
* @default
*/
opacity:                  1,
/**
* Angle of rotation of an object (in degrees)
* @type Number
* @default
*/
angle:                    0,
/**
* Size of object's controlling corners (in pixels)
* @type Number
* @default
*/
cornerSize:               12,
/**
* When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)
* @type Boolean
* @default
*/
transparentCorners:       true,
/**
* Default cursor value used when hovering over this object on canvas
* @type String
* @default
*/
hoverCursor:              null,
/**
* Padding between object and its controlling borders (in pixels)
* @type Number
* @default
*/
padding:                  0,
/**
* Color of controlling borders of an object (when it's active)
* @type String
* @default
*/
borderColor:              'rgba(102,153,255,0.75)',
/**
* Color of controlling corners of an object (when it's active)
* @type String
* @default
*/
cornerColor:              'rgba(102,153,255,0.5)',
/**
* When true, this object will use center point as the origin of transformation
* when being scaled via the controls.
* <b>Backwards incompatibility note:</b> This property replaces "centerTransform" (Boolean).
* @since 1.3.4
* @type Boolean
* @default
*/
centeredScaling:          false,
/**
* When true, this object will use center point as the origin of transformation
* when being rotated via the controls.
* <b>Backwards incompatibility note:</b> This property replaces "centerTransform" (Boolean).
* @since 1.3.4
* @type Boolean
* @default
*/
centeredRotation:         true,
/**
* Color of object's fill
* @type String
* @default
*/
fill:                     'rgb(0,0,0)',
/**
* Fill rule used to fill an object
* @type String
* @default
*/
fillRule:                 'source-over',
/**
* Background color of an object. Only works with text objects at the moment.
* @type String
* @default
*/
backgroundColor:          '',
/**
* When defined, an object is rendered via stroke and this property specifies its color
* @type String
* @default
*/
stroke:                   null,
/**
* Width of a stroke used to render this object
* @type Number
* @default
*/
strokeWidth:              1,
/**
* Array specifying dash pattern of an object's stroke (stroke must be defined)
* @type Array
*/
strokeDashArray:          null,
/**
* Line endings style of an object's stroke (one of "butt", "round", "square")
* @type String
* @default
*/
strokeLineCap:            'butt',
/**
* Corner style of an object's stroke (one of "bevil", "round", "miter")
* @type String
* @default
*/
strokeLineJoin:           'miter',
/**
* Maximum miter length (used for strokeLineJoin = "miter") of an object's stroke
* @type Number
* @default
*/
strokeMiterLimit:         10,
/**
* Shadow object representing shadow of this shape
* @type fabric.Shadow
* @default
*/
shadow:                   null,
/**
* Opacity of object's controlling borders when object is active and moving
* @type Number
* @default
*/
borderOpacityWhenMoving:  0.4,
/**
* Scale factor of object's controlling borders
* @type Number
* @default
*/
borderScaleFactor:        1,
/**
* Transform matrix (similar to SVG's transform matrix)
* @type Array
*/
transformMatrix:          null,
/**
* Minimum allowed scale value of an object
* @type Number
* @default
*/
minScaleLimit:            0.01,
/**
* When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).
* But events still fire on it.
* @type Boolean
* @default
*/
selectable:               true,
/**
* When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4
* @type Boolean
* @default
*/
evented:                  true,
/**
* When set to `false`, an object is not rendered on canvas
* @type Boolean
* @default
*/
visible:                  true,
/**
* When set to `false`, object's controls are not displayed and can not be used to manipulate object
* @type Boolean
* @default
*/
hasControls:              true,
/**
* When set to `false`, object's controlling borders are not rendered
* @type Boolean
* @default
*/
hasBorders:               true,
/**
* When set to `false`, object's controlling rotating point will not be visible or selectable
* @type Boolean
* @default
*/
hasRotatingPoint:         true,
/**
* Offset for object's controlling rotating point (when enabled via `hasRotatingPoint`)
* @type Number
* @default
*/
rotatingPointOffset:      40,
/**
* When set to `true`, objects are "found" on canvas on per-pixel basis rather than according to bounding box
* @type Boolean
* @default
*/
perPixelTargetFind:       false,
/**
* When `false`, default object's values are not included in its serialization
* @type Boolean
* @default
*/
includeDefaultValues:     true,
/**
* Function that determines clipping of an object (context is passed as a first argument)
* @type Function
*/
clipTo:                   null,
/**
* When `true`, object horizontal movement is locked
* @type Boolean
* @default
*/
lockMovementX:            false,
/**
* When `true`, object vertical movement is locked
* @type Boolean
* @default
*/
lockMovementY:            false,
/**
* When `true`, object rotation is locked
* @type Boolean
* @default
*/
lockRotation:             false,
/**
* When `true`, object horizontal scaling is locked
* @type Boolean
* @default
*/
lockScalingX:             false,
/**
* When `true`, object vertical scaling is locked
* @type Boolean
* @default
*/
lockScalingY:             false,
/**
* When `true`, object non-uniform scaling is locked
* @type Boolean
* @default
*/
lockUniScaling:           false,
/**
* List of properties to consider when checking if state
* of an object is changed (fabric.Object#hasStateChanged)
* as well as for history (undo/redo) purposes
* @type Array
*/
stateProperties:  (
'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +
'stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit ' +
'angle opacity fill fillRule shadow clipTo visible backgroundColor'
).split(' '),
/**
* Constructor
* @param {Object} [options] Options object
*/
initialize: function(options) {
if (options) {
this.setOptions(options);
}
},
/**
* @private
*/
_initGradient: function(options) {
if (options.fill && options.fill.colorStops && !(options.fill instanceof fabric.Gradient)) {
this.set('fill', new fabric.Gradient(options.fill));
}
},
/**
* @private
*/
_initPattern: function(options) {
if (options.fill && options.fill.source && !(options.fill instanceof fabric.Pattern)) {
this.set('fill', new fabric.Pattern(options.fill));
}
if (options.stroke && options.stroke.source && !(options.stroke instanceof fabric.Pattern)) {
this.set('stroke', new fabric.Pattern(options.stroke));
}
},
/**
* @private
*/
_initClipping: function(options) {
if (!options.clipTo || typeof options.clipTo !== 'string') return;
var functionBody = fabric.util.getFunctionBody(options.clipTo);
if (typeof functionBody !== 'undefined') {
this.clipTo = new Function('ctx', functionBody);
}
},
/**
* Sets object's properties from options
* @param {Object} [options] Options object
*/
setOptions: function(options) {
for (var prop in options) {
this.set(prop, options[prop]);
}
this._initGradient(options);
this._initPattern(options);
this._initClipping(options);
},
/**
* Transforms context when rendering an object
* @param {CanvasRenderingContext2D} ctx Context
* @param {Boolean} fromLeft When true, context is transformed to object's top/left corner. This is used when rendering text on Node
*/
transform: function(ctx, fromLeft) {
ctx.globalAlpha = this.opacity;
var center = fromLeft ? this._getLeftTopCoords() : this.getCenterPoint();
ctx.translate(center.x, center.y);
ctx.rotate(degreesToRadians(this.angle));
ctx.scale(
this.scaleX * (this.flipX ? -1 : 1),
this.scaleY * (this.flipY ? -1 : 1)
);
},
/**
* Returns an object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} Object representation of an instance
*/
toObject: function(propertiesToInclude) {
var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;
var object = {
type:               this.type,
originX:            this.originX,
originY:            this.originY,
left:               toFixed(this.left, NUM_FRACTION_DIGITS),
top:                toFixed(this.top, NUM_FRACTION_DIGITS),
width:              toFixed(this.width, NUM_FRACTION_DIGITS),
height:             toFixed(this.height, NUM_FRACTION_DIGITS),
fill:               (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,
stroke:             (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,
strokeWidth:        toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),
strokeDashArray:    this.strokeDashArray,
strokeLineCap:      this.strokeLineCap,
strokeLineJoin:     this.strokeLineJoin,
strokeMiterLimit:   toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),
scaleX:             toFixed(this.scaleX, NUM_FRACTION_DIGITS),
scaleY:             toFixed(this.scaleY, NUM_FRACTION_DIGITS),
angle:              toFixed(this.getAngle(), NUM_FRACTION_DIGITS),
flipX:              this.flipX,
flipY:              this.flipY,
opacity:            toFixed(this.opacity, NUM_FRACTION_DIGITS),
shadow:             (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,
visible:            this.visible,
clipTo:             this.clipTo && String(this.clipTo),
backgroundColor:    this.backgroundColor
};
if (!this.includeDefaultValues) {
object = this._removeDefaultValues(object);
}
fabric.util.populateWithProperties(this, object, propertiesToInclude);
return object;
},
/**
* Returns (dataless) object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} Object representation of an instance
*/
toDatalessObject: function(propertiesToInclude) {
return this.toObject(propertiesToInclude);
},
/**
* @private
* @param {Object} object
*/
_removeDefaultValues: function(object) {
var prototype = fabric.util.getKlass(object.type).prototype;
var stateProperties = prototype.stateProperties;
stateProperties.forEach(function(prop) {
if (object[prop] === prototype[prop]) {
delete object[prop];
}
});
return object;
},
/**
* Returns a string representation of an instance
* @return {String}
*/
toString: function() {
return "#<fabric." + capitalize(this.type) + ">";
},
/**
* Basic getter
* @param {String} property Property name
* @return {Any} value of a property
*/
get: function(property) {
return this[property];
},
/**
* Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.
* @param {String|Object} key Property name or object (if object, iterate over the object properties)
* @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)
* @return {fabric.Object} thisArg
* @chainable
*/
set: function(key, value) {
if (typeof key === 'object') {
for (var prop in key) {
this._set(prop, key[prop]);
}
}
else {
if (typeof value === 'function' && key !== 'clipTo') {
this._set(key, value(this.get(key)));
}
else {
this._set(key, value);
}
}
return this;
},
/**
* @private
* @param {String} key
* @param {Any} value
* @return {fabric.Object} thisArg
*/
_set: function(key, value) {
var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY');
if (shouldConstrainValue) {
value = this._constrainScale(value);
}
if (key === 'scaleX' && value < 0) {
this.flipX = !this.flipX;
value *= -1;
}
else if (key === 'scaleY' && value < 0) {
this.flipY = !this.flipY;
value *= -1;
}
else if (key === 'width' || key === 'height') {
this.minScaleLimit = toFixed(Math.min(0.1, 1/Math.max(this.width, this.height)), 2);
}
else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {
value = new fabric.Shadow(value);
}
this[key] = value;
return this;
},
/**
* Toggles specified property from `true` to `false` or from `false` to `true`
* @param {String} property Property to toggle
* @return {fabric.Object} thisArg
* @chainable
*/
toggle: function(property) {
var value = this.get(property);
if (typeof value === 'boolean') {
this.set(property, !value);
}
return this;
},
/**
* Sets sourcePath of an object
* @param {String} value Value to set sourcePath to
* @return {fabric.Object} thisArg
* @chainable
*/
setSourcePath: function(value) {
this.sourcePath = value;
return this;
},
/**
* Renders an object on a specified context
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Boolean} [noTransform] When true, context is not transformed
*/
render: function(ctx, noTransform) {
if (this.width === 0 || this.height === 0 || !this.visible) return;
ctx.save();
this._transform(ctx, noTransform);
this._setStrokeStyles(ctx);
this._setFillStyles(ctx);
var m = this.transformMatrix;
if (m && this.group) {
ctx.translate(-this.group.width/2, -this.group.height/2);
ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);
}
this._setShadow(ctx);
this.clipTo && fabric.util.clipContext(this, ctx);
this._render(ctx, noTransform);
this.clipTo && ctx.restore();
this._removeShadow(ctx);
if (this.active && !noTransform) {
this.drawBorders(ctx);
this.drawControls(ctx);
}
ctx.restore();
},
_transform: function(ctx, noTransform) {
var m = this.transformMatrix;
if (m && !this.group) {
ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
}
if (!noTransform) {
this.transform(ctx);
}
},
_setStrokeStyles: function(ctx) {
if (this.stroke) {
ctx.lineWidth = this.strokeWidth;
ctx.lineCap = this.strokeLineCap;
ctx.lineJoin = this.strokeLineJoin;
ctx.miterLimit = this.strokeMiterLimit;
ctx.strokeStyle = this.stroke.toLive
? this.stroke.toLive(ctx)
: this.stroke;
}
},
_setFillStyles: function(ctx) {
if (this.fill) {
ctx.fillStyle = this.fill.toLive
? this.fill.toLive(ctx)
: this.fill;
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_setShadow: function(ctx) {
if (!this.shadow) return;
ctx.shadowColor = this.shadow.color;
ctx.shadowBlur = this.shadow.blur;
ctx.shadowOffsetX = this.shadow.offsetX;
ctx.shadowOffsetY = this.shadow.offsetY;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_removeShadow: function(ctx) {
ctx.shadowColor = '';
ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderFill: function(ctx) {
if (!this.fill) return;
if (this.fill.toLive) {
ctx.save();
ctx.translate(
-this.width / 2 + this.fill.offsetX || 0,
-this.height / 2 + this.fill.offsetY || 0);
}
ctx.fill();
if (this.fill.toLive) {
ctx.restore();
}
if (this.shadow && !this.shadow.affectStroke) {
this._removeShadow(ctx);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderStroke: function(ctx) {
if (!this.stroke) return;
ctx.save();
if (this.strokeDashArray) {
if (1 & this.strokeDashArray.length) {
this.strokeDashArray.push.apply(this.strokeDashArray, this.strokeDashArray);
}
if (supportsLineDash) {
ctx.setLineDash(this.strokeDashArray);
this._stroke && this._stroke(ctx);
}
else {
this._renderDashedStroke && this._renderDashedStroke(ctx);
}
ctx.stroke();
}
else {
this._stroke ? this._stroke(ctx) : ctx.stroke();
}
this._removeShadow(ctx);
ctx.restore();
},
/**
* Clones an instance
* @param {Function} callback Callback is invoked with a clone as a first argument
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {fabric.Object} clone of an instance
*/
clone: function(callback, propertiesToInclude) {
if (this.constructor.fromObject) {
return this.constructor.fromObject(this.toObject(propertiesToInclude), callback);
}
return new fabric.Object(this.toObject(propertiesToInclude));
},
/**
* Creates an instance of fabric.Image out of an object
* @param callback {Function} callback, invoked with an instance as a first argument
* @return {fabric.Object} thisArg
*/
cloneAsImage: function(callback) {
var dataUrl = this.toDataURL();
fabric.util.loadImage(dataUrl, function(img) {
if (callback) {
callback(new fabric.Image(img));
}
});
return this;
},
/**
* Converts an object into a data-url-like string
* @param {Object} options Options object
* @param {String} [options.format=png] The format of the output image. Either "jpeg" or "png"
* @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.
* @param {Number} [options.multiplier=1] Multiplier to scale by
* @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14
* @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14
* @param {Number} [options.width] Cropping width. Introduced in v1.2.14
* @param {Number} [options.height] Cropping height. Introduced in v1.2.14
* @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format
*/
toDataURL: function(options) {
options || (options = { });
var el = fabric.util.createCanvasElement(),
boundingRect = this.getBoundingRect();
el.width = boundingRect.width;
el.height = boundingRect.height;
fabric.util.wrapElement(el, 'div');
var canvas = new fabric.Canvas(el);
if (options.format === 'jpg') {
options.format = 'jpeg';
}
if (options.format === 'jpeg') {
canvas.backgroundColor = '#fff';
}
var origParams = {
active: this.get('active'),
left: this.getLeft(),
top: this.getTop()
};
this.set('active', false);
this.setPositionByOrigin(new fabric.Point(el.width / 2, el.height / 2), 'center', 'center');
var originalCanvas = this.canvas;
canvas.add(this);
var data = canvas.toDataURL(options);
this.set(origParams).setCoords();
this.canvas = originalCanvas;
canvas.dispose();
canvas = null;
return data;
},
/**
* Returns true if specified type is identical to the type of an instance
* @param type {String} type Type to check against
* @return {Boolean}
*/
isType: function(type) {
return this.type === type;
},
/**
* Returns complexity of an instance
* @return {Number} complexity of this instance
*/
complexity: function() {
return 0;
},
/**
* Returns a JSON representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} JSON
*/
toJSON: function(propertiesToInclude) {
return this.toObject(propertiesToInclude);
},
/**
* Sets gradient (fill or stroke) of an object
* <b>Backwards incompatibility note:</b> This method was named "setGradientFill" until v1.1.0
* @param {String} property Property name 'stroke' or 'fill'
* @param {Object} [options] Options object
* @param {String} [options.type] Type of gradient 'radial' or 'linear'
* @param {Number} [options.x1=0] x-coordinate of start point
* @param {Number} [options.y1=0] y-coordinate of start point
* @param {Number} [options.x2=0] x-coordinate of end point
* @param {Number} [options.y2=0] y-coordinate of end point
* @param {Number} [options.r1=0] Radius of start point (only for radial gradients)
* @param {Number} [options.r2=0] Radius of end point (only for radial gradients)
* @param {Object} [options.colorStops] Color stops object eg. {0: 'ff0000', 1: '000000'}
* @return {fabric.Object} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/58y8b/|jsFiddle demo}
* @example <caption>Set linear gradient</caption>
* object.setGradient('fill', {
*   type: 'linear',
*   x1: -object.width / 2,
*   y1: 0,
*   x2: object.width / 2,
*   y2: 0,
*   colorStops: {
*     0: 'red',
*     0.5: '#005555',
*     1: 'rgba(0,0,255,0.5)'
*   }
* });
* canvas.renderAll();
* @example <caption>Set radial gradient</caption>
* object.setGradient('fill', {
*   type: 'radial',
*   x1: 0,
*   y1: 0,
*   x2: 0,
*   y2: 0,
*   r1: object.width / 2,
*   r2: 10,
*   colorStops: {
*     0: 'red',
*     0.5: '#005555',
*     1: 'rgba(0,0,255,0.5)'
*   }
* });
* canvas.renderAll();
*/
setGradient: function(property, options) {
options || (options = { });
var gradient = {colorStops: []};
gradient.type = options.type || (options.r1 || options.r2 ? 'radial' : 'linear');
gradient.coords = {
x1: options.x1,
y1: options.y1,
x2: options.x2,
y2: options.y2
};
if (options.r1 || options.r2) {
gradient.coords.r1 = options.r1;
gradient.coords.r2 = options.r2;
}
for (var position in options.colorStops) {
var color = new fabric.Color(options.colorStops[position]);
gradient.colorStops.push({offset: position, color: color.toRgb(), opacity: color.getAlpha()});
}
return this.set(property, fabric.Gradient.forObject(this, gradient));
},
/**
* Sets pattern fill of an object
* @param {Object} options Options object
* @param {(String|HTMLImageElement)} options.source Pattern source
* @param {String} [options.repeat=repeat] Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)
* @param {Number} [options.offsetX=0] Pattern horizontal offset from object's left/top corner
* @param {Number} [options.offsetY=0] Pattern vertical offset from object's left/top corner
* @return {fabric.Object} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/QT3pa/|jsFiddle demo}
* @example <caption>Set pattern</caption>
* fabric.util.loadImage('http://fabricjs.com/assets/escheresque_ste.png', function(img) {
*   object.setPatternFill({
*     source: img,
*     repeat: 'repeat'
*   });
*   canvas.renderAll();
* });
*/
setPatternFill: function(options) {
return this.set('fill', new fabric.Pattern(options));
},
/**
* Sets {@link fabric.Object#shadow|shadow} of an object
* @param {Object|String} [options] Options object or string (e.g. "2px 2px 10px rgba(0,0,0,0.2)")
* @param {String} [options.color=rgb(0,0,0)] Shadow color
* @param {Number} [options.blur=0] Shadow blur
* @param {Number} [options.offsetX=0] Shadow horizontal offset
* @param {Number} [options.offsetY=0] Shadow vertical offset
* @return {fabric.Object} thisArg
* @chainable
* @see {@link http://jsfiddle.net/fabricjs/7gvJG/|jsFiddle demo}
* @example <caption>Set shadow with string notation</caption>
* object.setShadow('2px 2px 10px rgba(0,0,0,0.2)');
* canvas.renderAll();
* @example <caption>Set shadow with object notation</caption>
* object.setShadow({
*   color: 'red',
*   blur: 10,
*   offsetX: 20,
*   offsetY: 20
* });
* canvas.renderAll();
*/
setShadow: function(options) {
return this.set('shadow', new fabric.Shadow(options));
},
/**
* Sets "color" of an instance (alias of `set('fill', &hellip;)`)
* @param {String} color Color value
* @return {fabric.Text} thisArg
* @chainable
*/
setColor: function(color) {
this.set('fill', color);
return this;
},
/**
* Centers object horizontally on canvas to which it was added last.
* You might need to call `setCoords` on an object after centering, to update controls area.
* @return {fabric.Object} thisArg
* @chainable
*/
centerH: function () {
this.canvas.centerObjectH(this);
return this;
},
/**
* Centers object vertically on canvas to which it was added last.
* You might need to call `setCoords` on an object after centering, to update controls area.
* @return {fabric.Object} thisArg
* @chainable
*/
centerV: function () {
this.canvas.centerObjectV(this);
return this;
},
/**
* Centers object vertically and horizontally on canvas to which is was added last
* You might need to call `setCoords` on an object after centering, to update controls area.
* @return {fabric.Object} thisArg
* @chainable
*/
center: function () {
this.canvas.centerObject(this);
return this;
},
/**
* Removes object from canvas to which it was added last
* @return {fabric.Object} thisArg
* @chainable
*/
remove: function() {
return this.canvas.remove(this);
},
/**
* Returns coordinates of a pointer relative to an object
* @param {Event} e Event to operate upon
* @param {Object} [pointer] Pointer to operate upon (instead of event)
* @return {Object} Coordinates of a pointer (x, y)
*/
getLocalPointer: function(e, pointer) {
pointer = pointer || this.canvas.getPointer(e);
var objectLeftTop = this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');
return {
x: pointer.x - objectLeftTop.x,
y: pointer.y - objectLeftTop.y
};
}
});
fabric.util.createAccessors(fabric.Object);
/**
* Alias for {@link fabric.Object.prototype.setAngle}
* @alias rotate -> setAngle
* @memberof fabric.Object
*/
fabric.Object.prototype.rotate = fabric.Object.prototype.setAngle;
extend(fabric.Object.prototype, fabric.Observable);
/**
* Defines the number of fraction digits to use when serializing object values.
* You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.
* @static
* @memberof fabric.Object
* @constant
* @type Number
*/
fabric.Object.NUM_FRACTION_DIGITS = 2;
/**
* Unique id used internally when creating SVG elements
* @static
* @memberof fabric.Object
* @type Number
*/
fabric.Object.__uid = 0;
})(typeof exports !== 'undefined' ? exports : this);
(function() {
var degreesToRadians = fabric.util.degreesToRadians;
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* Translates the coordinates from origin to center coordinates (based on the object's dimensions)
* @param {fabric.Point} point The point which corresponds to the originX and originY params
* @param {String} originX Horizontal origin: 'left', 'center' or 'right'
* @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
* @return {fabric.Point}
*/
translateToCenterPoint: function(point, originX, originY) {
var cx = point.x,
cy = point.y,
strokeWidth = this.stroke ? this.strokeWidth : 0;
if (originX === "left") {
cx = point.x + (this.getWidth() + strokeWidth * this.scaleX) / 2;
}
else if (originX === "right") {
cx = point.x - (this.getWidth() + strokeWidth * this.scaleX) / 2;
}
if (originY === "top") {
cy = point.y + (this.getHeight() + strokeWidth * this.scaleY) / 2;
}
else if (originY === "bottom") {
cy = point.y - (this.getHeight() + strokeWidth * this.scaleY) / 2;
}
return fabric.util.rotatePoint(new fabric.Point(cx, cy), point, degreesToRadians(this.angle));
},
/**
* Translates the coordinates from center to origin coordinates (based on the object's dimensions)
* @param {fabric.Point} point The point which corresponds to center of the object
* @param {String} originX Horizontal origin: 'left', 'center' or 'right'
* @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
* @return {fabric.Point}
*/
translateToOriginPoint: function(center, originX, originY) {
var x = center.x,
y = center.y,
strokeWidth = this.stroke ? this.strokeWidth : 0;
if (originX === "left") {
x = center.x - (this.getWidth() + strokeWidth * this.scaleX) / 2;
}
else if (originX === "right") {
x = center.x + (this.getWidth() + strokeWidth * this.scaleX) / 2;
}
if (originY === "top") {
y = center.y - (this.getHeight() + strokeWidth * this.scaleY) / 2;
}
else if (originY === "bottom") {
y = center.y + (this.getHeight() + strokeWidth * this.scaleY) / 2;
}
return fabric.util.rotatePoint(new fabric.Point(x, y), center, degreesToRadians(this.angle));
},
/**
* Returns the real center coordinates of the object
* @return {fabric.Point}
*/
getCenterPoint: function() {
var leftTop = new fabric.Point(this.left, this.top);
return this.translateToCenterPoint(leftTop, this.originX, this.originY);
},
/**
* Returns the coordinates of the object based on center coordinates
* @param {fabric.Point} point The point which corresponds to the originX and originY params
* @return {fabric.Point}
*/
/**
* Returns the coordinates of the object as if it has a different origin
* @param {String} originX Horizontal origin: 'left', 'center' or 'right'
* @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
* @return {fabric.Point}
*/
getPointByOrigin: function(originX, originY) {
var center = this.getCenterPoint();
return this.translateToOriginPoint(center, originX, originY);
},
/**
* Returns the point in local coordinates
* @param {fabric.Point} point The point relative to the global coordinate system
* @param {String} originX Horizontal origin: 'left', 'center' or 'right'
* @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
* @return {fabric.Point}
*/
toLocalPoint: function(point, originX, originY) {
var center = this.getCenterPoint(),
strokeWidth = this.stroke ? this.strokeWidth : 0,
x, y;
if (originX && originY) {
if (originX === "left") {
x = center.x - (this.getWidth() + strokeWidth * this.scaleX) / 2;
}
else if (originX === "right") {
x = center.x + (this.getWidth() + strokeWidth * this.scaleX) / 2;
}
else {
x = center.x;
}
if (originY === "top") {
y = center.y - (this.getHeight() + strokeWidth * this.scaleY) / 2;
}
else if (originY === "bottom") {
y = center.y + (this.getHeight() + strokeWidth * this.scaleY) / 2;
}
else {
y = center.y;
}
}
else {
x = this.left;
y = this.top;
}
return fabric.util.rotatePoint(new fabric.Point(point.x, point.y), center, -degreesToRadians(this.angle))
.subtractEquals(new fabric.Point(x, y));
},
/**
* Returns the point in global coordinates
* @param {fabric.Point} The point relative to the local coordinate system
* @return {fabric.Point}
*/
/**
* Sets the position of the object taking into consideration the object's origin
* @param {fabric.Point} point The new position of the object
* @param {String} originX Horizontal origin: 'left', 'center' or 'right'
* @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
* @return {void}
*/
setPositionByOrigin: function(pos, originX, originY) {
var center = this.translateToCenterPoint(pos, originX, originY);
var position = this.translateToOriginPoint(center, this.originX, this.originY);
this.set('left', position.x);
this.set('top', position.y);
},
/**
* @param {String} to One of 'left', 'center', 'right'
*/
adjustPosition: function(to) {
var angle = degreesToRadians(this.angle);
var hypotHalf = this.getWidth() / 2;
var xHalf = Math.cos(angle) * hypotHalf;
var yHalf = Math.sin(angle) * hypotHalf;
var hypotFull = this.getWidth();
var xFull = Math.cos(angle) * hypotFull;
var yFull = Math.sin(angle) * hypotFull;
if (this.originX === 'center' && to === 'left' ||
this.originX === 'right' && to === 'center') {
this.left -= xHalf;
this.top -= yHalf;
}
else if (this.originX === 'left' && to === 'center' ||
this.originX === 'center' && to === 'right') {
this.left += xHalf;
this.top += yHalf;
}
else if (this.originX === 'left' && to === 'right') {
this.left += xFull;
this.top += yFull;
}
else if (this.originX === 'right' && to === 'left') {
this.left -= xFull;
this.top -= yFull;
}
this.setCoords();
this.originX = to;
},
/**
* @private
*/
_getLeftTopCoords: function() {
return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'center');
}
});
})();
(function() {
var degreesToRadians = fabric.util.degreesToRadians;
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* Object containing coordinates of object's controls
* @type Object
* @default
*/
oCoords: null,
/**
* Checks if object intersects with an area formed by 2 points
* @param {Object} pointTL top-left point of area
* @param {Object} pointBR bottom-right point of area
* @return {Boolean} true if object intersects with an area formed by 2 points
*/
intersectsWithRect: function(pointTL, pointBR) {
var oCoords = this.oCoords,
tl = new fabric.Point(oCoords.tl.x, oCoords.tl.y),
tr = new fabric.Point(oCoords.tr.x, oCoords.tr.y),
bl = new fabric.Point(oCoords.bl.x, oCoords.bl.y),
br = new fabric.Point(oCoords.br.x, oCoords.br.y);
var intersection = fabric.Intersection.intersectPolygonRectangle(
[tl, tr, br, bl],
pointTL,
pointBR
);
return intersection.status === 'Intersection';
},
/**
* Checks if object intersects with another object
* @param {Object} other Object to test
* @return {Boolean} true if object intersects with another object
*/
intersectsWithObject: function(other) {
function getCoords(oCoords) {
return {
tl: new fabric.Point(oCoords.tl.x, oCoords.tl.y),
tr: new fabric.Point(oCoords.tr.x, oCoords.tr.y),
bl: new fabric.Point(oCoords.bl.x, oCoords.bl.y),
br: new fabric.Point(oCoords.br.x, oCoords.br.y)
};
}
var thisCoords = getCoords(this.oCoords),
otherCoords = getCoords(other.oCoords);
var intersection = fabric.Intersection.intersectPolygonPolygon(
[thisCoords.tl, thisCoords.tr, thisCoords.br, thisCoords.bl],
[otherCoords.tl, otherCoords.tr, otherCoords.br, otherCoords.bl]
);
return intersection.status === 'Intersection';
},
/**
* Checks if object is fully contained within area of another object
* @param {Object} other Object to test
* @return {Boolean} true if object is fully contained within area of another object
*/
isContainedWithinObject: function(other) {
var boundingRect = other.getBoundingRect(),
point1 = new fabric.Point(boundingRect.left, boundingRect.top),
point2 = new fabric.Point(boundingRect.left + boundingRect.width, boundingRect.top + boundingRect.height);
return this.isContainedWithinRect(point1, point2);
},
/**
* Checks if object is fully contained within area formed by 2 points
* @param {Object} pointTL top-left point of area
* @param {Object} pointBR bottom-right point of area
* @return {Boolean} true if object is fully contained within area formed by 2 points
*/
isContainedWithinRect: function(pointTL, pointBR) {
var boundingRect = this.getBoundingRect();
return (
boundingRect.left > pointTL.x &&
boundingRect.left + boundingRect.width < pointBR.x &&
boundingRect.top > pointTL.y &&
boundingRect.top + boundingRect.height < pointBR.y
);
},
/**
* Checks if point is inside the object
* @param {fabric.Point} point Point to check against
* @return {Boolean} true if point is inside the object
*/
containsPoint: function(point) {
var lines = this._getImageLines(this.oCoords),
xPoints = this._findCrossPoints(point, lines);
return (xPoints !== 0 && xPoints % 2 === 1);
},
/**
* Method that returns an object with the object edges in it, given the coordinates of the corners
* @private
* @param {Object} oCoords Coordinates of the object corners
*/
_getImageLines: function(oCoords) {
return {
topline: {
o: oCoords.tl,
d: oCoords.tr
},
rightline: {
o: oCoords.tr,
d: oCoords.br
},
bottomline: {
o: oCoords.br,
d: oCoords.bl
},
leftline: {
o: oCoords.bl,
d: oCoords.tl
}
};
},
/**
* Helper method to determine how many cross points are between the 4 object edges
* and the horizontal line determined by a point on canvas
* @private
* @param {fabric.Point} point Point to check
* @param {Object} oCoords Coordinates of the object being evaluated
*/
_findCrossPoints: function(point, oCoords) {
var b1, b2, a1, a2, xi, yi,
xcount = 0,
iLine;
for (var lineKey in oCoords) {
iLine = oCoords[lineKey];
if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {
continue;
}
if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {
continue;
}
if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {
xi = iLine.o.x;
yi = point.y;
}
else {
b1 = 0;
b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);
a1 = point.y- b1 * point.x;
a2 = iLine.o.y - b2 * iLine.o.x;
xi = - (a1 - a2) / (b1 - b2);
yi = a1 + b1 * xi;
}
if (xi >= point.x) {
xcount += 1;
}
if (xcount === 2) {
break;
}
}
return xcount;
},
/**
* Returns width of an object's bounding rectangle
* @deprecated since 1.0.4
* @return {Number} width value
*/
getBoundingRectWidth: function() {
return this.getBoundingRect().width;
},
/**
* Returns height of an object's bounding rectangle
* @deprecated since 1.0.4
* @return {Number} height value
*/
getBoundingRectHeight: function() {
return this.getBoundingRect().height;
},
/**
* Returns coordinates of object's bounding rectangle (left, top, width, height)
* @return {Object} Object with left, top, width, height properties
*/
getBoundingRect: function() {
this.oCoords || this.setCoords();
var xCoords = [this.oCoords.tl.x, this.oCoords.tr.x, this.oCoords.br.x, this.oCoords.bl.x];
var minX = fabric.util.array.min(xCoords);
var maxX = fabric.util.array.max(xCoords);
var width = Math.abs(minX - maxX);
var yCoords = [this.oCoords.tl.y, this.oCoords.tr.y, this.oCoords.br.y, this.oCoords.bl.y];
var minY = fabric.util.array.min(yCoords);
var maxY = fabric.util.array.max(yCoords);
var height = Math.abs(minY - maxY);
return {
left: minX,
top: minY,
width: width,
height: height
};
},
/**
* Returns width of an object
* @return {Number} width value
*/
getWidth: function() {
return this.width * this.scaleX;
},
/**
* Returns height of an object
* @return {Number} height value
*/
getHeight: function() {
return this.height * this.scaleY;
},
/**
* Makes sure the scale is valid and modifies it if necessary
* @private
* @param {Number} value
* @return {Number}
*/
_constrainScale: function(value) {
if (Math.abs(value) < this.minScaleLimit) {
if (value < 0)
return -this.minScaleLimit;
else
return this.minScaleLimit;
}
return value;
},
/**
* Scales an object (equally by x and y)
* @param value {Number} scale factor
* @return {fabric.Object} thisArg
* @chainable
*/
scale: function(value) {
value = this._constrainScale(value);
if (value < 0) {
this.flipX = !this.flipX;
this.flipY = !this.flipY;
value *= -1;
}
this.scaleX = value;
this.scaleY = value;
this.setCoords();
return this;
},
/**
* Scales an object to a given width, with respect to bounding box (scaling by x/y equally)
* @param value {Number} new width value
* @return {fabric.Object} thisArg
* @chainable
*/
scaleToWidth: function(value) {
var boundingRectFactor = this.getBoundingRectWidth() / this.getWidth();
return this.scale(value / this.width / boundingRectFactor);
},
/**
* Scales an object to a given height, with respect to bounding box (scaling by x/y equally)
* @param value {Number} new height value
* @return {fabric.Object} thisArg
* @chainable
*/
scaleToHeight: function(value) {
var boundingRectFactor = this.getBoundingRectHeight() / this.getHeight();
return this.scale(value / this.height / boundingRectFactor);
},
/**
* Sets corner position coordinates based on current angle, width and height
* @return {fabric.Object} thisArg
* @chainable
*/
setCoords: function() {
var strokeWidth = this.strokeWidth > 1 ? this.strokeWidth : 0,
padding = this.padding,
theta = degreesToRadians(this.angle);
this.currentWidth = (this.width + strokeWidth) * this.scaleX + padding * 2;
this.currentHeight = (this.height + strokeWidth) * this.scaleY + padding * 2;
if (this.currentWidth < 0) {
this.currentWidth = Math.abs(this.currentWidth);
}
var _hypotenuse = Math.sqrt(
Math.pow(this.currentWidth / 2, 2) +
Math.pow(this.currentHeight / 2, 2));
var _angle = Math.atan(isFinite(this.currentHeight / this.currentWidth) ? this.currentHeight / this.currentWidth : 0);
var offsetX = Math.cos(_angle + theta) * _hypotenuse,
offsetY = Math.sin(_angle + theta) * _hypotenuse,
sinTh = Math.sin(theta),
cosTh = Math.cos(theta);
var coords = this.getCenterPoint();
var tl = {
x: coords.x - offsetX,
y: coords.y - offsetY
};
var tr = {
x: tl.x + (this.currentWidth * cosTh),
y: tl.y + (this.currentWidth * sinTh)
};
var br = {
x: tr.x - (this.currentHeight * sinTh),
y: tr.y + (this.currentHeight * cosTh)
};
var bl = {
x: tl.x - (this.currentHeight * sinTh),
y: tl.y + (this.currentHeight * cosTh)
};
var ml = {
x: tl.x - (this.currentHeight/2 * sinTh),
y: tl.y + (this.currentHeight/2 * cosTh)
};
var mt = {
x: tl.x + (this.currentWidth/2 * cosTh),
y: tl.y + (this.currentWidth/2 * sinTh)
};
var mr = {
x: tr.x - (this.currentHeight/2 * sinTh),
y: tr.y + (this.currentHeight/2 * cosTh)
};
var mb = {
x: bl.x + (this.currentWidth/2 * cosTh),
y: bl.y + (this.currentWidth/2 * sinTh)
};
var mtr = {
x: mt.x,
y: mt.y
};
this.oCoords = {
tl: tl, tr: tr, br: br, bl: bl,
ml: ml, mt: mt, mr: mr, mb: mb,
mtr: mtr
};
this._setCornerCoords && this._setCornerCoords();
return this;
}
});
})();
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* Moves an object to the bottom of the stack of drawn objects
* @return {fabric.Object} thisArg
* @chainable
*/
sendToBack: function() {
if (this.group) {
fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);
}
else {
this.canvas.sendToBack(this);
}
return this;
},
/**
* Moves an object to the top of the stack of drawn objects
* @return {fabric.Object} thisArg
* @chainable
*/
bringToFront: function() {
if (this.group) {
fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);
}
else {
this.canvas.bringToFront(this);
}
return this;
},
/**
* Moves an object down in stack of drawn objects
* @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object
* @return {fabric.Object} thisArg
* @chainable
*/
sendBackwards: function(intersecting) {
if (this.group) {
fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);
}
else {
this.canvas.sendBackwards(this, intersecting);
}
return this;
},
/**
* Moves an object up in stack of drawn objects
* @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object
* @return {fabric.Object} thisArg
* @chainable
*/
bringForward: function(intersecting) {
if (this.group) {
fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);
}
else {
this.canvas.bringForward(this, intersecting);
}
return this;
},
/**
* Moves an object to specified level in stack of drawn objects
* @param {Number} index New position of object
* @return {fabric.Object} thisArg
* @chainable
*/
moveTo: function(index) {
if (this.group) {
fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);
}
else {
this.canvas.moveTo(this, index);
}
return this;
}
});
/* _TO_SVG_START_ */
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* Returns styles-string for svg-export
* @return {String}
*/
getSvgStyles: function() {
var fill = this.fill
? (this.fill.toLive ? 'url(#SVGID_' + this.fill.id + ')' : this.fill)
: 'none';
var stroke = this.stroke
? (this.stroke.toLive ? 'url(#SVGID_' + this.stroke.id + ')' : this.stroke)
: 'none';
var strokeWidth = this.strokeWidth ? this.strokeWidth : '0';
var strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : '';
var strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt';
var strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter';
var strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4';
var opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1';
var visibility = this.visible ? '' : " visibility: hidden;";
var filter = this.shadow && this.type !== 'text' ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';
return [
"stroke: ", stroke, "; ",
"stroke-width: ", strokeWidth, "; ",
"stroke-dasharray: ", strokeDashArray, "; ",
"stroke-linecap: ", strokeLineCap, "; ",
"stroke-linejoin: ", strokeLineJoin, "; ",
"stroke-miterlimit: ", strokeMiterLimit, "; ",
"fill: ", fill, "; ",
"opacity: ", opacity, ";",
filter,
visibility
].join('');
},
/**
* Returns transform-string for svg-export
* @return {String}
*/
getSvgTransform: function() {
var toFixed = fabric.util.toFixed;
var angle = this.getAngle();
var center = this.getCenterPoint();
var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;
var translatePart = "translate(" +
toFixed(center.x, NUM_FRACTION_DIGITS) +
" " +
toFixed(center.y, NUM_FRACTION_DIGITS) +
")";
var anglePart = angle !== 0
? (" rotate(" + toFixed(angle, NUM_FRACTION_DIGITS) + ")")
: '';
var scalePart = (this.scaleX === 1 && this.scaleY === 1)
? '' :
(" scale(" +
toFixed(this.scaleX, NUM_FRACTION_DIGITS) +
" " +
toFixed(this.scaleY, NUM_FRACTION_DIGITS) +
")");
var flipXPart = this.flipX ? "matrix(-1 0 0 1 0 0) " : "";
var flipYPart = this.flipY ? "matrix(1 0 0 -1 0 0)" : "";
return [ translatePart, anglePart, scalePart, flipXPart, flipYPart ].join('');
},
/**
* @private
*/
_createBaseSVGMarkup: function() {
var markup = [ ];
if (this.fill && this.fill.toLive) {
markup.push(this.fill.toSVG(this, false));
}
if (this.stroke && this.stroke.toLive) {
markup.push(this.stroke.toSVG(this, false));
}
if (this.shadow) {
markup.push(this.shadow.toSVG(this));
}
return markup;
}
});
/* _TO_SVG_END_ */
/*
Depends on `stateProperties`
*/
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* Returns true if object state (one of its state properties) was changed
* @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called
*/
hasStateChanged: function() {
return this.stateProperties.some(function(prop) {
return this.get(prop) !== this.originalState[prop];
}, this);
},
/**
* Saves state of an object
* @param {Object} [options] Object with additional `stateProperties` array to include when saving state
* @return {fabric.Object} thisArg
*/
saveState: function(options) {
this.stateProperties.forEach(function(prop) {
this.originalState[prop] = this.get(prop);
}, this);
if (options && options.stateProperties) {
options.stateProperties.forEach(function(prop) {
this.originalState[prop] = this.get(prop);
}, this);
}
return this;
},
/**
* Setups state of an object
* @return {fabric.Object} thisArg
*/
setupState: function() {
this.originalState = { };
this.saveState();
return this;
}
});
(function(){
var getPointer = fabric.util.getPointer,
degreesToRadians = fabric.util.degreesToRadians,
isVML = typeof G_vmlCanvasManager !== 'undefined';
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* The object interactivity controls.
* @private
*/
_controlsVisibility: null,
/**
* Determines which corner has been clicked
* @private
* @param {Event} e Event object
* @param {Object} offset Canvas offset
* @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found
*/
_findTargetCorner: function(e, offset) {
if (!this.hasControls || !this.active) return false;
var pointer = getPointer(e, this.canvas.upperCanvasEl),
ex = pointer.x - offset.left,
ey = pointer.y - offset.top,
xPoints,
lines;
for (var i in this.oCoords) {
if (!this.isControlVisible(i)) {
continue;
}
if (i === 'mtr' && !this.hasRotatingPoint) {
continue;
}
if (this.get('lockUniScaling') && (i === 'mt' || i === 'mr' || i === 'mb' || i === 'ml')) {
continue;
}
lines = this._getImageLines(this.oCoords[i].corner);
xPoints = this._findCrossPoints({x: ex, y: ey}, lines);
if (xPoints !== 0 && xPoints % 2 === 1) {
this.__corner = i;
return i;
}
}
return false;
},
/**
* Sets the coordinates of the draggable boxes in the corners of
* the image used to scale/rotate it.
* @private
*/
_setCornerCoords: function() {
var coords = this.oCoords,
theta = degreesToRadians(this.angle),
newTheta = degreesToRadians(45 - this.angle),
cornerHypotenuse = Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2,
cosHalfOffset = cornerHypotenuse * Math.cos(newTheta),
sinHalfOffset = cornerHypotenuse * Math.sin(newTheta),
sinTh = Math.sin(theta),
cosTh = Math.cos(theta);
coords.tl.corner = {
tl: {
x: coords.tl.x - sinHalfOffset,
y: coords.tl.y - cosHalfOffset
},
tr: {
x: coords.tl.x + cosHalfOffset,
y: coords.tl.y - sinHalfOffset
},
bl: {
x: coords.tl.x - cosHalfOffset,
y: coords.tl.y + sinHalfOffset
},
br: {
x: coords.tl.x + sinHalfOffset,
y: coords.tl.y + cosHalfOffset
}
};
coords.tr.corner = {
tl: {
x: coords.tr.x - sinHalfOffset,
y: coords.tr.y - cosHalfOffset
},
tr: {
x: coords.tr.x + cosHalfOffset,
y: coords.tr.y - sinHalfOffset
},
br: {
x: coords.tr.x + sinHalfOffset,
y: coords.tr.y + cosHalfOffset
},
bl: {
x: coords.tr.x - cosHalfOffset,
y: coords.tr.y + sinHalfOffset
}
};
coords.bl.corner = {
tl: {
x: coords.bl.x - sinHalfOffset,
y: coords.bl.y - cosHalfOffset
},
bl: {
x: coords.bl.x - cosHalfOffset,
y: coords.bl.y + sinHalfOffset
},
br: {
x: coords.bl.x + sinHalfOffset,
y: coords.bl.y + cosHalfOffset
},
tr: {
x: coords.bl.x + cosHalfOffset,
y: coords.bl.y - sinHalfOffset
}
};
coords.br.corner = {
tr: {
x: coords.br.x + cosHalfOffset,
y: coords.br.y - sinHalfOffset
},
bl: {
x: coords.br.x - cosHalfOffset,
y: coords.br.y + sinHalfOffset
},
br: {
x: coords.br.x + sinHalfOffset,
y: coords.br.y + cosHalfOffset
},
tl: {
x: coords.br.x - sinHalfOffset,
y: coords.br.y - cosHalfOffset
}
};
coords.ml.corner = {
tl: {
x: coords.ml.x - sinHalfOffset,
y: coords.ml.y - cosHalfOffset
},
tr: {
x: coords.ml.x + cosHalfOffset,
y: coords.ml.y - sinHalfOffset
},
bl: {
x: coords.ml.x - cosHalfOffset,
y: coords.ml.y + sinHalfOffset
},
br: {
x: coords.ml.x + sinHalfOffset,
y: coords.ml.y + cosHalfOffset
}
};
coords.mt.corner = {
tl: {
x: coords.mt.x - sinHalfOffset,
y: coords.mt.y - cosHalfOffset
},
tr: {
x: coords.mt.x + cosHalfOffset,
y: coords.mt.y - sinHalfOffset
},
bl: {
x: coords.mt.x - cosHalfOffset,
y: coords.mt.y + sinHalfOffset
},
br: {
x: coords.mt.x + sinHalfOffset,
y: coords.mt.y + cosHalfOffset
}
};
coords.mr.corner = {
tl: {
x: coords.mr.x - sinHalfOffset,
y: coords.mr.y - cosHalfOffset
},
tr: {
x: coords.mr.x + cosHalfOffset,
y: coords.mr.y - sinHalfOffset
},
bl: {
x: coords.mr.x - cosHalfOffset,
y: coords.mr.y + sinHalfOffset
},
br: {
x: coords.mr.x + sinHalfOffset,
y: coords.mr.y + cosHalfOffset
}
};
coords.mb.corner = {
tl: {
x: coords.mb.x - sinHalfOffset,
y: coords.mb.y - cosHalfOffset
},
tr: {
x: coords.mb.x + cosHalfOffset,
y: coords.mb.y - sinHalfOffset
},
bl: {
x: coords.mb.x - cosHalfOffset,
y: coords.mb.y + sinHalfOffset
},
br: {
x: coords.mb.x + sinHalfOffset,
y: coords.mb.y + cosHalfOffset
}
};
coords.mtr.corner = {
tl: {
x: coords.mtr.x - sinHalfOffset + (sinTh * this.rotatingPointOffset),
y: coords.mtr.y - cosHalfOffset - (cosTh * this.rotatingPointOffset)
},
tr: {
x: coords.mtr.x + cosHalfOffset + (sinTh * this.rotatingPointOffset),
y: coords.mtr.y - sinHalfOffset - (cosTh * this.rotatingPointOffset)
},
bl: {
x: coords.mtr.x - cosHalfOffset + (sinTh * this.rotatingPointOffset),
y: coords.mtr.y + sinHalfOffset - (cosTh * this.rotatingPointOffset)
},
br: {
x: coords.mtr.x + sinHalfOffset + (sinTh * this.rotatingPointOffset),
y: coords.mtr.y + cosHalfOffset - (cosTh * this.rotatingPointOffset)
}
};
},
/**
* Draws borders of an object's bounding box.
* Requires public properties: width, height
* Requires public options: padding, borderColor
* @param {CanvasRenderingContext2D} ctx Context to draw on
* @return {fabric.Object} thisArg
* @chainable
*/
drawBorders: function(ctx) {
if (!this.hasBorders) return this;
var padding = this.padding,
padding2 = padding * 2,
strokeWidth = ~~(this.strokeWidth / 2) * 2; // Round down to even number
ctx.save();
ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;
ctx.strokeStyle = this.borderColor;
var scaleX = 1 / this._constrainScale(this.scaleX),
scaleY = 1 / this._constrainScale(this.scaleY);
ctx.lineWidth = 1 / this.borderScaleFactor;
ctx.scale(scaleX, scaleY);
var w = this.getWidth(),
h = this.getHeight();
ctx.strokeRect(
~~(-(w / 2) - padding - strokeWidth / 2 * this.scaleX) - 0.5, // offset needed to make lines look sharper
~~(-(h / 2) - padding - strokeWidth / 2 * this.scaleY) - 0.5,
~~(w + padding2 + strokeWidth * this.scaleX) + 1, // double offset needed to make lines look sharper
~~(h + padding2 + strokeWidth * this.scaleY) + 1
);
if (this.hasRotatingPoint && this.isControlVisible('mtr') && !this.get('lockRotation') && this.hasControls) {
var rotateHeight = (
this.flipY
? h + (strokeWidth * this.scaleY) + (padding * 2)
: -h - (strokeWidth * this.scaleY) - (padding * 2)
) / 2;
ctx.beginPath();
ctx.moveTo(0, rotateHeight);
ctx.lineTo(0, rotateHeight + (this.flipY ? this.rotatingPointOffset : -this.rotatingPointOffset));
ctx.closePath();
ctx.stroke();
}
ctx.restore();
return this;
},
/**
* Draws corners of an object's bounding box.
* Requires public properties: width, height, scaleX, scaleY
* Requires public options: cornerSize, padding
* @param {CanvasRenderingContext2D} ctx Context to draw on
* @return {fabric.Object} thisArg
* @chainable
*/
drawControls: function(ctx) {
if (!this.hasControls) return this;
var size = this.cornerSize,
size2 = size / 2,
strokeWidth2 = ~~(this.strokeWidth / 2), // half strokeWidth rounded down
left = -(this.width / 2),
top = -(this.height / 2),
paddingX = this.padding / this.scaleX,
paddingY = this.padding / this.scaleY,
scaleOffsetY = size2 / this.scaleY,
scaleOffsetX = size2 / this.scaleX,
scaleOffsetSizeX = (size2 - size) / this.scaleX,
scaleOffsetSizeY = (size2 - size) / this.scaleY,
height = this.height,
width = this.width,
methodName = this.transparentCorners ? 'strokeRect' : 'fillRect';
ctx.save();
ctx.lineWidth = 1 / Math.max(this.scaleX, this.scaleY);
ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;
ctx.strokeStyle = ctx.fillStyle = this.cornerColor;
this._drawControl('tl', ctx, methodName,
left - scaleOffsetX - strokeWidth2 - paddingX,
top - scaleOffsetY - strokeWidth2 - paddingY);
this._drawControl('tr', ctx, methodName,
left + width - scaleOffsetX + strokeWidth2 + paddingX,
top - scaleOffsetY - strokeWidth2 - paddingY);
this._drawControl('tr', ctx, methodName,
left - scaleOffsetX - strokeWidth2 - paddingX,
top + height + scaleOffsetSizeY + strokeWidth2 + paddingY);
this._drawControl('br', ctx, methodName,
left + width + scaleOffsetSizeX + strokeWidth2 + paddingX,
top + height + scaleOffsetSizeY + strokeWidth2 + paddingY);
if (!this.get('lockUniScaling')) {
this._drawControl('mt', ctx, methodName,
left + width/2 - scaleOffsetX,
top - scaleOffsetY - strokeWidth2 - paddingY);
this._drawControl('mb', ctx, methodName,
left + width/2 - scaleOffsetX,
top + height + scaleOffsetSizeY + strokeWidth2 + paddingY);
this._drawControl('mb', ctx, methodName,
left + width + scaleOffsetSizeX + strokeWidth2 + paddingX,
top + height/2 - scaleOffsetY);
this._drawControl('ml', ctx, methodName,
left - scaleOffsetX - strokeWidth2 - paddingX,
top + height/2 - scaleOffsetY);
}
if (this.hasRotatingPoint) {
this._drawControl('mtr', ctx, methodName,
left + width/2 - scaleOffsetX,
this.flipY
? (top + height + (this.rotatingPointOffset / this.scaleY) - this.cornerSize/this.scaleX/2 + strokeWidth2 + paddingY)
: (top - (this.rotatingPointOffset / this.scaleY) - this.cornerSize/this.scaleY/2 - strokeWidth2 - paddingY));
}
ctx.restore();
return this;
},
/**
* @private
*/
_drawControl: function(control, ctx, methodName, left, top) {
var sizeX = this.cornerSize / this.scaleX,
sizeY = this.cornerSize / this.scaleY;
if (this.isControlVisible(control)) {
isVML || this.transparentCorners || ctx.clearRect(left, top, sizeX, sizeY);
ctx[methodName](left, top, sizeX, sizeY);
}
},
/**
* Returns true if the specified control is visible, false otherwise.
* @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.
* @returns {Boolean} true if the specified control is visible, false otherwise
*/
isControlVisible: function(controlName) {
return this._getControlsVisibility()[controlName];
},
/**
* Sets the visibility of the specified control.
* @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.
* @param {Boolean} visible true to set the specified control visible, false otherwise
* @return {fabric.Object} thisArg
* @chainable
*/
setControlVisible: function(controlName, visible) {
this._getControlsVisibility()[controlName] = visible;
return this;
},
/**
* Sets the visibility state of object controls.
* @param {Object} [options] Options object
* @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it
* @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it
* @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it
* @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it
* @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it
* @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it
* @param {Boolean} [options.tl] true to enable the top-left control, false to disable it
* @param {Boolean} [options.tr] true to enable the top-right control, false to disable it
* @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it
* @return {fabric.Object} thisArg
* @chainable
*/
setControlsVisibility: function(options) {
options || (options = { });
for (var p in options) {
this.setControlVisible(p, options[p]);
}
return this;
},
/**
* Returns the instance of the control visibility set for this object.
* @private
* @returns {Object}
*/
_getControlsVisibility: function() {
if (!this._controlsVisibility) {
this._controlsVisibility = {
tl: true,
tr: true,
br: true,
bl: true,
ml: true,
mt: true,
mr: true,
mb: true,
mtr: true
};
}
return this._controlsVisibility;
}
});
})();
fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {
/**
* Animation duration (in ms) for fx* methods
* @type Number
* @default
*/
FX_DURATION: 500,
/**
* Centers object horizontally with animation.
* @param {fabric.Object} object Object to center
* @param {Object} [callbacks] Callbacks object with optional "onComplete" and/or "onChange" properties
* @param {Function} [callbacks.onComplete] Invoked on completion
* @param {Function} [callbacks.onChange] Invoked on every step of animation
* @return {fabric.Canvas} thisArg
* @chainable
*/
fxCenterObjectH: function (object, callbacks) {
callbacks = callbacks || { };
var empty = function() { },
onComplete = callbacks.onComplete || empty,
onChange = callbacks.onChange || empty,
_this = this;
fabric.util.animate({
startValue: object.get('left'),
endValue: this.getCenter().left,
duration: this.FX_DURATION,
onChange: function(value) {
object.set('left', value);
_this.renderAll();
onChange();
},
onComplete: function() {
object.setCoords();
onComplete();
}
});
return this;
},
/**
* Centers object vertically with animation.
* @param {fabric.Object} object Object to center
* @param {Object} [callbacks] Callbacks object with optional "onComplete" and/or "onChange" properties
* @param {Function} [callbacks.onComplete] Invoked on completion
* @param {Function} [callbacks.onChange] Invoked on every step of animation
* @return {fabric.Canvas} thisArg
* @chainable
*/
fxCenterObjectV: function (object, callbacks) {
callbacks = callbacks || { };
var empty = function() { },
onComplete = callbacks.onComplete || empty,
onChange = callbacks.onChange || empty,
_this = this;
fabric.util.animate({
startValue: object.get('top'),
endValue: this.getCenter().top,
duration: this.FX_DURATION,
onChange: function(value) {
object.set('top', value);
_this.renderAll();
onChange();
},
onComplete: function() {
object.setCoords();
onComplete();
}
});
return this;
},
/**
* Same as `fabric.Canvas#remove` but animated
* @param {fabric.Object} object Object to remove
* @param {Object} [callbacks] Callbacks object with optional "onComplete" and/or "onChange" properties
* @param {Function} [callbacks.onComplete] Invoked on completion
* @param {Function} [callbacks.onChange] Invoked on every step of animation
* @return {fabric.Canvas} thisArg
* @chainable
*/
fxRemove: function (object, callbacks) {
callbacks = callbacks || { };
var empty = function() { },
onComplete = callbacks.onComplete || empty,
onChange = callbacks.onChange || empty,
_this = this;
fabric.util.animate({
startValue: object.get('opacity'),
endValue: 0,
duration: this.FX_DURATION,
onStart: function() {
object.set('active', false);
},
onChange: function(value) {
object.set('opacity', value);
_this.renderAll();
onChange();
},
onComplete: function () {
_this.remove(object);
onComplete();
}
});
return this;
}
});
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* Animates object's properties
* @param {String|Object} property to animate (if string) or properties to animate (if object)
* @param {Number|Object} value to animate property to (if string was given first) or options object
* @return {fabric.Object} thisArg
* @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#animation}
* @chainable
*
* As object — multiple properties
*
* object.animate({ left: ..., top: ... });
* object.animate({ left: ..., top: ... }, { duration: ... });
*
* As string — one property
*
* object.animate('left', ...);
* object.animate('left', { duration: ... });
*
*/
animate: function() {
if (arguments[0] && typeof arguments[0] === 'object') {
var propsToAnimate = [ ], prop, skipCallbacks;
for (prop in arguments[0]) {
propsToAnimate.push(prop);
}
for (var i = 0, len = propsToAnimate.length; i<len; i++) {
prop = propsToAnimate[i];
skipCallbacks = i !== len - 1;
this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);
}
}
else {
this._animate.apply(this, arguments);
}
return this;
},
/**
* @private
* @param {String} property Property to animate
* @param {String} to Value to animate to
* @param {Object} [options] Options object
* @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked
*/
_animate: function(property, to, options, skipCallbacks) {
var obj = this, propPair;
to = to.toString();
if (!options) {
options = { };
}
else {
options = fabric.util.object.clone(options);
}
if (~property.indexOf('.')) {
propPair = property.split('.');
}
var currentValue = propPair
? this.get(propPair[0])[propPair[1]]
: this.get(property);
if (!('from' in options)) {
options.from = currentValue;
}
if (~to.indexOf('=')) {
to = currentValue + parseFloat(to.replace('=', ''));
}
else {
to = parseFloat(to);
}
fabric.util.animate({
startValue: options.from,
endValue: to,
byValue: options.by,
easing: options.easing,
duration: options.duration,
abort: options.abort && function() {
return options.abort.call(obj);
},
onChange: function(value) {
if (propPair) {
obj[propPair[0]][propPair[1]] = value;
}
else {
obj.set(property, value);
}
if (skipCallbacks) return;
options.onChange && options.onChange();
},
onComplete: function() {
if (skipCallbacks) return;
obj.setCoords();
options.onComplete && options.onComplete();
}
});
}
});
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
coordProps = { 'x1': 1, 'x2': 1, 'y1': 1, 'y2': 1 },
supportsLineDash = fabric.StaticCanvas.supports('setLineDash');
if (fabric.Line) {
fabric.warn('fabric.Line is already defined');
return;
}
/**
* Line class
* @class fabric.Line
* @extends fabric.Object
* @see {@link fabric.Line#initialize} for constructor definition
*/
fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'line',
/**
* Constructor
* @param {Array} [points] Array of points
* @param {Object} [options] Options object
* @return {fabric.Line} thisArg
*/
initialize: function(points, options) {
options = options || { };
if (!points) {
points = [0, 0, 0, 0];
}
this.callSuper('initialize', options);
this.set('x1', points[0]);
this.set('y1', points[1]);
this.set('x2', points[2]);
this.set('y2', points[3]);
this._setWidthHeight(options);
},
/**
* @private
* @param {Object} [options] Options
*/
_setWidthHeight: function(options) {
options || (options = { });
this.set('width', Math.abs(this.x2 - this.x1) || 1);
this.set('height', Math.abs(this.y2 - this.y1) || 1);
this.set('left', 'left' in options ? options.left : (Math.min(this.x1, this.x2) + this.width / 2));
this.set('top', 'top' in options ? options.top : (Math.min(this.y1, this.y2) + this.height / 2));
},
/**
* @private
* @param {String} key
* @param {Any} value
*/
_set: function(key, value) {
this[key] = value;
if (key in coordProps) {
this._setWidthHeight();
}
return this;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_render: function(ctx) {
ctx.beginPath();
var isInPathGroup = this.group && this.group.type === 'path-group';
if (isInPathGroup && !this.transformMatrix) {
ctx.translate(-this.group.width/2 + this.left, -this.group.height / 2 + this.top);
}
if (!this.strokeDashArray || this.strokeDashArray && supportsLineDash) {
var xMult = this.x1 <= this.x2 ? -1 : 1;
var yMult = this.y1 <= this.y2 ? -1 : 1;
ctx.moveTo(
this.width === 1 ? 0 : (xMult * this.width / 2),
this.height === 1 ? 0 : (yMult * this.height / 2));
ctx.lineTo(
this.width === 1 ? 0 : (xMult * -1 * this.width / 2),
this.height === 1 ? 0 : (yMult * -1 * this.height / 2));
}
ctx.lineWidth = this.strokeWidth;
var origStrokeStyle = ctx.strokeStyle;
ctx.strokeStyle = this.stroke || ctx.fillStyle;
this._renderStroke(ctx);
ctx.strokeStyle = origStrokeStyle;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderDashedStroke: function(ctx) {
var
xMult = this.x1 <= this.x2 ? -1 : 1,
yMult = this.y1 <= this.y2 ? -1 : 1,
x = this.width === 1 ? 0 : xMult * this.width / 2,
y = this.height === 1 ? 0 : yMult * this.height / 2;
ctx.beginPath();
fabric.util.drawDashedLine(ctx, x, y, -x, -y, this.strokeDashArray);
ctx.closePath();
},
/**
* Returns object representation of an instance
* @methd toObject
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
return extend(this.callSuper('toObject', propertiesToInclude), {
x1: this.get('x1'),
y1: this.get('y1'),
x2: this.get('x2'),
y2: this.get('y2')
});
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = this._createBaseSVGMarkup();
markup.push(
'<line ',
'x1="', this.get('x1'),
'" y1="', this.get('y1'),
'" x2="', this.get('x2'),
'" y2="', this.get('y2'),
'" style="', this.getSvgStyles(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns complexity of an instance
* @return {Number} complexity
*/
complexity: function() {
return 1;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})
* @static
* @memberOf fabric.Line
* @see http://www.w3.org/TR/SVG/shapes.html#LineElement
*/
fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));
/**
* Returns fabric.Line instance from an SVG element
* @static
* @memberOf fabric.Line
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @return {fabric.Line} instance of fabric.Line
*/
fabric.Line.fromElement = function(element, options) {
var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES);
var points = [
parsedAttributes.x1 || 0,
parsedAttributes.y1 || 0,
parsedAttributes.x2 || 0,
parsedAttributes.y2 || 0
];
return new fabric.Line(points, extend(parsedAttributes, options));
};
/* _FROM_SVG_END_ */
/**
* Returns fabric.Line instance from an object representation
* @static
* @memberOf fabric.Line
* @param {Object} object Object to create an instance from
* @return {fabric.Line} instance of fabric.Line
*/
fabric.Line.fromObject = function(object) {
var points = [object.x1, object.y1, object.x2, object.y2];
return new fabric.Line(points, object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
piBy2   = Math.PI * 2,
extend = fabric.util.object.extend;
if (fabric.Circle) {
fabric.warn('fabric.Circle is already defined.');
return;
}
/**
* Circle class
* @class fabric.Circle
* @extends fabric.Object
* @see {@link fabric.Circle#initialize} for constructor definition
*/
fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'circle',
/**
* Constructor
* @param {Object} [options] Options object
* @return {fabric.Circle} thisArg
*/
initialize: function(options) {
options = options || { };
this.set('radius', options.radius || 0);
this.callSuper('initialize', options);
},
/**
* @private
* @param {String} key
* @param {Any} value
* @return {fabric.Circle} thisArg
*/
_set: function(key, value) {
this.callSuper('_set', key, value);
if (key === 'radius') {
this.setRadius(value);
}
return this;
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
return extend(this.callSuper('toObject', propertiesToInclude), {
radius: this.get('radius')
});
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = this._createBaseSVGMarkup();
markup.push(
'<circle ',
'cx="0" cy="0" ',
'r="', this.radius,
'" style="', this.getSvgStyles(),
'" transform="', this.getSvgTransform(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* @private
* @param ctx {CanvasRenderingContext2D} context to render on
*/
_render: function(ctx, noTransform) {
ctx.beginPath();
ctx.globalAlpha = this.group ? (ctx.globalAlpha * this.opacity) : this.opacity;
ctx.arc(noTransform ? this.left : 0, noTransform ? this.top : 0, this.radius, 0, piBy2, false);
ctx.closePath();
this._renderFill(ctx);
this._renderStroke(ctx);
},
/**
* Returns horizontal radius of an object (according to how an object is scaled)
* @return {Number}
*/
getRadiusX: function() {
return this.get('radius') * this.get('scaleX');
},
/**
* Returns vertical radius of an object (according to how an object is scaled)
* @return {Number}
*/
getRadiusY: function() {
return this.get('radius') * this.get('scaleY');
},
/**
* Sets radius of an object (and updates width accordingly)
* @return {Number}
*/
setRadius: function(value) {
this.radius = value;
this.set('width', value * 2).set('height', value * 2);
},
/**
* Returns complexity of an instance
* @return {Number} complexity of this instance
*/
complexity: function() {
return 1;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})
* @static
* @memberOf fabric.Circle
* @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement
*/
fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));
/**
* Returns {@link fabric.Circle} instance from an SVG element
* @static
* @memberOf fabric.Circle
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @throws {Error} If value of `r` attribute is missing or invalid
* @return {fabric.Circle} Instance of fabric.Circle
*/
fabric.Circle.fromElement = function(element, options) {
options || (options = { });
var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);
if (!isValidRadius(parsedAttributes)) {
throw new Error('value of `r` attribute is required and can not be negative');
}
if ('left' in parsedAttributes) {
parsedAttributes.left -= (options.width / 2) || 0;
}
if ('top' in parsedAttributes) {
parsedAttributes.top -= (options.height / 2) || 0;
}
var obj = new fabric.Circle(extend(parsedAttributes, options));
obj.cx = parseFloat(element.getAttribute('cx')) || 0;
obj.cy = parseFloat(element.getAttribute('cy')) || 0;
return obj;
};
/**
* @private
*/
function isValidRadius(attributes) {
return (('radius' in attributes) && (attributes.radius > 0));
}
/* _FROM_SVG_END_ */
/**
* Returns {@link fabric.Circle} instance from an object representation
* @static
* @memberOf fabric.Circle
* @param {Object} object Object to create an instance from
* @return {Object} Instance of fabric.Circle
*/
fabric.Circle.fromObject = function(object) {
return new fabric.Circle(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { });
if (fabric.Triangle) {
fabric.warn('fabric.Triangle is already defined');
return;
}
/**
* Triangle class
* @class fabric.Triangle
* @extends fabric.Object
* @return {fabric.Triangle} thisArg
* @see {@link fabric.Triangle#initialize} for constructor definition
*/
fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'triangle',
/**
* Constructor
* @param {Object} [options] Options object
* @return {Object} thisArg
*/
initialize: function(options) {
options = options || { };
this.callSuper('initialize', options);
this.set('width', options.width || 100)
.set('height', options.height || 100);
},
/**
* @private
* @param ctx {CanvasRenderingContext2D} Context to render on
*/
_render: function(ctx) {
var widthBy2 = this.width / 2,
heightBy2 = this.height / 2;
ctx.beginPath();
ctx.moveTo(-widthBy2, heightBy2);
ctx.lineTo(0, -heightBy2);
ctx.lineTo(widthBy2, heightBy2);
ctx.closePath();
this._renderFill(ctx);
this._renderStroke(ctx);
},
/**
* @private
* @param ctx {CanvasRenderingContext2D} Context to render on
*/
_renderDashedStroke: function(ctx) {
var widthBy2 = this.width / 2,
heightBy2 = this.height / 2;
ctx.beginPath();
fabric.util.drawDashedLine(ctx, -widthBy2, heightBy2, 0, -heightBy2, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, 0, -heightBy2, widthBy2, heightBy2, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, widthBy2, heightBy2, -widthBy2, heightBy2, this.strokeDashArray);
ctx.closePath();
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = this._createBaseSVGMarkup(),
widthBy2 = this.width / 2,
heightBy2 = this.height / 2;
var points = [
-widthBy2 + " " + heightBy2,
"0 " + -heightBy2,
widthBy2 + " " + heightBy2
].join(",");
markup.push(
'<polygon ',
'points="', points,
'" style="', this.getSvgStyles(),
'" transform="', this.getSvgTransform(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns complexity of an instance
* @return {Number} complexity of this instance
*/
complexity: function() {
return 1;
}
});
/**
* Returns fabric.Triangle instance from an object representation
* @static
* @memberOf fabric.Triangle
* @param object {Object} object to create an instance from
* @return {Object} instance of Canvas.Triangle
*/
fabric.Triangle.fromObject = function(object) {
return new fabric.Triangle(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global){
"use strict";
var fabric = global.fabric || (global.fabric = { }),
piBy2   = Math.PI * 2,
extend = fabric.util.object.extend;
if (fabric.Ellipse) {
fabric.warn('fabric.Ellipse is already defined.');
return;
}
/**
* Ellipse class
* @class fabric.Ellipse
* @extends fabric.Object
* @return {fabric.Ellipse} thisArg
* @see {@link fabric.Ellipse#initialize} for constructor definition
*/
fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'ellipse',
/**
* Horizontal radius
* @type Number
* @default
*/
rx:   0,
/**
* Vertical radius
* @type Number
* @default
*/
ry:   0,
/**
* Constructor
* @param {Object} [options] Options object
* @return {fabric.Ellipse} thisArg
*/
initialize: function(options) {
options = options || { };
this.callSuper('initialize', options);
this.set('rx', options.rx || 0);
this.set('ry', options.ry || 0);
this.set('width', this.get('rx') * 2);
this.set('height', this.get('ry') * 2);
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
return extend(this.callSuper('toObject', propertiesToInclude), {
rx: this.get('rx'),
ry: this.get('ry')
});
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = this._createBaseSVGMarkup();
markup.push(
'<ellipse ',
'rx="', this.get('rx'),
'" ry="', this.get('ry'),
'" style="', this.getSvgStyles(),
'" transform="', this.getSvgTransform(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Renders this instance on a given context
* @param ctx {CanvasRenderingContext2D} context to render on
* @param noTransform {Boolean} context is not transformed when set to true
*/
render: function(ctx, noTransform) {
if (this.rx === 0 || this.ry === 0) return;
return this.callSuper('render', ctx, noTransform);
},
/**
* @private
* @param ctx {CanvasRenderingContext2D} context to render on
*/
_render: function(ctx, noTransform) {
ctx.beginPath();
ctx.save();
ctx.globalAlpha = this.group ? (ctx.globalAlpha * this.opacity) : this.opacity;
if (this.transformMatrix && this.group) {
ctx.translate(this.cx, this.cy);
}
ctx.transform(1, 0, 0, this.ry/this.rx, 0, 0);
ctx.arc(noTransform ? this.left : 0, noTransform ? this.top : 0, this.rx, 0, piBy2, false);
this._renderFill(ctx);
this._renderStroke(ctx);
ctx.restore();
},
/**
* Returns complexity of an instance
* @return {Number} complexity
*/
complexity: function() {
return 1;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})
* @static
* @memberOf fabric.Ellipse
* @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement
*/
fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));
/**
* Returns {@link fabric.Ellipse} instance from an SVG element
* @static
* @memberOf fabric.Ellipse
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @return {fabric.Ellipse}
*/
fabric.Ellipse.fromElement = function(element, options) {
options || (options = { });
var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);
var cx = parsedAttributes.left;
var cy = parsedAttributes.top;
if ('left' in parsedAttributes) {
parsedAttributes.left -= (options.width / 2) || 0;
}
if ('top' in parsedAttributes) {
parsedAttributes.top -= (options.height / 2) || 0;
}
var ellipse = new fabric.Ellipse(extend(parsedAttributes, options));
ellipse.cx = cx || 0;
ellipse.cy = cy || 0;
return ellipse;
};
/* _FROM_SVG_END_ */
/**
* Returns {@link fabric.Ellipse} instance from an object representation
* @static
* @memberOf fabric.Ellipse
* @param {Object} object Object to create an instance from
* @return {fabric.Ellipse}
*/
fabric.Ellipse.fromObject = function(object) {
return new fabric.Ellipse(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
if (fabric.Rect) {
console.warn('fabric.Rect is already defined');
return;
}
var stateProperties = fabric.Object.prototype.stateProperties.concat();
stateProperties.push('rx', 'ry', 'x', 'y');
/**
* Rectangle class
* @class fabric.Rect
* @extends fabric.Object
* @return {fabric.Rect} thisArg
* @see {@link fabric.Rect#initialize} for constructor definition
*/
fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {
/**
* List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})
* as well as for history (undo/redo) purposes
* @type Array
*/
stateProperties: stateProperties,
/**
* Type of an object
* @type String
* @default
*/
type: 'rect',
/**
* Horizontal border radius
* @type Number
* @default
*/
rx:   0,
/**
* Vertical border radius
* @type Number
* @default
*/
ry:   0,
/**
* @type Number
* @default
*/
x: 0,
/**
* @type Number
* @default
*/
y: 0,
/**
* Used to specify dash pattern for stroke on this object
* @type Array
*/
strokeDashArray: null,
/**
* Constructor
* @param {Object} [options] Options object
* @return {Object} thisArg
*/
initialize: function(options) {
options = options || { };
this.callSuper('initialize', options);
this._initRxRy();
this.x = options.x || 0;
this.y = options.y || 0;
},
/**
* Initializes rx/ry attributes
* @private
*/
_initRxRy: function() {
if (this.rx && !this.ry) {
this.ry = this.rx;
}
else if (this.ry && !this.rx) {
this.rx = this.ry;
}
},
/**
* @private
* @param ctx {CanvasRenderingContext2D} context to render on
*/
_render: function(ctx) {
var rx = this.rx || 0,
ry = this.ry || 0,
x = -this.width / 2,
y = -this.height / 2,
w = this.width,
h = this.height,
isInPathGroup = this.group && this.group.type === 'path-group';
ctx.beginPath();
ctx.globalAlpha = isInPathGroup ? (ctx.globalAlpha * this.opacity) : this.opacity;
if (this.transformMatrix && isInPathGroup) {
ctx.translate(
this.width / 2 + this.x,
this.height / 2 + this.y);
}
if (!this.transformMatrix && isInPathGroup) {
ctx.translate(
-this.group.width / 2 + this.width / 2 + this.x,
-this.group.height / 2 + this.height / 2 + this.y);
}
var isRounded = rx !== 0 || ry !== 0;
ctx.moveTo(x+rx, y);
ctx.lineTo(x+w-rx, y);
isRounded && ctx.quadraticCurveTo(x+w, y, x+w, y+ry, x+w, y+ry);
ctx.lineTo(x+w, y+h-ry);
isRounded && ctx.quadraticCurveTo(x+w,y+h,x+w-rx,y+h,x+w-rx,y+h);
ctx.lineTo(x+rx,y+h);
isRounded && ctx.quadraticCurveTo(x,y+h,x,y+h-ry,x,y+h-ry);
ctx.lineTo(x,y+ry);
isRounded && ctx.quadraticCurveTo(x,y,x+rx,y,x+rx,y);
ctx.closePath();
this._renderFill(ctx);
this._renderStroke(ctx);
},
/**
* @private
* @param ctx {CanvasRenderingContext2D} context to render on
*/
_renderDashedStroke: function(ctx) {
var x = -this.width/2,
y = -this.height/2,
w = this.width,
h = this.height;
ctx.beginPath();
fabric.util.drawDashedLine(ctx, x, y, x+w, y, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, x+w, y, x+w, y+h, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, x+w, y+h, x, y+h, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, x, y+h, x, y, this.strokeDashArray);
ctx.closePath();
},
/**
* Since coordinate system differs from that of SVG
* @private
*/
_normalizeLeftTopProperties: function(parsedAttributes) {
if ('left' in parsedAttributes) {
this.set('left', parsedAttributes.left + this.getWidth() / 2);
}
this.set('x', parsedAttributes.left || 0);
if ('top' in parsedAttributes) {
this.set('top', parsedAttributes.top + this.getHeight() / 2);
}
this.set('y', parsedAttributes.top || 0);
return this;
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
var object = extend(this.callSuper('toObject', propertiesToInclude), {
rx: this.get('rx') || 0,
ry: this.get('ry') || 0,
x: this.get('x'),
y: this.get('y')
});
if (!this.includeDefaultValues) {
this._removeDefaultValues(object);
}
return object;
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = this._createBaseSVGMarkup();
markup.push(
'<rect ',
'x="', (-1 * this.width / 2), '" y="', (-1 * this.height / 2),
'" rx="', this.get('rx'), '" ry="', this.get('ry'),
'" width="', this.width, '" height="', this.height,
'" style="', this.getSvgStyles(),
'" transform="', this.getSvgTransform(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns complexity of an instance
* @return {Number} complexity
*/
complexity: function() {
return 1;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)
* @static
* @memberOf fabric.Rect
* @see: http://www.w3.org/TR/SVG/shapes.html#RectElement
*/
fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));
/**
* @private
*/
function _setDefaultLeftTopValues(attributes) {
attributes.left = attributes.left || 0;
attributes.top  = attributes.top  || 0;
return attributes;
}
/**
* Returns {@link fabric.Rect} instance from an SVG element
* @static
* @memberOf fabric.Rect
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @return {fabric.Rect} Instance of fabric.Rect
*/
fabric.Rect.fromElement = function(element, options) {
if (!element) {
return null;
}
var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);
parsedAttributes = _setDefaultLeftTopValues(parsedAttributes);
var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));
rect._normalizeLeftTopProperties(parsedAttributes);
return rect;
};
/* _FROM_SVG_END_ */
/**
* Returns {@link fabric.Rect} instance from an object representation
* @static
* @memberOf fabric.Rect
* @param object {Object} object to create an instance from
* @return {Object} instance of fabric.Rect
*/
fabric.Rect.fromObject = function(object) {
return new fabric.Rect(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
toFixed = fabric.util.toFixed;
if (fabric.Polyline) {
fabric.warn('fabric.Polyline is already defined');
return;
}
/**
* Polyline class
* @class fabric.Polyline
* @extends fabric.Object
* @see {@link fabric.Polyline#initialize} for constructor definition
*/
fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'polyline',
/**
* Constructor
* @param {Array} points Array of points (where each point is an object with x and y)
* @param {Object} [options] Options object
* @param {Boolean} [skipOffset] Whether points offsetting should be skipped
* @return {fabric.Polyline} thisArg
* @example
* var poly = new fabric.Polyline([
*     { x: 10, y: 10 },
*     { x: 50, y: 30 },
*     { x: 40, y: 70 },
*     { x: 60, y: 50 },
*     { x: 100, y: 150 },
*     { x: 40, y: 100 }
*   ], {
*   stroke: 'red',
*   left: 100,
*   top: 100
* });
*/
initialize: function(points, options, skipOffset) {
options = options || { };
this.set('points', points);
this.callSuper('initialize', options);
this._calcDimensions(skipOffset);
},
/**
* @private
* @param {Boolean} [skipOffset] Whether points offsetting should be skipped
*/
_calcDimensions: function(skipOffset) {
return fabric.Polygon.prototype._calcDimensions.call(this, skipOffset);
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} Object representation of an instance
*/
toObject: function(propertiesToInclude) {
return fabric.Polygon.prototype.toObject.call(this, propertiesToInclude);
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var points = [],
markup = this._createBaseSVGMarkup();
for (var i = 0, len = this.points.length; i < len; i++) {
points.push(toFixed(this.points[i].x, 2), ',', toFixed(this.points[i].y, 2), ' ');
}
markup.push(
'<polyline ',
'points="', points.join(''),
'" style="', this.getSvgStyles(),
'" transform="', this.getSvgTransform(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_render: function(ctx) {
var point;
ctx.beginPath();
ctx.moveTo(this.points[0].x, this.points[0].y);
for (var i = 0, len = this.points.length; i < len; i++) {
point = this.points[i];
ctx.lineTo(point.x, point.y);
}
this._renderFill(ctx);
this._renderStroke(ctx);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderDashedStroke: function(ctx) {
var p1, p2;
ctx.beginPath();
for (var i = 0, len = this.points.length; i < len; i++) {
p1 = this.points[i];
p2 = this.points[i+1] || p1;
fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);
}
},
/**
* Returns complexity of an instance
* @return {Number} complexity of this instance
*/
complexity: function() {
return this.get('points').length;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})
* @static
* @memberOf fabric.Polyline
* @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement
*/
fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();
/**
* Returns fabric.Polyline instance from an SVG element
* @static
* @memberOf fabric.Polyline
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @return {fabric.Polyline} Instance of fabric.Polyline
*/
fabric.Polyline.fromElement = function(element, options) {
if (!element) {
return null;
}
options || (options = { });
var points = fabric.parsePointsAttribute(element.getAttribute('points')),
parsedAttributes = fabric.parseAttributes(element, fabric.Polyline.ATTRIBUTE_NAMES);
fabric.util.normalizePoints(points, options);
return new fabric.Polyline(points, fabric.util.object.extend(parsedAttributes, options), true);
};
/* _FROM_SVG_END_ */
/**
* Returns fabric.Polyline instance from an object representation
* @static
* @memberOf fabric.Polyline
* @param object {Object} object Object to create an instance from
* @return {fabric.Polyline} Instance of fabric.Polyline
*/
fabric.Polyline.fromObject = function(object) {
var points = object.points;
return new fabric.Polyline(points, object, true);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
min = fabric.util.array.min,
max = fabric.util.array.max,
toFixed = fabric.util.toFixed;
if (fabric.Polygon) {
fabric.warn('fabric.Polygon is already defined');
return;
}
/**
* Polygon class
* @class fabric.Polygon
* @extends fabric.Object
* @see {@link fabric.Polygon#initialize} for constructor definition
*/
fabric.Polygon = fabric.util.createClass(fabric.Object, /** @lends fabric.Polygon.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'polygon',
/**
* Constructor
* @param {Array} points Array of points
* @param {Object} [options] Options object
* @param {Boolean} [skipOffset] Whether points offsetting should be skipped
* @return {fabric.Polygon} thisArg
*/
initialize: function(points, options, skipOffset) {
options = options || { };
this.points = points;
this.callSuper('initialize', options);
this._calcDimensions(skipOffset);
},
/**
* @private
* @param {Boolean} [skipOffset] Whether points offsetting should be skipped
*/
_calcDimensions: function(skipOffset) {
var points = this.points,
minX = min(points, 'x'),
minY = min(points, 'y'),
maxX = max(points, 'x'),
maxY = max(points, 'y');
this.width = (maxX - minX) || 1;
this.height = (maxY - minY) || 1;
this.minX = minX;
this.minY = minY;
if (skipOffset) return;
var halfWidth = this.width / 2 + this.minX,
halfHeight = this.height / 2 + this.minY;
this.points.forEach(function(p) {
p.x -= halfWidth;
p.y -= halfHeight;
}, this);
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} Object representation of an instance
*/
toObject: function(propertiesToInclude) {
return extend(this.callSuper('toObject', propertiesToInclude), {
points: this.points.concat()
});
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var points = [],
markup = this._createBaseSVGMarkup();
for (var i = 0, len = this.points.length; i < len; i++) {
points.push(toFixed(this.points[i].x, 2), ',', toFixed(this.points[i].y, 2), ' ');
}
markup.push(
'<polygon ',
'points="', points.join(''),
'" style="', this.getSvgStyles(),
'" transform="', this.getSvgTransform(),
'"/>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_render: function(ctx) {
var point;
ctx.beginPath();
ctx.moveTo(this.points[0].x, this.points[0].y);
for (var i = 0, len = this.points.length; i < len; i++) {
point = this.points[i];
ctx.lineTo(point.x, point.y);
}
this._renderFill(ctx);
if (this.stroke || this.strokeDashArray) {
ctx.closePath();
this._renderStroke(ctx);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderDashedStroke: function(ctx) {
var p1, p2;
ctx.beginPath();
for (var i = 0, len = this.points.length; i < len; i++) {
p1 = this.points[i];
p2 = this.points[i+1] || this.points[0];
fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);
}
ctx.closePath();
},
/**
* Returns complexity of an instance
* @return {Number} complexity of this instance
*/
complexity: function() {
return this.points.length;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)
* @static
* @memberOf fabric.Polygon
* @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement
*/
fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();
/**
* Returns {@link fabric.Polygon} instance from an SVG element
* @static
* @memberOf fabric.Polygon
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @return {fabric.Polygon} Instance of fabric.Polygon
*/
fabric.Polygon.fromElement = function(element, options) {
if (!element) {
return null;
}
options || (options = { });
var points = fabric.parsePointsAttribute(element.getAttribute('points')),
parsedAttributes = fabric.parseAttributes(element, fabric.Polygon.ATTRIBUTE_NAMES);
fabric.util.normalizePoints(points, options);
return new fabric.Polygon(points, extend(parsedAttributes, options), true);
};
/* _FROM_SVG_END_ */
/**
* Returns fabric.Polygon instance from an object representation
* @static
* @memberOf fabric.Polygon
* @param object {Object} object Object to create an instance from
* @return {fabric.Polygon} Instance of fabric.Polygon
*/
fabric.Polygon.fromObject = function(object) {
return new fabric.Polygon(object.points, object, true);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
var commandLengths = {
m: 2,
l: 2,
h: 1,
v: 1,
c: 6,
s: 4,
q: 4,
t: 2,
a: 7
};
"use strict";
var fabric = global.fabric || (global.fabric = { }),
min = fabric.util.array.min,
max = fabric.util.array.max,
extend = fabric.util.object.extend,
_toString = Object.prototype.toString,
drawArc = fabric.util.drawArc;
if (fabric.Path) {
fabric.warn('fabric.Path is already defined');
return;
}
/**
* @private
*/
function getX(item) {
if (item[0] === 'H') {
return item[1];
}
return item[item.length - 2];
}
/**
* @private
*/
function getY(item) {
if (item[0] === 'V') {
return item[1];
}
return item[item.length - 1];
}
/**
* Path class
* @class fabric.Path
* @extends fabric.Object
* @tutorial {@link http://fabricjs.com/fabric-intro-part-1/#path_and_pathgroup}
* @see {@link fabric.Path#initialize} for constructor definition
*/
fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'path',
/**
* Constructor
* @param {Array|String} path Path data (sequence of coordinates and corresponding "command" tokens)
* @param {Object} [options] Options object
* @return {fabric.Path} thisArg
*/
initialize: function(path, options) {
options = options || { };
this.setOptions(options);
if (!path) {
throw new Error('`path` argument is required');
}
var fromArray = _toString.call(path) === '[object Array]';
this.path = fromArray
? path
: path.match && path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);
if (!this.path) return;
if (!fromArray) {
this.path = this._parsePath();
}
this._initializePath(options);
if (options.sourcePath) {
this.setSourcePath(options.sourcePath);
}
},
/**
* @private
* @param {Object} [options] Options object
*/
_initializePath: function (options) {
var isWidthSet = 'width' in options && options.width != null,
isHeightSet = 'height' in options && options.width != null,
isLeftSet = 'left' in options,
isTopSet = 'top' in options,
origLeft = isLeftSet ? this.left : 0,
origTop = isTopSet ? this.top : 0;
if (!isWidthSet || !isHeightSet) {
extend(this, this._parseDimensions());
if (isWidthSet) {
this.width = options.width;
}
if (isHeightSet) {
this.height = options.height;
}
}
else { //Set center location relative to given height/width if not specified
if (!isTopSet) {
this.top = this.height / 2;
}
if (!isLeftSet) {
this.left = this.width / 2;
}
}
this.pathOffset = this.pathOffset || this._calculatePathOffset(origLeft, origTop); //Save top-left coords as offset
},
/**
* @private
* @param {Boolean} positionSet When false, path offset is returned otherwise 0
*/
_calculatePathOffset: function (origLeft, origTop) {
return {
x: this.left - origLeft - (this.width / 2),
y: this.top - origTop - (this.height / 2)
};
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx context to render path on
*/
_render: function(ctx) {
var current, // current instruction
previous = null,
x = 0, // current x
y = 0, // current y
controlX = 0, // current control point x
controlY = 0, // current control point y
tempX,
tempY,
tempControlX,
tempControlY,
l = -((this.width / 2) + this.pathOffset.x),
t = -((this.height / 2) + this.pathOffset.y),
methodName;
for (var i = 0, len = this.path.length; i < len; ++i) {
current = this.path[i];
switch (current[0]) { // first letter
case 'l': // lineto, relative
x += current[1];
y += current[2];
ctx.lineTo(x + l, y + t);
break;
case 'L': // lineto, absolute
x = current[1];
y = current[2];
ctx.lineTo(x + l, y + t);
break;
case 'h': // horizontal lineto, relative
x += current[1];
ctx.lineTo(x + l, y + t);
break;
case 'H': // horizontal lineto, absolute
x = current[1];
ctx.lineTo(x + l, y + t);
break;
case 'v': // vertical lineto, relative
y += current[1];
ctx.lineTo(x + l, y + t);
break;
case 'V': // verical lineto, absolute
y = current[1];
ctx.lineTo(x + l, y + t);
break;
case 'm': // moveTo, relative
x += current[1];
y += current[2];
methodName = (previous && (previous[0] === 'm' || previous[0] === 'M'))
? 'lineTo'
: 'moveTo';
ctx[methodName](x + l, y + t);
break;
case 'M': // moveTo, absolute
x = current[1];
y = current[2];
methodName = (previous && (previous[0] === 'm' || previous[0] === 'M'))
? 'lineTo'
: 'moveTo';
ctx[methodName](x + l, y + t);
break;
case 'c': // bezierCurveTo, relative
tempX = x + current[5];
tempY = y + current[6];
controlX = x + current[3];
controlY = y + current[4];
ctx.bezierCurveTo(
x + current[1] + l, // x1
y + current[2] + t, // y1
controlX + l, // x2
controlY + t, // y2
tempX + l,
tempY + t
);
x = tempX;
y = tempY;
break;
case 'C': // bezierCurveTo, absolute
x = current[5];
y = current[6];
controlX = current[3];
controlY = current[4];
ctx.bezierCurveTo(
current[1] + l,
current[2] + t,
controlX + l,
controlY + t,
x + l,
y + t
);
break;
case 's': // shorthand cubic bezierCurveTo, relative
tempX = x + current[3];
tempY = y + current[4];
controlX = controlX ? (2 * x - controlX) : x;
controlY = controlY ? (2 * y - controlY) : y;
ctx.bezierCurveTo(
controlX + l,
controlY + t,
x + current[1] + l,
y + current[2] + t,
tempX + l,
tempY + t
);
controlX = x + current[1];
controlY = y + current[2];
x = tempX;
y = tempY;
break;
case 'S': // shorthand cubic bezierCurveTo, absolute
tempX = current[3];
tempY = current[4];
controlX = 2*x - controlX;
controlY = 2*y - controlY;
ctx.bezierCurveTo(
controlX + l,
controlY + t,
current[1] + l,
current[2] + t,
tempX + l,
tempY + t
);
x = tempX;
y = tempY;
controlX = current[1];
controlY = current[2];
break;
case 'q': // quadraticCurveTo, relative
tempX = x + current[3];
tempY = y + current[4];
controlX = x + current[1];
controlY = y + current[2];
ctx.quadraticCurveTo(
controlX + l,
controlY + t,
tempX + l,
tempY + t
);
x = tempX;
y = tempY;
break;
case 'Q': // quadraticCurveTo, absolute
tempX = current[3];
tempY = current[4];
ctx.quadraticCurveTo(
current[1] + l,
current[2] + t,
tempX + l,
tempY + t
);
x = tempX;
y = tempY;
controlX = current[1];
controlY = current[2];
break;
case 't': // shorthand quadraticCurveTo, relative
tempX = x + current[1];
tempY = y + current[2];
if (previous[0].match(/[QqTt]/) === null) {
controlX = x;
controlY = y;
}
else if (previous[0] === 't') {
controlX = 2 * x - tempControlX;
controlY = 2 * y - tempControlY;
}
else if (previous[0] === 'q') {
controlX = 2 * x - controlX;
controlY = 2 * y - controlY;
}
tempControlX = controlX;
tempControlY = controlY;
ctx.quadraticCurveTo(
controlX + l,
controlY + t,
tempX + l,
tempY + t
);
x = tempX;
y = tempY;
controlX = x + current[1];
controlY = y + current[2];
break;
case 'T':
tempX = current[1];
tempY = current[2];
controlX = 2 * x - controlX;
controlY = 2 * y - controlY;
ctx.quadraticCurveTo(
controlX + l,
controlY + t,
tempX + l,
tempY + t
);
x = tempX;
y = tempY;
break;
case 'a':
drawArc(ctx, x + l, y + t, [
current[1],
current[2],
current[3],
current[4],
current[5],
current[6] + x + l,
current[7] + y + t
]);
x += current[6];
y += current[7];
break;
case 'A':
drawArc(ctx, x + l, y + t, [
current[1],
current[2],
current[3],
current[4],
current[5],
current[6] + l,
current[7] + t
]);
x = current[6];
y = current[7];
break;
case 'z':
case 'Z':
ctx.closePath();
break;
}
previous = current;
}
},
/**
* Renders path on a specified context
* @param {CanvasRenderingContext2D} ctx context to render path on
* @param {Boolean} [noTransform] When true, context is not transformed
*/
render: function(ctx, noTransform) {
if (!this.visible) return;
ctx.save();
var m = this.transformMatrix;
if (m) {
ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);
}
if (!noTransform) {
this.transform(ctx);
}
this._setStrokeStyles(ctx);
this._setFillStyles(ctx);
this._setShadow(ctx);
this.clipTo && fabric.util.clipContext(this, ctx);
ctx.beginPath();
this._render(ctx);
this._renderFill(ctx);
this._renderStroke(ctx);
this.clipTo && ctx.restore();
this._removeShadow(ctx);
if (!noTransform && this.active) {
this.drawBorders(ctx);
this.drawControls(ctx);
}
ctx.restore();
},
/**
* Returns string representation of an instance
* @return {String} string representation of an instance
*/
toString: function() {
return '#<fabric.Path (' + this.complexity() +
'): { "top": ' + this.top + ', "left": ' + this.left + ' }>';
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
var o = extend(this.callSuper('toObject', propertiesToInclude), {
path: this.path,
pathOffset: this.pathOffset
});
if (this.sourcePath) {
o.sourcePath = this.sourcePath;
}
if (this.transformMatrix) {
o.transformMatrix = this.transformMatrix;
}
return o;
},
/**
* Returns dataless object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toDatalessObject: function(propertiesToInclude) {
var o = this.toObject(propertiesToInclude);
if (this.sourcePath) {
o.path = this.sourcePath;
}
delete o.sourcePath;
return o;
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var chunks = [],
markup = this._createBaseSVGMarkup();
for (var i = 0, len = this.path.length; i < len; i++) {
chunks.push(this.path[i].join(' '));
}
var path = chunks.join(' ');
markup.push(
'<g transform="', (this.group ? '' : this.getSvgTransform()), '">',
'<path ',
'd="', path,
'" style="', this.getSvgStyles(),
'" transform="translate(', (-this.width / 2), ' ', (-this.height/2), ')',
'" stroke-linecap="round" ',
'/>',
'</g>'
);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns number representation of an instance complexity
* @return {Number} complexity of this instance
*/
complexity: function() {
return this.path.length;
},
/**
* @private
*/
_parsePath: function() {
var result = [ ],
coords = [ ],
currentPath,
parsed,
re = /(-?\.\d+)|(-?\d+(\.\d+)?)/g,
match,
coordsStr;
for (var i = 0, coordsParsed, len = this.path.length; i < len; i++) {
currentPath = this.path[i];
coordsStr = currentPath.slice(1).trim();
coords.length = 0;
while ((match = re.exec(coordsStr))) {
coords.push(match[0]);
}
coordsParsed = [ currentPath.charAt(0) ];
for (var j = 0, jlen = coords.length; j < jlen; j++) {
parsed = parseFloat(coords[j]);
if (!isNaN(parsed)) {
coordsParsed.push(parsed);
}
}
var command = coordsParsed[0].toLowerCase(),
commandLength = commandLengths[command];
if (coordsParsed.length - 1 > commandLength) {
for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {
result.push([ coordsParsed[0] ].concat(coordsParsed.slice(k, k + commandLength)));
}
}
else {
result.push(coordsParsed);
}
}
return result;
},
/**
* @private
*/
_parseDimensions: function() {
var aX = [],
aY = [],
previous = { };
this.path.forEach(function(item, i) {
this._getCoordsFromCommand(item, i, aX, aY, previous);
}, this);
var minX = min(aX),
minY = min(aY),
maxX = max(aX),
maxY = max(aY),
deltaX = maxX - minX,
deltaY = maxY - minY;
var o = {
left: this.left + (minX + deltaX / 2),
top: this.top + (minY + deltaY / 2),
width: deltaX,
height: deltaY
};
return o;
},
_getCoordsFromCommand: function(item, i, aX, aY, previous) {
var isLowerCase = false;
if (item[0] !== 'H') {
previous.x = (i === 0) ? getX(item) : getX(this.path[i - 1]);
}
if (item[0] !== 'V') {
previous.y = (i === 0) ? getY(item) : getY(this.path[i - 1]);
}
if (item[0] === item[0].toLowerCase()) {
isLowerCase = true;
}
var xy = this._getXY(item, isLowerCase, previous);
var val = parseInt(xy.x, 10);
if (!isNaN(val)) aX.push(val);
val = parseInt(xy.y, 10);
if (!isNaN(val)) aY.push(val);
},
_getXY: function(item, isLowerCase, previous) {
var x = isLowerCase
? previous.x + getX(item)
: item[0] === 'V'
? previous.x
: getX(item);
var y = isLowerCase
? previous.y + getY(item)
: item[0] === 'H'
? previous.y
: getY(item);
return { x: x, y: y };
}
});
/**
* Creates an instance of fabric.Path from an object
* @static
* @memberOf fabric.Path
* @param {Object} object
* @param {Function} callback Callback to invoke when an fabric.Path instance is created
*/
fabric.Path.fromObject = function(object, callback) {
if (typeof object.path === 'string') {
fabric.loadSVGFromURL(object.path, function (elements) {
var path = elements[0];
var pathUrl = object.path;
delete object.path;
fabric.util.object.extend(path, object);
path.setSourcePath(pathUrl);
callback(path);
});
}
else {
callback(new fabric.Path(object.path, object));
}
};
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)
* @static
* @memberOf fabric.Path
* @see http://www.w3.org/TR/SVG/paths.html#PathElement
*/
fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);
/**
* Creates an instance of fabric.Path from an SVG <path> element
* @static
* @memberOf fabric.Path
* @param {SVGElement} element to parse
* @param {Function} callback Callback to invoke when an fabric.Path instance is created
* @param {Object} [options] Options object
*/
fabric.Path.fromElement = function(element, callback, options) {
var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);
callback && callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));
};
/* _FROM_SVG_END_ */
/**
* Indicates that instances of this type are async
* @static
* @memberOf fabric.Path
* @type Boolean
* @default
*/
fabric.Path.async = true;
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
invoke = fabric.util.array.invoke,
parentToObject = fabric.Object.prototype.toObject;
if (fabric.PathGroup) {
fabric.warn('fabric.PathGroup is already defined');
return;
}
/**
* Path group class
* @class fabric.PathGroup
* @extends fabric.Path
* @tutorial {@link http://fabricjs.com/fabric-intro-part-1/#path_and_pathgroup}
* @see {@link fabric.PathGroup#initialize} for constructor definition
*/
fabric.PathGroup = fabric.util.createClass(fabric.Path, /** @lends fabric.PathGroup.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'path-group',
/**
* Fill value
* @type String
* @default
*/
fill: '',
/**
* Constructor
* @param {Array} paths
* @param {Object} [options] Options object
* @return {fabric.PathGroup} thisArg
*/
initialize: function(paths, options) {
options = options || { };
this.paths = paths || [ ];
for (var i = this.paths.length; i--; ) {
this.paths[i].group = this;
}
this.setOptions(options);
this.setCoords();
if (options.sourcePath) {
this.setSourcePath(options.sourcePath);
}
},
/**
* Renders this group on a specified context
* @param {CanvasRenderingContext2D} ctx Context to render this instance on
*/
render: function(ctx) {
if (!this.visible) return;
ctx.save();
var m = this.transformMatrix;
if (m) {
ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);
}
this.transform(ctx);
this._setShadow(ctx);
this.clipTo && fabric.util.clipContext(this, ctx);
for (var i = 0, l = this.paths.length; i < l; ++i) {
this.paths[i].render(ctx, true);
}
this.clipTo && ctx.restore();
this._removeShadow(ctx);
if (this.active) {
this.drawBorders(ctx);
this.drawControls(ctx);
}
ctx.restore();
},
/**
* Sets certain property to a certain value
* @param {String} prop
* @param {Any} value
* @return {fabric.PathGroup} thisArg
*/
_set: function(prop, value) {
if (prop === 'fill' && value && this.isSameColor()) {
var i = this.paths.length;
while (i--) {
this.paths[i]._set(prop, value);
}
}
return this.callSuper('_set', prop, value);
},
/**
* Returns object representation of this path group
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
var o = extend(parentToObject.call(this, propertiesToInclude), {
paths: invoke(this.getObjects(), 'toObject', propertiesToInclude)
});
if (this.sourcePath) {
o.sourcePath = this.sourcePath;
}
return o;
},
/**
* Returns dataless object representation of this path group
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} dataless object representation of an instance
*/
toDatalessObject: function(propertiesToInclude) {
var o = this.toObject(propertiesToInclude);
if (this.sourcePath) {
o.paths = this.sourcePath;
}
return o;
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var objects = this.getObjects();
var markup = [
'<g ',
'style="', this.getSvgStyles(), '" ',
'transform="', this.getSvgTransform(), '" ',
'>'
];
for (var i = 0, len = objects.length; i < len; i++) {
markup.push(objects[i].toSVG(reviver));
}
markup.push('</g>');
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns a string representation of this path group
* @return {String} string representation of an object
*/
toString: function() {
return '#<fabric.PathGroup (' + this.complexity() +
'): { top: ' + this.top + ', left: ' + this.left + ' }>';
},
/**
* Returns true if all paths in this group are of same color
* @return {Boolean} true if all paths are of the same color (`fill`)
*/
isSameColor: function() {
var firstPathFill = this.getObjects()[0].get('fill');
return this.getObjects().every(function(path) {
return path.get('fill') === firstPathFill;
});
},
/**
* Returns number representation of object's complexity
* @return {Number} complexity
*/
complexity: function() {
return this.paths.reduce(function(total, path) {
return total + ((path && path.complexity) ? path.complexity() : 0);
}, 0);
},
/**
* Returns all paths in this path group
* @return {Array} array of path objects included in this path group
*/
getObjects: function() {
return this.paths;
}
});
/**
* Creates fabric.PathGroup instance from an object representation
* @static
* @memberOf fabric.PathGroup
* @param {Object} object Object to create an instance from
* @param {Function} callback Callback to invoke when an fabric.PathGroup instance is created
*/
fabric.PathGroup.fromObject = function(object, callback) {
if (typeof object.paths === 'string') {
fabric.loadSVGFromURL(object.paths, function (elements) {
var pathUrl = object.paths;
delete object.paths;
var pathGroup = fabric.util.groupSVGElements(elements, object, pathUrl);
callback(pathGroup);
});
}
else {
fabric.util.enlivenObjects(object.paths, function(enlivenedObjects) {
delete object.paths;
callback(new fabric.PathGroup(enlivenedObjects, object));
});
}
};
/**
* Indicates that instances of this type are async
* @static
* @memberOf fabric.PathGroup
* @type Boolean
* @default
*/
fabric.PathGroup.async = true;
})(typeof exports !== 'undefined' ? exports : this);
(function(global){
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
min = fabric.util.array.min,
max = fabric.util.array.max,
invoke = fabric.util.array.invoke;
if (fabric.Group) {
return;
}
var _lockProperties = {
lockMovementX:  true,
lockMovementY:  true,
lockRotation:   true,
lockScalingX:   true,
lockScalingY:   true,
lockUniScaling: true
};
/**
* Group class
* @class fabric.Group
* @extends fabric.Object
* @mixes fabric.Collection
* @tutorial {@link http://fabricjs.com/fabric-intro-part-3/#groups}
* @see {@link fabric.Group#initialize} for constructor definition
*/
fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'group',
/**
* Constructor
* @param {Object} objects Group objects
* @param {Object} [options] Options object
* @return {Object} thisArg
*/
initialize: function(objects, options) {
options = options || { };
this._objects = objects || [];
for (var i = this._objects.length; i--; ) {
this._objects[i].group = this;
}
this.originalState = { };
this.callSuper('initialize');
this._calcBounds();
this._updateObjectsCoords();
if (options) {
extend(this, options);
}
this._setOpacityIfSame();
this.setCoords(true);
this.saveCoords();
},
/**
* @private
*/
_updateObjectsCoords: function() {
this.forEachObject(this._updateObjectCoords, this);
},
/**
* @private
*/
_updateObjectCoords: function(object) {
var objectLeft = object.getLeft(),
objectTop = object.getTop();
object.set({
originalLeft: objectLeft,
originalTop: objectTop,
left: objectLeft - this.left,
top: objectTop - this.top
});
object.setCoords();
object.__origHasControls = object.hasControls;
object.hasControls = false;
},
/**
* Returns string represenation of a group
* @return {String}
*/
toString: function() {
return '#<fabric.Group: (' + this.complexity() + ')>';
},
/**
* Adds an object to a group; Then recalculates group's dimension, position.
* @param {Object} object
* @return {fabric.Group} thisArg
* @chainable
*/
addWithUpdate: function(object) {
this._restoreObjectsState();
this._objects.push(object);
object.group = this;
this.forEachObject(this._setObjectActive, this);
this._calcBounds();
this._updateObjectsCoords();
return this;
},
/**
* @private
*/
_setObjectActive: function(object) {
object.set('active', true);
object.group = this;
},
/**
* Removes an object from a group; Then recalculates group's dimension, position.
* @param {Object} object
* @return {fabric.Group} thisArg
* @chainable
*/
removeWithUpdate: function(object) {
this._moveFlippedObject(object);
this._restoreObjectsState();
this.forEachObject(this._setObjectActive, this);
this.remove(object);
this._calcBounds();
this._updateObjectsCoords();
return this;
},
/**
* @private
*/
_onObjectAdded: function(object) {
object.group = this;
},
/**
* @private
*/
_onObjectRemoved: function(object) {
delete object.group;
object.set('active', false);
},
/**
* Properties that are delegated to group objects when reading/writing
* @param {Object} delegatedProperties
*/
delegatedProperties: {
fill:             true,
opacity:          true,
fontFamily:       true,
fontWeight:       true,
fontSize:         true,
fontStyle:        true,
lineHeight:       true,
textDecoration:   true,
textAlign:        true,
backgroundColor:  true
},
/**
* @private
*/
_set: function(key, value) {
if (key in this.delegatedProperties) {
var i = this._objects.length;
this[key] = value;
while (i--) {
this._objects[i].set(key, value);
}
}
else {
this[key] = value;
}
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
return extend(this.callSuper('toObject', propertiesToInclude), {
objects: invoke(this._objects, 'toObject', propertiesToInclude)
});
},
/**
* Renders instance on a given context
* @param {CanvasRenderingContext2D} ctx context to render instance on
* @param {Boolean} [noTransform] When true, context is not transformed
*/
render: function(ctx, noTransform) {
if (!this.visible) return;
ctx.save();
this.transform(ctx);
this.clipTo && fabric.util.clipContext(this, ctx);
for (var i = 0, len = this._objects.length; i < len; i++) {
this._renderObject(this._objects[i], ctx);
}
this.clipTo && ctx.restore();
if (!noTransform && this.active) {
this.drawBorders(ctx);
this.drawControls(ctx);
}
ctx.restore();
},
/**
* @private
*/
_renderObject: function(object, ctx) {
var originalScaleFactor = object.borderScaleFactor,
originalHasRotatingPoint = object.hasRotatingPoint,
groupScaleFactor = Math.max(this.scaleX, this.scaleY);
if (!object.visible) return;
object.borderScaleFactor = groupScaleFactor;
object.hasRotatingPoint = false;
object.render(ctx);
object.borderScaleFactor = originalScaleFactor;
object.hasRotatingPoint = originalHasRotatingPoint;
},
/**
* Retores original state of each of group objects (original state is that which was before group was created).
* @private
* @return {fabric.Group} thisArg
* @chainable
*/
_restoreObjectsState: function() {
this._objects.forEach(this._restoreObjectState, this);
return this;
},
/**
* Moves a flipped object to the position where it's displayed
* @private
* @param {fabric.Object} object
* @return {fabric.Group} thisArg
*/
_moveFlippedObject: function(object) {
var oldOriginX = object.get('originX'),
oldOriginY = object.get('originY'),
center = object.getCenterPoint();
object.set({
originX: 'center',
originY: 'center',
left: center.x,
top: center.y
});
this._toggleFlipping(object);
var newOrigin = object.getPointByOrigin(oldOriginX, oldOriginY);
object.set({
originX: oldOriginX,
originY: oldOriginY,
left: newOrigin.x,
top: newOrigin.y
});
return this;
},
/**
* @private
*/
_toggleFlipping: function(object) {
if (this.flipX) {
object.toggle('flipX');
object.set('left', -object.get('left'));
object.setAngle(-object.getAngle());
}
if (this.flipY) {
object.toggle('flipY');
object.set('top', -object.get('top'));
object.setAngle(-object.getAngle());
}
},
/**
* Restores original state of a specified object in group
* @private
* @param {fabric.Object} object
* @return {fabric.Group} thisArg
*/
_restoreObjectState: function(object) {
this._setObjectPosition(object);
object.setCoords();
object.hasControls = object.__origHasControls;
delete object.__origHasControls;
object.set('active', false);
object.setCoords();
delete object.group;
return this;
},
/**
* @private
*/
_setObjectPosition: function(object) {
var groupLeft = this.getLeft(),
groupTop = this.getTop(),
rotated = this._getRotatedLeftTop(object);
object.set({
angle: object.getAngle() + this.getAngle(),
left: groupLeft + rotated.left,
top: groupTop + rotated.top,
scaleX: object.get('scaleX') * this.get('scaleX'),
scaleY: object.get('scaleY') * this.get('scaleY')
});
},
/**
* @private
*/
_getRotatedLeftTop: function(object) {
var groupAngle = this.getAngle() * (Math.PI / 180);
return {
left: (-Math.sin(groupAngle) * object.getTop() * this.get('scaleY') +
Math.cos(groupAngle) * object.getLeft() * this.get('scaleX')),
top:  (Math.cos(groupAngle) * object.getTop() * this.get('scaleY') +
Math.sin(groupAngle) * object.getLeft() * this.get('scaleX'))
};
},
/**
* Destroys a group (restoring state of its objects)
* @return {fabric.Group} thisArg
* @chainable
*/
destroy: function() {
this._objects.forEach(this._moveFlippedObject, this);
return this._restoreObjectsState();
},
/**
* Saves coordinates of this instance (to be used together with `hasMoved`)
* @saveCoords
* @return {fabric.Group} thisArg
* @chainable
*/
saveCoords: function() {
this._originalLeft = this.get('left');
this._originalTop = this.get('top');
return this;
},
/**
* Checks whether this group was moved (since `saveCoords` was called last)
* @return {Boolean} true if an object was moved (since fabric.Group#saveCoords was called)
*/
hasMoved: function() {
return this._originalLeft !== this.get('left') ||
this._originalTop !== this.get('top');
},
/**
* Sets coordinates of all group objects
* @return {fabric.Group} thisArg
* @chainable
*/
setObjectsCoords: function() {
this.forEachObject(function(object) {
object.setCoords();
});
return this;
},
/**
* @private
*/
_setOpacityIfSame: function() {
var objects = this.getObjects(),
firstValue = objects[0] ? objects[0].get('opacity') : 1;
var isSameOpacity = objects.every(function(o) {
return o.get('opacity') === firstValue;
});
if (isSameOpacity) {
this.opacity = firstValue;
}
},
/**
* @private
*/
_calcBounds: function() {
var aX = [],
aY = [],
o;
for (var i = 0, len = this._objects.length; i < len; ++i) {
o = this._objects[i];
o.setCoords();
for (var prop in o.oCoords) {
aX.push(o.oCoords[prop].x);
aY.push(o.oCoords[prop].y);
}
}
this.set(this._getBounds(aX, aY));
},
/**
* @private
*/
_getBounds: function(aX, aY) {
var minX = min(aX),
maxX = max(aX),
minY = min(aY),
maxY = max(aY),
width = (maxX - minX) || 0,
height = (maxY - minY) || 0;
return {
width: width,
height: height,
left: (minX + width / 2) || 0,
top: (minY + height / 2) || 0
};
},
/* _TO_SVG_START_ */
/**
* Returns svg representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = [
'<g ',
'transform="', this.getSvgTransform(),
'">'
];
for (var i = 0, len = this._objects.length; i < len; i++) {
markup.push(this._objects[i].toSVG(reviver));
}
markup.push('</g>');
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns requested property
* @param {String} prop Property to get
* @return {Any}
*/
get: function(prop) {
if (prop in _lockProperties) {
if (this[prop]) {
return this[prop];
}
else {
for (var i = 0, len = this._objects.length; i < len; i++) {
if (this._objects[i][prop]) {
return true;
}
}
return false;
}
}
else {
if (prop in this.delegatedProperties) {
return this._objects[0] && this._objects[0].get(prop);
}
return this[prop];
}
}
});
/**
* Returns {@link fabric.Group} instance from an object representation
* @static
* @memberOf fabric.Group
* @param {Object} object Object to create a group from
* @param {Object} [options] Options object
* @return {fabric.Group} An instance of fabric.Group
*/
fabric.Group.fromObject = function(object, callback) {
fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {
delete object.objects;
callback && callback(new fabric.Group(enlivenedObjects, object));
});
};
/**
* Indicates that instances of this type are async
* @static
* @memberOf fabric.Group
* @type Boolean
* @default
*/
fabric.Group.async = true;
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
'use strict';
var extend = fabric.util.object.extend;
if (!global.fabric) {
global.fabric = { };
}
if (global.fabric.Image) {
fabric.warn('fabric.Image is already defined.');
return;
}
/**
* Image class
* @class fabric.Image
* @extends fabric.Object
* @tutorial {@link http://fabricjs.com/fabric-intro-part-1/#images}
* @see {@link fabric.Image#initialize} for constructor definition
*/
fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'image',
/**
* crossOrigin value (one of "", "anonymous", "allow-credentials")
* @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes
* @type String
* @default
*/
crossOrigin: '',
/**
* AlignX value, part of preserveAspectRatio (one of "none", "mid", "min", "max")
* @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute
* This parameter defines how the picture is aligned to its viewport when image element width differs from image width.
* @type String
* @default
*/
alignX: 'none',
/**
* AlignY value, part of preserveAspectRatio (one of "none", "mid", "min", "max")
* @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute
* This parameter defines how the picture is aligned to its viewport when image element height differs from image height.
* @type String
* @default
*/
alignY: 'none',
/**
* meetOrSlice value, part of preserveAspectRatio  (one of "meet", "slice").
* if meet the image is always fully visibile, if slice the viewport is always filled with image.
* @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute
* @type String
* @default
*/
meetOrSlice: 'meet',
/**
* Constructor
* @param {HTMLImageElement | String} element Image element
* @param {Object} [options] Options object
* @return {fabric.Image} thisArg
*/
initialize: function(element, options) {
options || (options = { });
this.filters = [ ];
this.callSuper('initialize', options);
this._initElement(element, options);
this._initConfig(options);
if (options.filters) {
this.filters = options.filters;
this.applyFilters();
}
},
/**
* Returns image element which this instance if based on
* @return {HTMLImageElement} Image element
*/
getElement: function() {
return this._element;
},
/**
* Sets image element for this instance to a specified one.
* If filters defined they are applied to new image.
* You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.
* @param {HTMLImageElement} element
* @param {Function} [callback] Callback is invoked when all filters have been applied and new image is generated
* @return {fabric.Image} thisArg
* @chainable
*/
setElement: function(element, callback) {
this._element = element;
this._originalElement = element;
this._initConfig();
if (this.filters.length !== 0) {
this.applyFilters(callback);
}
return this;
},
/**
* Sets crossOrigin value (on an instance and corresponding image element)
* @return {fabric.Image} thisArg
* @chainable
*/
setCrossOrigin: function(value) {
this.crossOrigin = value;
this._element.crossOrigin = value;
return this;
},
/**
* Returns original size of an image
* @return {Object} Object with "width" and "height" properties
*/
getOriginalSize: function() {
var element = this.getElement();
return {
width: element.width,
height: element.height
};
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_stroke: function(ctx) {
ctx.save();
this._setStrokeStyles(ctx);
ctx.beginPath();
ctx.strokeRect(-this.width / 2, -this.height / 2, this.width, this.height);
ctx.closePath();
ctx.restore();
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderDashedStroke: function(ctx) {
var x = -this.width / 2,
y = -this.height / 2,
w = this.width,
h = this.height;
ctx.save();
this._setStrokeStyles(ctx);
ctx.beginPath();
fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);
fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);
ctx.closePath();
ctx.restore();
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} Object representation of an instance
*/
toObject: function(propertiesToInclude) {
return extend(this.callSuper('toObject', propertiesToInclude), {
src: this._originalElement.src || this._originalElement._src,
filters: this.filters.map(function(filterObj) {
return filterObj && filterObj.toObject();
}),
crossOrigin: this.crossOrigin,
alignX: this.alignX,
alignY: this.alignY,
meetOrSlice: this.meetOrSlice
});
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = [], x = -this.width / 2, y = -this.height / 2,
preserveAspectRatio = 'none';
if (this.group && this.group.type === 'path-group') {
x = this.left;
y = this.top;
}
if (this.alignX !== 'none' && this.alignY !== 'none') {
preserveAspectRatio = 'x' + this.alignX + 'Y' + this.alignY + ' ' + this.meetOrSlice;
}
markup.push(
'<g transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '">\n',
'<image xlink:href="', this.getSvgSrc(),
'" x="', x, '" y="', y,
'" style="', this.getSvgStyles(),
'" width="', this.width,
'" height="', this.height,
'" preserveAspectRatio="', preserveAspectRatio, '"',
'></image>\n'
);
if (this.stroke || this.strokeDashArray) {
var origFill = this.fill;
this.fill = null;
markup.push(
'<rect ',
'x="', x, '" y="', y,
'" width="', this.width, '" height="', this.height,
'" style="', this.getSvgStyles(),
'"/>\n'
);
this.fill = origFill;
}
markup.push('</g>\n');
return reviver ? reviver(markup.join('')) : markup.join('');
},
/* _TO_SVG_END_ */
/**
* Returns source of an image
* @return {String} Source of an image
*/
getSrc: function() {
if (this.getElement()) {
return this.getElement().src || this.getElement()._src;
}
},
/**
* Returns string representation of an instance
* @return {String} String representation of an instance
*/
toString: function() {
return '#<fabric.Image: { src: "' + this.getSrc() + '" }>';
},
/**
* Returns a clone of an instance
* @param {Function} callback Callback is invoked with a clone as a first argument
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
*/
clone: function(callback, propertiesToInclude) {
this.constructor.fromObject(this.toObject(propertiesToInclude), callback);
},
/**
* Applies filters assigned to this image (from "filters" array)
* @mthod applyFilters
* @param {Function} callback Callback is invoked when all filters have been applied and new image is generated
* @return {fabric.Image} thisArg
* @chainable
*/
applyFilters: function(callback) {
if (!this._originalElement) {
return;
}
if (this.filters.length === 0) {
this._element = this._originalElement;
callback && callback();
return;
}
var imgEl = this._originalElement,
canvasEl = fabric.util.createCanvasElement(),
replacement = fabric.util.createImage(),
_this = this;
canvasEl.width = imgEl.width;
canvasEl.height = imgEl.height;
canvasEl.getContext('2d').drawImage(imgEl, 0, 0, imgEl.width, imgEl.height);
this.filters.forEach(function(filter) {
filter && filter.applyTo(canvasEl, filter.scaleX || _this.scaleX, filter.scaleY || _this.scaleY);
});
/** @ignore */
replacement.width = imgEl.width;
replacement.height = imgEl.height;
if (fabric.isLikelyNode) {
replacement.src = canvasEl.toBuffer(undefined, fabric.Image.pngCompression);
_this._element = replacement;
callback && callback();
}
else {
replacement.onload = function() {
_this._element = replacement;
callback && callback();
replacement.onload = canvasEl = imgEl = null;
};
replacement.src = canvasEl.toDataURL('image/png');
}
return this;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_render: function(ctx, noTransform) {
var x, y, imageMargins = this._findMargins();
x = (noTransform ? this.left : -this.width / 2);
y = (noTransform ? this.top : -this.height / 2);
if (this.meetOrSlice === 'slice') {
ctx.beginPath();
ctx.rect(x, y, this.width, this.height);
ctx.clip();
}
this._element &&
ctx.drawImage(this._element,
x + imageMargins.marginX,
y + imageMargins.marginY,
imageMargins.width,
imageMargins.height
);
this._renderStroke(ctx);
},
/**
* @private
*/
_findMargins: function() {
var width = this.width, height = this.height, scales,
scale, marginX = 0, marginY = 0;
if (this.alignX !== 'none' || this.alignY !== 'none') {
scales = [this.width / this._element.width, this.height / this._element.height];
scale = this.meetOrSlice === 'meet'
? Math.min.apply(null, scales) : Math.max.apply(null, scales);
width = this._element.width * scale;
height = this._element.height * scale;
if (this.alignX === 'Mid') {
marginX = (this.width - width) / 2;
}
if (this.alignX === 'Max') {
marginX = this.width - width;
}
if (this.alignY === 'Mid') {
marginY = (this.height - height) / 2;
}
if (this.alignY === 'Max') {
marginY = this.height - height;
}
}
return {
width:  width,
height: height,
marginX: marginX,
marginY: marginY
};
},
/**
* @private
*/
_resetWidthHeight: function() {
var element = this.getElement();
this.set('width', element.width);
this.set('height', element.height);
},
/**
* The Image class's initialization method. This method is automatically
* called by the constructor.
* @private
* @param {HTMLImageElement|String} element The element representing the image
*/
_initElement: function(element) {
this.setElement(fabric.util.getById(element));
fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);
},
/**
* @private
* @param {Object} [options] Options object
*/
_initConfig: function(options) {
options || (options = { });
this.setOptions(options);
this._setWidthHeight(options);
if (this._element && this.crossOrigin) {
this._element.crossOrigin = this.crossOrigin;
}
},
/**
* @private
* @param {Object} object Object with filters property
* @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created
*/
_initFilters: function(object, callback) {
if (object.filters && object.filters.length) {
fabric.util.enlivenObjects(object.filters, function(enlivenedObjects) {
callback && callback(enlivenedObjects);
}, 'fabric.Image.filters');
}
else {
callback && callback();
}
},
/**
* @private
* @param {Object} [options] Object with width/height properties
*/
_setWidthHeight: function(options) {
this.width = 'width' in options
? options.width
: (this.getElement()
? this.getElement().width || 0
: 0);
this.height = 'height' in options
? options.height
: (this.getElement()
? this.getElement().height || 0
: 0);
},
/**
* Returns complexity of an instance
* @return {Number} complexity of this instance
*/
complexity: function() {
return 1;
}
});
/**
* Default CSS class name for canvas
* @static
* @type String
* @default
*/
fabric.Image.CSS_CANVAS = 'canvas-img';
/**
* Alias for getSrc
* @static
*/
fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;
/**
* Creates an instance of fabric.Image from its object representation
* @static
* @param {Object} object Object to create an instance from
* @param {Function} [callback] Callback to invoke when an image instance is created
*/
fabric.Image.fromObject = function(object, callback) {
fabric.util.loadImage(object.src, function(img) {
fabric.Image.prototype._initFilters.call(object, object, function(filters) {
object.filters = filters || [ ];
var instance = new fabric.Image(img, object);
callback && callback(instance);
});
}, null, object.crossOrigin);
};
/**
* Creates an instance of fabric.Image from an URL string
* @static
* @param {String} url URL to create an image from
* @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument)
* @param {Object} [imgOptions] Options object
*/
fabric.Image.fromURL = function(url, callback, imgOptions) {
fabric.util.loadImage(url, function(img) {
callback(new fabric.Image(img, imgOptions));
}, null, imgOptions && imgOptions.crossOrigin);
};
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})
* @static
* @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}
*/
fabric.Image.ATTRIBUTE_NAMES =
fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href'.split(' '));
/**
* Returns {@link fabric.Image} instance from an SVG element
* @static
* @param {SVGElement} element Element to parse
* @param {Function} callback Callback to execute when fabric.Image object is created
* @param {Object} [options] Options object
* @return {fabric.Image} Instance of fabric.Image
*/
fabric.Image.fromElement = function(element, callback, options) {
var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES),
align = 'xMidYMid', meetOrSlice = 'meet', alignX, alignY, aspectRatioAttrs;
if (parsedAttributes.preserveAspectRatio) {
aspectRatioAttrs = parsedAttributes.preserveAspectRatio.split(' ');
}
if (aspectRatioAttrs && aspectRatioAttrs.length) {
meetOrSlice = aspectRatioAttrs.pop();
if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {
align = meetOrSlice;
meetOrSlice = 'meet';
}
else if (aspectRatioAttrs.length) {
align = aspectRatioAttrs.pop();
}
}
alignX = align !== 'none' ? align.slice(1, 4) : 'none';
alignY = align !== 'none' ? align.slice(5, 8) : 'none';
parsedAttributes.alignX = alignX;
parsedAttributes.alignY = alignY;
parsedAttributes.meetOrSlice = meetOrSlice;
fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,
extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));
};
/* _FROM_SVG_END_ */
/**
* Indicates that instances of this type are async
* @static
* @type Boolean
* @default
*/
fabric.Image.async = true;
/**
* Indicates compression level used when generating PNG under Node (in applyFilters). Any of 0-9
* @static
* @type Number
* @default
*/
fabric.Image.pngCompression = 1;
})(typeof exports !== 'undefined' ? exports : this);
fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {
/**
* @private
* @return {Number} angle value
*/
_getAngleValueForStraighten: function() {
var angle = this.getAngle() % 360;
if (angle > 0) {
return Math.round((angle-1)/90) * 90;
}
return Math.round(angle/90) * 90;
},
/**
* Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)
* @return {fabric.Object} thisArg
* @chainable
*/
straighten: function() {
this.setAngle(this._getAngleValueForStraighten());
return this;
},
/**
* Same as {@link fabric.Object.prototype.straighten} but with animation
* @param {Object} callbacks Object with callback functions
* @param {Function} [callbacks.onComplete] Invoked on completion
* @param {Function} [callbacks.onChange] Invoked on every step of animation
* @return {fabric.Object} thisArg
* @chainable
*/
fxStraighten: function(callbacks) {
callbacks = callbacks || { };
var empty = function() { },
onComplete = callbacks.onComplete || empty,
onChange = callbacks.onChange || empty,
_this = this;
fabric.util.animate({
startValue: this.get('angle'),
endValue: this._getAngleValueForStraighten(),
duration: this.FX_DURATION,
onChange: function(value) {
_this.setAngle(value);
onChange();
},
onComplete: function() {
_this.setCoords();
onComplete();
},
onStart: function() {
_this.set('active', false);
}
});
return this;
}
});
fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {
/**
* Straightens object, then rerenders canvas
* @param {fabric.Object} object Object to straighten
* @return {fabric.Canvas} thisArg
* @chainable
*/
straightenObject: function (object) {
object.straighten();
this.renderAll();
return this;
},
/**
* Same as {@link fabric.Canvas.prototype.straightenObject}, but animated
* @param {fabric.Object} object Object to straighten
* @return {fabric.Canvas} thisArg
* @chainable
*/
fxStraightenObject: function (object) {
object.fxStraighten({
onChange: this.renderAll.bind(this)
});
return this;
}
});
/**
* @namespace fabric.Image.filters
* @memberOf fabric.Image
* @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#image_filters}
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
*/
fabric.Image.filters = fabric.Image.filters || { };
/**
* Root filter class from which all filter classes inherit from
* @class fabric.Image.filters.BaseFilter
* @memberOf fabric.Image.filters
*/
fabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'BaseFilter',
/**
* Constructor
* @param {Object} [options] Options object
*/
initialize: function(options) {
if (options) {
this.setOptions(options);
}
},
/**
* Sets filter's properties from options
* @param {Object} [options] Options object
*/
setOptions: function(options) {
for (var prop in options) {
this[prop] = options[prop];
}
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return { type: this.type };
},
/**
* Returns a JSON representation of an instance
* @return {Object} JSON
*/
toJSON: function() {
return this.toObject();
}
});
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Brightness filter class
* @class fabric.Image.filters.Brightness
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Brightness({
*   brightness: 200
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Brightness = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Brightness',
/**
* Constructor
* @memberOf fabric.Image.filters.Brightness.prototype
* @param {Object} [options] Options object
* @param {Number} [options.brightness=100] Value to brighten the image up (0..255)
*/
initialize: function(options) {
options = options || { };
this.brightness = options.brightness || 100;
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
brightness = this.brightness;
for (var i = 0, len = data.length; i < len; i += 4) {
data[i] += brightness;
data[i + 1] += brightness;
data[i + 2] += brightness;
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
brightness: this.brightness
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness
*/
fabric.Image.filters.Brightness.fromObject = function(object) {
return new fabric.Image.filters.Brightness(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Adapted from <a href="http://www.html5rocks.com/en/tutorials/canvas/imagefilters/">html5rocks article</a>
* @class fabric.Image.filters.Convolute
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example <caption>Sharpen filter</caption>
* var filter = new fabric.Image.filters.Convolute({
*   matrix: [ 0, -1,  0,
*            -1,  5, -1,
*             0, -1,  0 ]
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
* @example <caption>Blur filter</caption>
* var filter = new fabric.Image.filters.Convolute({
*   matrix: [ 1/9, 1/9, 1/9,
*             1/9, 1/9, 1/9,
*             1/9, 1/9, 1/9 ]
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
* @example <caption>Emboss filter</caption>
* var filter = new fabric.Image.filters.Convolute({
*   matrix: [ 1,   1,  1,
*             1, 0.7, -1,
*            -1,  -1, -1 ]
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
* @example <caption>Emboss filter with opaqueness</caption>
* var filter = new fabric.Image.filters.Convolute({
*   opaque: true,
*   matrix: [ 1,   1,  1,
*             1, 0.7, -1,
*            -1,  -1, -1 ]
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Convolute = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Convolute',
/**
* Constructor
* @memberOf fabric.Image.filters.Convolute.prototype
* @param {Object} [options] Options object
* @param {Boolean} [options.opaque=false] Opaque value (true/false)
* @param {Array} [options.matrix] Filter matrix
*/
initialize: function(options) {
options = options || { };
this.opaque = options.opaque;
this.matrix = options.matrix || [ 0, 0, 0,
0, 1, 0,
0, 0, 0 ];
var canvasEl = fabric.util.createCanvasElement();
this.tmpCtx = canvasEl.getContext('2d');
},
/**
* @private
*/
_createImageData: function(w, h) {
return this.tmpCtx.createImageData(w, h);
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var weights = this.matrix,
context = canvasEl.getContext('2d'),
pixels = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
side = Math.round(Math.sqrt(weights.length)),
halfSide = Math.floor(side/2),
src = pixels.data,
sw = pixels.width,
sh = pixels.height;
var w = sw;
var h = sh;
var output = this._createImageData(w, h);
var dst = output.data;
var alphaFac = this.opaque ? 1 : 0;
for (var y=0; y<h; y++) {
for (var x=0; x<w; x++) {
var sy = y;
var sx = x;
var dstOff = (y*w+x)*4;
var r=0, g=0, b=0, a=0;
for (var cy=0; cy<side; cy++) {
for (var cx=0; cx<side; cx++) {
var scy = sy + cy - halfSide;
var scx = sx + cx - halfSide;
/* jshint maxdepth:5 */
if (scy < 0 || scy > sh || scx < 0 || scx > sw) continue;
var srcOff = (scy*sw+scx)*4;
var wt = weights[cy*side+cx];
r += src[srcOff] * wt;
g += src[srcOff+1] * wt;
b += src[srcOff+2] * wt;
a += src[srcOff+3] * wt;
}
}
dst[dstOff] = r;
dst[dstOff+1] = g;
dst[dstOff+2] = b;
dst[dstOff+3] = a + alphaFac*(255-a);
}
}
context.putImageData(output, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
opaque: this.opaque,
matrix: this.matrix
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute
*/
fabric.Image.filters.Convolute.fromObject = function(object) {
return new fabric.Image.filters.Convolute(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* GradientTransparency filter class
* @class fabric.Image.filters.GradientTransparency
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.GradientTransparency#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.GradientTransparency({
*   threshold: 200
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.GradientTransparency = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.GradientTransparency.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'GradientTransparency',
/**
* Constructor
* @memberOf fabric.Image.filters.GradientTransparency.prototype
* @param {Object} [options] Options object
* @param {Number} [options.threshold=100] Threshold value
*/
initialize: function(options) {
options = options || { };
this.threshold = options.threshold || 100;
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
threshold = this.threshold,
total = data.length;
for (var i = 0, len = data.length; i < len; i += 4) {
data[i + 3] = threshold + 255 * (total - i) / total;
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
threshold: this.threshold
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.GradientTransparency} Instance of fabric.Image.filters.GradientTransparency
*/
fabric.Image.filters.GradientTransparency.fromObject = function(object) {
return new fabric.Image.filters.GradientTransparency(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { });
/**
* Grayscale image filter class
* @class fabric.Image.filters.Grayscale
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Grayscale();
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Grayscale = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Grayscale',
/**
* Applies filter to canvas element
* @memberOf fabric.Image.filters.Grayscale.prototype
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
len = imageData.width * imageData.height * 4,
index = 0,
average;
while (index < len) {
average = (data[index] + data[index + 1] + data[index + 2]) / 3;
data[index]     = average;
data[index + 1] = average;
data[index + 2] = average;
index += 4;
}
context.putImageData(imageData, 0, 0);
}
});
/**
* Returns filter instance from an object representation
* @static
* @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale
*/
fabric.Image.filters.Grayscale.fromObject = function() {
return new fabric.Image.filters.Grayscale();
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { });
/**
* Invert filter class
* @class fabric.Image.filters.Invert
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Invert();
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Invert = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Invert',
/**
* Applies filter to canvas element
* @memberOf fabric.Image.filters.Invert.prototype
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
iLen = data.length, i;
for (i = 0; i < iLen; i+=4) {
data[i] = 255 - data[i];
data[i + 1] = 255 - data[i + 1];
data[i + 2] = 255 - data[i + 2];
}
context.putImageData(imageData, 0, 0);
}
});
/**
* Returns filter instance from an object representation
* @static
* @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert
*/
fabric.Image.filters.Invert.fromObject = function() {
return new fabric.Image.filters.Invert();
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Mask filter class
* See http://resources.aleph-1.com/mask/
* @class fabric.Image.filters.Mask
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.Mask#initialize} for constructor definition
*/
fabric.Image.filters.Mask = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Mask.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Mask',
/**
* Constructor
* @memberOf fabric.Image.filters.Mask.prototype
* @param {Object} [options] Options object
* @param {fabric.Image} [options.mask] Mask image object
* @param {Number} [options.channel=0] Rgb channel (0, 1, 2 or 3)
*/
initialize: function(options) {
options = options || { };
this.mask = options.mask;
this.channel = [ 0, 1, 2, 3 ].indexOf(options.channel) > -1 ? options.channel : 0;
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
if (!this.mask) return;
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
maskEl = this.mask.getElement(),
maskCanvasEl = fabric.util.createCanvasElement(),
channel = this.channel,
i,
iLen = imageData.width * imageData.height * 4;
maskCanvasEl.width = maskEl.width;
maskCanvasEl.height = maskEl.height;
maskCanvasEl.getContext('2d').drawImage(maskEl, 0, 0, maskEl.width, maskEl.height);
var maskImageData = maskCanvasEl.getContext('2d').getImageData(0, 0, maskEl.width, maskEl.height),
maskData = maskImageData.data;
for (i = 0; i < iLen; i += 4) {
data[i + 3] = maskData[i + channel];
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
mask: this.mask.toObject(),
channel: this.channel
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @param {Function} [callback] Callback to invoke when a mask filter instance is created
*/
fabric.Image.filters.Mask.fromObject = function(object, callback) {
fabric.util.loadImage(object.mask.src, function(img) {
object.mask = new fabric.Image(img, object.mask);
callback && callback(new fabric.Image.filters.Mask(object));
});
};
/**
* Indicates that instances of this type are async
* @static
* @type Boolean
* @default
*/
fabric.Image.filters.Mask.async = true;
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Noise filter class
* @class fabric.Image.filters.Noise
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.Noise#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Noise({
*   noise: 700
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Noise = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Noise',
/**
* Constructor
* @memberOf fabric.Image.filters.Noise.prototype
* @param {Object} [options] Options object
* @param {Number} [options.noise=100] Noise value
*/
initialize: function(options) {
options = options || { };
this.noise = options.noise || 100;
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
noise = this.noise, rand;
for (var i = 0, len = data.length; i < len; i += 4) {
rand = (0.5 - Math.random()) * noise;
data[i] += rand;
data[i + 1] += rand;
data[i + 2] += rand;
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
noise: this.noise
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise
*/
fabric.Image.filters.Noise.fromObject = function(object) {
return new fabric.Image.filters.Noise(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Pixelate filter class
* @class fabric.Image.filters.Pixelate
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Pixelate({
*   blocksize: 8
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Pixelate = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Pixelate',
/**
* Constructor
* @memberOf fabric.Image.filters.Pixelate.prototype
* @param {Object} [options] Options object
* @param {Number} [options.blocksize=4] Blocksize for pixelate
*/
initialize: function(options) {
options = options || { };
this.blocksize = options.blocksize || 4;
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
iLen = imageData.height,
jLen = imageData.width,
index, i, j, r, g, b, a;
for (i = 0; i < iLen; i += this.blocksize) {
for (j = 0; j < jLen; j += this.blocksize) {
index = (i * 4) * jLen + (j * 4);
r = data[index];
g = data[index+1];
b = data[index+2];
a = data[index+3];
/*
blocksize: 4
[1,x,x,x,1]
[x,x,x,x,1]
[x,x,x,x,1]
[x,x,x,x,1]
[1,1,1,1,1]
*/
for (var _i = i, _ilen = i + this.blocksize; _i < _ilen; _i++) {
for (var _j = j, _jlen = j + this.blocksize; _j < _jlen; _j++) {
index = (_i * 4) * jLen + (_j * 4);
data[index] = r;
data[index + 1] = g;
data[index + 2] = b;
data[index + 3] = a;
}
}
}
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
blocksize: this.blocksize
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate
*/
fabric.Image.filters.Pixelate.fromObject = function(object) {
return new fabric.Image.filters.Pixelate(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Remove white filter class
* @class fabric.Image.filters.RemoveWhite
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.RemoveWhite#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.RemoveWhite({
*   threshold: 40,
*   distance: 140
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.RemoveWhite = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.RemoveWhite.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'RemoveWhite',
/**
* Constructor
* @memberOf fabric.Image.filters.RemoveWhite.prototype
* @param {Object} [options] Options object
* @param {Number} [options.threshold=30] Threshold value
* @param {Number} [options.distance=20] Distance value
*/
initialize: function(options) {
options = options || { };
this.threshold = options.threshold || 30;
this.distance = options.distance || 20;
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
threshold = this.threshold,
distance = this.distance,
limit = 255 - threshold,
abs = Math.abs,
r, g, b;
for (var i = 0, len = data.length; i < len; i += 4) {
r = data[i];
g = data[i+1];
b = data[i+2];
if (r > limit &&
g > limit &&
b > limit &&
abs(r-g) < distance &&
abs(r-b) < distance &&
abs(g-b) < distance
) {
data[i+3] = 1;
}
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
threshold: this.threshold,
distance: this.distance
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.RemoveWhite} Instance of fabric.Image.filters.RemoveWhite
*/
fabric.Image.filters.RemoveWhite.fromObject = function(object) {
return new fabric.Image.filters.RemoveWhite(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { });
/**
* Sepia filter class
* @class fabric.Image.filters.Sepia
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Sepia();
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Sepia = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Sepia.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Sepia',
/**
* Applies filter to canvas element
* @memberOf fabric.Image.filters.Sepia.prototype
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
iLen = data.length, i, avg;
for (i = 0; i < iLen; i+=4) {
avg = 0.3  * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];
data[i] = avg + 100;
data[i + 1] = avg + 50;
data[i + 2] = avg + 255;
}
context.putImageData(imageData, 0, 0);
}
});
/**
* Returns filter instance from an object representation
* @static
* @return {fabric.Image.filters.Sepia} Instance of fabric.Image.filters.Sepia
*/
fabric.Image.filters.Sepia.fromObject = function() {
return new fabric.Image.filters.Sepia();
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { });
/**
* Sepia2 filter class
* @class fabric.Image.filters.Sepia2
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Sepia2();
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Sepia2 = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Sepia2.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Sepia2',
/**
* Applies filter to canvas element
* @memberOf fabric.Image.filters.Sepia.prototype
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
iLen = data.length, i, r, g, b;
for (i = 0; i < iLen; i+=4) {
r = data[i];
g = data[i + 1];
b = data[i + 2];
data[i] = (r * 0.393 + g * 0.769 + b * 0.189 ) / 1.351;
data[i + 1] = (r * 0.349 + g * 0.686 + b * 0.168 ) / 1.203;
data[i + 2] = (r * 0.272 + g * 0.534 + b * 0.131 ) / 2.140;
}
context.putImageData(imageData, 0, 0);
}
});
/**
* Returns filter instance from an object representation
* @static
* @return {fabric.Image.filters.Sepia2} Instance of fabric.Image.filters.Sepia2
*/
fabric.Image.filters.Sepia2.fromObject = function() {
return new fabric.Image.filters.Sepia2();
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric  = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend;
/**
* Tint filter class
* Adapted from <a href="https://github.com/mezzoblue/PaintbrushJS">https://github.com/mezzoblue/PaintbrushJS</a>
* @class fabric.Image.filters.Tint
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link fabric.Image.filters.Tint#initialize} for constructor definition
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example <caption>Tint filter with hex color and opacity</caption>
* var filter = new fabric.Image.filters.Tint({
*   color: '#3513B0',
*   opacity: 0.5
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
* @example <caption>Tint filter with rgba color</caption>
* var filter = new fabric.Image.filters.Tint({
*   color: 'rgba(53, 21, 176, 0.5)'
* });
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Tint = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Tint.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Tint',
/**
* Constructor
* @memberOf fabric.Image.filters.Tint.prototype
* @param {Object} [options] Options object
* @param {String} [options.color=#000000] Color to tint the image with
* @param {Number} [options.opacity] Opacity value that controls the tint effect's transparency (0..1)
*/
initialize: function(options) {
options = options || { };
this.color = options.color || '#000000';
this.opacity = typeof options.opacity !== 'undefined'
? options.opacity
: new fabric.Color(this.color).getAlpha();
},
/**
* Applies filter to canvas element
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl) {
var context = canvasEl.getContext('2d'),
imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),
data = imageData.data,
iLen = data.length, i,
tintR, tintG, tintB,
r, g, b, alpha1,
source;
source = new fabric.Color(this.color).getSource();
tintR = source[0] * this.opacity;
tintG = source[1] * this.opacity;
tintB = source[2] * this.opacity;
alpha1 = 1 - this.opacity;
for (i = 0; i < iLen; i+=4) {
r = data[i];
g = data[i + 1];
b = data[i + 2];
data[i] = tintR + r * alpha1;
data[i + 1] = tintG + g * alpha1;
data[i + 2] = tintB + b * alpha1;
}
context.putImageData(imageData, 0, 0);
},
/**
* Returns object representation of an instance
* @return {Object} Object representation of an instance
*/
toObject: function() {
return extend(this.callSuper('toObject'), {
color: this.color,
opacity: this.opacity
});
}
});
/**
* Returns filter instance from an object representation
* @static
* @param {Object} object Object to create an instance from
* @return {fabric.Image.filters.Tint} Instance of fabric.Image.filters.Tint
*/
fabric.Image.filters.Tint.fromObject = function(object) {
return new fabric.Image.filters.Tint(object);
};
})(typeof exports !== 'undefined' ? exports : this);
(function(global) {
"use strict";
var fabric = global.fabric || (global.fabric = { }),
extend = fabric.util.object.extend,
clone = fabric.util.object.clone,
toFixed = fabric.util.toFixed,
supportsLineDash = fabric.StaticCanvas.supports('setLineDash');
if (fabric.Text) {
fabric.warn('fabric.Text is already defined');
return;
}
var stateProperties = fabric.Object.prototype.stateProperties.concat();
stateProperties.push(
'fontFamily',
'fontWeight',
'fontSize',
'text',
'textDecoration',
'textAlign',
'fontStyle',
'lineHeight',
'textBackgroundColor',
'useNative',
'path'
);
/**
* Text class
* @class fabric.Text
* @extends fabric.Object
* @return {fabric.Text} thisArg
* @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#text}
* @see {@link fabric.Text#initialize} for constructor definition
*/
fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {
/**
* Properties which when set cause object to change dimensions
* @type Object
* @private
*/
_dimensionAffectingProps: {
fontSize: true,
fontWeight: true,
fontFamily: true,
textDecoration: true,
fontStyle: true,
lineHeight: true,
stroke: true,
strokeWidth: true,
text: true
},
/**
* @private
*/
_reNewline: /\r?\n/,
/**
* Retrieves object's fontSize
* @method getFontSize
* @memberOf fabric.Text.prototype
* @return {String} Font size (in pixels)
*/
/**
* Sets object's fontSize
* @method setFontSize
* @memberOf fabric.Text.prototype
* @param {Number} fontSize Font size (in pixels)
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's fontWeight
* @method getFontWeight
* @memberOf fabric.Text.prototype
* @return {(String|Number)} Font weight
*/
/**
* Sets object's fontWeight
* @method setFontWeight
* @memberOf fabric.Text.prototype
* @param {(Number|String)} fontWeight Font weight
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's fontFamily
* @method getFontFamily
* @memberOf fabric.Text.prototype
* @return {String} Font family
*/
/**
* Sets object's fontFamily
* @method setFontFamily
* @memberOf fabric.Text.prototype
* @param {String} fontFamily Font family
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's text
* @method getText
* @memberOf fabric.Text.prototype
* @return {String} text
*/
/**
* Sets object's text
* @method setText
* @memberOf fabric.Text.prototype
* @param {String} text Text
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's textDecoration
* @method getTextDecoration
* @memberOf fabric.Text.prototype
* @return {String} Text decoration
*/
/**
* Sets object's textDecoration
* @method setTextDecoration
* @memberOf fabric.Text.prototype
* @param {String} textDecoration Text decoration
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's fontStyle
* @method getFontStyle
* @memberOf fabric.Text.prototype
* @return {String} Font style
*/
/**
* Sets object's fontStyle
* @method setFontStyle
* @memberOf fabric.Text.prototype
* @param {String} fontStyle Font style
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's lineHeight
* @method getLineHeight
* @memberOf fabric.Text.prototype
* @return {Number} Line height
*/
/**
* Sets object's lineHeight
* @method setLineHeight
* @memberOf fabric.Text.prototype
* @param {Number} lineHeight Line height
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's textAlign
* @method getTextAlign
* @memberOf fabric.Text.prototype
* @return {String} Text alignment
*/
/**
* Sets object's textAlign
* @method setTextAlign
* @memberOf fabric.Text.prototype
* @param {String} textAlign Text alignment
* @return {fabric.Text}
* @chainable
*/
/**
* Retrieves object's textBackgroundColor
* @method getTextBackgroundColor
* @memberOf fabric.Text.prototype
* @return {String} Text background color
*/
/**
* Sets object's textBackgroundColor
* @method setTextBackgroundColor
* @memberOf fabric.Text.prototype
* @param {String} textBackgroundColor Text background color
* @return {fabric.Text}
* @chainable
*/
/**
* Type of an object
* @type String
* @default
*/
type:                 'text',
/**
* Font size (in pixels)
* @type Number
* @default
*/
fontSize:             40,
/**
* Font weight (e.g. bold, normal, 400, 600, 800)
* @type {(Number|String)}
* @default
*/
fontWeight:           'normal',
/**
* Font family
* @type String
* @default
*/
fontFamily:           'Times New Roman',
/**
* Text decoration Possible values: "", "underline", "overline" or "line-through".
* @type String
* @default
*/
textDecoration:       '',
/**
* Text alignment. Possible values: "left", "center", or "right".
* @type String
* @default
*/
textAlign:            'left',
/**
* Font style . Possible values: "", "normal", "italic" or "oblique".
* @type String
* @default
*/
fontStyle:            '',
/**
* Line height
* @type Number
* @default
*/
lineHeight:           1.3,
/**
* Background color of text lines
* @type String
* @default
*/
textBackgroundColor:  '',
/**
* URL of a font file, when using Cufon
* @type String | null
* @default
*/
path:                 null,
/**
* Indicates whether canvas native text methods should be used to render text (otherwise, Cufon is used)
* @type Boolean
* @default
*/
useNative:            true,
/**
* List of properties to consider when checking if
* state of an object is changed ({@link fabric.Object#hasStateChanged})
* as well as for history (undo/redo) purposes
* @type Array
*/
stateProperties:      stateProperties,
/**
* When defined, an object is rendered via stroke and this property specifies its color.
* <b>Backwards incompatibility note:</b> This property was named "strokeStyle" until v1.1.6
* @type String
* @default
*/
stroke:               null,
/**
* Shadow object representing shadow of this shape.
* <b>Backwards incompatibility note:</b> This property was named "textShadow" (String) until v1.2.11
* @type fabric.Shadow
* @default
*/
shadow:               null,
/**
* Constructor
* @param {String} text Text string
* @param {Object} [options] Options object
* @return {fabric.Text} thisArg
*/
initialize: function(text, options) {
options = options || { };
this.text = text;
this.__skipDimension = true;
this.setOptions(options);
this.__skipDimension = false;
this._initDimensions();
this.setCoords();
},
/**
* Renders text object on offscreen canvas, so that it would get dimensions
* @private
*/
_initDimensions: function() {
if (this.__skipDimension) return;
var canvasEl = fabric.util.createCanvasElement();
this._render(canvasEl.getContext('2d'));
},
/**
* Returns string representation of an instance
* @return {String} String representation of text object
*/
toString: function() {
return '#<fabric.Text (' + this.complexity() +
'): { "text": "' + this.text + '", "fontFamily": "' + this.fontFamily + '" }>';
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_render: function(ctx) {
var isInPathGroup = this.group && this.group.type === 'path-group';
if (isInPathGroup && !this.transformMatrix) {
ctx.translate(-this.group.width/2 + this.left, -this.group.height / 2 + this.top);
}
else if (isInPathGroup && this.transformMatrix) {
ctx.translate(-this.group.width/2, -this.group.height/2);
}
if (typeof Cufon === 'undefined' || this.useNative === true) {
this._renderViaNative(ctx);
}
else {
this._renderViaCufon(ctx);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderViaNative: function(ctx) {
var textLines = this.text.split(this._reNewline);
this.transform(ctx, fabric.isLikelyNode);
this._setTextStyles(ctx);
this.width = this._getTextWidth(ctx, textLines);
this.height = this._getTextHeight(ctx, textLines);
this.clipTo && fabric.util.clipContext(this, ctx);
this._renderTextBackground(ctx, textLines);
this._translateForTextAlign(ctx);
this._renderText(ctx, textLines);
if (this.textAlign !== 'left' && this.textAlign !== 'justify') {
ctx.restore();
}
this._renderTextDecoration(ctx, textLines);
this.clipTo && ctx.restore();
this._setBoundaries(ctx, textLines);
this._totalLineHeight = 0;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderText: function(ctx, textLines) {
ctx.save();
this._setShadow(ctx);
this._renderTextFill(ctx, textLines);
this._renderTextStroke(ctx, textLines);
this._removeShadow(ctx);
ctx.restore();
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_translateForTextAlign: function(ctx) {
if (this.textAlign !== 'left' && this.textAlign !== 'justify') {
ctx.save();
ctx.translate(this.textAlign === 'center' ? (this.width / 2) : this.width, 0);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_setBoundaries: function(ctx, textLines) {
this._boundaries = [ ];
for (var i = 0, len = textLines.length; i < len; i++) {
var lineWidth = this._getLineWidth(ctx, textLines[i]);
var lineLeftOffset = this._getLineLeftOffset(lineWidth);
this._boundaries.push({
height: this.fontSize * this.lineHeight,
width: lineWidth,
left: lineLeftOffset
});
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_setTextStyles: function(ctx) {
this._setFillStyles(ctx);
this._setStrokeStyles(ctx);
ctx.textBaseline = 'alphabetic';
if (!this.skipTextAlign) {
ctx.textAlign = this.textAlign;
}
ctx.font = this._getFontDeclaration();
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
* @return {Number} Height of fabric.Text object
*/
_getTextHeight: function(ctx, textLines) {
return this.fontSize * textLines.length * this.lineHeight;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
* @return {Number} Maximum width of fabric.Text object
*/
_getTextWidth: function(ctx, textLines) {
var maxWidth = ctx.measureText(textLines[0] || '|').width;
for (var i = 1, len = textLines.length; i < len; i++) {
var currentLineWidth = ctx.measureText(textLines[i]).width;
if (currentLineWidth > maxWidth) {
maxWidth = currentLineWidth;
}
}
return maxWidth;
},
/**
* @private
* @param {String} method Method name ("fillText" or "strokeText")
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {String} line Chars to render
* @param {Number} left Left position of text
* @param {Number} top Top position of text
*/
_renderChars: function(method, ctx, chars, left, top) {
ctx[method](chars, left, top);
},
/**
* @private
* @param {String} method Method name ("fillText" or "strokeText")
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {String} line Text to render
* @param {Number} left Left position of text
* @param {Number} top Top position of text
* @param {Number} lineIndex Index of a line in a text
*/
_renderTextLine: function(method, ctx, line, left, top, lineIndex) {
top -= this.fontSize / 4;
if (this.textAlign !== 'justify') {
this._renderChars(method, ctx, line, left, top, lineIndex);
return;
}
var lineWidth = ctx.measureText(line).width;
var totalWidth = this.width;
if (totalWidth > lineWidth) {
var words = line.split(/\s+/);
var wordsWidth = ctx.measureText(line.replace(/\s+/g, '')).width;
var widthDiff = totalWidth - wordsWidth;
var numSpaces = words.length - 1;
var spaceWidth = widthDiff / numSpaces;
var leftOffset = 0;
for (var i = 0, len = words.length; i < len; i++) {
this._renderChars(method, ctx, words[i], left + leftOffset, top, lineIndex);
leftOffset += ctx.measureText(words[i]).width + spaceWidth;
}
}
else {
this._renderChars(method, ctx, line, left, top, lineIndex);
}
},
/**
* @private
* @return {Number} Left offset
*/
_getLeftOffset: function() {
if (fabric.isLikelyNode) {
return 0;
}
return -this.width / 2;
},
/**
* @private
* @return {Number} Top offset
*/
_getTopOffset: function() {
return -this.height / 2;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_renderTextFill: function(ctx, textLines) {
if (!this.fill && !this._skipFillStrokeCheck) return;
this._boundaries = [ ];
var lineHeights = 0;
for (var i = 0, len = textLines.length; i < len; i++) {
var heightOfLine = this._getHeightOfLine(ctx, i, textLines);
lineHeights += heightOfLine;
this._renderTextLine(
'fillText',
ctx,
textLines[i],
this._getLeftOffset(),
this._getTopOffset() + lineHeights,
i
);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_renderTextStroke: function(ctx, textLines) {
if (!this.stroke && !this._skipFillStrokeCheck) return;
var lineHeights = 0;
ctx.save();
if (this.strokeDashArray) {
if (1 & this.strokeDashArray.length) {
this.strokeDashArray.push.apply(this.strokeDashArray, this.strokeDashArray);
}
supportsLineDash && ctx.setLineDash(this.strokeDashArray);
}
ctx.beginPath();
for (var i = 0, len = textLines.length; i < len; i++) {
var heightOfLine = this._getHeightOfLine(ctx, i, textLines);
lineHeights += heightOfLine;
this._renderTextLine(
'strokeText',
ctx,
textLines[i],
this._getLeftOffset(),
this._getTopOffset() + lineHeights,
i
);
}
ctx.closePath();
ctx.restore();
},
_getHeightOfLine: function() {
return this.fontSize * this.lineHeight;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_renderTextBackground: function(ctx, textLines) {
this._renderTextBoxBackground(ctx);
this._renderTextLinesBackground(ctx, textLines);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderTextBoxBackground: function(ctx) {
if (!this.backgroundColor) return;
ctx.save();
ctx.fillStyle = this.backgroundColor;
ctx.fillRect(
this._getLeftOffset(),
this._getTopOffset(),
this.width,
this.height
);
ctx.restore();
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_renderTextLinesBackground: function(ctx, textLines) {
if (!this.textBackgroundColor) return;
ctx.save();
ctx.fillStyle = this.textBackgroundColor;
for (var i = 0, len = textLines.length; i < len; i++) {
if (textLines[i] !== '') {
var lineWidth = this._getLineWidth(ctx, textLines[i]);
var lineLeftOffset = this._getLineLeftOffset(lineWidth);
ctx.fillRect(
this._getLeftOffset() + lineLeftOffset,
this._getTopOffset() + (i * this.fontSize * this.lineHeight),
lineWidth,
this.fontSize * this.lineHeight
);
}
}
ctx.restore();
},
/**
* @private
* @param {Number} lineWidth Width of text line
* @return {Number} Line left offset
*/
_getLineLeftOffset: function(lineWidth) {
if (this.textAlign === 'center') {
return (this.width - lineWidth) / 2;
}
if (this.textAlign === 'right') {
return this.width - lineWidth;
}
return 0;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {String} line Text line
* @return {Number} Line width
*/
_getLineWidth: function(ctx, line) {
return this.textAlign === 'justify'
? this.width
: ctx.measureText(line).width;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_renderTextDecoration: function(ctx, textLines) {
if (!this.textDecoration) return;
var halfOfVerticalBox = this._getTextHeight(ctx, textLines) / 2;
var _this = this;
/** @ignore */
function renderLinesAtOffset(offset) {
for (var i = 0, len = textLines.length; i < len; i++) {
var lineWidth = _this._getLineWidth(ctx, textLines[i]);
var lineLeftOffset = _this._getLineLeftOffset(lineWidth);
ctx.fillRect(
_this._getLeftOffset() + lineLeftOffset,
~~((offset + (i * _this._getHeightOfLine(ctx, i, textLines))) - halfOfVerticalBox),
lineWidth,
1);
}
}
if (this.textDecoration.indexOf('underline') > -1) {
renderLinesAtOffset(this.fontSize * this.lineHeight);
}
if (this.textDecoration.indexOf('line-through') > -1) {
renderLinesAtOffset(this.fontSize * this.lineHeight - this.fontSize / 2);
}
if (this.textDecoration.indexOf('overline') > -1) {
renderLinesAtOffset(this.fontSize * this.lineHeight - this.fontSize);
}
},
/**
* @private
*/
_getFontDeclaration: function() {
return [
(fabric.isLikelyNode ? this.fontWeight : this.fontStyle),
(fabric.isLikelyNode ? this.fontStyle : this.fontWeight),
this.fontSize + 'px',
(fabric.isLikelyNode ? ('"' + this.fontFamily + '"') : this.fontFamily)
].join(' ');
},
/**
* Renders text instance on a specified context
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Boolean} [noTransform] When true, context is not transformed
*/
render: function(ctx, noTransform) {
if (!this.visible) return;
ctx.save();
this._render(ctx);
if (!noTransform && this.active) {
this.drawBorders(ctx);
this.drawControls(ctx);
}
ctx.restore();
},
/**
* Returns object representation of an instance
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} Object representation of an instance
*/
toObject: function(propertiesToInclude) {
var object = extend(this.callSuper('toObject', propertiesToInclude), {
text:                 this.text,
fontSize:             this.fontSize,
fontWeight:           this.fontWeight,
fontFamily:           this.fontFamily,
fontStyle:            this.fontStyle,
lineHeight:           this.lineHeight,
textDecoration:       this.textDecoration,
textAlign:            this.textAlign,
path:                 this.path,
textBackgroundColor:  this.textBackgroundColor,
useNative:            this.useNative
});
if (!this.includeDefaultValues) {
this._removeDefaultValues(object);
}
return object;
},
/* _TO_SVG_START_ */
/**
* Returns SVG representation of an instance
* @param {Function} [reviver] Method for further parsing of svg representation.
* @return {String} svg representation of an instance
*/
toSVG: function(reviver) {
var markup = [ ],
textLines = this.text.split(this._reNewline),
offsets = this._getSVGLeftTopOffsets(textLines),
textAndBg = this._getSVGTextAndBg(offsets.lineTop, offsets.textLeft, textLines),
shadowSpans = this._getSVGShadows(offsets.lineTop, textLines);
offsets.textTop += (this._fontAscent ? ((this._fontAscent / 5) * this.lineHeight) : 0);
this._wrapSVGTextAndBg(markup, textAndBg, shadowSpans, offsets);
return reviver ? reviver(markup.join('')) : markup.join('');
},
/**
* @private
*/
_getSVGLeftTopOffsets: function(textLines) {
var lineTop = this.useNative
? this.fontSize * this.lineHeight
: (-this._fontAscent - ((this._fontAscent / 5) * this.lineHeight)),
textLeft = -(this.width/2),
textTop = this.useNative
? this.fontSize - 1
: (this.height/2) - (textLines.length * this.fontSize) - this._totalLineHeight;
return {
textLeft: textLeft,
textTop: textTop,
lineTop: lineTop
};
},
/**
* @private
*/
_wrapSVGTextAndBg: function(markup, textAndBg, shadowSpans, offsets) {
markup.push(
'<g transform="', this.getSvgTransform(), '">',
textAndBg.textBgRects.join(''),
'<text ',
(this.fontFamily ? 'font-family="' + this.fontFamily.replace(/"/g,'\'') + '" ': ''),
(this.fontSize ? 'font-size="' + this.fontSize + '" ': ''),
(this.fontStyle ? 'font-style="' + this.fontStyle + '" ': ''),
(this.fontWeight ? 'font-weight="' + this.fontWeight + '" ': ''),
(this.textDecoration ? 'text-decoration="' + this.textDecoration + '" ': ''),
'style="', this.getSvgStyles(), '" ',
/* svg starts from left/bottom corner so we normalize height */
'transform="translate(', toFixed(offsets.textLeft, 2), ' ', toFixed(offsets.textTop, 2), ')">',
shadowSpans.join(''),
textAndBg.textSpans.join(''),
'</text>',
'</g>'
);
},
/**
* @private
* @param {Number} lineHeight
* @param {Array} textLines Array of all text lines
* @return {Array}
*/
_getSVGShadows: function(lineHeight, textLines) {
var shadowSpans = [],
i, len,
lineTopOffsetMultiplier = 1;
if (!this.shadow || !this._boundaries) {
return shadowSpans;
}
for (i = 0, len = textLines.length; i < len; i++) {
if (textLines[i] !== '') {
var lineLeftOffset = (this._boundaries && this._boundaries[i]) ? this._boundaries[i].left : 0;
shadowSpans.push(
'<tspan x="',
toFixed((lineLeftOffset + lineTopOffsetMultiplier) + this.shadow.offsetX, 2),
((i === 0 || this.useNative) ? '" y' : '" dy'), '="',
toFixed(this.useNative
? ((lineHeight * i) - this.height / 2 + this.shadow.offsetY)
: (lineHeight + (i === 0 ? this.shadow.offsetY : 0)), 2),
'" ',
this._getFillAttributes(this.shadow.color), '>',
fabric.util.string.escapeXml(textLines[i]),
'</tspan>');
lineTopOffsetMultiplier = 1;
}
else {
lineTopOffsetMultiplier++;
}
}
return shadowSpans;
},
/**
* @private
* @param {Number} lineHeight
* @param {Number} textLeftOffset Text left offset
* @param {Array} textLines Array of all text lines
* @return {Object}
*/
_getSVGTextAndBg: function(lineHeight, textLeftOffset, textLines) {
var textSpans = [ ],
textBgRects = [ ],
lineTopOffsetMultiplier = 1;
this._setSVGBg(textBgRects);
for (var i = 0, len = textLines.length; i < len; i++) {
if (textLines[i] !== '') {
this._setSVGTextLineText(textLines[i], i, textSpans, lineHeight, lineTopOffsetMultiplier, textBgRects);
lineTopOffsetMultiplier = 1;
}
else {
lineTopOffsetMultiplier++;
}
if (!this.textBackgroundColor || !this._boundaries) continue;
this._setSVGTextLineBg(textBgRects, i, textLeftOffset, lineHeight);
}
return {
textSpans: textSpans,
textBgRects: textBgRects
};
},
_setSVGTextLineText: function(textLine, i, textSpans, lineHeight, lineTopOffsetMultiplier) {
var lineLeftOffset = (this._boundaries && this._boundaries[i])
? toFixed(this._boundaries[i].left, 2)
: 0;
textSpans.push(
'<tspan x="',
lineLeftOffset, '" ',
(i === 0 || this.useNative ? 'y' : 'dy'), '="',
toFixed(this.useNative
? ((lineHeight * i) - this.height / 2)
: (lineHeight * lineTopOffsetMultiplier), 2) , '" ',
this._getFillAttributes(this.fill), '>',
fabric.util.string.escapeXml(textLine),
'</tspan>'
);
},
_setSVGTextLineBg: function(textBgRects, i, textLeftOffset, lineHeight) {
textBgRects.push(
'<rect ',
this._getFillAttributes(this.textBackgroundColor),
' x="',
toFixed(textLeftOffset + this._boundaries[i].left, 2),
'" y="',
/* an offset that seems to straighten things out */
toFixed((lineHeight * i) - this.height / 2, 2),
'" width="',
toFixed(this._boundaries[i].width, 2),
'" height="',
toFixed(this._boundaries[i].height, 2),
'"></rect>');
},
_setSVGBg: function(textBgRects) {
if (this.backgroundColor && this._boundaries) {
textBgRects.push(
'<rect ',
this._getFillAttributes(this.backgroundColor),
' x="',
toFixed(-this.width / 2, 2),
'" y="',
toFixed(-this.height / 2, 2),
'" width="',
toFixed(this.width, 2),
'" height="',
toFixed(this.height, 2),
'"></rect>');
}
},
/**
* Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values
* we work around it by "moving" alpha channel into opacity attribute and setting fill's alpha to 1
*
* @private
* @param {Any} value
* @return {String}
*/
_getFillAttributes: function(value) {
var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';
if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {
return 'fill="' + value + '"';
}
return 'opacity="' + fillColor.getAlpha() + '" fill="' + fillColor.setAlpha(1).toRgb() + '"';
},
/* _TO_SVG_END_ */
/**
* Sets specified property to a specified value
* @param {String} key
* @param {Any} value
* @return {fabric.Text} thisArg
* @chainable
*/
_set: function(key, value) {
if (key === 'fontFamily' && this.path) {
this.path = this.path.replace(/(.*?)([^\/]*)(\.font\.js)/, '$1' + value + '$3');
}
this.callSuper('_set', key, value);
if (key in this._dimensionAffectingProps) {
this._initDimensions();
this.setCoords();
}
},
/**
* Returns complexity of an instance
* @return {Number} complexity
*/
complexity: function() {
return 1;
}
});
/* _FROM_SVG_START_ */
/**
* List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})
* @static
* @memberOf fabric.Text
* @see: http://www.w3.org/TR/SVG/text.html#TextElement
*/
fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(
'x y font-family font-style font-weight font-size text-decoration'.split(' '));
/**
* Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)
* @static
* @memberOf fabric.Text
* @param {SVGElement} element Element to parse
* @param {Object} [options] Options object
* @return {fabric.Text} Instance of fabric.Text
*/
fabric.Text.fromElement = function(element, options) {
if (!element) {
return null;
}
var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES);
options = fabric.util.object.extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes);
var text = new fabric.Text(element.textContent, options);
/*
Adjust positioning:
x/y attributes in SVG correspond to the bottom-left corner of text bounding box
top/left properties in Fabric correspond to center point of text bounding box
*/
text.set({
left: text.getLeft() + text.getWidth() / 2,
top: text.getTop() - text.getHeight() / 2
});
return text;
};
/* _FROM_SVG_END_ */
/**
* Returns fabric.Text instance from an object representation
* @static
* @memberOf fabric.Text
* @param object {Object} object Object to create an instance from
* @return {fabric.Text} Instance of fabric.Text
*/
fabric.Text.fromObject = function(object) {
return new fabric.Text(object.text, clone(object));
};
fabric.util.createAccessors(fabric.Text);
})(typeof exports !== 'undefined' ? exports : this);
(function() {
var clone = fabric.util.object.clone;
/**
* IText class (introduced in <b>v1.4</b>)
* @class fabric.IText
* @extends fabric.Text
* @mixes fabric.Observable
*
* @fires text:changed
* @fires editing:entered
* @fires editing:exited
*
* @return {fabric.IText} thisArg
* @see {@link fabric.IText#initialize} for constructor definition
*
* <p>Supported key combinations:</p>
* <pre>
*   Move cursor:                    left, right, up, down
*   Select character:               shift + left, shift + right
*   Select text vertically:         shift + up, shift + down
*   Move cursor by word:            alt + left, alt + right
*   Select words:                   shift + alt + left, shift + alt + right
*   Move cursor to line start/end:  cmd + left, cmd + right
*   Select till start/end of line:  cmd + shift + left, cmd + shift + right
*   Jump to start/end of text:      cmd + up, cmd + down
*   Select till start/end of text:  cmd + shift + up, cmd + shift + down
*   Delete character:               backspace
*   Delete word:                    alt + backspace
*   Delete line:                    cmd + backspace
*   Forward delete:                 delete
*   Copy text:                      ctrl/cmd + c
*   Paste text:                     ctrl/cmd + v
*   Cut text:                       ctrl/cmd + x
* </pre>
*
* <p>Supported mouse/touch combination</p>
* <pre>
*   Position cursor:                click/touch
*   Create selection:               click/touch & drag
*   Create selection:               click & shift + click
*   Select word:                    double click
*   Select line:                    triple click
* </pre>
*/
fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {
/**
* Type of an object
* @type String
* @default
*/
type: 'i-text',
/**
* Index where text selection starts (or where cursor is when there is no selection)
* @type Nubmer
* @default
*/
selectionStart: 0,
/**
* Index where text selection ends
* @type Nubmer
* @default
*/
selectionEnd: 0,
/**
* Color of text selection
* @type String
* @default
*/
selectionColor: 'rgba(17,119,255,0.3)',
/**
* Indicates whether text is in editing mode
* @type Boolean
* @default
*/
isEditing: false,
/**
* Indicates whether a text can be edited
* @type Boolean
* @default
*/
editable: true,
/**
* Border color of text object while it's in editing mode
* @type String
* @default
*/
editingBorderColor: 'rgba(102,153,255,0.25)',
/**
* Width of cursor (in px)
* @type Number
* @default
*/
cursorWidth: 2,
/**
* Color of default cursor (when not overwritten by character style)
* @type String
* @default
*/
cursorColor: '#333',
/**
* Delay between cursor blink (in ms)
* @type Number
* @default
*/
cursorDelay: 1000,
/**
* Duration of cursor fadein (in ms)
* @type Number
* @default
*/
cursorDuration: 600,
/**
* Object containing character styles
* (where top-level properties corresponds to line number and 2nd-level properties -- to char number in a line)
* @type Object
* @default
*/
styles: null,
/**
* Indicates whether internal text char widths can be cached
* @type Boolean
* @default
*/
caching: true,
/**
* @private
* @type Boolean
* @default
*/
_skipFillStrokeCheck: true,
/**
* @private
*/
_reSpace: /\s|\n/,
/**
* @private
*/
_fontSizeFraction: 4,
/**
* @private
*/
_currentCursorOpacity: 0,
/**
* @private
*/
_selectionDirection: null,
/**
* @private
*/
_abortCursorAnimation: false,
/**
* @private
*/
_charWidthsCache: { },
/**
* Constructor
* @param {String} text Text string
* @param {Object} [options] Options object
* @return {fabric.IText} thisArg
*/
initialize: function(text, options) {
this.styles = options ? (options.styles || { }) : { };
this.callSuper('initialize', text, options);
this.initBehavior();
fabric.IText.instances.push(this);
this.__lineWidths = { };
this.__lineHeights = { };
this.__lineOffsets = { };
},
/**
* Returns true if object has no styling
*/
isEmptyStyles: function() {
if (!this.styles) return true;
var obj = this.styles;
for (var p1 in obj) {
for (var p2 in obj[p1]) {
/*jshint unused:false */
for (var p3 in obj[p1][p2]) {
return false;
}
}
}
return true;
},
/**
* Sets selection start (left boundary of a selection)
* @param {Number} index Index to set selection start to
*/
setSelectionStart: function(index) {
this.selectionStart = index;
this.hiddenTextarea && (this.hiddenTextarea.selectionStart = index);
},
/**
* Sets selection end (right boundary of a selection)
* @param {Number} index Index to set selection end to
*/
setSelectionEnd: function(index) {
this.selectionEnd = index;
this.hiddenTextarea && (this.hiddenTextarea.selectionEnd = index);
},
/**
* Gets style of a current selection/cursor (at the start position)
* @param {Number} [startIndex] Start index to get styles at
* @param {Number} [endIndex] End index to get styles at
* @return {Object} styles Style object at a specified (or current) index
*/
getSelectionStyles: function(startIndex, endIndex) {
if (arguments.length === 2) {
var styles = [ ];
for (var i = startIndex; i < endIndex; i++) {
styles.push(this.getSelectionStyles(i));
}
return styles;
}
var loc = this.get2DCursorLocation(startIndex);
if (this.styles[loc.lineIndex]) {
return this.styles[loc.lineIndex][loc.charIndex] || { };
}
return { };
},
/**
* Sets style of a current selection
* @param {Object} [styles] Styles object
* @return {fabric.IText} thisArg
* @chainable
*/
setSelectionStyles: function(styles) {
if (this.selectionStart === this.selectionEnd) {
this._extendStyles(this.selectionStart, styles);
}
else {
for (var i = this.selectionStart; i < this.selectionEnd; i++) {
this._extendStyles(i, styles);
}
}
return this;
},
/**
* @private
*/
_extendStyles: function(index, styles) {
var loc = this.get2DCursorLocation(index);
if (!this.styles[loc.lineIndex]) {
this.styles[loc.lineIndex] = { };
}
if (!this.styles[loc.lineIndex][loc.charIndex]) {
this.styles[loc.lineIndex][loc.charIndex] = { };
}
fabric.util.object.extend(this.styles[loc.lineIndex][loc.charIndex], styles);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_render: function(ctx) {
this.callSuper('_render', ctx);
this.ctx = ctx;
this.isEditing && this.renderCursorOrSelection();
},
/**
* Renders cursor or selection (depending on what exists)
*/
renderCursorOrSelection: function() {
if (!this.active) return;
var chars = this.text.split(''),
boundaries;
if (this.selectionStart === this.selectionEnd) {
boundaries = this._getCursorBoundaries(chars, 'cursor');
this.renderCursor(boundaries);
}
else {
boundaries = this._getCursorBoundaries(chars, 'selection');
this.renderSelection(chars, boundaries);
}
},
/**
* Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)
* @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.
*/
get2DCursorLocation: function(selectionStart) {
if (typeof selectionStart === 'undefined') {
selectionStart = this.selectionStart;
}
var textBeforeCursor = this.text.slice(0, selectionStart);
var linesBeforeCursor = textBeforeCursor.split(this._reNewline);
return {
lineIndex: linesBeforeCursor.length - 1,
charIndex: linesBeforeCursor[linesBeforeCursor.length - 1].length
};
},
/**
* Returns fontSize of char at the current cursor
* @param {Number} lineIndex Line index
* @param {Number} charIndex Char index
* @return {Number} Character font size
*/
getCurrentCharFontSize: function(lineIndex, charIndex) {
return (
this.styles[lineIndex] &&
this.styles[lineIndex][charIndex === 0 ? 0 : (charIndex - 1)] &&
this.styles[lineIndex][charIndex === 0 ? 0 : (charIndex - 1)].fontSize) || this.fontSize;
},
/**
* Returns color (fill) of char at the current cursor
* @param {Number} lineIndex Line index
* @param {Number} charIndex Char index
* @return {String} Character color (fill)
*/
getCurrentCharColor: function(lineIndex, charIndex) {
return (
this.styles[lineIndex] &&
this.styles[lineIndex][charIndex === 0 ? 0 : (charIndex - 1)] &&
this.styles[lineIndex][charIndex === 0 ? 0 : (charIndex - 1)].fill) || this.cursorColor;
},
/**
* Returns cursor boundaries (left, top, leftOffset, topOffset)
* @private
* @param {Array} chars Array of characters
* @param {String} typeOfBoundaries
*/
_getCursorBoundaries: function(chars, typeOfBoundaries) {
var cursorLocation = this.get2DCursorLocation(),
textLines = this.text.split(this._reNewline),
left = Math.round(this._getLeftOffset()),
top = -this.height / 2,
offsets = this._getCursorBoundariesOffsets(
chars, typeOfBoundaries, cursorLocation, textLines);
return {
left: left,
top: top,
leftOffset: offsets.left + offsets.lineLeft,
topOffset: offsets.top
};
},
/**
* @private
*/
_getCursorBoundariesOffsets: function(chars, typeOfBoundaries, cursorLocation, textLines) {
var lineLeftOffset = 0,
lineIndex = 0,
charIndex = 0,
leftOffset = 0,
topOffset = typeOfBoundaries === 'cursor'
? (this._getHeightOfLine(this.ctx, 0) -
this.getCurrentCharFontSize(cursorLocation.lineIndex, cursorLocation.charIndex))
: 0;
for (var i = 0; i < this.selectionStart; i++) {
if (chars[i] === '\n') {
leftOffset = 0;
var index = lineIndex + (typeOfBoundaries === 'cursor' ? 1 : 0);
topOffset += this._getCachedLineHeight(index);
lineIndex++;
charIndex = 0;
}
else {
leftOffset += this._getWidthOfChar(this.ctx, chars[i], lineIndex, charIndex);
charIndex++;
}
lineLeftOffset = this._getCachedLineOffset(lineIndex, textLines);
}
this._clearCache();
return {
top: topOffset,
left: leftOffset,
lineLeft: lineLeftOffset
};
},
/**
* @private
*/
_clearCache: function() {
this.__lineWidths = { };
this.__lineHeights = { };
this.__lineOffsets = { };
},
/**
* @private
*/
_getCachedLineHeight: function(index) {
return this.__lineHeights[index] ||
(this.__lineHeights[index] = this._getHeightOfLine(this.ctx, index));
},
/**
* @private
*/
_getCachedLineWidth: function(lineIndex, textLines) {
return this.__lineWidths[lineIndex] ||
(this.__lineWidths[lineIndex] = this._getWidthOfLine(this.ctx, lineIndex, textLines));
},
/**
* @private
*/
_getCachedLineOffset: function(lineIndex, textLines) {
var widthOfLine = this._getCachedLineWidth(lineIndex, textLines);
return this.__lineOffsets[lineIndex] ||
(this.__lineOffsets[lineIndex] = this._getLineLeftOffset(widthOfLine));
},
/**
* Renders cursor
* @param {Object} boundaries
*/
renderCursor: function(boundaries) {
var ctx = this.ctx;
ctx.save();
var cursorLocation = this.get2DCursorLocation(),
lineIndex = cursorLocation.lineIndex,
charIndex = cursorLocation.charIndex,
charHeight = this.getCurrentCharFontSize(lineIndex, charIndex);
ctx.fillStyle = this.getCurrentCharColor(lineIndex, charIndex);
ctx.globalAlpha = this._currentCursorOpacity;
ctx.fillRect(
boundaries.left + boundaries.leftOffset,
boundaries.top + boundaries.topOffset,
this.cursorWidth / this.scaleX,
charHeight);
ctx.restore();
},
/**
* Renders text selection
* @param {Array} chars Array of characters
* @param {Object} boundaries Object with left/top/leftOffset/topOffset
*/
renderSelection: function(chars, boundaries) {
var ctx = this.ctx;
ctx.save();
ctx.fillStyle = this.selectionColor;
var cursorLocation = this.get2DCursorLocation(),
lineIndex = cursorLocation.lineIndex,
charIndex = cursorLocation.charIndex,
textLines = this.text.split(this._reNewline),
origLineIndex = lineIndex;
for (var i = this.selectionStart; i < this.selectionEnd; i++) {
if (chars[i] === '\n') {
boundaries.leftOffset = 0;
boundaries.topOffset += this._getHeightOfLine(ctx, lineIndex);
lineIndex++;
charIndex = 0;
}
else if (i !== this.text.length) {
var charWidth = this._getWidthOfChar(ctx, chars[i], lineIndex, charIndex),
lineOffset = this._getLineLeftOffset(this._getWidthOfLine(ctx, lineIndex, textLines)) || 0;
if (lineIndex === origLineIndex) {
lineOffset = 0;
}
ctx.fillRect(
boundaries.left + boundaries.leftOffset + lineOffset,
boundaries.top + boundaries.topOffset,
charWidth,
this._getHeightOfLine(ctx, lineIndex));
boundaries.leftOffset += charWidth;
charIndex++;
}
}
ctx.restore();
},
/**
* @private
* @param {String} method
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderChars: function(method, ctx, line, left, top, lineIndex) {
if (this.isEmptyStyles()) {
return this._renderCharsFast(method, ctx, line, left, top);
}
this.skipTextAlign = true;
left -= this.textAlign === 'center'
? (this.width / 2)
: (this.textAlign === 'right')
? this.width
: 0;
var textLines = this.text.split(this._reNewline),
lineWidth = this._getWidthOfLine(ctx, lineIndex, textLines),
lineHeight = this._getHeightOfLine(ctx, lineIndex, textLines),
lineLeftOffset = this._getLineLeftOffset(lineWidth),
chars = line.split('');
left += lineLeftOffset || 0;
ctx.save();
for (var i = 0, len = chars.length; i < len; i++) {
this._renderChar(method, ctx, lineIndex, i, chars[i], left, top, lineHeight);
}
ctx.restore();
},
/**
* @private
* @param {String} method
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {String} line
*/
_renderCharsFast: function(method, ctx, line, left, top) {
this.skipTextAlign = false;
if (method === 'fillText' && this.fill) {
this.callSuper('_renderChars', method, ctx, line, left, top);
}
if (method === 'strokeText' && this.stroke) {
this.callSuper('_renderChars', method, ctx, line, left, top);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderChar: function(method, ctx, lineIndex, i, _char, left, top, lineHeight) {
var decl, charWidth, charHeight;
if (this.styles && this.styles[lineIndex] && (decl = this.styles[lineIndex][i])) {
var shouldStroke = decl.stroke || this.stroke,
shouldFill = decl.fill || this.fill;
ctx.save();
charWidth = this._applyCharStylesGetWidth(ctx, _char, lineIndex, i, decl);
charHeight = this._getHeightOfChar(ctx, _char, lineIndex, i);
if (shouldFill) {
ctx.fillText(_char, left, top);
}
if (shouldStroke) {
ctx.strokeText(_char, left, top);
}
this._renderCharDecoration(ctx, decl, left, top, charWidth, lineHeight, charHeight);
ctx.restore();
ctx.translate(charWidth, 0);
}
else {
if (method === 'strokeText' && this.stroke) {
ctx[method](_char, left, top);
}
if (method === 'fillText' && this.fill) {
ctx[method](_char, left, top);
}
charWidth = this._applyCharStylesGetWidth(ctx, _char, lineIndex, i);
this._renderCharDecoration(ctx, null, left, top, charWidth, lineHeight);
ctx.translate(ctx.measureText(_char).width, 0);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderCharDecoration: function(ctx, styleDeclaration, left, top, charWidth, lineHeight, charHeight) {
var textDecoration = styleDeclaration
? (styleDeclaration.textDecoration || this.textDecoration)
: this.textDecoration;
var fontSize = (styleDeclaration ? styleDeclaration.fontSize : null) || this.fontSize;
if (!textDecoration) return;
if (textDecoration.indexOf('underline') > -1) {
this._renderCharDecorationAtOffset(
ctx,
left,
top + (this.fontSize / this._fontSizeFraction),
charWidth,
0,
this.fontSize / 20
);
}
if (textDecoration.indexOf('line-through') > -1) {
this._renderCharDecorationAtOffset(
ctx,
left,
top + (this.fontSize / this._fontSizeFraction),
charWidth,
charHeight / 2,
fontSize / 20
);
}
if (textDecoration.indexOf('overline') > -1) {
this._renderCharDecorationAtOffset(
ctx,
left,
top,
charWidth,
lineHeight - (this.fontSize / this._fontSizeFraction),
this.fontSize / 20
);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_renderCharDecorationAtOffset: function(ctx, left, top, charWidth, offset, thickness) {
ctx.fillRect(left, top - offset, charWidth, thickness);
},
/**
* @private
* @param {String} method
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {String} line
*/
_renderTextLine: function(method, ctx, line, left, top, lineIndex) {
top += this.fontSize / 4;
this.callSuper('_renderTextLine', method, ctx, line, left, top, lineIndex);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines
*/
_renderTextDecoration: function(ctx, textLines) {
if (this.isEmptyStyles()) {
return this.callSuper('_renderTextDecoration', ctx, textLines);
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {Array} textLines Array of all text lines
*/
_renderTextLinesBackground: function(ctx, textLines) {
if (!this.textBackgroundColor && !this.styles) return;
ctx.save();
if (this.textBackgroundColor) {
ctx.fillStyle = this.textBackgroundColor;
}
var lineHeights = 0,
fractionOfFontSize = this.fontSize / this._fontSizeFraction;
for (var i = 0, len = textLines.length; i < len; i++) {
var heightOfLine = this._getHeightOfLine(ctx, i, textLines);
if (textLines[i] === '') {
lineHeights += heightOfLine;
continue;
}
var lineWidth = this._getWidthOfLine(ctx, i, textLines),
lineLeftOffset = this._getLineLeftOffset(lineWidth);
if (this.textBackgroundColor) {
ctx.fillStyle = this.textBackgroundColor;
ctx.fillRect(
this._getLeftOffset() + lineLeftOffset,
this._getTopOffset() + lineHeights + fractionOfFontSize,
lineWidth,
heightOfLine
);
}
if (this.styles[i]) {
for (var j = 0, jlen = textLines[i].length; j < jlen; j++) {
if (this.styles[i] && this.styles[i][j] && this.styles[i][j].textBackgroundColor) {
var _char = textLines[i][j];
ctx.fillStyle = this.styles[i][j].textBackgroundColor;
ctx.fillRect(
this._getLeftOffset() + lineLeftOffset + this._getWidthOfCharsAt(ctx, i, j, textLines),
this._getTopOffset() + lineHeights + fractionOfFontSize,
this._getWidthOfChar(ctx, _char, i, j, textLines) + 1,
heightOfLine
);
}
}
}
lineHeights += heightOfLine;
}
ctx.restore();
},
/**
* @private
*/
_getCacheProp: function(_char, styleDeclaration) {
return _char +
styleDeclaration.fontFamily +
styleDeclaration.fontSize +
styleDeclaration.fontWeight +
styleDeclaration.fontStyle +
styleDeclaration.shadow;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
* @param {String} _char
* @param {Number} lineIndex
* @param {Number} charIndex
* @param {Object} [decl]
*/
_applyCharStylesGetWidth: function(ctx, _char, lineIndex, charIndex, decl) {
var styleDeclaration = decl ||
(this.styles[lineIndex] &&
this.styles[lineIndex][charIndex]);
if (styleDeclaration) {
styleDeclaration = clone(styleDeclaration);
}
else {
styleDeclaration = { };
}
this._applyFontStyles(styleDeclaration);
var cacheProp = this._getCacheProp(_char, styleDeclaration);
if (this.isEmptyStyles() && this._charWidthsCache[cacheProp] && this.caching) {
return this._charWidthsCache[cacheProp];
}
if (typeof styleDeclaration.shadow === 'string') {
styleDeclaration.shadow = new fabric.Shadow(styleDeclaration.shadow);
}
var fill = styleDeclaration.fill || this.fill;
ctx.fillStyle = fill.toLive
? fill.toLive(ctx)
: fill;
if (styleDeclaration.stroke) {
ctx.strokeStyle = (styleDeclaration.stroke && styleDeclaration.stroke.toLive)
? styleDeclaration.stroke.toLive(ctx)
: styleDeclaration.stroke;
}
ctx.lineWidth = styleDeclaration.strokeWidth || this.strokeWidth;
ctx.font = this._getFontDeclaration.call(styleDeclaration);
this._setShadow.call(styleDeclaration, ctx);
if (!this.caching) {
return ctx.measureText(_char).width;
}
if (!this._charWidthsCache[cacheProp]) {
this._charWidthsCache[cacheProp] = ctx.measureText(_char).width;
}
return this._charWidthsCache[cacheProp];
},
/**
* @private
* @param {Object} styleDeclaration
*/
_applyFontStyles: function(styleDeclaration) {
if (!styleDeclaration.fontFamily) {
styleDeclaration.fontFamily = this.fontFamily;
}
if (!styleDeclaration.fontSize) {
styleDeclaration.fontSize = this.fontSize;
}
if (!styleDeclaration.fontWeight) {
styleDeclaration.fontWeight = this.fontWeight;
}
if (!styleDeclaration.fontStyle) {
styleDeclaration.fontStyle = this.fontStyle;
}
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getWidthOfChar: function(ctx, _char, lineIndex, charIndex) {
ctx.save();
var width = this._applyCharStylesGetWidth(ctx, _char, lineIndex, charIndex);
ctx.restore();
return width;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getHeightOfChar: function(ctx, _char, lineIndex, charIndex) {
if (this.styles[lineIndex] && this.styles[lineIndex][charIndex]) {
return this.styles[lineIndex][charIndex].fontSize || this.fontSize;
}
return this.fontSize;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getWidthOfCharAt: function(ctx, lineIndex, charIndex, lines) {
lines = lines || this.text.split(this._reNewline);
var _char = lines[lineIndex].split('')[charIndex];
return this._getWidthOfChar(ctx, _char, lineIndex, charIndex);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getHeightOfCharAt: function(ctx, lineIndex, charIndex, lines) {
lines = lines || this.text.split(this._reNewline);
var _char = lines[lineIndex].split('')[charIndex];
return this._getHeightOfChar(ctx, _char, lineIndex, charIndex);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getWidthOfCharsAt: function(ctx, lineIndex, charIndex, lines) {
var width = 0;
for (var i = 0; i < charIndex; i++) {
width += this._getWidthOfCharAt(ctx, lineIndex, i, lines);
}
return width;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getWidthOfLine: function(ctx, lineIndex, textLines) {
return this._getWidthOfCharsAt(ctx, lineIndex, textLines[lineIndex].length, textLines);
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getTextWidth: function(ctx, textLines) {
if (this.isEmptyStyles()) {
return this.callSuper('_getTextWidth', ctx, textLines);
}
var maxWidth = this._getWidthOfLine(ctx, 0, textLines);
for (var i = 1, len = textLines.length; i < len; i++) {
var currentLineWidth = this._getWidthOfLine(ctx, i, textLines);
if (currentLineWidth > maxWidth) {
maxWidth = currentLineWidth;
}
}
return maxWidth;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getHeightOfLine: function(ctx, lineIndex, textLines) {
textLines = textLines || this.text.split(this._reNewline);
var maxHeight = this._getHeightOfChar(ctx, textLines[lineIndex][0], lineIndex, 0);
var line = textLines[lineIndex];
var chars = line.split('');
for (var i = 1, len = chars.length; i < len; i++) {
var currentCharHeight = this._getHeightOfChar(ctx, chars[i], lineIndex, i);
if (currentCharHeight > maxHeight) {
maxHeight = currentCharHeight;
}
}
return maxHeight * this.lineHeight;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getTextHeight: function(ctx, textLines) {
var height = 0;
for (var i = 0, len = textLines.length; i < len; i++) {
height += this._getHeightOfLine(ctx, i, textLines);
}
return height;
},
/**
* @private
* @param {CanvasRenderingContext2D} ctx Context to render on
*/
_getTopOffset: function() {
var topOffset = fabric.Text.prototype._getTopOffset.call(this);
return topOffset - (this.fontSize / this._fontSizeFraction);
},
/**
* Returns object representation of an instance
* @methd toObject
* @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
* @return {Object} object representation of an instance
*/
toObject: function(propertiesToInclude) {
return fabric.util.object.extend(this.callSuper('toObject', propertiesToInclude), {
styles: clone(this.styles)
});
}
});
/**
* Returns fabric.IText instance from an object representation
* @static
* @memberOf fabric.IText
* @param {Object} object Object to create an instance from
* @return {fabric.IText} instance of fabric.IText
*/
fabric.IText.fromObject = function(object) {
return new fabric.IText(object.text, clone(object));
};
fabric.IText.instances = [ ];
})();
(function() {
var clone = fabric.util.object.clone;
fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {
/**
* Initializes all the interactive behavior of IText
*/
initBehavior: function() {
this.initKeyHandlers();
this.initCursorSelectionHandlers();
this.initDoubleClickSimulation();
this.initHiddenTextarea();
},
/**
* Initializes "selected" event handler
*/
initSelectedHandler: function() {
this.on('selected', function() {
var _this = this;
setTimeout(function() {
_this.selected = true;
}, 100);
if (!this._hasCanvasHandlers) {
this._initCanvasHandlers();
this._hasCanvasHandlers = true;
}
});
},
/**
* @private
*/
_initCanvasHandlers: function() {
var _this = this;
this.canvas.on('selection:cleared', function(options) {
if (options.e && _this.canvas.containsPoint(options.e, _this)) return;
_this.exitEditing();
});
this.canvas.on('mouse:up', function() {
this.getObjects('i-text').forEach(function(obj) {
obj.__isMousedown = false;
});
});
},
/**
* @private
*/
_tick: function() {
var _this = this;
if (this._abortCursorAnimation) return;
this.animate('_currentCursorOpacity', 1, {
duration: this.cursorDuration,
onComplete: function() {
_this._onTickComplete();
},
onChange: function() {
_this.canvas && _this.canvas.renderAll();
},
abort: function() {
return _this._abortCursorAnimation;
}
});
},
/**
* @private
*/
_onTickComplete: function() {
if (this._abortCursorAnimation) return;
var _this = this;
if (this._cursorTimeout1) {
clearTimeout(this._cursorTimeout1);
}
this._cursorTimeout1 = setTimeout(function() {
_this.animate('_currentCursorOpacity', 0, {
duration: this.cursorDuration / 2,
onComplete: function() {
_this._tick();
},
onChange: function() {
_this.canvas && _this.canvas.renderAll();
},
abort: function() {
return _this._abortCursorAnimation;
}
});
}, 100);
},
/**
* Initializes delayed cursor
*/
initDelayedCursor: function() {
var _this = this;
if (this._cursorTimeout2) {
clearTimeout(this._cursorTimeout2);
}
this._cursorTimeout2 = setTimeout(function() {
_this._abortCursorAnimation = false;
_this._tick();
}, this.cursorDelay);
},
/**
* Aborts cursor animation and clears all timeouts
*/
abortCursorAnimation: function() {
this._abortCursorAnimation = true;
clearTimeout(this._cursorTimeout1);
clearTimeout(this._cursorTimeout2);
this._currentCursorOpacity = 0;
this.canvas && this.canvas.renderAll();
var _this = this;
setTimeout(function() {
_this._abortCursorAnimation = false;
}, 10);
},
/**
* Selects entire text
*/
selectAll: function() {
this.selectionStart = 0;
this.selectionEnd = this.text.length;
},
/**
* Returns selected text
* @return {String}
*/
getSelectedText: function() {
return this.text.slice(this.selectionStart, this.selectionEnd);
},
/**
* Find new selection index representing start of current word according to current selection index
* @param {Number} startFrom Surrent selection index
* @return {Number} New selection index
*/
findWordBoundaryLeft: function(startFrom) {
var offset = 0, index = startFrom - 1;
if (this._reSpace.test(this.text.charAt(index))) {
while (this._reSpace.test(this.text.charAt(index))) {
offset++;
index--;
}
}
while (/\S/.test(this.text.charAt(index)) && index > -1) {
offset++;
index--;
}
return startFrom - offset;
},
/**
* Find new selection index representing end of current word according to current selection index
* @param {Number} startFrom Current selection index
* @return {Number} New selection index
*/
findWordBoundaryRight: function(startFrom) {
var offset = 0, index = startFrom;
if (this._reSpace.test(this.text.charAt(index))) {
while (this._reSpace.test(this.text.charAt(index))) {
offset++;
index++;
}
}
while (/\S/.test(this.text.charAt(index)) && index < this.text.length) {
offset++;
index++;
}
return startFrom + offset;
},
/**
* Find new selection index representing start of current line according to current selection index
* @param {Number} current selection index
*/
findLineBoundaryLeft: function(startFrom) {
var offset = 0, index = startFrom - 1;
while (!/\n/.test(this.text.charAt(index)) && index > -1) {
offset++;
index--;
}
return startFrom - offset;
},
/**
* Find new selection index representing end of current line according to current selection index
* @param {Number} current selection index
*/
findLineBoundaryRight: function(startFrom) {
var offset = 0, index = startFrom;
while (!/\n/.test(this.text.charAt(index)) && index < this.text.length) {
offset++;
index++;
}
return startFrom + offset;
},
/**
* Returns number of newlines in selected text
* @return {Number} Number of newlines in selected text
*/
getNumNewLinesInSelectedText: function() {
var selectedText = this.getSelectedText();
var numNewLines = 0;
for (var i = 0, chars = selectedText.split(''), len = chars.length; i < len; i++) {
if (chars[i] === '\n') {
numNewLines++;
}
}
return numNewLines;
},
/**
* Finds index corresponding to beginning or end of a word
* @param {Number} selectionStart Index of a character
* @param {Number} direction: 1 or -1
*/
searchWordBoundary: function(selectionStart, direction) {
var index = selectionStart;
var _char = this.text.charAt(index);
var reNonWord = /[ \n\.,;!\?\-]/;
while (!reNonWord.test(_char) && index > 0 && index < this.text.length) {
index += direction;
_char = this.text.charAt(index);
}
if (reNonWord.test(_char) && _char !== '\n') {
index += direction === 1 ? 0 : 1;
}
return index;
},
/**
* Selects a word based on the index
* @param {Number} selectionStart Index of a character
*/
selectWord: function(selectionStart) {
var newSelectionStart = this.searchWordBoundary(selectionStart, -1); /* search backwards */
var newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */
this.setSelectionStart(newSelectionStart);
this.setSelectionEnd(newSelectionEnd);
},
/**
* Selects a line based on the index
* @param {Number} selectionStart Index of a character
*/
selectLine: function(selectionStart) {
var newSelectionStart = this.findLineBoundaryLeft(selectionStart);
var newSelectionEnd = this.findLineBoundaryRight(selectionStart);
this.setSelectionStart(newSelectionStart);
this.setSelectionEnd(newSelectionEnd);
},
/**
* Enters editing state
* @return {fabric.IText} thisArg
* @chainable
*/
enterEditing: function() {
if (this.isEditing || !this.editable) return;
this.exitEditingOnOthers();
this.isEditing = true;
this._updateTextarea();
this._saveEditingProps();
this._setEditingProps();
this._tick();
this.canvas && this.canvas.renderAll();
this.fire('editing:entered');
return this;
},
exitEditingOnOthers: function() {
fabric.IText.instances.forEach(function(obj) {
if (obj === this) return;
obj.exitEditing();
}, this);
},
/**
* @private
*/
_setEditingProps: function() {
this.hoverCursor = 'text';
if (this.canvas) {
this.canvas.defaultCursor = this.canvas.moveCursor = 'text';
}
this.borderColor = this.editingBorderColor;
this.hasControls = this.selectable = false;
this.lockMovementX = this.lockMovementY = true;
},
/**
* @private
*/
_updateTextarea: function() {
if (!this.hiddenTextarea) return;
this.hiddenTextarea.value = this.text;
this.hiddenTextarea.selectionStart = this.selectionStart;
this.hiddenTextarea.focus();
},
/**
* @private
*/
_saveEditingProps: function() {
this._savedProps = {
hasControls: this.hasControls,
borderColor: this.borderColor,
lockMovementX: this.lockMovementX,
lockMovementY: this.lockMovementY,
hoverCursor: this.hoverCursor,
defaultCursor: this.canvas && this.canvas.defaultCursor,
moveCursor: this.canvas && this.canvas.moveCursor
};
},
/**
* @private
*/
_restoreEditingProps: function() {
if (!this._savedProps) return;
this.hoverCursor = this._savedProps.overCursor;
this.hasControls = this._savedProps.hasControls;
this.borderColor = this._savedProps.borderColor;
this.lockMovementX = this._savedProps.lockMovementX;
this.lockMovementY = this._savedProps.lockMovementY;
if (this.canvas) {
this.canvas.defaultCursor = this._savedProps.defaultCursor;
this.canvas.moveCursor = this._savedProps.moveCursor;
}
},
/**
* Exits from editing state
* @return {fabric.IText} thisArg
* @chainable
*/
exitEditing: function() {
this.selected = false;
this.isEditing = false;
this.selectable = true;
this.selectionEnd = this.selectionStart;
this.hiddenTextarea && this.hiddenTextarea.blur();
this.abortCursorAnimation();
this._restoreEditingProps();
this._currentCursorOpacity = 0;
this.fire('editing:exited');
return this;
},
/**
* @private
*/
_removeExtraneousStyles: function() {
var textLines = this.text.split(this._reNewline);
for (var prop in this.styles) {
if (!textLines[prop]) {
delete this.styles[prop];
}
}
},
/**
* @private
*/
_removeCharsFromTo: function(start, end) {
var i = end;
while (i !== start) {
var prevIndex = this.get2DCursorLocation(i).charIndex;
i--;
var index = this.get2DCursorLocation(i).charIndex;
var isNewline = index > prevIndex;
if (isNewline) {
this.removeStyleObject(isNewline, i + 1);
}
else {
this.removeStyleObject(this.get2DCursorLocation(i).charIndex === 0, i);
}
}
this.text = this.text.slice(0, start) +
this.text.slice(end);
},
/**
* Inserts a character where cursor is (replacing selection if one exists)
* @param {String} _chars Characters to insert
*/
insertChars: function(_chars) {
var isEndOfLine = this.text.slice(this.selectionStart, this.selectionStart + 1) === '\n';
this.text = this.text.slice(0, this.selectionStart) +
_chars +
this.text.slice(this.selectionEnd);
if (this.selectionStart === this.selectionEnd) {
this.insertStyleObjects(_chars, isEndOfLine, this.copiedStyles);
}
else if (this.selectionEnd - this.selectionStart > 1) {
console.log('replacing MORE than 1 char');
}
this.selectionStart += _chars.length;
this.selectionEnd = this.selectionStart;
if (this.canvas) {
this.canvas.renderAll().renderAll();
}
this.setCoords();
this.fire('text:changed');
},
/**
* Inserts new style object
* @param {Number} lineIndex Index of a line
* @param {Number} charIndex Index of a char
* @param {Boolean} isEndOfLine True if it's end of line
*/
insertNewlineStyleObject: function(lineIndex, charIndex, isEndOfLine) {
this.shiftLineStyles(lineIndex, +1);
if (!this.styles[lineIndex + 1]) {
this.styles[lineIndex + 1] = { };
}
var currentCharStyle = this.styles[lineIndex][charIndex - 1],
newLineStyles = { };
if (isEndOfLine) {
newLineStyles[0] = clone(currentCharStyle);
this.styles[lineIndex + 1] = newLineStyles;
}
else {
for (var index in this.styles[lineIndex]) {
if (parseInt(index, 10) >= charIndex) {
newLineStyles[parseInt(index, 10) - charIndex] = this.styles[lineIndex][index];
delete this.styles[lineIndex][index];
}
}
this.styles[lineIndex + 1] = newLineStyles;
}
},
/**
* Inserts style object for a given line/char index
* @param {Number} lineIndex Index of a line
* @param {Number} charIndex Index of a char
* @param {Object} [style] Style object to insert, if given
*/
insertCharStyleObject: function(lineIndex, charIndex, style) {
var currentLineStyles = this.styles[lineIndex],
currentLineStylesCloned = clone(currentLineStyles);
if (charIndex === 0 && !style) {
charIndex = 1;
}
for (var index in currentLineStylesCloned) {
var numericIndex = parseInt(index, 10);
if (numericIndex >= charIndex) {
currentLineStyles[numericIndex + 1] = currentLineStylesCloned[numericIndex];
}
}
this.styles[lineIndex][charIndex] =
style || clone(currentLineStyles[charIndex - 1]);
},
/**
* Inserts style object(s)
* @param {String} _chars Characters at the location where style is inserted
* @param {Boolean} isEndOfLine True if it's end of line
* @param {Array} [styles] Styles to insert
*/
insertStyleObjects: function(_chars, isEndOfLine, styles) {
if (this.isEmptyStyles()) return;
var cursorLocation = this.get2DCursorLocation(),
lineIndex = cursorLocation.lineIndex,
charIndex = cursorLocation.charIndex;
if (!this.styles[lineIndex]) {
this.styles[lineIndex] = { };
}
if (_chars === '\n') {
this.insertNewlineStyleObject(lineIndex, charIndex, isEndOfLine);
}
else {
if (styles) {
this._insertStyles(styles);
}
else {
this.insertCharStyleObject(lineIndex, charIndex);
}
}
},
/**
* @private
*/
_insertStyles: function(styles) {
for (var i = 0, len = styles.length; i < len; i++) {
var cursorLocation = this.get2DCursorLocation(this.selectionStart + i),
lineIndex = cursorLocation.lineIndex,
charIndex = cursorLocation.charIndex;
this.insertCharStyleObject(lineIndex, charIndex, styles[i]);
}
},
/**
* Shifts line styles up or down
* @param {Number} lineIndex Index of a line
* @param {Number} offset Can be -1 or +1
*/
shiftLineStyles: function(lineIndex, offset) {
var clonedStyles = clone(this.styles);
for (var line in this.styles) {
var numericLine = parseInt(line, 10);
if (numericLine > lineIndex) {
this.styles[numericLine + offset] = clonedStyles[numericLine];
}
}
},
/**
* Removes style object
* @param {Boolean} isBeginningOfLine True if cursor is at the beginning of line
* @param {Number} [index] Optional index. When not given, current selectionStart is used.
*/
removeStyleObject: function(isBeginningOfLine, index) {
var cursorLocation = this.get2DCursorLocation(index),
lineIndex = cursorLocation.lineIndex,
charIndex = cursorLocation.charIndex;
if (isBeginningOfLine) {
var textLines = this.text.split(this._reNewline),
textOnPreviousLine = textLines[lineIndex - 1],
newCharIndexOnPrevLine = textOnPreviousLine.length;
if (!this.styles[lineIndex - 1]) {
this.styles[lineIndex - 1] = { };
}
for (charIndex in this.styles[lineIndex]) {
this.styles[lineIndex - 1][parseInt(charIndex, 10) + newCharIndexOnPrevLine]
= this.styles[lineIndex][charIndex];
}
this.shiftLineStyles(lineIndex, -1);
}
else {
var currentLineStyles = this.styles[lineIndex];
if (currentLineStyles) {
var offset = this.selectionStart === this.selectionEnd ? -1 : 0;
delete currentLineStyles[charIndex + offset];
}
var currentLineStylesCloned = clone(currentLineStyles);
for (var i in currentLineStylesCloned) {
var numericIndex = parseInt(i, 10);
if (numericIndex >= charIndex && numericIndex !== 0) {
currentLineStyles[numericIndex - 1] = currentLineStylesCloned[numericIndex];
delete currentLineStyles[numericIndex];
}
}
}
},
/**
* Inserts new line
*/
insertNewline: function() {
this.insertChars('\n');
}
});
})();
fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {
/**
* Initializes "dbclick" event handler
*/
initDoubleClickSimulation: function() {
this.__lastClickTime = +new Date();
this.__lastLastClickTime = +new Date();
this.lastPointer = { };
this.on('mousedown', this.onMouseDown.bind(this));
},
onMouseDown: function(options) {
this.__newClickTime = +new Date();
var newPointer = this.canvas.getPointer(options.e);
if (this.isTripleClick(newPointer)) {
this.fire('tripleclick', options);
this._stopEvent(options.e);
}
else if (this.isDoubleClick(newPointer)) {
this.fire('dblclick', options);
this._stopEvent(options.e);
}
this.__lastLastClickTime = this.__lastClickTime;
this.__lastClickTime = this.__newClickTime;
this.__lastPointer = newPointer;
},
isDoubleClick: function(newPointer) {
return this.__newClickTime - this.__lastClickTime < 500 &&
this.__lastPointer.x === newPointer.x &&
this.__lastPointer.y === newPointer.y;
},
isTripleClick: function(newPointer) {
return this.__newClickTime - this.__lastClickTime < 500 &&
this.__lastClickTime - this.__lastLastClickTime < 500 &&
this.__lastPointer.x === newPointer.x &&
this.__lastPointer.y === newPointer.y;
},
/**
* @private
*/
_stopEvent: function(e) {
e.preventDefault && e.preventDefault();
e.stopPropagation && e.stopPropagation();
},
/**
* Initializes event handlers related to cursor or selection
*/
initCursorSelectionHandlers: function() {
this.initSelectedHandler();
this.initMousedownHandler();
this.initMousemoveHandler();
this.initMouseupHandler();
this.initClicks();
},
/**
* Initializes double and triple click event handlers
*/
initClicks: function() {
this.on('dblclick', function(options) {
this.selectWord(this.getSelectionStartFromPointer(options.e));
});
this.on('tripleclick', function(options) {
this.selectLine(this.getSelectionStartFromPointer(options.e));
});
},
/**
* Initializes "mousedown" event handler
*/
initMousedownHandler: function() {
this.on('mousedown', function(options) {
var pointer = this.canvas.getPointer(options.e);
this.__mousedownX = pointer.x;
this.__mousedownY = pointer.y;
this.__isMousedown = true;
if (this.hiddenTextarea && this.canvas) {
this.canvas.wrapperEl.appendChild(this.hiddenTextarea);
}
if (this.isEditing) {
this.setCursorByClick(options.e);
this.__selectionStartOnMouseDown = this.selectionStart;
}
else {
this.exitEditingOnOthers();
}
});
},
/**
* Initializes "mousemove" event handler
*/
initMousemoveHandler: function() {
this.on('mousemove', function(options) {
if (!this.__isMousedown || !this.isEditing) return;
var newSelectionStart = this.getSelectionStartFromPointer(options.e);
if (newSelectionStart >= this.__selectionStartOnMouseDown) {
this.setSelectionStart(this.__selectionStartOnMouseDown);
this.setSelectionEnd(newSelectionStart);
}
else {
this.setSelectionStart(newSelectionStart);
this.setSelectionEnd(this.__selectionStartOnMouseDown);
}
});
},
/**
* @private
*/
_isObjectMoved: function(e) {
var pointer = this.canvas.getPointer(e);
return this.__mousedownX !== pointer.x ||
this.__mousedownY !== pointer.y;
},
/**
* Initializes "mouseup" event handler
*/
initMouseupHandler: function() {
this.on('mouseup', function(options) {
this.__isMousedown = false;
if (this._isObjectMoved(options.e)) return;
if (this.selected) {
this.enterEditing();
}
});
},
/**
* Changes cursor location in a text depending on passed pointer (x/y) object
* @param {Object} pointer Pointer object with x and y numeric properties
*/
setCursorByClick: function(e) {
var newSelectionStart = this.getSelectionStartFromPointer(e);
if (e.shiftKey) {
if (newSelectionStart < this.selectionStart) {
this.setSelectionEnd(this.selectionStart);
this.setSelectionStart(newSelectionStart);
}
else {
this.setSelectionEnd(newSelectionStart);
}
}
else {
this.setSelectionStart(newSelectionStart);
this.setSelectionEnd(newSelectionStart);
}
},
/**
* @private
* @param {Event} e Event object
* @param {Object} Object with x/y corresponding to local offset (according to object rotation)
*/
_getLocalRotatedPointer: function(e) {
var pointer = this.canvas.getPointer(e),
pClicked = new fabric.Point(pointer.x, pointer.y),
pLeftTop = new fabric.Point(this.left, this.top),
rotated = fabric.util.rotatePoint(
pClicked, pLeftTop, fabric.util.degreesToRadians(-this.angle));
return this.getLocalPointer(e, rotated);
},
/**
* Returns index of a character corresponding to where an object was clicked
* @param {Event} e Event object
* @return {Number} Index of a character
*/
getSelectionStartFromPointer: function(e) {
var mouseOffset = this._getLocalRotatedPointer(e),
textLines = this.text.split(this._reNewline),
prevWidth = 0,
width = 0,
height = 0,
charIndex = 0,
newSelectionStart;
for (var i = 0, len = textLines.length; i < len; i++) {
height += this._getHeightOfLine(this.ctx, i) * this.scaleY;
var widthOfLine = this._getWidthOfLine(this.ctx, i, textLines);
var lineLeftOffset = this._getLineLeftOffset(widthOfLine);
width = lineLeftOffset;
if (this.flipX) {
textLines[i] = textLines[i].split('').reverse().join('');
}
for (var j = 0, jlen = textLines[i].length; j < jlen; j++) {
var _char = textLines[i][j];
prevWidth = width;
width += this._getWidthOfChar(this.ctx, _char, i, this.flipX ? jlen - j : j) *
this.scaleX;
if (height <= mouseOffset.y || width <= mouseOffset.x) {
charIndex++;
continue;
}
return this._getNewSelectionStartFromOffset(
mouseOffset, prevWidth, width, charIndex + i, jlen);
}
}
if (typeof newSelectionStart === 'undefined') {
return this.text.length;
}
},
/**
* @private
*/
_getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {
var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,
distanceBtwNextCharAndCursor = width - mouseOffset.x,
offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ? 0 : 1,
newSelectionStart = index + offset;
if (this.flipX) {
newSelectionStart = jlen - newSelectionStart;
}
if (newSelectionStart > this.text.length) {
newSelectionStart = this.text.length;
}
return newSelectionStart;
}
});
fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {
/**
* Initializes key handlers
*/
initKeyHandlers: function() {
fabric.util.addListener(fabric.document, 'keydown', this.onKeyDown.bind(this));
fabric.util.addListener(fabric.document, 'keypress', this.onKeyPress.bind(this));
},
/**
* Initializes hidden textarea (needed to bring up keyboard in iOS)
*/
initHiddenTextarea: function() {
this.hiddenTextarea = fabric.document.createElement('textarea');
this.hiddenTextarea.setAttribute('autocapitalize', 'off');
this.hiddenTextarea.style.cssText = 'position: absolute; top: 0; left: -9999px';
fabric.document.body.appendChild(this.hiddenTextarea);
},
/**
* @private
*/
_keysMap: {
8:  'removeChars',
13: 'insertNewline',
37: 'moveCursorLeft',
38: 'moveCursorUp',
39: 'moveCursorRight',
40: 'moveCursorDown',
46: 'forwardDelete'
},
/**
* @private
*/
_ctrlKeysMap: {
65: 'selectAll',
67: 'copy',
86: 'paste',
88: 'cut'
},
/**
* Handles keyup event
* @param {Event} e Event object
*/
onKeyDown: function(e) {
if (!this.isEditing) return;
if (e.keyCode in this._keysMap) {
this[this._keysMap[e.keyCode]](e);
}
else if ((e.keyCode in this._ctrlKeysMap) && (e.ctrlKey || e.metaKey)) {
this[this._ctrlKeysMap[e.keyCode]](e);
}
else {
return;
}
e.preventDefault();
e.stopPropagation();
this.canvas && this.canvas.renderAll();
},
/**
* Forward delete
*/
forwardDelete: function(e) {
if (this.selectionStart === this.selectionEnd) {
this.moveCursorRight(e);
}
this.removeChars(e);
},
/**
* Copies selected text
*/
copy: function() {
var selectedText = this.getSelectedText();
this.copiedText = selectedText;
this.copiedStyles = this.getSelectionStyles(
this.selectionStart,
this.selectionEnd);
},
/**
* Pastes text
*/
paste: function() {
if (this.copiedText) {
this.insertChars(this.copiedText);
}
},
/**
* Cuts text
*/
cut: function(e) {
this.copy();
this.removeChars(e);
},
/**
* Handles keypress event
* @param {Event} e Event object
*/
onKeyPress: function(e) {
if (!this.isEditing || e.metaKey || e.ctrlKey || e.keyCode === 8 || e.keyCode === 13) {
return;
}
this.insertChars(String.fromCharCode(e.which));
e.preventDefault();
e.stopPropagation();
},
/**
* Gets start offset of a selection
* @return {Number}
*/
getDownCursorOffset: function(e, isRight) {
var selectionProp = isRight ? this.selectionEnd : this.selectionStart,
textLines = this.text.split(this._reNewline),
_char,
lineLeftOffset,
textBeforeCursor = this.text.slice(0, selectionProp),
textAfterCursor = this.text.slice(selectionProp),
textOnSameLineBeforeCursor = textBeforeCursor.slice(textBeforeCursor.lastIndexOf('\n') + 1),
textOnSameLineAfterCursor = textAfterCursor.match(/(.*)\n?/)[1],
textOnNextLine = (textAfterCursor.match(/.*\n(.*)\n?/) || { })[1] || '',
cursorLocation = this.get2DCursorLocation(selectionProp);
if (cursorLocation.lineIndex === textLines.length - 1 || e.metaKey) {
return this.text.length - selectionProp;
}
var widthOfSameLineBeforeCursor = this._getWidthOfLine(this.ctx, cursorLocation.lineIndex, textLines);
lineLeftOffset = this._getLineLeftOffset(widthOfSameLineBeforeCursor);
var widthOfCharsOnSameLineBeforeCursor = lineLeftOffset;
var lineIndex = cursorLocation.lineIndex;
for (var i = 0, len = textOnSameLineBeforeCursor.length; i < len; i++) {
_char = textOnSameLineBeforeCursor[i];
widthOfCharsOnSameLineBeforeCursor += this._getWidthOfChar(this.ctx, _char, lineIndex, i);
}
var indexOnNextLine = this._getIndexOnNextLine(
cursorLocation, textOnNextLine, widthOfCharsOnSameLineBeforeCursor, textLines);
return textOnSameLineAfterCursor.length + 1 + indexOnNextLine;
},
/**
* @private
*/
_getIndexOnNextLine: function(cursorLocation, textOnNextLine, widthOfCharsOnSameLineBeforeCursor, textLines) {
var lineIndex = cursorLocation.lineIndex + 1;
var widthOfNextLine = this._getWidthOfLine(this.ctx, lineIndex, textLines);
var lineLeftOffset = this._getLineLeftOffset(widthOfNextLine);
var widthOfCharsOnNextLine = lineLeftOffset;
var indexOnNextLine = 0;
var foundMatch;
for (var j = 0, jlen = textOnNextLine.length; j < jlen; j++) {
var _char = textOnNextLine[j];
var widthOfChar = this._getWidthOfChar(this.ctx, _char, lineIndex, j);
widthOfCharsOnNextLine += widthOfChar;
if (widthOfCharsOnNextLine > widthOfCharsOnSameLineBeforeCursor) {
foundMatch = true;
var leftEdge = widthOfCharsOnNextLine - widthOfChar;
var rightEdge = widthOfCharsOnNextLine;
var offsetFromLeftEdge = Math.abs(leftEdge - widthOfCharsOnSameLineBeforeCursor);
var offsetFromRightEdge = Math.abs(rightEdge - widthOfCharsOnSameLineBeforeCursor);
indexOnNextLine = offsetFromRightEdge < offsetFromLeftEdge ? j + 1 : j;
break;
}
}
if (!foundMatch) {
indexOnNextLine = textOnNextLine.length;
}
return indexOnNextLine;
},
/**
* Moves cursor down
* @param {Event} e Event object
*/
moveCursorDown: function(e) {
this.abortCursorAnimation();
this._currentCursorOpacity = 1;
var offset = this.getDownCursorOffset(e, this._selectionDirection === 'right');
if (e.shiftKey) {
this.moveCursorDownWithShift(offset);
}
else {
this.moveCursorDownWithoutShift(offset);
}
this.initDelayedCursor();
},
/**
* Moves cursor down without keeping selection
* @param {Number} offset
*/
moveCursorDownWithoutShift: function(offset) {
this._selectionDirection = 'right';
this.selectionStart += offset;
if (this.selectionStart > this.text.length) {
this.selectionStart = this.text.length;
}
this.selectionEnd = this.selectionStart;
},
/**
* Moves cursor down while keeping selection
* @param {Number} offset
*/
moveCursorDownWithShift: function(offset) {
if (this._selectionDirection === 'left' && (this.selectionStart !== this.selectionEnd)) {
this.selectionStart += offset;
this._selectionDirection = 'left';
return;
}
else {
this._selectionDirection = 'right';
this.selectionEnd += offset;
if (this.selectionEnd > this.text.length) {
this.selectionEnd = this.text.length;
}
}
},
getUpCursorOffset: function(e, isRight) {
var selectionProp = isRight ? this.selectionEnd : this.selectionStart,
cursorLocation = this.get2DCursorLocation(selectionProp);
if (cursorLocation.lineIndex === 0 || e.metaKey) {
return selectionProp;
}
var textBeforeCursor = this.text.slice(0, selectionProp),
textOnSameLineBeforeCursor = textBeforeCursor.slice(textBeforeCursor.lastIndexOf('\n') + 1),
textOnPreviousLine = (textBeforeCursor.match(/\n?(.*)\n.*$/) || {})[1] || '',
textLines = this.text.split(this._reNewline),
_char,
lineLeftOffset;
var widthOfSameLineBeforeCursor = this._getWidthOfLine(this.ctx, cursorLocation.lineIndex, textLines);
lineLeftOffset = this._getLineLeftOffset(widthOfSameLineBeforeCursor);
var widthOfCharsOnSameLineBeforeCursor = lineLeftOffset;
var lineIndex = cursorLocation.lineIndex;
for (var i = 0, len = textOnSameLineBeforeCursor.length; i < len; i++) {
_char = textOnSameLineBeforeCursor[i];
widthOfCharsOnSameLineBeforeCursor += this._getWidthOfChar(this.ctx, _char, lineIndex, i);
}
var indexOnPrevLine = this._getIndexOnPrevLine(
cursorLocation, textOnPreviousLine, widthOfCharsOnSameLineBeforeCursor, textLines);
return textOnPreviousLine.length - indexOnPrevLine + textOnSameLineBeforeCursor.length;
},
/**
* @private
*/
_getIndexOnPrevLine: function(cursorLocation, textOnPreviousLine, widthOfCharsOnSameLineBeforeCursor, textLines) {
var lineIndex = cursorLocation.lineIndex - 1;
var widthOfPreviousLine = this._getWidthOfLine(this.ctx, lineIndex, textLines);
var lineLeftOffset = this._getLineLeftOffset(widthOfPreviousLine);
var widthOfCharsOnPreviousLine = lineLeftOffset;
var indexOnPrevLine = 0;
var foundMatch;
for (var j = 0, jlen = textOnPreviousLine.length; j < jlen; j++) {
var _char = textOnPreviousLine[j];
var widthOfChar = this._getWidthOfChar(this.ctx, _char, lineIndex, j);
widthOfCharsOnPreviousLine += widthOfChar;
if (widthOfCharsOnPreviousLine > widthOfCharsOnSameLineBeforeCursor) {
foundMatch = true;
var leftEdge = widthOfCharsOnPreviousLine - widthOfChar;
var rightEdge = widthOfCharsOnPreviousLine;
var offsetFromLeftEdge = Math.abs(leftEdge - widthOfCharsOnSameLineBeforeCursor);
var offsetFromRightEdge = Math.abs(rightEdge - widthOfCharsOnSameLineBeforeCursor);
indexOnPrevLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);
break;
}
}
if (!foundMatch) {
indexOnPrevLine = textOnPreviousLine.length - 1;
}
return indexOnPrevLine;
},
/**
* Moves cursor up
* @param {Event} e Event object
*/
moveCursorUp: function(e) {
this.abortCursorAnimation();
this._currentCursorOpacity = 1;
var offset = this.getUpCursorOffset(e, this._selectionDirection === 'right');
if (e.shiftKey) {
this.moveCursorUpWithShift(offset);
}
else {
this.moveCursorUpWithoutShift(offset);
}
this.initDelayedCursor();
},
/**
* Moves cursor up with shift
* @param {Number} offset
*/
moveCursorUpWithShift: function(offset) {
if (this.selectionStart === this.selectionEnd) {
this.selectionStart -= offset;
}
else {
if (this._selectionDirection === 'right') {
this.selectionEnd -= offset;
this._selectionDirection = 'right';
return;
}
else {
this.selectionStart -= offset;
}
}
if (this.selectionStart < 0) {
this.selectionStart = 0;
}
this._selectionDirection = 'left';
},
/**
* Moves cursor up without shift
* @param {Number} offset
*/
moveCursorUpWithoutShift: function(offset) {
if (this.selectionStart === this.selectionEnd) {
this.selectionStart -= offset;
}
if (this.selectionStart < 0) {
this.selectionStart = 0;
}
this.selectionEnd = this.selectionStart;
this._selectionDirection = 'left';
},
/**
* Moves cursor left
* @param {Event} e Event object
*/
moveCursorLeft: function(e) {
if (this.selectionStart === 0 && this.selectionEnd === 0) return;
this.abortCursorAnimation();
this._currentCursorOpacity = 1;
if (e.shiftKey) {
this.moveCursorLeftWithShift(e);
}
else {
this.moveCursorLeftWithoutShift(e);
}
this.initDelayedCursor();
},
/**
* @private
*/
_move: function(e, prop, direction) {
if (e.altKey) {
this[prop] = this['findWordBoundary' + direction](this[prop]);
}
else if (e.metaKey) {
this[prop] = this['findLineBoundary' + direction](this[prop]);
}
else {
this[prop] += (direction === 'Left' ? -1 : 1);
}
},
/**
* @private
*/
_moveLeft: function(e, prop) {
this._move(e, prop, 'Left');
},
/**
* @private
*/
_moveRight: function(e, prop) {
this._move(e, prop, 'Right');
},
/**
* Moves cursor left without keeping selection
* @param {Event} e
*/
moveCursorLeftWithoutShift: function(e) {
this._selectionDirection = 'left';
if (this.selectionEnd === this.selectionStart) {
this._moveLeft(e, 'selectionStart');
}
this.selectionEnd = this.selectionStart;
},
/**
* Moves cursor left while keeping selection
* @param {Event} e
*/
moveCursorLeftWithShift: function(e) {
if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {
this._moveLeft(e, 'selectionEnd');
}
else {
this._selectionDirection = 'left';
this._moveLeft(e, 'selectionStart');
if (this.text.charAt(this.selectionStart) === '\n') {
this.selectionStart--;
}
if (this.selectionStart < 0) {
this.selectionStart = 0;
}
}
},
/**
* Moves cursor right
* @param {Event} e Event object
*/
moveCursorRight: function(e) {
if (this.selectionStart >= this.text.length && this.selectionEnd >= this.text.length) return;
this.abortCursorAnimation();
this._currentCursorOpacity = 1;
if (e.shiftKey) {
this.moveCursorRightWithShift(e);
}
else {
this.moveCursorRightWithoutShift(e);
}
this.initDelayedCursor();
},
/**
* Moves cursor right while keeping selection
* @param {Event} e
*/
moveCursorRightWithShift: function(e) {
if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {
this._moveRight(e, 'selectionStart');
}
else {
this._selectionDirection = 'right';
this._moveRight(e, 'selectionEnd');
if (this.text.charAt(this.selectionEnd - 1) === '\n') {
this.selectionEnd++;
}
if (this.selectionEnd > this.text.length) {
this.selectionEnd = this.text.length;
}
}
},
/**
* Moves cursor right without keeping selection
* @param {Event} e
*/
moveCursorRightWithoutShift: function(e) {
this._selectionDirection = 'right';
if (this.selectionStart === this.selectionEnd) {
this._moveRight(e, 'selectionStart');
this.selectionEnd = this.selectionStart;
}
else {
this.selectionEnd += this.getNumNewLinesInSelectedText();
if (this.selectionEnd > this.text.length) {
this.selectionEnd = this.text.length;
}
this.selectionStart = this.selectionEnd;
}
},
/**
* Inserts a character where cursor is (replacing selection if one exists)
*/
removeChars: function(e) {
if (this.selectionStart === this.selectionEnd) {
this._removeCharsNearCursor(e);
}
else {
this._removeCharsFromTo(this.selectionStart, this.selectionEnd);
}
this.selectionEnd = this.selectionStart;
this._removeExtraneousStyles();
if (this.canvas) {
this.canvas.renderAll().renderAll();
}
this.setCoords();
this.fire('text:changed');
},
/**
* @private
*/
_removeCharsNearCursor: function(e) {
if (this.selectionStart !== 0) {
if (e.metaKey) {
var leftLineBoundary = this.findLineBoundaryLeft(this.selectionStart);
this._removeCharsFromTo(leftLineBoundary, this.selectionStart);
this.selectionStart = leftLineBoundary;
}
else if (e.altKey) {
var leftWordBoundary = this.findWordBoundaryLeft(this.selectionStart);
this._removeCharsFromTo(leftWordBoundary, this.selectionStart);
this.selectionStart = leftWordBoundary;
}
else {
var isBeginningOfLine = this.text.slice(this.selectionStart-1, this.selectionStart) === '\n';
this.removeStyleObject(isBeginningOfLine);
this.selectionStart--;
this.text = this.text.slice(0, this.selectionStart) +
this.text.slice(this.selectionStart + 1);
}
}
}
});
/* _TO_SVG_START_ */
fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {
/**
* @private
*/
_setSVGTextLineText: function(textLine, lineIndex, textSpans, lineHeight, lineTopOffsetMultiplier, textBgRects) {
if (!this.styles[lineIndex]) {
this.callSuper('_setSVGTextLineText',
textLine, lineIndex, textSpans, lineHeight, lineTopOffsetMultiplier);
}
else {
this._setSVGTextLineChars(
textLine, lineIndex, textSpans, lineHeight, lineTopOffsetMultiplier, textBgRects);
}
},
/**
* @private
*/
_setSVGTextLineChars: function(textLine, lineIndex, textSpans, lineHeight, lineTopOffsetMultiplier, textBgRects) {
var yProp = lineIndex === 0 || this.useNative ? 'y' : 'dy',
chars = textLine.split(''),
charOffset = 0,
lineLeftOffset = this._getSVGLineLeftOffset(lineIndex),
lineTopOffset = this._getSVGLineTopOffset(lineIndex),
heightOfLine = this._getHeightOfLine(this.ctx, lineIndex);
for (var i = 0, len = chars.length; i < len; i++) {
var styleDecl = this.styles[lineIndex][i] || { };
textSpans.push(
this._createTextCharSpan(
chars[i], styleDecl, lineLeftOffset, lineTopOffset, yProp, charOffset));
var charWidth = this._getWidthOfChar(this.ctx, chars[i], lineIndex, i);
if (styleDecl.textBackgroundColor) {
textBgRects.push(
this._createTextCharBg(
styleDecl, lineLeftOffset, lineTopOffset, heightOfLine, charWidth, charOffset));
}
charOffset += charWidth;
}
},
/**
* @private
*/
_getSVGLineLeftOffset: function(lineIndex) {
return (this._boundaries && this._boundaries[lineIndex])
? fabric.util.toFixed(this._boundaries[lineIndex].left, 2)
: 0;
},
/**
* @private
*/
_getSVGLineTopOffset: function(lineIndex) {
var lineTopOffset = 0;
for (var j = 0; j <= lineIndex; j++) {
lineTopOffset += this._getHeightOfLine(this.ctx, j);
}
return lineTopOffset - this.height / 2;
},
/**
* @private
*/
_createTextCharBg: function(styleDecl, lineLeftOffset, lineTopOffset, heightOfLine, charWidth, charOffset) {
return [
'<rect fill="', styleDecl.textBackgroundColor,
'" transform="translate(',
-this.width / 2, ' ',
-this.height + heightOfLine, ')',
'" x="', lineLeftOffset + charOffset,
'" y="', lineTopOffset + heightOfLine,
'" width="', charWidth,
'" height="', heightOfLine,
'"></rect>'
].join('');
},
/**
* @private
*/
_createTextCharSpan: function(_char, styleDecl, lineLeftOffset, lineTopOffset, yProp, charOffset) {
var fillStyles = this.getSvgStyles.call(fabric.util.object.extend({
visible: true,
fill: this.fill,
stroke: this.stroke,
type: 'text'
}, styleDecl));
return [
'<tspan x="', lineLeftOffset + charOffset, '" ',
yProp, '="', lineTopOffset, '" ',
(styleDecl.fontFamily ? 'font-family="' + styleDecl.fontFamily.replace(/"/g,'\'') + '" ': ''),
(styleDecl.fontSize ? 'font-size="' + styleDecl.fontSize + '" ': ''),
(styleDecl.fontStyle ? 'font-style="' + styleDecl.fontStyle + '" ': ''),
(styleDecl.fontWeight ? 'font-weight="' + styleDecl.fontWeight + '" ': ''),
(styleDecl.textDecoration ? 'text-decoration="' + styleDecl.textDecoration + '" ': ''),
'style="', fillStyles, '">',
fabric.util.string.escapeXml(_char),
'</tspan>'
].join('');
}
});
/* _TO_SVG_END_ */
(function() {
if (typeof document !== 'undefined' && typeof window !== 'undefined') {
return;
}
var DOMParser = new require('xmldom').DOMParser,
URL = require('url'),
HTTP = require('http'),
HTTPS = require('https'),
Canvas = require('canvas'),
Image = require('canvas').Image;
/** @private */
function request(url, encoding, callback) {
var oURL = URL.parse(url);
if ( !oURL.port ) {
oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;
}
var reqHandler = ( oURL.port === 443 ) ? HTTPS : HTTP;
var req = reqHandler.request({
hostname: oURL.hostname,
port: oURL.port,
path: oURL.path,
method: 'GET'
}, function(response){
var body = "";
if (encoding) {
response.setEncoding(encoding);
}
response.on('end', function () {
callback(body);
});
response.on('data', function (chunk) {
if (response.statusCode === 200) {
body += chunk;
}
});
});
req.on('error', function(err) {
if (err.errno === process.ECONNREFUSED) {
fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);
}
else {
fabric.log(err.message);
}
});
req.end();
}
/** @private */
function request_fs(path, callback){
var fs = require('fs');
fs.readFile(path, function (err, data) {
if (err) {
fabric.log(err);
throw err;
} else {
callback(data);
}
});
}
fabric.util.loadImage = function(url, callback, context) {
var createImageAndCallBack = function(data){
img.src = new Buffer(data, 'binary');
img._src = url;
callback && callback.call(context, img);
};
var img = new Image();
if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {
img.src = img._src = url;
callback && callback.call(context, img);
}
else if (url && url.indexOf('http') !== 0) {
request_fs(url, createImageAndCallBack);
}
else if (url) {
request(url, 'binary', createImageAndCallBack);
}
else {
callback && callback.call(context, url);
}
};
fabric.loadSVGFromURL = function(url, callback, reviver) {
url = url.replace(/^\n\s*/, '').replace(/\?.*$/, '').trim();
if (url.indexOf('http') !== 0) {
request_fs(url, function(body) {
fabric.loadSVGFromString(body, callback, reviver);
});
}
else {
request(url, '', function(body) {
fabric.loadSVGFromString(body, callback, reviver);
});
}
};
fabric.loadSVGFromString = function(string, callback, reviver) {
var doc = new DOMParser().parseFromString(string);
fabric.parseSVGDocument(doc.documentElement, function(results, options) {
callback && callback(results, options);
}, reviver);
};
fabric.util.getScript = function(url, callback) {
request(url, '', function(body) {
eval(body);
callback && callback();
});
};
fabric.Image.fromObject = function(object, callback) {
fabric.util.loadImage(object.src, function(img) {
var oImg = new fabric.Image(img);
oImg._initConfig(object);
oImg._initFilters(object, function(filters) {
oImg.filters = filters || [ ];
callback && callback(oImg);
});
});
};
/**
* Only available when running fabric on node.js
* @param width Canvas width
* @param height Canvas height
* @return {Object} wrapped canvas instance
*/
fabric.createCanvasForNode = function(width, height) {
var canvasEl = fabric.document.createElement('canvas'),
nodeCanvas = new Canvas(width || 600, height || 600);
canvasEl.style = { };
canvasEl.width = nodeCanvas.width;
canvasEl.height = nodeCanvas.height;
var FabricCanvas = fabric.Canvas || fabric.StaticCanvas;
var fabricCanvas = new FabricCanvas(canvasEl);
fabricCanvas.contextContainer = nodeCanvas.getContext('2d');
fabricCanvas.nodeCanvas = nodeCanvas;
fabricCanvas.Font = Canvas.Font;
return fabricCanvas;
};
/** @ignore */
fabric.StaticCanvas.prototype.createPNGStream = function() {
return this.nodeCanvas.createPNGStream();
};
fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {
return this.nodeCanvas.createJPEGStream(opts);
};
var origSetWidth = fabric.StaticCanvas.prototype.setWidth;
fabric.StaticCanvas.prototype.setWidth = function(width) {
origSetWidth.call(this, width);
this.nodeCanvas.width = width;
return this;
};
if (fabric.Canvas) {
fabric.Canvas.prototype.setWidth = fabric.StaticCanvas.prototype.setWidth;
}
var origSetHeight = fabric.StaticCanvas.prototype.setHeight;
fabric.StaticCanvas.prototype.setHeight = function(height) {
origSetHeight.call(this, height);
this.nodeCanvas.height = height;
return this;
};
if (fabric.Canvas) {
fabric.Canvas.prototype.setHeight = fabric.StaticCanvas.prototype.setHeight;
}
})();
(function(global) {
'use strict';
var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,
sqrt = Math.sqrt, abs = Math.abs, max = Math.max, round = Math.round, sin = Math.sin,
ceil = Math.ceil;
/**
* Resize image filter class
* @class fabric.Image.filters.Resize
* @memberOf fabric.Image.filters
* @extends fabric.Image.filters.BaseFilter
* @see {@link http://fabricjs.com/image-filters/|ImageFilters demo}
* @example
* var filter = new fabric.Image.filters.Resize();
* object.filters.push(filter);
* object.applyFilters(canvas.renderAll.bind(canvas));
*/
fabric.Image.filters.Resize = fabric.util.createClass(fabric.Image.filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {
/**
* Filter type
* @param {String} type
* @default
*/
type: 'Resize',
/**
* Resize type
* @param {String} resizeType
* @default
*/
resizeType: 'hermite',
/**
* Scale factor for resizing, x axis
* @param {Number} scaleX
* @default
*/
scaleX: 0,
/**
* Scale factor for resizing, y axis
* @param {Number} scaleY
* @default
*/
scaleY: 0,
/**
* LanczosLobes parameter for lanczos filter
* @param {Number} lanczosLobes
* @default
*/
lanczosLobes: 3,
/**
* Applies filter to canvas element
* @memberOf fabric.Image.filters.Resize.prototype
* @param {Object} canvasEl Canvas element to apply filter to
*/
applyTo: function(canvasEl, scaleX, scaleY) {
this.rcpScaleX = 1 / scaleX;
this.rcpScaleY = 1 / scaleY;
var oW = canvasEl.width, oH = canvasEl.height,
dW = round(oW * scaleX), dH = round(oH * scaleY),
imageData;
if (this.resizeType === 'sliceHack') {
imageData = this.sliceByTwo(canvasEl, oW, oH, dW, dH);
}
if (this.resizeType === 'hermite') {
imageData = this.hermiteFastResize(canvasEl, oW, oH, dW, dH);
}
if (this.resizeType === 'bilinear') {
imageData = this.bilinearFiltering(canvasEl, oW, oH, dW, dH);
}
if (this.resizeType === 'lanczos') {
imageData = this.lanczosResize(canvasEl, oW, oH, dW, dH);
}
canvasEl.width = dW;
canvasEl.height = dH;
canvasEl.getContext('2d').putImageData(imageData, 0, 0);
},
sliceByTwo: function(canvasEl, width, height, newWidth, newHeight) {
var context = canvasEl.getContext('2d'), imageData,
multW = 0.5, multH = 0.5, signW = 1, signH = 1,
doneW = false, doneH = false, stepW = width, stepH = height,
tmpCanvas = fabric.util.createCanvasElement(),
tmpCtx = tmpCanvas.getContext('2d');
newWidth = floor(newWidth);
newHeight = floor(newHeight);
tmpCanvas.width = max(newWidth, width);
tmpCanvas.height = max(newHeight, height);
if (newWidth > width) {
multW = 2;
signW = -1;
}
if (newHeight > height) {
multH = 2;
signH = -1;
}
imageData = context.getImageData(0, 0, width, height);
canvasEl.width = max(newWidth, width);
canvasEl.height = max(newHeight, height);
context.putImageData(imageData, 0, 0);
while (!doneW || !doneH) {
width = stepW;
height = stepH;
if (newWidth * signW < floor(stepW * multW * signW)) {
stepW = floor(stepW * multW);
}
else {
stepW = newWidth;
doneW = true;
}
if (newHeight * signH < floor(stepH * multH * signH)) {
stepH = floor(stepH * multH);
}
else {
stepH = newHeight;
doneH = true;
}
imageData = context.getImageData(0, 0, width, height);
tmpCtx.putImageData(imageData, 0, 0);
context.clearRect(0, 0, stepW, stepH);
context.drawImage(tmpCanvas, 0, 0, width, height, 0, 0, stepW, stepH);
}
return context.getImageData(0, 0, newWidth, newHeight);
},
lanczosResize: function(canvasEl, oW, oH, dW, dH) {
function lanczosCreate(lobes) {
return function(x) {
if (x > lobes) {
return 0;
}
x *= Math.PI;
if (abs(x) < 1e-16) {
return 1;
}
var xx = x / lobes;
return sin(x) * sin(xx) / x / xx;
};
}
function process(u) {
var v, i, weight, idx, a, red, green,
blue, alpha, fX, fY;
center.x = (u + 0.5) * ratioX;
icenter.x = floor(center.x);
for (v = 0; v < dH; v++) {
center.y = (v + 0.5) * ratioY;
icenter.y = floor(center.y);
a = 0, red = 0, green = 0, blue = 0, alpha = 0;
for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {
if (i < 0 || i >= oW) {
continue;
}
fX = floor(1000 * abs(i - center.x));
if (!cacheLanc[fX]) {
cacheLanc[fX] = { };
}
for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {
if (j < 0 || j >= oH) {
continue;
}
fY = floor(1000 * abs(j - center.y));
if (!cacheLanc[fX][fY]) {
cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);
}
weight = cacheLanc[fX][fY];
if (weight > 0) {
idx = (j * oW + i) * 4;
a += weight;
red += weight * srcData[idx];
green += weight * srcData[idx + 1];
blue += weight * srcData[idx + 2];
alpha += weight * srcData[idx + 3];
}
}
}
idx = (v * dW + u) * 4;
destData[idx] = red / a;
destData[idx + 1] = green / a;
destData[idx + 2] = blue / a;
destData[idx + 3] = alpha / a;
}
if (++u < dW) {
return process(u);
}
else {
return destImg;
}
}
var context = canvasEl.getContext('2d'),
srcImg = context.getImageData(0, 0, oW, oH),
destImg = context.getImageData(0, 0, dW, dH),
srcData = srcImg.data, destData = destImg.data,
lanczos = lanczosCreate(this.lanczosLobes),
ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,
rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,
range2X = ceil(ratioX * this.lanczosLobes / 2),
range2Y = ceil(ratioY * this.lanczosLobes / 2),
cacheLanc = { }, center = { }, icenter = { };
return process(0);
},
bilinearFiltering: function(canvasEl, w, h, w2, h2) {
var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,
color, offset = 0, origPix, ratioX = this.rcpScaleX,
ratioY = this.rcpScaleY, context = canvasEl.getContext('2d'),
w4 = 4 * (w - 1), img = context.getImageData(0, 0, w, h),
pixels = img.data, destImage = context.getImageData(0, 0, w2, h2),
destPixels = destImage.data;
for (i = 0; i < h2; i++) {
for (j = 0; j < w2; j++) {
x = floor(ratioX * j);
y = floor(ratioY * i);
xDiff = ratioX * j - x;
yDiff = ratioY * i - y;
origPix = 4 * (y * w + x);
for (chnl = 0; chnl < 4; chnl++) {
a = pixels[origPix + chnl];
b = pixels[origPix + 4 + chnl];
c = pixels[origPix + w4 + chnl];
d = pixels[origPix + w4 + 4 + chnl];
color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +
c * yDiff * (1 - xDiff) + d * xDiff * yDiff;
destPixels[offset++] = color;
}
}
}
return destImage;
},
hermiteFastResize: function(canvasEl, oW, oH, dW, dH) {
var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,
ratioWHalf = ceil(ratioW / 2),
ratioHHalf = ceil(ratioH / 2),
context = canvasEl.getContext('2d'),
img = context.getImageData(0, 0, oW, oH), data = img.data,
img2 = context.getImageData(0, 0, dW, dH), data2 = img2.data;
for (var j = 0; j < dH; j++) {
for (var i = 0; i < dW; i++) {
var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,
gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;
for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {
var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,
centerX = (i + 0.5) * ratioW, w0 = dy * dy;
for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {
var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,
w = sqrt(w0 + dx * dx);
/*jshint maxdepth:5 */
if (w > 1 && w < -1) {
continue;
}
weight = 2 * w * w * w - 3 * w * w + 1;
if (weight > 0) {
dx = 4 * (xx + yy * oW);
gxA += weight * data[dx + 3];
weightsAlpha += weight;
/*jshint maxdepth:6 */
if (data[dx + 3] < 255) {
weight = weight * data[dx + 3] / 250;
}
/*jshint maxdepth:5 */
gxR += weight * data[dx];
gxG += weight * data[dx + 1];
gxB += weight * data[dx + 2];
weights += weight;
}
/*jshint maxdepth:4 */
}
}
data2[x2] = gxR / weights;
data2[x2 + 1] = gxG / weights;
data2[x2 + 2] = gxB / weights;
data2[x2 + 3] = gxA / weightsAlpha;
}
}
return img2;
}
});
/**
* Returns filter instance from an object representation
* @static
* @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize
*/
fabric.Image.filters.Resize.fromObject = function() {
return new fabric.Image.filters.Resize();
};
})(typeof exports !== 'undefined' ? exports : this);
;
;
/*! TweenLite.min.js */ 
;
;
/*!
* VERSION: 1.16.1
* DATE: 2015-03-13
* UPDATES AND DOCS AT: http://greensock.com
*
* @license Copyright (c) 2008-2015, GreenSock. All rights reserved.
* This work is subject to the terms at http://greensock.com/standard-license or for
* Club GreenSock members, the software agreement that was issued with your membership.
* 
* @author: Jack Doyle, jack@greensock.com
*/
(function(t,e){"use strict";var i=t.GreenSockGlobals=t.GreenSockGlobals||t;if(!i.TweenLite){var s,r,n,a,o,l=function(t){var e,s=t.split("."),r=i;for(e=0;s.length>e;e++)r[s[e]]=r=r[s[e]]||{};return r},h=l("com.greensock"),_=1e-10,u=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},m=function(){},f=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e)}}(),c={},p=function(s,r,n,a){this.sc=c[s]?c[s].sc:[],c[s]=this,this.gsClass=null,this.func=n;var o=[];this.check=function(h){for(var _,u,m,f,d=r.length,v=d;--d>-1;)(_=c[r[d]]||new p(r[d],[])).gsClass?(o[d]=_.gsClass,v--):h&&_.sc.push(this);if(0===v&&n)for(u=("com.greensock."+s).split("."),m=u.pop(),f=l(u.join("."))[m]=this.gsClass=n.apply(n,o),a&&(i[m]=f,"function"==typeof define&&define.amd?define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+s.split(".").pop(),[],function(){return f}):s===e&&"undefined"!=typeof module&&module.exports&&(module.exports=f)),d=0;this.sc.length>d;d++)this.sc[d].check()},this.check(!0)},d=t._gsDefine=function(t,e,i,s){return new p(t,e,i,s)},v=h._class=function(t,e,i){return e=e||function(){},d(t,[],function(){return e},i),e};d.globals=i;var g=[0,0,1,1],T=[],y=v("easing.Ease",function(t,e,i,s){this._func=t,this._type=i||0,this._power=s||0,this._params=e?g.concat(e):g},!0),w=y.map={},P=y.register=function(t,e,i,s){for(var r,n,a,o,l=e.split(","),_=l.length,u=(i||"easeIn,easeOut,easeInOut").split(",");--_>-1;)for(n=l[_],r=s?v("easing."+n,null,!0):h.easing[n]||{},a=u.length;--a>-1;)o=u[a],w[n+"."+o]=w[o+n]=r[o]=t.getRatio?t:t[o]||new t};for(n=y.prototype,n._calcEnd=!1,n.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,s=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?s*=s:2===i?s*=s*s:3===i?s*=s*s*s:4===i&&(s*=s*s*s*s),1===e?1-s:2===e?s:.5>t?s/2:1-s/2},s=["Linear","Quad","Cubic","Quart","Quint,Strong"],r=s.length;--r>-1;)n=s[r]+",Power"+r,P(new y(null,null,1,r),n,"easeOut",!0),P(new y(null,null,2,r),n,"easeIn"+(0===r?",easeNone":"")),P(new y(null,null,3,r),n,"easeInOut");w.linear=h.easing.Linear.easeIn,w.swing=h.easing.Quad.easeInOut;var b=v("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});n=b.prototype,n.addEventListener=function(t,e,i,s,r){r=r||0;var n,l,h=this._listeners[t],_=0;for(null==h&&(this._listeners[t]=h=[]),l=h.length;--l>-1;)n=h[l],n.c===e&&n.s===i?h.splice(l,1):0===_&&r>n.pr&&(_=l+1);h.splice(_,0,{c:e,s:i,up:s,pr:r}),this!==a||o||a.wake()},n.removeEventListener=function(t,e){var i,s=this._listeners[t];if(s)for(i=s.length;--i>-1;)if(s[i].c===e)return s.splice(i,1),void 0},n.dispatchEvent=function(t){var e,i,s,r=this._listeners[t];if(r)for(e=r.length,i=this._eventTarget;--e>-1;)s=r[e],s&&(s.up?s.c.call(s.s||i,{type:t,target:i}):s.c.call(s.s||i))};var k=t.requestAnimationFrame,S=t.cancelAnimationFrame,A=Date.now||function(){return(new Date).getTime()},x=A();for(s=["ms","moz","webkit","o"],r=s.length;--r>-1&&!k;)k=t[s[r]+"RequestAnimationFrame"],S=t[s[r]+"CancelAnimationFrame"]||t[s[r]+"CancelRequestAnimationFrame"];v("Ticker",function(t,e){var i,s,r,n,l,h=this,u=A(),f=e!==!1&&k,c=500,p=33,d="tick",v=function(t){var e,a,o=A()-x;o>c&&(u+=o-p),x+=o,h.time=(x-u)/1e3,e=h.time-l,(!i||e>0||t===!0)&&(h.frame++,l+=e+(e>=n?.004:n-e),a=!0),t!==!0&&(r=s(v)),a&&h.dispatchEvent(d)};b.call(h),h.time=h.frame=0,h.tick=function(){v(!0)},h.lagSmoothing=function(t,e){c=t||1/_,p=Math.min(e,c,0)},h.sleep=function(){null!=r&&(f&&S?S(r):clearTimeout(r),s=m,r=null,h===a&&(o=!1))},h.wake=function(){null!==r?h.sleep():h.frame>10&&(x=A()-c+5),s=0===i?m:f&&k?k:function(t){return setTimeout(t,0|1e3*(l-h.time)+1)},h===a&&(o=!0),v(2)},h.fps=function(t){return arguments.length?(i=t,n=1/(i||60),l=this.time+n,h.wake(),void 0):i},h.useRAF=function(t){return arguments.length?(h.sleep(),f=t,h.fps(i),void 0):f},h.fps(t),setTimeout(function(){f&&5>h.frame&&h.useRAF(!1)},1500)}),n=h.Ticker.prototype=new h.events.EventDispatcher,n.constructor=h.Ticker;var R=v("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,B){o||a.wake();var i=this.vars.useFrames?q:B;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});a=R.ticker=new h.Ticker,n=R.prototype,n._dirty=n._gc=n._initted=n._paused=!1,n._totalTime=n._time=0,n._rawPrevTime=-1,n._next=n._last=n._onUpdate=n._timeline=n.timeline=null,n._paused=!1;var C=function(){o&&A()-x>2e3&&a.wake(),setTimeout(C,2e3)};C(),n.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},n.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},n.resume=function(t,e){return null!=t&&this.seek(t,e),this.paused(!1)},n.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},n.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},n.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},n.render=function(){},n.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},n.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&i+this.totalDuration()/this._timeScale>t},n._enabled=function(t,e){return o||a.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},n._kill=function(){return this._enabled(!1,!1)},n.kill=function(t,e){return this._kill(t,e),this},n._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},n._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},n.eventCallback=function(t,e,i,s){if("on"===(t||"").substr(0,2)){var r=this.vars;if(1===arguments.length)return r[t];null==e?delete r[t]:(r[t]=e,r[t+"Params"]=f(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,r[t+"Scope"]=s),"onUpdate"===t&&(this._onUpdate=e)}return this},n.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},n.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},n.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},n.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},n.totalTime=function(t,e,i){if(o||a.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var s=this._totalDuration,r=this._timeline;if(t>s&&!i&&(t=s),this._startTime=(this._paused?this._pauseTime:r._time)-(this._reversed?s-t:t)/this._timeScale,r._dirty||this._uncache(!1),r._timeline)for(;r._timeline;)r._timeline._time!==(r._startTime+r._totalTime)/r._timeScale&&r.totalTime(r._totalTime,!0),r=r._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&(this.render(t,e,!1),z.length&&$())}return this},n.progress=n.totalProgress=function(t,e){return arguments.length?this.totalTime(this.duration()*t,e):this._time/this.duration()},n.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},n.endTime=function(t){return this._startTime+(0!=t?this.totalDuration():this.duration())/this._timeScale},n.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||_,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},n.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},n.paused=function(t){if(!arguments.length)return this._paused;var e,i,s=this._timeline;return t!=this._paused&&s&&(o||t||a.wake(),e=s.rawTime(),i=e-this._pauseTime,!t&&s.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=t?e:null,this._paused=t,this._active=this.isActive(),!t&&0!==i&&this._initted&&this.duration()&&this.render(s.smoothChildTiming?this._totalTime:(e-this._startTime)/this._timeScale,!0,!0)),this._gc&&!t&&this._enabled(!0,!1),this};var D=v("core.SimpleTimeline",function(t){R.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});n=D.prototype=new R,n.constructor=D,n.kill()._gc=!1,n._first=n._last=n._recent=null,n._sortChildren=!1,n.add=n.insert=function(t,e){var i,s;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(s=t._startTime;i&&i._startTime>s;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._recent=t,this._timeline&&this._uncache(!0),this},n._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),t._next=t._prev=t.timeline=null,t===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},n.render=function(t,e,i){var s,r=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;r;)s=r._next,(r._active||t>=r._startTime&&!r._paused)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(t-r._startTime)*r._timeScale,e,i):r.render((t-r._startTime)*r._timeScale,e,i)),r=s},n.rawTime=function(){return o||a.wake(),this._totalTime};var I=v("TweenLite",function(e,i,s){if(R.call(this,i,s),this.render=I.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:I.selector(e)||e;var r,n,a,o=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?Q[I.defaultOverwrite]:"number"==typeof l?l>>0:Q[l],(o||e instanceof Array||e.push&&f(e))&&"number"!=typeof e[0])for(this._targets=a=u(e),this._propLookup=[],this._siblings=[],r=0;a.length>r;r++)n=a[r],n?"string"!=typeof n?n.length&&n!==t&&n[0]&&(n[0]===t||n[0].nodeType&&n[0].style&&!n.nodeType)?(a.splice(r--,1),this._targets=a=a.concat(u(n))):(this._siblings[r]=K(n,this,!1),1===l&&this._siblings[r].length>1&&J(n,this,null,1,this._siblings[r])):(n=a[r--]=I.selector(n),"string"==typeof n&&a.splice(r+1,1)):a.splice(r--,1);else this._propLookup={},this._siblings=K(e,this,!1),1===l&&this._siblings.length>1&&J(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-_,this.render(-this._delay))},!0),E=function(e){return e&&e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},O=function(t,e){var i,s={};for(i in t)G[i]||i in e&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!U[i]||U[i]&&U[i]._autoCSS)||(s[i]=t[i],delete t[i]);t.css=s};n=I.prototype=new R,n.constructor=I,n.kill()._gc=!1,n.ratio=0,n._firstPT=n._targets=n._overwrittenProps=n._startAt=null,n._notifyPluginsOfEnabled=n._lazy=!1,I.version="1.16.1",I.defaultEase=n._ease=new y(null,null,1,1),I.defaultOverwrite="auto",I.ticker=a,I.autoSleep=120,I.lagSmoothing=function(t,e){a.lagSmoothing(t,e)},I.selector=t.$||t.jQuery||function(e){var i=t.$||t.jQuery;return i?(I.selector=i,i(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var z=[],L={},N=I._internals={isArray:f,isSelector:E,lazyTweens:z},U=I._plugins={},F=N.tweenLookup={},j=0,G=N.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1},Q={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},q=R._rootFramesTimeline=new D,B=R._rootTimeline=new D,M=30,$=N.lazyRender=function(){var t,e=z.length;for(L={};--e>-1;)t=z[e],t&&t._lazy!==!1&&(t.render(t._lazy[0],t._lazy[1],!0),t._lazy=!1);z.length=0};B._startTime=a.time,q._startTime=a.frame,B._active=q._active=!0,setTimeout($,1),R._updateRoot=I.render=function(){var t,e,i;if(z.length&&$(),B.render((a.time-B._startTime)*B._timeScale,!1,!1),q.render((a.frame-q._startTime)*q._timeScale,!1,!1),z.length&&$(),a.frame>=M){M=a.frame+(parseInt(I.autoSleep,10)||120);for(i in F){for(e=F[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete F[i]}if(i=B._first,(!i||i._paused)&&I.autoSleep&&!q._first&&1===a._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||a.sleep()}}},a.addEventListener("tick",R._updateRoot);var K=function(t,e,i){var s,r,n=t._gsTweenID;if(F[n||(t._gsTweenID=n="t"+j++)]||(F[n]={target:t,tweens:[]}),e&&(s=F[n].tweens,s[r=s.length]=e,i))for(;--r>-1;)s[r]===e&&s.splice(r,1);return F[n].tweens},H=function(t,e,i,s){var r,n,a=t.vars.onOverwrite;return a&&(r=a(t,e,i,s)),a=I.onOverwrite,a&&(n=a(t,e,i,s)),r!==!1&&n!==!1},J=function(t,e,i,s,r){var n,a,o,l;if(1===s||s>=4){for(l=r.length,n=0;l>n;n++)if((o=r[n])!==e)o._gc||H(o,e)&&o._enabled(!1,!1)&&(a=!0);else if(5===s)break;return a}var h,u=e._startTime+_,m=[],f=0,c=0===e._duration;for(n=r.length;--n>-1;)(o=r[n])===e||o._gc||o._paused||(o._timeline!==e._timeline?(h=h||V(e,0,c),0===V(o,h,c)&&(m[f++]=o)):u>=o._startTime&&o._startTime+o.totalDuration()/o._timeScale>u&&((c||!o._initted)&&2e-10>=u-o._startTime||(m[f++]=o)));for(n=f;--n>-1;)if(o=m[n],2===s&&o._kill(i,t,e)&&(a=!0),2!==s||!o._firstPT&&o._initted){if(2!==s&&!H(o,e))continue;o._enabled(!1,!1)&&(a=!0)}return a},V=function(t,e,i){for(var s=t._timeline,r=s._timeScale,n=t._startTime;s._timeline;){if(n+=s._startTime,r*=s._timeScale,s._paused)return-100;s=s._timeline}return n/=r,n>e?n-e:i&&n===e||!t._initted&&2*_>n-e?_:(n+=t.totalDuration()/t._timeScale/r)>e+_?0:n-e-_};n._init=function(){var t,e,i,s,r,n=this.vars,a=this._overwrittenProps,o=this._duration,l=!!n.immediateRender,h=n.ease;if(n.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),r={};for(s in n.startAt)r[s]=n.startAt[s];if(r.overwrite=!1,r.immediateRender=!0,r.lazy=l&&n.lazy!==!1,r.startAt=r.delay=null,this._startAt=I.to(this.target,0,r),l)if(this._time>0)this._startAt=null;else if(0!==o)return}else if(n.runBackwards&&0!==o)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(l=!1),i={};for(s in n)G[s]&&"autoCSS"!==s||(i[s]=n[s]);if(i.overwrite=0,i.data="isFromStart",i.lazy=l&&n.lazy!==!1,i.immediateRender=l,this._startAt=I.to(this.target,0,i),l){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=h=h?h instanceof y?h:"function"==typeof h?new y(h,n.easeParams):w[h]||I.defaultEase:I.defaultEase,n.easeParams instanceof Array&&h.config&&(this._ease=h.config.apply(h,n.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(t=this._targets.length;--t>-1;)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],a?a[t]:null)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,a);if(e&&I._onPluginEvent("_onInitAllProps",this),a&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),n.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=n.onUpdate,this._initted=!0},n._initProps=function(e,i,s,r){var n,a,o,l,h,_;if(null==e)return!1;L[e._gsTweenID]&&$(),this.vars.css||e.style&&e!==t&&e.nodeType&&U.css&&this.vars.autoCSS!==!1&&O(this.vars,e);for(n in this.vars){if(_=this.vars[n],G[n])_&&(_ instanceof Array||_.push&&f(_))&&-1!==_.join("").indexOf("{self}")&&(this.vars[n]=_=this._swapSelfInParams(_,this));else if(U[n]&&(l=new U[n])._onInitTween(e,this.vars[n],this)){for(this._firstPT=h={_next:this._firstPT,t:l,p:"setRatio",s:0,c:1,f:!0,n:n,pg:!0,pr:l._priority},a=l._overwriteProps.length;--a>-1;)i[l._overwriteProps[a]]=this._firstPT;(l._priority||l._onInitAllProps)&&(o=!0),(l._onDisable||l._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=i[n]=h={_next:this._firstPT,t:e,p:n,f:"function"==typeof e[n],n:n,pg:!1,pr:0},h.s=h.f?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]():parseFloat(e[n]),h.c="string"==typeof _&&"="===_.charAt(1)?parseInt(_.charAt(0)+"1",10)*Number(_.substr(2)):Number(_)-h.s||0;h&&h._next&&(h._next._prev=h)}return r&&this._kill(r,e)?this._initProps(e,i,s,r):this._overwrite>1&&this._firstPT&&s.length>1&&J(e,this,i,this._overwrite,s)?(this._kill(i,e),this._initProps(e,i,s,r)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(L[e._gsTweenID]=!0),o)},n.render=function(t,e,i){var s,r,n,a,o=this._time,l=this._duration,h=this._rawPrevTime;if(t>=l)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(s=!0,r="onComplete",i=i||this._timeline.autoRemoveChildren),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0===t||0>h||h===_&&"isPause"!==this.data)&&h!==t&&(i=!0,h>_&&(r="onReverseComplete")),this._rawPrevTime=a=!e||t||h===t?t:_);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==o||0===l&&h>0)&&(r="onReverseComplete",s=this._reversed),0>t&&(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(h>=0&&(h!==_||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=a=!e||t||h===t?t:_)),this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var u=t/l,m=this._easeType,f=this._easePower;(1===m||3===m&&u>=.5)&&(u=1-u),3===m&&(u*=2),1===f?u*=u:2===f?u*=u*u:3===f?u*=u*u*u:4===f&&(u*=u*u*u*u),this.ratio=1===m?1-u:2===m?u:.5>t/l?u/2:1-u/2}else this.ratio=this._ease.getRatio(t/l);if(this._time!==o||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=o,this._rawPrevTime=h,z.push(this),this._lazy=[t,e],void 0;this._time&&!s?this.ratio=this._ease.getRatio(this._time/l):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==o&&t>=0&&(this._active=!0),0===o&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(e||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||T))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&t!==-1e-4&&this._startAt.render(t,e,i),e||(this._time!==o||s)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||T)),r&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&t!==-1e-4&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this.vars[r].apply(this.vars[r+"Scope"]||this,this.vars[r+"Params"]||T),0===l&&this._rawPrevTime===_&&a!==_&&(this._rawPrevTime=0))}},n._kill=function(t,e,i){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._lazy=!1,this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:I.selector(e)||e;var s,r,n,a,o,l,h,_,u;if((f(e)||E(e))&&"number"!=typeof e[0])for(s=e.length;--s>-1;)this._kill(t,e[s])&&(l=!0);else{if(this._targets){for(s=this._targets.length;--s>-1;)if(e===this._targets[s]){o=this._propLookup[s]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[s]=t?this._overwrittenProps[s]||{}:"all";break}}else{if(e!==this.target)return!1;o=this._propLookup,r=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(o){if(h=t||o,_=t!==r&&"all"!==r&&t!==o&&("object"!=typeof t||!t._tempKill),i&&(I.onOverwrite||this.vars.onOverwrite)){for(n in h)o[n]&&(u||(u=[]),u.push(n));if(!H(this,i,e,u))return!1}for(n in h)(a=o[n])&&(a.pg&&a.t._kill(h)&&(l=!0),a.pg&&0!==a.t._overwriteProps.length||(a._prev?a._prev._next=a._next:a===this._firstPT&&(this._firstPT=a._next),a._next&&(a._next._prev=a._prev),a._next=a._prev=null),delete o[n]),_&&(r[n]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return l},n.invalidate=function(){return this._notifyPluginsOfEnabled&&I._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],R.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-_,this.render(-this._delay)),this},n._enabled=function(t,e){if(o||a.wake(),t&&this._gc){var i,s=this._targets;if(s)for(i=s.length;--i>-1;)this._siblings[i]=K(s[i],this,!0);else this._siblings=K(this.target,this,!0)}return R.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?I._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},I.to=function(t,e,i){return new I(t,e,i)},I.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new I(t,e,i)},I.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new I(t,e,s)},I.delayedCall=function(t,e,i,s,r){return new I(e,0,{delay:t,onComplete:e,onCompleteParams:i,onCompleteScope:s,onReverseComplete:e,onReverseCompleteParams:i,onReverseCompleteScope:s,immediateRender:!1,lazy:!1,useFrames:r,overwrite:0})},I.set=function(t,e){return new I(t,0,e)},I.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:I.selector(t)||t;var i,s,r,n;if((f(t)||E(t))&&"number"!=typeof t[0]){for(i=t.length,s=[];--i>-1;)s=s.concat(I.getTweensOf(t[i],e));for(i=s.length;--i>-1;)for(n=s[i],r=i;--r>-1;)n===s[r]&&s.splice(i,1)}else for(s=K(t).concat(),i=s.length;--i>-1;)(s[i]._gc||e&&!s[i].isActive())&&s.splice(i,1);return s},I.killTweensOf=I.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var s=I.getTweensOf(t,e),r=s.length;--r>-1;)s[r]._kill(i,t)};var W=v("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=W.prototype},!0);if(n=W.prototype,W.version="1.10.1",W.API=2,n._firstPT=null,n._addTween=function(t,e,i,s,r,n){var a,o;return null!=s&&(a="number"==typeof s||"="!==s.charAt(1)?Number(s)-i:parseInt(s.charAt(0)+"1",10)*Number(s.substr(2)))?(this._firstPT=o={_next:this._firstPT,t:t,p:e,s:i,c:a,f:"function"==typeof t[e],n:r||e,r:n},o._next&&(o._next._prev=o),o):void 0},n.setRatio=function(t){for(var e,i=this._firstPT,s=1e-6;i;)e=i.c*t+i.s,i.r?e=Math.round(e):s>e&&e>-s&&(e=0),i.f?i.t[i.p](e):i.t[i.p]=e,i=i._next},n._kill=function(t){var e,i=this._overwriteProps,s=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;s;)null!=t[s.n]&&(s._next&&(s._next._prev=s._prev),s._prev?(s._prev._next=s._next,s._prev=null):this._firstPT===s&&(this._firstPT=s._next)),s=s._next;return!1},n._roundProps=function(t,e){for(var i=this._firstPT;i;)(t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")])&&(i.r=e),i=i._next},I._onPluginEvent=function(t,e){var i,s,r,n,a,o=e._firstPT;if("_onInitAllProps"===t){for(;o;){for(a=o._next,s=r;s&&s.pr>o.pr;)s=s._next;(o._prev=s?s._prev:n)?o._prev._next=o:r=o,(o._next=s)?s._prev=o:n=o,o=a}o=e._firstPT=r}for(;o;)o.pg&&"function"==typeof o.t[t]&&o.t[t]()&&(i=!0),o=o._next;return i},W.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===W.API&&(U[(new t[e])._propName]=t[e]);return!0},d.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,s=t.priority||0,r=t.overwriteProps,n={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},a=v("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){W.call(this,i,s),this._overwriteProps=r||[]},t.global===!0),o=a.prototype=new W(i);o.constructor=a,a.API=t.API;for(e in n)"function"==typeof t[e]&&(o[n[e]]=t[e]);return a.version=t.version,W.activate([a]),a},s=t._gsQueue){for(r=0;s.length>r;r++)s[r]();for(n in c)c[n].func||t.console.log("GSAP encountered missing dependency: com.greensock."+n)}o=!1}})("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenLite");
;
;
/*! TimelineLite.min.js */ 
;
;
/*!
* VERSION: 1.16.1
* DATE: 2015-03-13
* UPDATES AND DOCS AT: http://greensock.com
*
* @license Copyright (c) 2008-2015, GreenSock. All rights reserved.
* This work is subject to the terms at http://greensock.com/standard-license or for
* Club GreenSock members, the software agreement that was issued with your membership.
* 
* @author: Jack Doyle, jack@greensock.com
*/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(t,e,i){var s=function(t){e.call(this,t),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,s,r=this.vars;for(s in r)i=r[s],h(i)&&-1!==i.join("").indexOf("{self}")&&(r[s]=this._swapSelfInParams(i));h(r.tweens)&&this.add(r.tweens,0,r.align,r.stagger)},r=1e-10,n=i._internals,a=s._internals={},o=n.isSelector,h=n.isArray,l=n.lazyTweens,_=n.lazyRender,u=[],p=_gsScope._gsDefine.globals,f=function(t){var e,i={};for(e in t)i[e]=t[e];return i},c=a.pauseCallback=function(t,e,i,s){var n,a=t._timeline,o=a._totalTime,h=t._startTime,l=0>t._rawPrevTime||0===t._rawPrevTime&&a._reversed,_=l?0:r,p=l?r:0;if(e||!this._forcingPlayhead){for(a.pause(h),n=t._prev;n&&n._startTime===h;)n._rawPrevTime=p,n=n._prev;for(n=t._next;n&&n._startTime===h;)n._rawPrevTime=_,n=n._next;e&&e.apply(s||a,i||u),(this._forcingPlayhead||!a._paused)&&a.seek(o)}},m=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},d=s.prototype=new e;return s.version="1.16.1",d.constructor=s,d.kill()._gc=d._forcingPlayhead=!1,d.to=function(t,e,s,r){var n=s.repeat&&p.TweenMax||i;return e?this.add(new n(t,e,s),r):this.set(t,s,r)},d.from=function(t,e,s,r){return this.add((s.repeat&&p.TweenMax||i).from(t,e,s),r)},d.fromTo=function(t,e,s,r,n){var a=r.repeat&&p.TweenMax||i;return e?this.add(a.fromTo(t,e,s,r),n):this.set(t,r,n)},d.staggerTo=function(t,e,r,n,a,h,l,_){var u,p=new s({onComplete:h,onCompleteParams:l,onCompleteScope:_,smoothChildTiming:this.smoothChildTiming});for("string"==typeof t&&(t=i.selector(t)||t),t=t||[],o(t)&&(t=m(t)),n=n||0,0>n&&(t=m(t),t.reverse(),n*=-1),u=0;t.length>u;u++)r.startAt&&(r.startAt=f(r.startAt)),p.to(t[u],e,f(r),u*n);return this.add(p,a)},d.staggerFrom=function(t,e,i,s,r,n,a,o){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(t,e,i,s,r,n,a,o)},d.staggerFromTo=function(t,e,i,s,r,n,a,o,h){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,this.staggerTo(t,e,s,r,n,a,o,h)},d.call=function(t,e,s,r){return this.add(i.delayedCall(0,t,e,s),r)},d.set=function(t,e,s){return s=this._parseTimeOrLabel(s,0,!0),null==e.immediateRender&&(e.immediateRender=s===this._time&&!this._paused),this.add(new i(t,0,e),s)},s.exportRoot=function(t,e){t=t||{},null==t.smoothChildTiming&&(t.smoothChildTiming=!0);var r,n,a=new s(t),o=a._timeline;for(null==e&&(e=!0),o._remove(a,!0),a._startTime=0,a._rawPrevTime=a._time=a._totalTime=o._time,r=o._first;r;)n=r._next,e&&r instanceof i&&r.target===r.vars.onComplete||a.add(r,r._startTime-r._delay),r=n;return o.add(a,0),a},d.add=function(r,n,a,o){var l,_,u,p,f,c;if("number"!=typeof n&&(n=this._parseTimeOrLabel(n,0,!0,r)),!(r instanceof t)){if(r instanceof Array||r&&r.push&&h(r)){for(a=a||"normal",o=o||0,l=n,_=r.length,u=0;_>u;u++)h(p=r[u])&&(p=new s({tweens:p})),this.add(p,l),"string"!=typeof p&&"function"!=typeof p&&("sequence"===a?l=p._startTime+p.totalDuration()/p._timeScale:"start"===a&&(p._startTime-=p.delay())),l+=o;return this._uncache(!0)}if("string"==typeof r)return this.addLabel(r,n);if("function"!=typeof r)throw"Cannot add "+r+" into the timeline; it is not a tween, timeline, function, or string.";r=i.delayedCall(0,r)}if(e.prototype.add.call(this,r,n),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(f=this,c=f.rawTime()>r._startTime;f._timeline;)c&&f._timeline.smoothChildTiming?f.totalTime(f._totalTime,!0):f._gc&&f._enabled(!0,!1),f=f._timeline;return this},d.remove=function(e){if(e instanceof t)return this._remove(e,!1);if(e instanceof Array||e&&e.push&&h(e)){for(var i=e.length;--i>-1;)this.remove(e[i]);return this}return"string"==typeof e?this.removeLabel(e):this.kill(null,e)},d._remove=function(t,i){e.prototype._remove.call(this,t,i);var s=this._last;return s?this._time>s._startTime+s._totalDuration/s._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},d.append=function(t,e){return this.add(t,this._parseTimeOrLabel(null,e,!0,t))},d.insert=d.insertMultiple=function(t,e,i,s){return this.add(t,e||0,i,s)},d.appendMultiple=function(t,e,i,s){return this.add(t,this._parseTimeOrLabel(null,e,!0,t),i,s)},d.addLabel=function(t,e){return this._labels[t]=this._parseTimeOrLabel(e),this},d.addPause=function(t,e,s,r){var n=i.delayedCall(0,c,["{self}",e,s,r],this);return n.data="isPause",this.add(n,t)},d.removeLabel=function(t){return delete this._labels[t],this},d.getLabelTime=function(t){return null!=this._labels[t]?this._labels[t]:-1},d._parseTimeOrLabel=function(e,i,s,r){var n;if(r instanceof t&&r.timeline===this)this.remove(r);else if(r&&(r instanceof Array||r.push&&h(r)))for(n=r.length;--n>-1;)r[n]instanceof t&&r[n].timeline===this&&this.remove(r[n]);if("string"==typeof i)return this._parseTimeOrLabel(i,s&&"number"==typeof e&&null==this._labels[i]?e-this.duration():0,s);if(i=i||0,"string"!=typeof e||!isNaN(e)&&null==this._labels[e])null==e&&(e=this.duration());else{if(n=e.indexOf("="),-1===n)return null==this._labels[e]?s?this._labels[e]=this.duration()+i:i:this._labels[e]+i;i=parseInt(e.charAt(n-1)+"1",10)*Number(e.substr(n+1)),e=n>1?this._parseTimeOrLabel(e.substr(0,n-1),0,s):this.duration()}return Number(e)+i},d.seek=function(t,e){return this.totalTime("number"==typeof t?t:this._parseTimeOrLabel(t),e!==!1)},d.stop=function(){return this.paused(!0)},d.gotoAndPlay=function(t,e){return this.play(t,e)},d.gotoAndStop=function(t,e){return this.pause(t,e)},d.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,n,a,o,h,p=this._dirty?this.totalDuration():this._totalDuration,f=this._time,c=this._startTime,m=this._timeScale,d=this._paused;if(t>=p)this._totalTime=this._time=p,this._reversed||this._hasPausedChild()||(n=!0,o="onComplete",h=!!this._timeline.autoRemoveChildren,0===this._duration&&(0===t||0>this._rawPrevTime||this._rawPrevTime===r)&&this._rawPrevTime!==t&&this._first&&(h=!0,this._rawPrevTime>r&&(o="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,t=p+1e-4;else if(1e-7>t)if(this._totalTime=this._time=0,(0!==f||0===this._duration&&this._rawPrevTime!==r&&(this._rawPrevTime>0||0>t&&this._rawPrevTime>=0))&&(o="onReverseComplete",n=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(h=n=!0,o="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(h=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,0===t&&n)for(s=this._first;s&&0===s._startTime;)s._duration||(n=!1),s=s._next;t=0,this._initted||(h=!0)}else this._totalTime=this._time=this._rawPrevTime=t;if(this._time!==f&&this._first||i||h){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==f&&t>0&&(this._active=!0),0===f&&this.vars.onStart&&0!==this._time&&(e||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||u)),this._time>=f)for(s=this._first;s&&(a=s._next,!this._paused||d);)(s._active||s._startTime<=this._time&&!s._paused&&!s._gc)&&(s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=a;else for(s=this._last;s&&(a=s._prev,!this._paused||d);)(s._active||f>=s._startTime&&!s._paused&&!s._gc)&&(s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=a;this._onUpdate&&(e||(l.length&&_(),this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||u))),o&&(this._gc||(c===this._startTime||m!==this._timeScale)&&(0===this._time||p>=this.totalDuration())&&(n&&(l.length&&_(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[o]&&this.vars[o].apply(this.vars[o+"Scope"]||this,this.vars[o+"Params"]||u)))}},d._hasPausedChild=function(){for(var t=this._first;t;){if(t._paused||t instanceof s&&t._hasPausedChild())return!0;t=t._next}return!1},d.getChildren=function(t,e,s,r){r=r||-9999999999;for(var n=[],a=this._first,o=0;a;)r>a._startTime||(a instanceof i?e!==!1&&(n[o++]=a):(s!==!1&&(n[o++]=a),t!==!1&&(n=n.concat(a.getChildren(!0,e,s)),o=n.length))),a=a._next;return n},d.getTweensOf=function(t,e){var s,r,n=this._gc,a=[],o=0;for(n&&this._enabled(!0,!0),s=i.getTweensOf(t),r=s.length;--r>-1;)(s[r].timeline===this||e&&this._contains(s[r]))&&(a[o++]=s[r]);return n&&this._enabled(!1,!0),a},d.recent=function(){return this._recent},d._contains=function(t){for(var e=t.timeline;e;){if(e===this)return!0;e=e.timeline}return!1},d.shiftChildren=function(t,e,i){i=i||0;for(var s,r=this._first,n=this._labels;r;)r._startTime>=i&&(r._startTime+=t),r=r._next;if(e)for(s in n)n[s]>=i&&(n[s]+=t);return this._uncache(!0)},d._kill=function(t,e){if(!t&&!e)return this._enabled(!1,!1);for(var i=e?this.getTweensOf(e):this.getChildren(!0,!0,!1),s=i.length,r=!1;--s>-1;)i[s]._kill(t,e)&&(r=!0);return r},d.clear=function(t){var e=this.getChildren(!1,!0,!0),i=e.length;for(this._time=this._totalTime=0;--i>-1;)e[i]._enabled(!1,!1);return t!==!1&&(this._labels={}),this._uncache(!0)},d.invalidate=function(){for(var e=this._first;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},d._enabled=function(t,i){if(t===this._gc)for(var s=this._first;s;)s._enabled(t,!0),s=s._next;return e.prototype._enabled.call(this,t,i)},d.totalTime=function(){this._forcingPlayhead=!0;var e=t.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},d.duration=function(t){return arguments.length?(0!==this.duration()&&0!==t&&this.timeScale(this._duration/t),this):(this._dirty&&this.totalDuration(),this._duration)},d.totalDuration=function(t){if(!arguments.length){if(this._dirty){for(var e,i,s=0,r=this._last,n=999999999999;r;)e=r._prev,r._dirty&&r.totalDuration(),r._startTime>n&&this._sortChildren&&!r._paused?this.add(r,r._startTime-r._delay):n=r._startTime,0>r._startTime&&!r._paused&&(s-=r._startTime,this._timeline.smoothChildTiming&&(this._startTime+=r._startTime/this._timeScale),this.shiftChildren(-r._startTime,!1,-9999999999),n=0),i=r._startTime+r._totalDuration/r._timeScale,i>s&&(s=i),r=e;this._duration=this._totalDuration=s,this._dirty=!1}return this._totalDuration}return 0!==this.totalDuration()&&0!==t&&this.timeScale(this._totalDuration/t),this},d.paused=function(e){if(!e)for(var i=this._first,s=this._time;i;)i._startTime===s&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return t.prototype.paused.apply(this,arguments)},d.usesFrames=function(){for(var e=this._timeline;e._timeline;)e=e._timeline;return e===t._rootFramesTimeline},d.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},s},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t){"use strict";var e=function(){return(_gsScope.GreenSockGlobals||_gsScope)[t]};"function"==typeof define&&define.amd?define(["TweenLite"],e):"undefined"!=typeof module&&module.exports&&(require("./TweenLite.js"),module.exports=e())}("TimelineLite");
;
;
/*! EasePack.min.js */ 
;
;
/*!
* VERSION: beta 1.15.2
* DATE: 2015-01-27
* UPDATES AND DOCS AT: http://greensock.com
*
* @license Copyright (c) 2008-2015, GreenSock. All rights reserved.
* This work is subject to the terms at http://greensock.com/standard-license or for
* Club GreenSock members, the software agreement that was issued with your membership.
* 
* @author: Jack Doyle, jack@greensock.com
**/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,s,r=_gsScope.GreenSockGlobals||_gsScope,n=r.com.greensock,a=2*Math.PI,o=Math.PI/2,h=n._class,l=function(e,i){var s=h("easing."+e,function(){},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,s},_=t.register||function(){},u=function(t,e,i,s){var r=h("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new s},!0);return _(r,t),r},c=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},p=function(e,i){var s=h("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,r.config=function(t){return new s(t)},s},f=u("Back",p("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),p("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),p("BackInOut",function(t){return 1>(t*=2)?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),m=h("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),d=m.prototype=new t;return d.constructor=m,d.getRatio=function(t){var e=t+(.5-t)*this._p;return this._p1>t?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},m.ease=new m(.7,.7),d.config=m.config=function(t,e,i){return new m(t,e,i)},e=h("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),d=e.prototype=new t,d.constructor=e,d.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},d.config=e.config=function(t){return new e(t)},i=h("easing.RoughEase",function(e){e=e||{};for(var i,s,r,n,a,o,h=e.taper||"none",l=[],_=0,u=0|(e.points||20),p=u,f=e.randomize!==!1,m=e.clamp===!0,d=e.template instanceof t?e.template:null,g="number"==typeof e.strength?.4*e.strength:.4;--p>-1;)i=f?Math.random():1/u*p,s=d?d.getRatio(i):i,"none"===h?r=g:"out"===h?(n=1-i,r=n*n*g):"in"===h?r=i*i*g:.5>i?(n=2*i,r=.5*n*n*g):(n=2*(1-i),r=.5*n*n*g),f?s+=Math.random()*r-.5*r:p%2?s+=.5*r:s-=.5*r,m&&(s>1?s=1:0>s&&(s=0)),l[_++]={x:i,y:s};for(l.sort(function(t,e){return t.x-e.x}),o=new c(1,1,null),p=u;--p>-1;)a=l[p],o=new c(a.x,a.y,o);this._prev=new c(0,0,0!==o.t?o:o.next)},!0),d=i.prototype=new t,d.constructor=i,d.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&e.t>=t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},d.config=function(t){return new i(t)},i.ease=new i,u("Bounce",l("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),l("BounceIn",function(t){return 1/2.75>(t=1-t)?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),l("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),u("Circ",l("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),l("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),l("CircInOut",function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),s=function(e,i,s){var r=h("easing."+e,function(t,e){this._p1=t>=1?t:1,this._p2=(e||s)/(1>t?t:1),this._p3=this._p2/a*(Math.asin(1/this._p1)||0),this._p2=a/this._p2},!0),n=r.prototype=new t;return n.constructor=r,n.getRatio=i,n.config=function(t,e){return new r(t,e)},r},u("Elastic",s("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*this._p2)+1},.3),s("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2))},.3),s("ElasticInOut",function(t){return 1>(t*=2)?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2):.5*this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*this._p2)+1},.45)),u("Expo",l("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),l("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),l("ExpoInOut",function(t){return 1>(t*=2)?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),u("Sine",l("SineOut",function(t){return Math.sin(t*o)}),l("SineIn",function(t){return-Math.cos(t*o)+1}),l("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),h("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),_(r.SlowMo,"SlowMo","ease,"),_(i,"RoughEase","ease,"),_(e,"SteppedEase","ease,"),f},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()();
;
;
/*! CSSPlugin.min.js */ 
;
;
/*!
* VERSION: 1.16.1
* DATE: 2015-03-13
* UPDATES AND DOCS AT: http://www.greensock.com
*
* @license Copyright (c) 2008-2015, GreenSock. All rights reserved.
* This work is subject to the terms at http://greensock.com/standard-license or for
* Club GreenSock members, the software agreement that was issued with your membership.
* 
* @author: Jack Doyle, jack@greensock.com
*/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(t,e){var i,r,s,n,a=function(){t.call(this,"css"),this._overwriteProps.length=0,this.setRatio=a.prototype.setRatio},o=_gsScope._gsDefine.globals,l={},h=a.prototype=new t("css");h.constructor=a,a.version="1.16.1",a.API=2,a.defaultTransformPerspective=0,a.defaultSkewType="compensated",h="px",a.suffixMap={top:h,right:h,bottom:h,left:h,width:h,height:h,fontSize:h,padding:h,margin:h,perspective:h,lineHeight:""};var u,f,p,c,_,d,m=/(?:\d|\-\d|\.\d|\-\.\d)+/g,g=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,v=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,y=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,x=/(?:\d|\-|\+|=|#|\.)*/g,T=/opacity *= *([^)]*)/i,w=/opacity:([^;]*)/i,b=/alpha\(opacity *=.+?\)/i,P=/^(rgb|hsl)/,S=/([A-Z])/g,C=/-([a-z])/gi,O=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,k=function(t,e){return e.toUpperCase()},R=/(?:Left|Right|Width)/i,A=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,M=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,D=/,(?=[^\)]*(?:\(|$))/gi,N=Math.PI/180,L=180/Math.PI,X={},z=document,E=function(t){return z.createElementNS?z.createElementNS("http://www.w3.org/1999/xhtml",t):z.createElement(t)},F=E("div"),I=E("img"),Y=a._internals={_specialProps:l},B=navigator.userAgent,U=function(){var t=B.indexOf("Android"),e=E("a");return p=-1!==B.indexOf("Safari")&&-1===B.indexOf("Chrome")&&(-1===t||Number(B.substr(t+8,1))>3),_=p&&6>Number(B.substr(B.indexOf("Version/")+8,1)),c=-1!==B.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(B)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(B))&&(d=parseFloat(RegExp.$1)),e?(e.style.cssText="top:1px;opacity:.55;",/^0.55/.test(e.style.opacity)):!1}(),j=function(t){return T.test("string"==typeof t?t:(t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100:1},V=function(t){window.console&&console.log(t)},W="",q="",G=function(t,e){e=e||F;var i,r,s=e.style;if(void 0!==s[t])return t;for(t=t.charAt(0).toUpperCase()+t.substr(1),i=["O","Moz","ms","Ms","Webkit"],r=5;--r>-1&&void 0===s[i[r]+t];);return r>=0?(q=3===r?"ms":i[r],W="-"+q.toLowerCase()+"-",q+t):null},H=z.defaultView?z.defaultView.getComputedStyle:function(){},Q=a.getStyle=function(t,e,i,r,s){var n;return U||"opacity"!==e?(!r&&t.style[e]?n=t.style[e]:(i=i||H(t))?n=i[e]||i.getPropertyValue(e)||i.getPropertyValue(e.replace(S,"-$1").toLowerCase()):t.currentStyle&&(n=t.currentStyle[e]),null==s||n&&"none"!==n&&"auto"!==n&&"auto auto"!==n?n:s):j(t)},Z=Y.convertToPixels=function(t,i,r,s,n){if("px"===s||!s)return r;if("auto"===s||!r)return 0;var o,l,h,u=R.test(i),f=t,p=F.style,c=0>r;if(c&&(r=-r),"%"===s&&-1!==i.indexOf("border"))o=r/100*(u?t.clientWidth:t.clientHeight);else{if(p.cssText="border:0 solid red;position:"+Q(t,"position")+";line-height:0;","%"!==s&&f.appendChild)p[u?"borderLeftWidth":"borderTopWidth"]=r+s;else{if(f=t.parentNode||z.body,l=f._gsCache,h=e.ticker.frame,l&&u&&l.time===h)return l.width*r/100;p[u?"width":"height"]=r+s}f.appendChild(F),o=parseFloat(F[u?"offsetWidth":"offsetHeight"]),f.removeChild(F),u&&"%"===s&&a.cacheWidths!==!1&&(l=f._gsCache=f._gsCache||{},l.time=h,l.width=100*(o/r)),0!==o||n||(o=Z(t,i,r,s,!0))}return c?-o:o},$=Y.calculateOffset=function(t,e,i){if("absolute"!==Q(t,"position",i))return 0;var r="left"===e?"Left":"Top",s=Q(t,"margin"+r,i);return t["offset"+r]-(Z(t,e,parseFloat(s),s.replace(x,""))||0)},K=function(t,e){var i,r,s,n={};if(e=e||H(t,null))if(i=e.length)for(;--i>-1;)s=e[i],(-1===s.indexOf("-transform")||be===s)&&(n[s.replace(C,k)]=e.getPropertyValue(s));else for(i in e)(-1===i.indexOf("Transform")||we===i)&&(n[i]=e[i]);else if(e=t.currentStyle||t.style)for(i in e)"string"==typeof i&&void 0===n[i]&&(n[i.replace(C,k)]=e[i]);return U||(n.opacity=j(t)),r=De(t,e,!1),n.rotation=r.rotation,n.skewX=r.skewX,n.scaleX=r.scaleX,n.scaleY=r.scaleY,n.x=r.x,n.y=r.y,Se&&(n.z=r.z,n.rotationX=r.rotationX,n.rotationY=r.rotationY,n.scaleZ=r.scaleZ),n.filters&&delete n.filters,n},J=function(t,e,i,r,s){var n,a,o,l={},h=t.style;for(a in i)"cssText"!==a&&"length"!==a&&isNaN(a)&&(e[a]!==(n=i[a])||s&&s[a])&&-1===a.indexOf("Origin")&&("number"==typeof n||"string"==typeof n)&&(l[a]="auto"!==n||"left"!==a&&"top"!==a?""!==n&&"auto"!==n&&"none"!==n||"string"!=typeof e[a]||""===e[a].replace(y,"")?n:0:$(t,a),void 0!==h[a]&&(o=new ce(h,a,h[a],o)));if(r)for(a in r)"className"!==a&&(l[a]=r[a]);return{difs:l,firstMPT:o}},te={width:["Left","Right"],height:["Top","Bottom"]},ee=["marginLeft","marginRight","marginTop","marginBottom"],ie=function(t,e,i){var r=parseFloat("width"===e?t.offsetWidth:t.offsetHeight),s=te[e],n=s.length;for(i=i||H(t,null);--n>-1;)r-=parseFloat(Q(t,"padding"+s[n],i,!0))||0,r-=parseFloat(Q(t,"border"+s[n]+"Width",i,!0))||0;return r},re=function(t,e){(null==t||""===t||"auto"===t||"auto auto"===t)&&(t="0 0");var i=t.split(" "),r=-1!==t.indexOf("left")?"0%":-1!==t.indexOf("right")?"100%":i[0],s=-1!==t.indexOf("top")?"0%":-1!==t.indexOf("bottom")?"100%":i[1];return null==s?s="center"===r?"50%":"0":"center"===s&&(s="50%"),("center"===r||isNaN(parseFloat(r))&&-1===(r+"").indexOf("="))&&(r="50%"),t=r+" "+s+(i.length>2?" "+i[2]:""),e&&(e.oxp=-1!==r.indexOf("%"),e.oyp=-1!==s.indexOf("%"),e.oxr="="===r.charAt(1),e.oyr="="===s.charAt(1),e.ox=parseFloat(r.replace(y,"")),e.oy=parseFloat(s.replace(y,"")),e.v=t),e||t},se=function(t,e){return"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)):parseFloat(t)-parseFloat(e)},ne=function(t,e){return null==t?e:"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2))+e:parseFloat(t)},ae=function(t,e,i,r){var s,n,a,o,l,h=1e-6;return null==t?o=e:"number"==typeof t?o=t:(s=360,n=t.split("_"),l="="===t.charAt(1),a=(l?parseInt(t.charAt(0)+"1",10)*parseFloat(n[0].substr(2)):parseFloat(n[0]))*(-1===t.indexOf("rad")?1:L)-(l?0:e),n.length&&(r&&(r[i]=e+a),-1!==t.indexOf("short")&&(a%=s,a!==a%(s/2)&&(a=0>a?a+s:a-s)),-1!==t.indexOf("_cw")&&0>a?a=(a+9999999999*s)%s-(0|a/s)*s:-1!==t.indexOf("ccw")&&a>0&&(a=(a-9999999999*s)%s-(0|a/s)*s)),o=e+a),h>o&&o>-h&&(o=0),o},oe={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},le=function(t,e,i){return t=0>t?t+1:t>1?t-1:t,0|255*(1>6*t?e+6*(i-e)*t:.5>t?i:2>3*t?e+6*(i-e)*(2/3-t):e)+.5},he=a.parseColor=function(t){var e,i,r,s,n,a;return t&&""!==t?"number"==typeof t?[t>>16,255&t>>8,255&t]:(","===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),oe[t]?oe[t]:"#"===t.charAt(0)?(4===t.length&&(e=t.charAt(1),i=t.charAt(2),r=t.charAt(3),t="#"+e+e+i+i+r+r),t=parseInt(t.substr(1),16),[t>>16,255&t>>8,255&t]):"hsl"===t.substr(0,3)?(t=t.match(m),s=Number(t[0])%360/360,n=Number(t[1])/100,a=Number(t[2])/100,i=.5>=a?a*(n+1):a+n-a*n,e=2*a-i,t.length>3&&(t[3]=Number(t[3])),t[0]=le(s+1/3,e,i),t[1]=le(s,e,i),t[2]=le(s-1/3,e,i),t):(t=t.match(m)||oe.transparent,t[0]=Number(t[0]),t[1]=Number(t[1]),t[2]=Number(t[2]),t.length>3&&(t[3]=Number(t[3])),t)):oe.black},ue="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(h in oe)ue+="|"+h+"\\b";ue=RegExp(ue+")","gi");var fe=function(t,e,i,r){if(null==t)return function(t){return t};var s,n=e?(t.match(ue)||[""])[0]:"",a=t.split(n).join("").match(v)||[],o=t.substr(0,t.indexOf(a[0])),l=")"===t.charAt(t.length-1)?")":"",h=-1!==t.indexOf(" ")?" ":",",u=a.length,f=u>0?a[0].replace(m,""):"";return u?s=e?function(t){var e,p,c,_;if("number"==typeof t)t+=f;else if(r&&D.test(t)){for(_=t.replace(D,"|").split("|"),c=0;_.length>c;c++)_[c]=s(_[c]);return _.join(",")}if(e=(t.match(ue)||[n])[0],p=t.split(e).join("").match(v)||[],c=p.length,u>c--)for(;u>++c;)p[c]=i?p[0|(c-1)/2]:a[c];return o+p.join(h)+h+e+l+(-1!==t.indexOf("inset")?" inset":"")}:function(t){var e,n,p;if("number"==typeof t)t+=f;else if(r&&D.test(t)){for(n=t.replace(D,"|").split("|"),p=0;n.length>p;p++)n[p]=s(n[p]);return n.join(",")}if(e=t.match(v)||[],p=e.length,u>p--)for(;u>++p;)e[p]=i?e[0|(p-1)/2]:a[p];return o+e.join(h)+l}:function(t){return t}},pe=function(t){return t=t.split(","),function(e,i,r,s,n,a,o){var l,h=(i+"").split(" ");for(o={},l=0;4>l;l++)o[t[l]]=h[l]=h[l]||h[(l-1)/2>>0];return s.parse(e,o,n,a)}},ce=(Y._setPluginRatio=function(t){this.plugin.setRatio(t);for(var e,i,r,s,n=this.data,a=n.proxy,o=n.firstMPT,l=1e-6;o;)e=a[o.v],o.r?e=Math.round(e):l>e&&e>-l&&(e=0),o.t[o.p]=e,o=o._next;if(n.autoRotate&&(n.autoRotate.rotation=a.rotation),1===t)for(o=n.firstMPT;o;){if(i=o.t,i.type){if(1===i.type){for(s=i.xs0+i.s+i.xs1,r=1;i.l>r;r++)s+=i["xn"+r]+i["xs"+(r+1)];i.e=s}}else i.e=i.s+i.xs0;o=o._next}},function(t,e,i,r,s){this.t=t,this.p=e,this.v=i,this.r=s,r&&(r._prev=this,this._next=r)}),_e=(Y._parseToProxy=function(t,e,i,r,s,n){var a,o,l,h,u,f=r,p={},c={},_=i._transform,d=X;for(i._transform=null,X=e,r=u=i.parse(t,e,r,s),X=d,n&&(i._transform=_,f&&(f._prev=null,f._prev&&(f._prev._next=null)));r&&r!==f;){if(1>=r.type&&(o=r.p,c[o]=r.s+r.c,p[o]=r.s,n||(h=new ce(r,"s",o,h,r.r),r.c=0),1===r.type))for(a=r.l;--a>0;)l="xn"+a,o=r.p+"_"+l,c[o]=r.data[l],p[o]=r[l],n||(h=new ce(r,l,o,h,r.rxp[l]));r=r._next}return{proxy:p,end:c,firstMPT:h,pt:u}},Y.CSSPropTween=function(t,e,r,s,a,o,l,h,u,f,p){this.t=t,this.p=e,this.s=r,this.c=s,this.n=l||e,t instanceof _e||n.push(this.n),this.r=h,this.type=o||0,u&&(this.pr=u,i=!0),this.b=void 0===f?r:f,this.e=void 0===p?r+s:p,a&&(this._next=a,a._prev=this)}),de=a.parseComplex=function(t,e,i,r,s,n,a,o,l,h){i=i||n||"",a=new _e(t,e,0,0,a,h?2:1,null,!1,o,i,r),r+="";var f,p,c,_,d,v,y,x,T,w,b,S,C=i.split(", ").join(",").split(" "),O=r.split(", ").join(",").split(" "),k=C.length,R=u!==!1;for((-1!==r.indexOf(",")||-1!==i.indexOf(","))&&(C=C.join(" ").replace(D,", ").split(" "),O=O.join(" ").replace(D,", ").split(" "),k=C.length),k!==O.length&&(C=(n||"").split(" "),k=C.length),a.plugin=l,a.setRatio=h,f=0;k>f;f++)if(_=C[f],d=O[f],x=parseFloat(_),x||0===x)a.appendXtra("",x,se(d,x),d.replace(g,""),R&&-1!==d.indexOf("px"),!0);else if(s&&("#"===_.charAt(0)||oe[_]||P.test(_)))S=","===d.charAt(d.length-1)?"),":")",_=he(_),d=he(d),T=_.length+d.length>6,T&&!U&&0===d[3]?(a["xs"+a.l]+=a.l?" transparent":"transparent",a.e=a.e.split(O[f]).join("transparent")):(U||(T=!1),a.appendXtra(T?"rgba(":"rgb(",_[0],d[0]-_[0],",",!0,!0).appendXtra("",_[1],d[1]-_[1],",",!0).appendXtra("",_[2],d[2]-_[2],T?",":S,!0),T&&(_=4>_.length?1:_[3],a.appendXtra("",_,(4>d.length?1:d[3])-_,S,!1)));else if(v=_.match(m)){if(y=d.match(g),!y||y.length!==v.length)return a;for(c=0,p=0;v.length>p;p++)b=v[p],w=_.indexOf(b,c),a.appendXtra(_.substr(c,w-c),Number(b),se(y[p],b),"",R&&"px"===_.substr(w+b.length,2),0===p),c=w+b.length;a["xs"+a.l]+=_.substr(c)}else a["xs"+a.l]+=a.l?" "+_:_;if(-1!==r.indexOf("=")&&a.data){for(S=a.xs0+a.data.s,f=1;a.l>f;f++)S+=a["xs"+f]+a.data["xn"+f];a.e=S+a["xs"+f]}return a.l||(a.type=-1,a.xs0=a.e),a.xfirst||a},me=9;for(h=_e.prototype,h.l=h.pr=0;--me>0;)h["xn"+me]=0,h["xs"+me]="";h.xs0="",h._next=h._prev=h.xfirst=h.data=h.plugin=h.setRatio=h.rxp=null,h.appendXtra=function(t,e,i,r,s,n){var a=this,o=a.l;return a["xs"+o]+=n&&o?" "+t:t||"",i||0===o||a.plugin?(a.l++,a.type=a.setRatio?2:1,a["xs"+a.l]=r||"",o>0?(a.data["xn"+o]=e+i,a.rxp["xn"+o]=s,a["xn"+o]=e,a.plugin||(a.xfirst=new _e(a,"xn"+o,e,i,a.xfirst||a,0,a.n,s,a.pr),a.xfirst.xs0=0),a):(a.data={s:e+i},a.rxp={},a.s=e,a.c=i,a.r=s,a)):(a["xs"+o]+=e+(r||""),a)};var ge=function(t,e){e=e||{},this.p=e.prefix?G(t)||t:t,l[t]=l[this.p]=this,this.format=e.formatter||fe(e.defaultValue,e.color,e.collapsible,e.multi),e.parser&&(this.parse=e.parser),this.clrs=e.color,this.multi=e.multi,this.keyword=e.keyword,this.dflt=e.defaultValue,this.pr=e.priority||0},ve=Y._registerComplexSpecialProp=function(t,e,i){"object"!=typeof e&&(e={parser:i});var r,s,n=t.split(","),a=e.defaultValue;for(i=i||[a],r=0;n.length>r;r++)e.prefix=0===r&&e.prefix,e.defaultValue=i[r]||a,s=new ge(n[r],e)},ye=function(t){if(!l[t]){var e=t.charAt(0).toUpperCase()+t.substr(1)+"Plugin";ve(t,{parser:function(t,i,r,s,n,a,h){var u=o.com.greensock.plugins[e];return u?(u._cssRegister(),l[r].parse(t,i,r,s,n,a,h)):(V("Error: "+e+" js file not loaded."),n)}})}};h=ge.prototype,h.parseComplex=function(t,e,i,r,s,n){var a,o,l,h,u,f,p=this.keyword;if(this.multi&&(D.test(i)||D.test(e)?(o=e.replace(D,"|").split("|"),l=i.replace(D,"|").split("|")):p&&(o=[e],l=[i])),l){for(h=l.length>o.length?l.length:o.length,a=0;h>a;a++)e=o[a]=o[a]||this.dflt,i=l[a]=l[a]||this.dflt,p&&(u=e.indexOf(p),f=i.indexOf(p),u!==f&&(-1===f?o[a]=o[a].split(p).join(""):-1===u&&(o[a]+=" "+p)));e=o.join(", "),i=l.join(", ")}return de(t,this.p,e,i,this.clrs,this.dflt,r,this.pr,s,n)},h.parse=function(t,e,i,r,n,a){return this.parseComplex(t.style,this.format(Q(t,this.p,s,!1,this.dflt)),this.format(e),n,a)},a.registerSpecialProp=function(t,e,i){ve(t,{parser:function(t,r,s,n,a,o){var l=new _e(t,s,0,0,a,2,s,!1,i);return l.plugin=o,l.setRatio=e(t,r,n._tween,s),l},priority:i})},a.useSVGTransformAttr=p;var xe,Te="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),we=G("transform"),be=W+"transform",Pe=G("transformOrigin"),Se=null!==G("perspective"),Ce=Y.Transform=function(){this.perspective=parseFloat(a.defaultTransformPerspective)||0,this.force3D=a.defaultForce3D!==!1&&Se?a.defaultForce3D||"auto":!1},Oe=window.SVGElement,ke=function(t,e,i){var r,s=z.createElementNS("http://www.w3.org/2000/svg",t),n=/([a-z])([A-Z])/g;for(r in i)s.setAttributeNS(null,r.replace(n,"$1-$2").toLowerCase(),i[r]);return e.appendChild(s),s},Re=z.documentElement,Ae=function(){var t,e,i,r=d||/Android/i.test(B)&&!window.chrome;return z.createElementNS&&!r&&(t=ke("svg",Re),e=ke("rect",t,{width:100,height:50,x:100}),i=e.getBoundingClientRect().width,e.style[Pe]="50% 50%",e.style[we]="scaleX(0.5)",r=i===e.getBoundingClientRect().width&&!(c&&Se),Re.removeChild(t)),r}(),Me=function(t,e,i,r){var s,n;r&&(n=r.split(" ")).length||(s=t.getBBox(),e=re(e).split(" "),n=[(-1!==e[0].indexOf("%")?parseFloat(e[0])/100*s.width:parseFloat(e[0]))+s.x,(-1!==e[1].indexOf("%")?parseFloat(e[1])/100*s.height:parseFloat(e[1]))+s.y]),i.xOrigin=parseFloat(n[0]),i.yOrigin=parseFloat(n[1]),t.setAttribute("data-svg-origin",n.join(" "))},De=Y.getTransform=function(t,e,i,r){if(t._gsTransform&&i&&!r)return t._gsTransform;var n,o,l,h,u,f,p,c,_,d,m=i?t._gsTransform||new Ce:new Ce,g=0>m.scaleX,v=2e-5,y=1e5,x=Se?parseFloat(Q(t,Pe,e,!1,"0 0 0").split(" ")[2])||m.zOrigin||0:0,T=parseFloat(a.defaultTransformPerspective)||0;if(we?o=Q(t,be,e,!0):t.currentStyle&&(o=t.currentStyle.filter.match(A),o=o&&4===o.length?[o[0].substr(4),Number(o[2].substr(4)),Number(o[1].substr(4)),o[3].substr(4),m.x||0,m.y||0].join(","):""),n=!o||"none"===o||"matrix(1, 0, 0, 1, 0, 0)"===o,m.svg=!!(Oe&&"function"==typeof t.getBBox&&t.getCTM&&(!t.parentNode||t.parentNode.getBBox&&t.parentNode.getCTM)),m.svg&&(n&&-1!==(t.style[we]+"").indexOf("matrix")&&(o=t.style[we],n=!1),Me(t,Q(t,Pe,s,!1,"50% 50%")+"",m,t.getAttribute("data-svg-origin")),xe=a.useSVGTransformAttr||Ae,l=t.getAttribute("transform"),n&&l&&-1!==l.indexOf("matrix")&&(o=l,n=0)),!n){for(l=(o||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],h=l.length;--h>-1;)u=Number(l[h]),l[h]=(f=u-(u|=0))?(0|f*y+(0>f?-.5:.5))/y+u:u;if(16===l.length){var w,b,P,S,C,O=l[0],k=l[1],R=l[2],M=l[3],D=l[4],N=l[5],X=l[6],z=l[7],E=l[8],F=l[9],I=l[10],Y=l[12],B=l[13],U=l[14],j=l[11],V=Math.atan2(X,I);m.zOrigin&&(U=-m.zOrigin,Y=E*U-l[12],B=F*U-l[13],U=I*U+m.zOrigin-l[14]),m.rotationX=V*L,V&&(S=Math.cos(-V),C=Math.sin(-V),w=D*S+E*C,b=N*S+F*C,P=X*S+I*C,E=D*-C+E*S,F=N*-C+F*S,I=X*-C+I*S,j=z*-C+j*S,D=w,N=b,X=P),V=Math.atan2(E,I),m.rotationY=V*L,V&&(S=Math.cos(-V),C=Math.sin(-V),w=O*S-E*C,b=k*S-F*C,P=R*S-I*C,F=k*C+F*S,I=R*C+I*S,j=M*C+j*S,O=w,k=b,R=P),V=Math.atan2(k,O),m.rotation=V*L,V&&(S=Math.cos(-V),C=Math.sin(-V),O=O*S+D*C,b=k*S+N*C,N=k*-C+N*S,X=R*-C+X*S,k=b),m.rotationX&&Math.abs(m.rotationX)+Math.abs(m.rotation)>359.9&&(m.rotationX=m.rotation=0,m.rotationY+=180),m.scaleX=(0|Math.sqrt(O*O+k*k)*y+.5)/y,m.scaleY=(0|Math.sqrt(N*N+F*F)*y+.5)/y,m.scaleZ=(0|Math.sqrt(X*X+I*I)*y+.5)/y,m.skewX=0,m.perspective=j?1/(0>j?-j:j):0,m.x=Y,m.y=B,m.z=U,m.svg&&(m.x-=m.xOrigin-(m.xOrigin*O-m.yOrigin*D),m.y-=m.yOrigin-(m.yOrigin*k-m.xOrigin*N))}else if(!(Se&&!r&&l.length&&m.x===l[4]&&m.y===l[5]&&(m.rotationX||m.rotationY)||void 0!==m.x&&"none"===Q(t,"display",e))){var W=l.length>=6,q=W?l[0]:1,G=l[1]||0,H=l[2]||0,Z=W?l[3]:1;m.x=l[4]||0,m.y=l[5]||0,p=Math.sqrt(q*q+G*G),c=Math.sqrt(Z*Z+H*H),_=q||G?Math.atan2(G,q)*L:m.rotation||0,d=H||Z?Math.atan2(H,Z)*L+_:m.skewX||0,Math.abs(d)>90&&270>Math.abs(d)&&(g?(p*=-1,d+=0>=_?180:-180,_+=0>=_?180:-180):(c*=-1,d+=0>=d?180:-180)),m.scaleX=p,m.scaleY=c,m.rotation=_,m.skewX=d,Se&&(m.rotationX=m.rotationY=m.z=0,m.perspective=T,m.scaleZ=1),m.svg&&(m.x-=m.xOrigin-(m.xOrigin*q-m.yOrigin*G),m.y-=m.yOrigin-(m.yOrigin*Z-m.xOrigin*H))}m.zOrigin=x;for(h in m)v>m[h]&&m[h]>-v&&(m[h]=0)}return i&&(t._gsTransform=m,m.svg&&(xe&&t.style[we]?ze(t.style,we):!xe&&t.getAttribute("transform")&&t.removeAttribute("transform"))),m},Ne=function(t){var e,i,r=this.data,s=-r.rotation*N,n=s+r.skewX*N,a=1e5,o=(0|Math.cos(s)*r.scaleX*a)/a,l=(0|Math.sin(s)*r.scaleX*a)/a,h=(0|Math.sin(n)*-r.scaleY*a)/a,u=(0|Math.cos(n)*r.scaleY*a)/a,f=this.t.style,p=this.t.currentStyle;if(p){i=l,l=-h,h=-i,e=p.filter,f.filter="";var c,_,m=this.t.offsetWidth,g=this.t.offsetHeight,v="absolute"!==p.position,y="progid:DXImageTransform.Microsoft.Matrix(M11="+o+", M12="+l+", M21="+h+", M22="+u,w=r.x+m*r.xPercent/100,b=r.y+g*r.yPercent/100;if(null!=r.ox&&(c=(r.oxp?.01*m*r.ox:r.ox)-m/2,_=(r.oyp?.01*g*r.oy:r.oy)-g/2,w+=c-(c*o+_*l),b+=_-(c*h+_*u)),v?(c=m/2,_=g/2,y+=", Dx="+(c-(c*o+_*l)+w)+", Dy="+(_-(c*h+_*u)+b)+")"):y+=", sizingMethod='auto expand')",f.filter=-1!==e.indexOf("DXImageTransform.Microsoft.Matrix(")?e.replace(M,y):y+" "+e,(0===t||1===t)&&1===o&&0===l&&0===h&&1===u&&(v&&-1===y.indexOf("Dx=0, Dy=0")||T.test(e)&&100!==parseFloat(RegExp.$1)||-1===e.indexOf("gradient("&&e.indexOf("Alpha"))&&f.removeAttribute("filter")),!v){var P,S,C,O=8>d?1:-1;for(c=r.ieOffsetX||0,_=r.ieOffsetY||0,r.ieOffsetX=Math.round((m-((0>o?-o:o)*m+(0>l?-l:l)*g))/2+w),r.ieOffsetY=Math.round((g-((0>u?-u:u)*g+(0>h?-h:h)*m))/2+b),me=0;4>me;me++)S=ee[me],P=p[S],i=-1!==P.indexOf("px")?parseFloat(P):Z(this.t,S,parseFloat(P),P.replace(x,""))||0,C=i!==r[S]?2>me?-r.ieOffsetX:-r.ieOffsetY:2>me?c-r.ieOffsetX:_-r.ieOffsetY,f[S]=(r[S]=Math.round(i-C*(0===me||2===me?1:O)))+"px"}}},Le=Y.set3DTransformRatio=Y.setTransformRatio=function(t){var e,i,r,s,n,a,o,l,h,u,f,p,_,d,m,g,v,y,x,T,w,b,P,S=this.data,C=this.t.style,O=S.rotation,k=S.rotationX,R=S.rotationY,A=S.scaleX,M=S.scaleY,D=S.scaleZ,L=S.x,X=S.y,z=S.z,E=S.svg,F=S.perspective,I=S.force3D;if(!(((1!==t&&0!==t||"auto"!==I||this.tween._totalTime!==this.tween._totalDuration&&this.tween._totalTime)&&I||z||F||R||k)&&(!xe||!E)&&Se))return O||S.skewX||E?(O*=N,b=S.skewX*N,P=1e5,e=Math.cos(O)*A,s=Math.sin(O)*A,i=Math.sin(O-b)*-M,n=Math.cos(O-b)*M,b&&"simple"===S.skewType&&(v=Math.tan(b),v=Math.sqrt(1+v*v),i*=v,n*=v,S.skewY&&(e*=v,s*=v)),E&&(L+=S.xOrigin-(S.xOrigin*e+S.yOrigin*i),X+=S.yOrigin-(S.xOrigin*s+S.yOrigin*n),d=1e-6,d>L&&L>-d&&(L=0),d>X&&X>-d&&(X=0)),x=(0|e*P)/P+","+(0|s*P)/P+","+(0|i*P)/P+","+(0|n*P)/P+","+L+","+X+")",E&&xe?this.t.setAttribute("transform","matrix("+x):C[we]=(S.xPercent||S.yPercent?"translate("+S.xPercent+"%,"+S.yPercent+"%) matrix(":"matrix(")+x):C[we]=(S.xPercent||S.yPercent?"translate("+S.xPercent+"%,"+S.yPercent+"%) matrix(":"matrix(")+A+",0,0,"+M+","+L+","+X+")",void 0;if(c&&(d=1e-4,d>A&&A>-d&&(A=D=2e-5),d>M&&M>-d&&(M=D=2e-5),!F||S.z||S.rotationX||S.rotationY||(F=0)),O||S.skewX)O*=N,m=e=Math.cos(O),g=s=Math.sin(O),S.skewX&&(O-=S.skewX*N,m=Math.cos(O),g=Math.sin(O),"simple"===S.skewType&&(v=Math.tan(S.skewX*N),v=Math.sqrt(1+v*v),m*=v,g*=v,S.skewY&&(e*=v,s*=v))),i=-g,n=m;else{if(!(R||k||1!==D||F||E))return C[we]=(S.xPercent||S.yPercent?"translate("+S.xPercent+"%,"+S.yPercent+"%) translate3d(":"translate3d(")+L+"px,"+X+"px,"+z+"px)"+(1!==A||1!==M?" scale("+A+","+M+")":""),void 0;e=n=1,i=s=0}h=1,r=a=o=l=u=f=0,p=F?-1/F:0,_=S.zOrigin,d=1e-6,T=",",w="0",O=R*N,O&&(m=Math.cos(O),g=Math.sin(O),o=-g,u=p*-g,r=e*g,a=s*g,h=m,p*=m,e*=m,s*=m),O=k*N,O&&(m=Math.cos(O),g=Math.sin(O),v=i*m+r*g,y=n*m+a*g,l=h*g,f=p*g,r=i*-g+r*m,a=n*-g+a*m,h*=m,p*=m,i=v,n=y),1!==D&&(r*=D,a*=D,h*=D,p*=D),1!==M&&(i*=M,n*=M,l*=M,f*=M),1!==A&&(e*=A,s*=A,o*=A,u*=A),(_||E)&&(_&&(L+=r*-_,X+=a*-_,z+=h*-_+_),E&&(L+=S.xOrigin-(S.xOrigin*e+S.yOrigin*i),X+=S.yOrigin-(S.xOrigin*s+S.yOrigin*n)),d>L&&L>-d&&(L=w),d>X&&X>-d&&(X=w),d>z&&z>-d&&(z=0)),x=S.xPercent||S.yPercent?"translate("+S.xPercent+"%,"+S.yPercent+"%) matrix3d(":"matrix3d(",x+=(d>e&&e>-d?w:e)+T+(d>s&&s>-d?w:s)+T+(d>o&&o>-d?w:o),x+=T+(d>u&&u>-d?w:u)+T+(d>i&&i>-d?w:i)+T+(d>n&&n>-d?w:n),k||R?(x+=T+(d>l&&l>-d?w:l)+T+(d>f&&f>-d?w:f)+T+(d>r&&r>-d?w:r),x+=T+(d>a&&a>-d?w:a)+T+(d>h&&h>-d?w:h)+T+(d>p&&p>-d?w:p)+T):x+=",0,0,0,0,1,0,",x+=L+T+X+T+z+T+(F?1+-z/F:1)+")",C[we]=x};h=Ce.prototype,h.x=h.y=h.z=h.skewX=h.skewY=h.rotation=h.rotationX=h.rotationY=h.zOrigin=h.xPercent=h.yPercent=0,h.scaleX=h.scaleY=h.scaleZ=1,ve("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent",{parser:function(t,e,i,r,n,o,l){if(r._lastParsedTransform===l)return n;r._lastParsedTransform=l;var h,u,f,p,c,_,d,m=r._transform=De(t,s,!0,l.parseTransform),g=t.style,v=1e-6,y=Te.length,x=l,T={};if("string"==typeof x.transform&&we)f=F.style,f[we]=x.transform,f.display="block",f.position="absolute",z.body.appendChild(F),h=De(F,null,!1),z.body.removeChild(F);else if("object"==typeof x){if(h={scaleX:ne(null!=x.scaleX?x.scaleX:x.scale,m.scaleX),scaleY:ne(null!=x.scaleY?x.scaleY:x.scale,m.scaleY),scaleZ:ne(x.scaleZ,m.scaleZ),x:ne(x.x,m.x),y:ne(x.y,m.y),z:ne(x.z,m.z),xPercent:ne(x.xPercent,m.xPercent),yPercent:ne(x.yPercent,m.yPercent),perspective:ne(x.transformPerspective,m.perspective)},d=x.directionalRotation,null!=d)if("object"==typeof d)for(f in d)x[f]=d[f];else x.rotation=d;"string"==typeof x.x&&-1!==x.x.indexOf("%")&&(h.x=0,h.xPercent=ne(x.x,m.xPercent)),"string"==typeof x.y&&-1!==x.y.indexOf("%")&&(h.y=0,h.yPercent=ne(x.y,m.yPercent)),h.rotation=ae("rotation"in x?x.rotation:"shortRotation"in x?x.shortRotation+"_short":"rotationZ"in x?x.rotationZ:m.rotation,m.rotation,"rotation",T),Se&&(h.rotationX=ae("rotationX"in x?x.rotationX:"shortRotationX"in x?x.shortRotationX+"_short":m.rotationX||0,m.rotationX,"rotationX",T),h.rotationY=ae("rotationY"in x?x.rotationY:"shortRotationY"in x?x.shortRotationY+"_short":m.rotationY||0,m.rotationY,"rotationY",T)),h.skewX=null==x.skewX?m.skewX:ae(x.skewX,m.skewX),h.skewY=null==x.skewY?m.skewY:ae(x.skewY,m.skewY),(u=h.skewY-m.skewY)&&(h.skewX+=u,h.rotation+=u)}for(Se&&null!=x.force3D&&(m.force3D=x.force3D,_=!0),m.skewType=x.skewType||m.skewType||a.defaultSkewType,c=m.force3D||m.z||m.rotationX||m.rotationY||h.z||h.rotationX||h.rotationY||h.perspective,c||null==x.scale||(h.scaleZ=1);--y>-1;)i=Te[y],p=h[i]-m[i],(p>v||-v>p||null!=x[i]||null!=X[i])&&(_=!0,n=new _e(m,i,m[i],p,n),i in T&&(n.e=T[i]),n.xs0=0,n.plugin=o,r._overwriteProps.push(n.n));return p=x.transformOrigin,m.svg&&(p||x.svgOrigin)&&(Me(t,re(p),h,x.svgOrigin),n=new _e(m,"xOrigin",m.xOrigin,h.xOrigin-m.xOrigin,n,-1,"transformOrigin"),n.b=m.xOrigin,n.e=n.xs0=h.xOrigin,n=new _e(m,"yOrigin",m.yOrigin,h.yOrigin-m.yOrigin,n,-1,"transformOrigin"),n.b=m.yOrigin,n.e=n.xs0=h.yOrigin,p=xe?null:"0px 0px"),(p||Se&&c&&m.zOrigin)&&(we?(_=!0,i=Pe,p=(p||Q(t,i,s,!1,"50% 50%"))+"",n=new _e(g,i,0,0,n,-1,"transformOrigin"),n.b=g[i],n.plugin=o,Se?(f=m.zOrigin,p=p.split(" "),m.zOrigin=(p.length>2&&(0===f||"0px"!==p[2])?parseFloat(p[2]):f)||0,n.xs0=n.e=p[0]+" "+(p[1]||"50%")+" 0px",n=new _e(m,"zOrigin",0,0,n,-1,n.n),n.b=f,n.xs0=n.e=m.zOrigin):n.xs0=n.e=p):re(p+"",m)),_&&(r._transformType=m.svg&&xe||!c&&3!==this._transformType?2:3),n},prefix:!0}),ve("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),ve("borderRadius",{defaultValue:"0px",parser:function(t,e,i,n,a){e=this.format(e);var o,l,h,u,f,p,c,_,d,m,g,v,y,x,T,w,b=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],P=t.style;for(d=parseFloat(t.offsetWidth),m=parseFloat(t.offsetHeight),o=e.split(" "),l=0;b.length>l;l++)this.p.indexOf("border")&&(b[l]=G(b[l])),f=u=Q(t,b[l],s,!1,"0px"),-1!==f.indexOf(" ")&&(u=f.split(" "),f=u[0],u=u[1]),p=h=o[l],c=parseFloat(f),v=f.substr((c+"").length),y="="===p.charAt(1),y?(_=parseInt(p.charAt(0)+"1",10),p=p.substr(2),_*=parseFloat(p),g=p.substr((_+"").length-(0>_?1:0))||""):(_=parseFloat(p),g=p.substr((_+"").length)),""===g&&(g=r[i]||v),g!==v&&(x=Z(t,"borderLeft",c,v),T=Z(t,"borderTop",c,v),"%"===g?(f=100*(x/d)+"%",u=100*(T/m)+"%"):"em"===g?(w=Z(t,"borderLeft",1,"em"),f=x/w+"em",u=T/w+"em"):(f=x+"px",u=T+"px"),y&&(p=parseFloat(f)+_+g,h=parseFloat(u)+_+g)),a=de(P,b[l],f+" "+u,p+" "+h,!1,"0px",a);return a},prefix:!0,formatter:fe("0px 0px 0px 0px",!1,!0)}),ve("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,i,r,n,a){var o,l,h,u,f,p,c="background-position",_=s||H(t,null),m=this.format((_?d?_.getPropertyValue(c+"-x")+" "+_.getPropertyValue(c+"-y"):_.getPropertyValue(c):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),g=this.format(e);if(-1!==m.indexOf("%")!=(-1!==g.indexOf("%"))&&(p=Q(t,"backgroundImage").replace(O,""),p&&"none"!==p)){for(o=m.split(" "),l=g.split(" "),I.setAttribute("src",p),h=2;--h>-1;)m=o[h],u=-1!==m.indexOf("%"),u!==(-1!==l[h].indexOf("%"))&&(f=0===h?t.offsetWidth-I.width:t.offsetHeight-I.height,o[h]=u?parseFloat(m)/100*f+"px":100*(parseFloat(m)/f)+"%");m=o.join(" ")}return this.parseComplex(t.style,m,g,n,a)},formatter:re}),ve("backgroundSize",{defaultValue:"0 0",formatter:re}),ve("perspective",{defaultValue:"0px",prefix:!0}),ve("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),ve("transformStyle",{prefix:!0}),ve("backfaceVisibility",{prefix:!0}),ve("userSelect",{prefix:!0}),ve("margin",{parser:pe("marginTop,marginRight,marginBottom,marginLeft")}),ve("padding",{parser:pe("paddingTop,paddingRight,paddingBottom,paddingLeft")}),ve("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,i,r,n,a){var o,l,h;return 9>d?(l=t.currentStyle,h=8>d?" ":",",o="rect("+l.clipTop+h+l.clipRight+h+l.clipBottom+h+l.clipLeft+")",e=this.format(e).split(",").join(h)):(o=this.format(Q(t,this.p,s,!1,this.dflt)),e=this.format(e)),this.parseComplex(t.style,o,e,n,a)}}),ve("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),ve("autoRound,strictUnits",{parser:function(t,e,i,r,s){return s}}),ve("border",{defaultValue:"0px solid #000",parser:function(t,e,i,r,n,a){return this.parseComplex(t.style,this.format(Q(t,"borderTopWidth",s,!1,"0px")+" "+Q(t,"borderTopStyle",s,!1,"solid")+" "+Q(t,"borderTopColor",s,!1,"#000")),this.format(e),n,a)},color:!0,formatter:function(t){var e=t.split(" ");return e[0]+" "+(e[1]||"solid")+" "+(t.match(ue)||["#000"])[0]}}),ve("borderWidth",{parser:pe("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),ve("float,cssFloat,styleFloat",{parser:function(t,e,i,r,s){var n=t.style,a="cssFloat"in n?"cssFloat":"styleFloat";return new _e(n,a,0,0,s,-1,i,!1,0,n[a],e)}});var Xe=function(t){var e,i=this.t,r=i.filter||Q(this.data,"filter")||"",s=0|this.s+this.c*t;100===s&&(-1===r.indexOf("atrix(")&&-1===r.indexOf("radient(")&&-1===r.indexOf("oader(")?(i.removeAttribute("filter"),e=!Q(this.data,"filter")):(i.filter=r.replace(b,""),e=!0)),e||(this.xn1&&(i.filter=r=r||"alpha(opacity="+s+")"),-1===r.indexOf("pacity")?0===s&&this.xn1||(i.filter=r+" alpha(opacity="+s+")"):i.filter=r.replace(T,"opacity="+s))};ve("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,i,r,n,a){var o=parseFloat(Q(t,"opacity",s,!1,"1")),l=t.style,h="autoAlpha"===i;return"string"==typeof e&&"="===e.charAt(1)&&(e=("-"===e.charAt(0)?-1:1)*parseFloat(e.substr(2))+o),h&&1===o&&"hidden"===Q(t,"visibility",s)&&0!==e&&(o=0),U?n=new _e(l,"opacity",o,e-o,n):(n=new _e(l,"opacity",100*o,100*(e-o),n),n.xn1=h?1:0,l.zoom=1,n.type=2,n.b="alpha(opacity="+n.s+")",n.e="alpha(opacity="+(n.s+n.c)+")",n.data=t,n.plugin=a,n.setRatio=Xe),h&&(n=new _e(l,"visibility",0,0,n,-1,null,!1,0,0!==o?"inherit":"hidden",0===e?"hidden":"inherit"),n.xs0="inherit",r._overwriteProps.push(n.n),r._overwriteProps.push(i)),n}});var ze=function(t,e){e&&(t.removeProperty?(("ms"===e.substr(0,2)||"webkit"===e.substr(0,6))&&(e="-"+e),t.removeProperty(e.replace(S,"-$1").toLowerCase())):t.removeAttribute(e))},Ee=function(t){if(this.t._gsClassPT=this,1===t||0===t){this.t.setAttribute("class",0===t?this.b:this.e);for(var e=this.data,i=this.t.style;e;)e.v?i[e.p]=e.v:ze(i,e.p),e=e._next;1===t&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};ve("className",{parser:function(t,e,r,n,a,o,l){var h,u,f,p,c,_=t.getAttribute("class")||"",d=t.style.cssText;if(a=n._classNamePT=new _e(t,r,0,0,a,2),a.setRatio=Ee,a.pr=-11,i=!0,a.b=_,u=K(t,s),f=t._gsClassPT){for(p={},c=f.data;c;)p[c.p]=1,c=c._next;f.setRatio(1)}return t._gsClassPT=a,a.e="="!==e.charAt(1)?e:_.replace(RegExp("\\s*\\b"+e.substr(2)+"\\b"),"")+("+"===e.charAt(0)?" "+e.substr(2):""),t.setAttribute("class",a.e),h=J(t,u,K(t),l,p),t.setAttribute("class",_),a.data=h.firstMPT,t.style.cssText=d,a=a.xfirst=n.parse(t,h.difs,a,o)}});var Fe=function(t){if((1===t||0===t)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var e,i,r,s,n,a=this.t.style,o=l.transform.parse;if("all"===this.e)a.cssText="",s=!0;else for(e=this.e.split(" ").join("").split(","),r=e.length;--r>-1;)i=e[r],l[i]&&(l[i].parse===o?s=!0:i="transformOrigin"===i?Pe:l[i].p),ze(a,i);s&&(ze(a,we),n=this.t._gsTransform,n&&(n.svg&&this.t.removeAttribute("data-svg-origin"),delete this.t._gsTransform))}};for(ve("clearProps",{parser:function(t,e,r,s,n){return n=new _e(t,r,0,0,n,2),n.setRatio=Fe,n.e=e,n.pr=-10,n.data=s._tween,i=!0,n}}),h="bezier,throwProps,physicsProps,physics2D".split(","),me=h.length;me--;)ye(h[me]);h=a.prototype,h._firstPT=h._lastParsedTransform=h._transform=null,h._onInitTween=function(t,e,o){if(!t.nodeType)return!1;this._target=t,this._tween=o,this._vars=e,u=e.autoRound,i=!1,r=e.suffixMap||a.suffixMap,s=H(t,""),n=this._overwriteProps;var h,c,d,m,g,v,y,x,T,b=t.style;if(f&&""===b.zIndex&&(h=Q(t,"zIndex",s),("auto"===h||""===h)&&this._addLazySet(b,"zIndex",0)),"string"==typeof e&&(m=b.cssText,h=K(t,s),b.cssText=m+";"+e,h=J(t,h,K(t)).difs,!U&&w.test(e)&&(h.opacity=parseFloat(RegExp.$1)),e=h,b.cssText=m),this._firstPT=c=e.className?l.className.parse(t,e.className,"className",this,null,null,e):this.parse(t,e,null),this._transformType){for(T=3===this._transformType,we?p&&(f=!0,""===b.zIndex&&(y=Q(t,"zIndex",s),("auto"===y||""===y)&&this._addLazySet(b,"zIndex",0)),_&&this._addLazySet(b,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(T?"visible":"hidden"))):b.zoom=1,d=c;d&&d._next;)d=d._next;x=new _e(t,"transform",0,0,null,2),this._linkCSSP(x,null,d),x.setRatio=we?Le:Ne,x.data=this._transform||De(t,s,!0),x.tween=o,x.pr=-1,n.pop()}if(i){for(;c;){for(v=c._next,d=m;d&&d.pr>c.pr;)d=d._next;(c._prev=d?d._prev:g)?c._prev._next=c:m=c,(c._next=d)?d._prev=c:g=c,c=v}this._firstPT=m}return!0},h.parse=function(t,e,i,n){var a,o,h,f,p,c,_,d,m,g,v=t.style;for(a in e)c=e[a],o=l[a],o?i=o.parse(t,c,a,this,i,n,e):(p=Q(t,a,s)+"",m="string"==typeof c,"color"===a||"fill"===a||"stroke"===a||-1!==a.indexOf("Color")||m&&P.test(c)?(m||(c=he(c),c=(c.length>3?"rgba(":"rgb(")+c.join(",")+")"),i=de(v,a,p,c,!0,"transparent",i,0,n)):!m||-1===c.indexOf(" ")&&-1===c.indexOf(",")?(h=parseFloat(p),_=h||0===h?p.substr((h+"").length):"",(""===p||"auto"===p)&&("width"===a||"height"===a?(h=ie(t,a,s),_="px"):"left"===a||"top"===a?(h=$(t,a,s),_="px"):(h="opacity"!==a?0:1,_="")),g=m&&"="===c.charAt(1),g?(f=parseInt(c.charAt(0)+"1",10),c=c.substr(2),f*=parseFloat(c),d=c.replace(x,"")):(f=parseFloat(c),d=m?c.replace(x,""):""),""===d&&(d=a in r?r[a]:_),c=f||0===f?(g?f+h:f)+d:e[a],_!==d&&""!==d&&(f||0===f)&&h&&(h=Z(t,a,h,_),"%"===d?(h/=Z(t,a,100,"%")/100,e.strictUnits!==!0&&(p=h+"%")):"em"===d?h/=Z(t,a,1,"em"):"px"!==d&&(f=Z(t,a,f,d),d="px"),g&&(f||0===f)&&(c=f+h+d)),g&&(f+=h),!h&&0!==h||!f&&0!==f?void 0!==v[a]&&(c||"NaN"!=c+""&&null!=c)?(i=new _e(v,a,f||h||0,0,i,-1,a,!1,0,p,c),i.xs0="none"!==c||"display"!==a&&-1===a.indexOf("Style")?c:p):V("invalid "+a+" tween value: "+e[a]):(i=new _e(v,a,h,f-h,i,0,a,u!==!1&&("px"===d||"zIndex"===a),0,p,c),i.xs0=d)):i=de(v,a,p,c,!0,null,i,0,n)),n&&i&&!i.plugin&&(i.plugin=n);
return i},h.setRatio=function(t){var e,i,r,s=this._firstPT,n=1e-6;if(1!==t||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(t||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;s;){if(e=s.c*t+s.s,s.r?e=Math.round(e):n>e&&e>-n&&(e=0),s.type)if(1===s.type)if(r=s.l,2===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2;else if(3===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2+s.xn2+s.xs3;else if(4===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2+s.xn2+s.xs3+s.xn3+s.xs4;else if(5===r)s.t[s.p]=s.xs0+e+s.xs1+s.xn1+s.xs2+s.xn2+s.xs3+s.xn3+s.xs4+s.xn4+s.xs5;else{for(i=s.xs0+e+s.xs1,r=1;s.l>r;r++)i+=s["xn"+r]+s["xs"+(r+1)];s.t[s.p]=i}else-1===s.type?s.t[s.p]=s.xs0:s.setRatio&&s.setRatio(t);else s.t[s.p]=e+s.xs0;s=s._next}else for(;s;)2!==s.type?s.t[s.p]=s.b:s.setRatio(t),s=s._next;else for(;s;)2!==s.type?s.t[s.p]=s.e:s.setRatio(t),s=s._next},h._enableTransforms=function(t){this._transform=this._transform||De(this._target,s,!0),this._transformType=this._transform.svg&&xe||!t&&3!==this._transformType?2:3};var Ie=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};h._addLazySet=function(t,e,i){var r=this._firstPT=new _e(t,e,0,0,this._firstPT,2);r.e=i,r.setRatio=Ie,r.data=this},h._linkCSSP=function(t,e,i,r){return t&&(e&&(e._prev=t),t._next&&(t._next._prev=t._prev),t._prev?t._prev._next=t._next:this._firstPT===t&&(this._firstPT=t._next,r=!0),i?i._next=t:r||null!==this._firstPT||(this._firstPT=t),t._next=e,t._prev=i),t},h._kill=function(e){var i,r,s,n=e;if(e.autoAlpha||e.alpha){n={};for(r in e)n[r]=e[r];n.opacity=1,n.autoAlpha&&(n.visibility=1)}return e.className&&(i=this._classNamePT)&&(s=i.xfirst,s&&s._prev?this._linkCSSP(s._prev,i._next,s._prev._prev):s===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,s._prev),this._classNamePT=null),t.prototype._kill.call(this,n)};var Ye=function(t,e,i){var r,s,n,a;if(t.slice)for(s=t.length;--s>-1;)Ye(t[s],e,i);else for(r=t.childNodes,s=r.length;--s>-1;)n=r[s],a=n.type,n.style&&(e.push(K(n)),i&&i.push(n)),1!==a&&9!==a&&11!==a||!n.childNodes.length||Ye(n,e,i)};return a.cascadeTo=function(t,i,r){var s,n,a,o,l=e.to(t,i,r),h=[l],u=[],f=[],p=[],c=e._internals.reservedProps;for(t=l._targets||l.target,Ye(t,u,p),l.render(i,!0,!0),Ye(t,f),l.render(0,!0,!0),l._enabled(!0),s=p.length;--s>-1;)if(n=J(p[s],u[s],f[s]),n.firstMPT){n=n.difs;for(a in r)c[a]&&(n[a]=r[a]);o={};for(a in n)o[a]=u[s][a];h.push(e.fromTo(p[s],i,o,n))}return h},t.activate([a]),a},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t){"use strict";var e=function(){return(_gsScope.GreenSockGlobals||_gsScope)[t]};"function"==typeof define&&define.amd?define(["TweenLite"],e):"undefined"!=typeof module&&module.exports&&(require("../TweenLite.js"),module.exports=e())}("CSSPlugin");
;
;
/*! rx.all.min.js */ 
;
;
/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){function b(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b}function c(a,b){if(Ma&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(Qa)){for(var c=[],e=b;e;e=e.source)e.stack&&c.unshift(e.stack);c.unshift(a.stack);var f=c.join("\n"+Qa+"\n");a.stack=d(f)}}function d(a){for(var b=a.split("\n"),c=[],d=0,g=b.length;g>d;d++){var h=b[d];e(h)||f(h)||!h||c.push(h)}return c.join("\n")}function e(a){var b=h(a);if(!b)return!1;var c=b[0],d=b[1];return c===Oa&&d>=Pa&&Nd>=d}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(){if(Ma)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=h(c);if(!d)return;return Oa=d[0],d[1]}}function h(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function i(a){var b=[];if(!xb(a))return b;wb.nonEnumArgs&&a.length&&yb(a)&&(a=Bb.call(a));var c=wb.enumPrototypes&&"function"==typeof a,d=wb.enumErrorProps&&(a===rb||a instanceof Error);for(var e in a)c&&"prototype"==e||d&&("message"==e||"name"==e)||b.push(e);if(wb.nonEnumShadows&&a!==sb){var f=a.constructor,g=-1,h=db;if(a===(f&&f.prototype))var i=a===tb?nb:a===rb?ib:ob.call(a),j=vb[i];for(;++g<h;)e=cb[g],j&&j[e]||!pb.call(a,e)||b.push(e)}return b}function j(a,b,c){for(var d=-1,e=c(a),f=e.length;++d<f;){var g=e[d];if(b(a[g],g,a)===!1)break}return a}function k(a,b){return j(a,b,i)}function l(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function m(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;var e=typeof a,f=typeof b;if(a===a&&(null==a||null==b||"function"!=e&&"object"!=e&&"function"!=f&&"object"!=f))return!1;var g=ob.call(a),h=ob.call(b);if(g==eb&&(g=lb),h==eb&&(h=lb),g!=h)return!1;switch(g){case gb:case hb:return+a==+b;case kb:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case mb:case nb:return a==String(b)}var i=g==fb;if(!i){if(g!=lb||!wb.nodeClass&&(l(a)||l(b)))return!1;var j=!wb.argsObject&&yb(a)?Object:a.constructor,n=!wb.argsObject&&yb(b)?Object:b.constructor;if(!(j==n||pb.call(a,"constructor")&&pb.call(b,"constructor")||La(j)&&j instanceof j&&La(n)&&n instanceof n||!("constructor"in a&&"constructor"in b)))return!1}c||(c=[]),d||(d=[]);for(var o=c.length;o--;)if(c[o]==a)return d[o]==b;var p=0,q=!0;if(c.push(a),d.push(b),i){if(o=a.length,p=b.length,q=p==o)for(;p--;){var r=b[p];if(!(q=m(a[p],r,c,d)))break}}else k(b,function(b,e,f){return pb.call(f,e)?(p++,q=pb.call(a,e)&&m(a[e],b,c,d)):void 0}),q&&k(a,function(a,b,c){return pb.call(c,b)?q=--p>-1:void 0});return c.pop(),d.pop(),q}function n(a,b){for(var c=new Array(a),d=0;a>d;d++)c[d]=b();return c}function o(){try{return zb.apply(this,arguments)}catch(a){return Fb.e=a,Fb}}function p(a){if(!La(a))throw new TypeError("fn must be a function");return zb=a,o}function q(a){throw a}function r(a,b){this.id=a,this.value=b}function t(a,b){this.scheduler=a,this.disposable=b,this.isDisposed=!1}function u(a,b){b.isDisposed||(b.isDisposed=!0,b.disposable.dispose())}function v(a){this._s=s}function w(a){this._s=s,this._l=s.length,this._i=0}function x(a){this._a=a}function y(a){this._a=a,this._l=C(a),this._i=0}function z(a){return"number"==typeof a&&xa.isFinite(a)}function A(b){var c,d=b[Ya];if(!d&&"string"==typeof b)return c=new v(b),c[Ya]();if(!d&&b.length!==a)return c=new x(b),c[Ya]();if(!d)throw new TypeError("Object is not iterable");return b[Ya]()}function B(a){var b=+a;return 0===b?b:isNaN(b)?b:0>b?-1:1}function C(a){var b=+a.length;return isNaN(b)?0:0!==b&&z(b)?(b=B(b)*Math.floor(Math.abs(b)),0>=b?0:b>Hc?Hc:b):b}function D(a,b){this.observer=a,this.parent=b}function E(a,b){return Vb(a)||(a=$b),new Jc(b,a)}function F(a,b){this.observer=a,this.parent=b}function G(a,b){this.observer=a,this.parent=b}function H(a,b){return new Hd(function(c){var d=new Pb,e=new Qb;return e.setDisposable(d),d.setDisposable(a.subscribe(function(a){c.onNext(a)},function(a){try{var d=b(a)}catch(f){return c.onError(f)}Ja(d)&&(d=Ac(d));var g=new Pb;e.setDisposable(g),g.setDisposable(d.subscribe(c))},function(a){c.onCompleted(a)})),e},a)}function I(){return!1}function J(a,b){var c=this;return new Hd(function(d){var e=0,f=a.length;return c.subscribe(function(c){if(f>e){var g=a[e++],h=p(b)(c,g);if(h===Fb)return d.onError(h.e);d.onNext(h)}else d.onCompleted()},function(a){d.onError(a)},function(){d.onCompleted()})},c)}function I(){return!1}function K(){return[]}function I(){return!1}function L(){return[]}function M(a,b){this.observer=a,this.accumulator=b.accumulator,this.hasSeed=b.hasSeed,this.seed=b.seed,this.hasAccumulation=!1,this.accumulation=null,this.hasValue=!1,this.isStopped=!1}function N(a,b,c){var d=bb(b,c,3);return a.map(function(b,c){var e=d(b,c,a);return Ja(e)&&(e=Ac(e)),(_a(e)||$a(e))&&(e=Ic(e)),e}).concatAll()}function O(a,b,c){for(var d=0,e=a.length;e>d;d++)if(c(a[d],b))return d;return-1}function P(a){this.comparer=a,this.set=[]}function Q(a,b,c){var d=bb(b,c,3);return a.map(function(b,c){var e=d(b,c,a);return Ja(e)&&(e=Ac(e)),(_a(e)||$a(e))&&(e=Ic(e)),e}).mergeAll()}function R(a,b,c){return new Hd(function(d){var e=!1,f=null,g=[];return a.subscribe(function(a){var h,i;try{i=b(a)}catch(j){return void d.onError(j)}if(h=0,e)try{h=c(i,f)}catch(k){return void d.onError(k)}else e=!0,f=i;h>0&&(f=i,g=[]),h>=0&&g.push(a)},function(a){d.onError(a)},function(){d.onNext(g),d.onCompleted()})},a)}function S(a){if(0===a.length)throw new Ra;return a[0]}function T(a,b,c,d){if(0>b)throw new Ta;return new Hd(function(e){var f=b;return a.subscribe(function(a){0===f--&&(e.onNext(a),e.onCompleted())},function(a){e.onError(a)},function(){c?(e.onNext(d),e.onCompleted()):e.onError(new Ta)})},a)}function U(a,b,c){return new Hd(function(d){var e=c,f=!1;return a.subscribe(function(a){f?d.onError(new Error("Sequence contains more than one element")):(e=a,f=!0)},function(a){d.onError(a)},function(){f||b?(d.onNext(e),d.onCompleted()):d.onError(new Ra)})},a)}function V(a,b,c){return new Hd(function(d){return a.subscribe(function(a){d.onNext(a),d.onCompleted()},function(a){d.onError(a)},function(){b?(d.onNext(c),d.onCompleted()):d.onError(new Ra)})},a)}function W(a,b,c){return new Hd(function(d){var e=c,f=!1;return a.subscribe(function(a){e=a,f=!0},function(a){d.onError(a)},function(){f||b?(d.onNext(e),d.onCompleted()):d.onError(new Ra)})},a)}function X(b,c,d,e){var f=bb(c,d,3);return new Hd(function(c){var d=0;return b.subscribe(function(a){var g;try{g=f(a,d,b)}catch(h){return void c.onError(h)}g?(c.onNext(e?d:a),c.onCompleted()):d++},function(a){c.onError(a)},function(){c.onNext(e?-1:a),c.onCompleted()})},b)}function Y(a,b){return Array.isArray(a)?Z.call(b,a):ba(a)?nd(a.call(b)):ca(a)?nd(a):aa(a)?$(a):Ja(a)?_(a):typeof a===ld?a:xb(a)||Array.isArray(a)?Z.call(b,a):a}function Z(a){var b=this;return function(c){function d(a,d){if(!e)try{if(a=Y(a,b),typeof a!==ld)return h[d]=a,--g||c(null,h);a.call(b,function(a,b){if(!e){if(a)return e=!0,c(a);h[d]=b,--g||c(null,h)}})}catch(f){e=!0,c(f)}}var e,f=Object.keys(a),g=f.length,h=new a.constructor;if(!g)return void cc.schedule(function(){c(null,h)});for(var i=0,j=f.length;j>i;i++)d(a[f[i]],f[i])}}function $(a){return function(b){var c,d=!1;a.subscribe(function(a){c=a,d=!0},b,function(){d&&b(null,c)})}}function _(a){return function(b){a.then(function(a){b(null,a)},b)}}function aa(a){return a&&typeof a.subscribe===ld}function ba(a){return a&&a.constructor&&"GeneratorFunction"===a.constructor.name}function ca(a){return a&&typeof a.next===ld&&typeof a[md]===ld}function da(a){a&&cc.schedule(function(){throw a})}function ea(a,b,c){if(a.addEventListener)return a.addEventListener(b,c,!1),Lb(function(){a.removeEventListener(b,c,!1)});throw new Error("No listener found")}function fa(a,b,c){var d=new Ib,e=Object.prototype.toString;if("[object NodeList]"===e.call(a)||"[object HTMLCollection]"===e.call(a))for(var f=0,g=a.length;g>f;f++)d.add(fa(a.item(f),b,c));else a&&d.add(ea(a,b,c));return d}function ga(a,b,c){return new Hd(function(d){function e(a,b){if(j[b]=a,g[b]=!0,h||(h=g.every(Ea))){if(f)return d.onError(f);var e=p(c).apply(null,j);if(e===Fb)return d.onError(e.e);d.onNext(e)}i&&j[1]&&d.onCompleted()}var f,g=[!1,!1],h=!1,i=!1,j=new Array(2);return new Ib(a.subscribe(function(a){e(a,0)},function(a){j[1]?d.onError(a):f=a},function(){i=!0,j[1]&&d.onCompleted()}),b.subscribe(function(a){e(a,1)},function(a){d.onError(a)},function(){i=!0,e(!0,1)}))},a)}function ha(a,b){return a.groupJoin(this,b,Ec,function(a,b){return b})}function ia(a){var b=this;return new Hd(function(c){var d=new Kd,e=new Ib,f=new Rb(e);return c.onNext(Eb(d,f)),e.add(b.subscribe(function(a){d.onNext(a)},function(a){d.onError(a),c.onError(a)},function(){d.onCompleted(),c.onCompleted()})),Ja(a)&&(a=Ac(a)),e.add(a.subscribe(function(a){d.onCompleted(),d=new Kd,c.onNext(Eb(d,f))},function(a){d.onError(a),c.onError(a)},function(){d.onCompleted(),c.onCompleted()})),f},b)}function ja(a){var b=this;return new Hd(function(c){function d(){var b;try{b=a()}catch(f){return void c.onError(f)}Ja(b)&&(b=Ac(b));var i=new Pb;e.setDisposable(i),i.setDisposable(b.take(1).subscribe(Da,function(a){h.onError(a),c.onError(a)},function(){h.onCompleted(),h=new Kd,c.onNext(Eb(h,g)),d()}))}var e=new Qb,f=new Ib(e),g=new Rb(f),h=new Kd;return c.onNext(Eb(h,g)),f.add(b.subscribe(function(a){h.onNext(a)},function(a){h.onError(a),c.onError(a)},function(){h.onCompleted(),c.onCompleted()})),d(),g},b)}function ka(a,b){return new Bd(a,b)}function la(a){this.patterns=a}function ma(a,b){this.expression=a,this.selector=b}function na(a,b,c){var d=a.get(b);if(!d){var e=new Fd(b,c);return a.set(b,e),e}return d}function oa(a,b,c){this.joinObserverArray=a,this.onNext=b,this.onCompleted=c,this.joinObservers=new Ed;for(var d=0,e=this.joinObserverArray.length;e>d;d++){var f=this.joinObserverArray[d];this.joinObservers.set(f,f)}}function pa(a,b){return new Hd(function(c){return b.scheduleWithAbsolute(a,function(){c.onNext(0),c.onCompleted()})})}function qa(a,b,c){return new Hd(function(d){var e=a,f=Ub(b);return c.scheduleRecursiveWithAbsoluteAndState(0,e,function(a,b){if(f>0){var g=c.now();e+=f,g>=e&&(e=g+f)}d.onNext(a),b(a+1,e)})})}function ra(a,b){return new Hd(function(c){return b.scheduleWithRelative(Ub(a),function(){c.onNext(0),c.onCompleted()})})}function sa(a,b,c){return a===b?new Hd(function(a){return c.schedulePeriodicWithState(0,b,function(b){return a.onNext(b),b+1})}):Cc(function(){return qa(c.now()+a,b,c)})}function ta(a,b,c){return new Hd(function(d){var e,f=!1,g=new Qb,h=null,i=[],j=!1;return e=a.materialize().timestamp(c).subscribe(function(a){var e,k;"E"===a.value.kind?(i=[],i.push(a),h=a.value.exception,k=!j):(i.push({value:a.value,timestamp:a.timestamp+b}),k=!f,f=!0),k&&(null!==h?d.onError(h):(e=new Pb,g.setDisposable(e),e.setDisposable(c.scheduleRecursiveWithRelative(b,function(a){var b,e,g,k;if(null===h){j=!0;do g=null,i.length>0&&i[0].timestamp-c.now()<=0&&(g=i.shift().value),null!==g&&g.accept(d);while(null!==g);k=!1,e=0,i.length>0?(k=!0,e=Math.max(0,i[0].timestamp-c.now())):f=!1,b=h,j=!1,null!==b?d.onError(b):k&&a(e)}}))))}),new Ib(e,g)},a)}function ua(a,b,c){return Cc(function(){return ta(a,b-c.now(),c)})}function va(a,b){return new Hd(function(c){function d(){g&&(g=!1,c.onNext(e)),f&&c.onCompleted()}var e,f=!1,g=!1,h=new Pb;return h.setDisposable(a.subscribe(function(a){g=!0,e=a},function(a){c.onError(a)},function(){f=!0,h.dispose()})),new Ib(h,b.subscribe(d,function(a){c.onError(a)},d))},a)}var wa={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},xa=wa[typeof window]&&window||this,ya=wa[typeof exports]&&exports&&!exports.nodeType&&exports,za=wa[typeof module]&&module&&!module.nodeType&&module,Aa=za&&za.exports===ya&&ya,Ba=wa[typeof global]&&global;!Ba||Ba.global!==Ba&&Ba.window!==Ba||(xa=Ba);var Ca={internals:{},config:{Promise:xa.Promise},helpers:{}},Da=Ca.helpers.noop=function(){},Ea=(Ca.helpers.notDefined=function(a){return"undefined"==typeof a},Ca.helpers.identity=function(a){return a}),Fa=(Ca.helpers.pluck=function(a){return function(b){return b[a]}},Ca.helpers.just=function(a){return function(){return a}},Ca.helpers.defaultNow=Date.now),Ga=Ca.helpers.defaultComparer=function(a,b){return Ab(a,b)},Ha=Ca.helpers.defaultSubComparer=function(a,b){return a>b?1:b>a?-1:0},Ia=(Ca.helpers.defaultKeySerializer=function(a){return a.toString()},Ca.helpers.defaultError=function(a){throw a}),Ja=Ca.helpers.isPromise=function(a){return!!a&&"function"!=typeof a.subscribe&&"function"==typeof a.then},Ka=(Ca.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},Ca.helpers.not=function(a){return!a}),La=Ca.helpers.isFunction=function(){var a=function(a){return"function"==typeof a||!1};return a(/x/)&&(a=function(a){return"function"==typeof a&&"[object Function]"==ob.call(a)}),a}();Ca.config.longStackSupport=!1;var Ma=!1;try{throw new Error}catch(Na){Ma=!!Na.stack}var Oa,Pa=g(),Qa="From previous event:",Ra=Ca.EmptyError=function(){this.message="Sequence contains no elements.",Error.call(this)};Ra.prototype=Error.prototype;var Sa=Ca.ObjectDisposedError=function(){this.message="Object has been disposed",Error.call(this)};Sa.prototype=Error.prototype;var Ta=Ca.ArgumentOutOfRangeError=function(){this.message="Argument out of range",Error.call(this)};Ta.prototype=Error.prototype;var Ua=Ca.NotSupportedError=function(a){this.message=a||"This operation is not supported",Error.call(this)};Ua.prototype=Error.prototype;var Va=Ca.NotImplementedError=function(a){this.message=a||"This operation is not implemented",Error.call(this)};Va.prototype=Error.prototype;var Wa=Ca.helpers.notImplemented=function(){throw new Va},Xa=Ca.helpers.notSupported=function(){throw new Ua},Ya="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";xa.Set&&"function"==typeof(new xa.Set)["@@iterator"]&&(Ya="@@iterator");var Za=Ca.doneEnumerator={done:!0,value:a},$a=Ca.helpers.isIterable=function(b){return b[Ya]!==a},_a=Ca.helpers.isArrayLike=function(b){return b&&b.length!==a};Ca.helpers.iterator=Ya;var ab,bb=Ca.internals.bindCallback=function(a,b,c){if("undefined"==typeof b)return a;switch(c){case 0:return function(){return a.call(b)};case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},cb=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],db=cb.length,eb="[object Arguments]",fb="[object Array]",gb="[object Boolean]",hb="[object Date]",ib="[object Error]",jb="[object Function]",kb="[object Number]",lb="[object Object]",mb="[object RegExp]",nb="[object String]",ob=Object.prototype.toString,pb=Object.prototype.hasOwnProperty,qb=ob.call(arguments)==eb,rb=Error.prototype,sb=Object.prototype,tb=String.prototype,ub=sb.propertyIsEnumerable;try{ab=!(ob.call(document)==lb&&!({toString:0}+""))}catch(Na){ab=!0}var vb={};vb[fb]=vb[hb]=vb[kb]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},vb[gb]=vb[nb]={constructor:!0,toString:!0,valueOf:!0},vb[ib]=vb[jb]=vb[mb]={constructor:!0,toString:!0},vb[lb]={constructor:!0};var wb={};!function(){var a=function(){this.x=1},b=[];a.prototype={valueOf:1,y:1};for(var c in new a)b.push(c);for(c in arguments);wb.enumErrorProps=ub.call(rb,"message")||ub.call(rb,"name"),wb.enumPrototypes=ub.call(a,"prototype"),wb.nonEnumArgs=0!=c,wb.nonEnumShadows=!/valueOf/.test(b)}(1);var xb=Ca.internals.isObject=function(a){var b=typeof a;return a&&("function"==b||"object"==b)||!1},yb=function(a){return a&&"object"==typeof a?ob.call(a)==eb:!1};qb||(yb=function(a){return a&&"object"==typeof a?pb.call(a,"callee"):!1});var zb,Ab=Ca.internals.isEqual=function(a,b){return m(a,b,[],[])},Bb=({}.hasOwnProperty,Array.prototype.slice),Cb=this.inherits=Ca.internals.inherits=function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c},Db=Ca.internals.addProperties=function(a){for(var b=[],c=1,d=arguments.length;d>c;c++)b.push(arguments[c]);for(var e=0,f=b.length;f>e;e++){var g=b[e];for(var h in g)a[h]=g[h]}},Eb=Ca.internals.addRef=function(a,b){return new Hd(function(c){return new Ib(b.getDisposable(),a.subscribe(c))})},Fb={e:{}};r.prototype.compareTo=function(a){var b=this.value.compareTo(a.value);return 0===b&&(b=this.id-a.id),b};var Gb=Ca.internals.PriorityQueue=function(a){this.items=new Array(a),this.length=0},Hb=Gb.prototype;Hb.isHigherPriority=function(a,b){return this.items[a].compareTo(this.items[b])<0},Hb.percolate=function(a){if(!(a>=this.length||0>a)){var b=a-1>>1;if(!(0>b||b===a)&&this.isHigherPriority(a,b)){var c=this.items[a];this.items[a]=this.items[b],this.items[b]=c,this.percolate(b)}}},Hb.heapify=function(a){if(+a||(a=0),!(a>=this.length||0>a)){var b=2*a+1,c=2*a+2,d=a;if(b<this.length&&this.isHigherPriority(b,d)&&(d=b),c<this.length&&this.isHigherPriority(c,d)&&(d=c),d!==a){var e=this.items[a];this.items[a]=this.items[d],this.items[d]=e,this.heapify(d)}}},Hb.peek=function(){return this.items[0].value},Hb.removeAt=function(b){this.items[b]=this.items[--this.length],this.items[this.length]=a,this.heapify()},Hb.dequeue=function(){var a=this.peek();return this.removeAt(0),a},Hb.enqueue=function(a){var b=this.length++;this.items[b]=new r(Gb.count++,a),this.percolate(b)},Hb.remove=function(a){for(var b=0;b<this.length;b++)if(this.items[b].value===a)return this.removeAt(b),!0;return!1},Gb.count=0;var Ib=Ca.CompositeDisposable=function(){var a,b,c=[];if(Array.isArray(arguments[0]))c=arguments[0],b=c.length;else for(b=arguments.length,c=new Array(b),a=0;b>a;a++)c[a]=arguments[a];for(a=0;b>a;a++)if(!Nb(c[a]))throw new TypeError("Not a disposable");this.disposables=c,this.isDisposed=!1,this.length=c.length},Jb=Ib.prototype;Jb.add=function(a){this.isDisposed?a.dispose():(this.disposables.push(a),this.length++)},Jb.remove=function(a){var b=!1;if(!this.isDisposed){var c=this.disposables.indexOf(a);-1!==c&&(b=!0,this.disposables.splice(c,1),this.length--,a.dispose())}return b},Jb.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var a=this.disposables.length,b=new Array(a),c=0;a>c;c++)b[c]=this.disposables[c];for(this.disposables=[],this.length=0,c=0;a>c;c++)b[c].dispose()}};var Kb=Ca.Disposable=function(a){this.isDisposed=!1,this.action=a||Da};Kb.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var Lb=Kb.create=function(a){return new Kb(a)},Mb=Kb.empty={dispose:Da},Nb=Kb.isDisposable=function(a){return a&&La(a.dispose)},Ob=Kb.checkDisposed=function(a){if(a.isDisposed)throw new Sa},Pb=Ca.SingleAssignmentDisposable=function(){this.isDisposed=!1,this.current=null};Pb.prototype.getDisposable=function(){return this.current},Pb.prototype.setDisposable=function(a){if(this.current)throw new Error("Disposable has already been assigned");var b=this.isDisposed;!b&&(this.current=a),b&&a&&a.dispose()},Pb.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var a=this.current;this.current=null}a&&a.dispose()};var Qb=Ca.SerialDisposable=function(){this.isDisposed=!1,this.current=null};Qb.prototype.getDisposable=function(){return this.current},Qb.prototype.setDisposable=function(a){var b=this.isDisposed;if(!b){var c=this.current;this.current=a}c&&c.dispose(),b&&a&&a.dispose()},Qb.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var a=this.current;this.current=null}a&&a.dispose()};var Rb=Ca.RefCountDisposable=function(){function a(a){this.disposable=a,this.disposable.count++,this.isInnerDisposed=!1}function b(a){this.underlyingDisposable=a,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return a.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},b.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},b.prototype.getDisposable=function(){return this.isDisposed?Mb:new a(this)},b}();t.prototype.dispose=function(){this.scheduler.scheduleWithState(this,u)};var Sb=Ca.internals.ScheduledItem=function(a,b,c,d,e){this.scheduler=a,this.state=b,this.action=c,this.dueTime=d,this.comparer=e||Ha,this.disposable=new Pb};Sb.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},Sb.prototype.compareTo=function(a){return this.comparer(this.dueTime,a.dueTime)},Sb.prototype.isCancelled=function(){return this.disposable.isDisposed},Sb.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var Tb=Ca.Scheduler=function(){function a(a,b,c,d){this.now=a,this._schedule=b,this._scheduleRelative=c,this._scheduleAbsolute=d}function b(a,b){return b(),Mb}a.isScheduler=function(b){return b instanceof a};var c=a.prototype;return c.schedule=function(a){return this._schedule(a,b)},c.scheduleWithState=function(a,b){return this._schedule(a,b)},c.scheduleWithRelative=function(a,c){return this._scheduleRelative(c,a,b)},c.scheduleWithRelativeAndState=function(a,b,c){return this._scheduleRelative(a,b,c)},c.scheduleWithAbsolute=function(a,c){return this._scheduleAbsolute(c,a,b)},c.scheduleWithAbsoluteAndState=function(a,b,c){return this._scheduleAbsolute(a,b,c)},a.now=Fa,a.normalize=function(a){return 0>a&&(a=0),a},a}(),Ub=Tb.normalize,Vb=Tb.isScheduler;!function(a){function b(a,b){function c(b){e(b,function(b){var d=!1,e=!1,g=a.scheduleWithState(b,function(a,b){return d?f.remove(g):e=!0,c(b),Mb});e||(f.add(g),d=!0)})}var d=b[0],e=b[1],f=new Ib;return c(d),f}function c(a,b,c){function d(b){f(b,function(b,e){var f=!1,h=!1,i=a[c](b,e,function(a,b){return f?g.remove(i):h=!0,d(b),Mb});h||(g.add(i),f=!0)})}var e=b[0],f=b[1],g=new Ib;return d(e),g}function d(a,b){a(function(c){b(a,c)})}a.scheduleRecursive=function(a){return this.scheduleRecursiveWithState(a,d)},a.scheduleRecursiveWithState=function(a,c){return this.scheduleWithState([a,c],b)},a.scheduleRecursiveWithRelative=function(a,b){return this.scheduleRecursiveWithRelativeAndState(b,a,d)},a.scheduleRecursiveWithRelativeAndState=function(a,b,d){return this._scheduleRelative([a,d],b,function(a,b){return c(a,b,"scheduleWithRelativeAndState")})},a.scheduleRecursiveWithAbsolute=function(a,b){return this.scheduleRecursiveWithAbsoluteAndState(b,a,d)},a.scheduleRecursiveWithAbsoluteAndState=function(a,b,d){return this._scheduleAbsolute([a,d],b,function(a,b){return c(a,b,"scheduleWithAbsoluteAndState")})}}(Tb.prototype),function(a){Tb.prototype.schedulePeriodic=function(a,b){return this.schedulePeriodicWithState(null,a,b)},Tb.prototype.schedulePeriodicWithState=function(a,b,c){if("undefined"==typeof xa.setInterval)throw new Ua;b=Ub(b);var d=a,e=xa.setInterval(function(){d=c(d)},b);return Lb(function(){xa.clearInterval(e)})}}(Tb.prototype),function(a){a.catchError=a["catch"]=function(a){return new dc(this,a)}}(Tb.prototype);var Wb,Xb,Yb=Ca.internals.SchedulePeriodicRecursive=function(){function a(a,b){b(0,this._period);try{this._state=this._action(this._state)}catch(c){throw this._cancel.dispose(),c}}function b(a,b,c,d){this._scheduler=a,this._state=b,this._period=c,this._action=d}return b.prototype.start=function(){var b=new Pb;return this._cancel=b,b.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,a.bind(this))),b},b}(),Zb=Tb.immediate=function(){function a(a,b){return b(this,a)}return new Tb(Fa,a,Xa,Xa)}(),$b=Tb.currentThread=function(){function a(){for(;c.length>0;){var a=c.dequeue();!a.isCancelled()&&a.invoke()}}function b(b,d){var e=new Sb(this,b,d,this.now());if(c)c.enqueue(e);else{c=new Gb(4),c.enqueue(e);var f=p(a)();if(c=null,f===Fb)return q(f.e)}return e.disposable}var c,d=new Tb(Fa,b,Xa,Xa);return d.scheduleRequired=function(){return!c},d}(),_b=function(){var a,b=Da;if(xa.setTimeout)a=xa.setTimeout,b=xa.clearTimeout;else{if(!xa.WScript)throw new Ua;a=function(a,b){xa.WScript.Sleep(b),a()}}return{setTimeout:a,clearTimeout:b}}(),ac=_b.setTimeout,bc=_b.clearTimeout;!function(){function a(b){if(f)ac(function(){a(b)},0);else{var c=e[b];if(c){f=!0;var d=p(c)();if(Xb(b),f=!1,d===Fb)return q(d.e)}}}function b(){if(!xa.postMessage||xa.importScripts)return!1;var a=!1,b=xa.onmessage;return xa.onmessage=function(){a=!0},xa.postMessage("","*"),xa.onmessage=b,a}function c(b){"string"==typeof b.data&&b.data.substring(0,i.length)===i&&a(b.data.substring(i.length))}var d=1,e={},f=!1;Xb=function(a){delete e[a]};var g=RegExp("^"+String(ob).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),h="function"==typeof(h=Ba&&Aa&&Ba.setImmediate)&&!g.test(h)&&h;if(La(h))Wb=function(b){var c=d++;return e[c]=b,h(function(){a(c)}),c};else if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))Wb=function(b){var c=d++;return e[c]=b,process.nextTick(function(){a(c)}),c};else if(b()){var i="ms.rx.schedule"+Math.random();xa.addEventListener?xa.addEventListener("message",c,!1):xa.attachEvent?xa.attachEvent("onmessage",c):xa.onmessage=c,Wb=function(a){var b=d++;return e[b]=a,xa.postMessage(i+currentId,"*"),b}}else if(xa.MessageChannel){var j=new xa.MessageChannel;j.port1.onmessage=function(b){a(b.data)},Wb=function(a){var b=d++;return e[b]=a,j.port2.postMessage(b),b}}else Wb="document"in xa&&"onreadystatechange"in xa.document.createElement("script")?function(b){var c=xa.document.createElement("script"),f=d++;return e[f]=b,c.onreadystatechange=function(){a(f),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},xa.document.documentElement.appendChild(c),f}:function(b){var c=d++;return e[c]=b,ac(function(){a(c)},0),c}}();var cc=Tb.timeout=Tb["default"]=function(){function a(a,b){var c=this,d=new Pb,e=Wb(function(){!d.isDisposed&&d.setDisposable(b(c,a))});return new Ib(d,Lb(function(){Xb(e)}))}function b(a,b,c){var d=this,e=Tb.normalize(b),f=new Pb;if(0===e)return d.scheduleWithState(a,c);var g=ac(function(){!f.isDisposed&&f.setDisposable(c(d,a))},e);return new Ib(f,Lb(function(){bc(g)}))}function c(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}return new Tb(Fa,a,b,c)}(),dc=function(a){function b(a,b){return this._scheduler.scheduleWithState(a,this._wrap(b))}function c(a,b,c){return this._scheduler.scheduleWithRelativeAndState(a,b,this._wrap(c))}function d(a,b,c){return this._scheduler.scheduleWithAbsoluteAndState(a,b,this._wrap(c))}function e(e,f){this._scheduler=e,this._handler=f,this._recursiveOriginal=null,this._recursiveWrapper=null,a.call(this,this._scheduler.now.bind(this._scheduler),b,c,d)}return Cb(e,a),e.prototype._clone=function(a){return new e(a,this._handler)},e.prototype._wrap=function(a){var b=this;return function(c,d){try{return a(b._getRecursiveWrapper(c),d)}catch(e){if(!b._handler(e))throw e;return Mb}}},e.prototype._getRecursiveWrapper=function(a){if(this._recursiveOriginal!==a){this._recursiveOriginal=a;var b=this._clone(a);b._recursiveOriginal=a,b._recursiveWrapper=b,this._recursiveWrapper=b}return this._recursiveWrapper},e.prototype.schedulePeriodicWithState=function(a,b,c){var d=this,e=!1,f=new Pb;return f.setDisposable(this._scheduler.schedulePeriodicWithState(a,b,function(a){if(e)return null;try{return c(a)}catch(b){if(e=!0,!d._handler(b))throw b;return f.dispose(),null}})),f},e}(Tb),ec=Ca.Notification=function(){function a(a,b,c,d,e,f){this.kind=a,this.value=b,this.exception=c,this._accept=d,this._acceptObservable=e,this.toString=f}return a.prototype.accept=function(a,b,c){return a&&"object"==typeof a?this._acceptObservable(a):this._accept(a,b,c)},a.prototype.toObservable=function(a){var b=this;return Vb(a)||(a=Zb),new Hd(function(c){return a.scheduleWithState(b,function(a,b){b._acceptObservable(c),"N"===b.kind&&c.onCompleted()})})},a}(),fc=ec.createOnNext=function(){function a(a){return a(this.value)}function b(a){return a.onNext(this.value)}function c(){return"OnNext("+this.value+")"}return function(d){return new ec("N",d,null,a,b,c)}}(),gc=ec.createOnError=function(){function a(a,b){return b(this.exception)}function b(a){return a.onError(this.exception)}function c(){return"OnError("+this.exception+")"}return function(d){return new ec("E",null,d,a,b,c)}}(),hc=ec.createOnCompleted=function(){function a(a,b,c){return c()}function b(a){return a.onCompleted()}function c(){return"OnCompleted()"}return function(){return new ec("C",null,null,a,b,c)}}(),ic=Ca.Observer=function(){};ic.prototype.toNotifier=function(){var a=this;return function(b){return b.accept(a)}},ic.prototype.asObserver=function(){return new mc(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))},ic.prototype.checked=function(){return new nc(this)};var jc=ic.create=function(a,b,c){return a||(a=Da),b||(b=Ia),c||(c=Da),new mc(a,b,c)};ic.fromNotifier=function(a,b){return new mc(function(c){return a.call(b,fc(c))},function(c){return a.call(b,gc(c))},function(){return a.call(b,hc())})},ic.prototype.notifyOn=function(a){return new pc(a,this)},ic.prototype.makeSafe=function(a){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,a)};var kc,lc=Ca.internals.AbstractObserver=function(a){function b(){this.isStopped=!1,a.call(this)}return Cb(b,a),b.prototype.next=Wa,b.prototype.error=Wa,b.prototype.completed=Wa,b.prototype.onNext=function(a){this.isStopped||this.next(a)},b.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.error(a))},b.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},b.prototype.dispose=function(){this.isStopped=!0},b.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.error(a),!0)},b}(ic),mc=Ca.AnonymousObserver=function(a){function b(b,c,d){a.call(this),this._onNext=b,this._onError=c,this._onCompleted=d}return Cb(b,a),b.prototype.next=function(a){this._onNext(a)},b.prototype.error=function(a){this._onError(a)},b.prototype.completed=function(){this._onCompleted()},b}(lc),nc=function(a){function b(b){a.call(this),this._observer=b,this._state=0}Cb(b,a);var c=b.prototype;return c.onNext=function(a){this.checkAccess();var b=p(this._observer.onNext).call(this._observer,a);this._state=0,b===Fb&&q(b.e)},c.onError=function(a){this.checkAccess();var b=p(this._observer.onError).call(this._observer,a);this._state=2,b===Fb&&q(b.e)},c.onCompleted=function(){this.checkAccess();var a=p(this._observer.onCompleted).call(this._observer);this._state=2,a===Fb&&q(a.e)},c.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},b}(ic),oc=Ca.internals.ScheduledObserver=function(a){function b(b,c){a.call(this),this.scheduler=b,this.observer=c,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new Qb}return Cb(b,a),b.prototype.next=function(a){var b=this;this.queue.push(function(){b.observer.onNext(a)})},b.prototype.error=function(a){var b=this;this.queue.push(function(){b.observer.onError(a)})},b.prototype.completed=function(){var a=this;this.queue.push(function(){a.observer.onCompleted()})},b.prototype.ensureActive=function(){var a=!1,b=this;!this.hasFaulted&&this.queue.length>0&&(a=!this.isAcquired,this.isAcquired=!0),a&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(a){var c;if(!(b.queue.length>0))return void(b.isAcquired=!1);c=b.queue.shift();try{c()}catch(d){throw b.queue=[],b.hasFaulted=!0,d}a()}))},b.prototype.dispose=function(){a.prototype.dispose.call(this),this.disposable.dispose()},b}(lc),pc=function(a){function b(b,c,d){a.call(this,b,c),this._cancel=d}return Cb(b,a),b.prototype.next=function(b){a.prototype.next.call(this,b),this.ensureActive()},b.prototype.error=function(b){a.prototype.error.call(this,b),this.ensureActive()},b.prototype.completed=function(){a.prototype.completed.call(this),this.ensureActive()},b.prototype.dispose=function(){
a.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},b}(oc),qc=Ca.Observable=function(){function a(a){if(Ca.config.longStackSupport&&Ma){try{throw new Error}catch(b){this.stack=b.stack.substring(b.stack.indexOf("\n")+1)}var d=this;this._subscribe=function(b){var e=b.onError.bind(b);return b.onError=function(a){c(a,d),e(a)},a.call(d,b)}}else this._subscribe=a}return kc=a.prototype,kc.subscribe=kc.forEach=function(a,b,c){return this._subscribe("object"==typeof a?a:jc(a,b,c))},kc.subscribeOnNext=function(a,b){return this._subscribe(jc("undefined"!=typeof b?function(c){a.call(b,c)}:a))},kc.subscribeOnError=function(a,b){return this._subscribe(jc(null,"undefined"!=typeof b?function(c){a.call(b,c)}:a))},kc.subscribeOnCompleted=function(a,b){return this._subscribe(jc(null,null,"undefined"!=typeof b?function(){a.call(b)}:a))},a}(),rc=Ca.ObservableBase=function(a){function b(a){return a&&La(a.dispose)?a:La(a)?Lb(a):Mb}function c(a,c){var d=c[0],e=c[1],f=p(e.subscribeCore).call(e,d);return f!==Fb||d.fail(Fb.e)?void d.setDisposable(b(f)):q(Fb.e)}function d(a){var b=new Id(a),d=[b,this];return $b.scheduleRequired()?$b.scheduleWithState(d,c):c(null,d),b}function e(){a.call(this,d)}return Cb(e,a),e.prototype.subscribeCore=Wa,e}(qc),sc=Ca.internals.Enumerable=function(){},tc=function(a){function b(b){this.sources=b,a.call(this)}function c(a,b,c){this.o=a,this.s=b,this.e=c,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){var b,d=new Qb,e=Zb.scheduleRecursiveWithState(this.sources[Ya](),function(e,f){if(!b){var g=p(e.next).call(e);if(g===Fb)return a.onError(g.e);if(g.done)return a.onCompleted();var h=g.value;Ja(h)&&(h=Ac(h));var i=new Pb;d.setDisposable(i),i.setDisposable(h.subscribe(new c(a,f,e)))}});return new Ib(d,e,Lb(function(){b=!0}))},c.prototype.onNext=function(a){this.isStopped||this.o.onNext(a)},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.s(this.e))},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);sc.prototype.concat=function(){return new tc(this)};var uc=function(a){function b(b){this.sources=b,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b,c=this.sources[Ya](),d=new Qb,e=Zb.scheduleRecursiveWithState(null,function(e,f){if(!b){var g=p(c.next).call(c);if(g===Fb)return a.onError(g.e);if(g.done)return null!==e?a.onError(e):a.onCompleted();var h=g.value;Ja(h)&&(h=Ac(h));var i=new Pb;d.setDisposable(i),i.setDisposable(h.subscribe(function(b){a.onNext(b)},f,function(){a.onCompleted()}))}});return new Ib(d,e,Lb(function(){b=!0}))},b}(rc);sc.prototype.catchError=function(){return new uc(this)},sc.prototype.catchErrorWhen=function(a){var b=this;return new Hd(function(c){var d,e,f=new Kd,g=new Kd,h=a(f),i=h.subscribe(g),j=b[Ya](),k=new Qb,l=Zb.scheduleRecursive(function(a){if(!d){var b=p(j.next).call(j);if(b===Fb)return c.onError(b.e);if(b.done)return void(e?c.onError(e):c.onCompleted());var h=b.value;Ja(h)&&(h=Ac(h));var i=new Pb,l=new Pb;k.setDisposable(new Ib(l,i)),i.setDisposable(h.subscribe(function(a){c.onNext(a)},function(b){l.setDisposable(g.subscribe(a,function(a){c.onError(a)},function(){c.onCompleted()})),f.onNext(b)},function(){c.onCompleted()}))}});return new Ib(i,k,l,Lb(function(){d=!0}))})};var vc=function(a){function b(a,b){this.v=a,this.c=null==b?-1:b}function c(a){this.v=a.v,this.l=a.c}return Cb(b,a),b.prototype[Ya]=function(){return new c(this)},c.prototype.next=function(){return 0===this.l?Za:(this.l>0&&this.l--,{done:!1,value:this.v})},b}(sc),wc=sc.repeat=function(a,b){return new vc(a,b)},xc=function(a){function b(a,b,c){this.s=a,this.fn=b?bb(b,c,3):null}function c(a){this.i=-1,this.s=a.s,this.l=this.s.length,this.fn=a.fn}return Cb(b,a),b.prototype[Ya]=function(){return new c(this)},c.prototype.next=function(){return++this.i<this.l?{done:!1,value:this.fn?this.fn(this.s[this.i],this.i,this.s):this.s[this.i]}:Za},b}(sc),yc=sc.of=function(a,b,c){return new xc(a,b,c)};kc.observeOn=function(a){var b=this;return new Hd(function(c){return b.subscribe(new pc(a,c))},b)},kc.subscribeOn=function(a){var b=this;return new Hd(function(c){var d=new Pb,e=new Qb;return e.setDisposable(d),d.setDisposable(a.schedule(function(){e.setDisposable(new t(a,b.subscribe(c)))})),e},b)};var zc=function(a){function b(b){this.p=b,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.p.then(function(b){a.onNext(b),a.onCompleted()},function(b){a.onError(b)}),Mb},b}(rc),Ac=qc.fromPromise=function(a){return new zc(a)};kc.toPromise=function(a){if(a||(a=Ca.config.Promise),!a)throw new Ua("Promise type not provided nor in Rx.config.Promise");var b=this;return new a(function(a,c){var d,e=!1;b.subscribe(function(a){d=a,e=!0},c,function(){e&&a(d)})})};var Bc=function(a){function b(b){this.source=b,a.call(this)}function c(a){this.o=a,this.a=[],this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new c(a))},c.prototype.onNext=function(a){this.isStopped||this.a.push(a)},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onNext(this.a),this.o.onCompleted())},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc.toArray=function(){return new Bc(this)},qc.create=qc.createWithDisposable=function(a,b){return new Hd(a,b)};var Cc=qc.defer=function(a){return new Hd(function(b){var c;try{c=a()}catch(d){return Tc(d).subscribe(b)}return Ja(c)&&(c=Ac(c)),c.subscribe(b)})},Dc=function(a){function b(b){this.scheduler=b,a.call(this)}function c(a,b){this.observer=a,this.parent=b}function d(a,b){b.onCompleted()}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new c(a,this);return b.run()},c.prototype.run=function(){return this.parent.scheduler.scheduleWithState(this.observer,d)},b}(rc),Ec=qc.empty=function(a){return Vb(a)||(a=Zb),new Dc(a)},Fc=function(a){function b(b,c,d){this.iterable=b,this.mapper=c,this.scheduler=d,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new Gc(a,this);return b.run()},b}(rc),Gc=function(){function a(a,b){this.observer=a,this.parent=b}return a.prototype.run=function(){function a(a,b){try{var f=c.next()}catch(g){return d.onError(g)}if(f.done)return d.onCompleted();var h=f.value;if(e)try{h=e(h,a)}catch(g){return d.onError(g)}d.onNext(h),b(a+1)}var b=Object(this.parent.iterable),c=A(b),d=this.observer,e=this.parent.mapper;return this.parent.scheduler.scheduleRecursiveWithState(0,a)},a}(),Hc=Math.pow(2,53)-1;v.prototype[Ya]=function(){return new w(this._s)},w.prototype[Ya]=function(){return this},w.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:Za},x.prototype[Ya]=function(){return new y(this._a)},y.prototype[Ya]=function(){return this},y.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:Za};var Ic=qc.from=function(a,b,c,d){if(null==a)throw new Error("iterable cannot be null.");if(b&&!La(b))throw new Error("mapFn when provided must be a function");if(b)var e=bb(b,c,2);return Vb(d)||(d=$b),new Fc(a,e,d)},Jc=function(a){function b(b,c){this.args=b,this.scheduler=c,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new D(a,this);return b.run()},b}(rc);D.prototype.run=function(){function a(a,e){d>a?(b.onNext(c[a]),e(a+1)):b.onCompleted()}var b=this.observer,c=this.parent.args,d=c.length;return this.parent.scheduler.scheduleRecursiveWithState(0,a)};var Kc=qc.fromArray=function(a,b){return Vb(b)||(b=$b),new Jc(a,b)};qc.generate=function(a,b,c,d,e){return Vb(e)||(e=$b),new Hd(function(f){var g=!0;return e.scheduleRecursiveWithState(a,function(a,e){var h,i;try{g?g=!1:a=c(a),h=b(a),h&&(i=d(a))}catch(j){return f.onError(j)}h?(f.onNext(i),e(a)):f.onCompleted()})})},qc.of=function(){for(var a=arguments.length,b=new Array(a),c=0;a>c;c++)b[c]=arguments[c];return new Jc(b,$b)},qc.ofWithScheduler=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;d++)c[d-1]=arguments[d];return new Jc(c,a)},qc.ofArrayChanges=function(a){if(!Array.isArray(a))throw new TypeError("Array.observe only accepts arrays.");if("function"!=typeof Array.observe&&"function"!=typeof Array.unobserve)throw new TypeError("Array.observe is not supported on your platform");return new Hd(function(b){function c(a){for(var c=0,d=a.length;d>c;c++)b.onNext(a[c])}return Array.observe(a,c),function(){Array.unobserve(a,c)}})},qc.ofObjectChanges=function(a){if(null==a)throw new TypeError("object must not be null or undefined.");if("function"!=typeof Object.observe&&"function"!=typeof Object.unobserve)throw new TypeError("Object.observe is not supported on your platform");return new Hd(function(b){function c(a){for(var c=0,d=a.length;d>c;c++)b.onNext(a[c])}return Object.observe(a,c),function(){Object.unobserve(a,c)}})};var Lc=function(a){function b(){a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){return Mb},b}(rc),Mc=qc.never=function(){return new Lc},Nc=function(a){function b(b,c){this.obj=b,this.keys=Object.keys(b),this.scheduler=c,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new F(a,this);return b.run()},b}(rc);F.prototype.run=function(){function a(a,f){if(e>a){var g=d[a];b.onNext([g,c[g]]),f(a+1)}else b.onCompleted()}var b=this.observer,c=this.parent.obj,d=this.parent.keys,e=d.length;return this.parent.scheduler.scheduleRecursiveWithState(0,a)},qc.pairs=function(a,b){return b||(b=$b),new Nc(a,b)};var Oc=function(a){function b(b,c,d){this.start=b,this.rangeCount=c,this.scheduler=d,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new Pc(a,this);return b.run()},b}(rc),Pc=function(){function a(a,b){this.observer=a,this.parent=b}return a.prototype.run=function(){function a(a,e){c>a?(d.onNext(b+a),e(a+1)):d.onCompleted()}var b=this.parent.start,c=this.parent.rangeCount,d=this.observer;return this.parent.scheduler.scheduleRecursiveWithState(0,a)},a}();qc.range=function(a,b,c){return Vb(c)||(c=$b),new Oc(a,b,c)};var Qc=function(a){function b(b,c,d){this.value=b,this.repeatCount=null==c?-1:c,this.scheduler=d,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new G(a,this);return b.run()},b}(rc);G.prototype.run=function(){function a(a,d){return(-1===a||a>0)&&(b.onNext(c),a>0&&a--),0===a?b.onCompleted():void d(a)}var b=this.observer,c=this.parent.value;return this.parent.scheduler.scheduleRecursiveWithState(this.parent.repeatCount,a)},qc.repeat=function(a,b,c){return Vb(c)||(c=$b),new Qc(a,b,c)};var Rc=function(a){function b(b,c){this.value=b,this.scheduler=c,a.call(this)}function c(a,b){this.observer=a,this.parent=b}function d(a,b){var c=b[0],d=b[1];d.onNext(c),d.onCompleted()}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new c(a,this);return b.run()},c.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.value,this.observer],d)},b}(rc),Sc=(qc["return"]=qc.just=qc.returnValue=function(a,b){return Vb(b)||(b=Zb),new Rc(a,b)},function(a){function b(b,c){this.error=b,this.scheduler=c,a.call(this)}function c(a,b){this.o=a,this.p=b}function d(a,b){var c=b[0],d=b[1];d.onError(c)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new c(a,this);return b.run()},c.prototype.run=function(){return this.p.scheduler.scheduleWithState([this.p.error,this.o],d)},b}(rc)),Tc=qc["throw"]=qc.throwError=qc.throwException=function(a,b){return Vb(b)||(b=Zb),new Sc(a,b)};qc.using=function(a,b){return new Hd(function(c){var d,e,f=Mb;try{d=a(),d&&(f=d),e=b(d)}catch(g){return new Ib(Tc(g).subscribe(c),f)}return new Ib(e.subscribe(c),f)})},kc.amb=function(a){var b=this;return new Hd(function(c){function d(){f||(f=g,j.dispose())}function e(){f||(f=h,i.dispose())}var f,g="L",h="R",i=new Pb,j=new Pb;return Ja(a)&&(a=Ac(a)),i.setDisposable(b.subscribe(function(a){d(),f===g&&c.onNext(a)},function(a){d(),f===g&&c.onError(a)},function(){d(),f===g&&c.onCompleted()})),j.setDisposable(a.subscribe(function(a){e(),f===h&&c.onNext(a)},function(a){e(),f===h&&c.onError(a)},function(){e(),f===h&&c.onCompleted()})),new Ib(i,j)})},qc.amb=function(){function a(a,b){return a.amb(b)}var b=Mc(),c=[];if(Array.isArray(arguments[0]))c=arguments[0];else for(var d=0,e=arguments.length;e>d;d++)c.push(arguments[d]);for(var d=0,e=c.length;e>d;d++)b=a(b,c[d]);return b},kc["catch"]=kc.catchError=kc.catchException=function(a){return"function"==typeof a?H(this,a):Uc([this,a])};var Uc=qc.catchError=qc["catch"]=qc.catchException=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return yc(a).catchError()};kc.combineLatest=function(){for(var a=arguments.length,b=new Array(a),c=0;a>c;c++)b[c]=arguments[c];return Array.isArray(b[0])?b[0].unshift(this):b.unshift(this),Vc.apply(this,b)};var Vc=qc.combineLatest=function(){for(var a=arguments.length,b=new Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=b.pop();return Array.isArray(b[0])&&(b=b[0]),new Hd(function(a){function c(b){if(h[b]=!0,i||(i=h.every(Ea))){try{var c=d.apply(null,k)}catch(e){return a.onError(e)}a.onNext(c)}else j.filter(function(a,c){return c!==b}).every(Ea)&&a.onCompleted()}function e(b){j[b]=!0,j.every(Ea)&&a.onCompleted()}for(var f=b.length,g=function(){return!1},h=n(f,g),i=!1,j=n(f,g),k=new Array(f),l=new Array(f),m=0;f>m;m++)!function(d){var f=b[d],g=new Pb;Ja(f)&&(f=Ac(f)),g.setDisposable(f.subscribe(function(a){k[d]=a,c(d)},function(b){a.onError(b)},function(){e(d)})),l[d]=g}(m);return new Ib(l)},this)};kc.concat=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return a.unshift(this),Xc.apply(null,a)};var Wc=function(a){function b(b){this.sources=b,a.call(this)}function c(a,b){this.sources=a,this.o=b}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new c(this.sources,a);return b.run()},c.prototype.run=function(){var a,b=new Qb,c=this.sources,d=c.length,e=this.o,f=Zb.scheduleRecursiveWithState(0,function(f,g){if(!a){if(f===d)return e.onCompleted();var h=c[f];Ja(h)&&(h=Ac(h));var i=new Pb;b.setDisposable(i),i.setDisposable(h.subscribe(function(a){e.onNext(a)},function(a){e.onError(a)},function(){g(f+1)}))}});return new Ib(b,f,Lb(function(){a=!0}))},b}(rc),Xc=qc.concat=function(){var a;if(Array.isArray(arguments[0]))a=arguments[0];else{a=new Array(arguments.length);for(var b=0,c=arguments.length;c>b;b++)a[b]=arguments[b]}return new Wc(a)};kc.concatAll=kc.concatObservable=function(){return this.merge(1)};var Yc=function(a){function b(b,c){this.source=b,this.maxConcurrent=c,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new Ib;return b.add(this.source.subscribe(new Zc(a,this.maxConcurrent,b))),b},b}(rc),Zc=function(){function a(a,b,c){this.o=a,this.max=b,this.g=c,this.done=!1,this.q=[],this.activeCount=0,this.isStopped=!1}function b(a,b){this.parent=a,this.sad=b,this.isStopped=!1}return a.prototype.handleSubscribe=function(a){var c=new Pb;this.g.add(c),Ja(a)&&(a=Ac(a)),c.setDisposable(a.subscribe(new b(this,c)))},a.prototype.onNext=function(a){this.isStopped||(this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(a)):this.q.push(a))},a.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},a.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,0===this.activeCount&&this.o.onCompleted())},a.prototype.dispose=function(){this.isStopped=!0},a.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b.prototype.onNext=function(a){this.isStopped||this.parent.o.onNext(a)},b.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.parent.o.onError(a))},b.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var a=this.parent;a.g.remove(this.sad),a.q.length>0?a.handleSubscribe(a.q.shift()):(a.activeCount--,a.done&&0===a.activeCount&&a.o.onCompleted())}},b.prototype.dispose=function(){this.isStopped=!0},b.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(a),!0)},a}();kc.merge=function(a){return"number"!=typeof a?$c(this,a):new Yc(this,a)};var $c=qc.merge=function(){var a,b,c=[],d=arguments.length;if(arguments[0])if(Vb(arguments[0]))for(a=arguments[0],b=1;d>b;b++)c.push(arguments[b]);else for(a=Zb,b=0;d>b;b++)c.push(arguments[b]);else for(a=Zb,b=1;d>b;b++)c.push(arguments[b]);return Array.isArray(c[0])&&(c=c[0]),E(a,c).mergeAll()},_c=function(a){function b(b){this.source=b,a.call(this)}function c(a,b){this.o=a,this.g=b,this.isStopped=!1,this.done=!1}function d(a,b,c){this.parent=a,this.g=b,this.sad=c,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new Ib,d=new Pb;return b.add(d),d.setDisposable(this.source.subscribe(new c(a,b))),b},c.prototype.onNext=function(a){if(!this.isStopped){var b=new Pb;this.g.add(b),Ja(a)&&(a=Ac(a)),b.setDisposable(a.subscribe(new d(this,this.g,b)))}},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,1===this.g.length&&this.o.onCompleted())},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},d.prototype.onNext=function(a){this.isStopped||this.parent.o.onNext(a)},d.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.parent.o.onError(a))},d.prototype.onCompleted=function(){if(!this.isStopped){var a=this.parent;this.isStopped=!0,a.g.remove(this.sad),a.done&&1===a.g.length&&a.o.onCompleted()}},d.prototype.dispose=function(){this.isStopped=!0},d.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(a),!0)},b}(rc);kc.mergeAll=kc.mergeObservable=function(){return new _c(this)};var ad=Ca.CompositeError=function(a){this.name="NotImplementedError",this.innerErrors=a,this.message="This contains multiple errors. Check the innerErrors",Error.call(this)};ad.prototype=Error.prototype,qc.mergeDelayError=function(){var a;if(Array.isArray(arguments[0]))a=arguments[0];else{var b=arguments.length;a=new Array(b);for(var c=0;b>c;c++)a[c]=arguments[c]}var d=E(null,a);return new Hd(function(a){function b(){0===g.length?a.onCompleted():a.onError(1===g.length?g[0]:new ad(g))}var c=new Ib,e=new Pb,f=!1,g=[];return c.add(e),e.setDisposable(d.subscribe(function(d){var e=new Pb;c.add(e),Ja(d)&&(d=Ac(d)),e.setDisposable(d.subscribe(function(b){a.onNext(b)},function(a){g.push(a),c.remove(e),f&&1===c.length&&b()},function(){c.remove(e),f&&1===c.length&&b()}))},function(a){g.push(a),f=!0,1===c.length&&b()},function(){f=!0,1===c.length&&b()})),c})},kc.onErrorResumeNext=function(a){if(!a)throw new Error("Second observable is required");return bd([this,a])};var bd=qc.onErrorResumeNext=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return new Hd(function(b){var c=0,d=new Qb,e=Zb.scheduleRecursive(function(e){var f,g;c<a.length?(f=a[c++],Ja(f)&&(f=Ac(f)),g=new Pb,d.setDisposable(g),g.setDisposable(f.subscribe(b.onNext.bind(b),e,e))):b.onCompleted()});return new Ib(d,e)})};kc.skipUntil=function(a){var b=this;return new Hd(function(c){var d=!1,e=new Ib(b.subscribe(function(a){d&&c.onNext(a)},function(a){c.onError(a)},function(){d&&c.onCompleted()}));Ja(a)&&(a=Ac(a));var f=new Pb;return e.add(f),f.setDisposable(a.subscribe(function(){d=!0,f.dispose()},function(a){c.onError(a)},function(){f.dispose()})),e},b)};var cd=function(a){function b(b){this.source=b,a.call(this)}function c(a,b){this.o=a,this.inner=b,this.stopped=!1,this.latest=0,this.hasLatest=!1,this.isStopped=!1}function d(a,b){this.parent=a,this.id=b,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){var b=new Qb,d=this.source.subscribe(new c(a,b));return new Ib(d,b)},c.prototype.onNext=function(a){if(!this.isStopped){var b=new Pb,c=++this.latest;this.hasLatest=!0,this.inner.setDisposable(b),Ja(a)&&(a=Ac(a)),b.setDisposable(a.subscribe(new d(this,c)))}},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.stopped=!0,!this.hasLatest&&this.o.onCompleted())},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},d.prototype.onNext=function(a){this.isStopped||this.parent.latest===this.id&&this.parent.o.onNext(a)},d.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.parent.latest===this.id&&this.parent.o.onError(a))},d.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.parent.latest===this.id&&(this.parent.hasLatest=!1,this.parent.isStopped&&this.parent.o.onCompleted()))},d.prototype.dispose=function(){this.isStopped=!0},d.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(a),!0)},b}(rc);kc["switch"]=kc.switchLatest=function(){return new cd(this)};var dd=function(a){function b(b,c){this.source=b,this.other=Ja(c)?Ac(c):c,a.call(this)}function c(a){this.o=a,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return new Ib(this.source.subscribe(a),this.other.subscribe(new c(a)))},c.prototype.onNext=function(a){this.isStopped||this.o.onCompleted()},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){!this.isStopped&&(this.isStopped=!0)},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc.takeUntil=function(a){return new dd(this,a)},kc.withLatestFrom=function(){for(var a=arguments.length,b=new Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=b.pop(),e=this;return Array.isArray(b[0])&&(b=b[0]),new Hd(function(a){for(var c=b.length,f=n(c,I),g=!1,h=new Array(c),i=new Array(c+1),j=0;c>j;j++)!function(c){var d=b[c],e=new Pb;Ja(d)&&(d=Ac(d)),e.setDisposable(d.subscribe(function(a){h[c]=a,f[c]=!0,g=f.every(Ea)},function(b){a.onError(b)},Da)),i[c]=e}(j);var k=new Pb;return k.setDisposable(e.subscribe(function(b){var c=[b].concat(h);if(g){var e=p(d).apply(null,c);return e===Fb?a.onError(e.e):void a.onNext(e)}},function(b){a.onError(b)},function(){a.onCompleted()})),i[c]=k,new Ib(i)},this)},kc.zip=function(){if(Array.isArray(arguments[0]))return J.apply(this,arguments);for(var a=arguments.length,b=new Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=this,e=b.pop();return b.unshift(d),new Hd(function(a){for(var c=b.length,f=n(c,K),g=n(c,I),h=new Array(c),i=0;c>i;i++)!function(c){var i=b[c],j=new Pb;Ja(i)&&(i=Ac(i)),j.setDisposable(i.subscribe(function(b){if(f[c].push(b),f.every(function(a){return a.length>0})){var h=f.map(function(a){return a.shift()}),i=p(e).apply(d,h);if(i===Fb)return a.onError(i.e);a.onNext(i)}else g.filter(function(a,b){return b!==c}).every(Ea)&&a.onCompleted()},function(b){a.onError(b)},function(){g[c]=!0,g.every(Ea)&&a.onCompleted()})),h[c]=j}(i);return new Ib(h)},d)},qc.zip=function(){for(var a=arguments.length,b=new Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=b.shift();return d.zip.apply(d,b)},qc.zipArray=function(){var a;if(Array.isArray(arguments[0]))a=arguments[0];else{var b=arguments.length;a=new Array(b);for(var c=0;b>c;c++)a[c]=arguments[c]}return new Hd(function(b){for(var c=a.length,d=n(c,L),e=n(c,I),f=new Array(c),g=0;c>g;g++)!function(c){f[c]=new Pb,f[c].setDisposable(a[c].subscribe(function(a){if(d[c].push(a),d.every(function(a){return a.length>0})){var f=d.map(function(a){return a.shift()});b.onNext(f)}else if(e.filter(function(a,b){return b!==c}).every(Ea))return b.onCompleted()},function(a){b.onError(a)},function(){e[c]=!0,e.every(Ea)&&b.onCompleted()}))}(g);return new Ib(f)})},kc.asObservable=function(){var a=this;return new Hd(function(b){return a.subscribe(b)},a)},kc.bufferWithCount=function(a,b){return"number"!=typeof b&&(b=a),this.windowWithCount(a,b).selectMany(function(a){return a.toArray()}).where(function(a){return a.length>0})},kc.dematerialize=function(){var a=this;return new Hd(function(b){return a.subscribe(function(a){return a.accept(b)},function(a){b.onError(a)},function(){b.onCompleted()})},this)},kc.distinctUntilChanged=function(a,b){var c=this;return b||(b=Ga),new Hd(function(d){var e,f=!1;return c.subscribe(function(c){var g=c;if(a&&(g=p(a)(c),g===Fb))return d.onError(g.e);if(f){var h=p(b)(e,g);if(h===Fb)return d.onError(h.e)}f&&h||(f=!0,e=g,d.onNext(c))},function(a){d.onError(a)},function(){d.onCompleted()})},this)};var ed=function(a){function b(b,c,d,e){this.source=b,this.t=!c||La(c)?jc(c||Da,d||Da,e||Da):c,a.call(this)}function c(a,b){this.o=a,this.t=b,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new c(a,this.t))},c.prototype.onNext=function(a){if(!this.isStopped){var b=p(this.t.onNext).call(this.t,a);b===Fb&&this.o.onError(b.e),this.o.onNext(a)}},c.prototype.onError=function(a){if(!this.isStopped){this.isStopped=!0;var b=p(this.t.onError).call(this.t,a);if(b===Fb)return this.o.onError(b.e);this.o.onError(a)}},c.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var a=p(this.t.onCompleted).call(this.t);if(a===Fb)return this.o.onError(a.e);this.o.onCompleted()}},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc["do"]=kc.tap=kc.doAction=function(a,b,c){return new ed(this,a,b,c)},kc.doOnNext=kc.tapOnNext=function(a,b){return this.tap("undefined"!=typeof b?function(c){a.call(b,c)}:a)},kc.doOnError=kc.tapOnError=function(a,b){return this.tap(Da,"undefined"!=typeof b?function(c){a.call(b,c)}:a)},kc.doOnCompleted=kc.tapOnCompleted=function(a,b){return this.tap(Da,null,"undefined"!=typeof b?function(){a.call(b)}:a)},kc["finally"]=kc.ensure=function(a){var b=this;return new Hd(function(c){var d;try{d=b.subscribe(c)}catch(e){throw a(),e}return Lb(function(){try{d.dispose()}catch(b){throw b}finally{a()}})},this)},kc.finallyAction=function(a){return this.ensure(a)};var fd=function(a){function b(b){this.source=b,a.call(this)}function c(a){this.o=a,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new c(a))},c.prototype.onNext=Da,c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(a),!0)},b}(rc);kc.ignoreElements=function(){return new fd(this)},kc.materialize=function(){var a=this;return new Hd(function(b){return a.subscribe(function(a){b.onNext(fc(a))},function(a){b.onNext(gc(a)),b.onCompleted()},function(){b.onNext(hc()),b.onCompleted()})},a)},kc.repeat=function(a){return wc(this,a).concat()},kc.retry=function(a){return wc(this,a).catchError()},kc.retryWhen=function(a){return wc(this).catchErrorWhen(a)};var gd=function(a){function b(b,c,d,e){this.source=b,this.accumulator=c,this.hasSeed=d,this.seed=e,a.call(this)}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new M(a,this))},b}(rc);M.prototype.onNext=function(a){if(!this.isStopped){!this.hasValue&&(this.hasValue=!0);try{this.hasAccumulation?this.accumulation=this.accumulator(this.accumulation,a):(this.accumulation=this.hasSeed?this.accumulator(this.seed,a):a,this.hasAccumulation=!0)}catch(b){return this.observer.onError(b)}this.observer.onNext(this.accumulation)}},M.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.observer.onError(a))},M.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,!this.hasValue&&this.hasSeed&&this.observer.onNext(this.seed),this.observer.onCompleted())},M.prototype.dispose=function(){this.isStopped=!0},M.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(a),!0)},kc.scan=function(){var a,b,c=!1;return 2===arguments.length?(c=!0,a=arguments[0],b=arguments[1]):b=arguments[0],new gd(this,b,c,a)},kc.skipLast=function(a){if(0>a)throw new Ta;var b=this;return new Hd(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&c.onNext(d.shift())},function(a){c.onError(a)},function(){c.onCompleted()})},b)},kc.startWith=function(){var a,b=0;arguments.length&&Vb(arguments[0])?(a=arguments[0],b=1):a=Zb;for(var c=[],d=b,e=arguments.length;e>d;d++)c.push(arguments[d]);return yc([Kc(c,a),this]).concat()},kc.takeLast=function(a){if(0>a)throw new Ta;var b=this;return new Hd(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&d.shift()},function(a){c.onError(a)},function(){for(;d.length>0;)c.onNext(d.shift());c.onCompleted()})},b)},kc.takeLastBuffer=function(a){var b=this;return new Hd(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&d.shift()},function(a){c.onError(a)},function(){c.onNext(d),c.onCompleted()})},b)},kc.windowWithCount=function(a,b){var c=this;if(+a||(a=0),Math.abs(a)===1/0&&(a=0),0>=a)throw new Ta;if(null==b&&(b=a),+b||(b=0),Math.abs(b)===1/0&&(b=0),0>=b)throw new Ta;return new Hd(function(d){function e(){var a=new Kd;i.push(a),d.onNext(Eb(a,g))}var f=new Pb,g=new Rb(f),h=0,i=[];return e(),f.setDisposable(c.subscribe(function(c){for(var d=0,f=i.length;f>d;d++)i[d].onNext(c);var g=h-a+1;g>=0&&g%b===0&&i.shift().onCompleted(),++h%b===0&&e()},function(a){for(;i.length>0;)i.shift().onError(a);d.onError(a)},function(){for(;i.length>0;)i.shift().onCompleted();d.onCompleted()})),g},c)},kc.selectConcat=kc.concatMap=function(a,b,c){return La(a)&&La(b)?this.concatMap(function(c,d){var e=a(c,d);return Ja(e)&&(e=Ac(e)),(_a(e)||$a(e))&&(e=Ic(e)),e.map(function(a,e){return b(c,a,d,e)})}):La(a)?N(this,a,c):N(this,function(){return a})},kc.concatMapObserver=kc.selectConcatObserver=function(a,b,c,d){var e=this,f=bb(a,d,2),g=bb(b,d,1),h=bb(c,d,0);return new Hd(function(a){var b=0;return e.subscribe(function(c){var d;try{d=f(c,b++)}catch(e){return void a.onError(e)}Ja(d)&&(d=Ac(d)),a.onNext(d)},function(b){var c;try{c=g(b)}catch(d){return void a.onError(d)}Ja(c)&&(c=Ac(c)),a.onNext(c),a.onCompleted()},function(){var b;try{b=h()}catch(c){return void a.onError(c)}Ja(b)&&(b=Ac(b)),a.onNext(b),a.onCompleted()})},this).concatAll()},kc.defaultIfEmpty=function(b){var c=this;return b===a&&(b=null),new Hd(function(a){var d=!1;return c.subscribe(function(b){d=!0,a.onNext(b)},function(b){a.onError(b)},function(){!d&&a.onNext(b),a.onCompleted()})},c)},P.prototype.push=function(a){var b=-1===O(this.set,a,this.comparer);return b&&this.set.push(a),b},kc.distinct=function(a,b){var c=this;return b||(b=Ga),new Hd(function(d){var e=new P(b);return c.subscribe(function(b){var c=b;if(a)try{c=a(b)}catch(f){return void d.onError(f)}e.push(c)&&d.onNext(b)},function(a){d.onError(a)},function(){d.onCompleted()})},this)},kc.groupBy=function(a,b,c){return this.groupByUntil(a,b,Mc,c)},kc.groupByUntil=function(a,b,c,d){var e=this;return b||(b=Ea),d||(d=Ga),new Hd(function(f){function g(a){return function(b){b.onError(a)}}var h=new Ad(0,d),i=new Ib,j=new Rb(i);return i.add(e.subscribe(function(d){var e;try{e=a(d)}catch(k){return h.getValues().forEach(g(k)),void f.onError(k)}var l=!1,m=h.tryGetValue(e);if(m||(m=new Kd,h.set(e,m),l=!0),l){var n=new Jd(e,m,j),o=new Jd(e,m);try{duration=c(o)}catch(k){return h.getValues().forEach(g(k)),void f.onError(k)}f.onNext(n);var p=new Pb;i.add(p);var q=function(){h.remove(e)&&m.onCompleted(),i.remove(p)};p.setDisposable(duration.take(1).subscribe(Da,function(a){
h.getValues().forEach(g(a)),f.onError(a)},q))}var r;try{r=b(d)}catch(k){return h.getValues().forEach(g(k)),void f.onError(k)}m.onNext(r)},function(a){h.getValues().forEach(g(a)),f.onError(a)},function(){h.getValues().forEach(function(a){a.onCompleted()}),f.onCompleted()})),j},e)};var hd=function(a){function b(b,c,d){this.source=b,this.selector=bb(c,d,3),a.call(this)}function c(a,b){return function(c,d,e){return a.call(this,b.selector(c,d,e),d,e)}}function d(a,b,c){this.o=a,this.selector=b,this.source=c,this.i=0,this.isStopped=!1}return Cb(b,a),b.prototype.internalMap=function(a,d){return new b(this.source,c(a,this),d)},b.prototype.subscribeCore=function(a){return this.source.subscribe(new d(a,this.selector,this))},d.prototype.onNext=function(a){if(!this.isStopped){var b=p(this.selector)(a,this.i++,this.source);return b===Fb?this.o.onError(b.e):void this.o.onNext(b)}},d.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},d.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},d.prototype.dispose=function(){this.isStopped=!0},d.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc.map=kc.select=function(a,b){var c="function"==typeof a?a:function(){return a};return this instanceof hd?this.internalMap(c,b):new hd(this,c,b)},kc.pluck=function(){var b=arguments,c=arguments.length;if(0===c)throw new Error("List of properties cannot be empty.");return this.map(function(d){for(var e=d,f=0;c>f;f++){var g=e[b[f]];if("undefined"==typeof g)return a;e=g}return e})},kc.selectMany=kc.flatMap=function(a,b,c){return La(a)&&La(b)?this.flatMap(function(c,d){var e=a(c,d);return Ja(e)&&(e=Ac(e)),(_a(e)||$a(e))&&(e=Ic(e)),e.map(function(a,e){return b(c,a,d,e)})},c):La(a)?Q(this,a,c):Q(this,function(){return a})},kc.flatMapObserver=kc.selectManyObserver=function(a,b,c,d){var e=this;return new Hd(function(f){var g=0;return e.subscribe(function(b){var c;try{c=a.call(d,b,g++)}catch(e){return void f.onError(e)}Ja(c)&&(c=Ac(c)),f.onNext(c)},function(a){var c;try{c=b.call(d,a)}catch(e){return void f.onError(e)}Ja(c)&&(c=Ac(c)),f.onNext(c),f.onCompleted()},function(){var a;try{a=c.call(d)}catch(b){return void f.onError(b)}Ja(a)&&(a=Ac(a)),f.onNext(a),f.onCompleted()})},e).mergeAll()},kc.selectSwitch=kc.flatMapLatest=kc.switchMap=function(a,b){return this.select(a,b).switchLatest()};var id=function(a){function b(b,c){this.source=b,this.skipCount=c,a.call(this)}function c(a,b){this.c=b,this.r=b,this.o=a,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new c(a,this.skipCount))},c.prototype.onNext=function(a){this.isStopped||(this.r<=0?this.o.onNext(a):this.r--)},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc.skip=function(a){if(0>a)throw new Ta;return new id(this,a)},kc.skipWhile=function(a,b){var c=this,d=bb(a,b,3);return new Hd(function(a){var b=0,e=!1;return c.subscribe(function(f){if(!e)try{e=!d(f,b++,c)}catch(g){return void a.onError(g)}e&&a.onNext(f)},function(b){a.onError(b)},function(){a.onCompleted()})},c)},kc.take=function(a,b){if(0>a)throw new Ta;if(0===a)return Ec(b);var c=this;return new Hd(function(b){var d=a;return c.subscribe(function(a){d-->0&&(b.onNext(a),0>=d&&b.onCompleted())},function(a){b.onError(a)},function(){b.onCompleted()})},c)},kc.takeWhile=function(a,b){var c=this,d=bb(a,b,3);return new Hd(function(a){var b=0,e=!0;return c.subscribe(function(f){if(e){try{e=d(f,b++,c)}catch(g){return void a.onError(g)}e?a.onNext(f):a.onCompleted()}},function(b){a.onError(b)},function(){a.onCompleted()})},c)};var jd=function(a){function b(b,c,d){this.source=b,this.predicate=bb(c,d,3),a.call(this)}function c(a,b){return function(c,d,e){return b.predicate(c,d,e)&&a.call(this,c,d,e)}}function d(a,b,c){this.o=a,this.predicate=b,this.source=c,this.i=0,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new d(a,this.predicate,this))},b.prototype.internalFilter=function(a,d){return new b(this.source,c(a,this),d)},d.prototype.onNext=function(a){if(!this.isStopped){var b=p(this.predicate)(a,this.i++,this.source);return b===Fb?this.o.onError(b.e):void(b&&this.o.onNext(a))}},d.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},d.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},d.prototype.dispose=function(){this.isStopped=!0},d.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc.filter=kc.where=function(a,b){return this instanceof jd?this.internalFilter(a,b):new jd(this,a,b)},kc.aggregate=function(){var a,b,c=!1,d=this;return 2===arguments.length?(c=!0,b=arguments[0],a=arguments[1]):a=arguments[0],new Hd(function(e){var f,g,h;return d.subscribe(function(d){!h&&(h=!0);try{f?g=a(g,d):(g=c?a(b,d):d,f=!0)}catch(i){return e.onError(i)}},function(a){e.onError(a)},function(){h&&e.onNext(g),!h&&c&&e.onNext(b),!h&&!c&&e.onError(new Ra),e.onCompleted()})},d)};var kd=function(a){function b(b,c,d,e){this.source=b,this.acc=c,this.hasSeed=d,this.seed=e,a.call(this)}function c(a,b){this.o=a,this.acc=b.acc,this.hasSeed=b.hasSeed,this.seed=b.seed,this.hasAccumulation=!1,this.result=null,this.hasValue=!1,this.isStopped=!1}return Cb(b,a),b.prototype.subscribeCore=function(a){return this.source.subscribe(new c(a,this))},c.prototype.onNext=function(a){this.isStopped||(!this.hasValue&&(this.hasValue=!0),this.hasAccumulation?this.result=p(this.acc)(this.result,a):(this.result=this.hasSeed?p(this.acc)(this.seed,a):a,this.hasAccumulation=!0),this.result===Fb&&this.o.onError(this.result.e))},c.prototype.onError=function(a){this.isStopped||(this.isStopped=!0,this.o.onError(a))},c.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.hasValue&&this.o.onNext(this.result),!this.hasValue&&this.hasSeed&&this.o.onNext(this.seed),!this.hasValue&&!this.hasSeed&&this.o.onError(new Ra),this.o.onCompleted())},c.prototype.dispose=function(){this.isStopped=!0},c.prototype.fail=function(a){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(a),!0)},b}(rc);kc.reduce=function(a){var b=!1;if(2===arguments.length){b=!0;var c=arguments[1]}return new kd(this,a,b,c)},kc.some=function(a,b){var c=this;return a?c.filter(a,b).some():new Hd(function(a){return c.subscribe(function(){a.onNext(!0),a.onCompleted()},function(b){a.onError(b)},function(){a.onNext(!1),a.onCompleted()})},c)},kc.any=function(){return this.some.apply(this,arguments)},kc.isEmpty=function(){return this.any().map(Ka)},kc.every=function(a,b){return this.filter(function(b){return!a(b)},b).some().map(Ka)},kc.all=function(){return this.every.apply(this,arguments)},kc.includes=function(a,b){function c(a,b){return 0===a&&0===b||a===b||isNaN(a)&&isNaN(b)}var d=this;return new Hd(function(e){var f=0,g=+b||0;return Math.abs(g)===1/0&&(g=0),0>g?(e.onNext(!1),e.onCompleted(),Mb):d.subscribe(function(b){f++>=g&&c(b,a)&&(e.onNext(!0),e.onCompleted())},function(a){e.onError(a)},function(){e.onNext(!1),e.onCompleted()})},this)},kc.contains=function(a,b){kc.includes(a,b)},kc.count=function(a,b){return a?this.filter(a,b).count():this.reduce(function(a){return a+1},0)},kc.indexOf=function(a,b){var c=this;return new Hd(function(d){var e=0,f=+b||0;return Math.abs(f)===1/0&&(f=0),0>f?(d.onNext(-1),d.onCompleted(),Mb):c.subscribe(function(b){e>=f&&b===a&&(d.onNext(e),d.onCompleted()),e++},function(a){d.onError(a)},function(){d.onNext(-1),d.onCompleted()})},c)},kc.sum=function(a,b){return a&&La(a)?this.map(a,b).sum():this.reduce(function(a,b){return a+b},0)},kc.minBy=function(a,b){return b||(b=Ha),R(this,a,function(a,c){return-1*b(a,c)})},kc.min=function(a){return this.minBy(Ea,a).map(function(a){return S(a)})},kc.maxBy=function(a,b){return b||(b=Ha),R(this,a,b)},kc.max=function(a){return this.maxBy(Ea,a).map(function(a){return S(a)})},kc.average=function(a,b){return a&&La(a)?this.map(a,b).average():this.reduce(function(a,b){return{sum:a.sum+b,count:a.count+1}},{sum:0,count:0}).map(function(a){if(0===a.count)throw new Ra;return a.sum/a.count})},kc.sequenceEqual=function(a,b){var c=this;return b||(b=Ga),new Hd(function(d){var e=!1,f=!1,g=[],h=[],i=c.subscribe(function(a){var c,e;if(h.length>0){e=h.shift();try{c=b(e,a)}catch(i){return void d.onError(i)}c||(d.onNext(!1),d.onCompleted())}else f?(d.onNext(!1),d.onCompleted()):g.push(a)},function(a){d.onError(a)},function(){e=!0,0===g.length&&(h.length>0?(d.onNext(!1),d.onCompleted()):f&&(d.onNext(!0),d.onCompleted()))});(_a(a)||$a(a))&&(a=Ic(a)),Ja(a)&&(a=Ac(a));var j=a.subscribe(function(a){var c;if(g.length>0){var f=g.shift();try{c=b(f,a)}catch(i){return void d.onError(i)}c||(d.onNext(!1),d.onCompleted())}else e?(d.onNext(!1),d.onCompleted()):h.push(a)},function(a){d.onError(a)},function(){f=!0,0===h.length&&(g.length>0?(d.onNext(!1),d.onCompleted()):e&&(d.onNext(!0),d.onCompleted()))});return new Ib(i,j)},c)},kc.elementAt=function(a){return T(this,a,!1)},kc.elementAtOrDefault=function(a,b){return T(this,a,!0,b)},kc.single=function(a,b){return a&&La(a)?this.where(a,b).single():U(this,!1)},kc.singleOrDefault=function(a,b,c){return a&&La(a)?this.filter(a,c).singleOrDefault(null,b):U(this,!0,b)},kc.first=function(a,b){return a?this.where(a,b).first():V(this,!1)},kc.firstOrDefault=function(a,b,c){return a?this.where(a).firstOrDefault(null,b):V(this,!0,b)},kc.last=function(a,b){return a?this.where(a,b).last():W(this,!1)},kc.lastOrDefault=function(a,b,c){return a?this.where(a,c).lastOrDefault(null,b):W(this,!0,b)},kc.find=function(a,b){return X(this,a,b,!1)},kc.findIndex=function(a,b){return X(this,a,b,!0)},kc.toSet=function(){if("undefined"==typeof xa.Set)throw new TypeError;var a=this;return new Hd(function(b){var c=new xa.Set;return a.subscribe(function(a){c.add(a)},function(a){b.onError(a)},function(){b.onNext(c),b.onCompleted()})},a)},kc.toMap=function(a,b){if("undefined"==typeof xa.Map)throw new TypeError;var c=this;return new Hd(function(d){var e=new xa.Map;return c.subscribe(function(c){var f;try{f=a(c)}catch(g){return void d.onError(g)}var h=c;if(b)try{h=b(c)}catch(g){return void d.onError(g)}e.set(f,h)},function(a){d.onError(a)},function(){d.onNext(e),d.onCompleted()})},c)};var ld="function",md="throw",xb=Ca.internals.isObject,nd=Ca.spawn=function(a){var b=ba(a);return function(c){function d(a,b){cc.schedule(c.bind(f,a,b))}function e(a,b){var c;if(arguments.length>2)for(var b=[],h=1,i=arguments.length;i>h;h++)b.push(arguments[h]);if(a)try{c=g[md](a)}catch(j){return d(j)}if(!a)try{c=g.next(b)}catch(j){return d(j)}if(c.done)return d(null,c.value);if(c.value=Y(c.value,f),typeof c.value!==ld)e(new TypeError("Rx.spawn only supports a function, Promise, Observable, Object or Array."));else{var k=!1;try{c.value.call(f,function(){k||(k=!0,e.apply(f,arguments))})}catch(j){cc.schedule(function(){k||(k=!0,e.call(f,j))})}}}var f=this,g=a;if(b){for(var h=[],i=0,j=arguments.length;j>i;i++)h.push(arguments[i]);var j=h.length,k=j&&typeof h[j-1]===ld;c=k?h.pop():da,g=a.apply(this,h)}else c=c||da;e()}};qc.start=function(a,b,c){return od(a,b,c)()};var od=qc.toAsync=function(a,b,c){return Vb(c)||(c=cc),function(){var d=arguments,e=new Ld;return c.schedule(function(){var c;try{c=a.apply(b,d)}catch(f){return void e.onError(f)}e.onNext(c),e.onCompleted()}),e.asObservable()}};qc.fromCallback=function(a,b,c){return function(){for(var d=arguments.length,e=new Array(d),f=0;d>f;f++)e[f]=arguments[f];return new Hd(function(d){function f(){for(var a=arguments.length,e=new Array(a),f=0;a>f;f++)e[f]=arguments[f];if(c){try{e=c.apply(b,e)}catch(g){return d.onError(g)}d.onNext(e)}else e.length<=1?d.onNext.apply(d,e):d.onNext(e);d.onCompleted()}e.push(f),a.apply(b,e)}).publishLast().refCount()}},qc.fromNodeCallback=function(a,b,c){return function(){for(var d=arguments.length,e=new Array(d),f=0;d>f;f++)e[f]=arguments[f];return new Hd(function(d){function f(a){if(a)return void d.onError(a);for(var e=arguments.length,f=[],g=1;e>g;g++)f[g-1]=arguments[g];if(c){try{f=c.apply(b,f)}catch(h){return d.onError(h)}d.onNext(f)}else f.length<=1?d.onNext.apply(d,f):d.onNext(f);d.onCompleted()}e.push(f),a.apply(b,e)}).publishLast().refCount()}},Ca.config.useNativeEvents=!1,qc.fromEvent=function(a,b,c){return a.addListener?pd(function(c){a.addListener(b,c)},function(c){a.removeListener(b,c)},c):Ca.config.useNativeEvents||"function"!=typeof a.on||"function"!=typeof a.off?new Hd(function(d){return fa(a,b,function(a){var b=a;if(c)try{b=c(arguments)}catch(e){return d.onError(e)}d.onNext(b)})}).publish().refCount():pd(function(c){a.on(b,c)},function(c){a.off(b,c)},c)};var pd=qc.fromEventPattern=function(a,b,c){return new Hd(function(d){function e(a){var b=a;if(c)try{b=c(arguments)}catch(e){return d.onError(e)}d.onNext(b)}var f=a(e);return Lb(function(){b&&b(e,f)})}).publish().refCount()};qc.startAsync=function(a){var b;try{b=a()}catch(c){return Tc(c)}return Ac(b)};var qd=function(a){function b(a){var b=this.source.publish(),c=b.subscribe(a),d=Mb,e=this.pauser.distinctUntilChanged().subscribe(function(a){a?d=b.connect():(d.dispose(),d=Mb)});return new Ib(c,d,e)}function c(c,d){this.source=c,this.controller=new Kd,d&&d.subscribe?this.pauser=this.controller.merge(d):this.pauser=this.controller,a.call(this,b,c)}return Cb(c,a),c.prototype.pause=function(){this.controller.onNext(!1)},c.prototype.resume=function(){this.controller.onNext(!0)},c}(qc);kc.pausable=function(a){return new qd(this,a)};var rd=function(b){function c(b){function c(){for(;e.length>0;)b.onNext(e.shift())}var d,e=[],f=ga(this.source,this.pauser.distinctUntilChanged().startWith(!1),function(a,b){return{data:a,shouldFire:b}}).subscribe(function(f){d!==a&&f.shouldFire!=d?(d=f.shouldFire,f.shouldFire&&c()):(d=f.shouldFire,f.shouldFire?b.onNext(f.data):e.push(f.data))},function(a){c(),b.onError(a)},function(){c(),b.onCompleted()});return f}function d(a,d){this.source=a,this.controller=new Kd,d&&d.subscribe?this.pauser=this.controller.merge(d):this.pauser=this.controller,b.call(this,c,a)}return Cb(d,b),d.prototype.pause=function(){this.controller.onNext(!1)},d.prototype.resume=function(){this.controller.onNext(!0)},d}(qc);kc.pausableBuffered=function(a){return new rd(this,a)};var sd=function(a){function b(a){return this.source.subscribe(a)}function c(c,d,e){a.call(this,b,c),this.subject=new td(d,e),this.source=c.multicast(this.subject).refCount()}return Cb(c,a),c.prototype.request=function(a){return this.subject.request(null==a?-1:a)},c}(qc),td=function(a){function b(a){return this.subject.subscribe(a)}function c(c,d){null==c&&(c=!0),a.call(this,b),this.subject=new Kd,this.enableQueue=c,this.queue=c?[]:null,this.requestedCount=0,this.requestedDisposable=Mb,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.scheduler=d||$b}return Cb(c,a),Db(c.prototype,ic,{onCompleted:function(){this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length?this.queue.push(ec.createOnCompleted()):this.subject.onCompleted()},onError:function(a){this.hasFailed=!0,this.error=a,this.enableQueue&&0!==this.queue.length?this.queue.push(ec.createOnError(a)):this.subject.onError(a)},onNext:function(a){var b=!1;0===this.requestedCount?this.enableQueue&&this.queue.push(ec.createOnNext(a)):(-1!==this.requestedCount&&0===this.requestedCount--&&this.disposeCurrentRequest(),b=!0),b&&this.subject.onNext(a)},_processRequest:function(a){if(this.enableQueue){for(;this.queue.length>=a&&a>0||this.queue.length>0&&"N"!==this.queue[0].kind;){var b=this.queue.shift();b.accept(this.subject),"N"===b.kind?a--:(this.disposeCurrentRequest(),this.queue=[])}return{numberOfItems:a,returnValue:0!==this.queue.length}}return{numberOfItems:a,returnValue:!1}},request:function(a){this.disposeCurrentRequest();var b=this;return this.requestedDisposable=this.scheduler.scheduleWithState(a,function(a,c){var d=b._processRequest(c),e=d.numberOfItems;d.returnValue||(b.requestedCount=e,b.requestedDisposable=Lb(function(){b.requestedCount=0}))}),this.requestedDisposable},disposeCurrentRequest:function(){this.requestedDisposable.dispose(),this.requestedDisposable=Mb}}),c}(qc);kc.controlled=function(a,b){return a&&Vb(a)&&(b=a,a=!0),null==a&&(a=!0),new sd(this,a,b)};var ud=function(a){function b(a){this.subscription=this.source.subscribe(new d(a,this,this.subscription));var b=this;return cc.schedule(function(){b.source.request(1)}),this.subscription}function c(c){a.call(this,b,c),this.source=c}Cb(c,a);var d=function(a){function b(b,c,d){a.call(this),this.observer=b,this.observable=c,this.cancel=d}Cb(b,a);var c=b.prototype;return c.completed=function(){this.observer.onCompleted(),this.dispose()},c.error=function(a){this.observer.onError(a),this.dispose()},c.next=function(a){this.observer.onNext(a);var b=this;cc.schedule(function(){b.observable.source.request(1)})},c.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),a.prototype.dispose.call(this)},b}(lc);return c}(qc);sd.prototype.stopAndWait=function(){return new ud(this)};var vd=function(a){function b(a){this.subscription=this.source.subscribe(new d(a,this,this.subscription));var b=this;return cc.schedule(function(){b.source.request(b.windowSize)}),this.subscription}function c(c,d){a.call(this,b,c),this.source=c,this.windowSize=d}Cb(c,a);var d=function(a){function b(a,b,c){this.observer=a,this.observable=b,this.cancel=c,this.received=0}Cb(b,a);var c=b.prototype;return c.completed=function(){this.observer.onCompleted(),this.dispose()},c.error=function(a){this.observer.onError(a),this.dispose()},c.next=function(a){if(this.observer.onNext(a),this.received=++this.received%this.observable.windowSize,0===this.received){var b=this;cc.schedule(function(){b.observable.source.request(b.observable.windowSize)})}},c.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),a.prototype.dispose.call(this)},b}(lc);return c}(qc);sd.prototype.windowed=function(a){return new vd(this,a)},kc.pipe=function(a){function b(){c.resume()}var c=this.pausableBuffered();return a.addListener("drain",b),c.subscribe(function(b){!a.write(String(b))&&c.pause()},function(b){a.emit("error",b)},function(){!a._isStdio&&a.end(),a.removeListener("drain",b)}),c.resume(),a},kc.multicast=function(a,b){var c=this;return"function"==typeof a?new Hd(function(d){var e=c.multicast(a());return new Ib(b(e).subscribe(d),e.connect())},c):new zd(c,a)},kc.publish=function(a){return a&&La(a)?this.multicast(function(){return new Kd},a):this.multicast(new Kd)},kc.share=function(){return this.publish().refCount()},kc.publishLast=function(a){return a&&La(a)?this.multicast(function(){return new Ld},a):this.multicast(new Ld)},kc.publishValue=function(a,b){return 2===arguments.length?this.multicast(function(){return new xd(b)},a):this.multicast(new xd(a))},kc.shareValue=function(a){return this.publishValue(a).refCount()},kc.replay=function(a,b,c,d){return a&&La(a)?this.multicast(function(){return new yd(b,c,d)},a):this.multicast(new yd(b,c,d))},kc.shareReplay=function(a,b,c){return this.replay(null,a,b,c).refCount()};var wd=function(a,b){this.subject=a,this.observer=b};wd.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var a=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(a,1),this.observer=null}};var xd=Ca.BehaviorSubject=function(a){function c(a){return Ob(this),this.isStopped?(this.hasError?a.onError(this.error):a.onCompleted(),Mb):(this.observers.push(a),a.onNext(this.value),new wd(this,a))}function d(b){a.call(this,c),this.value=b,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.hasError=!1}return Cb(d,a),Db(d.prototype,ic,{getValue:function(){if(Ob(this),this.hasError)throw this.error;return this.value},hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(Ob(this),!this.isStopped){this.isStopped=!0;for(var a=0,c=b(this.observers),d=c.length;d>a;a++)c[a].onCompleted();this.observers.length=0}},onError:function(a){if(Ob(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=a;for(var c=0,d=b(this.observers),e=d.length;e>c;c++)d[c].onError(a);this.observers.length=0}},onNext:function(a){if(Ob(this),!this.isStopped){this.value=a;for(var c=0,d=b(this.observers),e=d.length;e>c;c++)d[c].onNext(a)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.exception=null}}),d}(qc),yd=Ca.ReplaySubject=function(a){function c(a,b){return Lb(function(){b.dispose(),!a.isDisposed&&a.observers.splice(a.observers.indexOf(b),1)})}function d(a){var b=new oc(this.scheduler,a),d=c(this,b);Ob(this),this._trim(this.scheduler.now()),this.observers.push(b);for(var e=0,f=this.q.length;f>e;e++)b.onNext(this.q[e].value);return this.hasError?b.onError(this.error):this.isStopped&&b.onCompleted(),b.ensureActive(),d}function e(b,c,e){this.bufferSize=null==b?f:b,this.windowSize=null==c?f:c,this.scheduler=e||$b,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,a.call(this,d)}var f=Math.pow(2,53)-1;return Cb(e,a),Db(e.prototype,ic.prototype,{hasObservers:function(){return this.observers.length>0},_trim:function(a){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&a-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(a){if(Ob(this),!this.isStopped){var c=this.scheduler.now();this.q.push({interval:c,value:a}),this._trim(c);for(var d=0,e=b(this.observers),f=e.length;f>d;d++){var g=e[d];g.onNext(a),g.ensureActive()}}},onError:function(a){if(Ob(this),!this.isStopped){this.isStopped=!0,this.error=a,this.hasError=!0;var c=this.scheduler.now();this._trim(c);for(var d=0,e=b(this.observers),f=e.length;f>d;d++){var g=e[d];g.onError(a),g.ensureActive()}this.observers.length=0}},onCompleted:function(){if(Ob(this),!this.isStopped){this.isStopped=!0;var a=this.scheduler.now();this._trim(a);for(var c=0,d=b(this.observers),e=d.length;e>c;c++){var f=d[c];f.onCompleted(),f.ensureActive()}this.observers.length=0}},dispose:function(){this.isDisposed=!0,this.observers=null}}),e}(qc),zd=Ca.ConnectableObservable=function(a){function b(b,c){var d,e=!1,f=b.asObservable();this.connect=function(){return e||(e=!0,d=new Ib(f.subscribe(c),Lb(function(){e=!1}))),d},a.call(this,function(a){return c.subscribe(a)})}return Cb(b,a),b.prototype.refCount=function(){var a,b=0,c=this;return new Hd(function(d){var e=1===++b,f=c.subscribe(d);return e&&(a=c.connect()),function(){f.dispose(),0===--b&&a.dispose()}})},b}(qc);kc.singleInstance=function(){function a(){return d||(d=!0,b=c["finally"](function(){d=!1}).publish().refCount()),b}var b,c=this,d=!1;return new Hd(function(b){return a().subscribe(b)})};var Ad=function(){function b(a){if(0===(1&a))return 2===a;for(var b=Math.sqrt(a),c=3;b>=c;){if(a%c===0)return!1;c+=2}return!0}function c(a){var c,d,e;for(c=0;c<h.length;++c)if(d=h[c],d>=a)return d;for(e=1|a;e<h[h.length-1];){if(b(e))return e;e+=2}return a}function d(a){var b=757602046;if(!a.length)return b;for(var c=0,d=a.length;d>c;c++){var e=a.charCodeAt(c);b=(b<<5)-b+e,b&=b}return b}function e(a){var b=668265261;return a=61^a^a>>>16,a+=a<<3,a^=a>>>4,a*=b,a^=a>>>15}function f(){return{key:null,value:null,next:0,hashCode:0}}function g(a,b){if(0>a)throw new Ta;a>0&&this._initialize(a),this.comparer=b||Ga,this.freeCount=0,this.size=0,this.freeList=-1}var h=[1,3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143,4194301,8388593,16777213,33554393,67108859,134217689,268435399,536870909,1073741789,2147483647],i="no such key",j="duplicate key",k=function(){var a=0;return function(b){if(null==b)throw new Error(i);if("string"==typeof b)return d(b);if("number"==typeof b)return e(b);if("boolean"==typeof b)return b===!0?1:0;if(b instanceof Date)return e(b.valueOf());if(b instanceof RegExp)return d(b.toString());if("function"==typeof b.valueOf){var c=b.valueOf();if("number"==typeof c)return e(c);if("string"==typeof c)return d(c)}if(b.hashCode)return b.hashCode();var f=17*a++;return b.hashCode=function(){return f},f}}(),l=g.prototype;return l._initialize=function(a){var b,d=c(a);for(this.buckets=new Array(d),this.entries=new Array(d),b=0;d>b;b++)this.buckets[b]=-1,this.entries[b]=f();this.freeList=-1},l.add=function(a,b){this._insert(a,b,!0)},l._insert=function(a,b,c){this.buckets||this._initialize(0);for(var d,e=2147483647&k(a),f=e%this.buckets.length,g=this.buckets[f];g>=0;g=this.entries[g].next)if(this.entries[g].hashCode===e&&this.comparer(this.entries[g].key,a)){if(c)throw new Error(j);return void(this.entries[g].value=b)}this.freeCount>0?(d=this.freeList,this.freeList=this.entries[d].next,--this.freeCount):(this.size===this.entries.length&&(this._resize(),f=e%this.buckets.length),d=this.size,++this.size),this.entries[d].hashCode=e,this.entries[d].next=this.buckets[f],this.entries[d].key=a,this.entries[d].value=b,this.buckets[f]=d},l._resize=function(){var a=c(2*this.size),b=new Array(a);for(e=0;e<b.length;++e)b[e]=-1;var d=new Array(a);for(e=0;e<this.size;++e)d[e]=this.entries[e];for(var e=this.size;a>e;++e)d[e]=f();for(var g=0;g<this.size;++g){var h=d[g].hashCode%a;d[g].next=b[h],b[h]=g}this.buckets=b,this.entries=d},l.remove=function(a){if(this.buckets)for(var b=2147483647&k(a),c=b%this.buckets.length,d=-1,e=this.buckets[c];e>=0;e=this.entries[e].next){if(this.entries[e].hashCode===b&&this.comparer(this.entries[e].key,a))return 0>d?this.buckets[c]=this.entries[e].next:this.entries[d].next=this.entries[e].next,this.entries[e].hashCode=-1,this.entries[e].next=this.freeList,this.entries[e].key=null,this.entries[e].value=null,this.freeList=e,++this.freeCount,!0;d=e}return!1},l.clear=function(){var a,b;if(!(this.size<=0)){for(a=0,b=this.buckets.length;b>a;++a)this.buckets[a]=-1;for(a=0;a<this.size;++a)this.entries[a]=f();this.freeList=-1,this.size=0}},l._findEntry=function(a){if(this.buckets)for(var b=2147483647&k(a),c=this.buckets[b%this.buckets.length];c>=0;c=this.entries[c].next)if(this.entries[c].hashCode===b&&this.comparer(this.entries[c].key,a))return c;return-1},l.count=function(){return this.size-this.freeCount},l.tryGetValue=function(b){var c=this._findEntry(b);return c>=0?this.entries[c].value:a},l.getValues=function(){var a=0,b=[];if(this.entries)for(var c=0;c<this.size;c++)this.entries[c].hashCode>=0&&(b[a++]=this.entries[c].value);return b},l.get=function(a){var b=this._findEntry(a);if(b>=0)return this.entries[b].value;throw new Error(i)},l.set=function(a,b){this._insert(a,b,!1)},l.containskey=function(a){return this._findEntry(a)>=0},g}();kc.join=function(a,b,c,d){var e=this;return new Hd(function(f){var g=new Ib,h=!1,i=!1,j=0,k=0,l=new Ad,m=new Ad;return g.add(e.subscribe(function(a){var c=j++,e=new Pb;l.add(c,a),g.add(e);var i,k=function(){l.remove(c)&&0===l.count()&&h&&f.onCompleted(),g.remove(e)};try{i=b(a)}catch(n){return void f.onError(n)}e.setDisposable(i.take(1).subscribe(Da,f.onError.bind(f),k)),m.getValues().forEach(function(b){var c;try{c=d(a,b)}catch(e){return void f.onError(e)}f.onNext(c)})},f.onError.bind(f),function(){h=!0,(i||0===l.count())&&f.onCompleted()})),g.add(a.subscribe(function(a){var b=k++,e=new Pb;m.add(b,a),g.add(e);var h,j=function(){m.remove(b)&&0===m.count()&&i&&f.onCompleted(),g.remove(e)};try{h=c(a)}catch(n){return void f.onError(n)}e.setDisposable(h.take(1).subscribe(Da,f.onError.bind(f),j)),l.getValues().forEach(function(b){var c;try{c=d(b,a)}catch(e){return void f.onError(e)}f.onNext(c)})},f.onError.bind(f),function(){i=!0,(h||0===m.count())&&f.onCompleted()})),g},e)},kc.groupJoin=function(a,b,c,d){var e=this;return new Hd(function(f){function g(a){return function(b){b.onError(a)}}var h=new Ib,i=new Rb(h),j=new Ad,k=new Ad,l=0,m=0;return h.add(e.subscribe(function(a){var c=new Kd,e=l++;j.add(e,c);var m;try{m=d(a,Eb(c,i))}catch(n){return j.getValues().forEach(g(n)),void f.onError(n)}f.onNext(m),k.getValues().forEach(function(a){c.onNext(a)});var o=new Pb;h.add(o);var p,q=function(){j.remove(e)&&c.onCompleted(),h.remove(o)};try{p=b(a)}catch(n){return j.getValues().forEach(g(n)),void f.onError(n)}o.setDisposable(p.take(1).subscribe(Da,function(a){j.getValues().forEach(g(a)),f.onError(a)},q))},function(a){j.getValues().forEach(g(a)),f.onError(a)},f.onCompleted.bind(f))),h.add(a.subscribe(function(a){var b=m++;k.add(b,a);var d=new Pb;h.add(d);var e,i=function(){k.remove(b),h.remove(d)};try{e=c(a)}catch(l){return j.getValues().forEach(g(l)),void f.onError(l)}d.setDisposable(e.take(1).subscribe(Da,function(a){j.getValues().forEach(g(a)),f.onError(a)},i)),j.getValues().forEach(function(b){b.onNext(a)})},function(a){j.getValues().forEach(g(a)),f.onError(a)})),i},e)},kc.buffer=function(a,b){return this.window.apply(this,arguments).selectMany(function(a){return a.toArray()})},kc.window=function(a,b){return 1===arguments.length&&"function"!=typeof arguments[0]?ia.call(this,a):"function"==typeof a?ja.call(this,a):ha.call(this,a,b)},kc.pairwise=function(){var a=this;return new Hd(function(b){var c,d=!1;return a.subscribe(function(a){d?b.onNext([c,a]):d=!0,c=a},b.onError.bind(b),b.onCompleted.bind(b))},a)},kc.partition=function(a,b){return[this.filter(a,b),this.filter(function(c,d,e){return!a.call(b,c,d,e)})]};var Bd=function(a){function b(a,b){this.c=a,this.s=b}return Cb(b,a),b.prototype[Ya]=function(){var a=this;return{next:function(){return a.c()?{done:!1,value:a.s}:{done:!0,value:void 0}}}},b}(sc);kc.letBind=kc.let=function(a){return a(this)},qc["if"]=qc.ifThen=function(a,b,c){return Cc(function(){return c||(c=Ec()),Ja(b)&&(b=Ac(b)),Ja(c)&&(c=Ac(c)),"function"==typeof c.now&&(c=Ec(c)),a()?b:c})},qc["for"]=qc.forIn=function(a,b,c){return yc(a,b,c).concat()};var Cd=qc["while"]=qc.whileDo=function(a,b){return Ja(b)&&(b=Ac(b)),ka(a,b).concat()};kc.doWhile=function(a){return Xc([this,Cd(a,this)])},qc["case"]=qc.switchCase=function(a,b,c){return Cc(function(){Ja(c)&&(c=Ac(c)),c||(c=Ec()),"function"==typeof c.now&&(c=Ec(c));var d=b[a()];return Ja(d)&&(d=Ac(d)),d||c})},kc.expand=function(a,b){Vb(b)||(b=Zb);var c=this;return new Hd(function(d){var e=[],f=new Qb,g=new Ib(f),h=0,i=!1,j=function(){var c=!1;e.length>0&&(c=!i,i=!0),c&&f.setDisposable(b.scheduleRecursive(function(b){var c;if(!(e.length>0))return void(i=!1);c=e.shift();var f=new Pb;g.add(f),f.setDisposable(c.subscribe(function(b){d.onNext(b);var c=null;try{c=a(b)}catch(f){d.onError(f)}e.push(c),h++,j()},d.onError.bind(d),function(){g.remove(f),h--,0===h&&d.onCompleted()})),b()}))};return e.push(c),h++,j(),g},this)},qc.forkJoin=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return new Hd(function(b){var c=a.length;if(0===c)return b.onCompleted(),Mb;for(var d=new Ib,e=!1,f=new Array(c),g=new Array(c),h=new Array(c),i=0;c>i;i++)!function(i){var j=a[i];Ja(j)&&(j=Ac(j)),d.add(j.subscribe(function(a){e||(f[i]=!0,h[i]=a)},function(a){e=!0,b.onError(a),d.dispose()},function(){if(!e){if(!f[i])return void b.onCompleted();g[i]=!0;for(var a=0;c>a;a++)if(!g[a])return;e=!0,b.onNext(h),b.onCompleted()}}))}(i);return d})},kc.forkJoin=function(a,b){var c=this;return new Hd(function(d){var e,f,g=!1,h=!1,i=!1,j=!1,k=new Pb,l=new Pb;return Ja(a)&&(a=Ac(a)),k.setDisposable(c.subscribe(function(a){i=!0,e=a},function(a){l.dispose(),d.onError(a)},function(){if(g=!0,h)if(i)if(j){var a;try{a=b(e,f)}catch(c){return void d.onError(c)}d.onNext(a),d.onCompleted()}else d.onCompleted();else d.onCompleted()})),l.setDisposable(a.subscribe(function(a){j=!0,f=a},function(a){k.dispose(),d.onError(a)},function(){if(h=!0,g)if(i)if(j){var a;try{a=b(e,f)}catch(c){return void d.onError(c)}d.onNext(a),d.onCompleted()}else d.onCompleted();else d.onCompleted()})),new Ib(k,l)},c)},kc.manySelect=kc.extend=function(a,b){
Vb(b)||(b=Zb);var c=this;return Cc(function(){var d;return c.map(function(a){var b=new Dd(a);return d&&d.onNext(a),d=b,b}).tap(Da,function(a){d&&d.onError(a)},function(){d&&d.onCompleted()}).observeOn(b).map(a)},c)};var Dd=function(a){function b(a){var b=this,c=new Ib;return c.add($b.schedule(function(){a.onNext(b.head),c.add(b.tail.mergeAll().subscribe(a))})),c}function c(c){a.call(this,b),this.head=c,this.tail=new Ld}return Cb(c,a),Db(c.prototype,ic,{onCompleted:function(){this.onNext(qc.empty())},onError:function(a){this.onNext(qc.throwError(a))},onNext:function(a){this.tail.onNext(a),this.tail.onCompleted()}}),c}(qc),Ed=xa.Map||function(){function b(){this._keys=[],this._values=[]}return b.prototype.get=function(b){var c=this._keys.indexOf(b);return-1!==c?this._values[c]:a},b.prototype.set=function(a,b){var c=this._keys.indexOf(a);-1!==c&&(this._values[c]=b),this._values[this._keys.push(a)-1]=b},b.prototype.forEach=function(a,b){for(var c=0,d=this._keys.length;d>c;c++)a.call(b,this._values[c],this._keys[c])},b}();la.prototype.and=function(a){return new la(this.patterns.concat(a))},la.prototype.thenDo=function(a){return new ma(this,a)},ma.prototype.activate=function(a,b,c){for(var d=this,e=[],f=0,g=this.expression.patterns.length;g>f;f++)e.push(na(a,this.expression.patterns[f],b.onError.bind(b)));var h=new oa(e,function(){var a;try{a=d.selector.apply(d,arguments)}catch(c){return void b.onError(c)}b.onNext(a)},function(){for(var a=0,b=e.length;b>a;a++)e[a].removeActivePlan(h);c(h)});for(f=0,g=e.length;g>f;f++)e[f].addActivePlan(h);return h},oa.prototype.dequeue=function(){this.joinObservers.forEach(function(a){a.queue.shift()})},oa.prototype.match=function(){var a,b,c=!0;for(a=0,b=this.joinObserverArray.length;b>a;a++)if(0===this.joinObserverArray[a].queue.length){c=!1;break}if(c){var d=[],e=!1;for(a=0,b=this.joinObserverArray.length;b>a;a++)d.push(this.joinObserverArray[a].queue[0]),"C"===this.joinObserverArray[a].queue[0].kind&&(e=!0);if(e)this.onCompleted();else{this.dequeue();var f=[];for(a=0,b=d.length;a<d.length;a++)f.push(d[a].value);this.onNext.apply(this,f)}}};var Fd=function(a){function b(b,c){a.call(this),this.source=b,this.onError=c,this.queue=[],this.activePlans=[],this.subscription=new Pb,this.isDisposed=!1}Cb(b,a);var c=b.prototype;return c.next=function(a){if(!this.isDisposed){if("E"===a.kind)return this.onError(a.exception);this.queue.push(a);for(var b=this.activePlans.slice(0),c=0,d=b.length;d>c;c++)b[c].match()}},c.error=Da,c.completed=Da,c.addActivePlan=function(a){this.activePlans.push(a)},c.subscribe=function(){this.subscription.setDisposable(this.source.materialize().subscribe(this))},c.removeActivePlan=function(a){this.activePlans.splice(this.activePlans.indexOf(a),1),0===this.activePlans.length&&this.dispose()},c.dispose=function(){a.prototype.dispose.call(this),this.isDisposed||(this.isDisposed=!0,this.subscription.dispose())},b}(lc);kc.and=function(a){return new la([this,a])},kc.thenDo=function(a){return new la([this]).thenDo(a)},qc.when=function(){var a,b=arguments.length;if(Array.isArray(arguments[0]))a=arguments[0];else{a=new Array(b);for(var c=0;b>c;c++)a[c]=arguments[c]}return new Hd(function(b){var c=[],d=new Ed,e=jc(function(a){b.onNext(a)},function(a){d.forEach(function(b){b.onError(a)}),b.onError(a)},function(a){b.onCompleted()});try{for(var f=0,g=a.length;g>f;f++)c.push(a[f].activate(d,e,function(a){var d=c.indexOf(a);c.splice(d,1),0===c.length&&b.onCompleted()}))}catch(h){Tc(h).subscribe(b)}var i=new Ib;return d.forEach(function(a){a.subscribe(),i.add(a)}),i})};{var Gd=qc.interval=function(a,b){return sa(a,a,Vb(b)?b:cc)};qc.timer=function(b,c,d){var e;return Vb(d)||(d=cc),c!==a&&"number"==typeof c?e=c:Vb(c)&&(d=c),b instanceof Date&&e===a?pa(b.getTime(),d):b instanceof Date&&e!==a?(e=c,qa(b.getTime(),e,d)):e===a?ra(b,d):sa(b,e,d)}}kc.delay=function(a,b){return Vb(b)||(b=cc),a instanceof Date?ua(this,a.getTime(),b):ta(this,a,b)},kc.debounce=kc.throttleWithTimeout=function(a,b){Vb(b)||(b=cc);var c=this;return new Hd(function(d){var e,f=new Qb,g=!1,h=0,i=c.subscribe(function(c){g=!0,e=c,h++;var i=h,j=new Pb;f.setDisposable(j),j.setDisposable(b.scheduleWithRelative(a,function(){g&&h===i&&d.onNext(e),g=!1}))},function(a){f.dispose(),d.onError(a),g=!1,h++},function(){f.dispose(),g&&d.onNext(e),d.onCompleted(),g=!1,h++});return new Ib(i,f)},this)},kc.throttle=function(a,b){return this.debounce(a,b)},kc.windowWithTime=function(a,b,c){var d,e=this;return null==b&&(d=a),Vb(c)||(c=cc),"number"==typeof b?d=b:Vb(b)&&(d=a,c=b),new Hd(function(b){function f(){var a=new Pb,e=!1,g=!1;l.setDisposable(a),j===i?(e=!0,g=!0):i>j?e=!0:g=!0;var n=e?j:i,o=n-m;m=n,e&&(j+=d),g&&(i+=d),a.setDisposable(c.scheduleWithRelative(o,function(){if(g){var a=new Kd;k.push(a),b.onNext(Eb(a,h))}e&&k.shift().onCompleted(),f()}))}var g,h,i=d,j=a,k=[],l=new Qb,m=0;return g=new Ib(l),h=new Rb(g),k.push(new Kd),b.onNext(Eb(k[0],h)),f(),g.add(e.subscribe(function(a){for(var b=0,c=k.length;c>b;b++)k[b].onNext(a)},function(a){for(var c=0,d=k.length;d>c;c++)k[c].onError(a);b.onError(a)},function(){for(var a=0,c=k.length;c>a;a++)k[a].onCompleted();b.onCompleted()})),h},e)},kc.windowWithTimeOrCount=function(a,b,c){var d=this;return Vb(c)||(c=cc),new Hd(function(e){function f(b){var d=new Pb;g.setDisposable(d),d.setDisposable(c.scheduleWithRelative(a,function(){if(b===k){j=0;var a=++k;l.onCompleted(),l=new Kd,e.onNext(Eb(l,i)),f(a)}}))}var g=new Qb,h=new Ib(g),i=new Rb(h),j=0,k=0,l=new Kd;return e.onNext(Eb(l,i)),f(0),h.add(d.subscribe(function(a){var c=0,d=!1;l.onNext(a),++j===b&&(d=!0,j=0,c=++k,l.onCompleted(),l=new Kd,e.onNext(Eb(l,i))),d&&f(c)},function(a){l.onError(a),e.onError(a)},function(){l.onCompleted(),e.onCompleted()})),i},d)},kc.bufferWithTime=function(a,b,c){return this.windowWithTime.apply(this,arguments).selectMany(function(a){return a.toArray()})},kc.bufferWithTimeOrCount=function(a,b,c){return this.windowWithTimeOrCount(a,b,c).selectMany(function(a){return a.toArray()})},kc.timeInterval=function(a){var b=this;return Vb(a)||(a=cc),Cc(function(){var c=a.now();return b.map(function(b){var d=a.now(),e=d-c;return c=d,{value:b,interval:e}})})},kc.timestamp=function(a){return Vb(a)||(a=cc),this.map(function(b){return{value:b,timestamp:a.now()}})},kc.sample=kc.throttleLatest=function(a,b){return Vb(b)||(b=cc),"number"==typeof a?va(this,Gd(a,b)):va(this,a)},kc.timeout=function(a,b,c){(null==b||"string"==typeof b)&&(b=Tc(new Error(b||"Timeout"))),Vb(c)||(c=cc);var d=this,e=a instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new Hd(function(f){function g(){var d=h;l.setDisposable(c[e](a,function(){h===d&&(Ja(b)&&(b=Ac(b)),j.setDisposable(b.subscribe(f)))}))}var h=0,i=new Pb,j=new Qb,k=!1,l=new Qb;return j.setDisposable(i),g(),i.setDisposable(d.subscribe(function(a){k||(h++,f.onNext(a),g())},function(a){k||(h++,f.onError(a))},function(){k||(h++,f.onCompleted())})),new Ib(j,l)},d)},qc.generateWithAbsoluteTime=function(a,b,c,d,e,f){return Vb(f)||(f=cc),new Hd(function(g){var h=!0,i=!1;return f.scheduleRecursiveWithAbsoluteAndState(a,f.now(),function(a,f){i&&g.onNext(a);try{if(h?h=!1:a=c(a),i=b(a))var j=d(a),k=e(a)}catch(l){return void g.onError(l)}i?f(j,k):g.onCompleted()})})},qc.generateWithRelativeTime=function(a,b,c,d,e,f){return Vb(f)||(f=cc),new Hd(function(g){var h=!0,i=!1;return f.scheduleRecursiveWithRelativeAndState(a,0,function(a,f){i&&g.onNext(a);try{if(h?h=!1:a=c(a),i=b(a))var j=d(a),k=e(a)}catch(l){return void g.onError(l)}i?f(j,k):g.onCompleted()})})},kc.delaySubscription=function(a,b){var c=a instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative",d=this;return Vb(b)||(b=cc),new Hd(function(e){var f=new Qb;return f.setDisposable(b[c](a,function(){f.setDisposable(d.subscribe(e))})),f},this)},kc.delayWithSelector=function(a,b){var c,d,e=this;return La(a)?d=a:(c=a,d=b),new Hd(function(a){function b(){i.setDisposable(e.subscribe(function(b){var c=p(d)(b);if(c===Fb)return a.onError(c.e);var e=new Pb;g.add(e),e.setDisposable(c.subscribe(function(){a.onNext(b),g.remove(e),f()},function(b){a.onError(b)},function(){a.onNext(b),g.remove(e),f()}))},function(b){a.onError(b)},function(){h=!0,i.dispose(),f()}))}function f(){h&&0===g.length&&a.onCompleted()}var g=new Ib,h=!1,i=new Qb;return c?i.setDisposable(c.subscribe(b,function(b){a.onError(b)},b)):b(),new Ib(i,g)},this)},kc.timeoutWithSelector=function(a,b,c){1===arguments.length&&(b=a,a=Mc()),c||(c=Tc(new Error("Timeout")));var d=this;return new Hd(function(e){function f(a){function b(){return k===d}var d=k,f=new Pb;i.setDisposable(f),f.setDisposable(a.subscribe(function(){b()&&h.setDisposable(c.subscribe(e)),f.dispose()},function(a){b()&&e.onError(a)},function(){b()&&h.setDisposable(c.subscribe(e))}))}function g(){var a=!l;return a&&k++,a}var h=new Qb,i=new Qb,j=new Pb;h.setDisposable(j);var k=0,l=!1;return f(a),j.setDisposable(d.subscribe(function(a){if(g()){e.onNext(a);var c;try{c=b(a)}catch(d){return void e.onError(d)}f(Ja(c)?Ac(c):c)}},function(a){g()&&e.onError(a)},function(){g()&&e.onCompleted()})),new Ib(h,i)},d)},kc.debounceWithSelector=function(a){var b=this;return new Hd(function(c){var d,e=!1,f=new Qb,g=0,h=b.subscribe(function(b){var h;try{h=a(b)}catch(i){return void c.onError(i)}Ja(h)&&(h=Ac(h)),e=!0,d=b,g++;var j=g,k=new Pb;f.setDisposable(k),k.setDisposable(h.subscribe(function(){e&&g===j&&c.onNext(d),e=!1,k.dispose()},c.onError.bind(c),function(){e&&g===j&&c.onNext(d),e=!1,k.dispose()}))},function(a){f.dispose(),c.onError(a),e=!1,g++},function(){f.dispose(),e&&c.onNext(d),c.onCompleted(),e=!1,g++});return new Ib(h,f)},b)},kc.throttleWithSelector=function(a){return this.debounceWithSelector(a)},kc.skipLastWithTime=function(a,b){Vb(b)||(b=cc);var c=this;return new Hd(function(d){var e=[];return c.subscribe(function(c){var f=b.now();for(e.push({interval:f,value:c});e.length>0&&f-e[0].interval>=a;)d.onNext(e.shift().value)},function(a){d.onError(a)},function(){for(var c=b.now();e.length>0&&c-e[0].interval>=a;)d.onNext(e.shift().value);d.onCompleted()})},c)},kc.takeLastWithTime=function(a,b){var c=this;return Vb(b)||(b=cc),new Hd(function(d){var e=[];return c.subscribe(function(c){var d=b.now();for(e.push({interval:d,value:c});e.length>0&&d-e[0].interval>=a;)e.shift()},function(a){d.onError(a)},function(){for(var c=b.now();e.length>0;){var f=e.shift();c-f.interval<=a&&d.onNext(f.value)}d.onCompleted()})},c)},kc.takeLastBufferWithTime=function(a,b){var c=this;return Vb(b)||(b=cc),new Hd(function(d){var e=[];return c.subscribe(function(c){var d=b.now();for(e.push({interval:d,value:c});e.length>0&&d-e[0].interval>=a;)e.shift()},function(a){d.onError(a)},function(){for(var c=b.now(),f=[];e.length>0;){var g=e.shift();c-g.interval<=a&&f.push(g.value)}d.onNext(f),d.onCompleted()})},c)},kc.takeWithTime=function(a,b){var c=this;return Vb(b)||(b=cc),new Hd(function(d){return new Ib(b.scheduleWithRelative(a,function(){d.onCompleted()}),c.subscribe(d))},c)},kc.skipWithTime=function(a,b){var c=this;return Vb(b)||(b=cc),new Hd(function(d){var e=!1;return new Ib(b.scheduleWithRelative(a,function(){e=!0}),c.subscribe(function(a){e&&d.onNext(a)},d.onError.bind(d),d.onCompleted.bind(d)))},c)},kc.skipUntilWithTime=function(a,b){Vb(b)||(b=cc);var c=this,d=a instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new Hd(function(e){var f=!1;return new Ib(b[d](a,function(){f=!0}),c.subscribe(function(a){f&&e.onNext(a)},function(a){e.onError(a)},function(){e.onCompleted()}))},c)},kc.takeUntilWithTime=function(a,b){Vb(b)||(b=cc);var c=this,d=a instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new Hd(function(e){return new Ib(b[d](a,function(){e.onCompleted()}),c.subscribe(e))},c)},kc.throttleFirst=function(a,b){Vb(b)||(b=cc);var c=+a||0;if(0>=c)throw new RangeError("windowDuration cannot be less or equal zero.");var d=this;return new Hd(function(a){var e=0;return d.subscribe(function(d){var f=b.now();(0===e||f-e>=c)&&(e=f,a.onNext(d))},function(b){a.onError(b)},function(){a.onCompleted()})},d)},kc.transduce=function(a){function b(a){return{"@@transducer/init":function(){return a},"@@transducer/step":function(a,b){return a.onNext(b)},"@@transducer/result":function(a){return a.onCompleted()}}}var c=this;return new Hd(function(d){var e=a(b(d));return c.subscribe(function(a){try{e["@@transducer/step"](d,a)}catch(b){d.onError(b)}},function(a){d.onError(a)},function(){e["@@transducer/result"](d)})},c)},kc.exclusive=function(){var a=this;return new Hd(function(b){var c=!1,d=!1,e=new Pb,f=new Ib;return f.add(e),e.setDisposable(a.subscribe(function(a){if(!c){c=!0,Ja(a)&&(a=Ac(a));var e=new Pb;f.add(e),e.setDisposable(a.subscribe(b.onNext.bind(b),b.onError.bind(b),function(){f.remove(e),c=!1,d&&1===f.length&&b.onCompleted()}))}},b.onError.bind(b),function(){d=!0,c||1!==f.length||b.onCompleted()})),f},this)},kc.exclusiveMap=function(a,b){var c=this,d=bb(a,b,3);return new Hd(function(a){var b=0,e=!1,f=!0,g=new Pb,h=new Ib;return h.add(g),g.setDisposable(c.subscribe(function(c){e||(e=!0,innerSubscription=new Pb,h.add(innerSubscription),Ja(c)&&(c=Ac(c)),innerSubscription.setDisposable(c.subscribe(function(e){var f;try{f=d(e,b++,c)}catch(g){return void a.onError(g)}a.onNext(f)},function(b){a.onError(b)},function(){h.remove(innerSubscription),e=!1,f&&1===h.length&&a.onCompleted()})))},function(b){a.onError(b)},function(){f=!0,1!==h.length||e||a.onCompleted()})),h},this)},Ca.VirtualTimeScheduler=function(a){function b(){return this.toDateTimeOffset(this.clock)}function c(a,b){return this.scheduleAbsoluteWithState(a,this.clock,b)}function d(a,b,c){return this.scheduleRelativeWithState(a,this.toRelative(b),c)}function e(a,b,c){return this.scheduleRelativeWithState(a,this.toRelative(b-this.now()),c)}function f(a,b){return b(),Mb}function g(f,g){this.clock=f,this.comparer=g,this.isEnabled=!1,this.queue=new Gb(1024),a.call(this,b,c,d,e)}Cb(g,a);var h=g.prototype;return h.add=Wa,h.toDateTimeOffset=Wa,h.toRelative=Wa,h.schedulePeriodicWithState=function(a,b,c){var d=new Yb(this,a,b,c);return d.start()},h.scheduleRelativeWithState=function(a,b,c){var d=this.add(this.clock,b);return this.scheduleAbsoluteWithState(a,d,c)},h.scheduleRelative=function(a,b){return this.scheduleRelativeWithState(b,a,f)},h.start=function(){if(!this.isEnabled){this.isEnabled=!0;do{var a=this.getNext();null!==a?(this.comparer(a.dueTime,this.clock)>0&&(this.clock=a.dueTime),a.invoke()):this.isEnabled=!1}while(this.isEnabled)}},h.stop=function(){this.isEnabled=!1},h.advanceTo=function(a){var b=this.comparer(this.clock,a);if(this.comparer(this.clock,a)>0)throw new Ta;if(0!==b&&!this.isEnabled){this.isEnabled=!0;do{var c=this.getNext();null!==c&&this.comparer(c.dueTime,a)<=0?(this.comparer(c.dueTime,this.clock)>0&&(this.clock=c.dueTime),c.invoke()):this.isEnabled=!1}while(this.isEnabled);this.clock=a}},h.advanceBy=function(a){var b=this.add(this.clock,a),c=this.comparer(this.clock,b);if(c>0)throw new Ta;0!==c&&this.advanceTo(b)},h.sleep=function(a){var b=this.add(this.clock,a);if(this.comparer(this.clock,b)>=0)throw new Ta;this.clock=b},h.getNext=function(){for(;this.queue.length>0;){var a=this.queue.peek();if(!a.isCancelled())return a;this.queue.dequeue()}return null},h.scheduleAbsolute=function(a,b){return this.scheduleAbsoluteWithState(b,a,f)},h.scheduleAbsoluteWithState=function(a,b,c){function d(a,b){return e.queue.remove(f),c(a,b)}var e=this,f=new Sb(this,a,d,b,this.comparer);return this.queue.enqueue(f),f.disposable},g}(Tb),Ca.HistoricalScheduler=function(a){function b(b,c){var d=null==b?0:b,e=c||Ha;a.call(this,d,e)}Cb(b,a);var c=b.prototype;return c.add=function(a,b){return a+b},c.toDateTimeOffset=function(a){return new Date(a).getTime()},c.toRelative=function(a){return a},b}(Ca.VirtualTimeScheduler);var Hd=Ca.AnonymousObservable=function(a){function b(a){return a&&La(a.dispose)?a:La(a)?Lb(a):Mb}function c(a,c){var d=c[0],e=c[1],f=p(e)(d);return f!==Fb||d.fail(Fb.e)?void d.setDisposable(b(f)):q(Fb.e)}function d(b,d){function e(a){var d=new Id(a),e=[d,b];return $b.scheduleRequired()?$b.scheduleWithState(e,c):c(null,e),d}this.source=d,a.call(this,e)}return Cb(d,a),d}(qc),Id=function(a){function b(b){a.call(this),this.observer=b,this.m=new Pb}Cb(b,a);var c=b.prototype;return c.next=function(a){var b=p(this.observer.onNext).call(this.observer,a);b===Fb&&(this.dispose(),q(b.e))},c.error=function(a){var b=p(this.observer.onError).call(this.observer,a);this.dispose(),b===Fb&&q(b.e)},c.completed=function(){var a=p(this.observer.onCompleted).call(this.observer);this.dispose(),a===Fb&&q(a.e)},c.setDisposable=function(a){this.m.setDisposable(a)},c.getDisposable=function(){return this.m.getDisposable()},c.dispose=function(){a.prototype.dispose.call(this),this.m.dispose()},b}(lc),Jd=function(a){function b(a){return this.underlyingObservable.subscribe(a)}function c(c,d,e){a.call(this,b),this.key=c,this.underlyingObservable=e?new Hd(function(a){return new Ib(e.getDisposable(),d.subscribe(a))}):d}return Cb(c,a),c}(qc),Kd=Ca.Subject=function(a){function c(a){return Ob(this),this.isStopped?this.hasError?(a.onError(this.error),Mb):(a.onCompleted(),Mb):(this.observers.push(a),new wd(this,a))}function d(){a.call(this,c),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return Cb(d,a),Db(d.prototype,ic.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(Ob(this),!this.isStopped){this.isStopped=!0;for(var a=0,c=b(this.observers),d=c.length;d>a;a++)c[a].onCompleted();this.observers.length=0}},onError:function(a){if(Ob(this),!this.isStopped){this.isStopped=!0,this.error=a,this.hasError=!0;for(var c=0,d=b(this.observers),e=d.length;e>c;c++)d[c].onError(a);this.observers.length=0}},onNext:function(a){if(Ob(this),!this.isStopped)for(var c=0,d=b(this.observers),e=d.length;e>c;c++)d[c].onNext(a)},dispose:function(){this.isDisposed=!0,this.observers=null}}),d.create=function(a,b){return new Md(a,b)},d}(qc),Ld=Ca.AsyncSubject=function(a){function c(a){return Ob(this),this.isStopped?(this.hasError?a.onError(this.error):this.hasValue?(a.onNext(this.value),a.onCompleted()):a.onCompleted(),Mb):(this.observers.push(a),new wd(this,a))}function d(){a.call(this,c),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return Cb(d,a),Db(d.prototype,ic,{hasObservers:function(){return Ob(this),this.observers.length>0},onCompleted:function(){var a,c;if(Ob(this),!this.isStopped){this.isStopped=!0;var d=b(this.observers),c=d.length;if(this.hasValue)for(a=0;c>a;a++){var e=d[a];e.onNext(this.value),e.onCompleted()}else for(a=0;c>a;a++)d[a].onCompleted();this.observers.length=0}},onError:function(a){if(Ob(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=a;for(var c=0,d=b(this.observers),e=d.length;e>c;c++)d[c].onError(a);this.observers.length=0}},onNext:function(a){Ob(this),this.isStopped||(this.value=a,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.exception=null,this.value=null}}),d}(qc),Md=Ca.AnonymousSubject=function(a){function b(a){return this.observable.subscribe(a)}function c(c,d){this.observer=c,this.observable=d,a.call(this,b)}return Cb(c,a),Db(c.prototype,ic.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(a){this.observer.onError(a)},onNext:function(a){this.observer.onNext(a)}}),c}(qc);Ca.Pauser=function(a){function b(){a.call(this)}return Cb(b,a),b.prototype.pause=function(){this.onNext(!1)},b.prototype.resume=function(){this.onNext(!0)},b}(Kd),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(xa.Rx=Ca,define(function(){return Ca})):ya&&za?Aa?(za.exports=Ca).Rx=Ca:ya.Rx=Ca:xa.Rx=Ca;var Nd=g()}).call(this);

;
;
/*! rx.dom.min.js */ 
;
;
/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx","exports"],function(b,d){return c.Rx=a(c,d,b),c.Rx}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(a,b,c,d){if(a.addEventListener)return a.addEventListener(b,c,d),n(function(){a.removeEventListener(b,c,d)});throw new Error("No listener found")}function f(a,b,c,d){var g=new o,h=Object.prototype.toString;if("[object NodeList]"===h.call(a)||"[object HTMLCollection]"===h.call(a))for(var i=0,j=a.length;j>i;i++)g.add(f(a.item(i),b,c,d));else a&&g.add(e(a,b,c,d));return g}function g(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;var b;try{for(var c=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=0;3>d;d++)try{if(b=c[d],new a.ActiveXObject(b))break}catch(e){}return new a.ActiveXObject(b)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}function h(){var b=new a.XMLHttpRequest;if("withCredentials"in b)return b;if(a.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}function i(a,b,c){var d="response"in b?b.response:b.responseText;return d="json"===c.responseType?JSON.parse(d):d,{response:d,status:b.status,responseType:b.responseType,xhr:b,originalEvent:a}}function j(a,b,c){return{type:c,status:b.status,xhr:b,originalEvent:a}}var k=c.Observable,l=(k.prototype,c.AnonymousObservable),m=c.Observer.create,n=c.Disposable.create,o=c.CompositeDisposable,p=c.SingleAssignmentDisposable,q=c.AsyncSubject,r=c.Subject,s=c.Scheduler,t=function(){return Date.now?Date.now:function(){return+new Date}}(),u=c.DOM={},v={}.hasOwnProperty,w=(c.helpers.noop,c.helpers.isFunction),x=u.fromEvent=function(a,b,c,d){var e=w(c)?c:null;return"boolean"==typeof c&&(d=c),"undefined"==typeof d&&(d=!1),new l(function(c){return f(a,b,function(){var a=arguments[0];if(e){var a=tryCatch(e).apply(null,arguments);if(a===errorObj)return c.onError(a.e)}c.onNext(a)},d)}).publish().refCount()};!function(){var b="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu";a.PointerEvent&&(b+=" pointerdown pointerup pointermove pointerover pointerout pointerenter pointerleave"),a.TouchEvent&&(b+=" touchstart touchend touchmove touchcancel"),b=b.split(" ");for(var c=0,d=b.length;d>c;c++)!function(a){u[a]=function(b,c,d){return x(b,a,c,d)}}(b[c])}(),u.ready=function(){return new l(function(b){function c(){b.onNext(),b.onCompleted()}var d=!1;return"complete"===document.readyState?setTimeout(c,0):(d=!0,document.addEventListener("DOMContentLoaded",c,!1),a.addEventListener("load",c,!1)),function(){d&&(document.removeEventListener("DOMContentLoaded",c,!1),a.removeEventListener("load",c,!1))}})};var y=u.ajax=function(b){var c={method:"GET",crossDomain:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,headers:{},responseType:"text"};if("string"==typeof b)c.url=b;else for(var e in b)v.call(b,e)&&(c[e]=b[e]);return c.crossDomain||c.headers["X-Requested-With"]||(c.headers["X-Requested-With"]="XMLHttpRequest"),c.hasContent=c.body!==d,new l(function(b){var d=!1;try{var e=c.crossDomain?h():g()}catch(f){b.onError(f)}try{c.user?e.open(c.method,c.url,c.async,c.user,c.password):e.open(c.method,c.url,c.async);var k=c.headers;for(var l in k)v.call(k,l)&&e.setRequestHeader(l,k[l]);e.upload||!("withCredentials"in e)&&a.XDomainRequest?(e.onload=function(a){c.progressObserver&&(c.progressObserver.onNext(a),c.progressObserver.onCompleted()),b.onNext(i(a,e,c)),b.onCompleted(),d=!0},c.progressObserver&&(e.onprogress=function(a){c.progressObserver.onNext(a)}),e.onerror=function(a){c.progressObserver&&c.progressObserver.onError(a),b.onError(j(a,e,"error")),d=!0},e.onabort=function(a){c.progressObserver&&c.progressObserver.onError(a),b.onError(j(a,e,"abort")),d=!0}):e.onreadystatechange=function(a){if(4===e.readyState){var f=1223==e.status?204:e.status;f>=200&&300>=f||0===f||""===f?(b.onNext(i(a,e,c)),b.onCompleted()):b.onError(j(a,e,"error")),d=!0}},e.send(c.hasContent&&c.body||null)}catch(m){b.onError(m)}return function(){d||4===e.readyState||e.abort()}})};u.post=function(a,b){return y({url:a,body:b,method:"POST"})};u.get=function(a){return y({url:a})};u.getJSON=function(b){if(!a.JSON&&"function"!=typeof a.JSON.parse)throw new TypeError("JSON is not supported in your runtime.");return y({url:b,responseType:"json"}).map(function(a){return a.response})};var z=function(){var a=document.createElement("div");return function(b){a.appendChild(b),a.innerHTML=""}}();u.jsonpRequest=function(){var b=0;return function(c){return new l(function(d){var e="callback_"+(b++).toString(36),f={jsonp:"JSONPCallback",async:!0,jsonpCallback:"rxjsjsonpCallbacks"+e};if("string"==typeof c)f.url=c;else for(var g in c)v.call(c,g)&&(f[g]=c[g]);var h=document.createElement("script");h.type="text/javascript",h.async=f.async,h.src=f.url.replace(f.jsonp,f.jsonpCallback),a[f.jsonpCallback]=function(b){a[f.jsonpCallback].called=!0,a[f.jsonpCallback].data=b};var i=function(b){"load"!==b.type||a[f.jsonpCallback].called||(b={type:"error"});var c="error"===b.type?400:200,e=a[f.jsonpCallback].data;200===c?(d.onNext({status:c,responseType:"jsonp",response:e,originalEvent:b}),d.onCompleted()):d.onError({type:"error",status:c,originalEvent:b})};h.onload=h.onreadystatechanged=h.onerror=i;var j=document.getElementsByTagName("head")[0]||document.documentElement;return j.insertBefore(h,j.firstChild),function(){h.onload=h.onreadystatechanged=h.onerror=null,z(h),h=null}})}}(),u.fromWebSocket=function(a,b,c,d){function e(a,b){f&&(d&&(d.onNext(),d.onCompleted()),a?f.close(a,b):f.close())}if(!WebSocket)throw new TypeError("WebSocket not implemented in your runtime.");var f,g=new l(function(d){function g(a){c.onNext(a),c.onCompleted(),f.removeEventListener("open",g,!1)}function h(a){d.onNext(a)}function i(a){d.onError(a)}function j(a){return 1e3===a.code&&a.wasClean?void d.onCompleted():d.onError(a)}return f=b?new WebSocket(a,b):new WebSocket(a),c&&f.addEventListener("open",g,!1),f.addEventListener("message",h,!1),f.addEventListener("error",i,!1),f.addEventListener("close",j,!1),function(){e(),f.removeEventListener("message",h,!1),f.removeEventListener("error",i,!1),f.removeEventListener("close",j,!1)}}),h=m(function(a){f&&f.readyState===WebSocket.OPEN&&f.send(a)},function(a){if(!a.code)throw new Error('no code specified. be sure to pass { code: ###, reason: "" } to onError()');e(a.code,a.reason||"")},function(){e(1e3,"")});return r.create(h,g)},u.fromWebWorker=function(b){if(!a.Worker)throw new TypeError("Worker not implemented in your runtime.");var c=new a.Worker(b),d=new l(function(a){function b(b){a.onNext(b)}function d(b){a.onError(b)}return c.addEventListener("message",b,!1),c.addEventListener("error",d,!1),function(){c.close(),c.removeEventListener("message",b,!1),c.removeEventListener("error",d,!1)}}),e=m(function(a){c.postMessage(a)});return r.create(e,d)},u.fromEventSource=function(b,c){if(!a.EventSource)throw new TypeError("EventSource not implemented in your runtime.");return new l(function(d){function e(a){c.onNext(a),c.onCompleted(),h.removeEventListener("open",e,!1)}function f(a){a.readyState===EventSource.CLOSED?d.onCompleted():d.onError(a)}function g(a){d.onNext(a)}var h=new a.EventSource(b);return c&&h.addEventListener("open",e,!1),h.addEventListener("error",f,!1),h.addEventListener("message",g,!1),function(){h.removeEventListener("error",f,!1),h.removeEventListener("message",g,!1),h.close()}})},u.fromMutationObserver=function(b,c){var d=a.MutationObserver||a.WebKitMutationObserver;if(!d)throw new TypeError("MutationObserver not implemented in your runtime.");return observableCreate(function(a){var e=new d(a.onNext.bind(a));return e.observe(b,c),e.disconnect.bind(e)})};var A,B;return a.requestAnimationFrame?(A=a.requestAnimationFrame,B=a.cancelAnimationFrame):a.mozRequestAnimationFrame?(A=a.mozRequestAnimationFrame,B=a.mozCancelAnimationFrame):a.webkitRequestAnimationFrame?(A=a.webkitRequestAnimationFrame,B=a.webkitCancelAnimationFrame):a.msRequestAnimationFrame?(A=a.msRequestAnimationFrame,B=a.msCancelAnimationFrame):a.oRequestAnimationFrame?(A=a.oRequestAnimationFrame,B=a.oCancelAnimationFrame):(A=function(b){a.setTimeout(b,1e3/60)},B=a.clearTimeout),s.requestAnimationFrame=function(){function b(a,b){var c=this,d=new p,e=A(function(){!d.isDisposed&&d.setDisposable(b(c,a))});return new o(d,n(function(){B(e)}))}function c(b,c,d){var e=this,f=s.normalize(c);if(0===f)return e.scheduleWithState(b,d);var g=new p,h=a.setTimeout(function(){g.isDisposed||g.setDisposable(d(e,b))},f);return new o(g,n(function(){a.clearTimeout(h)}))}function d(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}return new s(t,b,c,d)}(),s.microtask=function(){function b(a){delete k[a]}function c(d){if(l)a.setTimeout(function(){c(d)},0);else{var e=k[d];if(e){l=!0;try{e()}catch(f){throw f}finally{b(d),l=!1}}}}function d(){if(!a.postMessage||a.importScripts)return!1;var b=!1,c=a.onmessage;return a.onmessage=function(){b=!0},a.postMessage("","*"),a.onmessage=c,b}function e(a){"string"==typeof a.data&&a.data.substring(0,v.length)===v&&c(a.data.substring(v.length))}function f(a,c){var d=this,e=new p,f=i(function(){!e.isDisposed&&e.setDisposable(c(d,a))});return new o(e,n(function(){b(f)}))}function g(b,c,d){var e=this,f=s.normalize(c);if(0===f)return e.scheduleWithState(b,d);var g=new p,h=a.setTimeout(function(){g.isDisposed||g.setDisposable(d(e,b))},f);return new o(g,n(function(){a.clearTimeout(h)}))}function h(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}var i,j=1,k={},l=!1,m=a.MutationObserver||a.WebKitMutationObserver;if(m){var q="drainqueue_",r=new m(function(a){a.forEach(function(a){c(a.attributeName.substring(q.length))})}),u=document.createElement("div");r.observe(u,{attributes:!0}),a.addEventListener("unload",function(){r.disconnect(),r=null},!1),i=function(a){var b=j++;return k[b]=a,u.setAttribute(q+b,"drainQueue"),b}}else if("function"==typeof a.setImmediate)i=function(b){var d=j++;return k[d]=b,a.setImmediate(function(){c(d)}),d};else if(d()){var v="ms.rx.schedule"+Math.random();a.addEventListener?a.addEventListener("message",e,!1):a.attachEvent&&a.attachEvent("onmessage",e),i=function(b){var c=j++;return k[currentId]=b,a.postMessage(v+currentId,"*"),c}}else if(a.MessageChannel){var w=new a.MessageChannel;w.port1.onmessage=function(a){c(a.data)},i=function(a){var b=j++;return k[b]=a,w.port2.postMessage(b),b}}else i="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(b){var d=a.document.createElement("script"),e=j++;return k[e]=b,d.onreadystatechange=function(){c(e),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},a.document.documentElement.appendChild(d),e}:function(b){var d=j++;return k[d]=b,a.setTimeout(function(){c(d)},0),d};return new s(t,f,g,h)}(),c.DOM.geolocation={getCurrentPosition:function(b){if(!a.navigator&&!a.navigation.geolocation)throw new TypeError("geolocation not available");return new l(function(c){a.navigator.geolocation.getCurrentPosition(function(a){c.onNext(a),c.onCompleted()},c.onError.bind(c),b)})},watchPosition:function(b){if(!a.navigator&&!a.navigation.geolocation)throw new TypeError("geolocation not available");return new l(function(c){var d=a.navigator.geolocation.watchPosition(c.onNext.bind(c),c.onError.bind(c),b);return function(){a.navigator.geolocation.clearWatch(d)}}).publish().refCount()}},u.fromReader=function(b,c){function d(b,d,e){return new l(function(f){function g(a){c&&c.onCompleted(),k.onNext(a.target.result),k.onCompleted()}function h(a){k.onError(a.target.error)}function i(a){c.onNext(a)}var j=new a.FileReader,k=new q;return j.addEventListener("load",g,!1),j.addEventListener("error",h,!1),c&&j.addEventListener("progress",i,!1),j[b](d,e),new o(k.subscribe(f),n(function(){j.readyState==a.FileReader.LOADING&&j.abort(),j.removeEventListener("load",g,!1),j.removeEventListener("error",h,!1),c&&j.removeEventListener("progress",i,!1)}))})}if(!a.FileReader)throw new TypeError("FileReader not implemented in your runtime.");return{asArrayBuffer:function(){return d("readAsArrayBuffer",b)},asBinaryString:function(){return d("readAsBinaryString",b)},asDataURL:function(){return d("readAsDataURL",b)},asText:function(a){return d("readAsText",b,a)}}},c});

;
;
/*! react-compiled.js */ 
;
;
!function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){!function(e,i){"function"==typeof define&&define.amd?define([],function(){return e.Autolinker=i()}):"object"==typeof n?t.exports=i():e.Autolinker=i()}(this,function(){var e=function(t){e.Util.assign(this,t);var n=this.hashtag;if(n!==!1&&"twitter"!==n&&"facebook"!==n)throw new Error("invalid `hashtag` cfg - see docs")};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,phone:!0,hashtag:!1,newWindow:!0,stripPrefix:!0,truncate:void 0,className:"",htmlParser:void 0,matchParser:void 0,tagBuilder:void 0,link:function(e){if(!e)return"";for(var t=this.getHtmlParser(),n=t.parse(e),i=0,o=[],r=0,a=n.length;a>r;r++){var s=n[r],c=s.getType(),l=s.getText();if("element"===c)"a"===s.getTagName()&&(s.isClosing()?i=Math.max(i-1,0):i++),o.push(l);else if("entity"===c||"comment"===c)o.push(l);else if(0===i){var u=this.linkifyStr(l);o.push(u)}else o.push(l)}return o.join("")},linkifyStr:function(e){return this.getMatchParser().replace(e,this.createMatchReturnVal,this)},createMatchReturnVal:function(t){var n;if(this.replaceFn&&(n=this.replaceFn.call(this,this,t)),"string"==typeof n)return n;if(n===!1)return t.getMatchedText();if(n instanceof e.HtmlTag)return n.toAnchorString();var i=this.getTagBuilder(),o=i.build(t);return o.toAnchorString()},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.htmlParser.HtmlParser),t},getMatchParser:function(){var t=this.matchParser;return t||(t=this.matchParser=new e.matchParser.MatchParser({urls:this.urls,email:this.email,twitter:this.twitter,phone:this.phone,hashtag:this.hashtag,stripPrefix:this.stripPrefix})),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t}},e.link=function(t,n){var i=new e(n);return i.link(t)},e.match={},e.htmlParser={},e.matchParser={},e.Util={abstractMethod:function(){throw"abstract"},trimRegex:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,assign:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},extend:function(t,n){var i=t.prototype,o=function(){};o.prototype=i;var r;r=n.hasOwnProperty("constructor")?n.constructor:function(){i.constructor.apply(this,arguments)};var a=r.prototype=new o;return a.constructor=r,a.superclass=i,delete n.constructor,e.Util.assign(a,n),r},ellipsis:function(e,t,n){return e.length>t&&(n=null==n?"..":n,e=e.substring(0,t-n.length)+n),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var n,i=[],o=0;n=t.exec(e);)i.push(e.substring(o,n.index)),i.push(n[0]),o=n.index+n[0].length;return i.push(e.substring(o)),i},trim:function(e){return e.replace(this.trimRegex,"")}},e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var n=this.getAttrs();return n[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var n=this.getAttrs();return e.Util.assign(n,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){for(var n,i=this.getClass(),o=this.whitespaceRegex,r=e.Util.indexOf,a=i?i.split(o):[],s=t.split(o);n=s.shift();)-1===r(a,n)&&a.push(n);return this.getAttrs()["class"]=a.join(" "),this},removeClass:function(t){for(var n,i=this.getClass(),o=this.whitespaceRegex,r=e.Util.indexOf,a=i?i.split(o):[],s=t.split(o);a.length&&(n=s.shift());){var c=r(a,n);-1!==c&&a.splice(c,1)}return this.getAttrs()["class"]=a.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return-1!==(" "+this.getClass()+" ").indexOf(" "+e+" ")},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toAnchorString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n]+'"');return t.join(" ")}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var n=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return n},createAttrs:function(e,t){var n={href:t},i=this.createCssClass(e);return i&&(n["class"]=i),this.newWindow&&(n.target="_blank"),n},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e)},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.htmlParser.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/!--([\s\S]+?)--/,t=/[0-9a-zA-Z][0-9a-zA-Z:]*/,n=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,i=/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/,o=n.source+"(?:\\s*=\\s*"+i.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",o,"|",i.source+")",")*",">",")","|","(?:","<(/)?","(?:",e.source,"|","(?:","("+t.source+")","(?:","\\s+",o,")*","\\s*/?",")",")",">",")"].join(""),"gi")}(),htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,parse:function(e){for(var t,n,i=this.htmlRegex,o=0,r=[];null!==(t=i.exec(e));){var a=t[0],s=t[3],c=t[1]||t[4],l=!!t[2],u=e.substring(o,t.index);u&&(n=this.parseTextAndEntityNodes(u),r.push.apply(r,n)),r.push(s?this.createCommentNode(a,s):this.createElementNode(a,c,l)),o=t.index+a.length}if(o<e.length){var h=e.substring(o);h&&(n=this.parseTextAndEntityNodes(h),r.push.apply(r,n))}return r},parseTextAndEntityNodes:function(t){for(var n=[],i=e.Util.splitAndCapture(t,this.htmlCharacterEntitiesRegex),o=0,r=i.length;r>o;o+=2){var a=i[o],s=i[o+1];a&&n.push(this.createTextNode(a)),s&&n.push(this.createEntityNode(s))}return n},createCommentNode:function(t,n){return new e.htmlParser.CommentNode({text:t,comment:e.Util.trim(n)})},createElementNode:function(t,n,i){return new e.htmlParser.ElementNode({text:t,tagName:n.toLowerCase(),closing:i})},createEntityNode:function(t){return new e.htmlParser.EntityNode({text:t})},createTextNode:function(t){return new e.htmlParser.TextNode({text:t})}}),e.htmlParser.HtmlNode=e.Util.extend(Object,{text:"",constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getText:function(){return this.text}}),e.htmlParser.CommentNode=e.Util.extend(e.htmlParser.HtmlNode,{comment:"",getType:function(){return"comment"},getComment:function(){return this.comment}}),e.htmlParser.ElementNode=e.Util.extend(e.htmlParser.HtmlNode,{tagName:"",closing:!1,getType:function(){return"element"},getTagName:function(){return this.tagName},isClosing:function(){return this.closing}}),e.htmlParser.EntityNode=e.Util.extend(e.htmlParser.HtmlNode,{getType:function(){return"entity"}}),e.htmlParser.TextNode=e.Util.extend(e.htmlParser.HtmlNode,{getType:function(){return"text"}}),e.matchParser.MatchParser=e.Util.extend(Object,{urls:!0,email:!0,twitter:!0,phone:!0,hashtag:!1,stripPrefix:!0,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(^|[^\w])#(\w{1,139})/,n=/(?:[\-;:&=\+\$,\w\.]+@)/,i=/(?:\+?\d{1,3}[-\s.])?\(?\d{3}\)?[-\s.]?\d{3}[-\s.]\d{4}/,o=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,r=/(?:www\.)/,a=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,s=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,c=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",e.source,")","|","(",n.source,a.source,s.source,")","|","(","(?:","(",o.source,a.source,")","|","(?:","(.?//)?",r.source,a.source,")","|","(?:","(.?//)?",a.source,s.source,")",")","(?:"+c.source+")?",")","|","(",i.source,")","|","(",t.source,")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,constructor:function(t){e.Util.assign(this,t),this.matchValidator=new e.MatchValidator},replace:function(e,t,n){var i=this;return e.replace(this.matcherRegex,function(e,o,r,a,s,c,l,u,h,d,p,m,f){var g=i.processCandidateMatch(e,o,r,a,s,c,l,u,h,d,p,m,f);if(g){var v=t.call(n,g.match);return g.prefixStr+v+g.suffixStr}return e})},processCandidateMatch:function(t,n,i,o,r,a,s,c,l,u,h,d,p){var m,f=c||l,g="",v="";if(a&&!this.urls||r&&!this.email||u&&!this.phone||n&&!this.twitter||h&&!this.hashtag||!this.matchValidator.isValidMatch(a,s,f))return null;if(this.matchHasUnbalancedClosingParen(t))t=t.substr(0,t.length-1),v=")";else{var y=this.matchHasInvalidCharAfterTld(a,s);y>-1&&(v=t.substr(y),t=t.substr(0,y))}if(r)m=new e.match.Email({matchedText:t,email:r});else if(n)i&&(g=i,t=t.slice(1)),m=new e.match.Twitter({matchedText:t,twitterHandle:o});else if(u){var _=t.replace(/\D/g,"");m=new e.match.Phone({matchedText:t,number:_})}else if(h)d&&(g=d,t=t.slice(1)),m=new e.match.Hashtag({matchedText:t,serviceName:this.hashtag,hashtag:p});else{if(f){var E=f.match(this.charBeforeProtocolRelMatchRegex)[1]||"";E&&(g=E,t=t.slice(1))}m=new e.match.Url({matchedText:t,url:t,protocolUrlMatch:!!s,protocolRelativeMatch:!!f,stripPrefix:this.stripPrefix})}return{prefixStr:g,suffixStr:v,match:m}},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(")"===t){var n=e.match(/\(/g),i=e.match(/\)/g),o=n&&n.length||0,r=i&&i.length||0;if(r>o)return!0}return!1},matchHasInvalidCharAfterTld:function(e,t){if(!e)return-1;var n=0;t&&(n=e.indexOf(":"),e=e.slice(n));var i=/^((.?\/\/)?[A-Za-z0-9\.\-]*[A-Za-z0-9\-]\.[A-Za-z]+)/,o=i.exec(e);return null===o?-1:(n+=o[1].length,e=e.slice(o[1].length),/^[^.A-Za-z:\/?#]/.test(e)?n:-1)}}),e.MatchValidator=e.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(e,t,n){return t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)||this.isInvalidProtocolRelativeMatch(n)?!1:!0},isValidUriScheme:function(e){var t=e.match(this.uriSchemeRegex)[0].toLowerCase();return"javascript:"!==t&&"vbscript:"!==t},urlMatchDoesNotHaveProtocolOrDot:function(e,t){return!(!e||t&&this.hasFullProtocolRegex.test(t)||-1!==e.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(e,t){return e&&t?!this.hasWordCharAfterProtocolRegex.test(e):!1},isInvalidProtocolRelativeMatch:function(e){return!!e&&this.invalidProtocolRelMatchRegex.test(e)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Hashtag=e.Util.extend(e.match.Match,{getType:function(){return"hashtag"},getHashtag:function(){return this.hashtag},getAnchorHref:function(){var e=this.serviceName,t=this.hashtag;switch(e){case"twitter":return"https://twitter.com/hashtag/"+t;case"facebook":return"https://www.facebook.com/hashtag/"+t;default:throw new Error("Unknown service name to point hashtag to: ",e)}},getAnchorText:function(){return"#"+this.hashtag}}),e.match.Phone=e.Util.extend(e.match.Match,{getType:function(){return"phone"},getNumber:function(){return this.number},getAnchorHref:function(){return"tel:"+this.number},getAnchorText:function(){return this.matchedText}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&amp;/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}}),e})},{}],2:[function(e,t,n){t.exports=e("./lib/classie")},{"./lib/classie":3}],3:[function(e,t,n){"use strict";function i(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function o(e,t){var n=r(e,t)?s:a;n(e,t)}var r,a,s;"object"==typeof document&&"classList"in document.documentElement?(r=function(e,t){return e.classList.contains(t)},a=function(e,t){e.classList.add(t)},s=function(e,t){e.classList.remove(t)}):(r=function(e,t){return i(t).test(e.className)},a=function(e,t){r(e,t)||(e.className=e.className+" "+t)},s=function(e,t){e.className=e.className.replace(i(t)," ")});var c={hasClass:r,addClass:a,removeClass:s,toggleClass:o,has:r,add:a,remove:s,toggle:o};"object"==typeof t&&t&&"object"==typeof t.exports?t.exports=c:define(c),"object"==typeof window&&"object"==typeof window.document&&(window.classie=c)},{}],4:[function(e,t,n){!function(){"use strict";function e(){for(var t="",n=0;n<arguments.length;n++){var i=arguments[n];if(i){var o=typeof i;if("string"===o||"number"===o)t+=" "+i;else if(Array.isArray(i))t+=" "+e.apply(null,i);else if("object"===o)for(var r in i)i.hasOwnProperty(r)&&i[r]&&(t+=" "+r)}}return t.substr(1)}"undefined"!=typeof t&&t.exports?t.exports=e:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):window.classNames=e}()},{}],5:[function(e,t,n){function i(e){return e?o(e):void 0}function o(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i,o=0;o<n.length;o++)if(i=n[o],i===t||i.fn===t){n.splice(o,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var i=0,o=n.length;o>i;++i)n[i].apply(this,t)}return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],6:[function(e,t,n){!function(e){"use strict";var n="undefined"==typeof window?null:window;"function"==typeof define&&define.amd?define(function(){return e(n)}):"undefined"!=typeof t?t.exports=e(n):n.DOMPurify=e(n)}(function i(e){"use strict";var t=function(e){return i(e)};if(t.version="0.6.6",!e||!e.document||9!==e.document.nodeType)return t.isSupported=!1,t;var n=e.document,o=n,r=e.DocumentFragment,a=e.HTMLTemplateElement,s=e.NodeFilter,c=e.NamedNodeMap||e.MozNamedAttrMap,l=e.Text,u=e.Comment;"function"==typeof a&&(n=n.createElement("template").content.ownerDocument);var h=n.implementation,d=n.createNodeIterator,p=n.getElementsByTagName,m=n.createDocumentFragment,f=o.importNode,g={};t.isSupported="undefined"!=typeof h.createHTMLDocument&&9!==n.documentMode;var v=function(e,t){for(var n=t.length;n--;)e[t[n]]=!0;return e},y=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},_=null,E=v({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),b=null,T=v({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","azimuth","baseline-shift","bias","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dy","dy","direction","display","divisor","dur","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","image-rendering","in","in2","k1","k2","k3","k4","kerning","letter-spacing","lighting-color","local","marker-end","marker-mid","marker-start","max","mask","mode","min","offset","operator","opacity","order","overflow","paint-order","path","points","r","rx","ry","radius","restart","scale","seed","shape-rendering","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","transform","text-anchor","text-decoration","text-rendering","u1","u2","viewbox","visibility","word-spacing","wrap","writing-mode","x","x1","x2","y","y1","y2","z","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space"]),S=null,w=null,C=!0,R=!1,A=!1,D=!1,I=!1,M=!1,x=!0,O=!0,k=v({},["audio","head","math","script","style","svg","video"]),N=null,L=n.createElement("form"),P=function(e){"object"!=typeof e&&(e={}),_="ALLOWED_TAGS"in e?v({},e.ALLOWED_TAGS):E,b="ALLOWED_ATTR"in e?v({},e.ALLOWED_ATTR):T,S="FORBID_TAGS"in e?v({},e.FORBID_TAGS):{},w="FORBID_ATTR"in e?v({},e.FORBID_ATTR):{},C=e.ALLOW_DATA_ATTR!==!1,R=e.SAFE_FOR_JQUERY||!1,A=e.WHOLE_DOCUMENT||!1,D=e.RETURN_DOM||!1,I=e.RETURN_DOM_FRAGMENT||!1,M=e.RETURN_DOM_IMPORT||!1,x=e.SANITIZE_DOM!==!1,O=e.KEEP_CONTENT!==!1,I&&(D=!0),e.ADD_TAGS&&(_===E&&(_=y(_)),v(_,e.ADD_TAGS)),e.ADD_ATTR&&(b===T&&(b=y(b)),v(b,e.ADD_ATTR)),O&&(_["#text"]=!0),Object&&"freeze"in Object&&Object.freeze(e),N=e},U=function(e){try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}},j=function(e){var t=h.createHTMLDocument(""),n=t.body;return n.parentNode.removeChild(n.parentNode.firstElementChild),n.outerHTML=e,p.call(t,A?"html":"body")[0]},B=function(e){return d.call(e.ownerDocument||e,e,s.SHOW_ELEMENT|s.SHOW_COMMENT|s.SHOW_TEXT,function(){return s.FILTER_ACCEPT},!1)},H=function(e){return e instanceof l||e instanceof u?!1:"string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof c&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute?!1:!0},z=function(e){if(Y("beforeSanitizeElements",e,null),H(e))return U(e),!0;var t=e.nodeName.toLowerCase();if(Y("uponSanitizeElement",e,{tagName:t}),!_[t]||S[t]){if(O&&!k[t]&&"function"==typeof e.insertAdjacentHTML)try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(n){}return U(e),!0}return R&&!e.firstElementChild&&(e.innerHTML=e.textContent.replace(/</g,"&lt;")),Y("afterSanitizeElements",e,null),!1},F=function(t){Y("beforeSanitizeAttributes",t,null);var i=t.attributes;if(i){for(var o,r,a,s,c,l={attrName:"",attrValue:"",keepAttr:!0},u=i.length;u--;)if(o=i[u],r=o.name,a=o.value,s=r.toLowerCase(),l.attrName=s,l.attrValue=a,l.keepAttr=!0,Y("uponSanitizeAttribute",t,l),a=l.attrValue,"name"===s&&"IMG"===t.nodeName&&i.id?(c=i.id,i=Array.prototype.slice.apply(i),t.removeAttribute("id"),t.removeAttribute(r),i.indexOf(c)>u&&t.setAttribute("id",c.value)):t.removeAttribute(r),l.keepAttr&&(!x||"id"!==s&&"name"!==s||!(a in e||a in n||a in L))&&(b[s]&&!w[s]||C&&V.test(s))&&(!W.test(a.replace(G,""))||"src"===s&&0===a.indexOf("data:")&&"IMG"===t.nodeName))try{t.setAttribute(r,a)}catch(h){}Y("afterSanitizeAttributes",t,null)}},V=/^data-[\w.\u00B7-\uFFFF-]/,W=/^(?:\w+script|data):/i,G=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,q=function(e){var t,n=B(e);for(Y("beforeSanitizeShadowDOM",e,null);t=n.nextNode();)Y("uponSanitizeShadowNode",t,null),z(t)||(t.content instanceof r&&q(t.content),F(t));Y("afterSanitizeShadowDOM",e,null)},Y=function(e,n,i){g[e]&&g[e].forEach(function(e){e.call(t,n,i,N)})};return t.sanitize=function(n,i){if(!t.isSupported)return"function"==typeof e.toStaticHTML&&"string"==typeof n?e.toStaticHTML(n):n;if(P(i),!D&&!A&&-1===n.indexOf("<"))return n;var a=j(n);if(!a)return D?null:"";for(var s,c,l=B(a);s=l.nextNode();)(3!==s.nodeType||s!==c)&&(z(s)||(s.content instanceof r&&q(s.content),F(s),c=s));var u;if(D){if(I)for(u=m.call(a.ownerDocument);a.firstChild;)u.appendChild(a.firstChild);else u=a;return M&&(u=f.call(o,u,!0)),u}return A?a.outerHTML:a.innerHTML},t.addHook=function(e,t){"function"==typeof t&&(g[e]=g[e]||[],g[e].push(t))},t.removeHook=function(e){g[e]&&g[e].pop()},t.removeHooks=function(e){g[e]&&(g[e]=[])},t.removeAllHooks=function(){g=[]},t})},{}],7:[function(e,t,n){function i(e){return e.replace(i.regex,"")}var o,r,a,s=e("gemoji");r=Object.keys(s.unicode),o="("+r.join("|")+")+",a=new RegExp(o,"g"),i.emoji=r,i.regex=new RegExp(o,"g"),t.exports=i},{gemoji:16}],8:[function(e,t,n){"use strict";function i(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),i=1;i<arguments.length;i++){var o=arguments[i];if(void 0!==o&&null!==o)for(var r=Object.keys(Object(o)),a=0,s=r.length;s>a;a++){var c=r[a],l=Object.getOwnPropertyDescriptor(o,c);void 0!==l&&l.enumerable&&(n[c]=o[c])}}return n}function o(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:i})}t.exports={assign:i,polyfill:o}},{}],9:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function r(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,r,c,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],s(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,r=new Array(i-1),c=1;i>c;c++)r[c-1]=arguments[c];n.apply(this,r)}else if(a(n)){for(i=arguments.length,r=new Array(i-1),c=1;i>c;c++)r[c-1]=arguments[c];for(l=n.slice(),i=l.length,c=0;i>c;c++)l[c].apply(this,r)}return!0},i.prototype.addListener=function(e,t){var n;if(!o(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var n;n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,r,s;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,i=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=r;s-->0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?o(e._events[t])?1:e._events[t].length:0}},{}],10:[function(e,t,n){t.exports.Dispatcher=e("./lib/Dispatcher")},{"./lib/Dispatcher":11}],11:[function(e,t,n){"use strict";function i(){this.$Dispatcher_callbacks={},this.$Dispatcher_isPending={},this.$Dispatcher_isHandled={},this.$Dispatcher_isDispatching=!1,this.$Dispatcher_pendingPayload=null}var o=e("./invariant"),r=1,a="ID_";i.prototype.register=function(e){var t=a+r++;return this.$Dispatcher_callbacks[t]=e,t},i.prototype.unregister=function(e){o(this.$Dispatcher_callbacks[e],"Dispatcher.unregister(...): `%s` does not map to a registered callback.",e),delete this.$Dispatcher_callbacks[e]},i.prototype.waitFor=function(e){o(this.$Dispatcher_isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var t=0;t<e.length;t++){var n=e[t];this.$Dispatcher_isPending[n]?o(this.$Dispatcher_isHandled[n],"Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",n):(o(this.$Dispatcher_callbacks[n],"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",n),this.$Dispatcher_invokeCallback(n))}},i.prototype.dispatch=function(e){o(!this.$Dispatcher_isDispatching,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch."),this.$Dispatcher_startDispatching(e);try{for(var t in this.$Dispatcher_callbacks)this.$Dispatcher_isPending[t]||this.$Dispatcher_invokeCallback(t)}finally{this.$Dispatcher_stopDispatching()}},i.prototype.isDispatching=function(){return this.$Dispatcher_isDispatching},i.prototype.$Dispatcher_invokeCallback=function(e){
this.$Dispatcher_isPending[e]=!0,this.$Dispatcher_callbacks[e](this.$Dispatcher_pendingPayload),this.$Dispatcher_isHandled[e]=!0},i.prototype.$Dispatcher_startDispatching=function(e){for(var t in this.$Dispatcher_callbacks)this.$Dispatcher_isPending[t]=!1,this.$Dispatcher_isHandled[t]=!1;this.$Dispatcher_pendingPayload=e,this.$Dispatcher_isDispatching=!0},i.prototype.$Dispatcher_stopDispatching=function(){this.$Dispatcher_pendingPayload=null,this.$Dispatcher_isDispatching=!1},t.exports=i},{"./invariant":12}],12:[function(e,t,n){"use strict";var i=function(e,t,n,i,o,r,a,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,i,o,r,a,s],u=0;c=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return l[u++]}))}throw c.framesToPop=1,c}};t.exports=i},{}],13:[function(e,t,n){!function(){function e(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function n(e){document.body?e():document.addEventListener?document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t),e()}):document.attachEvent("onreadystatechange",function n(){("interactive"==document.readyState||"complete"==document.readyState)&&(document.detachEvent("onreadystatechange",n),e())})}function i(e){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function o(e,t){e.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+t+";"}function r(e){var t=e.a.offsetWidth,n=t+100;return e.f.style.width=n+"px",e.c.scrollLeft=n,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t?(e.g=t,!0):!1}function a(t,n){function i(){var e=o;r(e)&&null!==e.a.parentNode&&n(e.g)}var o=t;e(t.b,i),e(t.c,i),r(t)}function s(e,t){var n=t||{};this.family=e,this.style=n.style||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"normal"}function c(){if(null===h){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(t){}h=""!==e.style.font}return h}function l(e,t){return[e.style,e.weight,c()?e.stretch:"","100px",t].join(" ")}var u=null,h=null,d=!!window.FontFace;s.prototype.load=function(e,t){var r=this,s=e||"BESbswy",c=t||3e3,h=(new Date).getTime();return new Promise(function(e,t){if(d){var p=new Promise(function(e,t){function n(){(new Date).getTime()-h>=c?t():document.fonts.load(l(r,r.family),s).then(function(t){1<=t.length?e():setTimeout(n,25)},function(){t()})}n()}),m=new Promise(function(e,t){setTimeout(t,c)});Promise.race([m,p]).then(function(){e(r)},function(){t(r)})}else n(function(){function n(){var t;(t=-1!=g&&-1!=v||-1!=g&&-1!=y||-1!=v&&-1!=y)&&((t=g!=v&&g!=y&&v!=y)||(null===u&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),u=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=u&&(g==_&&v==_&&y==_||g==E&&v==E&&y==E||g==b&&v==b&&y==b)),t=!t),t&&(null!==T.parentNode&&T.parentNode.removeChild(T),clearTimeout(S),e(r))}function d(){if((new Date).getTime()-h>=c)null!==T.parentNode&&T.parentNode.removeChild(T),t(r);else{var e=document.hidden;(!0===e||void 0===e)&&(g=p.a.offsetWidth,v=m.a.offsetWidth,y=f.a.offsetWidth,n()),S=setTimeout(d,50)}}var p=new i(s),m=new i(s),f=new i(s),g=-1,v=-1,y=-1,_=-1,E=-1,b=-1,T=document.createElement("div"),S=0;T.dir="ltr",o(p,l(r,"sans-serif")),o(m,l(r,"serif")),o(f,l(r,"monospace")),T.appendChild(p.a),T.appendChild(m.a),T.appendChild(f.a),document.body.appendChild(T),_=p.a.offsetWidth,E=m.a.offsetWidth,b=f.a.offsetWidth,d(),a(p,function(e){g=e,n()}),o(p,l(r,'"'+r.family+'",sans-serif')),a(m,function(e){v=e,n()}),o(m,l(r,'"'+r.family+'",serif')),a(f,function(e){y=e,n()}),o(f,l(r,'"'+r.family+'",monospace'))})})},window.FontFaceObserver=s,window.FontFaceObserver.prototype.check=window.FontFaceObserver.prototype.load=s.prototype.load,"undefined"!=typeof t&&(t.exports=window.FontFaceObserver)}()},{}],14:[function(e,t,n){!function(){"use strict";function e(e,t){e&&(this.el=e,this.container=t&&t.container,this.reRender=t&&t.reRender)}function i(t){t.style.display="none",e.r=t.offsetTop,t.style.display=""}function o(e,t){if(e)for(var n=t&&t.display,i=e.parentNode.children,o=m.call(i,e),r=o+1,a=i.length;a>r;r++)i[r].style.display=n}function r(e,t){var n=e.getClientRects(),i=0;return d(n,function(e){i+=a(e.height,t)}),i}function a(e,t){return Math.floor(e/t)}function s(){var e=document.createElement("test"),t={},n={Webkit:["WebkitColumnCount","WebkitColumnGap"],Moz:["MozColumnCount","MozColumnGap"],ms:["msColumnCount","msColumnGap"],"":["columnCount","columnGap"]};for(var i in n)n[i][0]in e.style&&(t.columnCount=n[i][0],t.columnGap=n[i][1],t[i.toLowerCase()]=!0);return t}function c(e){return parseInt(e[y.columnCount],10)||1}function l(e){return parseInt(e[y.columnGap],10)||0}function u(e,t){var n=t.lineHeight;if(n){if(n.indexOf("px")<0)throw Error("The ellipsis container "+p(e)+" must have line-height set using px unit, found: "+n);var i=parseInt(n,10);if(i)return i}throw Error("The ellipsis container "+p(e)+" must have line-height set on it, found: "+n)}function h(e){return[e.offsetWidth,e.offsetHeight]}function d(e,t){for(var n=0,i=e.length;i>n&&!t(e[n]);n++);}function p(e){var t=e.tagName;return e.id&&(t+="#"+e.id),e.className&&(t+=(" "+e.className).replace(/\s+/g,".")),t}var m=Array.prototype.indexOf,f=window.getComputedStyle,g="ellipsis-overflowing-child",v="ellipsis-set",y=s();e.prototype.calc=function(){if(!this.el)return this;var e=f(this.el),t=h(this.el);return this.columnHeight=t[1],this.columnCount=c(e),this.columnGap=l(e),this.columnWidth=t[0]/this.columnCount,this.lineHeight=u(this.el,e),this.deltaHeight=t[1]%this.lineHeight,this.linesPerColumn=Math.floor(this.columnHeight/this.lineHeight),this.totalLines=this.linesPerColumn*this.columnCount,!this.deltaHeight&&this.columnCount>1&&(this.el.style.height=this.columnHeight+"px"),this.child=this.getOverflowingChild(),this},e.prototype.set=function(){return this.el&&this.child?(this.clampChild(),o(this.child.el,{display:"none"}),this.markContainer(),this):this},e.prototype.unset=function(){return this.el&&this.child?(this.el.style.height="",this.unclampChild(this.child),o(this.child.el,{display:""}),this.unmarkContainer(),this.child=null,this):this},e.prototype.destroy=function(){return this.el=this.child=this.container=null,this},e.prototype.getOverflowingChild=function(){var e=this,t={},n=0;return d(this.el.children,function(i){var o,r,a,s=Math.floor(n/e.linesPerColumn)||0;return n+=o=e.getLineCount(i),n>=e.totalLines?(r=n-e.totalLines,a=o-r,t.el=i,t.clampedLines=a,t.clampedHeight=t.clampedLines*e.lineHeight,t.visibleColumnSpan=e.columnCount-s,t.gutterSpan=t.visibleColumnSpan-1,t.applyTopMargin=e.shouldApplyTopMargin(t),y.webkit&&t.clampedLines>1&&(t.clampedHeight+=t.gutterSpan*e.deltaHeight),t):void 0}),t},e.prototype.getLineCount=function(e){return e.offsetWidth>this.columnWidth?r(e,this.lineHeight):a(e.clientHeight,this.lineHeight)},e.prototype.markContainer=function(){this.container&&(this.container.classList.add(v),this.reRender&&i(this.container))},e.prototype.unmarkContainer=function(){this.container&&(this.container.classList.remove(v),this.reRender&&i(this.container))},e.prototype.shouldApplyTopMargin=function(e){var t=e.el;if(y.webkit&&1!==this.columnCount&&!(this.deltaHeight<=3)&&t.previousElementSibling)return 0===t.offsetTop||t.offsetTop===this.columnHeight},e.prototype.clampChild=function(){var e=this.child;e&&e.el&&(e.el.style.height=e.clampedHeight+"px",y.webkit&&(e.el.style.webkitLineClamp=e.clampedLines,e.el.style.display="-webkit-box",e.el.style.webkitBoxOrient="vertical"),this.shouldHideOverflow()&&(e.el.style.overflow="hidden"),e.applyTopMargin&&(e.el.style.marginTop="2em"),e.el.classList.add(g),y.webkit||(e.el.style.position="relative",e.helper=e.el.appendChild(this.helperElement())))},e.prototype.unclampChild=function(e){e&&e.el&&(e.el.style.display="",e.el.style.height="",e.el.style.webkitLineClamp="",e.el.style.webkitBoxOrient="",e.el.style.marginTop="",e.el.style.overflow="",e.el.classList.remove(g),e.helper&&e.helper.parentNode.removeChild(e.helper))},e.prototype.helperElement=function(){var e,t,n=document.createElement("span"),i=this.child.visibleColumnSpan-1;return n.className="ellipsis-helper",n.style.display="block",n.style.height=this.lineHeight+"px",n.style.width="5em",n.style.position="absolute",n.style.bottom=0,n.style.right=0,y.moz&&i&&(e=-(100*i),t=-(i*this.columnGap),n.style.right=e+"%",n.style.marginRight=t+"px",n.style.marginBottom=this.deltaHeight+"px"),n},e.prototype.shouldHideOverflow=function(){var e=this.columnCount>1;return this.columnHeight<this.lineHeight?!0:!e},"object"==typeof n?(t.exports=function(t,n){return new e(t,n)},t.exports.Ellipsis=e):"function"==typeof define&&define.amd?define(function(){return e}):window.Ellipsis=e}()},{}],15:[function(e,t,n){t.exports={100:"💯",1234:"🔢",smile:"😄",smiley:"😃",grinning:"😀",blush:"😊",relaxed:"☺️",wink:"😉",heart_eyes:"😍",kissing_heart:"😘",kissing_closed_eyes:"😚",kissing:"😗",kissing_smiling_eyes:"😙",stuck_out_tongue_winking_eye:"😜",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue:"😛",flushed:"😳",grin:"😁",pensive:"😔",relieved:"😌",unamused:"😒",disappointed:"😞",persevere:"😣",cry:"😢",joy:"😂",sob:"😭",sleepy:"😪",disappointed_relieved:"😥",cold_sweat:"😰",sweat_smile:"😅",sweat:"😓",weary:"😩",tired_face:"😫",fearful:"😨",scream:"😱",angry:"😠",rage:"😡",triumph:"😤",confounded:"😖",laughing:"😆",satisfied:"😆",yum:"😋",mask:"😷",sunglasses:"😎",sleeping:"😴",dizzy_face:"😵",astonished:"😲",worried:"😟",frowning:"😦",anguished:"😧",smiling_imp:"😈",imp:"👿",open_mouth:"😮",grimacing:"😬",neutral_face:"😐",confused:"😕",hushed:"😯",no_mouth:"😶",innocent:"😇",smirk:"😏",expressionless:"😑",man_with_gua_pi_mao:"👲",man_with_turban:"👳",cop:"👮",construction_worker:"👷",guardsman:"💂",baby:"👶",boy:"👦",girl:"👧",man:"👨",woman:"👩",older_man:"👴",older_woman:"👵",person_with_blond_hair:"👱",angel:"👼",princess:"👸",smiley_cat:"😺",smile_cat:"😸",heart_eyes_cat:"😻",kissing_cat:"😽",smirk_cat:"😼",scream_cat:"🙀",crying_cat_face:"😿",joy_cat:"😹",pouting_cat:"😾",japanese_ogre:"👹",japanese_goblin:"👺",see_no_evil:"🙈",hear_no_evil:"🙉",speak_no_evil:"🙊",skull:"💀",alien:"👽",hankey:"💩",poop:"💩",shit:"💩",fire:"🔥",sparkles:"✨",star2:"🌟",dizzy:"💫",boom:"💥",collision:"💥",anger:"💢",sweat_drops:"💦",droplet:"💧",zzz:"💤",dash:"💨",ear:"👂",eyes:"👀",nose:"👃",tongue:"👅",lips:"👄","+1":"👍",thumbsup:"👍","-1":"👎",thumbsdown:"👎",ok_hand:"👌",facepunch:"👊",punch:"👊",fist:"✊",v:"✌️",wave:"👋",hand:"✋",raised_hand:"✋",open_hands:"👐",point_up_2:"👆",point_down:"👇",point_right:"👉",point_left:"👈",raised_hands:"🙌",pray:"🙏",point_up:"☝️",clap:"👏",muscle:"💪",walking:"🚶",runner:"🏃",running:"🏃",dancer:"💃",couple:"👫",family:"👪",two_men_holding_hands:"👬",two_women_holding_hands:"👭",couplekiss:"💏",couple_with_heart:"💑",dancers:"👯",ok_woman:"🙆",no_good:"🙅",information_desk_person:"💁",raising_hand:"🙋",massage:"💆",haircut:"💇",nail_care:"💅",bride_with_veil:"👰",person_with_pouting_face:"🙎",person_frowning:"🙍",bow:"🙇",tophat:"🎩",crown:"👑",womans_hat:"👒",athletic_shoe:"👟",mans_shoe:"👞",shoe:"👞",sandal:"👡",high_heel:"👠",boot:"👢",shirt:"👕",tshirt:"👕",necktie:"👔",womans_clothes:"👚",dress:"👗",running_shirt_with_sash:"🎽",jeans:"👖",kimono:"👘",bikini:"👙",briefcase:"💼",handbag:"👜",pouch:"👝",purse:"👛",eyeglasses:"👓",ribbon:"🎀",closed_umbrella:"🌂",lipstick:"💄",yellow_heart:"💛",blue_heart:"💙",purple_heart:"💜",green_heart:"💚",heart:"❤️",broken_heart:"💔",heartpulse:"💗",heartbeat:"💓",two_hearts:"💕",sparkling_heart:"💖",revolving_hearts:"💞",cupid:"💘",love_letter:"💌",kiss:"💋",ring:"💍",gem:"💎",bust_in_silhouette:"👤",busts_in_silhouette:"👥",speech_balloon:"💬",footprints:"👣",thought_balloon:"💭",dog:"🐶",wolf:"🐺",cat:"🐱",mouse:"🐭",hamster:"🐹",rabbit:"🐰",frog:"🐸",tiger:"🐯",koala:"🐨",bear:"🐻",pig:"🐷",pig_nose:"🐽",cow:"🐮",boar:"🐗",monkey_face:"🐵",monkey:"🐒",horse:"🐴",sheep:"🐑",elephant:"🐘",panda_face:"🐼",penguin:"🐧",bird:"🐦",baby_chick:"🐤",hatched_chick:"🐥",hatching_chick:"🐣",chicken:"🐔",snake:"🐍",turtle:"🐢",bug:"🐛",bee:"🐝",honeybee:"🐝",ant:"🐜",beetle:"🐞",snail:"🐌",octopus:"🐙",shell:"🐚",tropical_fish:"🐠",fish:"🐟",dolphin:"🐬",flipper:"🐬",whale:"🐳",whale2:"🐋",cow2:"🐄",ram:"🐏",rat:"🐀",water_buffalo:"🐃",tiger2:"🐅",rabbit2:"🐇",dragon:"🐉",racehorse:"🐎",goat:"🐐",rooster:"🐓",dog2:"🐕",pig2:"🐖",mouse2:"🐁",ox:"🐂",dragon_face:"🐲",blowfish:"🐡",crocodile:"🐊",camel:"🐫",dromedary_camel:"🐪",leopard:"🐆",cat2:"🐈",poodle:"🐩",feet:"🐾",paw_prints:"🐾",bouquet:"💐",cherry_blossom:"🌸",tulip:"🌷",four_leaf_clover:"🍀",rose:"🌹",sunflower:"🌻",hibiscus:"🌺",maple_leaf:"🍁",leaves:"🍃",fallen_leaf:"🍂",herb:"🌿",ear_of_rice:"🌾",mushroom:"🍄",cactus:"🌵",palm_tree:"🌴",evergreen_tree:"🌲",deciduous_tree:"🌳",chestnut:"🌰",seedling:"🌱",blossom:"🌼",globe_with_meridians:"🌐",sun_with_face:"🌞",full_moon_with_face:"🌝",new_moon_with_face:"🌚",new_moon:"🌑",waxing_crescent_moon:"🌒",first_quarter_moon:"🌓",moon:"🌔",waxing_gibbous_moon:"🌔",full_moon:"🌕",waning_gibbous_moon:"🌖",last_quarter_moon:"🌗",waning_crescent_moon:"🌘",last_quarter_moon_with_face:"🌜",first_quarter_moon_with_face:"🌛",crescent_moon:"🌙",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",volcano:"🌋",milky_way:"🌌",stars:"🌠",star:"⭐",sunny:"☀️",partly_sunny:"⛅",cloud:"☁️",zap:"⚡",umbrella:"☔",snowflake:"❄️",snowman:"⛄",cyclone:"🌀",foggy:"🌁",rainbow:"🌈",ocean:"🌊",bamboo:"🎍",gift_heart:"💝",dolls:"🎎",school_satchel:"🎒",mortar_board:"🎓",flags:"🎏",fireworks:"🎆",sparkler:"🎇",wind_chime:"🎐",rice_scene:"🎑",jack_o_lantern:"🎃",ghost:"👻",santa:"🎅",christmas_tree:"🎄",gift:"🎁",tanabata_tree:"🎋",tada:"🎉",confetti_ball:"🎊",balloon:"🎈",crossed_flags:"🎌",crystal_ball:"🔮",movie_camera:"🎥",camera:"📷",video_camera:"📹",vhs:"📼",cd:"💿",dvd:"📀",minidisc:"💽",floppy_disk:"💾",computer:"💻",iphone:"📱",phone:"☎️",telephone:"☎️",telephone_receiver:"📞",pager:"📟",fax:"📠",satellite:"📡",tv:"📺",radio:"📻",loud_sound:"🔊",sound:"🔉",speaker:"🔈",mute:"🔇",bell:"🔔",no_bell:"🔕",loudspeaker:"📢",mega:"📣",hourglass_flowing_sand:"⏳",hourglass:"⌛",alarm_clock:"⏰",watch:"⌚",unlock:"🔓",lock:"🔒",lock_with_ink_pen:"🔏",closed_lock_with_key:"🔐",key:"🔑",mag_right:"🔎",bulb:"💡",flashlight:"🔦",high_brightness:"🔆",low_brightness:"🔅",electric_plug:"🔌",battery:"🔋",mag:"🔍",bathtub:"🛁",bath:"🛀",shower:"🚿",toilet:"🚽",wrench:"🔧",nut_and_bolt:"🔩",hammer:"🔨",door:"🚪",smoking:"🚬",bomb:"💣",gun:"🔫",hocho:"🔪",knife:"🔪",pill:"💊",syringe:"💉",moneybag:"💰",yen:"💴",dollar:"💵",pound:"💷",euro:"💶",credit_card:"💳",money_with_wings:"💸",calling:"📲","e-mail":"📧",inbox_tray:"📥",outbox_tray:"📤",email:"✉️",envelope:"✉️",envelope_with_arrow:"📩",incoming_envelope:"📨",postal_horn:"📯",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",postbox:"📮","package":"📦",memo:"📝",pencil:"📝",page_facing_up:"📄",page_with_curl:"📃",bookmark_tabs:"📑",bar_chart:"📊",chart_with_upwards_trend:"📈",chart_with_downwards_trend:"📉",scroll:"📜",clipboard:"📋",date:"📅",calendar:"📆",card_index:"📇",file_folder:"📁",open_file_folder:"📂",scissors:"✂️",pushpin:"📌",paperclip:"📎",black_nib:"✒️",pencil2:"✏️",straight_ruler:"📏",triangular_ruler:"📐",closed_book:"📕",green_book:"📗",blue_book:"📘",orange_book:"📙",notebook:"📓",notebook_with_decorative_cover:"📔",ledger:"📒",books:"📚",book:"📖",open_book:"📖",bookmark:"🔖",name_badge:"📛",microscope:"🔬",telescope:"🔭",newspaper:"📰",art:"🎨",clapper:"🎬",microphone:"🎤",headphones:"🎧",musical_score:"🎼",musical_note:"🎵",notes:"🎶",musical_keyboard:"🎹",violin:"🎻",trumpet:"🎺",saxophone:"🎷",guitar:"🎸",space_invader:"👾",video_game:"🎮",black_joker:"🃏",flower_playing_cards:"🎴",mahjong:"🀄",game_die:"🎲",dart:"🎯",football:"🏈",basketball:"🏀",soccer:"⚽",baseball:"⚾️",tennis:"🎾","8ball":"🎱",rugby_football:"🏉",bowling:"🎳",golf:"⛳",mountain_bicyclist:"🚵",bicyclist:"🚴",checkered_flag:"🏁",horse_racing:"🏇",trophy:"🏆",ski:"🎿",snowboarder:"🏂",swimmer:"🏊",surfer:"🏄",fishing_pole_and_fish:"🎣",coffee:"☕",tea:"🍵",sake:"🍶",baby_bottle:"🍼",beer:"🍺",beers:"🍻",cocktail:"🍸",tropical_drink:"🍹",wine_glass:"🍷",fork_and_knife:"🍴",pizza:"🍕",hamburger:"🍔",fries:"🍟",poultry_leg:"🍗",meat_on_bone:"🍖",spaghetti:"🍝",curry:"🍛",fried_shrimp:"🍤",bento:"🍱",sushi:"🍣",fish_cake:"🍥",rice_ball:"🍙",rice_cracker:"🍘",rice:"🍚",ramen:"🍜",stew:"🍲",oden:"🍢",dango:"🍡",egg:"🍳",bread:"🍞",doughnut:"🍩",custard:"🍮",icecream:"🍦",ice_cream:"🍨",shaved_ice:"🍧",birthday:"🎂",cake:"🍰",cookie:"🍪",chocolate_bar:"🍫",candy:"🍬",lollipop:"🍭",honey_pot:"🍯",apple:"🍎",green_apple:"🍏",tangerine:"🍊",lemon:"🍋",cherries:"🍒",grapes:"🍇",watermelon:"🍉",strawberry:"🍓",peach:"🍑",melon:"🍈",banana:"🍌",pear:"🍐",pineapple:"🍍",sweet_potato:"🍠",eggplant:"🍆",tomato:"🍅",corn:"🌽",house:"🏠",house_with_garden:"🏡",school:"🏫",office:"🏢",post_office:"🏣",hospital:"🏥",bank:"🏦",convenience_store:"🏪",love_hotel:"🏩",hotel:"🏨",wedding:"💒",church:"⛪",department_store:"🏬",european_post_office:"🏤",city_sunrise:"🌇",city_sunset:"🌆",japanese_castle:"🏯",european_castle:"🏰",tent:"⛺",factory:"🏭",tokyo_tower:"🗼",japan:"🗾",mount_fuji:"🗻",sunrise_over_mountains:"🌄",sunrise:"🌅",night_with_stars:"🌃",statue_of_liberty:"🗽",bridge_at_night:"🌉",carousel_horse:"🎠",ferris_wheel:"🎡",fountain:"⛲",roller_coaster:"🎢",ship:"🚢",boat:"⛵",sailboat:"⛵",speedboat:"🚤",rowboat:"🚣",anchor:"⚓",rocket:"🚀",airplane:"✈️",seat:"💺",helicopter:"🚁",steam_locomotive:"🚂",tram:"🚊",station:"🚉",mountain_railway:"🚞",train2:"🚆",bullettrain_side:"🚄",bullettrain_front:"🚅",light_rail:"🚈",metro:"🚇",monorail:"🚝",train:"🚋",railway_car:"🚃",trolleybus:"🚎",bus:"🚌",oncoming_bus:"🚍",blue_car:"🚙",oncoming_automobile:"🚘",car:"🚗",red_car:"🚗",taxi:"🚕",oncoming_taxi:"🚖",articulated_lorry:"🚛",truck:"🚚",rotating_light:"🚨",police_car:"🚓",oncoming_police_car:"🚔",fire_engine:"🚒",ambulance:"🚑",minibus:"🚐",bike:"🚲",aerial_tramway:"🚡",suspension_railway:"🚟",mountain_cableway:"🚠",tractor:"🚜",barber:"💈",busstop:"🚏",ticket:"🎫",vertical_traffic_light:"🚦",traffic_light:"🚥",warning:"⚠️",construction:"🚧",beginner:"🔰",fuelpump:"⛽",izakaya_lantern:"🏮",lantern:"🏮",slot_machine:"🎰",hotsprings:"♨️",moyai:"🗿",circus_tent:"🎪",performing_arts:"🎭",round_pushpin:"📍",triangular_flag_on_post:"🚩",jp:"🇯🇵",kr:"🇰🇷",de:"🇩🇪",cn:"🇨🇳",us:"🇺🇸",fr:"🇫🇷",es:"🇪🇸",it:"🇮🇹",ru:"🇷🇺",gb:"🇬🇧",uk:"🇬🇧",one:"1️⃣",two:"2️⃣",three:"3️⃣",four:"4️⃣",five:"5️⃣",six:"6️⃣",seven:"7️⃣",eight:"8️⃣",nine:"9️⃣",zero:"0️⃣",keycap_ten:"🔟",hash:"#️⃣",symbols:"🔣",arrow_up:"⬆️",arrow_down:"⬇️",arrow_left:"⬅️",arrow_right:"➡️",capital_abcd:"🔠",abcd:"🔡",abc:"🔤",arrow_upper_right:"↗️",arrow_upper_left:"↖️",arrow_lower_right:"↘️",arrow_lower_left:"↙️",left_right_arrow:"↔️",arrow_up_down:"↕️",arrows_counterclockwise:"🔄",arrow_backward:"◀️",arrow_forward:"▶️",arrow_up_small:"🔼",arrow_down_small:"🔽",leftwards_arrow_with_hook:"↩️",arrow_right_hook:"↪️",information_source:"ℹ️",rewind:"⏪",fast_forward:"⏩",arrow_double_up:"⏫",arrow_double_down:"⏬",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",ok:"🆗",twisted_rightwards_arrows:"🔀",repeat:"🔁",repeat_one:"🔂","new":"🆕",up:"🆙",cool:"🆒",free:"🆓",ng:"🆖",signal_strength:"📶",cinema:"🎦",koko:"🈁",u6307:"🈯",u7a7a:"🈳",u6e80:"🈵",u5408:"🈴",u7981:"🈲",ideograph_advantage:"🉐",u5272:"🈹",u55b6:"🈺",u6709:"🈶",u7121:"🈚",restroom:"🚻",mens:"🚹",womens:"🚺",baby_symbol:"🚼",wc:"🚾",potable_water:"🚰",put_litter_in_its_place:"🚮",parking:"🅿️",wheelchair:"♿",no_smoking:"🚭",u6708:"🈷️",u7533:"🈸",sa:"🈂️",m:"Ⓜ️",passport_control:"🛂",baggage_claim:"🛄",left_luggage:"🛅",customs:"🛃",accept:"🉑",secret:"㊙️",congratulations:"㊗️",cl:"🆑",sos:"🆘",id:"🆔",no_entry_sign:"🚫",underage:"🔞",no_mobile_phones:"📵",do_not_litter:"🚯","non-potable_water":"🚱",no_bicycles:"🚳",no_pedestrians:"🚷",children_crossing:"🚸",no_entry:"⛔",eight_spoked_asterisk:"✳️",sparkle:"❇️",negative_squared_cross_mark:"❎",white_check_mark:"✅",eight_pointed_black_star:"✴️",heart_decoration:"💟",vs:"🆚",vibration_mode:"📳",mobile_phone_off:"📴",a:"🅰️",b:"🅱️",ab:"🆎",o2:"🅾️",diamond_shape_with_a_dot_inside:"💠",loop:"➿",recycle:"♻️",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpius:"♏",sagittarius:"♐",capricorn:"♑",aquarius:"♒",pisces:"♓",ophiuchus:"⛎",six_pointed_star:"🔯",atm:"🏧",chart:"💹",heavy_dollar_sign:"💲",currency_exchange:"💱",copyright:"©️",registered:"®️",tm:"™️",x:"❌",bangbang:"‼️",interrobang:"⁉️",exclamation:"❗",heavy_exclamation_mark:"❗",question:"❓",grey_exclamation:"❕",grey_question:"❔",o:"⭕",top:"🔝",end:"🔚",back:"🔙",on:"🔛",soon:"🔜",arrows_clockwise:"🔃",clock12:"🕛",clock1230:"🕧",clock1:"🕐",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock7:"🕖",clock8:"🕗",clock9:"🕘",clock10:"🕙",clock11:"🕚",clock630:"🕡",clock730:"🕢",clock830:"🕣",clock930:"🕤",clock1030:"🕥",clock1130:"🕦",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",heavy_minus_sign:"➖",heavy_division_sign:"➗",spades:"♠️",hearts:"♥️",clubs:"♣️",diamonds:"♦️",white_flower:"💮",heavy_check_mark:"✔️",ballot_box_with_check:"☑️",radio_button:"🔘",link:"🔗",curly_loop:"➰",wavy_dash:"〰️",part_alternation_mark:"〽️",trident:"🔱",black_medium_square:"◼️",white_medium_square:"◻️",black_medium_small_square:"◾",white_medium_small_square:"◽",black_small_square:"▪️",white_small_square:"▫️",small_red_triangle:"🔺",black_square_button:"🔲",white_square_button:"🔳",black_circle:"⚫",white_circle:"⚪",red_circle:"🔴",large_blue_circle:"🔵",small_red_triangle_down:"🔻",white_large_square:"⬜",black_large_square:"⬛",large_orange_diamond:"🔶",large_blue_diamond:"🔷",small_orange_diamond:"🔸",small_blue_diamond:"🔹"}},{}],16:[function(e,t,n){"use strict";var i,o,r,a,s,c;i=e("./data/gemoji.json"),s=Object.prototype.hasOwnProperty,r={},o={};for(c in i)s.call(i,c)&&(a=i[c],o[c]=a,s.call(r,a)||(r[a]=c));n.unicode=r,n.name=o},{"./data/gemoji.json":15}],17:[function(e,t,n){!function(e,i){"object"==typeof n&&"undefined"!=typeof t?t.exports=i():"function"==typeof define&&define.amd?define(i):e.Immutable=i()}(this,function(){"use strict";function e(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function t(e){return e.value=!1,e}function n(e){e&&(e.value=!0)}function i(){}function o(e,t){t=t||0;for(var n=Math.max(0,e.length-t),i=new Array(n),o=0;n>o;o++)i[o]=e[o+t];return i}function r(e){return void 0===e.size&&(e.size=e.__iterate(s)),e.size}function a(e,t){return t>=0?+t:r(e)+ +t}function s(){return!0}function c(e,t,n){return(0===e||void 0!==n&&-n>=e)&&(void 0===t||void 0!==n&&t>=n)}function l(e,t){return h(e,t,0)}function u(e,t){return h(e,t,t)}function h(e,t,n){return void 0===e?n:0>e?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}function d(e){return g(e)?e:I(e)}function p(e){return v(e)?e:M(e)}function m(e){return y(e)?e:x(e)}function f(e){return g(e)&&!_(e)?e:O(e)}function g(e){return!(!e||!e[pn])}function v(e){return!(!e||!e[mn])}function y(e){return!(!e||!e[fn])}function _(e){return v(e)||y(e)}function E(e){return!(!e||!e[gn])}function b(e){this.next=e}function T(e,t,n,i){var o=0===e?t:1===e?n:[t,n];return i?i.value=o:i={value:o,done:!1},i}function S(){return{value:void 0,done:!0}}function w(e){return!!A(e)}function C(e){return e&&"function"==typeof e.next}function R(e){var t=A(e);return t&&t.call(e)}function A(e){var t=e&&(En&&e[En]||e[bn]);return"function"==typeof t?t:void 0}function D(e){return e&&"number"==typeof e.length}function I(e){return null===e||void 0===e?j():g(e)?e.toSeq():z(e)}function M(e){return null===e||void 0===e?j().toKeyedSeq():g(e)?v(e)?e.toSeq():e.fromEntrySeq():B(e)}function x(e){return null===e||void 0===e?j():g(e)?v(e)?e.entrySeq():e.toIndexedSeq():H(e)}function O(e){return(null===e||void 0===e?j():g(e)?v(e)?e.entrySeq():e:H(e)).toSetSeq()}function k(e){this._array=e,this.size=e.length}function N(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function L(e){this._iterable=e,this.size=e.length||e.size}function P(e){this._iterator=e,this._iteratorCache=[]}function U(e){return!(!e||!e[Sn])}function j(){return wn||(wn=new k([]))}function B(e){var t=Array.isArray(e)?new k(e).fromEntrySeq():C(e)?new P(e).fromEntrySeq():w(e)?new L(e).fromEntrySeq():"object"==typeof e?new N(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function H(e){var t=F(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function z(e){var t=F(e)||"object"==typeof e&&new N(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}function F(e){return D(e)?new k(e):C(e)?new P(e):w(e)?new L(e):void 0}function V(e,t,n,i){var o=e._cache;if(o){for(var r=o.length-1,a=0;r>=a;a++){var s=o[n?r-a:a];if(t(s[1],i?s[0]:a,e)===!1)return a+1}return a}return e.__iterateUncached(t,n)}function W(e,t,n,i){var o=e._cache;if(o){var r=o.length-1,a=0;return new b(function(){var e=o[n?r-a:a];return a++>r?S():T(t,i?e[0]:a-1,e[1])})}return e.__iteratorUncached(t,n)}function G(){throw TypeError("Abstract")}function q(){}function Y(){}function K(){}function $(e,t){return e===t||e!==e&&t!==t?!0:e&&t?("function"==typeof e.valueOf&&"function"==typeof t.valueOf&&(e=e.valueOf(),t=t.valueOf()),"function"==typeof e.equals&&"function"==typeof t.equals?e.equals(t):e===t||e!==e&&t!==t):!1}function X(e,t){return t?Z(t,e,"",{"":e}):J(e)}function Z(e,t,n,i){return Array.isArray(t)?e.call(i,n,x(t).map(function(n,i){return Z(e,n,i,t)})):Q(t)?e.call(i,n,M(t).map(function(n,i){return Z(e,n,i,t)})):t}function J(e){return Array.isArray(e)?x(e).map(J).toList():Q(e)?M(e).map(J).toMap():e}function Q(e){return e&&e.constructor===Object}function ee(e){return e>>>1&1073741824|3221225471&e}function te(e){if(e===!1||null===e||void 0===e)return 0;if("function"==typeof e.valueOf&&(e=e.valueOf(),e===!1||null===e||void 0===e))return 0;if(e===!0)return 1;var t=typeof e;if("number"===t){var n=0|e;for(n!==e&&(n^=4294967295*e);e>4294967295;)e/=4294967295,n^=e;return ee(n)}return"string"===t?e.length>Mn?ne(e):ie(e):"function"==typeof e.hashCode?e.hashCode():oe(e)}function ne(e){var t=kn[e];return void 0===t&&(t=ie(e),On===xn&&(On=0,kn={}),On++,kn[e]=t),t}function ie(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return ee(t)}function oe(e){var t=An&&An.get(e);if(t)return t;if(t=e[In])return t;if(!Rn){if(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[In])return t;if(t=re(e))return t}if(Object.isExtensible&&!Object.isExtensible(e))throw new Error("Non-extensible objects are not allowed as keys.");if(t=++Dn,1073741824&Dn&&(Dn=0),An)An.set(e,t);else if(Rn)Object.defineProperty(e,In,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[In]=t;else{if(!e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[In]=t}return t}function re(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function ae(e,t){if(!e)throw new Error(t)}function se(e){ae(e!==1/0,"Cannot perform this action with an infinite size.")}function ce(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function le(e){this._iter=e,this.size=e.size}function ue(e){this._iter=e,this.size=e.size}function he(e){this._iter=e,this.size=e.size}function de(e){var t=ke(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.contains(t)},t.contains=function(t){return e.has(t)},t.cacheResult=Ne,t.__iterateUncached=function(t,n){var i=this;return e.__iterate(function(e,n){return t(n,e,i)!==!1},n)},t.__iteratorUncached=function(t,n){if(t===_n){var i=e.__iterator(t,n);return new b(function(){var e=i.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===yn?vn:yn,n)},t}function pe(e,t,n){var i=ke(e);return i.size=e.size,i.has=function(t){return e.has(t)},i.get=function(i,o){var r=e.get(i,un);return r===un?o:t.call(n,r,i,e)},i.__iterateUncached=function(i,o){var r=this;return e.__iterate(function(e,o,a){return i(t.call(n,e,o,a),o,r)!==!1},o)},i.__iteratorUncached=function(i,o){var r=e.__iterator(_n,o);return new b(function(){var o=r.next();if(o.done)return o;var a=o.value,s=a[0];return T(i,s,t.call(n,a[1],s,e),o)})},i}function me(e,t){var n=ke(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=de(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,i){return e.get(t?n:-1-n,i)},n.has=function(n){return e.has(t?n:-1-n)},n.contains=function(t){return e.contains(t)},n.cacheResult=Ne,n.__iterate=function(t,n){var i=this;return e.__iterate(function(e,n){return t(e,n,i)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function fe(e,t,n,i){var o=ke(e);return i&&(o.has=function(i){var o=e.get(i,un);return o!==un&&!!t.call(n,o,i,e)},o.get=function(i,o){var r=e.get(i,un);return r!==un&&t.call(n,r,i,e)?r:o}),o.__iterateUncached=function(o,r){var a=this,s=0;return e.__iterate(function(e,r,c){return t.call(n,e,r,c)?(s++,o(e,i?r:s-1,a)):void 0},r),s},o.__iteratorUncached=function(o,r){var a=e.__iterator(_n,r),s=0;return new b(function(){for(;;){var r=a.next();if(r.done)return r;var c=r.value,l=c[0],u=c[1];if(t.call(n,u,l,e))return T(o,i?l:s++,u,r)}})},o}function ge(e,t,n){var i=Ue().asMutable();return e.__iterate(function(o,r){i.update(t.call(n,o,r,e),0,function(e){return e+1})}),i.asImmutable()}function ve(e,t,n){var i=v(e),o=(E(e)?St():Ue()).asMutable();e.__iterate(function(r,a){o.update(t.call(n,r,a,e),function(e){return e=e||[],e.push(i?[a,r]:r),e})});var r=Oe(e);return o.map(function(t){return Ie(e,r(t))})}function ye(e,t,n,i){var o=e.size;if(c(t,n,o))return e;var r=l(t,o),s=u(n,o);if(r!==r||s!==s)return ye(e.toSeq().cacheResult(),t,n,i);var h=s-r;0>h&&(h=0);var d=ke(e);return d.size=0===h?h:e.size&&h||void 0,!i&&U(e)&&h>=0&&(d.get=function(t,n){return t=a(this,t),t>=0&&h>t?e.get(t+r,n):n}),d.__iterateUncached=function(t,n){var o=this;if(0===h)return 0;if(n)return this.cacheResult().__iterate(t,n);var a=0,s=!0,c=0;return e.__iterate(function(e,n){return s&&(s=a++<r)?void 0:(c++,t(e,i?n:c-1,o)!==!1&&c!==h)}),c},d.__iteratorUncached=function(t,n){if(h&&n)return this.cacheResult().__iterator(t,n);var o=h&&e.__iterator(t,n),a=0,s=0;return new b(function(){for(;a++!==r;)o.next();if(++s>h)return S();
var e=o.next();return i||t===yn?e:t===vn?T(t,s-1,void 0,e):T(t,s-1,e.value[1],e)})},d}function _e(e,t,n){var i=ke(e);return i.__iterateUncached=function(i,o){var r=this;if(o)return this.cacheResult().__iterate(i,o);var a=0;return e.__iterate(function(e,o,s){return t.call(n,e,o,s)&&++a&&i(e,o,r)}),a},i.__iteratorUncached=function(i,o){var r=this;if(o)return this.cacheResult().__iterator(i,o);var a=e.__iterator(_n,o),s=!0;return new b(function(){if(!s)return S();var e=a.next();if(e.done)return e;var o=e.value,c=o[0],l=o[1];return t.call(n,l,c,r)?i===_n?e:T(i,c,l,e):(s=!1,S())})},i}function Ee(e,t,n,i){var o=ke(e);return o.__iterateUncached=function(o,r){var a=this;if(r)return this.cacheResult().__iterate(o,r);var s=!0,c=0;return e.__iterate(function(e,r,l){return s&&(s=t.call(n,e,r,l))?void 0:(c++,o(e,i?r:c-1,a))}),c},o.__iteratorUncached=function(o,r){var a=this;if(r)return this.cacheResult().__iterator(o,r);var s=e.__iterator(_n,r),c=!0,l=0;return new b(function(){var e,r,u;do{if(e=s.next(),e.done)return i||o===yn?e:o===vn?T(o,l++,void 0,e):T(o,l++,e.value[1],e);var h=e.value;r=h[0],u=h[1],c&&(c=t.call(n,u,r,a))}while(c);return o===_n?e:T(o,r,u,e)})},o}function be(e,t){var n=v(e),i=[e].concat(t).map(function(e){return g(e)?n&&(e=p(e)):e=n?B(e):H(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===i.length)return e;if(1===i.length){var o=i[0];if(o===e||n&&v(o)||y(e)&&y(o))return o}var r=new k(i);return n?r=r.toKeyedSeq():y(e)||(r=r.toSetSeq()),r=r.flatten(!0),r.size=i.reduce(function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}},0),r}function Te(e,t,n){var i=ke(e);return i.__iterateUncached=function(i,o){function r(e,c){var l=this;e.__iterate(function(e,o){return(!t||t>c)&&g(e)?r(e,c+1):i(e,n?o:a++,l)===!1&&(s=!0),!s},o)}var a=0,s=!1;return r(e,0),a},i.__iteratorUncached=function(i,o){var r=e.__iterator(i,o),a=[],s=0;return new b(function(){for(;r;){var e=r.next();if(e.done===!1){var c=e.value;if(i===_n&&(c=c[1]),t&&!(a.length<t)||!g(c))return n?e:T(i,s++,c,e);a.push(r),r=c.__iterator(i,o)}else r=a.pop()}return S()})},i}function Se(e,t,n){var i=Oe(e);return e.toSeq().map(function(o,r){return i(t.call(n,o,r,e))}).flatten(!0)}function we(e,t){var n=ke(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,i){var o=this,r=0;return e.__iterate(function(e,i){return(!r||n(t,r++,o)!==!1)&&n(e,r++,o)!==!1},i),r},n.__iteratorUncached=function(n,i){var o,r=e.__iterator(yn,i),a=0;return new b(function(){return(!o||a%2)&&(o=r.next(),o.done)?o:a%2?T(n,a++,t):T(n,a++,o.value,o)})},n}function Ce(e,t,n){t||(t=Le);var i=v(e),o=0,r=e.toSeq().map(function(t,i){return[i,t,o++,n?n(t,i,e):t]}).toArray();return r.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(i?function(e,t){r[t].length=2}:function(e,t){r[t]=e[1]}),i?M(r):y(e)?x(r):O(r)}function Re(e,t,n){if(t||(t=Le),n){var i=e.toSeq().map(function(t,i){return[t,n(t,i,e)]}).reduce(function(e,n){return Ae(t,e[1],n[1])?n:e});return i&&i[0]}return e.reduce(function(e,n){return Ae(t,e,n)?n:e})}function Ae(e,t,n){var i=e(n,t);return 0===i&&n!==t&&(void 0===n||null===n||n!==n)||i>0}function De(e,t,n){var i=ke(e);return i.size=new k(n).map(function(e){return e.size}).min(),i.__iterate=function(e,t){for(var n,i=this.__iterator(yn,t),o=0;!(n=i.next()).done&&e(n.value,o++,this)!==!1;);return o},i.__iteratorUncached=function(e,i){var o=n.map(function(e){return e=d(e),R(i?e.reverse():e)}),r=0,a=!1;return new b(function(){var n;return a||(n=o.map(function(e){return e.next()}),a=n.some(function(e){return e.done})),a?S():T(e,r++,t.apply(null,n.map(function(e){return e.value})))})},i}function Ie(e,t){return U(e)?t:e.constructor(t)}function Me(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function xe(e){return se(e.size),r(e)}function Oe(e){return v(e)?p:y(e)?m:f}function ke(e){return Object.create((v(e)?M:y(e)?x:O).prototype)}function Ne(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):I.prototype.cacheResult.call(this)}function Le(e,t){return e>t?1:t>e?-1:0}function Pe(e){var t=R(e);if(!t){if(!D(e))throw new TypeError("Expected iterable or array-like: "+e);t=R(d(e))}return t}function Ue(e){return null===e||void 0===e?Ke():je(e)?e:Ke().withMutations(function(t){var n=p(e);se(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function je(e){return!(!e||!e[Nn])}function Be(e,t){this.ownerID=e,this.entries=t}function He(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}function ze(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}function Fe(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}function Ve(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}function We(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&qe(e._root)}function Ge(e,t){return T(e,t[0],t[1])}function qe(e,t){return{node:e,index:0,__prev:t}}function Ye(e,t,n,i){var o=Object.create(Ln);return o.size=e,o._root=t,o.__ownerID=n,o.__hash=i,o.__altered=!1,o}function Ke(){return Pn||(Pn=Ye(0))}function $e(e,n,i){var o,r;if(e._root){var a=t(hn),s=t(dn);if(o=Xe(e._root,e.__ownerID,0,void 0,n,i,a,s),!s.value)return e;r=e.size+(a.value?i===un?-1:1:0)}else{if(i===un)return e;r=1,o=new Be(e.__ownerID,[[n,i]])}return e.__ownerID?(e.size=r,e._root=o,e.__hash=void 0,e.__altered=!0,e):o?Ye(r,o):Ke()}function Xe(e,t,i,o,r,a,s,c){return e?e.update(t,i,o,r,a,s,c):a===un?e:(n(c),n(s),new Ve(t,o,[r,a]))}function Ze(e){return e.constructor===Ve||e.constructor===Fe}function Je(e,t,n,i,o){if(e.keyHash===i)return new Fe(t,i,[e.entry,o]);var r,a=(0===n?e.keyHash:e.keyHash>>>n)&ln,s=(0===n?i:i>>>n)&ln,c=a===s?[Je(e,t,n+sn,i,o)]:(r=new Ve(t,i,o),s>a?[e,r]:[r,e]);return new He(t,1<<a|1<<s,c)}function Qe(e,t,n,o){e||(e=new i);for(var r=new Ve(e,te(n),[n,o]),a=0;a<t.length;a++){var s=t[a];r=r.update(e,0,void 0,s[0],s[1])}return r}function et(e,t,n,i){for(var o=0,r=0,a=new Array(n),s=0,c=1,l=t.length;l>s;s++,c<<=1){var u=t[s];void 0!==u&&s!==i&&(o|=c,a[r++]=u)}return new He(e,o,a)}function tt(e,t,n,i,o){for(var r=0,a=new Array(cn),s=0;0!==n;s++,n>>>=1)a[s]=1&n?t[r++]:void 0;return a[i]=o,new ze(e,r+1,a)}function nt(e,t,n){for(var i=[],o=0;o<n.length;o++){var r=n[o],a=p(r);g(r)||(a=a.map(function(e){return X(e)})),i.push(a)}return ot(e,t,i)}function it(e){return function(t,n){return t&&t.mergeDeepWith&&g(n)?t.mergeDeepWith(e,n):e?e(t,n):n}}function ot(e,t,n){return n=n.filter(function(e){return 0!==e.size}),0===n.length?e:0===e.size&&1===n.length?e.constructor(n[0]):e.withMutations(function(e){for(var i=t?function(n,i){e.update(i,un,function(e){return e===un?n:t(e,n)})}:function(t,n){e.set(n,t)},o=0;o<n.length;o++)n[o].forEach(i)})}function rt(e,t,n,i){var o=e===un,r=t.next();if(r.done){var a=o?n:e,s=i(a);return s===a?e:s}ae(o||e&&e.set,"invalid keyPath");var c=r.value,l=o?un:e.get(c,un),u=rt(l,t,n,i);return u===l?e:u===un?e.remove(c):(o?Ke():e).set(c,u)}function at(e){return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,127&e}function st(e,t,n,i){var r=i?e:o(e);return r[t]=n,r}function ct(e,t,n,i){var o=e.length+1;if(i&&t+1===o)return e[t]=n,e;for(var r=new Array(o),a=0,s=0;o>s;s++)s===t?(r[s]=n,a=-1):r[s]=e[s+a];return r}function lt(e,t,n){var i=e.length-1;if(n&&t===i)return e.pop(),e;for(var o=new Array(i),r=0,a=0;i>a;a++)a===t&&(r=1),o[a]=e[a+r];return o}function ut(e){var t=ft();if(null===e||void 0===e)return t;if(ht(e))return e;var n=m(e),i=n.size;return 0===i?t:(se(i),i>0&&cn>i?mt(0,i,sn,null,new dt(n.toArray())):t.withMutations(function(e){e.setSize(i),n.forEach(function(t,n){return e.set(n,t)})}))}function ht(e){return!(!e||!e[Hn])}function dt(e,t){this.array=e,this.ownerID=t}function pt(e,t){function n(e,t,n){return 0===t?i(e,n):o(e,t,n)}function i(e,n){var i=n===s?c&&c.array:e&&e.array,o=n>r?0:r-n,l=a-n;return l>cn&&(l=cn),function(){if(o===l)return Vn;var e=t?--l:o++;return i&&i[e]}}function o(e,i,o){var s,c=e&&e.array,l=o>r?0:r-o>>i,u=(a-o>>i)+1;return u>cn&&(u=cn),function(){for(;;){if(s){var e=s();if(e!==Vn)return e;s=null}if(l===u)return Vn;var r=t?--u:l++;s=n(c&&c[r],i-sn,o+(r<<i))}}}var r=e._origin,a=e._capacity,s=Tt(a),c=e._tail;return n(e._root,e._level,0)}function mt(e,t,n,i,o,r,a){var s=Object.create(zn);return s.size=t-e,s._origin=e,s._capacity=t,s._level=n,s._root=i,s._tail=o,s.__ownerID=r,s.__hash=a,s.__altered=!1,s}function ft(){return Fn||(Fn=mt(0,0,sn))}function gt(e,n,i){if(n=a(e,n),n>=e.size||0>n)return e.withMutations(function(e){0>n?Et(e,n).set(0,i):Et(e,0,n+1).set(n,i)});n+=e._origin;var o=e._tail,r=e._root,s=t(dn);return n>=Tt(e._capacity)?o=vt(o,e.__ownerID,0,n,i,s):r=vt(r,e.__ownerID,e._level,n,i,s),s.value?e.__ownerID?(e._root=r,e._tail=o,e.__hash=void 0,e.__altered=!0,e):mt(e._origin,e._capacity,e._level,r,o):e}function vt(e,t,i,o,r,a){var s=o>>>i&ln,c=e&&s<e.array.length;if(!c&&void 0===r)return e;var l;if(i>0){var u=e&&e.array[s],h=vt(u,t,i-sn,o,r,a);return h===u?e:(l=yt(e,t),l.array[s]=h,l)}return c&&e.array[s]===r?e:(n(a),l=yt(e,t),void 0===r&&s===l.array.length-1?l.array.pop():l.array[s]=r,l)}function yt(e,t){return t&&e&&t===e.ownerID?e:new dt(e?e.array.slice():[],t)}function _t(e,t){if(t>=Tt(e._capacity))return e._tail;if(t<1<<e._level+sn){for(var n=e._root,i=e._level;n&&i>0;)n=n.array[t>>>i&ln],i-=sn;return n}}function Et(e,t,n){var o=e.__ownerID||new i,r=e._origin,a=e._capacity,s=r+t,c=void 0===n?a:0>n?a+n:r+n;if(s===r&&c===a)return e;if(s>=c)return e.clear();for(var l=e._level,u=e._root,h=0;0>s+h;)u=new dt(u&&u.array.length?[void 0,u]:[],o),l+=sn,h+=1<<l;h&&(s+=h,r+=h,c+=h,a+=h);for(var d=Tt(a),p=Tt(c);p>=1<<l+sn;)u=new dt(u&&u.array.length?[u]:[],o),l+=sn;var m=e._tail,f=d>p?_t(e,c-1):p>d?new dt([],o):m;if(m&&p>d&&a>s&&m.array.length){u=yt(u,o);for(var g=u,v=l;v>sn;v-=sn){var y=d>>>v&ln;g=g.array[y]=yt(g.array[y],o)}g.array[d>>>sn&ln]=m}if(a>c&&(f=f&&f.removeAfter(o,0,c)),s>=p)s-=p,c-=p,l=sn,u=null,f=f&&f.removeBefore(o,0,s);else if(s>r||d>p){for(h=0;u;){var _=s>>>l&ln;if(_!==p>>>l&ln)break;_&&(h+=(1<<l)*_),l-=sn,u=u.array[_]}u&&s>r&&(u=u.removeBefore(o,l,s-h)),u&&d>p&&(u=u.removeAfter(o,l,p-h)),h&&(s-=h,c-=h)}return e.__ownerID?(e.size=c-s,e._origin=s,e._capacity=c,e._level=l,e._root=u,e._tail=f,e.__hash=void 0,e.__altered=!0,e):mt(s,c,l,u,f)}function bt(e,t,n){for(var i=[],o=0,r=0;r<n.length;r++){var a=n[r],s=m(a);s.size>o&&(o=s.size),g(a)||(s=s.map(function(e){return X(e)})),i.push(s)}return o>e.size&&(e=e.setSize(o)),ot(e,t,i)}function Tt(e){return cn>e?0:e-1>>>sn<<sn}function St(e){return null===e||void 0===e?Rt():wt(e)?e:Rt().withMutations(function(t){var n=p(e);se(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function wt(e){return je(e)&&E(e)}function Ct(e,t,n,i){var o=Object.create(St.prototype);return o.size=e?e.size:0,o._map=e,o._list=t,o.__ownerID=n,o.__hash=i,o}function Rt(){return Wn||(Wn=Ct(Ke(),ft()))}function At(e,t,n){var i,o,r=e._map,a=e._list,s=r.get(t),c=void 0!==s;if(n===un){if(!c)return e;a.size>=cn&&a.size>=2*r.size?(o=a.filter(function(e,t){return void 0!==e&&s!==t}),i=o.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(i.__ownerID=o.__ownerID=e.__ownerID)):(i=r.remove(t),o=s===a.size-1?a.pop():a.set(s,void 0))}else if(c){if(n===a.get(s)[1])return e;i=r,o=a.set(s,[t,n])}else i=r.set(t,a.size),o=a.set(a.size,[t,n]);return e.__ownerID?(e.size=i.size,e._map=i,e._list=o,e.__hash=void 0,e):Ct(i,o)}function Dt(e){return null===e||void 0===e?xt():It(e)?e:xt().unshiftAll(e)}function It(e){return!(!e||!e[Gn])}function Mt(e,t,n,i){var o=Object.create(qn);return o.size=e,o._head=t,o.__ownerID=n,o.__hash=i,o.__altered=!1,o}function xt(){return Yn||(Yn=Mt(0))}function Ot(e){return null===e||void 0===e?Pt():kt(e)?e:Pt().withMutations(function(t){var n=f(e);se(n.size),n.forEach(function(e){return t.add(e)})})}function kt(e){return!(!e||!e[Kn])}function Nt(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function Lt(e,t){var n=Object.create($n);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Pt(){return Xn||(Xn=Lt(Ke()))}function Ut(e){return null===e||void 0===e?Ht():jt(e)?e:Ht().withMutations(function(t){var n=f(e);se(n.size),n.forEach(function(e){return t.add(e)})})}function jt(e){return kt(e)&&E(e)}function Bt(e,t){var n=Object.create(Zn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Ht(){return Jn||(Jn=Bt(Rt()))}function zt(e,t){var n=function(e){return this instanceof n?void(this._map=Ue(e)):new n(e)},i=Object.keys(e),o=n.prototype=Object.create(Qn);o.constructor=n,t&&(o._name=t),o._defaultValues=e,o._keys=i,o.size=i.length;try{i.forEach(function(e){Object.defineProperty(n.prototype,e,{get:function(){return this.get(e)},set:function(t){ae(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})})}catch(r){}return n}function Ft(e,t,n){var i=Object.create(Object.getPrototypeOf(e));return i._map=t,i.__ownerID=n,i}function Vt(e){return e._name||e.constructor.name}function Wt(e,t){if(e===t)return!0;if(!g(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||v(e)!==v(t)||y(e)!==y(t)||E(e)!==E(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!_(e);if(E(e)){var i=e.entries();return t.every(function(e,t){var o=i.next().value;return o&&$(o[1],e)&&(n||$(o[0],t))})&&i.next().done}var o=!1;if(void 0===e.size)if(void 0===t.size)e.cacheResult();else{o=!0;var r=e;e=t,t=r}var a=!0,s=t.__iterate(function(t,i){return(n?e.has(t):o?$(t,e.get(i,un)):$(e.get(i,un),t))?void 0:(a=!1,!1)});return a&&e.size===s}function Gt(e,t,n){if(!(this instanceof Gt))return new Gt(e,t,n);if(ae(0!==n,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),n=void 0===n?1:Math.abs(n),e>t&&(n=-n),this._start=e,this._end=t,this._step=n,this.size=Math.max(0,Math.ceil((t-e)/n-1)+1),0===this.size){if(ei)return ei;ei=this}}function qt(e,t){if(!(this instanceof qt))return new qt(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(ti)return ti;ti=this}}function Yt(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}function Kt(e,t){return t}function $t(e,t){return[t,e]}function Xt(e){return function(){return!e.apply(this,arguments)}}function Zt(e){return function(){return-e.apply(this,arguments)}}function Jt(e){return"string"==typeof e?JSON.stringify(e):e}function Qt(){return o(arguments)}function en(e,t){return t>e?1:e>t?-1:0}function tn(e){if(e.size===1/0)return 0;var t=E(e),n=v(e),i=t?1:0,o=e.__iterate(n?t?function(e,t){i=31*i+on(te(e),te(t))|0}:function(e,t){i=i+on(te(e),te(t))|0}:t?function(e){i=31*i+te(e)|0}:function(e){i=i+te(e)|0});return nn(o,i)}function nn(e,t){return t=Cn(t,3432918353),t=Cn(t<<15|t>>>-15,461845907),t=Cn(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=Cn(t^t>>>16,2246822507),t=Cn(t^t>>>13,3266489909),t=ee(t^t>>>16)}function on(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var rn=Array.prototype.slice,an="delete",sn=5,cn=1<<sn,ln=cn-1,un={},hn={value:!1},dn={value:!1};e(p,d),e(m,d),e(f,d),d.isIterable=g,d.isKeyed=v,d.isIndexed=y,d.isAssociative=_,d.isOrdered=E,d.Keyed=p,d.Indexed=m,d.Set=f;var pn="@@__IMMUTABLE_ITERABLE__@@",mn="@@__IMMUTABLE_KEYED__@@",fn="@@__IMMUTABLE_INDEXED__@@",gn="@@__IMMUTABLE_ORDERED__@@",vn=0,yn=1,_n=2,En="function"==typeof Symbol&&Symbol.iterator,bn="@@iterator",Tn=En||bn;b.prototype.toString=function(){return"[Iterator]"},b.KEYS=vn,b.VALUES=yn,b.ENTRIES=_n,b.prototype.inspect=b.prototype.toSource=function(){return this.toString()},b.prototype[Tn]=function(){return this},e(I,d),I.of=function(){return I(arguments)},I.prototype.toSeq=function(){return this},I.prototype.toString=function(){return this.__toString("Seq {","}")},I.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},I.prototype.__iterate=function(e,t){return V(this,e,t,!0)},I.prototype.__iterator=function(e,t){return W(this,e,t,!0)},e(M,I),M.of=function(){return M(arguments)},M.prototype.toKeyedSeq=function(){return this},M.prototype.toSeq=function(){return this},e(x,I),x.of=function(){return x(arguments)},x.prototype.toIndexedSeq=function(){return this},x.prototype.toString=function(){return this.__toString("Seq [","]")},x.prototype.__iterate=function(e,t){return V(this,e,t,!1)},x.prototype.__iterator=function(e,t){return W(this,e,t,!1)},e(O,I),O.of=function(){return O(arguments)},O.prototype.toSetSeq=function(){return this},I.isSeq=U,I.Keyed=M,I.Set=O,I.Indexed=x;var Sn="@@__IMMUTABLE_SEQ__@@";I.prototype[Sn]=!0,e(k,x),k.prototype.get=function(e,t){return this.has(e)?this._array[a(this,e)]:t},k.prototype.__iterate=function(e,t){for(var n=this._array,i=n.length-1,o=0;i>=o;o++)if(e(n[t?i-o:o],o,this)===!1)return o+1;return o},k.prototype.__iterator=function(e,t){var n=this._array,i=n.length-1,o=0;return new b(function(){return o>i?S():T(e,o,n[t?i-o++:o++])})},e(N,M),N.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},N.prototype.has=function(e){return this._object.hasOwnProperty(e)},N.prototype.__iterate=function(e,t){for(var n=this._object,i=this._keys,o=i.length-1,r=0;o>=r;r++){var a=i[t?o-r:r];if(e(n[a],a,this)===!1)return r+1}return r},N.prototype.__iterator=function(e,t){var n=this._object,i=this._keys,o=i.length-1,r=0;return new b(function(){var a=i[t?o-r:r];return r++>o?S():T(e,a,n[a])})},N.prototype[gn]=!0,e(L,x),L.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._iterable,i=R(n),o=0;if(C(i))for(var r;!(r=i.next()).done&&e(r.value,o++,this)!==!1;);return o},L.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterable,i=R(n);if(!C(i))return new b(S);var o=0;return new b(function(){var t=i.next();return t.done?t:T(e,o++,t.value)})},e(P,x),P.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var n=this._iterator,i=this._iteratorCache,o=0;o<i.length;)if(e(i[o],o++,this)===!1)return o;for(var r;!(r=n.next()).done;){var a=r.value;if(i[o]=a,e(a,o++,this)===!1)break}return o},P.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,i=this._iteratorCache,o=0;return new b(function(){if(o>=i.length){var t=n.next();if(t.done)return t;i[o]=t.value}return T(e,o,i[o++])})};var wn;e(G,d),e(q,G),e(Y,G),e(K,G),G.Keyed=q,G.Indexed=Y,G.Set=K;var Cn="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){e=0|e,t=0|t;var n=65535&e,i=65535&t;return n*i+((e>>>16)*i+n*(t>>>16)<<16>>>0)|0},Rn=function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),An="function"==typeof WeakMap&&new WeakMap,Dn=0,In="__immutablehash__";"function"==typeof Symbol&&(In=Symbol(In));var Mn=16,xn=255,On=0,kn={};e(ce,M),ce.prototype.get=function(e,t){return this._iter.get(e,t)},ce.prototype.has=function(e){return this._iter.has(e)},ce.prototype.valueSeq=function(){return this._iter.valueSeq()},ce.prototype.reverse=function(){var e=this,t=me(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},ce.prototype.map=function(e,t){var n=this,i=pe(this,e,t);return this._useKeys||(i.valueSeq=function(){return n._iter.toSeq().map(e,t)}),i},ce.prototype.__iterate=function(e,t){var n,i=this;return this._iter.__iterate(this._useKeys?function(t,n){return e(t,n,i)}:(n=t?xe(this):0,function(o){return e(o,t?--n:n++,i)}),t)},ce.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(yn,t),i=t?xe(this):0;return new b(function(){var o=n.next();return o.done?o:T(e,t?--i:i++,o.value,o)})},ce.prototype[gn]=!0,e(le,x),le.prototype.contains=function(e){return this._iter.contains(e)},le.prototype.__iterate=function(e,t){var n=this,i=0;return this._iter.__iterate(function(t){return e(t,i++,n)},t)},le.prototype.__iterator=function(e,t){var n=this._iter.__iterator(yn,t),i=0;return new b(function(){var t=n.next();return t.done?t:T(e,i++,t.value,t)})},e(ue,O),ue.prototype.has=function(e){return this._iter.contains(e)},ue.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},ue.prototype.__iterator=function(e,t){var n=this._iter.__iterator(yn,t);return new b(function(){var t=n.next();return t.done?t:T(e,t.value,t.value,t)})},e(he,M),he.prototype.entrySeq=function(){return this._iter.toSeq()},he.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return t?(Me(t),e(t[1],t[0],n)):void 0},t)},he.prototype.__iterator=function(e,t){var n=this._iter.__iterator(yn,t);return new b(function(){for(;;){var t=n.next();if(t.done)return t;var i=t.value;if(i)return Me(i),e===_n?t:T(e,i[0],i[1],t)}})},le.prototype.cacheResult=ce.prototype.cacheResult=ue.prototype.cacheResult=he.prototype.cacheResult=Ne,e(Ue,q),Ue.prototype.toString=function(){return this.__toString("Map {","}")},Ue.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Ue.prototype.set=function(e,t){return $e(this,e,t)},Ue.prototype.setIn=function(e,t){return this.updateIn(e,un,function(){return t})},Ue.prototype.remove=function(e){return $e(this,e,un)},Ue.prototype.deleteIn=function(e){return this.updateIn(e,function(){return un})},Ue.prototype.update=function(e,t,n){return 1===arguments.length?e(this):this.updateIn([e],t,n)},Ue.prototype.updateIn=function(e,t,n){n||(n=t,t=void 0);var i=rt(this,Pe(e),t,n);return i===un?void 0:i},Ue.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Ke()},Ue.prototype.merge=function(){return nt(this,void 0,arguments)},Ue.prototype.mergeWith=function(e){var t=rn.call(arguments,1);return nt(this,e,t)},Ue.prototype.mergeIn=function(e){var t=rn.call(arguments,1);return this.updateIn(e,Ke(),function(e){return e.merge.apply(e,t)})},Ue.prototype.mergeDeep=function(){return nt(this,it(void 0),arguments)},Ue.prototype.mergeDeepWith=function(e){var t=rn.call(arguments,1);return nt(this,it(e),t)},Ue.prototype.mergeDeepIn=function(e){var t=rn.call(arguments,1);return this.updateIn(e,Ke(),function(e){return e.mergeDeep.apply(e,t)})},Ue.prototype.sort=function(e){return St(Ce(this,e))},Ue.prototype.sortBy=function(e,t){return St(Ce(this,t,e))},Ue.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Ue.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new i)},Ue.prototype.asImmutable=function(){return this.__ensureOwner()},Ue.prototype.wasAltered=function(){return this.__altered},Ue.prototype.__iterator=function(e,t){return new We(this,e,t)},Ue.prototype.__iterate=function(e,t){var n=this,i=0;return this._root&&this._root.iterate(function(t){return i++,e(t[1],t[0],n)},t),i},Ue.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Ye(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Ue.isMap=je;var Nn="@@__IMMUTABLE_MAP__@@",Ln=Ue.prototype;Ln[Nn]=!0,Ln[an]=Ln.remove,Ln.removeIn=Ln.deleteIn,Be.prototype.get=function(e,t,n,i){for(var o=this.entries,r=0,a=o.length;a>r;r++)if($(n,o[r][0]))return o[r][1];return i},Be.prototype.update=function(e,t,i,r,a,s,c){for(var l=a===un,u=this.entries,h=0,d=u.length;d>h&&!$(r,u[h][0]);h++);var p=d>h;if(p?u[h][1]===a:l)return this;if(n(c),(l||!p)&&n(s),!l||1!==u.length){if(!p&&!l&&u.length>=Un)return Qe(e,u,r,a);var m=e&&e===this.ownerID,f=m?u:o(u);return p?l?h===d-1?f.pop():f[h]=f.pop():f[h]=[r,a]:f.push([r,a]),m?(this.entries=f,this):new Be(e,f)}},He.prototype.get=function(e,t,n,i){void 0===t&&(t=te(n));var o=1<<((0===e?t:t>>>e)&ln),r=this.bitmap;return 0===(r&o)?i:this.nodes[at(r&o-1)].get(e+sn,t,n,i)},He.prototype.update=function(e,t,n,i,o,r,a){void 0===n&&(n=te(i));var s=(0===t?n:n>>>t)&ln,c=1<<s,l=this.bitmap,u=0!==(l&c);if(!u&&o===un)return this;var h=at(l&c-1),d=this.nodes,p=u?d[h]:void 0,m=Xe(p,e,t+sn,n,i,o,r,a);if(m===p)return this;if(!u&&m&&d.length>=jn)return tt(e,d,l,s,m);if(u&&!m&&2===d.length&&Ze(d[1^h]))return d[1^h];if(u&&m&&1===d.length&&Ze(m))return m;var f=e&&e===this.ownerID,g=u?m?l:l^c:l|c,v=u?m?st(d,h,m,f):lt(d,h,f):ct(d,h,m,f);return f?(this.bitmap=g,this.nodes=v,this):new He(e,g,v)},ze.prototype.get=function(e,t,n,i){void 0===t&&(t=te(n));var o=(0===e?t:t>>>e)&ln,r=this.nodes[o];return r?r.get(e+sn,t,n,i):i},ze.prototype.update=function(e,t,n,i,o,r,a){void 0===n&&(n=te(i));var s=(0===t?n:n>>>t)&ln,c=o===un,l=this.nodes,u=l[s];if(c&&!u)return this;var h=Xe(u,e,t+sn,n,i,o,r,a);if(h===u)return this;var d=this.count;if(u){if(!h&&(d--,Bn>d))return et(e,l,d,s)}else d++;var p=e&&e===this.ownerID,m=st(l,s,h,p);return p?(this.count=d,this.nodes=m,this):new ze(e,d,m)},Fe.prototype.get=function(e,t,n,i){for(var o=this.entries,r=0,a=o.length;a>r;r++)if($(n,o[r][0]))return o[r][1];return i},Fe.prototype.update=function(e,t,i,r,a,s,c){void 0===i&&(i=te(r));var l=a===un;if(i!==this.keyHash)return l?this:(n(c),n(s),Je(this,e,t,i,[r,a]));for(var u=this.entries,h=0,d=u.length;d>h&&!$(r,u[h][0]);h++);var p=d>h;if(p?u[h][1]===a:l)return this;if(n(c),(l||!p)&&n(s),l&&2===d)return new Ve(e,this.keyHash,u[1^h]);var m=e&&e===this.ownerID,f=m?u:o(u);return p?l?h===d-1?f.pop():f[h]=f.pop():f[h]=[r,a]:f.push([r,a]),m?(this.entries=f,this):new Fe(e,this.keyHash,f)},Ve.prototype.get=function(e,t,n,i){return $(n,this.entry[0])?this.entry[1]:i},Ve.prototype.update=function(e,t,i,o,r,a,s){var c=r===un,l=$(o,this.entry[0]);return(l?r===this.entry[1]:c)?this:(n(s),c?void n(a):l?e&&e===this.ownerID?(this.entry[1]=r,this):new Ve(e,this.keyHash,[o,r]):(n(a),Je(this,e,t,te(o),[o,r])))},Be.prototype.iterate=Fe.prototype.iterate=function(e,t){for(var n=this.entries,i=0,o=n.length-1;o>=i;i++)if(e(n[t?o-i:i])===!1)return!1},He.prototype.iterate=ze.prototype.iterate=function(e,t){for(var n=this.nodes,i=0,o=n.length-1;o>=i;i++){var r=n[t?o-i:i];if(r&&r.iterate(e,t)===!1)return!1}},Ve.prototype.iterate=function(e,t){return e(this.entry)},e(We,b),We.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n,i=t.node,o=t.index++;if(i.entry){if(0===o)return Ge(e,i.entry)}else if(i.entries){if(n=i.entries.length-1,n>=o)return Ge(e,i.entries[this._reverse?n-o:o])}else if(n=i.nodes.length-1,n>=o){var r=i.nodes[this._reverse?n-o:o];if(r){if(r.entry)return Ge(e,r.entry);t=this._stack=qe(r,t)}continue}t=this._stack=this._stack.__prev}return S()};var Pn,Un=cn/4,jn=cn/2,Bn=cn/4;e(ut,Y),ut.of=function(){return this(arguments)},ut.prototype.toString=function(){return this.__toString("List [","]")},ut.prototype.get=function(e,t){if(e=a(this,e),0>e||e>=this.size)return t;e+=this._origin;var n=_t(this,e);return n&&n.array[e&ln]},ut.prototype.set=function(e,t){return gt(this,e,t)},ut.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},ut.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=sn,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):ft()},ut.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){Et(n,0,t+e.length);for(var i=0;i<e.length;i++)n.set(t+i,e[i])})},ut.prototype.pop=function(){return Et(this,0,-1)},ut.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Et(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},ut.prototype.shift=function(){return Et(this,1)},ut.prototype.merge=function(){return bt(this,void 0,arguments)},ut.prototype.mergeWith=function(e){var t=rn.call(arguments,1);return bt(this,e,t)},ut.prototype.mergeDeep=function(){return bt(this,it(void 0),arguments)},ut.prototype.mergeDeepWith=function(e){var t=rn.call(arguments,1);return bt(this,it(e),t)},ut.prototype.setSize=function(e){return Et(this,0,e)},ut.prototype.slice=function(e,t){var n=this.size;return c(e,t,n)?this:Et(this,l(e,n),u(t,n))},ut.prototype.__iterator=function(e,t){var n=0,i=pt(this,t);return new b(function(){var t=i();return t===Vn?S():T(e,n++,t)})},ut.prototype.__iterate=function(e,t){for(var n,i=0,o=pt(this,t);(n=o())!==Vn&&e(n,i++,this)!==!1;);return i},ut.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?mt(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},ut.isList=ht;var Hn="@@__IMMUTABLE_LIST__@@",zn=ut.prototype;zn[Hn]=!0,zn[an]=zn.remove,zn.setIn=Ln.setIn,zn.deleteIn=zn.removeIn=Ln.removeIn,zn.update=Ln.update,zn.updateIn=Ln.updateIn,zn.mergeIn=Ln.mergeIn,zn.mergeDeepIn=Ln.mergeDeepIn,zn.withMutations=Ln.withMutations,zn.asMutable=Ln.asMutable,zn.asImmutable=Ln.asImmutable,zn.wasAltered=Ln.wasAltered,dt.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0||0===this.array.length)return this;var i=n>>>t&ln;if(i>=this.array.length)return new dt([],e);var o,r=0===i;if(t>0){var a=this.array[i];if(o=a&&a.removeBefore(e,t-sn,n),o===a&&r)return this}if(r&&!o)return this;var s=yt(this,e);if(!r)for(var c=0;i>c;c++)s.array[c]=void 0;return o&&(s.array[i]=o),s},dt.prototype.removeAfter=function(e,t,n){if(n===t?1<<t:0||0===this.array.length)return this;var i=n-1>>>t&ln;if(i>=this.array.length)return this;var o,r=i===this.array.length-1;if(t>0){var a=this.array[i];if(o=a&&a.removeAfter(e,t-sn,n),o===a&&r)return this}if(r&&!o)return this;var s=yt(this,e);return r||s.array.pop(),o&&(s.array[i]=o),s};var Fn,Vn={};e(St,Ue),St.of=function(){return this(arguments)},St.prototype.toString=function(){return this.__toString("OrderedMap {","}")},St.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},St.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Rt()},St.prototype.set=function(e,t){return At(this,e,t)},St.prototype.remove=function(e){return At(this,e,un)},St.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},St.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},St.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},St.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?Ct(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)},St.isOrderedMap=wt,St.prototype[gn]=!0,St.prototype[an]=St.prototype.remove;var Wn;e(Dt,Y),Dt.of=function(){return this(arguments)},Dt.prototype.toString=function(){return this.__toString("Stack [","]")},Dt.prototype.get=function(e,t){for(var n=this._head;n&&e--;)n=n.next;return n?n.value:t},Dt.prototype.peek=function(){return this._head&&this._head.value},Dt.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Mt(e,t)},Dt.prototype.pushAll=function(e){if(e=m(e),0===e.size)return this;se(e.size);var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):Mt(t,n)},Dt.prototype.pop=function(){return this.slice(1)},Dt.prototype.unshift=function(){return this.push.apply(this,arguments)},Dt.prototype.unshiftAll=function(e){return this.pushAll(e)},Dt.prototype.shift=function(){return this.pop.apply(this,arguments)},Dt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):xt()},Dt.prototype.slice=function(e,t){if(c(e,t,this.size))return this;var n=l(e,this.size),i=u(t,this.size);if(i!==this.size)return Y.prototype.slice.call(this,e,t);for(var o=this.size-n,r=this._head;n--;)r=r.next;return this.__ownerID?(this.size=o,
this._head=r,this.__hash=void 0,this.__altered=!0,this):Mt(o,r)},Dt.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Mt(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Dt.prototype.__iterate=function(e,t){if(t)return this.toSeq().cacheResult.__iterate(e,t);for(var n=0,i=this._head;i&&e(i.value,n++,this)!==!1;)i=i.next;return n},Dt.prototype.__iterator=function(e,t){if(t)return this.toSeq().cacheResult().__iterator(e,t);var n=0,i=this._head;return new b(function(){if(i){var t=i.value;return i=i.next,T(e,n++,t)}return S()})},Dt.isStack=It;var Gn="@@__IMMUTABLE_STACK__@@",qn=Dt.prototype;qn[Gn]=!0,qn.withMutations=Ln.withMutations,qn.asMutable=Ln.asMutable,qn.asImmutable=Ln.asImmutable,qn.wasAltered=Ln.wasAltered;var Yn;e(Ot,K),Ot.of=function(){return this(arguments)},Ot.fromKeys=function(e){return this(p(e).keySeq())},Ot.prototype.toString=function(){return this.__toString("Set {","}")},Ot.prototype.has=function(e){return this._map.has(e)},Ot.prototype.add=function(e){return Nt(this,this._map.set(e,!0))},Ot.prototype.remove=function(e){return Nt(this,this._map.remove(e))},Ot.prototype.clear=function(){return Nt(this,this._map.clear())},Ot.prototype.union=function(){var e=rn.call(arguments,0);return e=e.filter(function(e){return 0!==e.size}),0===e.length?this:0===this.size&&1===e.length?this.constructor(e[0]):this.withMutations(function(t){for(var n=0;n<e.length;n++)f(e[n]).forEach(function(e){return t.add(e)})})},Ot.prototype.intersect=function(){var e=rn.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return f(e)});var t=this;return this.withMutations(function(n){t.forEach(function(t){e.every(function(e){return e.contains(t)})||n.remove(t)})})},Ot.prototype.subtract=function(){var e=rn.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return f(e)});var t=this;return this.withMutations(function(n){t.forEach(function(t){e.some(function(e){return e.contains(t)})&&n.remove(t)})})},Ot.prototype.merge=function(){return this.union.apply(this,arguments)},Ot.prototype.mergeWith=function(e){var t=rn.call(arguments,1);return this.union.apply(this,t)},Ot.prototype.sort=function(e){return Ut(Ce(this,e))},Ot.prototype.sortBy=function(e,t){return Ut(Ce(this,t,e))},Ot.prototype.wasAltered=function(){return this._map.wasAltered()},Ot.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t,i){return e(i,i,n)},t)},Ot.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},Ot.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},Ot.isSet=kt;var Kn="@@__IMMUTABLE_SET__@@",$n=Ot.prototype;$n[Kn]=!0,$n[an]=$n.remove,$n.mergeDeep=$n.merge,$n.mergeDeepWith=$n.mergeWith,$n.withMutations=Ln.withMutations,$n.asMutable=Ln.asMutable,$n.asImmutable=Ln.asImmutable,$n.__empty=Pt,$n.__make=Lt;var Xn;e(Ut,Ot),Ut.of=function(){return this(arguments)},Ut.fromKeys=function(e){return this(p(e).keySeq())},Ut.prototype.toString=function(){return this.__toString("OrderedSet {","}")},Ut.isOrderedSet=jt;var Zn=Ut.prototype;Zn[gn]=!0,Zn.__empty=Ht,Zn.__make=Bt;var Jn;e(zt,q),zt.prototype.toString=function(){return this.__toString(Vt(this)+" {","}")},zt.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},zt.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},zt.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=Object.getPrototypeOf(this).constructor;return e._empty||(e._empty=Ft(this,Ke()))},zt.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+Vt(this));var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:Ft(this,n)},zt.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:Ft(this,t)},zt.prototype.wasAltered=function(){return this._map.wasAltered()},zt.prototype.__iterator=function(e,t){var n=this;return p(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},zt.prototype.__iterate=function(e,t){var n=this;return p(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},zt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?Ft(this,t,e):(this.__ownerID=e,this._map=t,this)};var Qn=zt.prototype;Qn[an]=Qn.remove,Qn.deleteIn=Qn.removeIn=Ln.removeIn,Qn.merge=Ln.merge,Qn.mergeWith=Ln.mergeWith,Qn.mergeIn=Ln.mergeIn,Qn.mergeDeep=Ln.mergeDeep,Qn.mergeDeepWith=Ln.mergeDeepWith,Qn.mergeDeepIn=Ln.mergeDeepIn,Qn.setIn=Ln.setIn,Qn.update=Ln.update,Qn.updateIn=Ln.updateIn,Qn.withMutations=Ln.withMutations,Qn.asMutable=Ln.asMutable,Qn.asImmutable=Ln.asImmutable,e(Gt,x),Gt.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},Gt.prototype.get=function(e,t){return this.has(e)?this._start+a(this,e)*this._step:t},Gt.prototype.contains=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},Gt.prototype.slice=function(e,t){return c(e,t,this.size)?this:(e=l(e,this.size),t=u(t,this.size),e>=t?new Gt(0,0):new Gt(this.get(e,this._end),this.get(t,this._end),this._step))},Gt.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step===0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},Gt.prototype.lastIndexOf=function(e){return this.indexOf(e)},Gt.prototype.__iterate=function(e,t){for(var n=this.size-1,i=this._step,o=t?this._start+n*i:this._start,r=0;n>=r;r++){if(e(o,r,this)===!1)return r+1;o+=t?-i:i}return r},Gt.prototype.__iterator=function(e,t){var n=this.size-1,i=this._step,o=t?this._start+n*i:this._start,r=0;return new b(function(){var a=o;return o+=t?-i:i,r>n?S():T(e,r++,a)})},Gt.prototype.equals=function(e){return e instanceof Gt?this._start===e._start&&this._end===e._end&&this._step===e._step:Wt(this,e)};var ei;e(qt,x),qt.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},qt.prototype.get=function(e,t){return this.has(e)?this._value:t},qt.prototype.contains=function(e){return $(this._value,e)},qt.prototype.slice=function(e,t){var n=this.size;return c(e,t,n)?this:new qt(this._value,u(t,n)-l(e,n))},qt.prototype.reverse=function(){return this},qt.prototype.indexOf=function(e){return $(this._value,e)?0:-1},qt.prototype.lastIndexOf=function(e){return $(this._value,e)?this.size:-1},qt.prototype.__iterate=function(e,t){for(var n=0;n<this.size;n++)if(e(this._value,n,this)===!1)return n+1;return n},qt.prototype.__iterator=function(e,t){var n=this,i=0;return new b(function(){return i<n.size?T(e,i++,n._value):S()})},qt.prototype.equals=function(e){return e instanceof qt?$(this._value,e._value):Wt(e)};var ti;d.Iterator=b,Yt(d,{toArray:function(){se(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new le(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new ce(this,!0)},toMap:function(){return Ue(this.toKeyedSeq())},toObject:function(){se(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return St(this.toKeyedSeq())},toOrderedSet:function(){return Ut(v(this)?this.valueSeq():this)},toSet:function(){return Ot(v(this)?this.valueSeq():this)},toSetSeq:function(){return new ue(this)},toSeq:function(){return y(this)?this.toIndexedSeq():v(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Dt(v(this)?this.valueSeq():this)},toList:function(){return ut(v(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){var e=rn.call(arguments,0);return Ie(this,be(this,e))},contains:function(e){return this.some(function(t){return $(t,e)})},entries:function(){return this.__iterator(_n)},every:function(e,t){se(this.size);var n=!0;return this.__iterate(function(i,o,r){return e.call(t,i,o,r)?void 0:(n=!1,!1)}),n},filter:function(e,t){return Ie(this,fe(this,e,t,!0))},find:function(e,t,n){var i=this.findEntry(e,t);return i?i[1]:n},findEntry:function(e,t){var n;return this.__iterate(function(i,o,r){return e.call(t,i,o,r)?(n=[o,i],!1):void 0}),n},findLastEntry:function(e,t){return this.toSeq().reverse().findEntry(e,t)},forEach:function(e,t){return se(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){se(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate(function(i){n?n=!1:t+=e,t+=null!==i&&void 0!==i?i:""}),t},keys:function(){return this.__iterator(vn)},map:function(e,t){return Ie(this,pe(this,e,t))},reduce:function(e,t,n){se(this.size);var i,o;return arguments.length<2?o=!0:i=t,this.__iterate(function(t,r,a){o?(o=!1,i=t):i=e.call(n,i,t,r,a)}),i},reduceRight:function(e,t,n){var i=this.toKeyedSeq().reverse();return i.reduce.apply(i,arguments)},reverse:function(){return Ie(this,me(this,!0))},slice:function(e,t){return Ie(this,ye(this,e,t,!0))},some:function(e,t){return!this.every(Xt(e),t)},sort:function(e){return Ie(this,Ce(this,e))},values:function(){return this.__iterator(yn)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return r(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return ge(this,e,t)},equals:function(e){return Wt(this,e)},entrySeq:function(){var e=this;if(e._cache)return new k(e._cache);var t=e.toSeq().map($t).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Xt(e),t)},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},first:function(){return this.find(s)},flatMap:function(e,t){return Ie(this,Se(this,e,t))},flatten:function(e){return Ie(this,Te(this,e,!0))},fromEntrySeq:function(){return new he(this)},get:function(e,t){return this.find(function(t,n){return $(n,e)},void 0,t)},getIn:function(e,t){for(var n,i=this,o=Pe(e);!(n=o.next()).done;){var r=n.value;if(i=i&&i.get?i.get(r,un):un,i===un)return t}return i},groupBy:function(e,t){return ve(this,e,t)},has:function(e){return this.get(e,un)!==un},hasIn:function(e){return this.getIn(e,un)!==un},isSubset:function(e){return e="function"==typeof e.contains?e:d(e),this.every(function(t){return e.contains(t)})},isSuperset:function(e){return e.isSubset(this)},keySeq:function(){return this.toSeq().map(Kt).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(e){return Re(this,e)},maxBy:function(e,t){return Re(this,t,e)},min:function(e){return Re(this,e?Zt(e):en)},minBy:function(e,t){return Re(this,t?Zt(t):en,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return Ie(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return Ie(this,Ee(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Xt(e),t)},sortBy:function(e,t){return Ie(this,Ce(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return Ie(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return Ie(this,_e(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Xt(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=tn(this))}});var ni=d.prototype;ni[pn]=!0,ni[Tn]=ni.values,ni.__toJS=ni.toArray,ni.__toStringMapper=Jt,ni.inspect=ni.toSource=function(){return this.toString()},ni.chain=ni.flatMap,function(){try{Object.defineProperty(ni,"length",{get:function(){if(!d.noLengthWarning){var e;try{throw new Error}catch(t){e=t.stack}if(-1===e.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+e),this.size}}})}catch(e){}}(),Yt(p,{flip:function(){return Ie(this,de(this))},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLastKey:function(e,t){return this.toSeq().reverse().findKey(e,t)},keyOf:function(e){return this.findKey(function(t){return $(t,e)})},lastKeyOf:function(e){return this.findLastKey(function(t){return $(t,e)})},mapEntries:function(e,t){var n=this,i=0;return Ie(this,this.toSeq().map(function(o,r){return e.call(t,[r,o],i++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return Ie(this,this.toSeq().flip().map(function(i,o){return e.call(t,i,o,n)}).flip())}});var ii=p.prototype;ii[mn]=!0,ii[Tn]=ni.entries,ii.__toJS=ni.toObject,ii.__toStringMapper=function(e,t){return t+": "+Jt(e)},Yt(m,{toKeyedSeq:function(){return new ce(this,!1)},filter:function(e,t){return Ie(this,fe(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.toKeyedSeq().keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){return this.toSeq().reverse().indexOf(e)},reverse:function(){return Ie(this,me(this,!1))},slice:function(e,t){return Ie(this,ye(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(0|t,0),0===n||2===n&&!t)return this;e=l(e,this.size);var i=this.slice(0,e);return Ie(this,1===n?i:i.concat(o(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.toKeyedSeq().findLastKey(e,t);return void 0===n?-1:n},first:function(){return this.get(0)},flatten:function(e){return Ie(this,Te(this,e,!1))},get:function(e,t){return e=a(this,e),0>e||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return e=a(this,e),e>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return Ie(this,we(this,e))},interleave:function(){var e=[this].concat(o(arguments)),t=De(this.toSeq(),x.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),Ie(this,n)},last:function(){return this.get(-1)},skipWhile:function(e,t){return Ie(this,Ee(this,e,t,!1))},zip:function(){var e=[this].concat(o(arguments));return Ie(this,De(this,Qt,e))},zipWith:function(e){var t=o(arguments);return t[0]=this,Ie(this,De(this,e,t))}}),m.prototype[fn]=!0,m.prototype[gn]=!0,Yt(f,{get:function(e,t){return this.has(e)?e:t},contains:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),f.prototype.has=ni.contains,Yt(M,p.prototype),Yt(x,m.prototype),Yt(O,f.prototype),Yt(q,p.prototype),Yt(Y,m.prototype),Yt(K,f.prototype);var oi={Iterable:d,Seq:I,Collection:G,Map:Ue,OrderedMap:St,List:ut,Stack:Dt,Set:Ot,OrderedSet:Ut,Record:zt,Range:Gt,Repeat:qt,is:$,fromJS:X};return oi})},{}],18:[function(e,t,n){"use strict";var i=function(e){var t,n={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};t.exports=i},{}],19:[function(e,t,n){(function(e){(function(){function i(e,t){if(e!==t){var n=e===e,i=t===t;if(e>t||!n||"undefined"==typeof e&&i)return 1;if(t>e||!i||"undefined"==typeof t&&n)return-1}return 0}function o(e,t,n){for(var i=e.length,o=n?i:-1;n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function r(e,t,n){if(t!==t)return g(e,n);for(var i=n-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}function a(e){return"function"==typeof e||!1}function s(e){return"string"==typeof e?e:null==e?"":e+""}function c(e){return e.charCodeAt(0)}function l(e,t){for(var n=-1,i=e.length;++n<i&&t.indexOf(e.charAt(n))>-1;);return n}function u(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}function h(e,t){return i(e.criteria,t.criteria)||e.index-t.index}function d(e,t,n){for(var o=-1,r=e.criteria,a=t.criteria,s=r.length,c=n.length;++o<s;){var l=i(r[o],a[o]);if(l)return o>=c?l:l*(n[o]?1:-1)}return e.index-t.index}function p(e){return ze[e]}function m(e){return Fe[e]}function f(e){return"\\"+Ge[e]}function g(e,t,n){for(var i=e.length,o=t+(n?0:-1);n?o--:++o<i;){var r=e[o];if(r!==r)return o}return-1}function v(e){return!!e&&"object"==typeof e}function y(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function _(e,t){for(var n=-1,i=e.length,o=-1,r=[];++n<i;)e[n]===t&&(e[n]=W,r[++o]=n);return r}function E(e,t){for(var n,i=-1,o=e.length,r=-1,a=[];++i<o;){var s=e[i],c=t?t(s,i,e):s;i&&n===c||(n=c,a[++r]=s)}return a}function b(e){for(var t=-1,n=e.length;++t<n&&y(e.charCodeAt(t)););return t}function T(e){for(var t=e.length;t--&&y(e.charCodeAt(t)););return t}function S(e){return Ve[e]}function w(e){function t(e){if(v(e)&&!as(e)&&!(e instanceof Z)){if(e instanceof y)return e;if(xr.call(e,"__chain__")&&xr.call(e,"__wrapped__"))return Kn(e)}return new y(e)}function n(){}function y(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function Z(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=sa,this.__views__=null}function te(){var e=this.__actions__,t=this.__iteratees__,n=this.__views__,i=new Z(this.__wrapped__);return i.__actions__=e?Xe(e):null,i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=t?Xe(t):null,i.__takeCount__=this.__takeCount__,i.__views__=n?Xe(n):null,i}function ie(){if(this.__filtered__){var e=new Z(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function ze(){var e=this.__wrapped__.value();if(!as(e))return Yt(e,this.__actions__);var t=this.__dir__,n=0>t,i=xn(0,e.length,this.__views__),o=i.start,r=i.end,a=r-o,s=n?r:o-1,c=ta(a,this.__takeCount__),l=this.__iteratees__,u=l?l.length:0,h=0,d=[];e:for(;a--&&c>h;){s+=t;for(var p=-1,m=e[s];++p<u;){var f=l[p],g=f.iteratee,v=f.type;if(v==H){if(f.done&&(n?s>f.index:s<f.index)&&(f.count=0,f.done=!1),f.index=s,!f.done){var y=f.limit;if(!(f.done=y>-1?f.count++>=y:!g(m)))continue e}}else{var _=g(m);if(v==F)m=_;else if(!_){if(v==z)continue e;break e}}}d[h++]=m}return d}function Fe(){this.__data__={}}function Ve(e){return this.has(e)&&delete this.__data__[e]}function We(e){return"__proto__"==e?C:this.__data__[e]}function Ge(e){return"__proto__"!=e&&xr.call(this.__data__,e)}function qe(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this}function Ye(e){var t=e?e.length:0;for(this.data={hash:Zr(null),set:new Wr};t--;)this.push(e[t])}function Ke(e,t){var n=e.data,i="string"==typeof t||po(t)?n.set.has(t):n.hash[t];return i?0:-1}function $e(e){var t=this.data;"string"==typeof e||po(e)?t.set.add(e):t.hash[e]=!0}function Xe(e,t){var n=-1,i=e.length;for(t||(t=fr(i));++n<i;)t[n]=e[n];return t}function Ze(e,t){for(var n=-1,i=e.length;++n<i&&t(e[n],n,e)!==!1;);return e}function et(e,t){for(var n=e.length;n--&&t(e[n],n,e)!==!1;);return e}function tt(e,t){for(var n=-1,i=e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function nt(e,t){for(var n=-1,i=e.length,o=-1,r=[];++n<i;){var a=e[n];t(a,n,e)&&(r[++o]=a)}return r}function it(e,t){for(var n=-1,i=e.length,o=fr(i);++n<i;)o[n]=t(e[n],n,e);return o}function ot(e){for(var t=-1,n=e.length,i=aa;++t<n;){var o=e[t];o>i&&(i=o)}return i}function rt(e){for(var t=-1,n=e.length,i=sa;++t<n;){var o=e[t];i>o&&(i=o)}return i}function at(e,t,n,i){var o=-1,r=e.length;for(i&&r&&(n=e[++o]);++o<r;)n=t(n,e[o],o,e);return n}function st(e,t,n,i){var o=e.length;for(i&&o&&(n=e[--o]);o--;)n=t(n,e[o],o,e);return n}function ct(e,t){for(var n=-1,i=e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function lt(e){for(var t=e.length,n=0;t--;)n+=+e[t]||0;return n}function ut(e,t){return"undefined"==typeof e?t:e}function ht(e,t,n,i){return"undefined"!=typeof e&&xr.call(i,n)?e:t}function dt(e,t,n){var i=ys(t);if(!n)return mt(t,e,i);for(var o=-1,r=i.length;++o<r;){var a=i[o],s=e[a],c=n(s,t[a],a,e,t);(c===c?c===s:s!==s)&&("undefined"!=typeof s||a in e)||(e[a]=c)}return e}function pt(e,t){for(var n=-1,i=e.length,o=jn(i),r=t.length,a=fr(r);++n<r;){var s=t[n];o?(s=parseFloat(s),a[n]=Ln(s,i)?e[s]:C):a[n]=e[s]}return a}function mt(e,t,n){n||(n=t,t={});for(var i=-1,o=n.length;++i<o;){var r=n[i];t[r]=e[r]}return t}function ft(e,t,n){var i=typeof e;return"function"==i?"undefined"==typeof t?e:Xt(e,t,n):null==e?nr:"object"==i?Ot(e):"undefined"==typeof t?Pt(e+""):kt(e+"",t)}function gt(e,t,n,i,o,r,a){var s;if(n&&(s=o?n(e,i,o):n(e)),"undefined"!=typeof s)return s;if(!po(e))return e;var c=as(e);if(c){if(s=On(e),!t)return Xe(e,s)}else{var l=kr.call(e),u=l==X;if(l!=Q&&l!=G&&(!u||o))return Be[l]?Nn(e,l,t):o?e:{};if(s=kn(u?{}:e),!t)return mt(e,s,ys(e))}r||(r=[]),a||(a=[]);for(var h=r.length;h--;)if(r[h]==e)return a[h];return r.push(e),a.push(s),(c?Ze:Ct)(e,function(i,o){s[o]=gt(i,t,n,o,e,r,a)}),s}function vt(e,t,n){if("function"!=typeof e)throw new wr(V);return Gr(function(){e.apply(C,n)},t)}function yt(e,t){var n=e?e.length:0,i=[];if(!n)return i;var o=-1,a=Mn(),s=a==r,c=s&&t.length>=200?Ta(t):null,l=t.length;c&&(a=Ke,s=!1,t=c);e:for(;++o<n;){var u=e[o];if(s&&u===u){for(var h=l;h--;)if(t[h]===u)continue e;i.push(u)}else a(t,u,0)<0&&i.push(u)}return i}function _t(e,t){var n=!0;return va(e,function(e,i,o){return n=!!t(e,i,o)}),n}function Et(e,t,n,i){var o=e.length;for(n=null==n?0:+n||0,0>n&&(n=-n>o?0:o+n),i="undefined"==typeof i||i>o?o:+i||0,0>i&&(i+=o),o=n>i?0:i>>>0,n>>>=0;o>n;)e[n++]=t;return e}function bt(e,t){var n=[];return va(e,function(e,i,o){t(e,i,o)&&n.push(e)}),n}function Tt(e,t,n,i){var o;return n(e,function(e,n,r){return t(e,n,r)?(o=i?n:e,!1):void 0}),o}function St(e,t,n){for(var i=-1,o=e.length,r=-1,a=[];++i<o;){var s=e[i];if(v(s)&&jn(s.length)&&(as(s)||ro(s))){t&&(s=St(s,t,n));var c=-1,l=s.length;for(a.length+=l;++c<l;)a[++r]=s[c]}else n||(a[++r]=s)}return a}function wt(e,t){return _a(e,t,Io)}function Ct(e,t){return _a(e,t,ys)}function Rt(e,t){return Ea(e,t,ys)}function At(e,t){for(var n=-1,i=t.length,o=-1,r=[];++n<i;){var a=t[n];cs(e[a])&&(r[++o]=a)}return r}function Dt(e,t,n,i,o,r){if(e===t)return 0!==e||1/e==1/t;var a=typeof e,s=typeof t;return"function"!=a&&"object"!=a&&"function"!=s&&"object"!=s||null==e||null==t?e!==e&&t!==t:It(e,t,Dt,n,i,o,r)}function It(e,t,n,i,o,r,a){var s=as(e),c=as(t),l=q,u=q;s||(l=kr.call(e),l==G?l=Q:l!=Q&&(s=bo(e))),c||(u=kr.call(t),u==G?u=Q:u!=Q&&(c=bo(t)));var h=l==Q||o&&l==X,d=u==Q||o&&u==X,p=l==u;if(p&&!s&&!h)return Rn(e,t,l);if(o){if(!(p||h&&d))return!1}else{var m=h&&xr.call(e,"__wrapped__"),f=d&&xr.call(t,"__wrapped__");if(m||f)return n(m?e.value():e,f?t.value():t,i,o,r,a);if(!p)return!1}r||(r=[]),a||(a=[]);for(var g=r.length;g--;)if(r[g]==e)return a[g]==t;r.push(e),a.push(t);var v=(s?Cn:An)(e,t,n,i,o,r,a);return r.pop(),a.pop(),v}function Mt(e,t,n,i,o){for(var r=-1,a=t.length,s=!o;++r<a;)if(s&&i[r]?n[r]!==e[t[r]]:!(t[r]in e))return!1;for(r=-1;++r<a;){var c=t[r],l=e[c],u=n[r];if(s&&i[r])var h="undefined"!=typeof l||c in e;else h=o?o(l,u,c):C,"undefined"==typeof h&&(h=Dt(u,l,o,!0));if(!h)return!1}return!0}function xt(e,t){var n=[];return va(e,function(e,i,o){n.push(t(e,i,o))}),n}function Ot(e){var t=ys(e),n=t.length;if(!n)return tr(!0);if(1==n){var i=t[0],o=e[i];if(Bn(o))return function(e){return null!=e&&e[i]===o&&("undefined"!=typeof o||i in Yn(e))}}for(var r=fr(n),a=fr(n);n--;)o=e[t[n]],r[n]=o,a[n]=Bn(o);return function(e){return null!=e&&Mt(Yn(e),t,r,a)}}function kt(e,t){return Bn(t)?function(n){return null!=n&&n[e]===t&&("undefined"!=typeof t||e in Yn(n))}:function(n){return null!=n&&Dt(t,n[e],null,!0)}}function Nt(e,t,n,i,o){if(!po(e))return e;var r=jn(t.length)&&(as(t)||bo(t));return(r?Ze:Ct)(t,function(t,a,s){if(v(t))return i||(i=[]),o||(o=[]),Lt(e,s,a,Nt,n,i,o);var c=e[a],l=n?n(c,t,a,e,s):C,u="undefined"==typeof l;u&&(l=t),!r&&"undefined"==typeof l||!u&&(l===l?l===c:c!==c)||(e[a]=l)}),e}function Lt(e,t,n,i,o,r,a){for(var s=r.length,c=t[n];s--;)if(r[s]==c)return void(e[n]=a[s]);var l=e[n],u=o?o(l,c,n,e,t):C,h="undefined"==typeof u;h&&(u=c,jn(c.length)&&(as(c)||bo(c))?u=as(l)?l:l&&l.length?Xe(l):[]:ls(c)||ro(c)?u=ro(l)?wo(l):ls(l)?l:{}:h=!1),r.push(c),a.push(u),h?e[n]=i(u,c,o,r,a):(u===u?u!==l:l===l)&&(e[n]=u)}function Pt(e){return function(t){return null==t?C:t[e]}}function Ut(e,t){return e+Hr(ra()*(t-e+1))}function jt(e,t,n,i,o){return o(e,function(e,o,r){n=i?(i=!1,e):t(n,e,o,r)}),n}function Bt(e,t,n){var i=-1,o=e.length;t=null==t?0:+t||0,0>t&&(t=-t>o?0:o+t),n="undefined"==typeof n||n>o?o:+n||0,0>n&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var r=fr(o);++i<o;)r[i]=e[i+t];return r}function Ht(e,t){var n;return va(e,function(e,i,o){return n=t(e,i,o),!n}),!!n}function zt(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function Ft(e,t,n){var i=-1,o=e.length,r=jn(o)?fr(o):[];return va(e,function(e){for(var n=t.length,o=fr(n);n--;)o[n]=null==e?C:e[t[n]];r[++i]={criteria:o,index:i,value:e}}),zt(r,function(e,t){return d(e,t,n)})}function Vt(e,t){var n=0;return va(e,function(e,i,o){n+=+t(e,i,o)||0}),n}function Wt(e,t){var n=-1,i=Mn(),o=e.length,a=i==r,s=a&&o>=200,c=s?Ta():null,l=[];c?(i=Ke,a=!1):(s=!1,c=t?[]:l);e:for(;++n<o;){var u=e[n],h=t?t(u,n,e):u;if(a&&u===u){for(var d=c.length;d--;)if(c[d]===h)continue e;t&&c.push(h),l.push(u)}else i(c,h,0)<0&&((t||s)&&c.push(h),l.push(u))}return l}function Gt(e,t){for(var n=-1,i=t.length,o=fr(i);++n<i;)o[n]=e[t[n]];return o}function qt(e,t,n,i){for(var o=e.length,r=i?o:-1;(i?r--:++r<o)&&t(e[r],r,e););return n?Bt(e,i?0:r,i?r+1:o):Bt(e,i?r+1:0,i?o:r)}function Yt(e,t){var n=e;n instanceof Z&&(n=n.value());for(var i=-1,o=t.length;++i<o;){var r=[n],a=t[i];Fr.apply(r,a.args),n=a.func.apply(a.thisArg,r)}return n}function Kt(e,t,n){var i=0,o=e?e.length:i;if("number"==typeof t&&t===t&&ua>=o){for(;o>i;){var r=i+o>>>1,a=e[r];(n?t>=a:t>a)?i=r+1:o=r}return o}return $t(e,t,nr,n)}function $t(e,t,n,i){t=n(t);for(var o=0,r=e?e.length:0,a=t!==t,s="undefined"==typeof t;r>o;){var c=Hr((o+r)/2),l=n(e[c]),u=l===l;if(a)var h=u||i;else h=s?u&&(i||"undefined"!=typeof l):i?t>=l:t>l;h?o=c+1:r=c}return ta(r,la)}function Xt(e,t,n){if("function"!=typeof e)return nr;if("undefined"==typeof t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,o){return e.call(t,n,i,o)};case 4:return function(n,i,o,r){return e.call(t,n,i,o,r)};case 5:return function(n,i,o,r,a){return e.call(t,n,i,o,r,a)}}return function(){return e.apply(t,arguments)}}function Zt(e){return Ur.call(e,0)}function Jt(e,t,n){for(var i=n.length,o=-1,r=ea(e.length-i,0),a=-1,s=t.length,c=fr(r+s);++a<s;)c[a]=t[a];for(;++o<i;)c[n[o]]=e[o];for(;r--;)c[a++]=e[o++];return c}function Qt(e,t,n){for(var i=-1,o=n.length,r=-1,a=ea(e.length-o,0),s=-1,c=t.length,l=fr(a+c);++r<a;)l[r]=e[r];for(var u=r;++s<c;)l[u+s]=t[s];for(;++i<o;)l[u+n[i]]=e[r++];return l}function en(e,t){return function(n,i,o){var r=t?t():{};if(i=In(i,o,3),as(n))for(var a=-1,s=n.length;++a<s;){var c=n[a];e(r,c,i(c,a,n),n)}else va(n,function(t,n,o){e(r,t,i(t,n,o),o)});return r}}function tn(e){return function(){var t=arguments,n=t.length,i=t[0];if(2>n||null==i)return i;var o=t[n-2],r=t[n-1],a=t[3];n>3&&"function"==typeof o?(o=Xt(o,r,5),n-=2):(o=n>2&&"function"==typeof r?r:null,n-=o?1:0),a&&Pn(t[1],t[2],a)&&(o=3==n?null:o,n=2);for(var s=0;++s<n;){var c=t[s];c&&e(i,c,o)}return i}}function nn(e,t){return function(n,i){var o=n?n.length:0;if(!jn(o))return e(n,i);for(var r=t?o:-1,a=Yn(n);(t?r--:++r<o)&&i(a[r],r,a)!==!1;);return n}}function on(e){return function(t,n,i){for(var o=Yn(t),r=i(t),a=r.length,s=e?a:-1;e?s--:++s<a;){var c=r[s];if(n(o[c],c,o)===!1)break}return t}}function rn(e,t){function n(){var o=this&&this!==Je&&this instanceof n?i:e;return o.apply(t,arguments)}var i=sn(e);return n}function an(e){return function(t){for(var n=-1,i=Qo(Bo(t)),o=i.length,r="";++n<o;)r=e(r,i[n],n);return r}}function sn(e){return function(){var t=ga(e.prototype),n=e.apply(t,arguments);return po(n)?n:t}}function cn(e){function t(n,i,o){o&&Pn(n,i,o)&&(i=null);var r=wn(n,e,null,null,null,null,null,i);return r.placeholder=t.placeholder,r}return t}function ln(e,t){return function(n,i,o){o&&Pn(n,i,o)&&(i=null);var r=In(),a=null==i;if(r===ft&&a||(a=!1,i=r(i,o,3)),a){var s=as(n);if(s||!Eo(n))return e(s?n:qn(n));i=c}return Dn(n,i,t)}}function un(e,t){return function(n,i,r){if(i=In(i,r,3),as(n)){var a=o(n,i,t);return a>-1?n[a]:C}return Tt(n,i,e)}}function hn(e){return function(t,n,i){return t&&t.length?(n=In(n,i,3),o(t,n,e)):-1}}function dn(e){return function(t,n,i){return n=In(n,i,3),Tt(t,n,e,!0)}}function pn(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};for(var n,i=e?t:-1,o=0,r=fr(t);e?i--:++i<t;){var a=r[o++]=arguments[i];if("function"!=typeof a)throw new wr(V);var s=n?"":wa(a);n="wrapper"==s?new y([]):n}for(i=n?-1:t;++i<t;){a=r[i],s=wa(a);var c="wrapper"==s?Sa(a):null;n=c&&Un(c[0])?n[wa(c[0])].apply(n,c[3]):1==a.length&&Un(a)?n[s]():n.thru(a)}return function(){var e=arguments;if(n&&1==e.length&&as(e[0]))return n.plant(e[0]).value();for(var i=0,o=r[i].apply(this,e);++i<t;)o=r[i].call(this,o);return o}}}function mn(e,t){return function(n,i,o){return"function"==typeof i&&"undefined"==typeof o&&as(n)?e(n,i):t(n,Xt(i,o,3))}}function fn(e){return function(t,n,i){return("function"!=typeof n||"undefined"!=typeof i)&&(n=Xt(n,i,3)),e(t,n,Io)}}function gn(e){return function(t,n,i){return("function"!=typeof n||"undefined"!=typeof i)&&(n=Xt(n,i,3)),e(t,n)}}function vn(e){return function(t,n,i){return t=s(t),t&&(e?t:"")+bn(t,n,i)+(e?"":t)}}function yn(e){var t=Qi(function(n,i){var o=_(i,t.placeholder);return wn(n,e,null,i,o)});return t}function _n(e,t){return function(n,i,o,r){var a=arguments.length<3;return"function"==typeof i&&"undefined"==typeof r&&as(n)?e(n,i,o,a):jt(n,In(i,r,4),o,a,t)}}function En(e,t,n,i,o,r,a,s,c,l){function u(){for(var E=arguments.length,b=E,T=fr(E);b--;)T[b]=arguments[b];if(i&&(T=Jt(T,i,o)),r&&(T=Qt(T,r,a)),m||g){var S=u.placeholder,w=_(T,S);if(E-=w.length,l>E){var R=s?Xe(s):null,I=ea(l-E,0),M=m?w:null,x=m?null:w,N=m?T:null,L=m?null:T;t|=m?O:k,t&=~(m?k:O),f||(t&=~(A|D));var P=[e,t,n,N,M,L,x,R,c,I],U=En.apply(C,P);return Un(e)&&Ca(U,P),U.placeholder=S,U}}var j=d?n:this;p&&(e=j[y]),s&&(T=Vn(T,s)),h&&c<T.length&&(T.length=c);var B=this&&this!==Je&&this instanceof u?v||sn(e):e;return B.apply(j,T)}var h=t&N,d=t&A,p=t&D,m=t&M,f=t&I,g=t&x,v=!p&&sn(e),y=e;return u}function bn(e,t,n){var i=e.length;if(t=+t,i>=t||!Jr(t))return"";var o=t-i;return n=null==n?" ":n+"",Go(n,jr(o/n.length)).slice(0,o)}function Tn(e,t,n,i){function o(){for(var t=-1,s=arguments.length,c=-1,l=i.length,u=fr(s+l);++c<l;)u[c]=i[c];for(;s--;)u[c++]=arguments[++t];var h=this&&this!==Je&&this instanceof o?a:e;return h.apply(r?n:this,u)}var r=t&A,a=sn(e);return o}function Sn(e){return function(t,n,i,o){var r=In(i);return r===ft&&null==i?Kt(t,n,e):$t(t,n,r(i,o,1),e)}}function wn(e,t,n,i,o,r,a,s){var c=t&D;if(!c&&"function"!=typeof e)throw new wr(V);var l=i?i.length:0;if(l||(t&=~(O|k),i=o=null),l-=o?o.length:0,t&k){var u=i,h=o;i=o=null}var d=c?null:Sa(e),p=[e,t,n,i,o,u,h,r,a,s];if(d&&(Hn(p,d),t=p[1],s=p[9]),p[9]=null==s?c?0:e.length:ea(s-l,0)||0,t==A)var m=rn(p[0],p[2]);else m=t!=O&&t!=(A|O)||p[4].length?En.apply(C,p):Tn.apply(C,p);var f=d?ba:Ca;return f(m,p)}function Cn(e,t,n,i,o,r,a){var s=-1,c=e.length,l=t.length,u=!0;if(c!=l&&!(o&&l>c))return!1;for(;u&&++s<c;){var h=e[s],d=t[s];if(u=C,i&&(u=o?i(d,h,s):i(h,d,s)),"undefined"==typeof u)if(o)for(var p=l;p--&&(d=t[p],!(u=h&&h===d||n(h,d,i,o,r,a))););else u=h&&h===d||n(h,d,i,o,r,a)}return!!u}function Rn(e,t,n){switch(n){case Y:case K:return+e==+t;case $:return e.name==t.name&&e.message==t.message;case J:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case ee:case ne:return e==t+""}return!1}function An(e,t,n,i,o,r,a){var s=ys(e),c=s.length,l=ys(t),u=l.length;if(c!=u&&!o)return!1;
for(var h=o,d=-1;++d<c;){var p=s[d],m=o?p in t:xr.call(t,p);if(m){var f=e[p],g=t[p];m=C,i&&(m=o?i(g,f,p):i(f,g,p)),"undefined"==typeof m&&(m=f&&f===g||n(f,g,i,o,r,a))}if(!m)return!1;h||(h="constructor"==p)}if(!h){var v=e.constructor,y=t.constructor;if(v!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y))return!1}return!0}function Dn(e,t,n){var i=n?sa:aa,o=i,r=o;return va(e,function(e,a,s){var c=t(e,a,s);((n?o>c:c>o)||c===i&&c===r)&&(o=c,r=e)}),r}function In(e,n,i){var o=t.callback||er;return o=o===er?ft:o,i?o(e,n,i):o}function Mn(e,n,i){var o=t.indexOf||ri;return o=o===ri?r:o,e?o(e,n,i):o}function xn(e,t,n){for(var i=-1,o=n?n.length:0;++i<o;){var r=n[i],a=r.size;switch(r.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=ta(t,e+a);break;case"takeRight":e=ea(e,t-a)}}return{start:e,end:t}}function On(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&xr.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function kn(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=br),new t}function Nn(e,t,n){var i=e.constructor;switch(t){case oe:return Zt(e);case Y:case K:return new i(+e);case re:case ae:case se:case ce:case le:case ue:case he:case de:case pe:var o=e.buffer;return new i(n?Zt(o):o,e.byteOffset,e.length);case J:case ne:return new i(e);case ee:var r=new i(e.source,Re.exec(e));r.lastIndex=e.lastIndex}return r}function Ln(e,t){return e=+e,t=null==t?da:t,e>-1&&e%1==0&&t>e}function Pn(e,t,n){if(!po(n))return!1;var i=typeof t;if("number"==i)var o=n.length,r=jn(o)&&Ln(t,o);else r="string"==i&&t in n;if(r){var a=n[t];return e===e?e===a:a!==a}return!1}function Un(e){var n=wa(e);return!!n&&e===t[n]&&n in Z.prototype}function jn(e){return"number"==typeof e&&e>-1&&e%1==0&&da>=e}function Bn(e){return e===e&&(0===e?1/e>0:!po(e))}function Hn(e,t){var n=e[1],i=t[1],o=n|i,r=N>o,a=i==N&&n==M||i==N&&n==L&&e[7].length<=t[8]||i==(N|L)&&n==M;if(!r&&!a)return e;i&A&&(e[2]=t[2],o|=n&A?0:I);var s=t[3];if(s){var c=e[3];e[3]=c?Jt(c,s,t[4]):Xe(s),e[4]=c?_(e[3],W):Xe(t[4])}return s=t[5],s&&(c=e[5],e[5]=c?Qt(c,s,t[6]):Xe(s),e[6]=c?_(e[5],W):Xe(t[6])),s=t[7],s&&(e[7]=Xe(s)),i&N&&(e[8]=null==e[8]?t[8]:ta(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function zn(e,t){e=Yn(e);for(var n=-1,i=t.length,o={};++n<i;){var r=t[n];r in e&&(o[r]=e[r])}return o}function Fn(e,t){var n={};return wt(e,function(e,i,o){t(e,i,o)&&(n[i]=e)}),n}function Vn(e,t){for(var n=e.length,i=ta(t.length,n),o=Xe(e);i--;){var r=t[i];e[i]=Ln(r,n)?o[r]:C}return e}function Wn(e){{var n;t.support}if(!v(e)||kr.call(e)!=Q||!xr.call(e,"constructor")&&(n=e.constructor,"function"==typeof n&&!(n instanceof n)))return!1;var i;return wt(e,function(e,t){i=t}),"undefined"==typeof i||xr.call(e,i)}function Gn(e){for(var n=Io(e),i=n.length,o=i&&e.length,r=t.support,a=o&&jn(o)&&(as(e)||r.nonEnumArgs&&ro(e)),s=-1,c=[];++s<i;){var l=n[s];(a&&Ln(l,o)||xr.call(e,l))&&c.push(l)}return c}function qn(e){return null==e?[]:jn(e.length)?po(e)?e:br(e):No(e)}function Yn(e){return po(e)?e:br(e)}function Kn(e){return e instanceof Z?e.clone():new y(e.__wrapped__,e.__chain__,Xe(e.__actions__))}function $n(e,t,n){t=(n?Pn(e,t,n):null==t)?1:ea(+t||1,1);for(var i=0,o=e?e.length:0,r=-1,a=fr(jr(o/t));o>i;)a[++r]=Bt(e,i,i+=t);return a}function Xn(e){for(var t=-1,n=e?e.length:0,i=-1,o=[];++t<n;){var r=e[t];r&&(o[++i]=r)}return o}function Zn(e,t,n){var i=e?e.length:0;return i?((n?Pn(e,t,n):null==t)&&(t=1),Bt(e,0>t?0:t)):[]}function Jn(e,t,n){var i=e?e.length:0;return i?((n?Pn(e,t,n):null==t)&&(t=1),t=i-(+t||0),Bt(e,0,0>t?0:t)):[]}function Qn(e,t,n){return e&&e.length?qt(e,In(t,n,3),!0,!0):[]}function ei(e,t,n){return e&&e.length?qt(e,In(t,n,3),!0):[]}function ti(e,t,n,i){var o=e?e.length:0;return o?(n&&"number"!=typeof n&&Pn(e,t,n)&&(n=0,i=o),Et(e,t,n,i)):[]}function ni(e){return e?e[0]:C}function ii(e,t,n){var i=e?e.length:0;return n&&Pn(e,t,n)&&(t=!1),i?St(e,t):[]}function oi(e){var t=e?e.length:0;return t?St(e,!0):[]}function ri(e,t,n){var i=e?e.length:0;if(!i)return-1;if("number"==typeof n)n=0>n?ea(i+n,0):n;else if(n){var o=Kt(e,t),a=e[o];return(t===t?t===a:a!==a)?o:-1}return r(e,t,n||0)}function ai(e){return Jn(e,1)}function si(){for(var e=[],t=-1,n=arguments.length,i=[],o=Mn(),a=o==r;++t<n;){var s=arguments[t];(as(s)||ro(s))&&(e.push(s),i.push(a&&s.length>=120?Ta(t&&s):null))}n=e.length;var c=e[0],l=-1,u=c?c.length:0,h=[],d=i[0];e:for(;++l<u;)if(s=c[l],(d?Ke(d,s):o(h,s,0))<0){for(t=n;--t;){var p=i[t];if((p?Ke(p,s):o(e[t],s,0))<0)continue e}d&&d.push(s),h.push(s)}return h}function ci(e){var t=e?e.length:0;return t?e[t-1]:C}function li(e,t,n){var i=e?e.length:0;if(!i)return-1;var o=i;if("number"==typeof n)o=(0>n?ea(i+n,0):ta(n||0,i-1))+1;else if(n){o=Kt(e,t,!0)-1;var r=e[o];return(t===t?t===r:r!==r)?o:-1}if(t!==t)return g(e,o,!0);for(;o--;)if(e[o]===t)return o;return-1}function ui(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var n=0,i=Mn(),o=e.length;++n<o;)for(var r=0,a=e[n];(r=i(t,a,r))>-1;)qr.call(t,r,1);return t}function hi(e,t,n){var i=-1,o=e?e.length:0,r=[];for(t=In(t,n,3);++i<o;){var a=e[i];t(a,i,e)&&(r.push(a),qr.call(e,i--,1),o--)}return r}function di(e){return Zn(e,1)}function pi(e,t,n){var i=e?e.length:0;return i?(n&&"number"!=typeof n&&Pn(e,t,n)&&(t=0,n=i),Bt(e,t,n)):[]}function mi(e,t,n){var i=e?e.length:0;return i?((n?Pn(e,t,n):null==t)&&(t=1),Bt(e,0,0>t?0:t)):[]}function fi(e,t,n){var i=e?e.length:0;return i?((n?Pn(e,t,n):null==t)&&(t=1),t=i-(+t||0),Bt(e,0>t?0:t)):[]}function gi(e,t,n){return e&&e.length?qt(e,In(t,n,3),!1,!0):[]}function vi(e,t,n){return e&&e.length?qt(e,In(t,n,3)):[]}function yi(e,t,n,i){var o=e?e.length:0;if(!o)return[];null!=t&&"boolean"!=typeof t&&(i=n,n=Pn(e,t,i)?null:t,t=!1);var a=In();return(a!==ft||null!=n)&&(n=a(n,i,3)),t&&Mn()==r?E(e,n):Wt(e,n)}function _i(e){for(var t=-1,n=(e&&e.length&&ot(it(e,Mr)))>>>0,i=fr(n);++t<n;)i[t]=it(e,Pt(t));return i}function Ei(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(as(n)||ro(n))var i=i?yt(i,n).concat(yt(n,i)):n}return i?Wt(i):[]}function bi(e,t){var n=-1,i=e?e.length:0,o={};for(!i||t||as(e[0])||(t=[]);++n<i;){var r=e[n];t?o[r]=t[n]:r&&(o[r[0]]=r[1])}return o}function Ti(e){var n=t(e);return n.__chain__=!0,n}function Si(e,t,n){return t.call(n,e),e}function wi(e,t,n){return t.call(n,e)}function Ci(){return Ti(this)}function Ri(){return new y(this.value(),this.__chain__)}function Ai(e){for(var t,i=this;i instanceof n;){var o=Kn(i);t?r.__wrapped__=o:t=o;var r=o;i=i.__wrapped__}return r.__wrapped__=e,t}function Di(){var e=this.__wrapped__;return e instanceof Z?(this.__actions__.length&&(e=new Z(this)),new y(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})}function Ii(){return this.value()+""}function Mi(){return Yt(this.__wrapped__,this.__actions__)}function xi(e,t,n){var i=as(e)?tt:_t;return n&&Pn(e,t,n)&&(t=null),("function"!=typeof t||"undefined"!=typeof n)&&(t=In(t,n,3)),i(e,t)}function Oi(e,t,n){var i=as(e)?nt:bt;return t=In(t,n,3),i(e,t)}function ki(e,t){return Ua(e,Ot(t))}function Ni(e,t,n,i){var o=e?e.length:0;return jn(o)||(e=No(e),o=e.length),o?(n="number"!=typeof n||i&&Pn(t,n,i)?0:0>n?ea(o+n,0):n||0,"string"==typeof e||!as(e)&&Eo(e)?o>n&&e.indexOf(t,n)>-1:Mn(e,t,n)>-1):!1}function Li(e,t,n){var i=as(e)?it:xt;return t=In(t,n,3),i(e,t)}function Pi(e,t){return Li(e,Pt(t))}function Ui(e,t,n){var i=as(e)?nt:bt;return t=In(t,n,3),i(e,function(e,n,i){return!t(e,n,i)})}function ji(e,t,n){if(n?Pn(e,t,n):null==t){e=qn(e);var i=e.length;return i>0?e[Ut(0,i-1)]:C}var o=Bi(e);return o.length=ta(0>t?0:+t||0,o.length),o}function Bi(e){e=qn(e);for(var t=-1,n=e.length,i=fr(n);++t<n;){var o=Ut(0,t);t!=o&&(i[t]=i[o]),i[o]=e[t]}return i}function Hi(e){var t=e?e.length:0;return jn(t)?t:ys(e).length}function zi(e,t,n){var i=as(e)?ct:Ht;return n&&Pn(e,t,n)&&(t=null),("function"!=typeof t||"undefined"!=typeof n)&&(t=In(t,n,3)),i(e,t)}function Fi(e,t,n){if(null==e)return[];var i=-1,o=e.length,r=jn(o)?fr(o):[];return n&&Pn(e,t,n)&&(t=null),t=In(t,n,3),va(e,function(e,n,o){r[++i]={criteria:t(e,n,o),index:i,value:e}}),zt(r,h)}function Vi(){var e=arguments,t=e[0],n=e[3],i=0,o=e.length-1;if(null==t)return[];for(var r=fr(o);o>i;)r[i]=e[++i];return n&&Pn(e[1],e[2],n)&&(r=e[1]),Ft(t,St(r),[])}function Wi(e,t,n,i){return null==e?[]:(i&&Pn(t,n,i)&&(n=null),as(t)||(t=null==t?[]:[t]),as(n)||(n=null==n?[]:[n]),Ft(e,t,n))}function Gi(e,t){return Oi(e,Ot(t))}function qi(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new wr(V);var n=e;e=t,t=n}return e=Jr(e=+e)?e:0,function(){return--e<1?t.apply(this,arguments):void 0}}function Yi(e,t,n){return n&&Pn(e,t,n)&&(t=null),t=e&&null==t?e.length:ea(+t||0,0),wn(e,N,null,null,null,null,t)}function Ki(e,t){var n;if("function"!=typeof t){if("function"!=typeof e)throw new wr(V);var i=e;e=t,t=i}return function(){return--e>0?n=t.apply(this,arguments):t=null,n}}function $i(e,t,n){function i(){d&&Br(d),c&&Br(c),c=d=p=C}function o(){var n=t-(Ya()-u);if(0>=n||n>t){c&&Br(c);var i=p;c=d=p=C,i&&(m=Ya(),l=e.apply(h,s),d||c||(s=h=null))}else d=Gr(o,n)}function r(){d&&Br(d),c=d=p=C,(g||f!==t)&&(m=Ya(),l=e.apply(h,s),d||c||(s=h=null))}function a(){if(s=arguments,u=Ya(),h=this,p=g&&(d||!v),f===!1)var n=v&&!d;else{c||v||(m=u);var i=f-(u-m),a=0>=i||i>f;a?(c&&(c=Br(c)),m=u,l=e.apply(h,s)):c||(c=Gr(r,i))}return a&&d?d=Br(d):d||t===f||(d=Gr(o,t)),n&&(a=!0,l=e.apply(h,s)),!a||d||c||(s=h=null),l}var s,c,l,u,h,d,p,m=0,f=!1,g=!0;if("function"!=typeof e)throw new wr(V);if(t=0>t?0:+t||0,n===!0){var v=!0;g=!1}else po(n)&&(v=n.leading,f="maxWait"in n&&ea(+n.maxWait||0,t),g="trailing"in n?n.trailing:g);return a.cancel=i,a}function Xi(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new wr(V);var n=function(){var i=arguments,o=n.cache,r=t?t.apply(this,i):i[0];if(o.has(r))return o.get(r);var a=e.apply(this,i);return o.set(r,a),a};return n.cache=new Xi.Cache,n}function Zi(e){if("function"!=typeof e)throw new wr(V);return function(){return!e.apply(this,arguments)}}function Ji(e){return Ki(e,2)}function Qi(e,t){if("function"!=typeof e)throw new wr(V);return t=ea("undefined"==typeof t?e.length-1:+t||0,0),function(){for(var n=arguments,i=-1,o=ea(n.length-t,0),r=fr(o);++i<o;)r[i]=n[t+i];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,n[0],r);case 2:return e.call(this,n[0],n[1],r)}var a=fr(t+1);for(i=-1;++i<t;)a[i]=n[i];return a[t]=r,e.apply(this,a)}}function eo(e){if("function"!=typeof e)throw new wr(V);return function(t){return e.apply(this,t)}}function to(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new wr(V);return n===!1?i=!1:po(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),He.leading=i,He.maxWait=+t,He.trailing=o,$i(e,t,He)}function no(e,t){return t=null==t?nr:t,wn(t,O,null,[e],[])}function io(e,t,n,i){return t&&"boolean"!=typeof t&&Pn(e,t,n)?t=!1:"function"==typeof t&&(i=n,n=t,t=!1),n="function"==typeof n&&Xt(n,i,1),gt(e,t,n)}function oo(e,t,n){return t="function"==typeof t&&Xt(t,n,1),gt(e,!0,t)}function ro(e){var t=v(e)?e.length:C;return jn(t)&&kr.call(e)==G}function ao(e){return e===!0||e===!1||v(e)&&kr.call(e)==Y}function so(e){return v(e)&&kr.call(e)==K}function co(e){return!!e&&1===e.nodeType&&v(e)&&kr.call(e).indexOf("Element")>-1}function lo(e){if(null==e)return!0;var t=e.length;return jn(t)&&(as(e)||Eo(e)||ro(e)||v(e)&&cs(e.splice))?!t:!ys(e).length}function uo(e,t,n,i){if(n="function"==typeof n&&Xt(n,i,3),!n&&Bn(e)&&Bn(t))return e===t;var o=n?n(e,t):C;return"undefined"==typeof o?Dt(e,t,n):!!o}function ho(e){return v(e)&&"string"==typeof e.message&&kr.call(e)==$}function po(e){var t=typeof e;return"function"==t||!!e&&"object"==t}function mo(e,t,n,i){var o=ys(t),r=o.length;if(!r)return!0;if(null==e)return!1;if(n="function"==typeof n&&Xt(n,i,3),!n&&1==r){var a=o[0],s=t[a];if(Bn(s))return s===e[a]&&("undefined"!=typeof s||a in Yn(e))}for(var c=fr(r),l=fr(r);r--;)s=c[r]=t[o[r]],l[r]=Bn(s);return Mt(Yn(e),o,c,l,n)}function fo(e){return yo(e)&&e!=+e}function go(e){return null==e?!1:kr.call(e)==X?Lr.test(Ir.call(e)):v(e)&&De.test(e)}function vo(e){return null===e}function yo(e){return"number"==typeof e||v(e)&&kr.call(e)==J}function _o(e){return v(e)&&kr.call(e)==ee||!1}function Eo(e){return"string"==typeof e||v(e)&&kr.call(e)==ne}function bo(e){return v(e)&&jn(e.length)&&!!je[kr.call(e)]}function To(e){return"undefined"==typeof e}function So(e){var t=e?e.length:0;return jn(t)?t?Xe(e):[]:No(e)}function wo(e){return mt(e,Io(e))}function Co(e,t,n){var i=ga(e);return n&&Pn(e,t,n)&&(t=null),t?mt(t,i,ys(t)):i}function Ro(e){return At(e,Io(e))}function Ao(e,t){return e?xr.call(e,t):!1}function Do(e,t,n){n&&Pn(e,t,n)&&(t=null);for(var i=-1,o=ys(e),r=o.length,a={};++i<r;){var s=o[i],c=e[s];t?xr.call(a,c)?a[c].push(s):a[c]=[s]:a[c]=s}return a}function Io(e){if(null==e)return[];po(e)||(e=br(e));var t=e.length;t=t&&jn(t)&&(as(e)||fa.nonEnumArgs&&ro(e))&&t||0;for(var n=e.constructor,i=-1,o="function"==typeof n&&n.prototype===e,r=fr(t),a=t>0;++i<t;)r[i]=i+"";for(var s in e)a&&Ln(s,t)||"constructor"==s&&(o||!xr.call(e,s))||r.push(s);return r}function Mo(e,t,n){var i={};return t=In(t,n,3),Ct(e,function(e,n,o){i[n]=t(e,n,o)}),i}function xo(e){for(var t=-1,n=ys(e),i=n.length,o=fr(i);++t<i;){var r=n[t];o[t]=[r,e[r]]}return o}function Oo(e,t,n){var i=null==e?C:e[t];return"undefined"==typeof i&&(i=n),cs(i)?i.call(e):i}function ko(e,t,n,i){var o=as(e)||bo(e);if(t=In(t,i,4),null==n)if(o||po(e)){var r=e.constructor;n=o?as(e)?new r:[]:ga(cs(r)&&r.prototype)}else n={};return(o?Ze:Ct)(e,function(e,i,o){return t(n,e,i,o)}),n}function No(e){return Gt(e,ys(e))}function Lo(e){return Gt(e,Io(e))}function Po(e,t,n){return t=+t||0,"undefined"==typeof n?(n=t,t=0):n=+n||0,e>=t&&n>e}function Uo(e,t,n){n&&Pn(e,t,n)&&(t=n=null);var i=null==e,o=null==t;if(null==n&&(o&&"boolean"==typeof e?(n=e,e=1):"boolean"==typeof t&&(n=t,o=!0)),i&&o&&(t=1,o=!1),e=+e||0,o?(t=e,e=0):t=+t||0,n||e%1||t%1){var r=ra();return ta(e+r*(t-e+parseFloat("1e-"+((r+"").length-1))),t)}return Ut(e,t)}function jo(e){return e=s(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function Bo(e){return e=s(e),e&&e.replace(Ie,p).replace(we,"")}function Ho(e,t,n){e=s(e),t+="";var i=e.length;return n="undefined"==typeof n?i:ta(0>n?0:+n||0,i),n-=t.length,n>=0&&e.indexOf(t,n)==n}function zo(e){return e=s(e),e&&Ee.test(e)?e.replace(ye,m):e}function Fo(e){return e=s(e),e&&Oe.test(e)?e.replace(xe,"\\$&"):e}function Vo(e,t,n){e=s(e),t=+t;var i=e.length;if(i>=t||!Jr(t))return e;var o=(t-i)/2,r=Hr(o),a=jr(o);return n=bn("",a,n),n.slice(0,r)+e+n}function Wo(e,t,n){return n&&Pn(e,t,n)&&(t=0),oa(e,t)}function Go(e,t){var n="";if(e=s(e),t=+t,1>t||!e||!Jr(t))return n;do t%2&&(n+=e),t=Hr(t/2),e+=e;while(t);return n}function qo(e,t,n){return e=s(e),n=null==n?0:ta(0>n?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function Yo(e,n,i){var o=t.templateSettings;i&&Pn(e,n,i)&&(n=i=null),e=s(e),n=dt(dt({},i||n),o,ht);var r,a,c=dt(dt({},n.imports),o.imports,ht),l=ys(c),u=Gt(c,l),h=0,d=n.interpolate||Me,p="__p += '",m=Tr((n.escape||Me).source+"|"+d.source+"|"+(d===Se?Ce:Me).source+"|"+(n.evaluate||Me).source+"|$","g"),g="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++Ue+"]")+"\n";e.replace(m,function(t,n,i,o,s,c){return i||(i=o),p+=e.slice(h,c).replace(ke,f),n&&(r=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),i&&(p+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),h=c+t.length,t}),p+="';\n";var v=n.variable;v||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(me,""):p).replace(fe,"$1").replace(ge,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var y=Ds(function(){return yr(l,g+"return "+p).apply(C,u)});if(y.source=p,ho(y))throw y;return y}function Ko(e,t,n){var i=e;return(e=s(e))?(n?Pn(i,t,n):null==t)?e.slice(b(e),T(e)+1):(t+="",e.slice(l(e,t),u(e,t)+1)):e}function $o(e,t,n){var i=e;return e=s(e),e?e.slice((n?Pn(i,t,n):null==t)?b(e):l(e,t+"")):e}function Xo(e,t,n){var i=e;return e=s(e),e?(n?Pn(i,t,n):null==t)?e.slice(0,T(e)+1):e.slice(0,u(e,t+"")+1):e}function Zo(e,t,n){n&&Pn(e,t,n)&&(t=null);var i=P,o=U;if(null!=t)if(po(t)){var r="separator"in t?t.separator:r;i="length"in t?+t.length||0:i,o="omission"in t?s(t.omission):o}else i=+t||0;if(e=s(e),i>=e.length)return e;var a=i-o.length;if(1>a)return o;var c=e.slice(0,a);if(null==r)return c+o;if(_o(r)){if(e.slice(a).search(r)){var l,u,h=e.slice(0,a);for(r.global||(r=Tr(r.source,(Re.exec(r)||"")+"g")),r.lastIndex=0;l=r.exec(h);)u=l.index;c=c.slice(0,null==u?a:u)}}else if(e.indexOf(r,a)!=a){var d=c.lastIndexOf(r);d>-1&&(c=c.slice(0,d))}return c+o}function Jo(e){return e=s(e),e&&_e.test(e)?e.replace(ve,S):e}function Qo(e,t,n){return n&&Pn(e,t,n)&&(t=null),e=s(e),e.match(t||Ne)||[]}function er(e,t,n){return n&&Pn(e,t,n)&&(t=null),v(e)?ir(e):ft(e,t)}function tr(e){return function(){return e}}function nr(e){return e}function ir(e){return Ot(gt(e,!0))}function or(e,t){return kt(e+"",gt(t,!0))}function rr(e,t,n){if(null==n){var i=po(t),o=i&&ys(t),r=o&&o.length&&At(t,o);(r?r.length:i)||(r=!1,n=t,t=e,e=this)}r||(r=At(t,ys(t)));var a=!0,s=-1,c=cs(e),l=r.length;n===!1?a=!1:po(n)&&"chain"in n&&(a=n.chain);for(;++s<l;){var u=r[s],h=t[u];e[u]=h,c&&(e.prototype[u]=function(t){return function(){var n=this.__chain__;if(a||n){var i=e(this.__wrapped__),o=i.__actions__=Xe(this.__actions__);return o.push({func:t,args:arguments,thisArg:e}),i.__chain__=n,i}var r=[this.value()];return Fr.apply(r,arguments),t.apply(e,r)}}(h))}return e}function ar(){return e._=Nr,this}function sr(){}function cr(e){return Pt(e+"")}function lr(e){return function(t){return null==e?C:e[t]}}function ur(e,t,n){n&&Pn(e,t,n)&&(t=n=null),e=+e||0,n=null==n?1:+n||0,null==t?(t=e,e=0):t=+t||0;for(var i=-1,o=ea(jr((t-e)/(n||1)),0),r=fr(o);++i<o;)r[i]=e,e+=n;return r}function hr(e,t,n){if(e=+e,1>e||!Jr(e))return[];var i=-1,o=fr(ta(e,ca));for(t=Xt(t,n,1);++i<e;)ca>i?o[i]=t(i):t(i);return o}function dr(e){var t=++Or;return s(e)+t}function pr(e,t){return e+t}function mr(e,t,n){n&&Pn(e,t,n)&&(t=null);var i=In(),o=null==t;return i===ft&&o||(o=!1,t=i(t,n,3)),o?lt(as(e)?e:qn(e)):Vt(e,t)}e=e?Qe.defaults(Je.Object(),e,Qe.pick(Je,Pe)):Je;var fr=e.Array,gr=e.Date,vr=e.Error,yr=e.Function,_r=e.Math,Er=e.Number,br=e.Object,Tr=e.RegExp,Sr=e.String,wr=e.TypeError,Cr=fr.prototype,Rr=br.prototype,Ar=Sr.prototype,Dr=(Dr=e.window)&&Dr.document,Ir=yr.prototype.toString,Mr=Pt("length"),xr=Rr.hasOwnProperty,Or=0,kr=Rr.toString,Nr=e._,Lr=Tr("^"+Fo(kr).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pr=go(Pr=e.ArrayBuffer)&&Pr,Ur=go(Ur=Pr&&new Pr(0).slice)&&Ur,jr=_r.ceil,Br=e.clearTimeout,Hr=_r.floor,zr=go(zr=br.getPrototypeOf)&&zr,Fr=Cr.push,Vr=Rr.propertyIsEnumerable,Wr=go(Wr=e.Set)&&Wr,Gr=e.setTimeout,qr=Cr.splice,Yr=go(Yr=e.Uint8Array)&&Yr,Kr=go(Kr=e.WeakMap)&&Kr,$r=function(){try{var t=go(t=e.Float64Array)&&t,n=new t(new Pr(10),0,1)&&t}catch(i){}return n}(),Xr=go(Xr=fr.isArray)&&Xr,Zr=go(Zr=br.create)&&Zr,Jr=e.isFinite,Qr=go(Qr=br.keys)&&Qr,ea=_r.max,ta=_r.min,na=go(na=gr.now)&&na,ia=go(ia=Er.isFinite)&&ia,oa=e.parseInt,ra=_r.random,aa=Er.NEGATIVE_INFINITY,sa=Er.POSITIVE_INFINITY,ca=_r.pow(2,32)-1,la=ca-1,ua=ca>>>1,ha=$r?$r.BYTES_PER_ELEMENT:0,da=_r.pow(2,53)-1,pa=Kr&&new Kr,ma={},fa=t.support={};!function(e){fa.funcDecomp=/\bthis\b/.test(function(){return this}),fa.funcNames="string"==typeof yr.name;try{fa.dom=11===Dr.createDocumentFragment().nodeType}catch(t){fa.dom=!1}try{fa.nonEnumArgs=!Vr.call(arguments,1)}catch(t){fa.nonEnumArgs=!0}}(0,0),t.templateSettings={escape:be,evaluate:Te,interpolate:Se,variable:"",imports:{_:t}};var ga=function(){function t(){}return function(n){if(po(n)){t.prototype=n;var i=new t;t.prototype=null}return i||e.Object()}}(),va=nn(Ct),ya=nn(Rt,!0),_a=on(),Ea=on(!0),ba=pa?function(e,t){return pa.set(e,t),e}:nr;Ur||(Zt=Pr&&Yr?function(e){var t=e.byteLength,n=$r?Hr(t/ha):0,i=n*ha,o=new Pr(t);if(n){var r=new $r(o,0,n);r.set(new $r(e,0,n))}return t!=i&&(r=new Yr(o,i),r.set(new Yr(e,i))),o}:tr(null));var Ta=Zr&&Wr?function(e){return new Ye(e)}:tr(null),Sa=pa?function(e){return pa.get(e)}:sr,wa=function(){return fa.funcNames?"constant"==tr.name?Pt("name"):function(e){for(var t=e.name,n=ma[t],i=n?n.length:0;i--;){var o=n[i],r=o.func;if(null==r||r==e)return o.name}return t}:tr("")}(),Ca=function(){var e=0,t=0;return function(n,i){var o=Ya(),r=B-(o-t);if(t=o,r>0){if(++e>=j)return n}else e=0;return ba(n,i)}}(),Ra=Qi(function(e,t){return as(e)||ro(e)?yt(e,St(t,!1,!0)):[]}),Aa=hn(),Da=hn(!0),Ia=Qi(function(e,t){e||(e=[]),t=St(t);var n=t.length,o=pt(e,t);for(t.sort(i);n--;){var r=parseFloat(t[n]);if(r!=a&&Ln(r)){var a=r;qr.call(e,r,1)}}return o}),Ma=Sn(),xa=Sn(!0),Oa=Qi(function(e){return Wt(St(e,!1,!0))}),ka=Qi(function(e,t){return as(e)||ro(e)?yt(e,t):[]}),Na=Qi(_i),La=Qi(function(e,t){var n=e?e.length:0;return jn(n)&&(e=qn(e)),pt(e,St(t))}),Pa=en(function(e,t,n){xr.call(e,n)?++e[n]:e[n]=1}),Ua=un(va),ja=un(ya,!0),Ba=mn(Ze,va),Ha=mn(et,ya),za=en(function(e,t,n){xr.call(e,n)?e[n].push(t):e[n]=[t]}),Fa=en(function(e,t,n){e[n]=t}),Va=Qi(function(e,t,n){var i=-1,o="function"==typeof t,r=e?e.length:0,a=jn(r)?fr(r):[];return va(e,function(e){var r=o?t:null!=e&&e[t];a[++i]=r?r.apply(e,n):C}),a}),Wa=en(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),Ga=_n(at,va),qa=_n(st,ya),Ya=na||function(){return(new gr).getTime()},Ka=Qi(function(e,t,n){var i=A;if(n.length){var o=_(n,Ka.placeholder);i|=O}return wn(e,i,t,n,o)}),$a=Qi(function(e,t){t=t.length?St(t):Ro(e);for(var n=-1,i=t.length;++n<i;){var o=t[n];e[o]=wn(e[o],A,e)}return e}),Xa=Qi(function(e,t,n){var i=A|D;if(n.length){var o=_(n,Xa.placeholder);i|=O}return wn(t,i,e,n,o)}),Za=cn(M),Ja=cn(x),Qa=Qi(function(e,t){return vt(e,1,t)}),es=Qi(function(e,t,n){return vt(e,t,n)}),ts=pn(),ns=pn(!0),is=yn(O),os=yn(k),rs=Qi(function(e,t){return wn(e,L,null,null,null,St(t))}),as=Xr||function(e){return v(e)&&jn(e.length)&&kr.call(e)==q};fa.dom||(co=function(e){return!!e&&1===e.nodeType&&v(e)&&!ls(e)});var ss=ia||function(e){return"number"==typeof e&&Jr(e)},cs=a(/x/)||Yr&&!a(Yr)?function(e){return kr.call(e)==X}:a,ls=zr?function(e){if(!e||kr.call(e)!=Q)return!1;var t=e.valueOf,n=go(t)&&(n=zr(t))&&zr(n);return n?e==n||zr(e)==n:Wn(e)}:Wn,us=tn(dt),hs=Qi(function(e){var t=e[0];return null==t?t:(e.push(ut),us.apply(C,e))}),ds=dn(Ct),ps=dn(Rt),ms=fn(_a),fs=fn(Ea),gs=gn(Ct),vs=gn(Rt),ys=Qr?function(e){if(e)var t=e.constructor,n=e.length;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&n&&jn(n)?Gn(e):po(e)?Qr(e):[]}:Gn,_s=tn(Nt),Es=Qi(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=it(St(t),Sr);return zn(e,yt(Io(e),t))}var n=Xt(t[0],t[1],3);return Fn(e,function(e,t,i){return!n(e,t,i)})}),bs=Qi(function(e,t){return null==e?{}:"function"==typeof t[0]?Fn(e,Xt(t[0],t[1],3)):zn(e,St(t))}),Ts=an(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),Ss=an(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),ws=vn(),Cs=vn(!0);8!=oa(Le+"08")&&(Wo=function(e,t,n){return(n?Pn(e,t,n):null==t)?t=0:t&&(t=+t),e=Ko(e),oa(e,t||(Ae.test(e)?16:10))});var Rs=an(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),As=an(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Ds=Qi(function(e,t){try{return e.apply(C,t)}catch(n){return ho(n)?n:new vr(n)}}),Is=ln(ot),Ms=ln(rt,!0);return t.prototype=n.prototype,y.prototype=ga(n.prototype),y.prototype.constructor=y,Z.prototype=ga(n.prototype),Z.prototype.constructor=Z,Fe.prototype["delete"]=Ve,Fe.prototype.get=We,Fe.prototype.has=Ge,Fe.prototype.set=qe,Ye.prototype.push=$e,Xi.Cache=Fe,t.after=qi,t.ary=Yi,t.assign=us,t.at=La,t.before=Ki,t.bind=Ka,t.bindAll=$a,t.bindKey=Xa,t.callback=er,t.chain=Ti,t.chunk=$n,t.compact=Xn,t.constant=tr,t.countBy=Pa,t.create=Co,t.curry=Za,t.curryRight=Ja,t.debounce=$i,t.defaults=hs,t.defer=Qa,t.delay=es,t.difference=Ra,t.drop=Zn,t.dropRight=Jn,t.dropRightWhile=Qn,t.dropWhile=ei,t.fill=ti,t.filter=Oi,t.flatten=ii,t.flattenDeep=oi,t.flow=ts,t.flowRight=ns,t.forEach=Ba,t.forEachRight=Ha,t.forIn=ms,t.forInRight=fs,t.forOwn=gs,t.forOwnRight=vs,t.functions=Ro,t.groupBy=za,t.indexBy=Fa,t.initial=ai,t.intersection=si,t.invert=Do,t.invoke=Va,t.keys=ys,t.keysIn=Io,t.map=Li,t.mapValues=Mo,t.matches=ir,t.matchesProperty=or,t.memoize=Xi,t.merge=_s,t.mixin=rr,t.negate=Zi,t.omit=Es,t.once=Ji,t.pairs=xo,t.partial=is,t.partialRight=os,t.partition=Wa,t.pick=bs,t.pluck=Pi,t.property=cr,t.propertyOf=lr,t.pull=ui,t.pullAt=Ia,t.range=ur,t.rearg=rs,t.reject=Ui,t.remove=hi,t.rest=di,t.restParam=Qi,t.shuffle=Bi,t.slice=pi,t.sortBy=Fi,t.sortByAll=Vi,t.sortByOrder=Wi,t.spread=eo,t.take=mi,t.takeRight=fi,t.takeRightWhile=gi,t.takeWhile=vi,t.tap=Si,t.throttle=to,t.thru=wi,t.times=hr,t.toArray=So,t.toPlainObject=wo,t.transform=ko,t.union=Oa,t.uniq=yi,t.unzip=_i,t.values=No,t.valuesIn=Lo,t.where=Gi,t.without=ka,t.wrap=no,t.xor=Ei,t.zip=Na,t.zipObject=bi,t.backflow=ns,t.collect=Li,t.compose=ns,t.each=Ba,t.eachRight=Ha,t.extend=us,t.iteratee=er,t.methods=Ro,t.object=bi,t.select=Oi,t.tail=di,t.unique=yi,rr(t,t),t.add=pr,t.attempt=Ds,t.camelCase=Ts,t.capitalize=jo,t.clone=io,t.cloneDeep=oo,t.deburr=Bo,t.endsWith=Ho,t.escape=zo,t.escapeRegExp=Fo,t.every=xi,t.find=Ua,t.findIndex=Aa,t.findKey=ds,t.findLast=ja,t.findLastIndex=Da,t.findLastKey=ps,t.findWhere=ki,t.first=ni,t.has=Ao,t.identity=nr,t.includes=Ni,t.indexOf=ri,t.inRange=Po,t.isArguments=ro,t.isArray=as,t.isBoolean=ao,t.isDate=so,t.isElement=co,t.isEmpty=lo,t.isEqual=uo,t.isError=ho,t.isFinite=ss,t.isFunction=cs,t.isMatch=mo,t.isNaN=fo,t.isNative=go,t.isNull=vo,t.isNumber=yo,t.isObject=po,t.isPlainObject=ls,t.isRegExp=_o,t.isString=Eo,t.isTypedArray=bo,t.isUndefined=To,t.kebabCase=Ss,t.last=ci,t.lastIndexOf=li,t.max=Is,t.min=Ms,t.noConflict=ar,t.noop=sr,t.now=Ya,t.pad=Vo,t.padLeft=ws,t.padRight=Cs,t.parseInt=Wo,t.random=Uo,t.reduce=Ga,t.reduceRight=qa,t.repeat=Go,t.result=Oo,t.runInContext=w,t.size=Hi,t.snakeCase=Rs,t.some=zi,t.sortedIndex=Ma,t.sortedLastIndex=xa,t.startCase=As,t.startsWith=qo,t.sum=mr,t.template=Yo,t.trim=Ko,t.trimLeft=$o,t.trimRight=Xo,t.trunc=Zo,t.unescape=Jo,t.uniqueId=dr,t.words=Qo,t.all=xi,t.any=zi,t.contains=Ni,t.detect=Ua,t.foldl=Ga,t.foldr=qa,t.head=ni,t.include=Ni,t.inject=Ga,rr(t,function(){var e={};return Ct(t,function(n,i){t.prototype[i]||(e[i]=n)}),e}(),!1),t.sample=ji,t.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return ji(t,e)}):ji(this.value())},t.VERSION=R,Ze(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){t[e].placeholder=t}),Ze(["dropWhile","filter","map","takeWhile"],function(e,t){var n=t!=F,i=t==H;Z.prototype[e]=function(e,o){var r=this.__filtered__,a=r&&i?new Z(this):this.clone(),s=a.__iteratees__||(a.__iteratees__=[]);return s.push({done:!1,count:0,index:0,iteratee:In(e,o,1),limit:-1,type:t}),a.__filtered__=r||n,a}}),Ze(["drop","take"],function(e,t){var n=e+"While";Z.prototype[e]=function(n){var i=this.__filtered__,o=i&&!t?this.dropWhile():this.clone();if(n=null==n?1:ea(Hr(n)||0,0),i)t?o.__takeCount__=ta(o.__takeCount__,n):ci(o.__iteratees__).limit=n;else{var r=o.__views__||(o.__views__=[]);r.push({size:n,type:e+(o.__dir__<0?"Right":"")})}return o},Z.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},Z.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[n](e,t).reverse()}}),Ze(["first","last"],function(e,t){var n="take"+(t?"Right":"");Z.prototype[e]=function(){return this[n](1).value()[0]}}),Ze(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");Z.prototype[e]=function(){return this[n](1)}}),Ze(["pluck","where"],function(e,t){var n=t?"filter":"map",i=t?Ot:Pt;Z.prototype[e]=function(e){return this[n](i(e))}}),Z.prototype.compact=function(){return this.filter(nr)},Z.prototype.reject=function(e,t){return e=In(e,t,1),this.filter(function(t){return!e(t)})},Z.prototype.slice=function(e,t){e=null==e?0:+e||0;var n=0>e?this.takeRight(-e):this.drop(e);return"undefined"!=typeof t&&(t=+t||0,n=0>t?n.dropRight(-t):n.take(t-e)),n},Z.prototype.toArray=function(){return this.drop(0)},Ct(Z.prototype,function(e,n){var i=t[n];if(i){var o=/^(?:filter|map|reject)|While$/.test(n),r=/^(?:first|last)$/.test(n);t.prototype[n]=function(){var n=arguments,a=(n.length,this.__chain__),s=this.__wrapped__,c=!!this.__actions__.length,l=s instanceof Z,u=n[0],h=l||as(s);h&&o&&"function"==typeof u&&1!=u.length&&(l=h=!1);var d=l&&!c;if(r&&!a)return d?e.call(s):i.call(t,this.value());var p=function(e){var o=[e];return Fr.apply(o,n),i.apply(t,o)};if(h){var m=d?s:new Z(this),f=e.apply(m,n);if(!r&&(c||f.__actions__)){var g=f.__actions__||(f.__actions__=[]);g.push({func:wi,args:[p],thisArg:t})}return new y(f,a)}return this.thru(p)}}}),Ze(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var n=(/^(?:replace|split)$/.test(e)?Ar:Cr)[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:join|pop|replace|shift)$/.test(e);t.prototype[e]=function(){var e=arguments;return o&&!this.__chain__?n.apply(this.value(),e):this[i](function(t){return n.apply(t,e)})}}),Ct(Z.prototype,function(e,n){var i=t[n];if(i){var o=i.name,r=ma[o]||(ma[o]=[]);r.push({name:n,func:i})}}),ma[En(null,D).name]=[{name:"wrapper",func:null}],Z.prototype.clone=te,Z.prototype.reverse=ie,Z.prototype.value=ze,t.prototype.chain=Ci,t.prototype.commit=Ri,t.prototype.plant=Ai,t.prototype.reverse=Di,t.prototype.toString=Ii,t.prototype.run=t.prototype.toJSON=t.prototype.valueOf=t.prototype.value=Mi,t.prototype.collect=t.prototype.map,t.prototype.head=t.prototype.first,t.prototype.select=t.prototype.filter,t.prototype.tail=t.prototype.rest,t}var C,R="3.6.0",A=1,D=2,I=4,M=8,x=16,O=32,k=64,N=128,L=256,P=30,U="...",j=150,B=16,H=0,z=1,F=2,V="Expected a function",W="__lodash_placeholder__",G="[object Arguments]",q="[object Array]",Y="[object Boolean]",K="[object Date]",$="[object Error]",X="[object Function]",Z="[object Map]",J="[object Number]",Q="[object Object]",ee="[object RegExp]",te="[object Set]",ne="[object String]",ie="[object WeakMap]",oe="[object ArrayBuffer]",re="[object Float32Array]",ae="[object Float64Array]",se="[object Int8Array]",ce="[object Int16Array]",le="[object Int32Array]",ue="[object Uint8Array]",he="[object Uint8ClampedArray]",de="[object Uint16Array]",pe="[object Uint32Array]",me=/\b__p \+= '';/g,fe=/\b(__p \+=) '' \+/g,ge=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ve=/&(?:amp|lt|gt|quot|#39|#96);/g,ye=/[&<>"'`]/g,_e=RegExp(ve.source),Ee=RegExp(ye.source),be=/<%-([\s\S]+?)%>/g,Te=/<%([\s\S]+?)%>/g,Se=/<%=([\s\S]+?)%>/g,we=/[\u0300-\u036f\ufe20-\ufe23]/g,Ce=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Re=/\w*$/,Ae=/^0[xX]/,De=/^\[object .+?Constructor\]$/,Ie=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Me=/($^)/,xe=/[.*+?^${}()|[\]\/\\]/g,Oe=RegExp(xe.source),ke=/['\n\r\u2028\u2029\\]/g,Ne=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),Le=" 	\f \ufeff\n\r\u2028\u2029 ᠎             　",Pe=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window"],Ue=-1,je={};je[re]=je[ae]=je[se]=je[ce]=je[le]=je[ue]=je[he]=je[de]=je[pe]=!0,je[G]=je[q]=je[oe]=je[Y]=je[K]=je[$]=je[X]=je[Z]=je[J]=je[Q]=je[ee]=je[te]=je[ne]=je[ie]=!1;var Be={};Be[G]=Be[q]=Be[oe]=Be[Y]=Be[K]=Be[re]=Be[ae]=Be[se]=Be[ce]=Be[le]=Be[J]=Be[Q]=Be[ee]=Be[ne]=Be[ue]=Be[he]=Be[de]=Be[pe]=!0,Be[$]=Be[X]=Be[Z]=Be[te]=Be[ie]=!1;var He={leading:!1,maxWait:0,trailing:!1},ze={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e",
"Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Fe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ve={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},We={"function":!0,object:!0},Ge={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qe=We[typeof n]&&n&&!n.nodeType&&n,Ye=We[typeof t]&&t&&!t.nodeType&&t,Ke=qe&&Ye&&"object"==typeof e&&e,$e=We[typeof self]&&self&&self.Object&&self,Xe=We[typeof window]&&window&&window.Object&&window,Ze=Ye&&Ye.exports===qe&&qe,Je=Ke||Xe!==(this&&this.window)&&Xe||$e||this,Qe=w();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Je._=Qe,define(function(){return Qe})):qe&&Ye?Ze?(Ye.exports=Qe)._=Qe:qe._=Qe:Je._=Qe}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,t,n){"use strict";function i(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=Object.assign||function(e,t){for(var n,o,r=i(e),a=1;a<arguments.length;a++){n=arguments[a],o=Object.keys(Object(n));for(var s=0;s<o.length;s++)r[o[s]]=n[o[s]]}return r}},{}],21:[function(e,t,n){function i(e){for(var t=e.charCodeAt(1)-e.charCodeAt(0),n=0;n<e.length-1;n++)if(e.charCodeAt(n+1)-e.charCodeAt(n)!==t)return!1;return!0}function o(e){var t=e.split("").reverse().join(""),n=s.join("");return~n.indexOf(e)||~n.indexOf(t)?!0:(n=s.reverse().join(""),~n.indexOf(e)||~n.indexOf(t)?!0:!1)}function r(e){if(e.length<6)return"simple";var t=0;return/[a-z]/.test(e)&&(t+=1),/[A-Z]/.test(e)&&(t+=1),/[0-9]/.test(e)&&(t+=1),/[^0-9a-zA-Z]/.test(e)&&(t+=1),e.length<8&&1===t?"simple":t>2?"strong":"medium"}function a(e){return e.length<a.min?{valid:!1,strength:"simple",hint:"too short"}:~a.words.indexOf(e)?{valid:!1,strength:"simple",hint:"simple word"}:i(e)||o(e)?{valid:!1,strength:"simple",hint:"too simple"}:{valid:!0,strength:r(e),hint:null}}var s=["qwertyuiop","asdfghjkl","zxcvbnm"];a.min=4,a.words=[],t.exports=a},{}],22:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return!a["default"](this.props,e)||!a["default"](this.state,t)}n.__esModule=!0,n["default"]=o;var r=e("./shallowEqual"),a=i(r);t.exports=n["default"]},{"./shallowEqual":24}],23:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("./function"),r=i(o);n["default"]={shouldComponentUpdate:r["default"]},t.exports=n["default"]},{"./function":22}],24:[function(e,t,n){"use strict";function i(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var o=Object.prototype.hasOwnProperty.bind(t),r=0;r<n.length;r++)if(!o(n[r])||e[n[r]]!==t[n[r]])return!1;return!0}n.__esModule=!0,n["default"]=i,t.exports=n["default"]},{}],25:[function(e,t,n){t.exports=function(e,t,n){for(var i=0,o=e.length,r=3==arguments.length?n:e[i++];o>i;)r=t.call(null,r,e[i],++i,e);return r}},{}],26:[function(e,t,n){function i(){}function o(e){var t={}.toString.call(e);switch(t){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function r(e){return e===Object(e)}function a(e){if(!r(e))return e;var t=[];for(var n in e)null!=e[n]&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function s(e){for(var t,n,i={},o=e.split("&"),r=0,a=o.length;a>r;++r)n=o[r],t=n.split("="),i[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return i}function c(e){var t,n,i,o,r=e.split(/\r?\n/),a={};r.pop();for(var s=0,c=r.length;c>s;++s)n=r[s],t=n.indexOf(":"),i=n.slice(0,t).toLowerCase(),o=v(n.slice(t+1)),a[i]=o;return a}function l(e){return e.split(/ *; */).shift()}function u(e){return f(e.split(/ *; */),function(e,t){var n=t.split(/ *= */),i=n.shift(),o=n.shift();return i&&o&&(e[i]=o),e},{})}function h(e,t){t=t||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=c(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function d(e,t){var n=this;m.call(this),this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new h(n)}catch(i){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=i,n.callback(e)}if(n.emit("response",t),e)return n.callback(e,t);if(t.status>=200&&t.status<300)return n.callback(e,t);var o=new Error(t.statusText||"Unsuccessful HTTP response");o.original=e,o.response=t,o.status=t.status,n.callback(e||o,t)})}function p(e,t){return"function"==typeof t?new d("GET",e).end(t):1==arguments.length?new d("GET",e):new d(e,t)}var m=e("emitter"),f=e("reduce"),g="undefined"==typeof window?this||self:window;p.getXHR=function(){if(!(!g.XMLHttpRequest||g.location&&"file:"==g.location.protocol&&g.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var v="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};p.serializeObject=a,p.parseString=s,p.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},p.serialize={"application/x-www-form-urlencoded":a,"application/json":JSON.stringify},p.parse={"application/x-www-form-urlencoded":s,"application/json":JSON.parse},h.prototype.get=function(e){return this.header[e.toLowerCase()]},h.prototype.setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=l(t);var n=u(t);for(var i in n)this[i]=n[i]},h.prototype.parseBody=function(e){var t=p.parse[this.type];return t&&e&&(e.length||e instanceof Object)?t(e):null},h.prototype.setStatusProperties=function(e){1223===e&&(e=204);var t=e/100|0;this.status=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.clientError=4==t,this.serverError=5==t,this.error=4==t||5==t?this.toError():!1,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},h.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,i="cannot "+t+" "+n+" ("+this.status+")",o=new Error(i);return o.status=this.status,o.method=t,o.url=n,o},p.Response=h,m(d.prototype),d.prototype.use=function(e){return e(this),this},d.prototype.timeout=function(e){return this._timeout=e,this},d.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},d.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},d.prototype.set=function(e,t){if(r(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},d.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},d.prototype.getHeader=function(e){return this._header[e.toLowerCase()]},d.prototype.type=function(e){return this.set("Content-Type",p.types[e]||e),this},d.prototype.accept=function(e){return this.set("Accept",p.types[e]||e),this},d.prototype.auth=function(e,t){var n=btoa(e+":"+t);return this.set("Authorization","Basic "+n),this},d.prototype.query=function(e){return"string"!=typeof e&&(e=a(e)),e&&this._query.push(e),this},d.prototype.field=function(e,t){return this._formData||(this._formData=new g.FormData),this._formData.append(e,t),this},d.prototype.attach=function(e,t,n){return this._formData||(this._formData=new g.FormData),this._formData.append(e,t,n),this},d.prototype.send=function(e){var t=r(e),n=this.getHeader("Content-Type");if(t&&r(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(n||this.type("form"),n=this.getHeader("Content-Type"),this._data="application/x-www-form-urlencoded"==n?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||o(e)?this:(n||this.type("json"),this)},d.prototype.callback=function(e,t){var n=this._callback;this.clearTimeout(),n(e,t)},d.prototype.crossDomainError=function(){var e=new Error("Origin is not allowed by Access-Control-Allow-Origin");e.crossDomain=!0,this.callback(e)},d.prototype.timeoutError=function(){var e=this._timeout,t=new Error("timeout of "+e+"ms exceeded");t.timeout=e,this.callback(t)},d.prototype.withCredentials=function(){return this._withCredentials=!0,this},d.prototype.end=function(e){var t=this,n=this.xhr=p.getXHR(),r=this._query.join("&"),a=this._timeout,s=this._formData||this._data;this._callback=e||i,n.onreadystatechange=function(){if(4==n.readyState){var e;try{e=n.status}catch(i){e=0}if(0==e){if(t.timedout)return t.timeoutError();if(t.aborted)return;return t.crossDomainError()}t.emit("end")}};var c=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.emit("progress",e)};this.hasListeners("progress")&&(n.onprogress=c);try{n.upload&&this.hasListeners("progress")&&(n.upload.onprogress=c)}catch(l){}if(a&&!this._timer&&(this._timer=setTimeout(function(){t.timedout=!0,t.abort()},a)),r&&(r=p.serializeObject(r),this.url+=~this.url.indexOf("?")?"&"+r:"?"+r),n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof s&&!o(s)){var u=p.serialize[this.getHeader("Content-Type")];u&&(s=u(s))}for(var h in this.header)null!=this.header[h]&&n.setRequestHeader(h,this.header[h]);return this.emit("request",this),n.send(s),this},p.Request=d,p.get=function(e,t,n){var i=p("GET",e);return"function"==typeof t&&(n=t,t=null),t&&i.query(t),n&&i.end(n),i},p.head=function(e,t,n){var i=p("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},p.del=function(e,t){var n=p("DELETE",e);return t&&n.end(t),n},p.patch=function(e,t,n){var i=p("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},p.post=function(e,t,n){var i=p("POST",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},p.put=function(e,t,n){var i=p("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},t.exports=p},{emitter:5,reduce:25}],27:[function(e,t,n){function i(e,t){t=t||{};for(var n,i,o,r,a,s=t.limit||100,c="undefined"!=typeof t.preserveTags?t.preserveTags:!0,l=t.suffix||"...",u=t.moreLink||"",h=e.replace(/</g,"\n<").replace(/>/g,">\n").replace(/\n\n/g,"\n").replace(/^\n/g,"").replace(/\n$/g,"").split("\n"),d=0,p=[],m=!1,f=0;f<h.length;f++)if(n=h[f],rowCut=n.replace(/[ ]+/g," "),n.length){if("<"!==n[0])if(d>=s)n="";else if(d+rowCut.length>=s){if(i=s-d," "===n[i-1])for(;i&&(i-=1," "===n[i-1]););else o=n.substring(i).split("").indexOf(" "),-1!==o?i+=o:i=n.length;n=n.substring(0,i)+l,u&&(n+='<a href="'+u+'" style="display:inline">»</a>'),d=s,m=!0}else d+=rowCut.length;else if(c){if(d>=s)if(r=n.match(/[a-zA-Z]+/),a=r?r[0]:"")if("</"!==n.substring(0,2))p.push(a),n="";else{for(;p[p.length-1]!==a&&p.length;)p.pop();p.length&&(n=""),p.pop()}else n=""}else n="";h[f]=n}return{html:h.join("\n").replace(/\n/g,""),more:m}}"undefined"!=typeof t&&t.exports&&(t.exports=i)},{}],28:[function(e,t,n){var i=e("../dispatcher/BoardsDispatcher"),o=e("../constants/BoardSettingsConstants");t.exports={updateBoardCollaboratorsToggle:function(e){i.handleViewAction({actionType:o.UPDATE_BOARD_COLLABORATORS_TOGGLE,value:e})},updateBoardPasswordToggle:function(e){i.handleViewAction({actionType:o.UPDATE_BOARD_PASSWORD_TOGGLE,value:e})},updateBoardPassword:function(e){i.handleViewAction({actionType:o.UPDATE_BOARD_PASSWORD,value:e})},updateFontFilesDownloadToggle:function(e){i.handleViewAction({actionType:o.UPDATE_FONT_FILES_DOWNLOAD_TOGGLE,value:e})},updateImageDownloadToggle:function(e){i.handleViewAction({actionType:o.UPDATE_IMAGE_DOWNLOAD_TOGGLE,value:e})},updateSourceFilesDownloadToggle:function(e){i.handleViewAction({actionType:o.UPDATE_SOURCE_FILES_DOWNLOAD_TOGGLE,value:e})},saveBoardPassword:function(){i.handleViewAction({actionType:o.INIT_SAVE})},handlePasswordSuccess:function(){i.handleViewAction({actionType:o.PASSWORD_STEP_SAVE_SUCCESS})},handlePasswordFailure:function(){i.handleViewAction({actionType:o.PASSWORD_STEP_SAVE_FAIL})},updateBoardSettings:function(e){i.handleViewAction({actionType:o.UPDATE_BOARD_SETTINGS,data:e})}}},{"../constants/BoardSettingsConstants":89,"../dispatcher/BoardsDispatcher":92}],29:[function(e,t,n){var i=e("../dispatcher/BoardsDispatcher"),o=e("../constants/BoardsConstants"),r={URLUpdated:function(e,t){i.handleServerAction({actionType:o.ActionTypes.URL_UPDATED,data:{url:e,isShare:t}})},initialServerLoad:function(e){i.handleServerAction({actionType:o.ActionTypes.INITIAL_SERVER_LOAD,data:e})},setUser:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_USER,data:e})},setCompanyData:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_COMPANY_DATA,data:e})},updateBoards:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_BOARDS,data:e})},setCollaboratorData:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_COLLABORATOR_DATA,data:e})},boardDeletionConfirmed:function(e){i.handleServerAction({actionType:o.ActionTypes.DELETE_BOARD_CONFIRMATION,data:e})},setIsEnterprise:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_IS_ENTERPRISE,data:e})},createNewBoard:function(){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"new-board"}})},gotoBoard:function(e){i.handleViewAction({actionType:o.ActionTypes.GOTO_BOARD,data:e})},shareBoard:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"share-board",boardId:e}})},triggerBoardSettingsOverlay:function(e){i.handleViewAction({actionType:o.ActionTypes.TRIGGER_BOARD_SETTINGS_OVERLAY,data:{boardId:e}})},triggerBoardShareOverlay:function(e){i.handleViewAction({actionType:o.ActionTypes.TRIGGER_BOARD_SHARE_OVERLAY,data:{boardId:e}})},boardShareLoaded:function(e){i.handleServerAction({actionType:o.ActionTypes.BOARD_SHARE_LOADED,data:e})},boardSettingsLoaded:function(e){i.handleServerAction({actionType:o.ActionTypes.BOARD_SETTINGS_LOADED,data:e})},setZoom:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_ZOOM,data:e})},deleteBoard:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"delete-board",board:e}})},duplicateBoard:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"duplicate-board",board:e}})},openBoardShare:function(e,t){t=t||{},i.handleViewAction({actionType:o.ActionTypes.OPEN_BOARD_SHARE,data:{boardId:e,context:t}})},openModalArchive:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"archive",boardId:e}})},openModalUnarchive:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"unarchive",boardData:e}})},joinBoard:function(e){i.handleViewAction({actionType:o.ActionTypes.JOIN_BOARD,data:e})},setFilter:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_FILTER,data:e})},setSort:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_SORT,data:e})},setSelectedCompany:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_SELECTED_COMPANY,data:e})},setSelectedCollaborator:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_SELECTED_COLLABORATOR,data:e})},setFeatureFlags:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_FEATURE_FLAGS,data:e})},setSingleTenantConfig:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_SINGLE_TENANT_CONFIG,data:e})},setBaseBoardsRoute:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_BASE_BOARDS_ROUTE,data:e})},setBoardSpace:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_BOARD_SPACE,data:e})},setBoard:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_BOARD,data:e})},setSingleItemShare:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_SINGLE_ITEM_SHARE,data:{boardItem:e}})},commentsLoaded:function(e){i.handleServerAction({actionType:o.ActionTypes.COMMENTS_LOADED,data:e})},commentsRoundupLoaded:function(e,t){i.handleServerAction({actionType:o.ActionTypes.COMMENTS_ROUNDUP_LOADED,data:{boardID:e,comments:t}})},updateCommentID:function(e,t,n){i.handleServerAction({actionType:o.ActionTypes.UPDATE_COMMENT_ID,data:{item:e,commentID:t,sketchID:n}})},loadNewItem:function(e,t){i.handleServerAction({actionType:o.ActionTypes.LOAD_NEW_ITEM,data:{board:e,itemID:t}})},setViewItemVisible:function(e){i.handleViewAction({actionType:o.ActionTypes.ITEM_VIEW_OPEN,data:e})},setViewItemHidden:function(){i.handleViewAction({actionType:o.ActionTypes.ITEM_VIEW_CLOSE,data:{}})},openNewColorModal:function(e,t){t=t||null,i.handleViewAction({actionType:o.ActionTypes.NEW_COLOR,data:{board:e,group:t}})},openNewNoteModal:function(e,t){t=t||null,i.handleViewAction({actionType:o.ActionTypes.NEW_NOTE,data:{board:e,group:t}})},openNewUploadModal:function(e,t){t=t||null,i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"upload-modal",board:e,group:t}})},openUpgradeModal:function(){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"upgrade"}})},addTeamMembers:function(){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"add-team-members"}})},openAddToSpaceModal:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"add-to-space",type:"board",id:e}})},setBoardSortOrder:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_BOARD_SORT_ORDER,data:e})},setIsRedirecting:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_IS_REDIRECTING,data:e})},updateTitle:function(e){i.handleViewAction({actionType:o.ActionTypes.UPDATE_TITLE,data:e})},updateDescription:function(e){i.handleViewAction({actionType:o.ActionTypes.UPDATE_DESCRIPTION,data:e})},setLayoutType:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_LAYOUT_TYPE,data:e})},updateGroupTitle:function(e,t){i.handleViewAction({actionType:o.ActionTypes.UPDATE_GROUP_TITLE,data:{group:e,title:t}})},updateGroupDescription:function(e,t){i.handleViewAction({actionType:o.ActionTypes.UPDATE_GROUP_DESCRIPTION,data:{group:e,description:t}})},addGroup:function(e){i.handleViewAction({actionType:o.ActionTypes.ADD_GROUP,data:e})},moveGroup:function(e,t){i.handleViewAction({actionType:o.ActionTypes.MOVE_GROUP,data:{group:e,direction:t}})},deleteGroup:function(e){i.handleViewAction({actionType:o.ActionTypes.DELETE_GROUP,data:e})},shareBoardItem:function(e){i.handleViewAction({actionType:o.ActionTypes.OPEN_MODAL,data:{modalType:"share-board-item",item:e}})},setBoardItemColumns:function(e,t){i.handleViewAction({actionType:o.ActionTypes.SET_ITEM_COLUMNS,data:{item:e,columns:t}})},moveBoardItem:function(e,t,n){i.handleViewAction({actionType:o.ActionTypes.MOVE_ITEM,data:{itemID:e,newGroupID:t,sort:n}})},deleteBoardItem:function(e){i.handleViewAction({actionType:o.ActionTypes.DELETE_ITEM,data:e})},gotoBoardItem:function(e,t){i.handleViewAction({actionType:o.ActionTypes.GOTO_ITEM,data:{id:e,commentID:t}})},previousBoardItem:function(){i.handleViewAction({actionType:o.ActionTypes.PREVIOUS_ITEM,data:{}})},nextBoardItem:function(){i.handleViewAction({actionType:o.ActionTypes.NEXT_ITEM,data:{}})},clearSelectedItem:function(){i.handleViewAction({actionType:o.ActionTypes.CLEAR_SELECTED_ITEM,data:{}})},updateItemTitle:function(e,t){i.handleViewAction({actionType:o.ActionTypes.UPDATE_ITEM_TITLE,data:{item:e,title:t}})},updateItemDescription:function(e,t){i.handleViewAction({actionType:o.ActionTypes.UPDATE_ITEM_DESCRIPTION,data:{item:e,description:t}})},updateColorValue:function(e,t){i.handleViewAction({actionType:o.ActionTypes.UPDATE_COLOR_VALUE,data:{item:e,color:t}})},saveColorValue:function(e,t){i.handleViewAction({actionType:o.ActionTypes.SAVE_COLOR_VALUE,data:{item:e,color:t}})},updateNoteContent:function(e,t){i.handleViewAction({actionType:o.ActionTypes.UPDATE_NOTE_CONTENT,data:{item:e,noteContent:t}})},loadItemComments:function(e){i.handleViewAction({actionType:o.ActionTypes.LOAD_ITEM_COMMENTS,data:e})},addComment:function(e,t,n,r,a,s,c,l,u){i.handleViewAction({actionType:o.ActionTypes.ADD_COMMENT,data:{item:e,comment:t,notifyOthers:n,hasAnnotation:r,x:a,y:s,annotationLabel:c,sketchData:l,mentions:u}})},identifyAndAddComment:function(e,t,n,r,a,s,c,l,u,h){i.handleViewAction({actionType:o.ActionTypes.IDENTIFY_AND_ADD_COMMENT,data:{name:e,email:t,commentText:n,notifyUsers:r,hasAnnotation:a,x:s,y:c,annotationLabel:l,sketchData:u,mentions:h}})},loadCommentsRoundup:function(){i.handleViewAction({actionType:o.ActionTypes.LOAD_COMMENTS_ROUNDUP})},markItemCommentsRead:function(e){i.handleViewAction({actionType:o.ActionTypes.MARK_ITEM_COMMENTS_READ,data:e})},deleteComment:function(e){i.handleViewAction({actionType:o.ActionTypes.DELETE_COMMENT,data:e})},updateComment:function(e,t,n,r,a,s,c,l,u,h){i.handleViewAction({actionType:o.ActionTypes.UPDATE_COMMENT,data:{commentID:e,content:t,hasAnnotation:n,x:r,y:a,annotationLabel:s,hasExistingAnnotation:c,sketchID:l,sketchData:u,mentions:h}})},editCommentAnnotation:function(){i.handleViewAction({actionType:o.ActionTypes.EDIT_COMMENT_ANNOTATION})},addAnnotation:function(e,t){i.handleViewAction({actionType:o.ActionTypes.ADD_ANNOTATION,data:{x:e,y:t}})},editAnnotation:function(e,t){i.handleViewAction({actionType:o.ActionTypes.EDIT_ANNOTATION,data:{x:e,y:t}})},removeAnnotation:function(e){i.handleViewAction({actionType:o.ActionTypes.REMOVE_ANNOTATION,data:e})},viewAnnotation:function(e,t){i.handleViewAction({actionType:o.ActionTypes.VIEW_ANNOTATION,data:{commentID:e,editing:t}})},setHighlightedComment:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_HIGHLIGHTED_COMMENT,data:e})},loadAnnotations:function(){i.handleViewAction({actionType:o.ActionTypes.LOAD_ANNOTATIONS})},toggleSketchMode:function(){i.handleViewAction({actionType:o.ActionTypes.TOGGLE_SKETCH_MODE})},setActiveSketch:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_ACTIVE_SKETCH,data:e})},viewSketch:function(e){i.handleViewAction({actionType:o.ActionTypes.VIEW_SKETCH,data:e})},addColorFromBar:function(e,t,n){i.handleViewAction({actionType:o.ActionTypes.ADD_COLOR_FROM_BAR,data:{color:e,item:t,sort:n}})},addNewColorItem:function(e){i.handleServerAction({actionType:o.ActionTypes.ADD_NEW_COLOR_ITEM,data:e})},setHeaderState:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_HEADER_STATE,data:e})},setItemViewEditingState:function(e){i.handleViewAction({actionType:o.ActionTypes.ITEM_VIEW_EDITING_STATE,data:e})},startUpload:function(e,t,n){i.handleViewAction({actionType:o.ActionTypes.START_UPLOAD,data:{files:e,groupID:t,suggestedSort:n}})},addTempItem:function(e,t,n,r,a,s){i.handleViewAction({actionType:o.ActionTypes.ADD_TEMP_ITEM,data:{file:e,user:t,boardID:n,boardGroupID:r,title:a,sort:s}})},updateTempItem:function(e,t,n){i.handleViewAction({actionType:o.ActionTypes.UPDATE_TEMP_ITEM,data:{file:e,boardID:t,id:n}})},itemUploaded:function(e){i.handleServerAction({actionType:o.ActionTypes.ITEM_UPLOADED,data:e})},sourceFilePreviewGenerated:function(e){i.handleServerAction({actionType:o.ActionTypes.SOURCE_FILE_PREVIEW_GENERATED,data:e})},triggerBrowse:function(e){i.handleViewAction({actionType:o.ActionTypes.TRIGGER_BROWSE,data:e})},startHeaderUpload:function(e){i.handleViewAction({actionType:o.ActionTypes.START_HEADER_UPLOAD,data:{files:e}})},addTempHeader:function(e,t){i.handleViewAction({actionType:o.ActionTypes.ADD_TEMP_HEADER,data:{boardID:e,file:t}})},boardHeaderUploaded:function(e){i.handleServerAction({actionType:o.ActionTypes.BOARD_HEADER_UPLOADED,data:e})},triggerHeaderBrowse:function(){i.handleViewAction({actionType:o.ActionTypes.TRIGGER_HEADER_BROWSE,data:{}})},bulkDeleteItems:function(e){i.handleViewAction({actionType:o.ActionTypes.BULK_DELETE_ITEMS,data:{ids:e}})},bulkMoveItems:function(e,t){i.handleViewAction({actionType:o.ActionTypes.BULK_MOVE_ITEMS,data:{ids:e,groupID:t}})},bulkSizeItems:function(e,t){i.handleViewAction({actionType:o.ActionTypes.BULK_SIZE_ITEMS,data:{ids:e,columns:t}})},setImageColors:function(e){i.handleServerAction({actionType:o.ActionTypes.SET_IMAGE_COLORS,data:e})},imageColorsLoaded:function(e){i.handleViewAction({actionType:o.ActionTypes.IMAGE_COLORS_LOADED,data:e})},setPhotoHeaderSize:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_PHOTO_HEADER_SIZE,data:e})},setPhotoHeaderOffset:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_PHOTO_HEADER_OFFSET,data:e})},setPhotoHeaderTint:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_PHOTO_HEADER_TINT,data:e})},setPhotoHeaderBlur:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_PHOTO_HEADER_BLUR,data:e})},deleteHeaderImage:function(){i.handleViewAction({actionType:o.ActionTypes.DELETE_HEADER_IMAGE,data:{}})},setDragState:function(e){i.handleViewAction({actionType:o.ActionTypes.SET_DRAG_STATE,data:e})},dragMoveItem:function(e){i.handleViewAction({actionType:o.ActionTypes.DRAG_MOVE_ITEM,data:e})},dropItem:function(e){i.handleViewAction({actionType:o.ActionTypes.DROP_ITEM,data:e})},moveItemToGroup:function(e){i.handleViewAction({actionType:o.ActionTypes.MOVE_ITEM_TO_GROUP,data:e})},hideAddView:function(){i.handleViewAction({actionType:o.ActionTypes.HIDE_ADD_VIEW})},syncBoardItemUploadComplete:function(e){i.handleViewAction({actionType:o.ActionTypes.SYNC_BOARD_ITEM_UPLOAD_COMPLETE,data:e})}};t.exports=r},{"../constants/BoardsConstants":90,"../dispatcher/BoardsDispatcher":92}],30:[function(e,t,n){var i=e("../dispatcher/ImageCacheDispatcher"),o=e("../constants/ImageCacheConstants"),r={setImageCache:function(e){i.handleAction({actionType:o.ActionTypes.SET_IMAGE_CACHE,data:e})},setFromFile:function(e){i.handleAction({actionType:o.ActionTypes.SET_FROM_FILE,data:e})},updateImageCacheKey:function(e){i.handleAction({actionType:o.ActionTypes.UPDATE_IMAGE_CACHE_KEY,data:e})},replaceWithRemote:function(e){i.handleAction({actionType:o.ActionTypes.REPLACE_WITH_REMOTE,data:e})}};t.exports=r},{"../constants/ImageCacheConstants":91,"../dispatcher/ImageCacheDispatcher":93}],31:[function(e,t,n){var i=e("../dispatcher/BoardsDispatcher"),o=e("../constants/BoardsConstants"),r={toggleItemSelection:function(e,t,n,r){i.handleViewAction({actionType:o.ActionTypes.TOGGLE_ITEM_SELECTION,data:{id:e,onlyAdd:t,cmdKeyPressed:n,shiftKeyPressed:r}})},toggleDraggerItems:function(e,t){i.handleViewAction({actionType:o.ActionTypes.TOGGLE_DRAGGER_ITEMS,data:{ids:e,cmdKeyPressed:t}})},clearSelectionStore:function(){i.handleViewAction({actionType:o.ActionTypes.CLEAR_SELECTION_STORE,data:{}})},selectBoardItem:function(e){i.handleViewAction({actionType:o.ActionTypes.SELECT_BOARD_ITEM,data:e})},selectFirstItem:function(){i.handleViewAction({actionType:o.ActionTypes.SELECT_FIRST_ITEM,data:{}})}};t.exports=r},{"../constants/BoardsConstants":90,"../dispatcher/BoardsDispatcher":92}],32:[function(e,t,n){var i=ReactDOM,o=i.findDOMNode,r=e("../actions/SelectionActionCreators"),a=e("../mixins/SelectionMixin"),s=e("../actions/BoardsActionCreators"),c=e("./board/Header.jsx"),l=e("./board/BoardSettings.jsx"),u=e("./board/Group.jsx"),h=e("./board/EmptyBoard.jsx"),d=e("./board/UnsubscribeConfirmation.jsx"),p=e("../stores/BoardStore"),m=e("./board/ZoomHandler.jsx"),f=e("./board/ItemView.jsx"),g=e("./board/OverQuota.jsx"),v=e("./board/BoardShareOverlay.jsx"),y=e("./board/MultiSelectBar.jsx"),E=e("./board/MultiSelectDragger.jsx"),b=e("../../common/components/Loading.jsx"),T=e("classie"),S=e("../utils/is"),w=e("../utils/animated-scroll-to"),C=e("../utils/IntercomUtils"),R=e("../utils/TypekitUtil"),A=function(){return{isLoading:p.getIsLoading(),initialServerLoad:p.getInitialServerLoad(),featureFlags:p.getFeatureFlags(),singleTenantConfig:p.getSingleTenantConfig(),user:p.getUser(),board:p.getBoard(),shareData:p.getShareData(),settings:p.getSettings(),zoom:p.getZoom(),commentsRoundup:p.getCommentsRoundup(),selectedItem:p.getSelectedItem(),clearSelectedItem:p.getClearSelectedItem(),closingSelectedItem:!1,dropAreaVisible:!1,renameElementEditing:!1,space:p.getBoardSpace()}},D=React.createClass({displayName:"Board",propTypes:{boardID:React.PropTypes.number.isRequired,isShare:React.PropTypes.bool,shouldClose:React.PropTypes.bool,unsubscribe:React.PropTypes.bool.isRequired,user:React.PropTypes.object.isRequired,companySettings:React.PropTypes.object.isRequired},mixins:[a],getDefaultProps:function(){return{isShare:!1,shouldClose:!1}},getInitialState:function(){p.loadFromBoardsCache(this.props.user,this.props.boardID);var e=A();return _.assign(e,{boardHeight:0,boardDataLoaded:!_.isEmpty(e.board),isSettingsModalOpen:!1})},loadItemFromURL:function(){setTimeout(function(){var e=document.URL.split("/").reverse();this.props.isShare&&"#"===e[2]?setTimeout(function(){s.gotoBoardItem(parseInt(e[0],10))}):!this.props.isShare&&e[2].indexOf("boards")>=0?s.gotoBoardItem(parseInt(e[0],10),null):!this.props.isShare&&e[3].indexOf("boards")>=0&&s.gotoBoardItem(parseInt(e[1],10),parseInt(e[0],10))}.bind(this))},componentWillMount:function(){R()},componentDidMount:function(){p.addChangeListener(this._onChange),C.hideIntercom(),TweenLite.set(document.querySelector(".core-wrapper"),{force3D:!0,autoAlpha:0}),this.state.boardDataLoaded&&this.dataLoadedAnimationHandler(),this.state.initialServerLoad&&this.loadItemFromURL(),document.addEventListener("keyup",this.keypressHandler,!1),document.addEventListener("keydown",this.keydownHandler,!1),this.props.isShare?(this.trackAnalytics(),document.addEventListener("click",this.handleDocumentClick,!1)):(document.addEventListener("dragenter",this.fileDragEnter,!1),document.addEventListener("dragleave",this.fileDragLeave,!1),document.addEventListener("dragover",this.dragCancel,!1),document.addEventListener("drop",this.fileDrop,!1))},componentWillUpdate:function(e,t){this.state.boardDataLoaded||this.state.boardDataLoaded===t.boardDataLoaded||this.dataLoadedAnimationHandler()},componentDidUpdate:function(e,t){this.state.clearSelectedItem&&!t.clearSelectedItem&&setTimeout(function(){this.state.selectedItem&&this.triggerModalClose()}.bind(this)),this.state.initialServerLoad&&!t.initialServerLoad&&this.loadItemFromURL(),this.state.boardDataLoaded||_.isEmpty(this.state.board)||t.board===this.state.board||this.setState({boardDataLoaded:!0}),this.props.isShare&&this.trackAnalytics()},componentWillUnmount:function(){p.removeChangeListener(this._onChange),p.clearBoard(),r.clearSelectionStore(),C.showIntercom(),document.removeEventListener("keyup",this.keypressHandler),document.removeEventListener("keydown",this.keydownHandler),this.props.isShare?document.removeEventListener("click",this.handleDocumentClick,!1):(document.removeEventListener("dragenter",this.fileDragEnter),document.removeEventListener("dragover",this.dragCancel),document.removeEventListener("dragleave",this.fileDragLeave),document.removeEventListener("drop",this.fileDrop))},trackAnalytics:function(){window.analytics&&this.state.board&&!this.tracked&&(this.tracked=!0,window.analytics.track("ShareLink.Viewed",{boardid:this.props.boardID,isPasswordProtected:this.state.board.isPasswordProtected,boardViewType:"board"}))},dataLoadedAnimationHandler:function(){TweenLite.to(document.querySelector(".core-wrapper"),.5,{
autoAlpha:1,clearProps:"transform, visibility, opacity"})},dragCancel:function(e){e.preventDefault()},fileDragEnter:function(e){e.preventDefault(),setTimeout(function(){var t=document.querySelectorAll(".board-items-section"),n=!0;document.querySelector(".header-image-options")&&(n=!1),[].forEach.call(t,function(t,i){0===i&&T.has(t,"no-items")||(t.contains(e.target)||t===e.target)&&(n=!1)},this),this.setState({dropAreaVisible:n})}.bind(this))},fileDragLeave:function(e){this.setState({dropAreaVisible:!1})},fileDrop:function(e){this.fileDragLeave(e);var t=document.querySelectorAll(".board-items-section"),n=!0;if(document.querySelector(".header-image-options")&&(n=!1),[].forEach.call(t,function(t,i){(t.contains(e.target)||t===e.target&&0!==i)&&(n=!1)},this),T.has(e.target,"upload-overlay")&&(n=!1),e.dataTransfer.files&&e.dataTransfer.files.length&&n){var i=this.state.board.groups[0];s.startUpload(e.dataTransfer.files,i.id,i.items.length+1)}},handleDocumentClick:function(e){e.target!==document.querySelector(".board-details")&&(S(e.target,".board-item")||S(e.target,".board-header")||S(e.target,"a")||S(e.target,".board-rename")||S(e.target,".zoom-wrap")||S(e.target,".plus")||S(e.target,".multi-select-options"))||r.clearSelectionStore()},keydownHandler:function(e){13===e.which&&"true"===e.target.contentEditable&&this.setState({renameElementEditing:!0}),S(e.target,"#boardItemNoteContent")||S(e.target,"textarea")||S(e.target,"input")||"true"===e.target.contentEditable||(38!==e.which&&40!==e.which||this.state.selectedItem||e.preventDefault(),32===e.which&&(1===this.state.selectionStore.selected.length&&!this.state.selectedItem||this.state.selectedItem)&&e.preventDefault())},scrollToSelected:function(){var e=document.querySelector(".board-item.is-selected");if(e){var t=e.getBoundingClientRect();if(t.top<0||t.bottom>window.innerHeight){var n=t.top+document.body.scrollTop-150;w(n,null,400)}}},moveLeft:function(){this.state.selectedItem?s.previousBoardItem():(r.selectBoardItem("left"),this.scrollToSelected())},moveRight:function(){this.state.selectedItem?s.nextBoardItem():(r.selectBoardItem("right"),this.scrollToSelected())},keypressHandler:function(e){if(!(S(e.target,"#boardItemNoteContent")||S(e.target,"textarea")||S(e.target,"input")&&"range"!==e.target.getAttribute("type")||"true"===e.target.contentEditable))switch(e.which){case 27:this.state.shareData?s.boardShareLoaded(null):this.state.selectedItem||r.clearSelectionStore();break;case 37:this.moveLeft();break;case 39:this.moveRight();break;case 38:this.state.selectedItem||(r.selectBoardItem("up"),this.scrollToSelected());break;case 40:this.state.selectedItem||(r.selectBoardItem("down"),this.scrollToSelected());break;case 13:case 32:if(this.state.renameElementEditing&&13===e.which)return void this.setState({renameElementEditing:!1});1!==this.state.zoom||1!==this.state.selectionStore.selected.length||this.state.selectedItem||s.gotoBoardItem(this.state.selectionStore.selected[0])}},groupsMounted:0,renderGroups:function(){if(this.state.board&&this.state.board.groups){var e=_.sortBy(this.state.board.groups,"sort"),t=e.map(function(e,t){var n=".board-item-"+e.id;return React.createElement(u,{isShare:this.props.isShare,selectionStore:this.state.selectionStore,isSelectingBulkItems:this.state.isSelectingBulkItems,board:this.state.board,group:e,items:e.items,groupKey:t,zoom:this.state.zoom,key:e.id,isLoading:this.state.isLoading,isLast:t===this.state.board.groups.length-1,isFirst:0===t,itemSelector:n,disableSync:this.state.singleTenantConfig.disableSync})},this);return t}return null},isEmpty:function(){if(this.state.board&&this.state.board.groups){if(this.state.board.groups.length>1)return!1;for(var e=0;e<this.state.board.groups.length;e++){var t=this.state.board.groups[e];if(t.items&&t.items.length>0)return!1}return!0}return!0},triggerModalClose:function(){this.setState({closingSelectedItem:!0})},handleItemModalClose:function(e,t){this.isMounted()&&(e&&s.deleteBoardItem(t),r.toggleItemSelection(t,!0,!1,!1),this.setState({selectedItem:null},function(){s.clearSelectedItem()}))},openSettingsModal:function(){s.triggerBoardSettingsOverlay(this.state.board.id),this.trackOpenBoardSettings(),this.setState({isSettingsModalOpen:!0})},closeSettingsModal:function(){this.setState({isSettingsModalOpen:!1})},trackOpenBoardSettings:function(){var e=this.props,t=e.boardID;window.analytics&&window.analytics.track("Boards.ViewSettings",{boardid:t},{integrations:{All:!1}})},getContainerNode:function(){return o(this)},render:function(){var e=this.state,t=e.isLoading,n=e.zoom,i=e.settings,o=e.isSettingsModalOpen,r=this.renderGroups(),a={};if(1>n){var s=n.toFixed(2),u="scale3d("+s+", "+s+", 1) rotate(0.0001deg)";a={WebkitTransform:u,transform:u}}return React.createElement("div",null,React.createElement("div",{ref:"zoomWrap",className:"board-zoom-wrap",style:a},React.createElement("div",{className:"board-inner"},this.props.unsubscribe&&!this.props.isShare?React.createElement(d,null):null,this.state.board.isOverQuota&&!this.props.isShare?React.createElement(g,null):null,this.state.dropAreaVisible&&!this.props.isShare?React.createElement("div",{className:"body-uploader"}):null,React.createElement(c,{board:this.state.board,commentsRoundup:this.state.commentsRoundup,hasSpaces:this.state.featureFlags.enableSpaces,space:this.state.space,isShare:this.props.isShare,openSettingsModal:this.openSettingsModal,showBoardSpace:this.state.featureFlags.enableSpaces&&!this.props.isShare&&!!this.props.companySettings.isEnterprise,user:this.state.user,isReviewer:this.props.isReviewer,zoom:this.state.zoom,shouldClose:this.props.shouldClose,disableSync:this.state.singleTenantConfig.disableSync}),t?React.createElement(b,null):React.createElement("div",{className:"board-details wrap"},React.createElement("div",{className:"inner"},this.isEmpty()?React.createElement(h,{board:this.state.board,isShare:this.props.isShare}):r)))),this.isEmpty()||this.state.selectedItem||this.props.isShare?null:React.createElement(E,{getContainerNode:this.getContainerNode}),this.props.isShare?null:React.createElement(y,{isSelectingBulkItems:this.state.isSelectingBulkItems,selectedItems:this.state.selectionStore.selected,board:this.state.board}),this.props.isShare?null:React.createElement(m,{zoom:this.state.zoom,boardHeight:this.state.boardHeight}),this.state.selectedItem?React.createElement(f,{isShare:this.props.isShare,onClose:this.handleItemModalClose,closing:this.state.closingSelectedItem,item:this.state.selectedItem,hasEmojis:!0,hasItemInfo:!0,hasMentions:!this.state.user.isAnonymous,hasMentionShortcut:this.state.featureFlags.mentionShortcut,atConversationDisabled:this.state.featureFlags["boards-rain-687-sunset-conversation"],sketchesDisabled:this.state.featureFlags["boards-rain-687-sunset-sketching"],board:this.state.board,user:this.state.user}):null,this.state.shareData?React.createElement(v,{isShare:this.props.isShare,boardID:this.state.board.id,title:this.state.board.title,description:this.state.board.description,shareUrl:this.state.shareData.shareUrl,companySettings:this.props.companySettings}):null,this.props.isShare?null:React.createElement(l,{isSettingsModalOpen:o,closeSettingsModal:this.closeSettingsModal,settings:i,title:this.state.board.title,boardId:this.state.board.id}),!this.props.isShare||this.state.user&&this.state.user.isAccountAuthenticated?null:React.createElement("footer",{className:"unauthorized-user"},React.createElement("a",{className:"in-logo",href:"http://www.invisionapp.com/",target:"_blank"}),React.createElement("p",null,"InVision makes it easy to share, present & collaborate on design!"),React.createElement("a",{className:"signup-button",href:"http://www.invisionapp.com/",target:"_blank"},"Sign Up Free")))},resetZoomHeight:function(){var e=ReactDOM.findDOMNode(this);if(!this.state.zoom||1===this.state.zoom)return e.style.removeProperty("height"),void e.style.removeProperty("overflow");var t=ReactDOM.findDOMNode(this.refs.zoomWrap).offsetHeight,n=t*this.state.zoom;e.style.height=n+"px",e.style.overflow="hidden",t!==this.state.boardHeight&&this.setState({boardHeight:t})},_onChange:function(){this.setState(A(),function(){this.resetZoomHeight()})}});t.exports=D},{"../../common/components/Loading.jsx":117,"../actions/BoardsActionCreators":29,"../actions/SelectionActionCreators":31,"../mixins/SelectionMixin":96,"../stores/BoardStore":99,"../utils/IntercomUtils":103,"../utils/TypekitUtil":104,"../utils/animated-scroll-to":106,"../utils/is":111,"./board/BoardSettings.jsx":34,"./board/BoardShareOverlay.jsx":35,"./board/EmptyBoard.jsx":41,"./board/Group.jsx":42,"./board/Header.jsx":44,"./board/ItemView.jsx":62,"./board/MultiSelectBar.jsx":63,"./board/MultiSelectDragger.jsx":64,"./board/OverQuota.jsx":65,"./board/UnsubscribeConfirmation.jsx":72,"./board/ZoomHandler.jsx":73,classie:2}],33:[function(e,t,n){function i(){return{user:o.getUser(),featureFlags:o.getFeatureFlags(),board:o.getBoard(),selectedItem:o.getSelectedItem()}}var o=e("../stores/BoardStore"),r=e("./board/SingleItemView.jsx"),a=React,s=a.PropTypes,c=React.createClass({displayName:"Board",propTypes:{thumbnailerResizeEndpoint:s.string.isRequired,share:s.shape({boardID:s.number.isRequired,boardItemID:s.number.isRequired,isPasswordProtected:s.bool.isRequired})},getInitialState:function(){return i()},componentDidMount:function(){o.addChangeListener(this._onChange)},componentWillUnmount:function(){o.removeChangeListener(this._onChange)},render:function(){var e=this.state,t=e.selectedItem,n=e.board,i=e.user,o=e.featureFlags,a=this.props,s=a.thumbnailerResizeEndpoint,c=a.share;return React.createElement("div",null,t&&n&&i?React.createElement(r,{board:n,hasMentions:!i.isAnonymous,hasMentionShortcut:o.mentionShortcut,sketchesDisabled:o["boards-rain-687-sunset-sketching"],hasEmojis:i&&!i.isAnonymous,hasItemInfo:i&&!i.isAnonymous,item:t,share:c,thumbnailerResizeEndpoint:s,user:i}):null)},_onChange:function(){return this.setState(i())}});t.exports=c},{"../stores/BoardStore":99,"./board/SingleItemView.jsx":69}],34:[function(e,t,n){function i(){var e=l.getSettings();return Object.assign({},e)}var o=React,r=o.PropTypes,a=o.createClass,s=ReactDOM,c=(s.findDOMNode,e("react-pure-render/mixin")),l=e("../../stores/BoardSettingsStore"),u=e("../../actions/BoardSettingsActionCreators"),h=e("../../../common/components/Checkbox.jsx"),d=e("./PasswordField.jsx"),p=e("./CopyField.jsx"),m=e("../../../common/components/Switch.jsx"),f=e("../../../common/components/ReactModal.jsx"),g=e("classnames"),v=a({displayName:"BoardSettings",propTypes:{closeSettingsModal:r.func.isRequired,isSettingsModalOpen:r.bool.isRequired,settings:r.object,title:r.string.isRequired,boardId:r.number.isRequired},getDefaultProps:function(){return{title:"Board Title"}},mixins:[c],getInitialState:function(){return Object.assign({},i(),{showSuccessMessage:!1})},componentDidUpdate:function(e,t){this.handleTracking(t)},componentWillMount:function(){l.listen(this.onBoardSettingsStoreChange)},componentWillUnmount:function(){l.unlisten(this.onBoardSettingsStoreChange),this.cancelCopyMessageReset()},handlePasswordChange:function(e){u.updateBoardPasswordToggle(e)},handleCollaboratorsChange:function(e){u.updateBoardCollaboratorsToggle(e)},handleSourceDownloadsChange:function(e){u.updateSourceFilesDownloadToggle(e)},handleImageDownloadsChange:function(e){u.updateImageDownloadToggle(e)},handleFontDownloadsChange:function(e){u.updateFontFilesDownloadToggle(e)},handleTracking:function(e){var t=this.state,n=t.isPasswordToggled,i=t.disableAllDownloads;e.usingDefaults||(n!==e.isPasswordToggled||i!==e.disableAllDownloads)&&this.trackPasswordAndDisableDownloadsToggle()},trackPasswordAndDisableDownloadsToggle:function(){var e=this.props,t=e.boardId,n=this.state,i=n.isPasswordToggled,o=n.disableAllDownloads,r=n.disableFontDownloads,a=n.disableImageDownloads,s=n.disableSourceDownloads;window.analytics&&window.analytics.track("Boards.ToggleSettings",{boardid:t,disableAllDownloads:o,disableFontDownloads:r,disableImageDownloads:a,disableSourceDownloads:s,enableBoardPassword:i},{integrations:{All:!1}})},trackSetPassword:function(){var e=this.props,t=e.boardId;window.analytics&&window.analytics.track("Boards.SetPassword",{boardid:t},{integrations:{All:!1}})},updateSuccessMessage:function(e){this.setState({showSuccessMessage:e})},cancelCopyMessageReset:function(){this.timeout&&(this.timeout=clearTimeout(this.timeout))},resetCopyMessage:function(){this.timeout=setTimeout(function(){this.setState({showSuccessMessage:!1})}.bind(this),3e3)},handleSave:function(){var e=this.props,t=e.closeSettingsModal;u.updateBoardSettings(this.state),t(),this.state.boardPassword&&this.trackSetPassword()},onBoardSettingsStoreChange:function(){return this.setState(i())},render:function(){var e=this.props,t=(e.boardId,e.isSettingsModalOpen),n=e.settings,i=n.shareUrl,o=e.title,r=this.state,a=r.disableAllDownloads,s=r.disableFontDownloads,c=r.disableImageDownloads,l=r.disableSourceDownloads,u=r.isPasswordToggled,v=r.showSuccessMessage,_=g({"has-checkboxes":a});return React.createElement(f,{isOpen:t,onRequestClose:this.handleSave},React.createElement("header",null,React.createElement("h2",null,"Update Board Settings")),React.createElement("h3",null,"Privacy Settings"),React.createElement("ul",{className:"list-settings"},React.createElement("li",{className:_},React.createElement("label",{htmlFor:"board-collaborators"},"Disable all downloads in share links"),React.createElement(m,{handleChange:this.handleCollaboratorsChange,checked:a,name:"board-collaborators"}),React.createElement("ul",{className:"board-checkboxes"},React.createElement("li",null,React.createElement(h,{labelText:"Allow Image Downloads",handleChange:this.handleImageDownloadsChange,checked:!c,name:"image-downloads"})),React.createElement("li",null,React.createElement(h,{labelText:"Allow Font Downloads",handleChange:this.handleFontDownloadsChange,checked:!s,name:"font-downloads"})),React.createElement("li",null,React.createElement(h,{labelText:"Allow Source File Downloads",handleChange:this.handleSourceDownloadsChange,checked:!l,name:"source-downloads"})))),React.createElement("li",null,React.createElement("label",{htmlFor:"board-password"},"Password-protect board in share links"),React.createElement(m,{handleChange:this.handlePasswordChange,checked:u,name:"board-password"})),u&&React.createElement("li",{className:"has-password"},React.createElement(d,null))),React.createElement("h3",null,"Copy Link to Share ",React.createElement("strong",null,o)),React.createElement(p,{cancelCopyMessageReset:this.cancelCopyMessageReset,resetCopyMessage:this.resetCopyMessage,shareUrl:i,showSuccessMessage:v,updateSuccessMessage:this.updateSuccessMessage}),React.createElement("div",{style:y.newWindow},React.createElement("a",{className:"open-in-new-window",href:i||"http://invisionapp.com/",target:"_blank"},"Open in a new window"),v&&React.createElement("p",{style:y.copied},"Copied to clipboard.")),React.createElement("button",{className:"btn -done",onClick:this.handleSave},"Save"))}});t.exports=v;var y={newWindow:{position:"relative"},copied:{position:"absolute",right:0,top:0}}},{"../../../common/components/Checkbox.jsx":116,"../../../common/components/ReactModal.jsx":118,"../../../common/components/Switch.jsx":121,"../../actions/BoardSettingsActionCreators":28,"../../stores/BoardSettingsStore":98,"./CopyField.jsx":40,"./PasswordField.jsx":66,classnames:4,"react-pure-render/mixin":23}],35:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=e("classie"),r=e("classnames"),a=e("../../utils/is"),s=e("react-pure-render/mixin"),c=e("../../../common/mixins/Tooltip"),l=e("../../utils/analytics.js"),u=React.createClass({displayName:"WarningTooltip",mixins:[c],render:function(){return React.createElement("span",{className:"warning-tooltip"},"?")},tooltipContent:function(){return React.createElement("span",null,"The administrator has disabled sharing to unauthenticated users")}}),h=React.createClass({displayName:"BoardShareOverlay",propTypes:{isShare:React.PropTypes.bool,boardID:React.PropTypes.number.isRequired,title:React.PropTypes.string.isRequired,description:React.PropTypes.string.isRequired,shareUrl:React.PropTypes.string.isRequired,companySettings:React.PropTypes.object},mixins:[s],componentDidMount:function(){ReactDOM.findDOMNode(this).addEventListener("click",this.handleOverlayClick,!1),l.trackGrowth("App - Projects - Open Public Share Modal",{"Project Type":"Board",Location:"Board Header"}),o.add(document.documentElement,"no-overflow");var e=this;setTimeout(function(){o.add(ReactDOM.findDOMNode(e).querySelector(".share-content"),"visible")},50),document.addEventListener("copy",this.copyToClipboard);var t=ReactDOM.findDOMNode(this.refs.shortlink);t.setSelectionRange(0,t.value.length)},copyToClipboard:function(e){copyToNativeClipboard(e,this.props.shareUrl),e.preventDefault(),o.add(ReactDOM.findDOMNode(this),"copied");var t=this;setTimeout(function(){t.isMounted()&&o.remove(ReactDOM.findDOMNode(t),"copied")},3e3),this.handleShortlinkCopy()},executeCopyCommand:function(){document.execCommand("copy")},handleShortlinkCopy:function(){window.analytics&&window.analytics.track("Boards.ShareBoard",{boardid:this.props.boardID,boardsShareType:"url",boardsShareLocation:this.props.isShare?"share":"edit"}),l.trackGrowth("App - Projects - Send Public Share",{"Share Channel":"url","Project Type":"Board"})},handleOpenLinkClick:function(){window.analytics&&window.analytics.track("Boards.ShareBoard",{boardid:this.props.boardID,boardsShareType:"open",boardsShareLocation:this.props.isShare?"share":"edit"})},componentWillUnmount:function(){ReactDOM.findDOMNode(this).removeEventListener("click",this.handleOverlayClick),document.removeEventListener("copy",this.copyToClipboard),o.remove(document.documentElement,"no-overflow")},handleOverlayClick:function(e){a(e.target,".share-content")||this.handleCloseClick()},handleCloseClick:function(){i.boardShareLoaded(null)},generateCompanyName:function(){return this.props.companySettings.name?this.props.companySettings.name:this.props.companySettings.companyName?this.props.companySettings.companyName:"your enterprise"},generateTwitterURL:function(){var e='View "'+this.props.title+"\" on @InVisionApp, the world's leading prototyping, collaboration & workflow platform. "+this.props.shareUrl;return e=encodeURIComponent(e),"https://twitter.com/home?status="+e},generateFacebookURL:function(){return"https://www.facebook.com/sharer/sharer.php?u="+this.props.shareUrl},generateLinkedInURL:function(){var e=encodeURIComponent(this.props.shareUrl),t=encodeURIComponent(this.props.title),n=encodeURIComponent(this.props.description?this.props.description:'View "'+this.props.title+"\" on InVision, the world's leading prototyping, collaboration & workflow platform."),i="InvisionApp";return"https://www.linkedin.com/shareArticle?mini=true&url="+e+"&title="+t+"&summary="+n+"&source="+i},generateGooglePlusURL:function(){return"https://plus.google.com/share?url="+this.props.shareUrl},render:function(){var e=this.props.companySettings.permissions.requireShareAuth,t=r({"share-overlay":!0,"show-warning":e});return React.createElement("div",{className:t},React.createElement("a",{onClick:this.handleCloseClick,className:"close","aria-hidden":"true"},"Close"),React.createElement("div",{className:"share-content",id:"board_share_overlay"},React.createElement("a",{className:"logo",href:"http://www.invisionapp.com/"}),React.createElement("h1",null,"Copy link to share ",React.createElement("strong",null,this.props.title)),e?React.createElement("div",{className:"warning"},React.createElement("p",null,"Viewers must be a member of "+this.generateCompanyName()+"'s InVision account",React.createElement(u,null))):null,React.createElement("div",{className:"share-form"},React.createElement("input",{type:"text",ref:"shortlink",value:this.props.shareUrl,readOnly:!0}),React.createElement("a",{"data-clipboard-text":this.props.shareUrl,className:"copy",onClick:this.executeCopyCommand}),React.createElement("div",{className:"copied-text"},"Copied to clipboard."),React.createElement("a",{className:"open-link",onClick:this.handleOpenLinkClick,href:this.props.shareUrl,target:"_blank"},"Open in new window"))),React.createElement("div",{className:"social"},React.createElement("a",{className:"twitter",target:"_blank",href:this.generateTwitterURL()},React.createElement("span",{className:"accessibility"},"Share on Twitter")),React.createElement("a",{className:"facebook",target:"_blank",href:this.generateFacebookURL()},React.createElement("span",{className:"accessibility"},"Share on Facebook")),React.createElement("a",{className:"linkedin",target:"_blank",href:this.generateLinkedInURL()},React.createElement("span",{className:"accessibility"},"Share on LinkedIn")),React.createElement("a",{className:"gplus",target:"_blank",href:this.generateGooglePlusURL()},React.createElement("span",{className:"accessibility"},"Share on Google Plus"))))}});t.exports=h},{"../../../common/mixins/Tooltip":124,"../../actions/BoardsActionCreators":29,"../../utils/analytics.js":105,"../../utils/is":111,classie:2,classnames:4,"react-pure-render/mixin":23}],36:[function(e,t,n){var i=e("classie"),o=React.createClass({displayName:"BulkColumns",handleColumnClick:function(e){this.props.onClick(parseInt(e.target.innerHTML,10))},removeHoverState:function(e){for(var t=e.parentNode.childNodes,n=0;n<t.length;n++)i.remove(t[n],"is-highlighted");i.remove(e.parentNode,"is-hovering")},handleMouseEnter:function(e){this.removeHoverState(e.target);var t=[],n=e.target.parentNode.firstChild;for(i.add(e.target.parentNode,"is-hovering");n&&1===n.nodeType&&n!==(e.target.nextElementSibling||e.target.nextSibling);)t.push(n),n=n.nextElementSibling||n.nextSibling;for(var o=0;o<t.length;o++)i.add(t[o],"is-highlighted")},handleMouseLeave:function(e){this.removeHoverState(e.target)},render:function(){var e=function(e,t){var n="";return t>=e&&(n+="active"),t===e&&(n+=" last"),n};return React.createElement("div",{className:"columns","data-title":this.props.title},React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(1,this.props.columnCount)},"1"),React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(2,this.props.columnCount)},"2"),React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(3,this.props.columnCount)},"3"),React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(4,this.props.columnCount)},"4"))}});t.exports=o},{classie:2}],37:[function(e,t,n){function i(e){return Rx.Observable.create(function(t){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){t.onNext(n),t.onCompleted(),n.onload=n.onerror=null},n.onerror=function(e){t.onError(e),n.onload=n.onerror=null},n.src=e})}var o=React,r=o.PropTypes,a=ReactDOM,s=a.findDOMNode,c=e("../../utils/canvas-image-functions"),l=c.Blur,u=e("../../actions/BoardsActionCreators"),h=new Rx.BehaviorSubject(1),d=h.distinctUntilChanged().flatMapLatest(i),p=new Rx.Subject,m=Rx.Observable.fromEvent(document,"mousemove"),f=Rx.Observable.fromEvent(document,"mouseup"),g={},v={},y={},_=0,E=!1,b=0,T=0,S=0,w=0,C=null,R=null,A={},D=React.createClass({displayName:"CanvasImage",propTypes:{blurAmount:r.number,image:r.string.isRequired,offset:r.number,size:r.number,tint:r.number},getInitialState:function(){return{isReady:!1,height:"100%",width:"100%",y:this.props.offset}},componentDidMount:function(){this.prepareValues(),this.saveDefaults(),h.onNext(this.props.image),this.imageFetcher$=d.subscribe(this.handleImageFetch,this.handleImageFetchFailure),this.initCanvasEvents(),this.handleResize(),this.startParallax()},componentDidUpdate:function(e,t){this.shouldFetchImage(e,t)},componentWillUnmount:function(){cancelAnimationFrame(_),this.handleUnsubscribe(),this.resetToDefaults()},handleImageFetch:function(e){this.img=e,this.setupImage()},handleImageFetchFailure:function(){},resetToDefaults:function(){this.oImg=this.img=null,C.style.webkitTransform=A.title.transform,C.style.msTransform=A.title.transform,C.style.transform=A.title.transform,C.style.opacity=A.title.opacity,R&&(R.style.webkitTransform=A.collaborators.transform,R.style.msTransform=A.collaborators.transform,R.style.transform=A.collaborators.transform,R.style.opacity=A.collaborators.opacity)},saveDefaults:function(){A.title={transform:C.style.transform||C.style.webkitTransform||C.style.msTransform||"",opacity:C.style.opacity},R&&(A.collaborators={transform:R.style.transform||R.style.webkitTransform||R.style.msTransform||"",opacity:R.style.opacity})},handleResize:function(){g=Rx.Observable.fromEvent(window,"resize").throttle(300).subscribe(function(){return this.requestTick(function(){return this.draw(!0)}.bind(this))}.bind(this))},handleUnsubscribe:function(){v.dispose&&v.dispose(),f.dispose&&f.dispose(),y.dispose&&y.dispose(),g.dispose&&g.dispose(),this.imageFetcher$.dispose&&this.imageFetcher$.dispose()},shouldFetchImage:function(e,t){this.prepareValues(),this.props.image!==e.image?h.onNext(this.props.image):this.shouldRedraw(e,t)},shouldRedraw:function(e,t){var n=this.state,i=n.isReady,o=n.y,r=this.props,a=r.size,s=r.blurAmount,c=r.offset;i&&(a!==e.size?this.setupImage():s!==e.blurAmount?this.requestTick(function(){return this.draw(!0)}.bind(this)):(c!==e.offset||o!==t.y)&&this.requestTick(function(){return this.draw(!1,!0)}.bind(this)))},prepareValues:function(){var e=this.state,t=e.y;C=document.querySelector(".board-title"),R=document.querySelector(".collaborators"),S=s(this).offsetHeight,w=-1*this.sanitizeOffset(t),T=window.innerWidth,b=window.innerHeight},setupImage:function(){var e=this.props,t=e.size,n=s(this.refs.canvas),i=(n.getContext("2d"),3===t?b:S),o=T,r=this.img.width/this.img.height,a=o/i;r>a?o=Math.round(this.img.width*i/this.img.height):i=Math.round(this.img.height*o/this.img.width),this.setState({height:i,width:o,isReady:!0},function(){this.requestTick(function(){return this.draw(!0)}.bind(this))}.bind(this))},cancelEvent:function(e){e.preventDefault(),e.stopPropagation()},requestTick:function(e){var t=this.state,n=t.isReady;!E&&n&&(E=!0,_=requestAnimationFrame(e))},draw:function(e,t){var n=this.props,i=n.blurAmount,o=this.state,r=o.width,a=o.height,c=s(this.refs.canvas),u=c.getContext("2d");u.clearRect(0,0,r,S),t?u.putImageData(this.oImg,0,w):u.drawImage(this.img,0,w,r,S),e&&(u.clearRect(0,0,r,a),u.drawImage(this.img,0,0,r,a),l(c,i),this.oImg=u.getImageData(0,0,r,a),u.clearRect(0,0,r,a),u.putImageData(this.oImg,0,w)),E=!1},startParallax:function(){var e=s(this.refs.canvas);y=Rx.Observable.interval(15).map(function(){return Math.max(0,Math.min(window.pageYOffset,S))}).distinctUntilChanged().filter(function(e){return S>=e}).subscribe(function(t){var n=.75*S,i=Math.round(.4*t),o=Math.round(.5*t),r=Math.max(0,Math.min((n-t)/n,1)),a=Math.max(0,Math.min((n-4*t)/n,1)),s="translate3d(0, "+i+"px, 0)",c="translate3d(-50%, calc(-50% + "+o+"px), 0)";e.style.webkitTransform=s,e.style.msTransform=s,e.style.transform=s,C.style.webkitTransform=c,C.style.msTransform=c,C.style.transform=c,C.style.opacity=r,C.style.display="block",0===r&&(C.style.display="none"),R&&(R.style.opacity=a,R.style.pointerEvents="auto",0===a&&(R.style.pointerEvents="none"))})},initCanvasEvents:function(){this.props.isShare||(v=p.flatMap(function(e){var t=e.clientY,n=f.subscribe(function(){u.setPhotoHeaderOffset(this.state.y),n.dispose()}.bind(this));return this.cancelEvent(e),m.map(function(e){var n=this.state,i=n.y,o=e.clientY-t,r=this.sanitizeOffset(i-o);return this.cancelEvent(e),t=e.clientY,r}.bind(this)).takeUntil(f)}.bind(this)),v.subscribe(function(e){this.setState({y:e})}.bind(this)))},sanitizeOffset:function(e){var t=this.props,n=t.size,i=this.state,o=i.height,r=3===n?o-b:o-S,a=Math.round(Math.max(0,Math.min(e,Math.abs(r))));return a},handleOnMouseDown:function(e){p.onNext(e)},render:function(){var e=this.props,t=(e.image,e.tint),n=e.isShare,i=this.state,o=i.height,r=i.isReady,a=i.width,s=Object.assign({},I.canvas,{height:o,width:a}),c=Object.assign({},I.overlay,{backgroundColor:"rgba(21, 25, 27, "+.01*t+")",cursor:n?"default":"move"}),l=Object.assign({},I.base,{opacity:r?1:0});return React.createElement("div",{onMouseDown:this.handleOnMouseDown,style:l},React.createElement("div",{style:c,ref:"overlay"}),React.createElement("canvas",{height:o,id:"canvas-image",ref:"canvas",style:s,width:a}))}});t.exports=D;var I={base:{borderBottom:"1px solid #eaecf1",height:"100%",left:0,overflow:"hidden",position:"absolute",top:0,WebkitTransition:"opacity 1200ms ease-in-out 0s",MsTransition:"opacity 1200ms ease-in-out 0s",transition:"opacity 1200ms ease-in-out 0s",width:"100%",zIndex:-1},overlay:{height:"100%",left:0,overflow:"hidden",position:"absolute",top:0,WebkitTransition:"background-color 250ms linear 0s",MsTransition:"background-color 250ms linear 0s",transition:"background-color 250ms linear 0s",width:"100%",zIndex:0},canvas:{left:0,overflow:"hidden",position:"absolute",top:0,zIndex:-2}}},{"../../actions/BoardsActionCreators":29,"../../utils/canvas-image-functions":107}],38:[function(e,t,n){var i=e("classnames"),o=e("../../../common/mixins/Tooltip"),r=e("../../../common/components/Avatar.jsx"),a=e("../../actions/BoardsActionCreators"),s=React.createClass({displayName:"BoardCollaborator",mixins:[o],handleClick:function(){a.addTeamMembers()},render:function(){var e=i({member:this.props.user&&this.props.user.name,pending:this.props.user&&this.props.user.memberEmail,"add-collab":!this.props.user});return React.createElement("a",{onClick:this.handleClick,className:e},this.props.user&&this.props.user.name?React.createElement(r,{user:this.props.user,size:39}):null)},tooltipContent:function(){var e;return this.props.user?this.props.user.memberEmail?e=this.props.user.memberEmail:this.props.user.name&&(e=this.props.user.name):e="Add / Remove People",React.createElement("span",null,e)}});t.exports=s},{"../../../common/components/Avatar.jsx":115,"../../../common/mixins/Tooltip":124,"../../actions/BoardsActionCreators":29,classnames:4}],39:[function(e,t,n){var i=(e("../../actions/BoardsActionCreators"),e("../../stores/BoardStore")),o=e("./RoundupComment.jsx"),r=e("../../../common/components/Loading.jsx"),a=e("classie"),s=function(){return{isLoading:i.getCommentsRoundupLoading()}},c=React.createClass({displayName:"CommentsRoundup",getInitialState:function(){return s()},getDefaultProps:function(){return{comments:[]}},componentDidMount:function(){i.addChangeListener(this._onChange),a.add(ReactDOM.findDOMNode(this),"open")},componentWillUnmount:function(){i.removeChangeListener(this._onChange)},render:function(){var e=this.props.comments.map(function(e,t){return React.createElement(o,{comment:e,key:t})});return e.length||(e=[React.createElement("div",{className:"no-comments"},React.createElement("h4",null,"0 Comments"),React.createElement("p",null,"There are no comments on any ",React.createElement("br",null),"items within this board."))]),React.createElement("section",{className:"board-comments-roundup board-menu"},React.createElement("div",{className:"scroll"},this.state.isLoading?React.createElement(r,null):[e]))},_onChange:function(){return this.setState(s())}});t.exports=c},{"../../../common/components/Loading.jsx":117,"../../actions/BoardsActionCreators":29,"../../stores/BoardStore":99,"./RoundupComment.jsx":68,classie:2}],40:[function(e,t,n){var i=React,o=i.createClass,r=i.PropTypes,a=ReactDOM,s=a.findDOMNode,c=e("react-pure-render/mixin"),l=e("classnames"),u=o({displayName:"CopyField",propTypes:{cancelCopyMessageReset:r.func.isRequired,resetCopyMessage:r.func.isRequired,shareUrl:r.string,showSuccessMessage:r.bool.isRequired,updateSuccessMessage:r.func.isRequired},mixins:[c],componentDidMount:function(){
this.setupClipboard()},componentWillUnmount:function(){this.destroyClipboard()},copyToClipboard:function(e){copyToNativeClipboard(e,this.props.shareUrl),e.preventDefault();var t=s(this.refs.shortlink);this.props.updateSuccessMessage(!0),this.props.cancelCopyMessageReset(),this.props.resetCopyMessage(),t.select()},executeCopyCommand:function(){document.execCommand("copy")},setupClipboard:function(){document.addEventListener("copy",this.copyToClipboard)},destroyClipboard:function(){document.removeEventListener("copy",this.copyToClipboard)},render:function(){var e=this.props,t=e.showSuccessMessage,n=e.shareUrl;return React.createElement("div",{className:"input"},React.createElement("input",{className:l({copied:t,zeroClipboardText:!0,shortlink:!0}),id:"shortlink",name:"shortlink",readOnly:!0,ref:"shortlink",type:"text",value:n||"http://invisionapp.com/"}),React.createElement("div",{className:"btn-container"},React.createElement("button",{ref:"copybtn",onClick:this.executeCopyCommand,className:l({copied:t,btn:!0,"-share":!0})},"Copy"),t&&React.createElement("span",{className:"copied-check"})))}});t.exports=u},{classnames:4,"react-pure-render/mixin":23}],41:[function(e,t,n){var i=e("classnames"),o=e("../../actions/BoardsActionCreators"),r=React.createClass({displayName:"EmptyBoard",triggerBrowse:function(){var e=this.props.board.groups[this.props.board.groups.length-1].id;o.triggerBrowse(e)},render:function(){var e=i({"empty-board":!0,"over-quota":this.props.board.isOverQuota});return React.createElement("div",{className:e},this.props.isShare?null:React.createElement("div",{className:"upload-prompt"},React.createElement("div",{className:"drag-drop"},"Drag & Drop"),React.createElement("p",null,"your files anywhere, or ",React.createElement("a",{onClick:this.triggerBrowse},"browse"))))}});t.exports=r},{"../../actions/BoardsActionCreators":29,classnames:4}],42:[function(e,t,n){var i=e("./Item.jsx"),o=e("../../constants/BoardsConstants"),r=e("../../../common/constants/UploaderConstants"),a=e("../../actions/BoardsActionCreators"),s=e("../../stores/BoardStore"),c=e("./Rename.jsx"),l=e("./GroupAction.jsx"),u=e("classnames"),h=e("classie"),d=e("./ItemPlaceholder.jsx"),p=e("../../utils/get-element-document-offset"),m=e("../../utils/animated-scroll-to"),f=e("immutable"),g=React.createClass({displayName:"BoardGroup",propTypes:{isShare:React.PropTypes.bool,isLoading:React.PropTypes.bool,isLast:React.PropTypes.bool,isFirst:React.PropTypes.bool,disableSync:React.PropTypes.bool},getDefaultProps:function(){return{disableSync:!1}},getInitialState:function(){return{dropAreaVisible:!1,headerOptionsOpen:!1,showGroupEditor:!1}},handleMouseMove:function(e){if(s.getDragState().item){var t=document.querySelector(".board-item[data-board-item-id='"+s.getDragState().item.id+"']"),n=this.refs.packer;if(t&&n){var i=n.getBoundingClientRect(),o=t.getBoundingClientRect(),r=1/this.props.zoom,c=Math.round(r*(o.left-i.left)),l=Math.round(r*(o.top-i.top));a.setDragState({newGroupID:this.props.group.id,x:c,y:l})}}},handleMouseUp:function(e){var t=s.getDragState();t.item&&t.newGroupID===this.props.group.id&&t.newGroupID!==t.initialGroupID&&(a.moveItemToGroup({item:t.item,newGroupID:this.props.group.id,selected:this.props.selectionStore.selected}),[].forEach.call(document.querySelectorAll(".board-item"),function(e){h.remove(e,"is-dragging")}),h.remove(document.body,"is-dragging"))},dragCancel:function(e){e.preventDefault()},fileDragEnter:function(e){e.preventDefault(),this.props.isFirst&&0===this.props.items.length||this.setState(ReactDOM.findDOMNode(this).contains(e.target)||ReactDOM.findDOMNode(this)===e.target?{dropAreaVisible:!0}:{dropAreaVisible:!1})},fileDragLeave:function(e){this.dragCancel(e),this.setState({dropAreaVisible:!1})},fileDrop:function(e){var t=ReactDOM.findDOMNode(this).querySelector(".upload-overlay");t&&(t=t.parentNode),e.dataTransfer.files&&e.dataTransfer.files.length&&(ReactDOM.findDOMNode(this).contains(e.target)||ReactDOM.findDOMNode(this)===e.target||t&&(t.contains(e.target)||t===e.target))&&a.startUpload(e.dataTransfer.files,this.props.group.id,this.props.group.items.length+1),this.fileDragLeave(e)},componentDidMount:function(){this.props.isShare||(document.addEventListener("dragenter",this.fileDragEnter,!1),document.addEventListener("dragover",this.dragCancel,!1),document.addEventListener("drop",this.fileDrop,!1))},componentWillReceiveProps:function(e){e.zoom<1&&this.state.headerOptionsOpen&&this.setState({headerOptionsOpen:!1})},componentWillUnmount:function(){this.props.isShare||(document.removeEventListener("dragenter",this.fileDragEnter),document.removeEventListener("dragover",this.dragCancel),document.removeEventListener("drop",this.fileDrop))},handleTitleUpdated:function(e){a.updateGroupTitle(this.props.group,e)},handleDescriptionUpdated:function(e){a.updateGroupDescription(this.props.group,e)},handleGroupUp:function(){return this.props.group.sort<=2?!1:void a.moveGroup(this.props.group,"up")},handleGroupDown:function(){return this.props.isLast?!1:void a.moveGroup(this.props.group,"down")},handleGroupDelete:function(){a.deleteGroup(this.props.group.id)},handleGroupItemUpload:function(){var e=this.props.group.id;a.triggerBrowse(e)},handleGroupNewNote:function(){a.openNewNoteModal(this.props.board,this.props.group)},handleGroupNewColor:function(){a.openNewColorModal(this.props.board,this.props.group)},handleSmoothScroll:function(e){m(p(e)-100)},handleAddGroup:function(e){this.handleSmoothScroll(e.target),a.addGroup(this.props.group)},handleAddTopGroup:function(e){this.handleSmoothScroll(e.target),a.addGroup({sort:0})},handleUpdatePosition:function(e){a.setBoardSortOrder({groupID:this.props.group.id,items:e})},sectionHoverTimeout:null,handleHeaderMouseEnter:function(){this.sectionHoverTimeout&&(clearTimeout(this.sectionHoverTimeout),this.sectionHoverTimeout=null),this.setState({showGroupEditor:!0})},handleHeaderMouseLeave:function(){if(this.state.headerOptionsOpen){var e=this;this.sectionHoverTimeout&&(clearTimeout(this.sectionHoverTimeout),this.sectionHoverTimeout=null),this.sectionHoverTimeout=setTimeout(function(){h.remove(ReactDOM.findDOMNode(e).querySelector(".edit-section"),"open"),setTimeout(function(){e.setState({showGroupEditor:!1,headerOptionsOpen:!1})},250)},1e3)}else this.setState({showGroupEditor:!1,headerOptionsOpen:!1})},toggleOptionsOpen:function(){this.setState({headerOptionsOpen:!this.state.headerOptionsOpen})},groupStyle:function(){var e,t=this.props.group.height?this.props.group.height:0;if(this.props.isLast&&0===this.props.items.length&&!this.props.isShare&&(t=0),!this.props.items||this.props.items.length>1)e=null;else if(1===this.props.items.length){var n=this.props.items[0].columns,i=[270,572,873,1176];e=i[n-1]}var o={height:t+"px"};return e&&(o.width=e+"px"),o},handleBoxClick:function(e){e.preventDefault();var t=document.getElementById("selective-sync-box");t.setAttribute("boardgroupid",this.props.group.id),t.click()},handleGDriveClick:function(e){e.preventDefault();var t=document.getElementById("selective-sync-gdrive");t.setAttribute("boardgroupid",this.props.group.id),t.click()},handleDropboxClick:function(e){e.preventDefault();var t=document.getElementById("selective-sync-dropbox");t.setAttribute("boardgroupid",this.props.group.id),t.click()},renderItems:function(){var e=_.sortBy(this.props.items,"sort"),t=e.map(function(e,t){var n=this.props.selectionStore.selected.indexOf(e.id)>=0,o=!isNaN(parseInt(e.id,10)),a=e.boardItemUploadState===r.uploadStates.PERM.id||""===e.boardItemUploadState||!!e.isProcessed,s=f.fromJS(e);return React.createElement(i,{isShare:this.props.isShare,item:s,canEdit:o,isProcessed:a,isSelected:n,zoom:this.props.zoom,multiSelected:this.props.selectionStore.selected.length>1,selected:this.props.selectionStore.selected,isSelectingBulkItems:this.props.isSelectingBulkItems,key:e.id,isLoading:this.props.isLoading,layoutTypeID:this.props.board.layoutTypeID,groupID:this.props.group.id})},this);return t},renderUploadOptions:function(){var e=[React.createElement(l,{key:"boxSync",onClick:this.handleBoxClick,className:"box",title:"Sync With Box"}),React.createElement(l,{key:"gdriveSync",onClick:this.handleGDriveClick,className:"gdrive",title:"Sync With Google Drive"}),React.createElement(l,{key:"dropboxSync",onClick:this.handleDropboxClick,className:"dropbox",title:"Sync With Dropbox"})];return React.createElement("div",null,this.props.disableSync?null:e,React.createElement(l,{onClick:this.handleGroupNewColor,className:"new-color-swatch",title:"Add A Color Swatch"}),React.createElement(l,{onClick:this.handleGroupNewNote,className:"new-note",title:"Add A Note"}),React.createElement(l,{onClick:this.handleGroupItemUpload,className:"upload-file",title:"Upload File"}),React.createElement("a",{className:"option-button option-close",onClick:this.toggleOptionsOpen}))},render:function(){var e=this.renderItems(),t=u({"board-items-section":!0,share:this.props.isShare,"top-section":0===this.props.groupKey,"no-items":!this.props.items||0===this.props.items.length,masonry:parseInt(this.props.board.layoutTypeID,10)===o.LAYOUT_TYPES.MASONRY,meticulous:parseInt(this.props.board.layoutTypeID,10)===o.LAYOUT_TYPES.METICULOUS,grid:parseInt(this.props.board.layoutTypeID,10)===o.LAYOUT_TYPES.GRID}),n=u({"board-items":!0,"single-item":1===this.props.items.length}),i=u({"board-section-up":!0,inactive:this.props.group.sort<=2}),r=u({"board-section-down":!0,inactive:this.props.isLast}),a=u({"no-header":!this.props.groupKey&&!this.props.group.description&&!this.props.group.title}),s=u({"section-header":!0,share:this.props.isShare}),h=this.groupStyle();return React.createElement("section",{onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,className:t},this.state.dropAreaVisible&&!this.props.isShare?React.createElement("div",{className:a},React.createElement("div",{className:"upload-overlay",onDragLeave:this.fileDragLeave}),React.createElement("div",{className:"upload-overlay-decoration"})):null,this.props.groupKey>0?React.createElement("header",{className:s,onMouseEnter:this.handleHeaderMouseEnter,onMouseLeave:this.handleHeaderMouseLeave},this.props.group.title||!this.props.isShare?React.createElement(c,{className:"title",onSubmit:this.handleTitleUpdated,allowEmpty:!0,allowEdit:1===this.props.zoom&&!this.props.isShare,charLimit:200,value:this.props.group.title,placeholder:"Add title here..."}):null,this.props.group.description||!this.props.isShare?React.createElement(c,{allowLineBreaks:!0,className:"description",parseLinks:!0,allowEmpty:!0,allowEdit:1===this.props.zoom&&!this.props.isShare,isEmpty:!this.props.group.description,onSubmit:this.handleDescriptionUpdated,value:this.props.group.description,placeholder:"Add a description here..."}):null,this.props.isShare?null:React.createElement("div",{className:"edit-section"+(this.state.showGroupEditor?" open":"")},this.state.headerOptionsOpen?this.renderUploadOptions():React.createElement("div",null,React.createElement(l,{onClick:this.handleGroupUp,className:i,title:"Move Section Up"}),React.createElement(l,{onClick:this.handleGroupDown,className:r,title:"Move Section Down"}),React.createElement(l,{onClick:this.handleGroupDelete,className:"board-delete-section",title:"Remove Section Title"}),1===this.props.zoom?React.createElement("a",{className:"option-button option-plus",onClick:this.toggleOptionsOpen}):null))):React.createElement("span",null,this.props.items.length>0&&1===this.props.zoom&&!this.props.isShare?React.createElement("div",{className:"group-placeholder top-placeholder"},React.createElement("div",{className:"gray-line"}," "),React.createElement("div",{className:"plus",onClick:this.handleAddTopGroup})):null),React.createElement("div",{id:"packer-"+this.props.group.id,className:n,style:h,ref:"packer"},e,this.props.group.placeholderActive&&!this.props.isShare?React.createElement(d,{width:this.props.group.placeholder.width,height:this.props.group.placeholder.height,x:this.props.group.placeholder.x,y:this.props.group.placeholder.y}):null),1!==this.props.zoom||this.props.isShare?null:React.createElement("div",{className:"group-placeholder"},React.createElement("div",{className:"gray-line"}," "),React.createElement("div",{className:"plus",onClick:_.throttle(this.handleAddGroup,1e3)})))}});t.exports=g},{"../../../common/constants/UploaderConstants":123,"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"../../utils/animated-scroll-to":106,"../../utils/get-element-document-offset":110,"./GroupAction.jsx":43,"./Item.jsx":47,"./ItemPlaceholder.jsx":59,"./Rename.jsx":67,classie:2,classnames:4,immutable:17}],43:[function(e,t,n){var i=e("../../../common/mixins/Tooltip"),o=React.createClass({displayName:"BoardGroupAction",mixins:[i],render:function(){return React.createElement("a",{onClick:this.props.onClick,className:this.props.className},React.createElement("span",{className:"icon"}))},tooltipContent:function(){return React.createElement("span",null,this.props.title)}});t.exports=o},{"../../../common/mixins/Tooltip":124}],44:[function(e,t,n){function i(){return{itemViewVisibility:l.getItemViewVisibility(),editHeaderOpen:l.getEditorState(),isDragging:l.getDragState(),addViewOpen:l.getAddViewOpenState(),baseBoardsRoute:l.getBaseBoardsRoute()}}var o=ReactDOM,r=o.findDOMNode;e("../../../common/utilities/request-animation-frame");var a,s=e("../../actions/BoardsActionCreators"),c=e("../../constants/BoardsConstants"),l=e("../../stores/BoardStore"),u=e("./TitleBar.jsx"),h=e("./HeaderImage.jsx"),d=e("./CommentsRoundup.jsx"),p=e("./SpaceLink.jsx"),m=e("classnames"),f=e("classie"),g=e("../../utils/animated-scroll-to"),v=e("../../utils/is"),y=e("../../utils/analytics.js"),E=React.createClass({displayName:"BoardHeader",propTypes:{board:React.PropTypes.object.isRequired,space:React.PropTypes.object,commentsRoundup:React.PropTypes.array,isShare:React.PropTypes.bool,user:React.PropTypes.object,zoom:React.PropTypes.number,shouldClose:React.PropTypes.bool,hasSpaces:React.PropTypes.bool,showBoardSpace:React.PropTypes.bool,disableSync:React.PropTypes.bool},getDefaultProps:function(){return{space:{},shouldClose:!1,disableSync:!1}},getInitialState:function(){return a=_.once(s.loadCommentsRoundup),_.assign(i(),{layoutTypeOpen:!1,commentsRoundupOpen:!1,addViewOpen:!1,isAffixed:!1,isVisible:!1})},componentDidMount:function(){l.addChangeListener(this._onChange),document.addEventListener("click",this.handleDocumentClick,!1),window.addEventListener("scroll",this.scrollHandler,!1),this.props.isShare||document.addEventListener("drop",this.handleFileDrop,!1)},componentWillUnmount:function(){l.removeChangeListener(this._onChange),s.setHeaderState(!1),document.removeEventListener("click",this.handleDocumentClick),window.removeEventListener("scroll",this.scrollHandler),this.props.isShare||document.removeEventListener("drop",this.handleFileDrop)},componentWillUpdate:function(e,t){t.itemViewVisibility.visible===this.state.itemViewVisibility.visible||t.itemViewVisibility.type!==c.ITEM_TYPES.COLOR&&t.itemViewVisibility.type!==c.ITEM_TYPES.NOTE||setTimeout(function(){this.setState({addViewOpen:!1})}.bind(this),300)},componentDidUpdate:function(e,t){setTimeout(function(){a()})},handleOverlayClick:function(){s.setHeaderState(!1)},handleDocumentClick:function(e){this.state.layoutTypeOpen?v(e.target,".layout-types .menu")||v(e.target,".layout-types a.title-link")||this.setState({layoutTypeOpen:!1}):this.state.commentsRoundupOpen&&(v(e.target,".board-comments-roundup")||v(e.target,".comments a.title-link")||this.setState({commentsRoundupOpen:!1}))},handleFileDrop:function(e){this.setState({addViewOpen:!1})},handleOpenShareOverlay:function(){y.trackGrowth("App - Projects - Click Share Button",{Location:"Board Header Share Button"}),s.triggerBoardShareOverlay(this.props.board.id)},handleOpenNewColorModal:function(){s.openNewColorModal(this.props.board)},handleOpenNewNoteModal:function(){s.openNewNoteModal(this.props.board)},handleAddClick:function(){if(this.state.editHeaderOpen)this.toggleEditPhotoHeader();else if(this.state.addViewOpen){var e=this;f.remove(document.querySelector(".add-view"),"visible"),setTimeout(function(){e.setState({addViewOpen:!1})},250)}else s.setHeaderState(!1),this.setState({addViewOpen:!0,layoutTypeOpen:!1,commentsRoundupOpen:!1},function(){var e=document.body,t=document.documentElement,n=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight);document.querySelector(".white-overlay").style.height=n+"px",f.add(document.querySelector(".add-view"),"visible");var i=ReactDOM.findDOMNode(this).offsetHeight,o=i-49;window.pageYOffset<o&&setTimeout(function(){g(o,null,400)},100)})},toggleEditPhotoHeader:function(){this.state.isAffixed&&!this.state.editHeaderOpen&&g(0),s.setHeaderState(!this.state.editHeaderOpen),this.setState({layoutTypeOpen:!1,commentsRoundupOpen:!1,addViewOpen:!1},function(){var e=document.querySelector(".board-header");(!this.state.editHeaderOpen||this.props.board.photoHeaderImageUrl)&&f.remove(e,"editing-image"),this.props.board.photoHeaderImageUrl||f.remove(e,"dark")})},toggleSetLayoutType:function(){s.setHeaderState(!1),this.setState({layoutTypeOpen:!this.state.layoutTypeOpen,commentsRoundupOpen:!1})},toggleCommentsRoundup:function(){s.setHeaderState(!1);var e=!this.state.commentsRoundupOpen;this.state.isAffixed&&(g(0),e=!0),this.setState({layoutTypeOpen:!1,commentsRoundupOpen:e})},handleSetLayoutType:function(e){s.setLayoutType(e),s.setHeaderState(!1),this.setState({layoutTypeOpen:!1,commentsRoundupOpen:!1})},triggerBrowse:function(){var e=this.props.board.groups[this.props.board.groups.length-1].id;s.triggerBrowse(e),this.setState({addViewOpen:!1})},closeBoardHeaderImageHandler:function(){s.setHeaderState(!1)},ticking:!1,lastScrollY:0,previousScrollPosition:0,scrollHandler:function(){this.lastScrollY=window.scrollY,this.requestTick()},requestTick:function(){this.ticking||(window.requestAnimationFrame(this.updatePosition),this.ticking=!0)},detectDirection:function(){var e=window.pageYOffset,t=e>this.previousScrollPosition?"down":"up";return this.previousScrollPosition=e,t},updatePosition:function(){var e=this.detectDirection(),t=document.querySelector(".board-details");if(t){var n=t.offsetTop,i=window.pageYOffset,o=!1,r=!1;return i>Math.min(300,n)&&(this.state.isDragging.item?o=!0:(o=!0,r=i>n&&"up"===e)),this.ticking=!1,this.setState({isAffixed:o,isVisible:r})}},scrollUp:function(){return g(0)},scrollToContent:function(){var e=document.documentElement,t=ReactDOM.findDOMNode(this).offsetHeight,n={pos:(window.pageYOffset||e.scrollTop)-(e.clientTop||0)},i=function(e,t){window.scrollTo(0,e.target[t])};TweenLite.to(n,1,{pos:t,onUpdate:i,onUpdateParams:["{self}","pos"],ease:Expo.easeOut})},handleBoxClick:function(e){e.preventDefault();var t=document.getElementById("selective-sync-box");t.setAttribute("boardgroupid",this.props.board.groups[0].id),t.click()},handleGDriveClick:function(e){e.preventDefault();var t=document.getElementById("selective-sync-gdrive");t.setAttribute("boardgroupid",this.props.board.groups[0].id),t.click()},handleDropboxClick:function(e){e.preventDefault();var t=document.getElementById("selective-sync-dropbox");t.setAttribute("boardgroupid",this.props.board.groups[0].id),t.click()},getHeader:function(){return r(this)},renderSidebarOptions:function(){var e=null;return this.props.disableSync||(e=[React.createElement("a",{key:"syncDropbox",className:"sidebar-option dropbox","data-title":"Sync With Dropbox",onClick:this.handleDropboxClick},React.createElement("div",{className:"sidebar-option-button"},"Dropbox"),React.createElement("i",null)),React.createElement("a",{key:"syncGDrive",className:"sidebar-option gdrive","data-title":"Sync With Google Drive",onClick:this.handleGDriveClick},React.createElement("div",{className:"sidebar-option-button"},"Google Drive"),React.createElement("i",null)),React.createElement("a",{key:"syncBox",className:"sidebar-option box","data-title":"Sync With Box",onClick:this.handleBoxClick},React.createElement("div",{className:"sidebar-option-button"},"Box"),React.createElement("i",null))]),React.createElement("div",{className:"sidebar-options"},React.createElement("a",{className:"sidebar-option new-note","data-title":"Add a Note",onClick:this.handleOpenNewNoteModal},React.createElement("div",{className:"sidebar-option-button"},"New Note"),React.createElement("i",null)),React.createElement("a",{className:"sidebar-option new-color","data-title":"Add a Color Swatch",onClick:this.handleOpenNewColorModal},React.createElement("div",{className:"sidebar-option-button"},"New Color"),React.createElement("i",null)),e)},render:function(){var e=this.props,t=e.commentsRoundup,n=e.board,i=e.openSettingsModal,o=parseInt(n.layoutTypeID,10),r=t.filter(function(e){return e.unreadNotification}).length,a=m({button:!0,add:!0,"header-image-close":!!this.state.editHeaderOpen,close:!!this.state.addViewOpen}),s=this.state.layoutTypeOpen?"menu board-menu open":"menu board-menu",l=m({"title-link":!0,active:!!this.state.layoutTypeOpen,masonry:o===c.LAYOUT_TYPES.MASONRY,meticulous:o===c.LAYOUT_TYPES.METICULOUS,grid:o===c.LAYOUT_TYPES.GRID}),f=m({masonry:!0,active:n.layoutTypeID===c.LAYOUT_TYPES.MASONRY}),g=m({meticulous:!0,active:n.layoutTypeID===c.LAYOUT_TYPES.METICULOUS}),v=m({grid:!0,active:n.layoutTypeID===c.LAYOUT_TYPES.GRID}),y=m({"title-link":!0,active:!!this.state.commentsRoundupOpen}),E=m({dark:n.photoHeaderImageUrl,"board-header":!0,wrap:!0,"has-image":!!n.photoHeaderImageUrl,"no-image":!this.props.board.photoHeaderImageUrl&&this.props.isShare,editing:!!this.state.editHeaderOpen,"editing-image":!!this.state.editHeaderOpen&&!n.photoHeaderImageUrl,"adding-new":this.state.addViewOpen,"has-spaces":this.props.hasSpaces}),b=m({"top-bar":!0,"is-visible":this.state.isVisible,"is-affixed":this.state.isAffixed}),T=m({"board-header-scroll":!0,"is-inverted":!!n.photoHeaderImageUrl}),S=!1,w="/d/main#"+this.state.baseBoardsRoute+"/"+this.props.board.id;if(this.props.user){var C=_.find(this.props.board.members,function(e){return e.id===this.props.user.id},this);C&&!this.props.isReviewer&&(S=!0)}var R=this.props.isShare?"http://www.invisionapp.com/":"#/";this.props.shouldClose&&(R="javascript: window.close()");var A=this.props.hasSpaces?React.createElement("svg",{width:"24px",height:"20px",viewBox:"0 2 24 20"},React.createElement("path",{d:"M20.0832,18.6842063 C20.0832,18.3992552 20.1472,18.0754473 20.2368,17.6868777 L21.248,13.9954667 C21.504,13.1276613 21.5936,12.3634745 21.5936,11.6510969 C21.5936,8.89225289 19.9424,7.45454545 17.9456,7.45454545 C16.0768,7.45454545 14.1696,9.1642516 13.2224,10.964624 L13.9136,7.7524488 L8.4864,7.7524488 L7.7312,10.601959 L10.2656,10.601959 L8.704,16.9097385 C7.4752,19.6685825 5.2224,19.6944872 4.9408,19.6297256 C4.48,19.526107 4.1856,19.3447745 4.1856,18.7360155 C4.1856,18.3863029 4.2496,17.8811625 4.4032,17.2724035 L6.784,7.73949648 L0.7552,7.73949648 L0,10.5890067 L2.5088,10.5890067 L0.896,17.2594511 C0.768,17.8034486 0.704,18.3733506 0.704,18.8525864 C0.704,20.743625 1.7152,22 3.8784,22 C5.6704,22 7.1168,20.9120052 8.1664,19.1763944 L7.5264,21.7409536 L11.072,21.7409536 L13.1072,13.5291832 C13.6192,11.4438598 14.592,10.3947219 16.0896,10.3947219 C17.2672,10.3947219 17.9968,11.1330041 17.9968,12.3505221 C17.9968,12.7002348 17.9712,13.0888043 17.8432,13.5032786 L16.7936,17.2853558 C16.64,17.8293532 16.576,18.3733506 16.576,18.8914434 C16.576,20.6918158 17.6256,22 19.8144,22 C21.6832,22 23.1808,20.782482 24,17.8552578 L22.6048,17.3112604 C21.888,19.2929653 21.2864,19.6426779 20.8128,19.6426779 C20.3392,19.6426779 20.0832,19.3188699 20.0832,18.6842063 L20.0832,18.6842063 L20.0832,18.6842063 L20.0832,18.6842063 Z M5.07692308,6.54545455 C6.34065934,6.54545455 7.38461538,5.55969332 7.38461538,4.27272727 C7.38461538,2.98576123 6.32692308,2 5.07692308,2 C3.81318681,2 2.76923077,2.98576123 2.76923077,4.27272727 C2.76923077,5.55969332 3.82692308,6.54545455 5.07692308,6.54545455 L5.07692308,6.54545455 L5.07692308,6.54545455 L5.07692308,6.54545455 Z",stroke:"none",fillRule:"evenodd"})):null;return React.createElement("header",{className:E,"data-size":n.photoHeaderSize},React.createElement("div",{className:b},React.createElement("div",{className:"logo-wrapper"},1===this.props.zoom?React.createElement("a",{className:"logo",href:R},A):React.createElement("div",{className:"logo"},A)),this.props.showBoardSpace?React.createElement(p,{board:n,space:this.props.space}):null,this.state.isAffixed&&React.createElement("div",{className:"top-bar-title"},React.createElement("div",{className:"top-bar-title-inner"},React.createElement("a",{onClick:this.scrollUp},n.title))),1===this.props.zoom?React.createElement("ul",{className:"actions"},this.props.isShare?S?React.createElement("li",{className:"edit-board"},React.createElement("a",{className:"title-link",href:w},"Edit")):null:React.createElement("span",null,React.createElement("li",{className:"edit-header"},React.createElement("a",{className:"title-link","data-title":"Edit Header",onClick:this.toggleEditPhotoHeader})),React.createElement("li",{className:"layout-types"},React.createElement("a",{className:l,"data-title":"Set Layout Type",onClick:this.toggleSetLayoutType}),React.createElement("ul",{className:s},React.createElement("li",{className:f},React.createElement("a",{onClick:this.handleSetLayoutType.bind(this,c.LAYOUT_TYPES.MASONRY)},React.createElement("span",{className:"menu-item-label"},"Masonry"))),React.createElement("li",{className:g},React.createElement("a",{onClick:this.handleSetLayoutType.bind(this,c.LAYOUT_TYPES.METICULOUS)},React.createElement("span",{className:"menu-item-label"},"Meticulous"))),React.createElement("li",{className:v},React.createElement("a",{onClick:this.handleSetLayoutType.bind(this,c.LAYOUT_TYPES.GRID)},React.createElement("span",{className:"menu-item-label"},"Grid"))))),React.createElement("li",{className:"settings"},React.createElement("a",{className:"title-link","data-title":"Settings",onClick:i}))),React.createElement("li",{className:"comments"},React.createElement("a",{className:y,"data-title":"Comments",onClick:this.toggleCommentsRoundup},r?React.createElement("span",{className:"count"},r):null)),React.createElement("li",{className:"share"},React.createElement("a",{className:"title-link","data-title":"Share",onClick:_.throttle(this.handleOpenShareOverlay,500)}))):null),this.state.commentsRoundupOpen?React.createElement(d,{comments:this.props.commentsRoundup}):null,React.createElement(u,{board:n,editingHeader:this.state.editHeaderOpen,isShare:this.props.isShare,zoom:this.props.zoom}),React.createElement(h,{isShare:this.props.isShare,photoHeaderURL:n.photoHeaderImageUrl,photoHeaderTint:n.photoHeaderTint,photoHeaderBlur:n.photoHeaderBlur,photoHeaderOffset:n.photoHeaderOffset,photoHeaderSize:n.photoHeaderSize,showOptions:this.state.editHeaderOpen&&1===this.props.zoom&&!this.props.isShare,getHeader:this.getHeader}),1!==this.props.zoom||this.props.isShare?null:React.createElement("a",{className:"button-wrapper",onClick:this.handleAddClick,role:"button"},React.createElement("div",{className:a},"New Board Item"),React.createElement("i",null)),3===n.photoHeaderSize&&!this.state.editHeaderOpen&&React.createElement("a",{className:T,onClick:this.scrollToContent},React.createElement("i",null),React.createElement("span",{className:"accessibility"},"Scroll to content")),this.state.addViewOpen?React.createElement("section",{className:"add-view"},React.createElement("div",{className:"upload-prompt"},React.createElement("div",{className:"drag-drop"},"Drag & Drop"),React.createElement("p",null,"your files anywhere, or ",React.createElement("a",{onClick:this.triggerBrowse},"browse"))),this.renderSidebarOptions(),React.createElement("div",{className:"white-overlay"})):null)},_onChange:function(){return this.setState(i())}});t.exports=E},{"../../../common/utilities/request-animation-frame":156,"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"../../utils/analytics.js":105,"../../utils/animated-scroll-to":106,"../../utils/is":111,"./CommentsRoundup.jsx":39,"./HeaderImage.jsx":45,"./SpaceLink.jsx":70,"./TitleBar.jsx":71,classie:2,classnames:4}],45:[function(e,t,n){var i=ReactDOM,o=i.findDOMNode,r=e("../../actions/BoardsActionCreators"),a=e("react-pure-render/mixin"),s=e("classie"),c=e("classnames"),l=e("./CanvasImage.jsx"),u=React.createClass({displayName:"HeaderImage",propTypes:{isShare:React.PropTypes.bool,getHeader:React.PropTypes.func.isRequired,showOptions:React.PropTypes.bool.isRequired,photoHeaderBlur:React.PropTypes.number,photoHeaderOffset:React.PropTypes.number,photoHeaderSize:React.PropTypes.number,photoHeaderTint:React.PropTypes.number,photoHeaderURL:React.PropTypes.string},mixins:[a],getInitialState:function(){return{editingImage:!1,editingBlur:!1,editingTint:!1,dropAreaVisible:!1,heroImageAnimatedIn:!1}},componentDidMount:function(){document.addEventListener("dragenter",this.fileDragEnter,!1),document.addEventListener("dragover",this.dragCancel,!1),document.addEventListener("drop",this.fileDrop,!1)},componentWillReceiveProps:function(e){e.showOptions===this.props.showOptions||e.showOptions||o(this.refs.overlay).removeEventListener("click",this.handleOverlayClick),e.showOptions||this.setState({editingImage:!1,editingBlur:!1,editingTint:!1,dropAreaVisible:!1})},componentDidUpdate:function(e,t){!this.props.showOptions||this.props.photoHeaderURL||this.state.editingImage||t.editingImage&&!e.photoHeaderURL||this.setState({editingImage:!0}),e.showOptions!==this.props.showOptions&&this.props.showOptions&&o(this.refs.overlay).addEventListener("click",this.handleOverlayClick,!1),this.setHeaderClass()},componentWillUnmount:function(){document.removeEventListener("dragenter",this.fileDragEnter),document.removeEventListener("dragover",this.dragCancel),document.removeEventListener("drop",this.fileDrop),s.remove(this.props.getHeader(),"editing-image"),this.refs.tintEditor&&o(this.refs.tintEditor)&&o(this.refs.tintEditor).removeEventListener("change",_.throttle(this.updateTintValue)),this.refs.blurEditor&&o(this.refs.blurEditor)&&o(this.refs.blurEditor).removeEventListener("change",_.throttle(this.updateBlurValue))},fileDragEnter:function(e){e.preventDefault();var t=this.props.getHeader();this.setState(t.contains(e.target)||t===e.target?{dropAreaVisible:!0}:{dropAreaVisible:!1})},dragCancel:function(e){e.preventDefault()},fileDragLeave:function(e){e&&this.dragCancel(e),this.setState({dropAreaVisible:!1,editingImage:!1},function(){this.handleEditingClass()}.bind(this))},fileDrop:function(e){this.state.dropAreaVisible&&e.dataTransfer.files&&e.dataTransfer.files.length&&(this.setState({dropAreaVisible:!1,editingImage:!1},function(){this.handleEditingClass()}.bind(this)),r.startHeaderUpload(e.dataTransfer.files)),this.fileDragLeave(e)},handleEditingClass:function(){this.state.editingImage?s.add(this.props.getHeader(),"editing-image"):s.remove(this.props.getHeader(),"editing-image")},handleOverlayClick:function(){this.setState({editingImage:!1,editingTint:!1,editingBlur:!1,dropAreaVisible:!1},function(){this.handleEditingClass(),r.setHeaderState(!1)}.bind(this))},setHeaderClass:function(){var e=this.props.getHeader();e&&(this.props.photoHeaderURL?s.add(e,"dark"):s.remove(e,"dark"))},toggleEditingImage:function(){this.setState({editingImage:!this.state.editingImage,editingTint:!1,editingBlur:!1,dropAreaVisible:!1},function(){this.handleEditingClass()}.bind(this))},triggerBrowse:function(){this.fileDragLeave(),r.triggerHeaderBrowse()},toggleEditingTint:function(){this.setState({editingImage:!1,editingTint:!this.state.editingTint,editingBlur:!1,dropAreaVisible:!1},function(){s.remove(this.props.getHeader(),"editing-image"),this.state.editingTint&&o(this.refs.tintEditor).addEventListener("change",_.throttle(this.updateTintValue),!1)})},updateTintValue:function(e){r.setPhotoHeaderTint(Math.round(e.target.value))},toggleEditingBlur:function(){
this.setState({editingImage:!1,editingTint:!1,editingBlur:!this.state.editingBlur,dropAreaVisible:!1},function(){s.remove(this.props.getHeader(),"editing-image"),this.state.editingBlur&&o(this.refs.blurEditor).addEventListener("change",_.throttle(this.updateBlurValue),!1)})},updateBlurValue:function(e){r.setPhotoHeaderBlur(Math.round(e.target.value))},handleSetSize:function(e){var t=1;if(e){var n=parseInt(e.target.getAttribute("data-size"),10);n&&(t=n)}r.setPhotoHeaderSize(t)},handleSizeMouseEnter:function(e){var t=+e.currentTarget.dataset.size,n=o(this.refs.sizing);n.dataset.headerSize=t},handleSizeMouseLeave:function(e){var t=o(this.refs.sizing);t.dataset.headerSize=this.props.photoHeaderSize},handleRemoveImage:function(){r.setPhotoHeaderSize(1),r.deleteHeaderImage(),this.setState({editingImage:!1},function(){var e=this.props.getHeader();s.remove(e,"dark")}.bind(this))},render:function(){var e=c({"header-image-options":!0,"has-image":this.props.photoHeaderURL});return h.header.marginLeft=this.props.photoHeaderURL?-183:-32,React.createElement("div",null,this.props.showOptions&&this.state.editingTint?React.createElement("input",{type:"range",min:0,max:100,step:1,defaultValue:this.props.photoHeaderTint,ref:"tintEditor"}):null,this.props.showOptions&&this.state.editingBlur?React.createElement("input",{type:"range",min:0,max:100,step:1,defaultValue:this.props.photoHeaderBlur,ref:"blurEditor"}):null,this.props.showOptions&&this.state.editingImage?React.createElement("div",{className:"upload-prompt"},React.createElement("div",{className:"drag-drop"},"Drag & Drop"),React.createElement("p",null,"an image here, or ",React.createElement("a",{onClick:this.triggerBrowse},"browse")),this.props.photoHeaderURL?React.createElement("a",{onClick:this.handleRemoveImage,className:"remove"},"Remove?"):null):null,this.props.showOptions?React.createElement("section",{className:e},this.props.photoHeaderURL?React.createElement("div",null,React.createElement("a",{className:"image"+(this.state.editingImage?" active":""),onClick:this.toggleEditingImage},React.createElement("i",{className:"icon"}),React.createElement("div",{className:"base"}),React.createElement("span",{className:"label"},"Image")),React.createElement("a",{className:"blur"+(this.state.editingBlur?" active":""),onClick:this.toggleEditingBlur},React.createElement("i",{className:"icon"}),React.createElement("div",{className:"base"}),React.createElement("span",{className:"label"},"Blur")),React.createElement("a",{className:"tint"+(this.state.editingTint?" active":""),onClick:this.toggleEditingTint},React.createElement("i",{className:"icon"}),React.createElement("div",{className:"base"}),React.createElement("span",{className:"label"},"Overlay"))):null,this.props.photoHeaderURL?React.createElement("div",{className:"size"},React.createElement("div",{className:"icon"},React.createElement("div",{ref:"sizing",className:"sizing","data-header-size":this.props.photoHeaderSize},React.createElement("a",{"data-size":"1",onMouseEnter:this.handleSizeMouseEnter,onMouseLeave:this.handleSizeMouseLeave,onClick:this.handleSetSize}),React.createElement("a",{"data-size":"2",onMouseEnter:this.handleSizeMouseEnter,onMouseLeave:this.handleSizeMouseLeave,onClick:this.handleSetSize}),React.createElement("a",{"data-size":"3",onMouseEnter:this.handleSizeMouseEnter,onMouseLeave:this.handleSizeMouseLeave,onClick:this.handleSetSize}))),React.createElement("div",{className:"base"}),React.createElement("div",{className:"label"},"Size")):null,React.createElement("div",{className:"white-overlay",ref:"overlay"})):null,this.props.photoHeaderURL?React.createElement(l,{isShare:this.props.isShare,blurAmount:this.props.photoHeaderBlur,image:this.props.photoHeaderURL,isEditing:this.state.editingImage,isShowingOptions:this.props.showOptions,offset:this.props.photoHeaderOffset,size:this.props.photoHeaderSize,tint:this.props.photoHeaderTint}):null,this.props.showOptions&&this.state.dropAreaVisible?React.createElement("div",null,React.createElement("div",{className:"upload-overlay",onDragLeave:this.fileDragLeave}),React.createElement("div",{className:"upload-overlay-decoration"})):null)}}),h={header:{}};t.exports=u},{"../../actions/BoardsActionCreators":29,"./CanvasImage.jsx":37,classie:2,classnames:4,"react-pure-render/mixin":23}],46:[function(e,t,n){var i=e("../../../common/mixins/Tooltip"),o=React.createClass({displayName:"IncompleteDownloadLink",mixins:[i],render:function(){return React.createElement("div",null,React.createElement("a",{className:this.props.className},"Download"))},tooltipContent:function(){return React.createElement("span",null,this.props.title)}});t.exports=o},{"../../../common/mixins/Tooltip":124}],47:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=e("../../constants/BoardsConstants"),r=e("../../stores/BoardStore"),a=e("./ItemOverlay.jsx"),s=e("classnames"),c=e("./item-types/Image.jsx"),l=e("./item-types/SourceFile.jsx"),u=e("./item-types/Note.jsx"),h=e("./item-types/Color.jsx"),d=e("./item-types/File.jsx"),p=e("./item-types/Font.jsx"),m=e("../../mixins/ItemDragMixin.jsx"),f=React.createClass({displayName:"BoardItem",propTypes:{isShare:React.PropTypes.bool,canEdit:React.PropTypes.bool.isRequired,groupID:React.PropTypes.number.isRequired,isLoading:React.PropTypes.bool.isRequired,isProcessed:React.PropTypes.bool.isRequired,isSelectingBulkItems:React.PropTypes.bool,item:React.PropTypes.object.isRequired,layoutTypeID:React.PropTypes.number.isRequired,multiSelected:React.PropTypes.bool.isRequired,selected:React.PropTypes.array,isSelected:React.PropTypes.bool.isRequired,zoom:React.PropTypes.number},mixins:[m],getInitialState:function(){return{isDragging:!1,isDropping:!1,x:0,y:0}},shouldComponentUpdate:function(e,t){var n=Object.keys(this.props);if(n.length!==Object.keys(e).length)return!0;for(var i=0;i<n.length;i++)if("item"===n[i]){if(!this.props.item.equals(e.item))return!0}else if(!_.isEqual(this.props[n[i]],e[n[i]]))return!0;return this.state.isDragging!==t.isDragging||this.state.isDropping!==t.isDropping?!0:!1},renderItemContent:function(){var e=this.props.item.get("itemTypeID");return e===o.ITEM_TYPES.IMAGE?React.createElement(c,{columns:this.props.item.get("columns"),imageUrl:this.props.item.getIn(["metaData","imageUrl"]),itemHeight:this.props.item.get("height"),itemWidth:this.props.item.get("width"),layoutTypeID:this.props.item.get("layoutTypeID"),naturalHeight:this.props.item.getIn(["metaData","height"]),naturalWidth:this.props.item.getIn(["metaData","width"]),thumbnailFullUrl:this.props.item.getIn(["metaData","thumbnailFullUrl"]),title:this.props.item.get("title")}):r.getIsValidSourceFile(this.props.item.toJS())?React.createElement(l,{filename:this.props.item.get("clientFilename"),itemWidth:this.props.item.get("width"),itemHeight:this.props.item.get("height"),columns:parseInt(this.props.item.get("columns"),10),thumbnailFullUrl:this.props.item.getIn(["metaData","thumbnailFullUrl"]),downloadUrl:this.props.item.getIn(["metaData","downloadUrl"])}):e===o.ITEM_TYPES.NOTE?React.createElement(u,{title:this.props.item.get("title"),note:this.props.item.getIn(["metaData","note"])}):e===o.ITEM_TYPES.COLOR?React.createElement(h,{title:this.props.item.get("title"),color:this.props.item.getIn(["metaData","color"])}):e>3&&e!==o.ITEM_TYPES.FONT?React.createElement(d,{title:this.props.item.get("title"),filename:this.props.item.getIn(["metaData","clientFilename"])}):e===o.ITEM_TYPES.FONT?React.createElement(p,{title:this.props.item.get("title"),filename:this.props.item.getIn(["metaData","clientFilename"]),downloadUrl:this.props.item.getIn(["metaData","downloadUrl"])}):null},render:function(){var e=this.props.item.get("itemTypeID"),t={"is-share":this.props.isShare,"board-item":!0,"is-selected":this.props.isSelected,"multi-selected":this.props.isSelected&&(this.props.multiSelected||this.props.isSelectingBulkItems),"full-note":e===o.ITEM_TYPES.NOTE&&4===parseInt(this.props.item.get("columns"),10),"no-border":1===e&&this.props.item.hasIn(["metaData","hasTransparentCorners"])&&!!this.props.item.getIn(["metaData","hasTransparentCorners"]),"is-dragging":this.state.isDragging,"is-dropping":this.state.isDropping};t["board-item-"+this.props.groupID]=!0;var n,i=s(t),r=s({"item-content":!0,"item-photo":1===e,"item-note":2===e,"item-color":3===e,"item-file":e>3}),c=this.renderItemContent(),l={height:this.props.item.get("height")+"px",width:this.props.item.get("width")+"px"},u=!1;if(this.state.isDragging)u=!0,l.pointerEvents="none",l.zIndex=99999,l.position="fixed",l.top=0,l.left=0,n="translate("+this.state.x+"px, "+this.state.y+"px)",this.isIE()&&(n=this.setIETransform(this.state.x,this.state.y));else{var h=this.props.item.get("x"),d=this.props.item.get("y");n="translate("+h+"px, "+d+"px)"}return l.WebkitTransform=n,l.msTransform=n,l.transform=n,this.props.item.has("isMovingToGroup")&&this.props.item.get("isMovingToGroup")&&(l.transition="none"),React.createElement("div",{className:i,style:l,onClick:this.handleItemClick,onMouseDown:this.dragStart,"data-sort":this.props.item.get("sort"),"data-board-item-id":this.props.item.get("id"),"data-columns":this.props.item.get("columns")},this.props.multiSelected&&u?React.createElement("div",{className:"multi-selected-overlay"},React.createElement("span",{className:"label"},"Moving ",this.props.selected.length," items")):null,React.createElement("div",{className:r},this.props.isSelectingBulkItems||!this.props.canEdit?null:React.createElement(a,{isShare:this.props.isShare,zoom:this.props.zoom,item:this.props.item,isProcessed:this.props.isProcessed}),c))},handleItemClick:function(e){this.props.isShare&&i.gotoBoardItem(this.props.item.get("id"))}});t.exports=f},{"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../mixins/ItemDragMixin.jsx":95,"../../stores/BoardStore":99,"./ItemOverlay.jsx":58,"./item-types/Color.jsx":75,"./item-types/File.jsx":76,"./item-types/Font.jsx":77,"./item-types/Image.jsx":78,"./item-types/Note.jsx":79,"./item-types/SourceFile.jsx":80,classnames:4}],48:[function(e,t,n){var i=e("../../../common/mixins/Tooltip"),o=e("classie"),r=React.createClass({displayName:"BoardItemAction",mixins:[i],handleColumnClick:function(e){this.props.onClick(parseInt(e.target.innerHTML,10))},removeHoverState:function(e){for(var t=e.parentNode.childNodes,n=0;n<t.length;n++)o.remove(t[n],"is-highlighted");o.remove(e.parentNode.parentNode,"is-hovering")},handleMouseEnter:function(e){this.removeHoverState(e.target);var t=[],n=e.target.parentNode.firstChild;for(o.add(e.target.parentNode.parentNode,"is-hovering");n&&1===n.nodeType&&n!==(e.target.nextElementSibling||e.target.nextSibling);)t.push(n),n=n.nextElementSibling||n.nextSibling;for(var i=0;i<t.length;i++)o.add(t[i],"is-highlighted")},handleMouseLeave:function(e){this.removeHoverState(e.target)},render:function(){var e=function(e,t){var n="";return t>=e&&(n+="active"),t===e&&(n+=" last"),n},t={};if(this.props.zoom<1&&"columns"===this.props.className){var n="scale("+1/this.props.zoom+")";t={WebkitTransform:n,transform:n,WebkitTransformOrigin:"top right",transformOrigin:"top right"}}return React.createElement("li",{className:this.props.className,style:t},"columns"===this.props.className?React.createElement("span",null,React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(1,this.props.columnCount)},"1"),React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(2,this.props.columnCount)},"2"),React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(3,this.props.columnCount)},"3"),React.createElement("a",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleColumnClick,className:e(4,this.props.columnCount)},"4")):React.createElement("a",{className:this.props.className,onClick:this.props.onClick},this.props.title))},tooltipContent:function(){return React.createElement("span",null,this.props.title)}});t.exports=r},{"../../../common/mixins/Tooltip":124,classie:2}],49:[function(e,t,n){var i=e("classnames"),o=!1,r=React.createClass({displayName:"ItemAnnotation",propTypes:{showSidebar:React.PropTypes.bool,visible:React.PropTypes.bool,canEdit:React.PropTypes.bool,inactive:React.PropTypes.bool,passThrough:React.PropTypes.bool,active:React.PropTypes.bool,label:React.PropTypes.string,naturalWidth:React.PropTypes.number,naturalHeight:React.PropTypes.number,x:React.PropTypes.number,y:React.PropTypes.number,onEditAnnotation:React.PropTypes.func,onSetHighlightedComment:React.PropTypes.func,activeAnnotation:React.PropTypes.object,imageSelector:React.PropTypes.string},componentDidMount:function(){this.setMarkerPosition(),window.addEventListener("resize",this.resizeHandler,!1),document.addEventListener("mousemove",this.handleMouseMove,!1),document.addEventListener("mouseup",this.handleMouseUp,!1)},componentWillUpdate:function(e){if(this.props.showSidebar!==e.showSidebar){var t=ReactDOM.findDOMNode(this);this.props.showSidebar?(t.style.webkitTransitionDelay="0s",t.style.transitionDelay="0s"):(t.style.webkitTransitionDelay="0.35s",t.style.transitionDelay="0.35s")}},componentDidUpdate:function(e){if(this.setMarkerPosition(),e.showSidebar!==this.props.showSidebar){var t=ReactDOM.findDOMNode(this);setTimeout(function(){this.setMarkerPosition(),t.style.webkitTransitionDelay="0s",t.style.transitionDelay="0s"}.bind(this),310)}},componentWillUnmount:function(){window.removeEventListener("resize",this.resizeHandler),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)},render:function(){var e=i({"annotation-marker":!0,unclosable:!0,visible:this.props.visible&&this.props.showSidebar,"can-edit":this.props.canEdit,inactive:!!this.props.inactive}),t={};return this.props.passThrough&&(t.pointerEvents="none"),this.props.canEdit&&(t.zIndex=12),React.createElement("div",{style:t,className:e,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseDown:this.handleMouseDown},this.props.label)},handleMouseDown:function(e){this.props.canEdit&&(o=!0)},handleMouseMove:function(e){this.props.canEdit&&o&&(e.preventDefault(),this.setMarkerPosition(e.clientX,e.clientY))},handleMouseUp:function(e){if(this.props.canEdit&&o){o=!1;var t=document.querySelector(this.props.imageSelector),n=t.getBoundingClientRect(),i=Math.min(n.left+t.offsetWidth,Math.max(e.clientX,n.left)),r=Math.min(n.top+t.offsetHeight,Math.max(e.clientY,n.top)),a=Math.floor((i-n.left)*this.props.naturalWidth/t.offsetWidth),s=Math.floor((r-n.top)*this.props.naturalHeight/t.offsetHeight);this.props.onEditAnnotation(a,s)}},handleMouseEnter:function(e){this.props.activeAnnotation||this.props.canEdit||(this.setMarkerPosition(null,null,!0),this.props.onSetHighlightedComment(this.props.label))},handleMouseLeave:function(e){this.props.canEdit||(this.setMarkerPosition(null,null,!1),this.props.onSetHighlightedComment(null))},resizeHandler:function(){this.setMarkerPosition()},setMarkerPosition:function(e,t,n){var i=document.querySelector(this.props.imageSelector);if(i){var o=i.getBoundingClientRect(),r=ReactDOM.findDOMNode(this),a=this.props.x*i.offsetWidth/this.props.naturalWidth+o.left,s=this.props.y*i.offsetHeight/this.props.naturalHeight+o.top;e&&t&&(a=Math.min(o.left+i.offsetWidth,Math.max(e,o.left)),s=Math.min(o.top+i.offsetHeight,Math.max(t,o.top)));var c="translate("+Math.floor(a)+"px, "+Math.floor(s)+"px)";(this.props.canEdit||this.props.active||n)&&(c+=" scale(1.22)"),r.style.webkitTransform=c,r.style.msTransform=c,r.style.transform=c}}});t.exports=r},{classnames:4}],50:[function(e,t,n){var i=e("./ItemAnnotation.jsx"),o=e("classnames"),r=React.createClass({displayName:"ItemAnnotations",propTypes:{isEditingAnnotations:React.PropTypes.bool,annotations:React.PropTypes.array,activeAnnotation:React.PropTypes.object,visibleSketch:React.PropTypes.bool,loaded:React.PropTypes.bool,showSidebar:React.PropTypes.bool,naturalWidth:React.PropTypes.number,naturalHeight:React.PropTypes.number,onEditAnnotation:React.PropTypes.func,onSetHighlightedComment:React.PropTypes.func,followerActive:React.PropTypes.bool,followerX:React.PropTypes.number,followerY:React.PropTypes.number,imageSelector:React.PropTypes.string},renderAnnotations:function(){if(this.props.annotations){var e=this.props.annotations.map(function(e,t){return React.createElement(i,{key:t,showSidebar:this.props.showSidebar,visible:this.props.loaded,canEdit:e.canEdit,inactive:!(!this.props.visibleSketch&&!this.props.activeAnnotation||e.active),passThrough:!!this.props.isEditingAnnotations,active:e.active,label:e.label,naturalWidth:this.props.naturalWidth,naturalHeight:this.props.naturalHeight,x:e.x,y:e.y,onEditAnnotation:this.props.onEditAnnotation,onSetHighlightedComment:this.props.onSetHighlightedComment,activeAnnotation:this.props.activeAnnotation,imageSelector:this.props.imageSelector})},this);return e}return null},render:function(){var e=this.renderAnnotations(),t=this.followerStyle(),n=o({"cursor-follower":!0,visible:this.props.followerActive});return React.createElement("div",null,this.props.isEditingAnnotations?React.createElement("span",null,React.createElement("div",{className:"editing-annotation-header"},React.createElement("svg",{viewBox:"0 0 23 23",onClick:this.handleIconClick},React.createElement("circle",{cx:"11.5",cy:"11.5",r:"8.1"}),React.createElement("line",{fill:"none",x1:"11.5",y1:"0.5",x2:"11.5",y2:"6.2"}),React.createElement("line",{fill:"none",x1:"0.5",y1:"11.5",x2:"6.2",y2:"11.5"}),React.createElement("line",{fill:"none",x1:"11.5",y1:"22.5",x2:"11.5",y2:"16.8"}),React.createElement("line",{fill:"none",x1:"22.5",y1:"11.5",x2:"16.8",y2:"11.5"})),"Click anywhere on the image to add an annotation"),React.createElement("div",{className:n,style:t},"Click to Add Annotation")):null,e)},followerStyle:function(){var e=this.props.followerX+16,t=this.props.followerY-12,n="translate("+e+"px, "+t+"px)";return{WebkitTransform:n,msTransform:n,transform:n}}});t.exports=r},{"./ItemAnnotation.jsx":49,classnames:4}],51:[function(e,t,n){var i=e("classnames"),o=e("classie"),r=e("../../actions/BoardsActionCreators"),a=e("../../constants/BoardsConstants"),s=React.createClass({displayName:"ItemColorBar",processingColor:null,boardColors:[],componentDidMount:function(){this.setImageColors(),this.updateColors()},componentDidUpdate:function(e){e.item.id!==this.props.item.id&&this.setImageColors()},setImageColors:function(){if(!this.props.colors||0===this.props.colors.length){var e=this;setTimeout(function(){r.setImageColors(e.props.item)})}},handleAddColor:function(e){if(!this.props.isShare){this.processingColor=e.target.style.backgroundColor,this.processingColor=this.processingColor.replace("rgb(",""),this.processingColor=this.processingColor.replace(")",""),this.processingColor=this.processingColor.split(", ");var t="#";if(this.processingColor.forEach(function(e){var n=parseInt(e,10),i=n.toString(16);1===i.length&&(i="0"+i),t+=i}),this.processingColor=t,!(this.boardColors.indexOf(this.processingColor)>=0)){var n=1,i=_.find(this.props.board.groups,function(e){return e.id===this.props.item.groupID},this);i.items.forEach(function(e){e.sort>=n&&(n=e.sort+1)}),r.addColorFromBar(this.processingColor,this.props.item,n);var a=this;o.add(e.target,"added"),a.boardColors.push(this.processingColor),a.processingColor=null}}},updateColors:function(){this.props.board&&this.props.board.groups&&this.props.board.groups.forEach(function(e){e.items&&e.items.length>0&&e.items.forEach(function(e){if(e.itemTypeID===a.ITEM_TYPES.COLOR){var t=e.metaData.color;-1===this.boardColors.indexOf(t)&&this.boardColors.push(t)}},this)},this)},renderColors:function(){this.updateColors();var e=this.props.item.metaData.imagecolors.map(function(e){var t={backgroundColor:e},n=i({color:!0,added:this.boardColors.indexOf(e)>=0,processing:this.processingColor===e});return React.createElement("div",{key:e,className:n,title:e,onClick:this.handleAddColor,style:t})},this);return e},render:function(){var e=this.renderColors(),t=i({"color-bar":!0,share:this.props.isShare});return React.createElement("div",{className:t},e)}});t.exports=s},{"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,classie:2,classnames:4}],52:[function(e,t,n){var i=e("../../../common/components/Avatar.jsx"),o=(e("../../../common/react-components/comment-editor/utils/CommentUtilities"),e("../../../common/react-components/comment-editor/components/CommentEditor.jsx")),r=e("../../../common/react-components/comment-editor/stores/CommentStore"),a=e("../../../common/react-components/comment-editor/actions/CommentActions"),s=e("../../../common/react-components/comment-editor/stores/MentionStore"),c=e("../../../common/react-components/comment-editor/actions/MentionActions"),l=e("../../../common/utilities/date-helper"),u=e("../../constants/BoardsConstants"),h=e("../../actions/BoardsActionCreators"),d=(e("../../../common/utilities/parse-links"),e("./ItemCommentsSketch.jsx")),p=e("../../stores/BoardStore"),m=e("./ItemCommentsAnnotations.jsx"),f=e("../../../common/ng-components/comment/services/parseCommentService"),g=e("classnames"),v=e("classie"),y=React.createClass({displayName:"ItemComment",getInitialState:function(){return{showOptionMenuToggle:!1,showOptionMenu:!1,editingComment:!1,commentSVG:this.props.comment.svg}},componentWillReceiveProps:function(e){e.comment.svg!==this.props.comment.svg&&this.setState({commentSVG:e.comment.svg})},componentDidUpdate:function(e){!e.closeEditor&&this.props.closeEditor&&this.cancelCommentEditor()},commentTimestamp:function(){return l.formatRelativeWithinMonth(this.props.comment.updatedAt)},handleCommentMouseEnter:function(){this.setState({showOptionMenuToggle:!0}),v.add(ReactDOM.findDOMNode(this),"highlighted");var e=p.getActiveAnnotation();e&&e.canEdit||(this.props.comment.hasAnnotation||this.state.commentSVG?(this.props.comment.hasAnnotation?h.viewAnnotation(this.props.comment.id):h.removeAnnotation(),h.viewSketch(this.state.commentSVG&&!this.props.sketchesDisabled?this.props.comment.id:null)):(h.viewSketch(null),h.removeAnnotation()))},handleCommentMouseLeave:function(){this.setState({showOptionMenuToggle:!1,showOptionMenu:!1});var e=ReactDOM.findDOMNode(this);v.has(e,"highlighted")&&v.remove(e,"highlighted")},toggleCommentMenu:function(e){var t=e.target.getBoundingClientRect();this.setState({showOptionMenu:!this.state.showOptionMenu},function(){this.state.showOptionMenu&&(ReactDOM.findDOMNode(this).querySelector(".option-menu").style.top=t.top+16+"px")})},handleEditComment:function(){this.setState({editingComment:!0,showOptionMenu:!1},function(){this.setScrollingSize(),a.setCurrentComment(this.props.comment.comment,[]),setTimeout(function(){c.rebuildMentionsFromComment(this.props.comment.comment)}.bind(this),300),this.state.commentSVG&&h.setActiveSketch(this.state.commentSVG)}.bind(this)),this.props.onOpenEditor(this.props.comment.id)},handleCommentKeydown:function(e){e.metaKey&&13===e.which?this.saveCommentUpdate():this.setScrollingSize(e)},setScrollingSize:function(e){var t=e?e.target:ReactDOM.findDOMNode(this.refs.commentEditor);t.scrollHeight>=t.offsetHeight?v.add(t.parentNode,"scrolling"):v.remove(t.parentNode,"scrolling")},saveCommentUpdate:function(){var e=ReactDOM.findDOMNode(this);v.has(e,"highlighted")&&v.remove(e,"highlighted");var t=r.getCommentContent();if(t&&""!==t){var n=p.getActiveAnnotation(),i=!1,o=0,a=0,c=0,l=p.getActiveSketch(),u=this.props.comment.sketchID?this.props.comment.sketchID:null;n&&n.canEdit&&(i=!0,o=n.x,a=n.y,c=n.label);var d=s.getMentions();h.updateComment(this.props.comment.id,t,i,o,a,c,this.props.comment.hasAnnotation,u,l,d),this.setState({editingComment:!1,showOptionMenuToggle:!1,showOptionMenu:!1,commentSVG:l},function(){h.removeAnnotation(),h.setActiveSketch("")})}},cancelCommentEditor:function(){h.removeAnnotation(),h.loadAnnotations();var e=ReactDOM.findDOMNode(this);v.has(e,"highlighted")&&v.remove(e,"highlighted"),this.setState({editingComment:!1,showOptionMenu:!1,commentSVG:this.props.comment.svg},function(){h.setActiveSketch("")})},handleDeleteComment:function(){this.cancelCommentEditor(),h.deleteComment(this.props.comment)},handleSketchClick:function(){h.toggleSketchMode()},handleDeleteSketch:function(){this.setState({commentSVG:""},function(){h.setActiveSketch("")})},render:function(){var e=g({comment:!0,highlighted:!!this.props.highlighted,unread:!!this.props.comment.unreadNotification}),t=p.getActiveSketch(),n=g({"comment-editor":!0,"has-sketch":!!this.state.commentSVG||!!t,"no-emojis":!this.props.hasEmojis}),r=f.getComment({comment:this.props.comment.comment,mentions:this.props.comment.mentions||s.getMentions()},this.props.userID,{atConversationDisabled:this.props.atConversationDisabled});return React.createElement("div",{onMouseEnter:this.handleCommentMouseEnter,onMouseLeave:this.handleCommentMouseLeave,"data-comment-id":this.props.comment.id,className:e},React.createElement(i,{user:this.props.comment,size:35}),this.props.comment.hasAnnotation?React.createElement("div",{className:"annotation-badge"},this.props.comment.annotationLabel):null,React.createElement("div",{className:"meta"},React.createElement("div",{className:"author-name"},React.createElement("span",{className:"name"},this.props.comment.name),React.createElement("div",{className:"timestamp"},this.commentTimestamp())),this.state.showOptionMenuToggle&&this.props.canEdit?React.createElement("a",{onClick:this.toggleCommentMenu,className:"menu-toggle"}):null,this.state.showOptionMenu&&this.state.showOptionMenuToggle&&this.props.canEdit?React.createElement("ul",{className:"option-menu"},this.props.userID&&this.props.comment.userID===this.props.userID?React.createElement("li",null,React.createElement("a",{onClick:this.handleEditComment},"Edit Comment")):null,React.createElement("li",null,React.createElement("a",{onClick:this.handleDeleteComment},"Delete Comment"))):null),this.state.editingComment?React.createElement("div",{className:n},React.createElement(o,{ref:"commentEditor",itemID:this.props.item.id,defaultValue:this.props.comment.comment,atConversationDisabled:this.props.atConversationDisabled,disableEmojis:!this.props.hasEmojis,disableMentions:!this.props.hasMentions,disableMentionShortcut:!this.props.hasMentionShortcut,hideAddButton:!0,onKeyDown:this.handleCommentKeydown,onChange:this.handleCommentChange}),this.props.item.itemTypeID===u.ITEM_TYPES.IMAGE||p.getIsValidSourceFile(this.props.item)?React.createElement("div",null,React.createElement(m,{editingComment:!0,commentData:this.props.comment,sketchesDisabled:this.props.sketchesDisabled}),this.props.sketchesDisabled?null:React.createElement(d,{hasSketch:!!this.state.commentSVG||!!t,onSketchClick:this.handleSketchClick,onDeleteSketch:this.handleDeleteSketch})):null,React.createElement("div",{className:"buttons"},React.createElement("a",{className:"save",onClick:this.saveCommentUpdate},"Save"),React.createElement("a",{className:"cancel",onClick:this.cancelCommentEditor},"Cancel"))):React.createElement("p",{className:"comment-text",dangerouslySetInnerHTML:{__html:r}}),!this.state.commentSVG||this.state.editingComment||this.props.sketchesDisabled?null:React.createElement("div",{className:"sketch-attached"},React.createElement("svg",{viewBox:"0 0 17 16"},React.createElement("path",{d:"M14,0.3l-7,7L9.8,10l7-7c0.4-0.4,0.4-1,0-1.4l-1.3-1.3C15-0.1,14.3-0.1,14,0.3z"}),React.createElement("path",{d:"M4,16c2.2,0,4-1.8,4-4c0-1.7-1.3-3-3-3s-3,1.3-3,3c0,1.3-1.2,2-2,2C0.9,15.2,2.5,16,4,16z"})),"Sketch attached"))}});t.exports=y},{"../../../common/components/Avatar.jsx":115,"../../../common/ng-components/comment/services/parseCommentService":125,"../../../common/react-components/comment-editor/actions/CommentActions":128,"../../../common/react-components/comment-editor/actions/MentionActions":130,"../../../common/react-components/comment-editor/components/CommentEditor.jsx":131,"../../../common/react-components/comment-editor/stores/CommentStore":143,"../../../common/react-components/comment-editor/stores/MentionStore":145,"../../../common/react-components/comment-editor/utils/CommentUtilities":147,"../../../common/utilities/date-helper":152,"../../../common/utilities/parse-links":155,"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"./ItemCommentsAnnotations.jsx":54,"./ItemCommentsSketch.jsx":55,classie:2,classnames:4}],53:[function(e,t,n){var i=e("lodash"),o=e("classnames"),r=e("../../actions/BoardsActionCreators"),a=e("../../constants/BoardsConstants"),s=e("../../stores/BoardStore"),c=e("./ItemComment.jsx"),l=e("./ItemCommentsAnnotations.jsx"),u=e("./ItemCommentsSketch.jsx"),h=e("../../../common/components/Loading.jsx"),d=e("../../../common/react-components/comment-editor/components/CommentEditor.jsx"),p=e("../../../common/react-components/comment-editor/actions/CommentActions"),m=e("../../../common/react-components/comment-editor/stores/CommentStore"),f=e("../../../common/react-components/comment-editor/stores/MentionStore"),g=e("../../../common/react-components/comment-editor/actions/MentionActions"),v=e("classie"),y=function(){return{isLoading:s.getCommentsLoading()&&!m.getCommentLength()}},_=React.createClass({displayName:"ItemComments",propTypes:{isShare:React.PropTypes.bool,item:React.PropTypes.object,hasEmojis:React.PropTypes.bool,hasMentions:React.PropTypes.bool,hasMentionShortcut:React.PropTypes.bool,hasItemInfo:React.PropTypes.bool,atConversationDisabled:React.PropTypes.bool,sketchesDisabled:React.PropTypes.bool,user:React.PropTypes.object,userID:React.PropTypes.number},getInitialState:function(){var e=y();return e.commentFormOpen=!1,e.currentCommentText="",e.currentCommentAnnotation={},e.errorMessage="",e.showCommentAuthorizationForm=!1,e.commentEditingID=null,e},componentDidMount:function(){s.addChangeListener(this._onChange),this.loadComments(),window.addEventListener("resize",this.setCommentsHeight,!1)},componentDidUpdate:function(e,t){e.item.id!==this.props.item.id&&this.loadComments(),this.setCommentsHeight(null,t.isLoading&&!this.state.isLoading||t.commentFormOpen!==this.state.commentFormOpen)},componentWillUnmount:function(){s.removeChangeListener(this._onChange),window.removeEventListener("resize",this.setCommentsHeight)},renderComments:function(){var e=s.getHighlightedComment();if(e&&this.scrollToComment(e),this.props.item.boardItemComments&&0!==this.props.item.boardItemComments.length){var t=this.props.item.boardItemComments.map(function(t,n){return React.createElement(c,{item:this.props.item,hasEmojis:this.props.hasEmojis,hasMentions:this.props.hasMentions,hasMentionShortcut:this.props.hasMentionShortcut,atConversationDisabled:this.props.atConversationDisabled,sketchesDisabled:this.props.sketchesDisabled,key:n,comment:t,highlighted:!!e&&e.id===t.id,closeEditor:!!this.state.commentFormOpen||!!this.state.commentEditingID&&this.state.commentEditingID!==t.id,onOpenEditor:this.editingComment,canEdit:!this.props.isShare||!!this.props.user&&this.props.userID===t.userID&&!!this.props.user.isAccountAuthenticated,userID:this.props.userID})},this);return t}return null},render:function(){var e=this.renderComments(),t=this.props.item.boardItemComments&&this.props.item.boardItemComments.length>0,n=this.state.commentFormOpen,i=o({comments:!0,share:this.props.isShare,"no-comments":!t}),r=s.getActiveSketch(),c=!!this.state.commentFormOpen&&!!r,p=o({"comment-form":!0,"has-sketch":c});return React.createElement("div",{onMouseLeave:this.handleCommentsMouseLeave,className:i},this.state.isLoading?React.createElement(h,null):React.createElement("div",null,React.createElement("div",{className:"comment-list",ref:"commentList",onMouseLeave:this.handleCommentsMouseLeave},e),React.createElement("div",{className:p},n?React.createElement("div",{className:this.props.hasEmojis?"":"no-emojis"
},this.state.showCommentAuthorizationForm?React.createElement("div",{className:"comment-authorization-form"},React.createElement("h4",null,"Please Identify Yourself"),React.createElement("p",null,"In order to participate, we need to know who you are."),this.state.errorMessage?React.createElement("div",{className:"error"},React.createElement("strong",null,"Oops:")," ",this.state.errorMessage):null,React.createElement("input",{type:"text",name:"authorization-name",id:"authorizationName",onKeyDown:this.handleAuthorizationFormKeydown,placeholder:"Name"}),React.createElement("input",{type:"email",name:"authorization-email",id:"authorizationEmail",onKeyDown:this.handleAuthorizationFormKeydown,placeholder:"Email Address"}),React.createElement("div",null,React.createElement("a",{onClick:this.authorizeAndAddComment,className:"button save"},"Post Comment"))):React.createElement("div",null,React.createElement(d,{autoFocus:n,atConversationDisabled:this.props.atConversationDisabled,disableEmojis:!this.props.hasEmojis,disableMentions:!this.props.hasMentions,itemID:this.props.item.id,disableMentionShortcut:!this.props.hasMentionShortcut,onKeyDown:this.handleCommentKeydown,onChange:this.handleCommentChange}),this.props.item.itemTypeID===a.ITEM_TYPES.IMAGE||s.getIsValidSourceFile(this.props.item)?React.createElement("span",null,this.props.sketchesDisabled?null:React.createElement(u,{hasSketch:c,onSketchClick:this.handleSketchClick,onDeleteSketch:this.handleDeleteSketch}),React.createElement(l,{sketchesDisabled:this.props.sketchesDisabled})):null,React.createElement("button",{onClick:this.handleAddNewComment,className:"button"},"Post Comment"))):React.createElement("a",{className:"add-comment",onClick:this.toggleCommentForm},this.getNewCommentPlaceholder()))))},loadComments:function(){setTimeout(function(){r.loadItemComments(this.props.item)}.bind(this))},startNewComment:function(){g.clearMentions();var e=this.getReplyTo(),t=i.isEmpty(e)?"":" ";p.setCurrentComment(t,e)},getReplyTo:function(){if(this.props.hasMentions){var e=this.props.userID,t=i.last(this.props.item.boardItemComments);if(t){var n=[];if(t.userID!==e){var o="@"+t.name;n.push({text:o.replace(/\s+/g,""),userID:t.userID,name:t.name})}return i.each(t.mentions,function(t){var i=/\^+/.test(t.text),o=t.userID==e;o||i||n.push({text:t.text,userID:t.userID,name:t.name})}),n.length>0?n:null}}},getNewCommentPlaceholder:function(){var e=this.getReplyTo(),t=[];if(i.isArray(e)&&e.length>0){i.each(e,function(e){t.push(e.text)}),t=i.uniq(t);var n=i.first(t),o=t.length-1,r=o>0?React.createElement("span",null," ","+"+o+" more"):null;return React.createElement("span",null,React.createElement("span",null,"Reply to "),React.createElement("span",{className:"mention-blue"},n),r)}return React.createElement("span",null,"Leave a comment...")},handleCommentKeydown:function(e){e.metaKey&&13===e.which?this.handleAddNewComment():e.target.scrollHeight>=e.target.offsetHeight?v.add(e.target,"scrolling"):v.remove(e.target,"scrolling")},handleAuthorizationFormKeydown:function(e){13===e.which&&this.authorizeAndAddComment()},toggleCommentForm:function(e){this.setState({commentFormOpen:!this.state.commentFormOpen,commentEditingID:null},function(){this.setCommentsHeight(),this.startNewComment()})},authorizeAndAddComment:function(){var e=document.getElementById("authorizationName").value,t=document.getElementById("authorizationEmail").value,n=this.state.currentCommentText,i=!!this.state.currentCommentAnnotation&&this.state.currentCommentAnnotation.label>0,o=i?this.state.currentCommentAnnotation.x:0,a=i?this.state.currentCommentAnnotation.y:0,c=i?this.state.currentCommentAnnotation.label:0,l=s.getActiveSketch();if(e&&t&&n)if(/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(t)){var u=this.state.currentCommentMentions,h=[];u.forEach(function(e){h.push(e.id?{userID:e.id,text:e.text,startPos:e.startPos}:{text:e.text,email:e.email,startPos:e.startPos})}),r.identifyAndAddComment(e,t,n,!0,i,o,a,c,l,h),this.setState({commentFormOpen:!1,errorMessage:"",showCommentAuthorizationForm:!1})}else this.setState({errorMessage:"Please enter a valid email address."});else e?t||this.setState({errorMessage:"Please enter your email."}):this.setState({errorMessage:"Please enter your name."})},editingComment:function(e){this.setState({commentFormOpen:!1,commentEditingID:e})},setCommentsHeight:function(e,t){t=t||!1;var n=document.querySelector(".comment-list");if(n){var i=document.querySelector(".item-details").clientHeight;i-=document.querySelector(".title-bar").clientHeight,i-=document.querySelector(".comment-form").clientHeight;var o=s.getActiveSketch(),r=!!this.state.commentFormOpen&&!!o,a=this.props.hasItemInfo?69:0;i-=r?179+a:139+a,n.style.maxHeight=i+"px",t&&(n.scrollTop=n.scrollHeight)}},handleCommentChange:function(e){var t=document.querySelector(".comments .button");e.target.value?v.add(t,"save"):v.remove(t,"save")},handleCommentsMouseLeave:function(e){var t=s.getActiveAnnotation(),n=s.getVisibleSketch();t&&t.canEdit||r.removeAnnotation(),n&&r.viewSketch(null)},handleAddNewComment:function(){var e=m.getCommentContent();if(!this.props.user||this.props.user.isAnonymous)return void this.setState({currentCommentText:e,currentCommentAnnotation:s.getActiveAnnotation(),currentCommentMentions:f.getMentions(),errorMessage:"",showCommentAuthorizationForm:!0});if(e){var t=s.getActiveAnnotation(),n=!1,i=0,o=0,a=0,c=s.getActiveSketch();t&&t.canEdit&&(n=!0,i=t.x,o=t.y,a=t.label);var l=f.getMentions();r.addComment(this.props.item,e,!0,n,i,o,a,c,l),p.setCommentContent(""),setTimeout(function(){g.clearAll()}),this.setState({commentFormOpen:!1,commentEditingID:null})}},scrollToComment:function(e){var t=this.refs.commentList,n=t.querySelector('.comment[data-comment-id="'+e.id+'"]');if(n){var i={pos:t.scrollTop},o=n.offsetTop-t.offsetTop,r=t.scrollHeight-t.offsetHeight;o>=r&&(o=r),TweenLite.to(i,.2,{pos:o,ease:Expo.easeOut,onUpdate:function(e,n){t.scrollTop=e.target[n]},onUpdateParams:["{self}","pos"]})}},handleSketchClick:function(){r.toggleSketchMode()},handleDeleteSketch:function(){r.setActiveSketch("")},_onChange:function(){return this.setState(y())}});t.exports=_},{"../../../common/components/Loading.jsx":117,"../../../common/react-components/comment-editor/actions/CommentActions":128,"../../../common/react-components/comment-editor/actions/MentionActions":130,"../../../common/react-components/comment-editor/components/CommentEditor.jsx":131,"../../../common/react-components/comment-editor/stores/CommentStore":143,"../../../common/react-components/comment-editor/stores/MentionStore":145,"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"./ItemComment.jsx":52,"./ItemCommentsAnnotations.jsx":54,"./ItemCommentsSketch.jsx":55,classie:2,classnames:4,lodash:19}],54:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=e("../../stores/BoardStore"),r=e("classnames"),a=React.createClass({displayName:"ItemCommentsAnnotations",componentDidMount:function(){if(this.props.editingComment){var e=this;setTimeout(function(){i.viewAnnotation(e.props.commentData.id,!0)})}},handleIconClick:function(e){i.editCommentAnnotation()},handleAnnotationClick:function(e){var t=o.getActiveAnnotation();i.removeAnnotation(t.label)},render:function(){var e=r({active:o.getEditingCommentAnnotation()}),t=o.getActiveAnnotation(),n=r({annotation:!0,"comment-editor-tooltip":!0,"sketches-disabled":this.props.sketchesDisabled,removing:!!t&&!!t.canEdit});return React.createElement("span",{className:n,"data-tooltip":t&&t.canEdit?"Remove Annotation":"Add Annotation"},t&&t.canEdit?React.createElement("a",{className:"active-annotation",onClick:this.handleAnnotationClick},t.label):React.createElement("svg",{className:e,viewBox:"0 0 23 23",onClick:this.handleIconClick},React.createElement("circle",{cx:"11.5",cy:"11.5",r:"8.1"}),React.createElement("line",{fill:"none",x1:"11.5",y1:"0.5",x2:"11.5",y2:"6.2"}),React.createElement("line",{fill:"none",x1:"0.5",y1:"11.5",x2:"6.2",y2:"11.5"}),React.createElement("line",{fill:"none",x1:"11.5",y1:"22.5",x2:"11.5",y2:"16.8"}),React.createElement("line",{fill:"none",x1:"22.5",y1:"11.5",x2:"16.8",y2:"11.5"})))}});t.exports=a},{"../../actions/BoardsActionCreators":29,"../../stores/BoardStore":99,classnames:4}],55:[function(e,t,n){var i=React.createClass({displayName:"ItemCommentsSketch",propTypes:{hasSketch:React.PropTypes.bool,onSketchClick:React.PropTypes.func,onDeleteSketch:React.PropTypes.func},render:function(){var e=this.sketchIcon();return React.createElement("div",null,this.props.hasSketch?React.createElement("a",{onClick:this.props.onDeleteSketch,className:"delete-sketch"},e,React.createElement("span",{className:"text"},"Your sketch is attached."),React.createElement("span",{className:"close"})):React.createElement("span",{className:"sketch comment-editor-tooltip","data-tooltip":"Add a Sketch",onClick:this.props.onSketchClick},e))},sketchIcon:function(){return React.createElement("svg",{viewBox:"0 0 17 16"},React.createElement("path",{d:"M14,0.3l-7,7L9.8,10l7-7c0.4-0.4,0.4-1,0-1.4l-1.3-1.3C15-0.1,14.3-0.1,14,0.3z"}),React.createElement("path",{d:"M4,16c2.2,0,4-1.8,4-4c0-1.7-1.3-3-3-3s-3,1.3-3,3c0,1.3-1.2,2-2,2C0.9,15.2,2.5,16,4,16z"}))}});t.exports=i},{}],56:[function(e,t,n){var i=e("../../constants/BoardsConstants"),o=e("../../stores/BoardStore"),r=e("./item-view-types/Image.jsx"),a=e("./item-view-types/SourceFile.jsx"),s=e("./item-view-types/SourceFileWithBar.jsx"),c=e("./item-view-types/Note.jsx"),l=e("./item-view-types/NoteReadonly.jsx"),u=e("./item-view-types/Color.jsx"),h=e("./item-view-types/File.jsx"),d=e("./item-view-types/Font.jsx"),p=React.createClass({displayName:"ItemContent",propTypes:{isShare:React.PropTypes.bool,isFullSize:React.PropTypes.bool,item:React.PropTypes.object.isRequired,loaded:React.PropTypes.bool,onColorKeypress:React.PropTypes.func,onTitleUpdated:React.PropTypes.func,showSidebar:React.PropTypes.bool,closing:React.PropTypes.bool,onImageAnimated:React.PropTypes.func,toggleItemViewClassname:React.PropTypes.func,hasItemInfo:React.PropTypes.bool,disableFontDownloads:React.PropTypes.bool},render:function(){var e=i.ITEM_TYPES,t=e.IMAGE,n=e.COLOR,p=e.NOTE,m=e.FONT,f=this.props,g=f.isFullSize,v=f.item,y=f.loaded,_=f.onColorKeypress,E=f.onTitleUpdated,b=f.showSidebar,T=f.closing,S=f.onImageAnimated,w=f.isShare,C=f.toggleItemViewClassname,R=f.disableFontDownloads,A=v,D=A.id,I=A.title,M=A.isNew,x=A.itemTypeID,O=A.metaData,k=O.clientFilename,N=O.color,L=O.downloadUrl,P=O.height,U=O.imageUrl,j=O.note,B=O.thumbnailFullUrl,H=O.width,z=null;if(o.getIsValidSourceFile(this.props.item)){var F=this.props.hasItemInfo?a:s;z=React.createElement(F,{id:D,isShare:w,title:I,filename:k,downloadUrl:L,imageUrl:B,isFullSize:g,loaded:y,naturalHeight:P,naturalWidth:H,showSidebar:b,thumbnailFullUrl:B,closing:T,onImageAnimated:S,toggleItemViewClassname:C})}else switch(x){case t:z=React.createElement(r,{id:D,imageUrl:U,isFullSize:g,loaded:y,naturalHeight:P,naturalWidth:H,showSidebar:b,thumbnailFullUrl:B,closing:T,onImageAnimated:S});break;case n:z=React.createElement(u,{isShare:w,color:N,isNew:M,item:v,onColorKeypress:_});break;case p:var V=w?l:c;z=React.createElement(V,{isNew:M,item:v,note:j,onTitleUpdated:E,title:I});break;case m:z=React.createElement(d,{disableFontDownloads:R,downloadUrl:L,filename:k,title:I});break;default:z=React.createElement(h,{isShare:w,downloadUrl:L,filename:k,title:I})}return z}});t.exports=p},{"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"./item-view-types/Color.jsx":81,"./item-view-types/File.jsx":82,"./item-view-types/Font.jsx":83,"./item-view-types/Image.jsx":84,"./item-view-types/Note.jsx":85,"./item-view-types/NoteReadonly.jsx":86,"./item-view-types/SourceFile.jsx":87,"./item-view-types/SourceFileWithBar.jsx":88}],57:[function(e,t,n){var i=e("../../../common/components/Avatar.jsx"),o=e("../../../common/utilities/date-helper"),r=React.createClass({displayName:"ItemInfo",propTypes:{owner:React.PropTypes.object,createdAt:React.PropTypes.number,modifiedAt:React.PropTypes.number,sourceName:React.PropTypes.string},render:function(){var e=this.props.createdAt===this.props.modifiedAt?"On ":"Modified on ";return this.props.sourceName&&(e=e.toLowerCase()),e+=this.makeTimeString(this.props.modifiedAt),React.createElement("div",{className:"item-info"},React.createElement(i,{size:36,user:this.props.owner}),React.createElement("div",{className:"owner-info"},React.createElement("div",{className:"owner-name"},"Added by ",React.createElement("strong",null,this.props.owner.name)),React.createElement("div",{className:"modified"},this.props.sourceName?React.createElement("strong",null,"Via ",this.props.sourceName," "):null,e)))},makeTimeString:function(e){return o.formatDate(e,"MMMM d, yyyy")}});t.exports=r},{"../../../common/components/Avatar.jsx":115,"../../../common/utilities/date-helper":152}],58:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=e("./ItemAction.jsx"),r=React.createClass({displayName:"ItemOverlay",propTypes:{isShare:React.PropTypes.bool,item:React.PropTypes.object,isProcessed:React.PropTypes.bool,zoom:React.PropTypes.number},getInitialState:function(){return{showDeleteOverlay:!1}},render:function(){var e=!isNaN(parseInt(this.props.item.get("id"),10))&&parseInt(this.props.item.get("id"),10)>0,t=this.props,n=t.isProcessed;return this.props.isShare?null:React.createElement("div",null,React.createElement("div",{className:"overlay"},n?React.createElement("ul",{className:"tools"},1===this.props.zoom?React.createElement("span",null,React.createElement(o,{className:"share",onClick:this.handleItemShare,title:"Share"}),React.createElement(o,{className:"delete",onClick:this.toggleDeleteOverlay,title:"Delete"})):null,React.createElement(o,{className:"columns",zoom:this.props.zoom,columnCount:parseInt(this.props.item.get("columns"),10),onClick:this.toggleColumnCount,title:"Set Item Size"})):null,!n&&e?React.createElement("ul",{className:"tools"},React.createElement(o,{className:"columns",columnCount:parseInt(this.props.item.get("columns"),10),onClick:this.toggleColumnCount,title:"Set Item Size"})):null,React.createElement("a",{className:"zoom-wrap"})),this.state.showDeleteOverlay?React.createElement("div",{className:"confirmation delete-confirmation"},React.createElement("div",{className:"message"},React.createElement("h3",null,"Delete this item?"),React.createElement("div",{className:"actions"},React.createElement("a",{onClick:this.handleItemDelete,className:"button"},"Yes, Delete"),React.createElement("a",{onClick:this.toggleDeleteOverlay,className:"cancel"},"Cancel")),React.createElement("p",null,React.createElement("strong",null,"Caution"),": This cannot be undone."))):null)},handleItemClick:function(){i.gotoBoardItem(this.props.item.get("id"))},handleItemShare:function(){i.shareBoardItem(this.props.item.toJS())},handleItemDelete:function(){i.deleteBoardItem(this.props.item.get("id"))},toggleDeleteOverlay:function(){this.setState({showDeleteOverlay:!this.state.showDeleteOverlay})},toggleColumnCount:function(e){i.setBoardItemColumns(this.props.item.toJS(),e)}});t.exports=r},{"../../actions/BoardsActionCreators":29,"./ItemAction.jsx":48}],59:[function(e,t,n){var i=React.createClass({displayName:"ItemPlaceholder",render:function(){var e="translate3d("+this.props.x+"px, "+this.props.y+"px, 0)",t={width:this.props.width+"px",height:this.props.height+"px",webkitTransform:e,transform:e};return React.createElement("div",{style:t,className:"item-placeholder"})}});t.exports=i},{}],60:[function(e,t,n){var i=e("classnames"),o={brush:{width:4,color:"#ff3366"},highlighter:{width:10,color:"rgba(255, 51, 102, 0.6)"}},r=React.createClass({displayName:"ItemSketchMode",propTypes:{imageUrl:React.PropTypes.string,onSave:React.PropTypes.func,onCancel:React.PropTypes.func},getInitialState:function(){return{activeTool:"brush",history:[],imageWidth:0,imageHeight:0,imageLoaded:!1}},componentDidMount:function(){this.canvas=new fabric.Canvas(this.refs.sketchCanvas),this.canvas.selection=!1,this.canvas.on("object:added",function(e){this.disableEditing(),setTimeout(function(){e.target.addedThroughHistory?delete e.target.addedThroughHistory:this.addHistoryItem(e.target)}.bind(this))}.bind(this)),this.loadImage(),this.toggleBrushTool()},componentDidUpdate:function(e){e.imageUrl!==this.props.imageUrl&&this.loadImage()},render:function(){var e=i({brush:!0,active:"brush"===this.state.activeTool}),t=i({highlighter:!0,active:"highlighter"===this.state.activeTool}),n=i({undo:!0,inactive:!this.canUndo()}),o=i({redo:!0,inactive:!this.canRedo()});return React.createElement("section",{className:"sketch-mode"},React.createElement("header",{className:"toolbar"},React.createElement("ul",{className:"drawing-tools",ref:"tools"},React.createElement("li",null,React.createElement("a",{onClick:this.toggleBrushTool,className:e},React.createElement("svg",{viewBox:"0 55.7 588.6 588.4"},React.createElement("path",{d:"M575.5,55.9c-6,1-13.6,4.7-20.9,9.9L245.3,292.5c-13,9.3-27.4,28.3-34.9,41.3l-6.4,12.2c33.2,6.5,63.1,24.1,84.3,50.6 c7.8,11.2,13.9,23.5,18.6,36.1l1.7-0.6c13-7.4,32-22.4,41.3-35.5L578.4,89.6c9.3-13,13.1-25.8,7.6-31.4c-1.4-1.4-3-2-5.2-2.3 C579.1,55.7,577.5,55.6,575.5,55.9L575.5,55.9z M175.6,400c-36.2,2.5-66.7,29.9-73.3,65.7v3.5C93,534.3,53.9,590.3,0,623.8 c18.6,9.3,38.8,14.9,59.3,18.6c94.9,13,184.4-52.2,201.1-147.1v-5.8c5.6-42.8-25.8-83.4-68.6-88.9 C186.5,399.9,180.7,399.7,175.6,400L175.6,400z"})))),React.createElement("li",null,React.createElement("a",{onClick:this.toggleHighlighterTool,className:t},React.createElement("svg",{viewBox:"3.4 72.3 588.4 548.4"},React.createElement("path",{d:"M96.1,370.9c-30.5,36.7-34.3,85.3-6.9,112.7l1.8,1.8l-23,23l69.2,71.1l23.9-23.9l19.3,19.4c12.2,12.2,28.8,18.7,47.5,18.7 c3.9,0,7.9-0.3,12-0.8c17.7-2.5,35-10.4,50.3-22.3L96.1,370.9z"}),React.createElement("path",{d:"M50.5,525.8L7.1,569.2c-3,2.9-4.2,7.2-3.4,11.2c0.8,4.1,3.6,7.5,7.5,9L86,619.9c1.5,0.6,3.1,0.9,4.7,0.9 c3.2,0,6.4-1.3,8.8-3.6l20.2-20.2L50.5,525.8z"}),React.createElement("path",{d:"M588.2,196.3L467.7,75.9c-4.5-4.5-11.8-4.7-16.7-0.6l-337,278.5l192.3,197.6C367.3,478.6,589,212.9,589,212.9 C593.1,208,592.8,200.8,588.2,196.3z M450.9,176.6L217.3,378c-2.4,2.1-5.2,3.1-8.1,3.1c-3.5,0-6.9-1.5-9.4-4.3 c-4.5-5.2-3.9-13,1.3-17.5l233.5-201.4c5.2-4.5,13-3.9,17.5,1.3C456.6,164.3,456,172.1,450.9,176.6z"})))),React.createElement("li",null,React.createElement("a",{onClick:this.handleUndo,className:n},React.createElement("svg",{viewBox:"0 0 20.5 9"},React.createElement("path",{d:"M10.5,1c-2.7,0-5,1-6.9,2.6L0,0v9h9L5.4,5.4c1.4-1.2,3.2-1.9,5.1-1.9C14,3.5,17,5.8,18.1,9l2.4-0.8C19.1,4,15.2,1,10.5,1z"})))),React.createElement("li",null,React.createElement("a",{onClick:this.handleRedo,className:o},React.createElement("svg",{viewBox:"0 0 20.5 9"},React.createElement("path",{d:"M10,1c2.7,0,5,1,6.9,2.6L20.5,0v9h-9l3.6-3.6c-1.4-1.2-3.2-1.9-5.1-1.9C6.4,3.5,3.4,5.8,2.4,9L0,8.2C1.4,4,5.3,1,10,1z"})))),React.createElement("li",null,React.createElement("a",{onClick:this.clearCanvas,className:"trash"},React.createElement("svg",{viewBox:"0 0 14 18"},React.createElement("polygon",{points:"9.5,0 4.5,0 3.5,1 0,1 0,3 14,3 14,1 10.5,1  "}),React.createElement("polygon",{opacity:"0",points:"9.5,0 4.5,0 3.5,1 0,1 0,3 14,3 14,1 10.5,1  "}),React.createElement("path",{d:"M1,16c0,1.1,0.9,2,2,2h8c1.1,0,2-0.9,2-2V4H1V16z"}),React.createElement("path",{opacity:"0",d:"M1,16c0,1.1,0.9,2,2,2h8c1.1,0,2-0.9,2-2V4H1V16z"}))))),React.createElement("div",{className:"buttons"},React.createElement("a",{onClick:this.handleCancelClick,className:"cancel"},"Cancel"),React.createElement("a",{onClick:this.handleDoneClick,className:"done"},"Done"))),React.createElement("div",{className:"sketch-area",ref:"sketchArea"},React.createElement("canvas",{className:"sketch-canvas",ref:"sketchCanvas"})))},canvas:null,disableEditing:function(){this.canvas&&(this.canvas.isDrawingMode=!1)},enableEditing:function(){this.canvas&&(this.canvas.isDrawingMode=!0)},loadImage:function(){var e=new Image;e.onload=function(){this.setState({imageLoaded:!0,imageWidth:e.width,imageHeight:e.height},function(){this.setCanvasSize()}.bind(this))}.bind(this),e.src=this.props.imageUrl},setCanvasSize:function(){if(this.state.imageLoaded){var e,t,n=this.refs.sketchArea,i=n.offsetWidth,o=n.offsetHeight-35;if(this.state.imageWidth<=i&&this.state.imageHeight<=o)e=this.state.imageWidth,t=this.state.imageHeight;else{var r=this.state.imageWidth/this.state.imageHeight,a=i/o;a>r?(t=this.state.imageHeight>=o?o:this.state.imageHeight,e=this.state.imageWidth*t/this.state.imageHeight):(e=this.state.imageWidth>=i?i:this.state.imageWidth,t=this.state.imageHeight*e/this.state.imageWidth)}this.canvas.setDimensions({height:t,width:e}),this.canvas.calcOffset(),this.canvas.lowerCanvasEl.style.backgroundImage="url("+this.props.imageUrl+")",this.canvas.lowerCanvasEl.style.backgroundSize="cover"}},toggleBrushTool:function(){this.setState({activeTool:"brush"},function(){this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush.width=o.brush.width,this.canvas.freeDrawingBrush.color=o.brush.color}.bind(this))},toggleHighlighterTool:function(){this.setState({activeTool:"highlighter"},function(){this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush.width=o.highlighter.width,this.canvas.freeDrawingBrush.color=o.highlighter.color}.bind(this))},clearCanvas:function(){this.setState({activeTool:"brush",history:[]},function(){this.canvas.clear(),this.toggleBrushTool()}.bind(this))},canRedo:function(){return 0===this.state.history.length?!1:!this.state.history[this.state.history.length-1].isActive},canUndo:function(){if(0===this.state.history.length)return!1;var e=_.find(this.state.history,function(e){return e.isActive===!0});return!!e},addHistoryItem:function(e){this.disableEditing();var t=_.clone(this.state.history,!0),n=_.findIndex(t,function(e){return!!e.isActive});if(n>=0){t[n].isActive=!1;for(var i=t.length-1;i>n;i--)t[i]&&t.splice(i,1)}t.push({object:e.toJSON(),isActive:!0}),this.setState({history:t},function(){this.enableEditing()}.bind(this))},handleRedo:function(e){e.preventDefault(),setTimeout(function(){if(this.disableEditing(),!this.canRedo())return void this.enableEditing();var e=_.clone(this.state.history,!0),t=_.findIndex(e,function(e){return!!e.isActive});t>=0&&(e[t].isActive=!1),e[t+1]&&(e[t+1].isActive=!0,fabric.util.enlivenObjects([e[t+1].object],function(e){e.forEach(function(e){e.addedThroughHistory=!0,this.canvas.add(e)}.bind(this)),this.canvas.renderAll()}.bind(this))),this.setState({history:e},function(){this.enableEditing()}.bind(this))}.bind(this))},handleUndo:function(e){e.preventDefault(),setTimeout(function(){if(this.disableEditing(),!this.canUndo())return void this.enableEditing();var e=_.clone(this.state.history,!0),t=_.findIndex(e,function(e){return!!e.isActive});if(t>=0){var n=e[t];n.isActive=!1,this.canvas._objects.forEach(function(e){_.isEqual(e.path,n.object.path)&&Math.round(e.left)===Math.round(n.object.left)&&Math.round(e.top)===Math.round(n.object.top)&&(this.canvas.remove(e),this.canvas.renderAll())}.bind(this)),t>0&&(e[t-1].isActive=!0)}this.setState({history:e},function(){this.enableEditing()}.bind(this))}.bind(this))},handleDoneClick:function(){this.props.onSave(this.canvas.toSVG({viewBox:{x:0,y:0,width:this.canvas.width,height:this.canvas.height}}))},handleCancelClick:function(){this.props.onCancel()},toolMousedown:function(e){e.preventDefault()}});t.exports=r},{classnames:4}],61:[function(e,t,n){var i=e("../../constants/BoardsConstants"),o=e("./Rename.jsx"),r=React.createClass({displayName:"ItemTitleBar",propTypes:{isShare:React.PropTypes.bool,title:React.PropTypes.string,itemTypeID:React.PropTypes.number,description:React.PropTypes.string,onTitleUpdated:React.PropTypes.func,onColorKeypress:React.PropTypes.func},render:function(){return React.createElement("div",null,this.props.itemTypeID===i.ITEM_TYPES.COLOR?React.createElement(o,{className:"title",allowEdit:!this.props.isShare,onSubmit:this.props.onTitleUpdated,onKeypress:this.props.onColorKeypress,value:this.props.title,allowEmpty:!0,placeholder:"Add a title here..."}):React.createElement(o,{className:"title",allowEdit:!this.props.isShare,onSubmit:this.props.onTitleUpdated,value:this.props.title,placeholder:this.props.itemTypeID===i.ITEM_TYPES.NOTE?"Untitled Note":"Add a title here..."}),!this.props.isShare||this.props.description?React.createElement(o,{allowLineBreaks:!0,allowEdit:!this.props.isShare,className:"description",parseLinks:!0,onSubmit:this.props.onDescriptionUpdated,value:this.props.description,allowEmpty:!0,isEmpty:!this.props.description,placeholder:"Add a description here..."}):null)}});t.exports=r},{"../../constants/BoardsConstants":90,"./Rename.jsx":67}],62:[function(e,t,n){function i(){var e=this.props,t=e.item;o=_.assign({},o,w),o.isSwatch=t.itemTypeID===s.ITEM_TYPES.COLOR,o.isNewSwatch=o.isSwatch&&t.isNew,o.pressedEnter=!1}var o,r=ReactDOM,a=r.findDOMNode,s=e("../../constants/BoardsConstants"),c=e("../../actions/BoardsActionCreators"),l=e("../../stores/BoardStore"),u=e("./ItemTitleBar.jsx"),h=e("./ItemColorBar.jsx"),d=e("./ItemContent.jsx"),p=e("./ItemComments.jsx"),m=e("./ItemInfo.jsx"),f=e("classnames"),g=e("classie"),v=e("../../utils/is"),y=e("../../../common/utilities/color-functions-service"),E=e("./ItemSketchMode.jsx"),b=e("./detail/constants/itemViewConstants"),T=b.SCALED,S=b.FULLSIZE,w={isNew:void 0,isSwatch:void 0,pressedEnter:!1},C=function(){return{isEditing:l.getItemViewEditingState(),sketchMode:l.getSketchMode()}},R=React.createClass({displayName:"BoardItemView",propTypes:{isShare:React.PropTypes.bool,board:React.PropTypes.object.isRequired,closing:React.PropTypes.bool,hasItemInfo:React.PropTypes.bool,hasMentions:React.PropTypes.bool,hasMentionShortcut:React.PropTypes.bool,atConversationDisabled:React.PropTypes.bool,sketchesDisabled:React.PropTypes.bool,item:React.PropTypes.object.isRequired,onClose:React.PropTypes.func,user:React.PropTypes.object},getInitialState:function(){var e=this.props,t=e.item,n=l.getIsValidSourceFile(t)||t.itemTypeID===s.ITEM_TYPES.IMAGE;return i.call(this),_.assign(C(),{showOptions:!o.isNewSwatch,showSidebar:!o.isNewSwatch,showImageScaleOptions:n,imageScaleSetting:T,imageScaleSettingChanged:!1,loaded:!1,closing:!1})},componentDidMount:function(){l.addChangeListener(this._onChange),setTimeout(function(){g.add(document.body,"board-item-open")},50),this.initLogo(),this.calculateTitleMaxWidth(),setTimeout(this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE||this.props.hasItemInfo&&l.getIsValidSourceFile(this.props.item)?function(){this.initImage()}.bind(this):function(){this.initItem()}.bind(this)),setTimeout(function(){this.refs.contentWrapper.addEventListener("click",_.throttle(this.handleContentSectionClick,500),!1)}.bind(this),300),ReactDOM.findDOMNode(this).addEventListener("wheel",this.wheelHandler,!1),document.addEventListener("keyup",this.keyupHandler,!1),window.addEventListener("resize",this.resizeHandler,!1);var e=document.body,t=document.documentElement,n=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight);t.style.height=n+"px",t.style.overflow="hidden",e.style.overflowY="scroll"},componentDidUpdate:function(e){return this.props.closing?void this.handleCloseClick({},!1):void(e.item!==this.props.item&&setTimeout(function(){this.loadNewItem()}.bind(this)))},componentWillUnmount:function(){g.remove(document.body,"board-item-open"),g.remove(document.getElementById("boards"),"board-items-transitioning"),document.documentElement.style.removeProperty("height"),document.documentElement.style.removeProperty("overflow"),document.body.style.removeProperty("overflow"),document.removeEventListener("keyup",this.keyupHandler),l.removeChangeListener(this._onChange);var e=document.querySelector(".color-name-value");e&&e.firstChild&&e.firstChild.removeEventListener("keyup",this.setColorClass),this.sheet&&(this.sheet.ownerNode&&document.head.removeChild(this.sheet.ownerNode),this.sheet=null),ReactDOM.findDOMNode(this).removeEventListener("wheel",this.wheelHandler),window.removeEventListener("resize",this.resizeHandler);var t=this;this.refs.contentWrapper.removeEventListener("click",_.throttle(t.handleContentSectionClick,500))},render:function(){var e={"board-item-view":!0,photo:this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE||l.getIsValidSourceFile(this.props.item),note:this.props.item.itemTypeID===s.ITEM_TYPES.NOTE,color:this.props.item.itemTypeID===s.ITEM_TYPES.COLOR,file:s.ITEM_TYPES.FILE.indexOf(this.props.item.itemTypeID)>=0&&!l.getIsValidSourceFile(this.props.item),"no-item-info":this.props.hasItemInfo};this.props.hasItemInfo||(e.photo=this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE,e.file=s.ITEM_TYPES.FILE.indexOf(this.props.item.itemTypeID)>=0);var t=f(e),n=f({"is-inverted":function(){return this.props.item.itemTypeID===s.ITEM_TYPES.COLOR&&y.isDark(this.props.item.metaData.color)?!0:null}.bind(this)(),"sidebar-visible":this.state.showSidebar}),i=f({"item-content":!0,closable:!this.state.isEditing,unclosable:this.state.isEditing,slide:!this.state.showSidebar,"no-transition":this.state.imageScaleSettingChanged||this.state.imageScaleSetting===S,fullsize:this.state.imageScaleSetting===S}),o=f({"item-details":!0,"active-fade":!!this.state.loaded,slide:!this.state.showSidebar}),r=f({"fullscreen-title":!0,visible:!this.state.showSidebar}),a=f({"fullscreen-scale-options":!0,visible:!0}),c={opacity:this.state.loaded&&this.state.showOptions?1:0,pointerEvents:this.state.loaded&&this.state.showOptions?"auto":"none",transition:"opacity 250ms ease 0s",WebkitTransition:"opacity 250ms ease 0s",MozTransition:"opacity 250ms ease 0s"},g=!!this.props.item.metaData.downloadUrl&&(1===this.props.item.itemTypeID||s.ITEM_TYPES.FILE.indexOf(this.props.item.itemTypeID)>=0);this.props.item.itemTypeID===s.ITEM_TYPES.FONT&&(g=this.props.board.disableFontDownloads?!1:!0);var v={maxWidth:this.state.titleMaxWidth},b=this.props.item.clientFilename?this.props.item.clientFilename:"",w=l.getIsValidSourceFile(this.props.item)?this.props.item.metaData.thumbnailFullUrl:this.props.item.metaData.imageUrl;return React.createElement("section",{id:"boardItem",className:t},this.state.sketchMode?React.createElement(E,{imageUrl:w,onSave:this.handleSaveSketch,onCancel:this.handleCancelSketchMode}):null,React.createElement("div",{className:n},React.createElement("div",{className:"logo-wrapper",ref:"logo"},React.createElement("a",{className:"logo",onClick:_.throttle(this.handleCloseClick,1e3)})),React.createElement("ul",{className:"board-item-options",ref:"options",style:c},g?React.createElement("li",{className:"download"},React.createElement("a",{href:this.props.item.metaData.downloadUrl,download:!0},React.createElement("span",{className:"accessibility"},"Download"))):null,React.createElement("li",{className:"share"},React.createElement("a",{onClick:_.throttle(this.handleItemShare,1e3)},React.createElement("span",{className:"accessibility"},"Share Link"))),React.createElement("li",{className:"sidebar-toggle"},React.createElement("a",{className:this.state.showSidebar?"":"open",onClick:this.toggleSidebar},React.createElement("span",{className:"accessibility"},"Toggle Sidebar"))),React.createElement("li",{className:"close-modal"},React.createElement("a",{onClick:_.throttle(this.handleCloseClick,1e3)},React.createElement("span",{className:"accessibility"},"Close board item")))),this.props.item.itemTypeID!==s.ITEM_TYPES.NOTE?React.createElement("div",{className:r,ref:"fullscreenTitle"},React.createElement("h3",{style:v},this.props.board.title),React.createElement("h4",{style:v},this.props.item.title)):null,this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE||l.getIsValidSourceFile(this.props.item)?React.createElement("ul",{className:a,ref:"fullscreenScaleOptions"},React.createElement("li",null,React.createElement("a",{className:this.state.imageScaleSetting===T?"active":"",
onClick:this.updateImageScale.bind(this,T)},"Scaled")),React.createElement("li",null,React.createElement("a",{className:this.state.imageScaleSetting===S?"active":"",onClick:this.updateImageScale.bind(this,S)},"Fullsize"))):null,React.createElement("div",{className:i,ref:"contentWrapper"},React.createElement(d,{isShare:this.props.isShare,item:this.props.item,closing:this.state.closing,loaded:this.state.loaded,showSidebar:this.state.showSidebar,onTitleUpdated:this.handleTitleUpdated,onColorKeypress:this.handleColorUpdated,onImageAnimated:this.handleImageAnimated,disableFontDownloads:this.props.isShare&&this.props.board.disableFontDownloads,toggleItemViewClassname:this.handleToggleClassname,hasItemInfo:this.props.hasItemInfo,isFullSize:this.state.imageScaleSetting===S})),React.createElement("div",{className:o,ref:"details"},React.createElement("div",{className:"item-details-inner"},React.createElement("div",{className:"title-bar"},React.createElement("h4",{className:"board-title"},this.props.board.title),React.createElement(u,{isShare:this.props.isShare,itemTypeID:this.props.item.itemTypeID,title:this.props.item.title,description:this.props.item.description,onTitleUpdated:this.handleTitleUpdated,onDescriptionUpdated:this.handleDescriptionUpdated,onColorKeypress:this.handleColorUpdated}),this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE?React.createElement(h,{isShare:this.props.isShare,item:this.props.item,colors:this.props.item.metaData.imagecolors,board:this.props.board}):null),React.createElement(p,{isShare:this.props.isShare,hasEmojis:this.props.hasEmojis,hasMentions:this.props.hasMentions,hasMentionShortcut:this.props.hasMentionShortcut,hasItemInfo:this.props.hasItemInfo,atConversationDisabled:this.props.atConversationDisabled,sketchesDisabled:this.props.sketchesDisabled,item:this.props.item,user:this.props.user,userID:this.props.user.id}),this.props.hasItemInfo?React.createElement(m,{owner:this.props.item.createdBy,createdAt:this.props.item.createdAt,modifiedAt:this.props.item.updatedAt,sourceName:b}):null))))},sheet:null,handleToggleClassname:function(e){var t=ReactDOM.findDOMNode(this);e?(g.add(t,"file"),g.remove(t,"photo")):(g.add(t,"photo"),g.remove(t,"file"))},wheelHandler:function(e){v(e.target,".comments")||v(e.target,".item-content.fullsize")||v(e.target,".sketch-area")||v(e.target,".note-wrap")||(e.preventDefault(),e.stopPropagation())},setColorClass:function(e){var t=this.refs.logo.firstChild,n=this.props.item.metaData.color;if(e&&e.target){var i="#"+e.target.innerText;if(!y.checkHex(i))return;n=i}return y.isDark(n)?void g.add(t,"is-inverted"):void g.remove(t,"is-inverted")},initColor:function(){if(this.props.item.itemTypeID===s.ITEM_TYPES.COLOR){this.setColorClass();var e=document.querySelector(".color-name-value");e&&e.firstChild&&e.firstChild.addEventListener("keyup",this.setColorClass,!1)}},initLogo:function(){this.initColor();var e=this.refs.logo,t=0;0!==(document.documentElement.scrollTop||document.body.scrollTop)&&(t=.5,TweenLite.set(e,{autoAlpha:0})),TweenLite.to(e,.275,{delay:t,autoAlpha:1})},destroyLogo:function(){TweenLite.to(this.refs.logo,.1,{autoAlpha:0})},initImage:function(){g.add(ReactDOM.findDOMNode(this),"active-fade"),g.add(ReactDOM.findDOMNode(this.refs.options),"hidden")},handleImageAnimated:function(){g.remove(ReactDOM.findDOMNode(this.refs.options),"hidden"),g.add(ReactDOM.findDOMNode(this.refs.details),"active-fade"),this.setState({loaded:!0})},initItem:function(){c.setViewItemVisible(this.props.item.itemTypeID),g.add(ReactDOM.findDOMNode(this),"active-fade"),this.setState({loaded:!0})},loadNewItem:function(){g.add(document.getElementById("boards"),"board-items-transitioning"),this.props.item.boardID!==this.props.board.id&&setTimeout(function(){c.gotoBoard(null)});var e=ReactDOM.findDOMNode(this).querySelector(".item-content img"),t=document.querySelector(".item-details");e&&g.add(e,"visible"),g.add(ReactDOM.findDOMNode(this),"active-no-transition"),g.add(t,"active-fade"),this.setState({loaded:!0})},resizeHandler:function(){this.calculateTitleMaxWidth()},keyupHandler:function(e){{var t=e.target,n=this.state;n.showImageScaleOptions,n.imageScaleSetting,n.showSidebar}if(!(v(t,"#boardItemNoteContent")||v(t,"textarea")||v(t,"input")||"true"===t.contentEditable||l.getItemViewEditingState())){var i=document.querySelector(".emoji-popover")||document.querySelector(".emoji-typeahead");switch(e.which){case 70:this.cycleZoom();break;case 13:if(i)return;o.isSwatch?this.handleColorSwatchKey("ENTER"):this.toggleSidebar();break;case 27:if(i)return;o.isSwatch?this.handleColorSwatchKey("ESC"):c.gotoBoard(null)}}},handleColorSwatchKey:function(e){switch(e){case"ESC":if(!document.querySelector(".emoji-popover")&&!document.querySelector(".emoji-typeahead"))return;o.isNewSwatch&&!o.pressedEnter&&c.deleteBoardItem(this.props.item.id),c.gotoBoard(null);break;case"ENTER":o.pressedEnter=!0,this.toggleSidebar()}},handleCloseClick:function(e,t){l.getEditingCommentAnnotation()&&c.editCommentAnnotation(),this.state.sketchMode&&c.toggleSketchMode(),g.remove(ReactDOM.findDOMNode(this),"active-no-transition"),g.remove(document.getElementById("boards"),"board-items-transitioning"),t=t===!0?!0:!1,this.destroyLogo();var n=document.querySelector(".unsubscribe-alert");if(n&&g.add(n,"clear"),this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE||this.props.hasItemInfo&&l.getIsValidSourceFile(this.props.item)){var i=ReactDOM.findDOMNode(this);g.add(ReactDOM.findDOMNode(this.refs.options),"hidden"),g.remove(ReactDOM.findDOMNode(this.refs.details),"active-fade"),g.remove(i,"active-fade"),g.remove(ReactDOM.findDOMNode(this.refs.fullscreenTitle),"visible"),g.remove(ReactDOM.findDOMNode(this.refs.fullscreenScaleOptions),"visible"),g.add(i,"closing"),this.setState({closing:!0},function(){setTimeout(function(){c.gotoBoard(null),this.props.onClose(t,this.props.item.id)}.bind(this),s.ANIMATION_TIMINGS.ITEM_VIEW_CLOSE)}.bind(this))}else g.add(ReactDOM.findDOMNode(this),"fade-out"),setTimeout(function(){c.gotoBoard(null),this.props.onClose(t,this.props.item.id)}.bind(this),150);c.setViewItemHidden()},handleDeleteClick:function(e){window.confirm("Are you sure you want to delete this item?")&&this.handleCloseClick({},!0)},cycleZoom:function(){{var e=this.state,t=e.showImageScaleOptions,n=e.imageScaleSetting,i=e.showSidebar,o=this.props;o.item}t&&(n===T&&i?this.toggleSidebar():n!==T||i?n===S&&this.toggleSidebar():this.updateImageScale(S))},handleContentSectionClick:function(e){var t=e.target;if(!l.getEditingCommentAnnotation()){if(v(t,".image-wrap img"))return this.cycleZoom();for(;t.parentNode&&!g.has(t,"unclosable");){if(g.has(t,"closable")){this.handleCloseClick();break}t=t.parentNode}}},toggleSidebar:function(){l.getEditingCommentAnnotation()&&c.editCommentAnnotation(),this.setState({showOptions:o.isNewSwatch?!this.state.showOptions:!0,showSidebar:!this.state.showSidebar,imageScaleSetting:T,imageScaleSettingChanged:!1})},handleItemShare:function(){c.shareBoardItem(this.props.item)},handleTitleUpdated:function(e){c.updateItemTitle(this.props.item,e)},handleDescriptionUpdated:function(e){c.updateItemDescription(this.props.item,e)},handleColorUpdated:function(e){c.updateColorValue(this.props.item,e)},updateImageScale:function(e){this.setState({imageScaleSetting:e,imageScaleSettingChanged:!0},function(){var e=a(this.refs.contentWrapper);e.scrollWidth>e.offsetWidth&&this.state.imageScaleSetting===S&&(e.scrollLeft=Math.abs((e.scrollWidth-e.offsetWidth)/2))}.bind(this))},calculateTitleMaxWidth:function(){if(this.props.item.itemTypeID!==s.ITEM_TYPES.NOTE){var e=200;this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE&&(e=this.refs.details.clientWidth+50),this.setState({titleMaxWidth:(window.innerWidth-e)/2})}return null},handleSaveSketch:function(e){c.setActiveSketch(e),c.toggleSketchMode();var t=ReactDOM.findDOMNode(this).querySelector(".comment-editor textarea");t?t.focus():(t=ReactDOM.findDOMNode(this).querySelector(".comment-form textarea"),t&&t.focus())},handleCancelSketchMode:function(){c.toggleSketchMode()},_onChange:function(){return this.setState(C())}});t.exports=R},{"../../../common/utilities/color-functions-service":151,"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"../../utils/is":111,"./ItemColorBar.jsx":51,"./ItemComments.jsx":53,"./ItemContent.jsx":56,"./ItemInfo.jsx":57,"./ItemSketchMode.jsx":60,"./ItemTitleBar.jsx":61,"./detail/constants/itemViewConstants":74,classie:2,classnames:4}],63:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=e("../../stores/BoardStore"),r=(e("classie"),e("classnames")),a=e("./BulkColumns.jsx"),s=React.createClass({displayName:"MultiSelectBar",getInitialState:function(){return{showSectionMenu:!1,showDeleteConfirmation:!1}},componentDidMount:function(){document.addEventListener("click",this.handleClick,!1)},componentDidUpdate:function(e){!this.props.isSelectingBulkItems&&e.isSelectingBulkItems&&this.setState({showSectionMenu:!1,showDeleteConfirmation:!1})},componentWillUnmount:function(){document.removeEventListener("click",this.handleClick)},handleClick:function(e){if(this.state.showSectionMenu){var t=this.refs.groupList,n=this.refs.groupListButton;t&&(t.contains(e.target)||t===e.target||n===e.target||this.setState({showSectionMenu:!1}))}if(this.state.showDeleteConfirmation){var i=this.refs.deleteConfirmation,o=this.refs.deleteButton;i&&(i.contains(e.target)||i===e.target||o===e.target||this.setState({showDeleteConfirmation:!1}))}},toggleGroupMenu:function(){this.setState({showSectionMenu:!this.state.showSectionMenu})},toggleDeleteMenu:function(){this.setState({showDeleteConfirmation:!this.state.showDeleteConfirmation})},handleBulkDelete:function(e){this.setState({showSectionMenu:!1,showDeleteConfirmation:!1}),0!==this.props.selectedItems.length&&i.bulkDeleteItems(this.props.selectedItems)},handleBulkMove:function(e,t){this.setState({showSectionMenu:!1,showDeleteConfirmation:!1}),0!==this.props.selectedItems.length&&i.bulkMoveItems(this.props.selectedItems,e)},setBulkItemSize:function(e){this.setState({showSectionMenu:!1,showDeleteConfirmation:!1}),0!==this.props.selectedItems.length&&i.bulkSizeItems(this.props.selectedItems,e)},renderGroupContent:function(){if(this.props.board&&this.props.board.groups){var e=this.props.board.groups.map(function(e,t){var n=e.sort<=1?"top":"",i=e.sort<=1?"Top":e.title?e.title:"Untitled Section";return React.createElement("li",null,React.createElement("a",{className:n,onClick:this.handleBulkMove.bind(this,e.id)},i))},this);return e}},render:function(){var e,t=this.renderGroupContent(),n=r({"multi-select-options":!0,opened:this.props.selectedItems.length>1||!!this.props.isSelectingBulkItems});return this.props.selectedItems.length>0&&this.props.selectedItems.forEach(function(t){var n=o.getItemByID(t);n&&(e?e&&e!==n.columns&&(e=1):e=n.columns)}),React.createElement("div",{className:n},React.createElement("div",{className:"count"},React.createElement("span",{className:"number"},this.props.selectedItems.length),1===this.props.selectedItems.length?"item":"items"," selected"),React.createElement("div",{className:"actions"},React.createElement(a,{className:"columns",title:"Set Item Size",onClick:this.setBulkItemSize,columnCount:e}),React.createElement("a",{className:"move-to-group","data-title":"Move To Section",onClick:this.toggleGroupMenu,ref:"groupListButton"},"Move"),this.state.showSectionMenu&&this.props.selectedItems?React.createElement("ul",{className:"board-menu group-list open",ref:"groupList"},React.createElement("li",{className:"group-list-header"},"Move to Section"),t):null,React.createElement("a",{className:"delete","data-title":"Delete",onClick:this.toggleDeleteMenu,ref:"deleteButton"},"Delete"),this.state.showDeleteConfirmation&&this.props.selectedItems?React.createElement("div",{className:"board-menu open delete-confirmation",ref:"deleteConfirmation"},React.createElement("p",null,"Are you sure you wish to",React.createElement("br",null),"delete ",this.props.selectedItems.length," ",1===this.props.selectedItems.length?"item?":"items?"),React.createElement("div",{className:"buttons"},React.createElement("a",{className:"button confirm",onClick:this.handleBulkDelete},"Delete"),React.createElement("a",{className:"button",onClick:this.toggleDeleteMenu},"Cancel"))):null),React.createElement("p",{className:"instructions"},React.createElement("em",null,React.createElement("strong",null,"click & drag")," or ",React.createElement("strong",null,"cmd/shift-click")," to select, ",React.createElement("strong",null,"esc")," to deselect")))}});t.exports=s},{"../../actions/BoardsActionCreators":29,"../../stores/BoardStore":99,"./BulkColumns.jsx":36,classie:2,classnames:4}],64:[function(e,t,n){var i=e("../../actions/SelectionActionCreators"),o=e("../../stores/BoardStore"),r=e("../../utils/is"),a=e("classie"),s=React.createClass({displayName:"MultiSelectDragger",propTypes:{getContainerNode:React.PropTypes.func.isRequired},getInitialState:function(){return{startX:-10,startY:-10,currentX:-10,currentY:-10,isDragging:!1}},handleMouseDown:function(e){var t=o.getShareData();t||e.target!==document.querySelector(".board-details")&&(r(e.target,".board-zoom")||r(e.target,".share-overlay")||r(e.target,".board-item")||r(e.target,".board-header")||r(e.target,"a")||r(e.target,".board-rename")||r(e.target,".zoom-wrap")||r(e.target,".plus")||r(e.target,".multi-select-options")||a.has(document.body,"modal-open"))||(e.preventDefault(),a.add(document.body,"dragger-selecting"),this.setState({isDragging:!0,startX:e.clientX,startY:e.clientY,currentX:e.clientX,currentY:e.clientY}))},handleMouseMove:function(e){this.state.isDragging&&(e.preventDefault(),this.setState({currentX:e.clientX,currentY:e.clientY}))},handleMouseUp:function(e){if(a.has(document.body,"dragger-selecting")&&a.remove(document.body,"dragger-selecting"),this.state.isDragging&&this.state.currentX!==this.state.startX&&this.state.currentY!==this.state.startY){var t=this.getDimensions(),n=[],o=document.querySelectorAll(".board-item");[].forEach.call(o,function(e){var i=e.getBoundingClientRect();i.right<t.left||i.left>t.left+t.width||i.bottom<t.top||i.top>t.top+t.height||n.push(parseInt(e.getAttribute("data-board-item-id"),10))}),i.toggleDraggerItems(n,e.metaKey||e.ctryKey)}else this.state.isDragging&&!r(e.target,".board-item")&&i.clearSelectionStore();this.setState({isDragging:!1,startX:-10,startY:-10,currentX:-10,currentY:-10})},getDimensions:function(){return{top:Math.min(this.state.currentY,this.state.startY),left:Math.min(this.state.currentX,this.state.startX),width:Math.abs(this.state.currentX-this.state.startX),height:Math.abs(this.state.currentY-this.state.startY)}},componentDidMount:function(){var e=this.props,t=e.getContainerNode,n=t();n.addEventListener("mousedown",this.handleMouseDown,!1),n.addEventListener("mousemove",this.handleMouseMove,!1),n.addEventListener("mouseup",this.handleMouseUp,!1)},componentWillUnmount:function(){var e=this.props,t=e.getContainerNode,n=t();n.removeEventListener("mousedown",this.handleMouseDown),n.removeEventListener("mousemove",this.handleMouseMove),n.removeEventListener("mouseup",this.handleMouseUp)},render:function(){var e=this.getDimensions(),t={top:e.top+"px",left:e.left+"px",height:e.height+"px",width:e.width+"px"};return React.createElement("div",{style:t,className:"multi-select-dragger"})}});t.exports=s},{"../../actions/SelectionActionCreators":31,"../../stores/BoardStore":99,"../../utils/is":111,classie:2}],65:[function(e,t,n){function i(){return{baseBoardsRoute:a.getBaseBoardsRoute()}}var o=e("classie"),r=e("../../actions/BoardsActionCreators"),a=e("../../stores/BoardStore"),s=React.createClass({displayName:"BoardOverQuota",getInitialState:function(){return i()},componentDidMount:function(){a.addChangeListener(this._onChange),setTimeout(function(){o.add(document.documentElement,"board-over-quota")})},componentWillUnmount:function(){a.removeChangeListener(this._onChange),o.remove(document.documentElement,"board-over-quota")},handleUpgradeClick:function(){r.openUpgradeModal()},trackRender:function(){window.analytics&&window.analytics.track("Boards.OverBoardQuotaMessage")},render:function(){this.trackRender();var e="#"+this.state.baseBoardsRoute;return React.createElement("section",{className:"board-over-quota"},React.createElement("div",{className:"logo-wrapper"},React.createElement("a",{className:"logo",href:e})),React.createElement("div",{className:"over-quota-message"},React.createElement("h2",null,"It looks like you're ready for more boards.",React.createElement("br",null)," Get unlimited boards instantly with",React.createElement("br",null)," InVision Professional and above."),React.createElement("a",{onClick:this.handleUpgradeClick,className:"upgrade-button"},"Check out your upgrade options"),React.createElement("div",{className:"over-quote-message-wrapper"},React.createElement("a",{className:"over-quota-message-return",href:e},"Take me back to my boards"))))},_onChange:function(){return this.setState(i())}});t.exports=s},{"../../actions/BoardsActionCreators":29,"../../stores/BoardStore":99,classie:2}],66:[function(e,t,n){function i(){var e=h.getSettings(),t=e.boardPassword,n=e.isPasswordProtected,i=e.step;return{boardPassword:t,isPasswordProtected:n,step:i}}var o=React,r=o.PropTypes,a=o.createClass,s=ReactDOM,c=s.findDOMNode,l=e("react-pure-render/mixin"),u=e("../../constants/BoardSettingsConstants"),h=e("../../stores/BoardSettingsStore"),d=e("../../actions/BoardSettingsActionCreators"),p=e("password-strength"),m=a({propTypes:{name:r.string,placeholder:r.string},mixins:[l],getDefaultProps:function(){return{name:"board-password",placeholder:"Password"}},getInitialState:function(){return i()},componentWillMount:function(){h.listen(this.onBoardSettingsStoreChange)},componentDidMount:function(){this.checkIfWeShouldFocus()},componentWillUnmount:function(){h.unlisten(this.onBoardSettingsStoreChange)},checkIfWeShouldFocus:function(){var e=this.props,t=e.name,n=this.state,i=n.boardPassword,o=n.isPasswordProtected;i||o||c(this.refs[t]).focus()},handleBoardPasswordChange:function(e){d.updateBoardPassword(e.target.value)},handleButtonClick:function(e){e.preventDefault(),e.stopPropagation(),d.updateBoardSettings(this.state)},onBoardSettingsStoreChange:function(){return this.setState(i())},getColorForStrength:function(e){var t=e.strength;switch(t){case"simple":return"#f00";case"medium":case"strong":return"#6baa66";default:return"#d9dfe6"}},getTextForStrength:function(e){var t=e.strength;switch(t){case"simple":return"Weak Password";case"medium":return"Good Password";case"strong":return"Strong Password"}},getButtonText:function(){var e=this.state,t=e.step;switch(t){case u.PASSWORD_STEP_UPDATE_PASSWORD:return"Update";case u.PASSWORD_STEP_CHANGE:return"Change";case u.PASSWORD_STEP_UPDATING:return"Updating...";case u.PASSWORD_STEP_SAVE:return"Save";case u.PASSWORD_STEP_SAVING:return"Saving...";case u.PASSWORD_STEP_SAVE_SUCCESS:return"Saved";case u.PASSWORD_STEP_SAVE_FAIL:return"Failed"}},getButtonStyles:function(e){var t=e.strength,n=this.state,i=n.step,o=0,r="#6baa66",a="pointer";switch(t){case"medium":case"strong":o=1}switch(i){case u.PASSWORD_STEP_SAVING:case u.PASSWORD_STEP_UPDATING:a="progress";break;case u.PASSWORD_STEP_SAVE_FAIL:r="#f00"}return Object.assign({},f.button,{cursor:a,color:r,opacity:o})},render:function(){var e=this.props,t=e.placeholder,n=e.name,i=this.state,o=i.boardPassword,r=i.isPasswordProtected,a=i.step,s=a===u.PASSWORD_STEP_SAVING||a===u.PASSWORD_STEP_UPDATING,c=p(o),l=r?"Update password":"Create a password",h=c.valid?this.getTextForStrength(c):l,d=c.valid?this.getColorForStrength(c):"#d9dfe6",m=Object.assign({},f.input,{borderBottomColor:d,cursor:s?"progress":"text"}),g=c.valid?Object.assign({},f.hint,{color:d}):null;return React.createElement("div",{style:f.base},React.createElement("h3",{style:g},h),React.createElement("input",{disabled:s,id:n,maxLength:32,name:n,onChange:this.handleBoardPasswordChange,placeholder:t,ref:n,value:o,style:m,type:"text"}))}});t.exports=m;var f={base:{paddingTop:16,position:"relative"},hint:{WebkitTransition:"color 200ms ease-in-out 0s",MozTransition:"color 200ms ease-in-out 0s",MsTransition:"color 200ms ease-in-out 0s",transition:"color 200ms ease-in-out 0s"},input:{width:"100%",background:"none",border:"none",borderRadius:0,boxShadow:"none",outline:"none",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",WebkitTransition:"color 200ms ease-in-out 0s, border-bottom-color 200ms ease-in-out 0s",MozTransition:"color 200ms ease-in-out 0s, border-bottom-color 200ms ease-in-out 0s",MsTransition:"color 200ms ease-in-out 0s, border-bottom-color 200ms ease-in-out 0s",transition:"color 200ms ease-in-out 0s, border-bottom-color 200ms ease-in-out 0s",borderBottomWidth:1,borderBottomColor:"#d9dfe6",borderBottomStyle:"solid",lineHeight:1.5,padding:"16px 32px 12px 0",fontSize:16},button:{color:"#6baa66",WebkitTransition:"opacity 200ms ease-in-out 0s, color 200ms ease-in-out 0s",MozTransition:"opacity 200ms ease-in-out 0s, color 200ms ease-in-out 0s",MsTransition:"opacity 200ms ease-in-out 0s, color 200ms ease-in-out 0s",transition:"opacity 200ms ease-in-out 0s, color 200ms ease-in-out 0s",border:0,outline:0,background:0,fontSize:13,position:"absolute",right:0,bottom:16,fontWeight:"bold",lineHeight:1,textTransform:"uppercase"}}},{"../../actions/BoardSettingsActionCreators":28,"../../constants/BoardSettingsConstants":89,"../../stores/BoardSettingsStore":98,"password-strength":21,"react-pure-render/mixin":23}],67:[function(e,t,n){var i=e("classnames"),o=e("classie"),r=e("dompurify"),a=e("trim-html"),s=e("../../../common/utilities/parse-links"),c=function(e){return e.metaKey&&73===e.keyCode},l=function(e){return e.metaKey&&66===e.keyCode},u=function(e){return e.preventDefault()&&e.stopPropagation()},h=React.createClass({displayName:"BoardRename",propTypes:{allowEmpty:React.PropTypes.bool,allowLineBreaks:React.PropTypes.bool,className:React.PropTypes.string,onSubmit:React.PropTypes.func.isRequired,onKeypress:React.PropTypes.func,value:React.PropTypes.string,placeholder:React.PropTypes.string,isEmpty:React.PropTypes.bool,isColor:React.PropTypes.bool,charLimit:React.PropTypes.number,inputStyle:React.PropTypes.object,allowEdit:React.PropTypes.bool,allowShortcuts:React.PropTypes.bool,parseLinks:React.PropTypes.bool},getDefaultProps:function(){return{allowEmpty:!1,allowLineBreaks:!1,allowEdit:!0,allowShortcuts:!0,parseLinks:!1}},_tags:[],_allowedAttr:[],componentWillMount:function(){this.props.allowLineBreaks&&this._tags.push("br"),this.props.parseLinks&&(this._tags.push("a"),this._allowedAttr.push.apply(this._allowedAttr,["href","target"]))},handleOnBlur:function(e){var t=this.getElementContents(e.target);t=this.sanitizeValue(t),this.forceRepaint(),this.submitForm(t),this.keyHandler(e),e.target.spellcheck=!1},handleOnFocus:function(e){if(this.forceRepaint(),!this.props.isColor){var t=e.target;t.spellcheck=!0;var n=this.getElementContents(t);n.length>0&&this.setElementContents(t,n+" ",!1)}},forceRepaint:function(){var e="undefined"!=typeof window.mozInnerScreenX;e&&(ReactDOM.findDOMNode(this).style.display="none",ReactDOM.findDOMNode(this).offsetHeight,ReactDOM.findDOMNode(this).style.display="")},getElementContents:function(e){return this.props.allowLineBreaks?e.innerHTML:e.textContent},setElementContents:function(e,t,n){n=n||!0;var i=t;t?(n&&(i=this.sanitizeValue(t)),this.props.allowLineBreaks?e.innerHTML=i:e.textContent=i):this.props.allowLineBreaks?e.innerHTML="":e.textContent=""},handleKeyDown:function(e){if(!this.props.allowShortcuts&&(c(e)||l(e)))return u(e);if(13===e.which)this.props.allowLineBreaks&&e.shiftKey||e.preventDefault();else if(27===e.which)e.preventDefault(),this.setElementContents(e.target,this.props.value),e.target.blur();else if(!e.metaKey&&!e.ctrlKey&&-1===[8,37,38,39,40].indexOf(e.which)&&this.props.charLimit&&e.target.textContent.length>=this.props.charLimit){var t=window.getSelection(),n=t.getRangeAt(0);n&&n.startOffset!==n.endOffset&&n.commonAncestorContainer.parentNode===e.target||e.preventDefault()}this.keyHandler(e)},handleKeyUp:function(e){13!==e.which?(this.props.onKeypress&&this.props.onKeypress(this.getElementContents(e.target)),this.keyHandler(e)):this.props.allowLineBreaks&&e.shiftKey||(e.preventDefault(),e.target.blur(),window.getSelection().removeAllRanges(),this.submitForm(this.getElementContents(e.target)))},keyHandler:function(e){this.props.isEmpty&&(this.getElementContents(e.target).length>0?o.remove(ReactDOM.findDOMNode(this),"empty"):o.add(ReactDOM.findDOMNode(this),"empty"))},handlePaste:function(e){e.preventDefault();var t,n=e.originalEvent||e;if(n.clipboardData.types)for(var i=n.clipboardData.types.length-1;i>=0;i--)"text/html"===n.clipboardData.types[i]?t=n.clipboardData.getData("text/html"):"text/plain"===n.clipboardData.types[i]&&(t=n.clipboardData.getData("text/plain"));var o=this.props.allowLineBreaks?"insertHTML":"insertText";"undefined"!=typeof t&&document.execCommand(o,!1,this.sanitizeValue(t))},sanitizeValue:function(e){if(!e)return"";var t=this.purify(e);return this.props.allowLineBreaks||(t=t.replace(/<(\/)?br(\s+)?(\/)?>|\n/g,"")),t=t.trim(),t=t.replace(/[\t]+$/g,""),t=t.replace(/&amp;/g,"&"),t=t.replace(/\\n/g,"<br>"),t=t.replace(/&nbsp;|\s\s+/g," "),this.props.charLimit&&(t=this.trimToCharacterLimit(t,this.props.charLimit)),"<br>"===t&&(t=""),t},purify:function(e){return r.sanitize(e,{ALLOWED_TAGS:this._tags,ALLOWED_ATTR:this._allowedAttr})},trimToCharacterLimit:function(e,t){var n=a(e,{limit:t,suffix:" "});return n.html.replace(/[ \t]+$/,"")},submitForm:function(e){e=this.sanitizeValue(e);var t=ReactDOM.findDOMNode(this).querySelector("h2");if(this.props.isColor){if(!e)return void this.setElementContents(t,this.props.value)}else if(!e&&!this.props.allowEmpty||e===this.props.value||this.props.placeholder&&e===this.props.placeholder)return void this.setElementContents(t,this.props.value);this.props.onSubmit(e)},handleLinkMouseEnter:function(){ReactDOM.findDOMNode(this).querySelector("h2").contentEditable=!1},handleLinkMouseLeave:function(){this.props.allowEdit&&(ReactDOM.findDOMNode(this).querySelector("h2").contentEditable=!0)},bindAnchorHandlers:function(){var e=ReactDOM.findDOMNode(this).querySelector("h2"),t=e.querySelectorAll("a");if(t)for(var n=0;n<t.length;n++)t[n].addEventListener("mouseenter",this.handleLinkMouseEnter,!1),t[n].addEventListener("mouseleave",this.handleLinkMouseLeave,!1)},unbindAnchorHandlers:function(){var e=ReactDOM.findDOMNode(this).querySelector("h2"),t=e.querySelectorAll("a");if(t)for(var n=0;n<t.length;n++)t[n].removeEventListener("mouseenter",this.handleLinkMouseEnter),t[n].removeEventListener("mouseleave",this.handleLinkMouseLeave)},componentDidMount:function(){var e=i({"board-rename":!0,empty:this.props.isEmpty});e+=" "+this.props.className,ReactDOM.findDOMNode(this).className=e;var t=document.createElement("h2");t.className="name",t.spellcheck=!1,this.props.allowEdit?t.setAttribute("contentEditable","true"):o.add(ReactDOM.findDOMNode(this),"no-edit"),t.setAttribute("data-placeholder",this.props.placeholder?this.props.placeholder:""),t.textContent=this.props.value,this.props.parseLinks&&(t.innerHTML=s(t.textContent,null,this._tags)),ReactDOM.findDOMNode(this).appendChild(t),this.bindAnchorHandlers(),t.addEventListener("focus",this.handleOnFocus,!1),t.addEventListener("blur",this.handleOnBlur,!1),t.addEventListener("paste",this.handlePaste,!1),t.addEventListener("keydown",this.handleKeyDown,!1),t.addEventListener("keyup",this.handleKeyUp,!1)},componentWillUnmount:function(){this.unbindAnchorHandlers();var e=ReactDOM.findDOMNode(this).querySelector("h2");e.removeEventListener("focus",this.handleOnFocus),e.removeEventListener("blur",this.handleOnBlur),e.removeEventListener("paste",this.handlePaste),e.removeEventListener("keydown",this.handleKeyDown),e.removeEventListener("keyup",this.handleKeyUp)},shouldComponentUpdate:function(e){if(this.props.isColor){var t=ReactDOM.findDOMNode(this).querySelector("h2");if(t){var n=t.textContent;if(n&&n===e.value)return!1}}return!0},componentDidUpdate:function(e){var t=ReactDOM.findDOMNode(this),n=t.querySelector("h2");!e.allowEdit&&this.props.allowEdit?(o.remove(t,"no-edit"),n.setAttribute("contentEditable","true")):e.allowEdit&&!this.props.allowEdit&&(o.add(t,"no-edit"),n.setAttribute("contentEditable","false")),(e.value!==this.props.value||""===n.textContent&&this.props.value&&!this.props.allowEmpty)&&this.setElementContents(n,this.props.value),this.props.parseLinks&&e.value!==this.props.value&&(this.unbindAnchorHandlers(),n.innerHTML=s(this.getElementContents(n),null,this._tags),this.bindAnchorHandlers())},componentWillUpdate:function(){this.forceRepaint()},render:function(){return React.DOM.span()}});t.exports=h},{"../../../common/utilities/parse-links":155,classie:2,classnames:4,dompurify:6,"trim-html":27}],68:[function(e,t,n){var i=e("../../../common/components/Avatar.jsx"),o=e("../../actions/BoardsActionCreators"),r=e("classnames"),a=React.createClass({displayName:"RoundupComment",getDefaultProps:function(){return{comment:{}}},onClick:function(){o.gotoBoardItem(this.props.comment.boardItemID)},render:function(){var e=this.props.comment,t={hasSystemAvatar:!1,name:e.name,initials:"",avatarID:e.avatarID},n=r({"roundup-comment":!0,unread:e.unread}),o=e.unreadNotification?React.createElement("div",{className:"unread"}):null;return React.createElement("div",{className:n,onClick:this.onClick},o,React.createElement(i,{user:t,size:38}),e.name," commented on ",e.title,React.createElement("span",{className:"date"},moment(e.createdAt).fromNow()))}});t.exports=a},{"../../../common/components/Avatar.jsx":115,"../../actions/BoardsActionCreators":29,classnames:4}],69:[function(e,t,n){var i=ReactDOM,o=i.findDOMNode,r=React,a=r.PropTypes,s=e("../../constants/BoardsConstants"),c=e("../../actions/BoardsActionCreators"),l=e("../../stores/BoardStore"),u=e("./ItemTitleBar.jsx"),h=e("./ItemColorBar.jsx"),d=e("./ItemContent.jsx"),p=e("./ItemComments.jsx"),m=e("./ItemInfo.jsx"),f=e("classnames"),g=e("classie"),v=e("../../../boards/utils/is"),y=e("../../../common/utilities/color-functions-service"),E=e("../../../boards/components/board/ItemSketchMode.jsx"),b=e("../../../boards/components/board/detail/constants/itemViewConstants"),T=b.SCALED,S=b.FULLSIZE,w=function(){return{sketchMode:l.getSketchMode()}},C=React.createClass({displayName:"BoardItemView",propTypes:{board:a.object.isRequired,hasItemInfo:a.bool,hasEmojis:a.bool,hasMentions:a.bool,hasMentionShortcut:a.bool,sketchesDisabled:a.bool,item:a.object.isRequired,user:a.object,thumbnailerResizeEndpoint:a.string.isRequired,share:a.shape({boardID:a.number.isRequired,boardItemID:a.number.isRequired,isPasswordProtected:a.bool.isRequired})},getInitialState:function(){var e=this.props,t=e.item,n=l.getIsValidSourceFile(t)||t.itemTypeID===s.ITEM_TYPES.IMAGE;return _.assign(w(),{showSidebar:!0,showImageScaleOptions:n,imageScaleSetting:T,imageScaleSettingChanged:!1,loaded:!1})},wheelHandler:function(e){v(e.target,".comments")||v(e.target,".item-content.fullsize")||v(e.target,".note-wrap")||(e.preventDefault(),e.stopPropagation())},componentDidMount:function(){if(l.addChangeListener(this._onChange),window.analytics){var e=s.ITEM_TYPE_NAMES[this.props.item.itemTypeID],t={boardid:this.props.share.boardID,isPasswordProtected:this.props.share.isPasswordProtected,boardViewType:"item",boardItemType:e};window.analytics.track("ShareLink.Viewed",t)}g.add(document.body,"board-item-open"),g.add(document.body,"single-item-share"),this.initLogo(),this.calculateTitleMaxWidth(),ReactDOM.findDOMNode(this).addEventListener("wheel",this.wheelHandler,!1),document.addEventListener("keyup",this.keyupHandler,!1),window.addEventListener("resize",this.resizeHandler,!1),this.refs.contentWrapper.addEventListener("click",_.throttle(this.handleContentSectionClick,500)),this.setState({loaded:!0})},componentWillUnmount:function(){g.remove(document.body,"board-item-open"),
g.remove(document.body,"single-item-share"),l.removeChangeListener(this._onChange),this.destroyLogo(),ReactDOM.findDOMNode(this).removeEventListener("wheel",this.wheelHandler),document.removeEventListener("keyup",this.keyupHandler),window.removeEventListener("resize",this.resizeHandler)},resizeHandler:function(){this.calculateTitleMaxWidth()},keyupHandler:function(e){if(!(v(e.target,"#boardItemNoteContent")||v(e.target,"textarea")||v(e.target,"input")||"true"===e.target.contentEditable))switch(e.which){case 70:this.cycleZoom();break;case 13:case 32:this.toggleSidebar();break;case 27:this.state.showSidebar||this.toggleSidebar()}},handleContentSectionClick:function(e){l.getEditingCommentAnnotation()||(v(e.target,".board-item-image")||v(e.target,".source-file-image"))&&this.cycleZoom()},toggleSidebar:function(){l.getEditingCommentAnnotation()&&c.editCommentAnnotation(),this.setState({showSidebar:!this.state.showSidebar,imageScaleSetting:T,imageScaleSettingChanged:!1})},handleItemShare:function(){c.shareBoardItem(this.props.item)},initLogo:function(){var e=this.refs.logo;this.props.item.itemTypeID===s.ITEM_TYPES.COLOR&&y.isDark(this.props.item.metaData.color)&&g.add(e.firstChild,"is-inverted");var t=0;0!==(document.documentElement.scrollTop||document.body.scrollTop)&&(t=.5,TweenLite.set(e,{autoAlpha:0})),TweenLite.to(e,.275,{delay:t,autoAlpha:1})},destroyLogo:function(){TweenLite.to(this.refs.logo,.1,{autoAlpha:0})},updateImageScale:function(e){this.setState({imageScaleSetting:e,imageScaleSettingChanged:!0},function(){var e=o(this.refs.contentWrapper);e.scrollWidth>e.offsetWidth&&this.state.imageScaleSetting===S&&(e.scrollLeft=Math.abs((e.scrollWidth-e.offsetWidth)/2))}.bind(this))},cycleZoom:function(){{var e=this.state,t=e.showImageScaleOptions,n=e.imageScaleSetting,i=e.showSidebar,o=this.props;o.item}t&&(n===T&&i?this.toggleSidebar():n!==T||i?n===S&&this.toggleSidebar():this.updateImageScale(S))},calculateTitleMaxWidth:function(){if(this.props.item.itemTypeID!==s.ITEM_TYPES.COLOR&&this.props.item.itemTypeID!==s.ITEM_TYPES.NOTE){var e=200;this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE&&(e=this.refs.details.clientWidth+50),this.setState({titleMaxWidth:(window.innerWidth-e)/2})}return null},render:function(){var e=f({"active-fade":!0,"board-item-view":!0,photo:this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE,note:this.props.item.itemTypeID===s.ITEM_TYPES.NOTE,color:this.props.item.itemTypeID===s.ITEM_TYPES.COLOR,file:s.ITEM_TYPES.FILE.indexOf(this.props.item.itemTypeID)>=0}),t=f({"is-inverted":function(){return this.props.item.itemTypeID===s.ITEM_TYPES.COLOR&&y.isDark(this.props.item.metaData.color)?!0:null}.bind(this)(),"sidebar-visible":this.state.showSidebar}),n=f({"item-content":!0,slide:!this.state.showSidebar,"no-transition":this.state.imageScaleSettingChanged,fullsize:this.state.imageScaleSetting===S}),i=f({"item-details":!0,"active-fade":!!this.state.loaded,slide:!this.state.showSidebar}),o=f({"fullscreen-title":!0,visible:!this.state.showSidebar}),r=f({"fullscreen-scale-options":!0,visible:!0}),a=!!this.props.item.metaData.downloadUrl&&(1===this.props.item.itemTypeID||s.ITEM_TYPES.FILE.indexOf(this.props.item.itemTypeID)>=0);this.props.item.itemTypeID===s.ITEM_TYPES.FONT&&(a=this.props.board.disableFontDownloads?!1:!0);var c={maxWidth:this.state.titleMaxWidth},g=this.props.item.clientFilename?this.props.item.clientFilename:"",v=l.getIsValidSourceFile(this.props.item)?this.props.item.metaData.thumbnailFullUrl:this.props.item.metaData.imageUrl;return React.createElement("section",{id:"boardItem",className:e},this.state.sketchMode?React.createElement(E,{imageUrl:v,onSave:this.handleSaveSketch,onCancel:this.handleCancelSketchMode}):null,React.createElement("div",{className:t},React.createElement("div",{className:"logo-wrapper",ref:"logo"},React.createElement("a",{className:"logo no-hover",href:"http://www.invisionapp.com",target:"_blank"})),React.createElement("ul",{className:"board-item-options"},a?React.createElement("li",{className:"download"},React.createElement("a",{href:this.props.item.metaData.downloadUrl,download:!0},React.createElement("span",{className:"accessibility"},"Download"))):null,React.createElement("li",{className:"share"},React.createElement("a",{onClick:_.throttle(this.handleItemShare,1e3)},React.createElement("span",{className:"accessibility"},"Share Link"))),React.createElement("li",{className:"sidebar-toggle"},React.createElement("a",{className:this.state.showSidebar?"":"open",onClick:this.toggleSidebar},React.createElement("span",{className:"accessibility"},"Toggle Sidebar")))),this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE||l.getIsValidSourceFile(this.props.item)?React.createElement("div",{className:o},React.createElement("h3",{style:c},this.props.board.title),React.createElement("h4",{style:c},this.props.item.title)):null,this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE||l.getIsValidSourceFile(this.props.item)?React.createElement("ul",{className:r},React.createElement("li",null,React.createElement("a",{className:this.state.imageScaleSetting===T?"active":"",onClick:this.updateImageScale.bind(this,T)},"Scaled")),React.createElement("li",null,React.createElement("a",{className:this.state.imageScaleSetting===S?"active":"",onClick:this.updateImageScale.bind(this,S)},"Fullsize"))):null,React.createElement("div",{ref:"contentWrapper",className:n},React.createElement(d,{isShare:!0,item:this.props.item,loaded:this.state.loaded,showSidebar:this.state.showSidebar,onTitleUpdated:this.handleTitleUpdated,onColorKeypress:this.handleColorUpdated,hasItemInfo:this.props.hasItemInfo,isFullSize:this.state.imageScaleSetting===S})),React.createElement("div",{className:i,ref:"details"},React.createElement("div",{className:"item-details-inner"},React.createElement("div",{className:"title-bar"},React.createElement("h4",{className:"board-title"},this.props.board.title),React.createElement(u,{isShare:!0,itemTypeID:this.props.item.itemTypeID,title:this.props.item.title,description:this.props.item.description,onTitleUpdated:this.handleTitleUpdated,onDescriptionUpdated:this.handleDescriptionUpdated,onColorKeypress:this.handleColorUpdated}),this.props.item.itemTypeID===s.ITEM_TYPES.IMAGE?React.createElement(h,{isShare:!0,item:this.props.item,board:this.props.board}):null),React.createElement(p,{isShare:!0,item:this.props.item,hasMentions:this.props.hasMentions,hasMentionShortcut:this.props.hasMentionShortcut,sketchesDisabled:this.props.sketchesDisabled,hasEmojis:this.props.hasEmojis,hasItemInfo:this.props.hasItemInfo,userID:this.props.user.id,user:this.props.user}),this.props.hasItemInfo?React.createElement(m,{owner:this.props.item.createdBy,createdAt:this.props.item.createdAt,modifiedAt:this.props.item.updatedAt,sourceName:g}):null))))},handleSaveSketch:function(e){c.setActiveSketch(e),c.toggleSketchMode();var t=ReactDOM.findDOMNode(this).querySelector(".comment-editor textarea");t?t.focus():(t=ReactDOM.findDOMNode(this).querySelector(".comment-form textarea"),t&&t.focus())},handleCancelSketchMode:function(){c.toggleSketchMode()},_onChange:function(){return this.setState(w())}});t.exports=C},{"../../../boards/components/board/ItemSketchMode.jsx":60,"../../../boards/components/board/detail/constants/itemViewConstants":74,"../../../boards/utils/is":111,"../../../common/utilities/color-functions-service":151,"../../actions/BoardsActionCreators":29,"../../constants/BoardsConstants":90,"../../stores/BoardStore":99,"./ItemColorBar.jsx":51,"./ItemComments.jsx":53,"./ItemContent.jsx":56,"./ItemInfo.jsx":57,"./ItemTitleBar.jsx":61,classie:2,classnames:4}],70:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=React.createClass({displayName:"SpaceLink",propTypes:{board:React.PropTypes.object,space:React.PropTypes.object},render:function(){var e=this.props,t=e.space;return t.loaded?React.createElement("div",{className:"board-space-link"},t.id?React.createElement("a",{href:"/home/#/spaces/"+t.id,className:"back-to-space"},t.title):React.createElement("a",{onClick:this.handleAddToSpace,className:"add-to-space"},"Add to Space")):null},handleAddToSpace:function(){i.openAddToSpaceModal(this.props.board.id)}});t.exports=o},{"../../actions/BoardsActionCreators":29}],71:[function(e,t,n){var i,o=e("../../actions/BoardsActionCreators"),r=e("./Rename.jsx"),a=e("./Collaborator.jsx"),s=React.createClass({displayName:"BoardTitleBar",propTypes:{board:React.PropTypes.object.isRequired,isShare:React.PropTypes.bool},handleTitleUpdated:function(e){this.props.board.isSample||(o.updateTitle(e),e&&""!==e&&(window.document.title=e+" - InVision"))},handleDescriptionUpdated:function(e){this.props.board.isSample||o.updateDescription(e)},renderCollaborators:function(){var e=[],t=[];return this.props.board.members&&(e=this.props.board.members.map(function(e){return React.createElement(a,{key:e.id,user:e})},this)),this.props.board.teamInvitations&&(t=this.props.board.teamInvitations.map(function(e){var t=e.id||e.inviteID;return React.createElement(a,{key:"T"+t,user:e})},this)),React.createElement("div",null,React.createElement(a,{key:0,user:null}),e,t)},render:function(){if(!this.props.board)return null;this.props.isShare&&(i.title.marginTop=1);var e=this.renderCollaborators();return React.createElement("div",null,React.createElement("div",{className:"board-title",style:i.title},React.createElement(r,{className:"title",charLimit:30,allowEdit:1===this.props.zoom&&!this.props.isShare,onSubmit:this.handleTitleUpdated,allowShortcuts:!1,value:this.props.board.title,placeholder:"Add a title here..."}),this.props.board.description||!this.props.isShare?React.createElement(r,{allowLineBreaks:!0,className:"description",charLimit:140,allowShortcuts:!1,allowEmpty:!0,allowEdit:1===this.props.zoom&&!this.props.isShare,parseLinks:!0,isEmpty:!this.props.board.description,onSubmit:this.handleDescriptionUpdated,value:this.props.board.description,placeholder:"Add a description here..."}):null,this.props.isShare?null:React.createElement("div",{className:"collaborators"+(this.props.editingHeader||this.props.zoom<1?" hidden":"")},e)))}});t.exports=s,i={title:{marginTop:46}}},{"../../actions/BoardsActionCreators":29,"./Collaborator.jsx":38,"./Rename.jsx":67}],72:[function(e,t,n){var i=React.createClass({displayName:"UnsubscribeConfirmation",render:function(){return React.createElement("div",{className:"unsubscribe-alert"},"You have been unsubscribed from email notifications for this item.")}});t.exports=i},{}],73:[function(e,t,n){var i=e("../../actions/BoardsActionCreators"),o=e("../../stores/BoardStore"),r=e("classnames"),a=e("classie"),s=e("react-pure-render/mixin"),c=!1,l=!1,u=1,h=React.createClass({displayName:"ZoomHandler",propTypes:{boardHeight:React.PropTypes.number,zoom:React.PropTypes.number},mixins:[s],getInitialState:function(){return{active:!1,clearTooltip:!1,rangeMin:.5,maxBoardHeight:0}},componentDidMount:function(){this.calculateMinRange();var e=ReactDOM.findDOMNode(this.refs.zoom);e.addEventListener("input",this.handleChange,!1),e.addEventListener("change",this.handleChange,!1),document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("mousedown",this.handleDocumentMouseDown,!1),document.addEventListener("mouseup",this.handleDocumentMouseUp,!1),window.addEventListener("resize",this.calculateMinRange,!1),setTimeout(function(){return e.value=1})},componentDidUpdate:function(e,t){if(e.boardHeight!==this.props.boardHeight&&this.calculateMinRange(),1===this.props.zoom&&1!==e.zoom){var n=ReactDOM.findDOMNode(this.refs.zoom);1!==n.value&&(n.value=1,this.state.active&&this.setState({active:!1},function(){a.remove(n,"active")}))}},componentWillUnmount:function(){ReactDOM.findDOMNode(this.refs.zoom).removeEventListener("input",this.handleChange,!1),ReactDOM.findDOMNode(this.refs.zoom).removeEventListener("change",this.handleChange,!1),a.remove(document.body,"zooming"),document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("mousedown",this.handleDocumentMouseDown,!1),document.removeEventListener("mouseup",this.handleDocumentMouseUp,!1),window.removeEventListener("resize",this.calculateMinRange,!1)},render:function(){var e=r({"zoom-input-wrap":!0,active:this.state.active,"title-link":!this.state.active,top:!this.state.active});return React.createElement("div",{className:"board-zoom"},this.props.zoom<1?React.createElement("a",{onClick:this.resetZoom,className:"reset-zoom"},"×"):null,React.createElement("div",{className:e,"data-title":"Zoom Out"},React.createElement("input",{ref:"zoom",type:"range",min:Math.max(this.state.rangeMin.toFixed(2),.01),max:1,defaultValue:1,step:.01,name:"power"})))},calculateMinRange:function(){if(this.props.boardHeight){var e=window.innerHeight,t=e/this.props.boardHeight;t=t>=1?.9:t,this.state.rangeMin!==t&&this.setState({rangeMin:t},function(){t>o.getZoom()&&(ReactDOM.findDOMNode(this.refs.zoom).value=t,i.setZoom(t))}.bind(this))}},handleChange:function(e){var t,n=parseFloat(e.target.value),o=ReactDOM.findDOMNode(this.refs.zoom);1>n?(a.add(document.body,"zooming"),a.add(o,"active"),t=!0):1===n&&1!==u&&(a.remove(document.body,"zooming"),a.remove(o,"active"),t=!1,l=!0),this.state.active!==t&&this.setState({active:t},function(){t&&this.trackActivationAnalytics()}.bind(this)),i.setZoom(n),u=n},handleDocumentClick:function(e){var t=ReactDOM.findDOMNode(this.refs.zoom);e.target!==t&&1===parseFloat(t.value)?a.remove(t,"active"):e.target!==t||l||(a.add(t,"active"),this.state.active||this.setState({active:!0},function(){this.trackActivationAnalytics()}.bind(this))),l=!1},isTargetOutside:function(e){var t=ReactDOM.findDOMNode(this.refs.zoom);return t.value<1&&!a.has(document.body,"is-dragging")&&(e===document.querySelector(".board-zoom-wrap").parentNode||e===document.body||a.has(e,"wrap")&&!a.has(e,"board-details"))?!0:!1},handleDocumentMouseDown:function(e){var t=ReactDOM.findDOMNode(this.refs.zoom);c=this.isTargetOutside(e.target),e.target===t&&this.setState({clearTooltip:!0})},handleDocumentMouseUp:function(e){var t=ReactDOM.findDOMNode(this.refs.zoom);(c&&this.isTargetOutside(e.target)||1===parseFloat(t.value)&&a.has(t,"active"))&&this.resetZoom(),setTimeout(function(){return l=!1})},resetZoom:function(){var e=ReactDOM.findDOMNode(this.refs.zoom);i.setZoom(1),e.value=1,a.remove(document.body,"zooming"),a.remove(e,"active"),this.state.active&&this.setState({active:!1}),setTimeout(function(){return e.value=1})},trackActivationAnalytics:function(){window.analytics.track("Boards.Zoom",{on:"activate"},{integrations:{All:!1}})}});t.exports=h},{"../../actions/BoardsActionCreators":29,"../../stores/BoardStore":99,classie:2,classnames:4,"react-pure-render/mixin":23}],74:[function(e,t,n){var i={SCALED:"SCALED",FULLSIZE:"FULLSIZE"};t.exports=i},{}],75:[function(e,t,n){var i=React.createClass({displayName:"ColorItem",safeHexColor:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?e:/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e)?"#"+e:"#000"},render:function(){return React.createElement("div",{className:"color-swatch",style:{backgroundColor:this.safeHexColor(this.props.color)}},React.createElement("div",{className:"item-title"},this.props.title))}});t.exports=i},{}],76:[function(e,t,n){var i=e("../../../utils/file-extension-service"),o=React.createClass({displayName:"FileItem",render:function(){var e="file-info filetype-"+i.getFileType(this.props.filename);return React.createElement("div",{className:e},React.createElement("div",{className:"filetype-icon"}),React.createElement("div",{className:"filename"},this.props.filename))}});t.exports=o},{"../../../utils/file-extension-service":109}],77:[function(e,t,n){var i=e("../../../utils/file-extension-service"),o=e("fontfaceobserver"),r=React.createClass({displayName:"FontItem",sheet:null,getInitialState:function(){return{fontLoaded:!1,loadAttempts:0}},componentDidMount:function(){this.sheet=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}(),this.loadFont()},componentDidUpdate:function(){this.loadFont()},loadFont:function(){if(this.props.downloadUrl&&!this.state.fontLoaded&&this.state.loadAttempts<=3&&this.props.filename){var e=this.props.filename.replace(/\.[^\/.]+$/,""),t="@font-face{ font-family: '"+e+"'; src: url('"+this.props.downloadUrl+"') }",n=new o(e);this.sheet.insertRule(t,0);var i=this,r=new XMLHttpRequest;r.open("GET",this.props.downloadUrl),r.onreadystatechange=function(){i.isMounted()&&4===r.readyState&&n.check().then(function(){i.setFontState(!0)},function(){i.setState({loadAttempts:i.state.loadAttempts+1})})},r.send()}},componentWillUnmount:function(){this.sheet&&(this.sheet.ownerNode&&document.head.removeChild(this.sheet.ownerNode),this.sheet=null)},setFontState:function(e){this.setState({fontLoaded:e})},render:function(){var e="file-info filetype-"+i.getFileType(this.props.filename),t={fontFamily:this.props.filename.replace(/\.[^\/.]+$/,"")};return React.createElement("div",{className:e},this.state.fontLoaded?React.createElement("div",{className:"font-preview",style:t},"Aa Zz"):React.createElement("div",{className:"filetype-icon"}),React.createElement("div",{className:"filename"},this.props.title))}});t.exports=r},{"../../../utils/file-extension-service":109,fontfaceobserver:13}],78:[function(e,t,n){var i=(e("../../../constants/BoardsConstants"),e("../../../../common/components/Spinner.jsx")),o=React.createClass({displayName:"ImageItem",getInitialState:function(){return{imageLoaded:!1}},componentDidMount:function(){this.loadImage()},componentDidUpdate:function(){this.loadImage()},loadImage:function(){var e=ReactDOM.findDOMNode(this),t=new Image;t.onload=function(){e.className=e.className.indexOf("stretch")>=0?"image stretch":"image",this.isMounted()&&!this.state.imageLoaded&&this.setState({imageLoaded:!0})}.bind(this),t.src=this.props.thumbnailFullUrl},imageDimensions:function(){var e=[270,563,856,1149],t=this.props.naturalHeight,n=this.props.naturalWidth,i=e[this.props.columns-1],o=Math.ceil(i*t/n);return o<this.props.itemHeight&&(o=this.props.itemHeight,i=Math.floor(n*o/t)),{width:i,height:o}},loaderStyle:function(){return{width:this.props.itemWidth,height:this.props.itemHeight,position:"relative"}},render:function(){var e=this.imageDimensions(),t=this.loaderStyle();return React.createElement("div",{style:e,className:"image loading"},this.state.imageLoaded?React.createElement("img",{src:this.props.thumbnailFullUrl,alt:this.props.title,style:e}):React.createElement(i,{styles:t}))}});t.exports=o},{"../../../../common/components/Spinner.jsx":120,"../../../constants/BoardsConstants":90}],79:[function(e,t,n){var i=e("ftellipsis"),o=e("dompurify"),r=React.createClass({displayName:"NoteItem",propTypes:{title:React.PropTypes.string,note:React.PropTypes.string},ellipsis:null,componentDidMount:function(){var e=this.refs.note;this.ellipsis=i(e),this.ellipsis.calc(),this.ellipsis.set()},componentDidUpdate:function(){if(this.ellipsis)try{this.ellipsis.unset(),this.ellipsis.calc(),this.ellipsis.set()}catch(e){}},render:function(){return React.createElement("div",{className:"note-content",style:{backgroundColor:this.props.color}},React.createElement("h4",null,this.props.title?this.props.title:"Untitled Note"),React.createElement("span",{ref:"note",dangerouslySetInnerHTML:{__html:o.sanitize(this.props.note)}}))}});t.exports=r},{dompurify:6,ftellipsis:14}],80:[function(e,t,n){var i=e("../../../utils/file-extension-service"),o=e("../../../../common/components/Spinner.jsx"),r=React.createClass({displayName:"SourceFileItem",propTypes:{filename:React.PropTypes.string,thumbnailFullUrl:React.PropTypes.string,downloadUrl:React.PropTypes.string,itemWidth:React.PropTypes.number,itemHeight:React.PropTypes.number,columns:React.PropTypes.number},getInitialState:function(){return{naturalWidth:0,naturalHeight:0,imageLoaded:!1,imageError:!1}},componentDidMount:function(){var e=ReactDOM.findDOMNode(this);e.querySelector(".spinner").parentNode.style.height=e.parentNode.parentNode.offsetHeight+"px",this.loadImage()},getImageDimensions:function(){if(!this.state.imageLoaded)return{};var e=[270,563,856,1149],t=this.state.naturalHeight,n=this.state.naturalWidth,i=e[this.props.columns-1],o=this.props.itemHeight-43,r=Math.ceil(i*t/n);return o>r&&(r=o,i=Math.floor(n*r/t)),{width:i,height:r}},render:function(){var e="source-file filetype-"+i.getSourceFileType(this.props.filename);this.state.imageError&&(e="file-info filetype-"+i.getFileType(this.props.filename));var t=this.getImageDimensions();return React.createElement("div",{className:e},this.state.imageError?React.createElement("span",null,React.createElement("div",{className:"filetype-icon"}),React.createElement("div",{className:"filename"},this.props.filename)):React.createElement("span",null,React.createElement("div",{className:"source-thumbnail loading"},this.state.imageLoaded?React.createElement("img",{style:t,src:this.props.thumbnailFullUrl,alt:this.props.filename}):React.createElement(o,null)),React.createElement("div",{className:"filename",ref:"filename","data-filename":this.props.filename})))},loadImage:function(){var e=new Image;e.onload=function(){ReactDOM.findDOMNode(this).querySelector(".source-thumbnail").className="source-thumbnail",this.setState({naturalWidth:e.width,naturalHeight:e.height,imageLoaded:!0})}.bind(this),e.onerror=function(){this.setState({imageError:!0,imageLoaded:!1})}.bind(this),e.src=this.props.thumbnailFullUrl}});t.exports=r},{"../../../../common/components/Spinner.jsx":120,"../../../utils/file-extension-service":109}],81:[function(e,t,n){var i,o=e("../../../actions/BoardsActionCreators"),r=e("../../../../common/utilities/color-functions-service"),a=e("../Rename.jsx"),s=React.createClass({displayName:"ItemViewColor",getInitialState:function(){return{isSaved:!1}},componentDidMount:function(){document.addEventListener("keyup",this.handleDocumentKeyUp,!1),this.props.isNew&&setTimeout(function(){var e,t=document.querySelector(".color-name-value h2");if(t.focus(),document.body.createTextRange)e=document.body.createTextRange(),e.moveToElementText(t),e.select();else if(window.getSelection){var n=window.getSelection();e=document.createRange(),e.selectNodeContents(t),n.removeAllRanges(),n.addRange(e)}},150)},componentWillUnmount:function(){document.removeEventListener("keyup",this.handleDocumentKeyUp)},handleDocumentKeyUp:function(e){13===e.which&&this.setState({isSaved:!0})},getReadableContrastColor:function(e){var t;return t=r.isDark(e.replace("#",""))?"#fff":"#000"},safeHexColor:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?e:/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e)?"#"+e:"#000"},colorLabelStyle:function(){var e;return e=r.isDark(this.safeHexColor(this.props.color).replace("#",""))?r.lighten(this.safeHexColor(this.props.color),20):r.darken(this.safeHexColor(this.props.color),45),{color:e}},testColor:function(e){var t=!1;return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?t=!0:/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e)&&(t=!0,e="#"+e),t?e:!1},handleColorSubmit:function(e){var t=this.testColor(e);t&&o.saveColorValue(this.props.item,t)},handleKeyUp:function(e){var t=this.testColor(e);t&&this.props.onColorKeypress(t)},render:function(){var e=this.props,t=e.isNew,n=e.color,o=this.state,r=o.isSaved,s=this.colorLabelStyle(),c=_.assign({},i.initalHelp,{marginLeft:-(i.initalHelp.width/2),opacity:t&&!r?1:0}),l=_.assign({},i.helpText,{marginLeft:-(i.helpText.width/2),opacity:t&&!r?1:0});return React.createElement("div",{className:"color-swatch closable",style:{backgroundColor:this.safeHexColor(n)}},React.createElement("div",{className:"color-label unclosable",style:s},React.createElement("span",{style:c},"Enter HEX value"),React.createElement("span",{className:"hash"},"#"),React.createElement(a,{isColor:!0,allowEdit:!this.props.isShare,className:"color-name-value",onSubmit:this.handleColorSubmit,onKeypress:this.handleKeyUp,value:this.safeHexColor(n).replace("#",""),placeholder:""}),React.createElement("span",{style:l},"Press ENTER to save, ESC to cancel")))}}),c="opacity 200ms ease-out 0s";i={initalHelp:{fontSize:12,fontWeight:700,left:"50%",position:"absolute",textTransform:"uppercase",top:10,transition:c,WebkitTransition:c,MozTransition:c,width:120},helpText:{bottom:-48,fontSize:12,fontWeight:600,left:"50%",opacity:.4,transition:c,WebkitTransition:c,MozTransition:c,position:"absolute",textTransform:"uppercase",width:300}},t.exports=s},{"../../../../common/utilities/color-functions-service":151,"../../../actions/BoardsActionCreators":29,"../Rename.jsx":67}],82:[function(e,t,n){var i=e("../../../utils/file-extension-service"),o=e("../IncompleteDownloadLink.jsx"),r=React.createClass({displayName:"ItemViewFile",render:function(){var e="file-wrap unclosable filetype-"+i.getFileType(this.props.filename);!this.props.downloadUrl&&this.props.isShare&&(e+=" downloads-disabled");var t=this.props.isShare?null:React.createElement(o,{className:"download-file",title:"upload still in progress, try again shortly"});return React.createElement("div",{className:e},React.createElement("div",{className:"file-content"},React.createElement("div",{className:"filetype-icon"}),React.createElement("div",{className:"filename"},this.props.filename)),this.props.downloadUrl?React.createElement("a",{href:this.props.downloadUrl,className:"download-file",download:!0},"Download"):t)}});t.exports=r},{"../../../utils/file-extension-service":109,"../IncompleteDownloadLink.jsx":46}],83:[function(e,t,n){var i=e("../../../utils/file-extension-service"),o=e("../IncompleteDownloadLink.jsx"),r=e("classnames"),a=e("fontfaceobserver"),s=React.createClass({displayName:"ItemViewFont",sheet:null,getInitialState:function(){return{fontLoaded:!1,fontDisplaySetting:"alphabet",loadAttempts:0}},componentDidMount:function(){this.sheet=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}(),this.loadFont()},loadFont:function(){if(this.props.downloadUrl&&!this.state.fontLoaded&&this.state.loadAttempts<=3&&this.props.filename){var e=this.props.filename.replace(/\.[^\/.]+$/,""),t="@font-face{ font-family: '"+e+"'; src: url('"+this.props.downloadUrl+"') }",n=new a(e);this.sheet.insertRule(t,0);var i=this,o=new XMLHttpRequest;o.open("GET",this.props.downloadUrl),o.onreadystatechange=function(){i.isMounted()&&4===o.readyState&&n.check().then(function(){i.setFontState(!0)},function(){i.setState({loadAttempts:i.state.loadAttempts+1})})},o.send()}},componentDidUpdate:function(){this.loadFont()},setFontState:function(e){this.setState({fontLoaded:e})},setFontDisplaySetting:function(e){var t=e.target.getAttribute("data-type");this.setState("alphabet"===t?{fontDisplaySetting:"alphabet"}:{fontDisplaySetting:"sentence"})},componentWillUnmount:function(){this.sheet&&(this.sheet.ownerNode&&document.head.removeChild(this.sheet.ownerNode),this.sheet=null)},render:function(){var e="";this.props.downloadUrl||(e=" downloads-disabled");var t="file-wrap unclosable filetype-"+i.getFileType(this.props.filename)+e,n=null;this.props.disableFontDownloads||(n=this.props.downloadUrl?this.state.fontLoaded?React.createElement("a",{href:this.props.downloadUrl,className:"download-font"},"Download"):React.createElement("a",{href:this.props.downloadUrl,className:"download-file"},"Download"):React.createElement(o,{className:"download-file",title:"upload still in progress, try again shortly"}));var a=r({"font-display-alphabet":!0,active:"alphabet"===this.state.fontDisplaySetting}),s=r({"font-display-sentence":!0,active:"sentence"===this.state.fontDisplaySetting}),c={fontFamily:this.props.filename.replace(/\.[^\/.]+$/,"")};return this.state.fontLoaded?React.createElement("div",{className:"font-wrap unclosable"},React.createElement("div",{className:"font-title-wrap"},React.createElement("div",{className:"font-title"},this.props.title),React.createElement("div",{className:"font-display-options"},React.createElement("a",{className:a,"data-type":"alphabet",onClick:this.setFontDisplaySetting}),React.createElement("a",{className:s,"data-type":"sentence",onClick:this.setFontDisplaySetting}))),React.createElement("div",{className:"font-preview",style:c},"alphabet"===this.state.fontDisplaySetting?React.createElement("span",null,"Aa Bb Cc Dd Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv Ww Xx Yy Zz",React.createElement("br",null),"0123456789"):React.createElement("span",null,"Grumpy wizards make toxic brew for the evil Queen and Jack.")),React.createElement("div",{className:"font-footer"},n)):React.createElement("div",{className:t},React.createElement("div",{className:"file-content"},React.createElement("div",{className:"filetype-icon"}),React.createElement("div",{className:"filename"},this.props.filename)),n)}});t.exports=s},{"../../../utils/file-extension-service":109,"../IncompleteDownloadLink.jsx":46,classnames:4,fontfaceobserver:13}],84:[function(e,t,n){var i=e("../../../constants/BoardsConstants"),o=e("../../../mixins/AnnotationsMixin.jsx"),r=e("../../../mixins/SketchMixin.jsx"),a=e("../../../stores/BoardStore"),s=e("../../../../common/components/Loading.jsx"),c=e("classie"),l=React.createClass({displayName:"ItemViewImage",propTypes:{id:React.PropTypes.number,imageUrl:React.PropTypes.string,thumbnailFullUrl:React.PropTypes.string,loaded:React.PropTypes.bool,showSidebar:React.PropTypes.bool,naturalWidth:React.PropTypes.number,naturalHeight:React.PropTypes.number,isFullSize:React.PropTypes.bool,closing:React.PropTypes.bool,onImageAnimated:React.PropTypes.func,isSourceFile:React.PropTypes.bool},mixins:[o,r],getInitialState:function(){return{imageLoaded:!1,thumbnailImageLoaded:!1,animatedIn:!1,imageWidth:0,imageHeight:0}},componentDidMount:function(){this.loadImage(!0)},componentDidUpdate:function(e,t){(this.props.imageUrl!==e.imageUrl||this.props.thumbnailFullUrl!==e.thumbnailFullUrl)&&this.loadImage(),this.props.isFullSize&&!this.state.imageLoaded&&this.loadFullsizeImage(),this.props.closing&&!e.closing&&this.animateOut(),this.props.isFullSize!==e.isFullSize&&this.loadImageStyle()},getVisibleSketch:function(){return a.getVisibleSketch()},render:function(){var e=this.renderAnnotations(),t=this.renderVisibleSketch();return React.createElement("div",{className:"image-wrap",ref:"imageWrap"},e,t,!this.props.isFullSize||this.state.imageLoaded||this.props.isSourceFile?null:React.createElement(s,null),React.createElement("img",{ref:"image",onLoad:this.handleImageLoad,className:"board-item-image unclosable",onClick:this.handleImageClick,onMouseEnter:this.handleImageMouseEnter,onMouseMove:this.handleImageMouseMove,onMouseLeave:this.handleImageMouseLeave,src:this.props.isFullSize&&this.state.imageLoaded?this.props.imageUrl:this.props.thumbnailFullUrl}))},handleImageLoad:function(e){this.isMounted()&&!this.state.thumbnailImageLoaded&&this.setState({thumbnailImageLoaded:!0,imageWidth:e.target.naturalWidth,imageHeight:e.target.naturalHeight})},loadImage:function(e){e=!!e;var t=new Image;t.onload=function(){e?this.animateIn():this.loadImageStyle()}.bind(this),t.src=this.props.thumbnailFullUrl},loadFullsizeImage:function(){var e=new Image;e.onload=function(){this.isMounted()&&!this.state.imageLoaded&&this.setState({imageLoaded:!0}),this.loadImageStyle()}.bind(this),e.src=this.props.imageUrl},loadImageStyle:function(){if(this.isMounted()){var e=ReactDOM.findDOMNode(this.refs.image);this.props.isFullSize?(e.style.height=e.naturalHeight+"px",e.style.width=e.naturalWidth+"px"):e.removeAttribute("style")}},animateIn:function(){var e,t=document.querySelector("[data-board-item-id='"+this.props.id+"']");if(this.props.isSourceFile){var n=t.querySelector(".source-thumbnail");n&&(e=n.children[0])}else e=t?t.querySelector(".image"):null;var o=ReactDOM.findDOMNode(this.refs.image),r=e?e.getBoundingClientRect():null,a=o.getBoundingClientRect(),s=o.clientWidth,l=this.props.isSourceFile?43:0;return e&&0!==e.clientWidth&&o&&0!==o.clientWidth?(c.add(t,"hidden"),o.style.position="fixed",
o.style.width=e.clientWidth+"px",o.style.height=e.clientHeight+"px",o.style.maxHeight="initial",o.style.border="medium none",o.style.top=0,o.style.left=0,o.style.opacity=1,TweenLite.set(o,{clip:"rect(0, "+t.clientWidth+"px, "+(t.clientHeight-l)+"px, 0)",x:r.left+window.pageXOffset-$(window).scrollLeft(),y:r.top+window.pageYOffset-$(window).scrollTop(),scale:e.clientWidth/o.clientWidth}),void TweenLite.to(o,i.ANIMATION_TIMINGS.ITEM_VIEW_OPEN/1e3,{clip:"rect(0, "+e.clientWidth+"px, "+e.clientHeight+"px, 0)",x:a.left+1,y:a.top+1,scale:s/e.clientWidth,force3D:!0,ease:Power1.easeOut,onComplete:function(){c.add(o,"visible"),o.removeAttribute("style"),this.setState({animatedIn:!0}),this.props.onImageAnimated(),setTimeout(function(){c.remove(t,"hidden")},150)}.bind(this)})):(c.add(o,"visible"),void this.setState({animatedIn:!0}))},animateOut:function(){if(this.state.animatedIn){var e,t=document.querySelector("[data-board-item-id='"+this.props.id+"']");if(this.props.isSourceFile){var n=t.querySelector(".source-thumbnail");n&&(e=n.children[0])}else e=t?t.querySelector(".image"):null;var o=ReactDOM.findDOMNode(this.refs.image),r=e.getBoundingClientRect(),a=o.getBoundingClientRect(),s=o.clientWidth,l=o.clientHeight,u=this.props.isSourceFile?t.clientHeight-43:t.clientHeight;c.add(t,"hidden"),o.style.position="fixed",o.style.width=s+"px",o.style.height=l+"px",o.style.top=0,o.style.left=0,o.style.opacity=1,o.style.border="medium none",o.style.maxWidth="none",o.style.maxHeight="none",o.style.boxShadow="none",TweenLite.set(o,{clip:"rect(0, "+s+"px, "+l+"px, 0)",x:a.left,y:a.top,scale:1});var h=Math.floor(t.clientWidth/e.clientWidth*o.width),d=Math.floor(u/e.clientHeight*o.height),p=function(){c.remove(t,"hidden")};TweenLite.to(o,i.ANIMATION_TIMINGS.ITEM_VIEW_CLOSE/1e3,{clip:"rect(0, "+h+"px, "+d+"px, 0)",x:r.left+window.pageXOffset-$(window).scrollLeft(),y:r.top+window.pageYOffset-$(window).scrollTop(),scale:e.clientWidth/o.clientWidth,force3D:!0,ease:Power1.easeOut,onComplete:p})}},loaded:function(){return this.props.loaded},naturalWidth:function(){return this.props.isSourceFile?this.state.imageWidth:this.props.naturalWidth},naturalHeight:function(){return this.props.isSourceFile?this.state.imageHeight:this.props.naturalHeight},imageSelector:function(){return".board-item-image"}});t.exports=l},{"../../../../common/components/Loading.jsx":117,"../../../constants/BoardsConstants":90,"../../../mixins/AnnotationsMixin.jsx":94,"../../../mixins/SketchMixin.jsx":97,"../../../stores/BoardStore":99,classie:2}],85:[function(e,t,n){function i(){m.add(u(this.refs.toolbar),"is-editing"),this.focusHandler()}function o(){m.remove(u(this.refs.toolbar),"is-editing"),this.blurHandler()}function r(){var e=c.getValue(!1);e=v(e);var t=g.sanitize(e);this.handleNoteUpdate(t)}function a(){c.composer.element.removeEventListener("click",s)}function s(e){for(var t=e.target,n=!1;!n;){if((t&&t.classList.contains("note-inner")||null===t)&&(n=!0),t.href){e.preventDefault(),e.stopPropagation(),window.open(t.href,"_blank");break}t=t.parentNode}}var c,l=ReactDOM,u=l.findDOMNode,h=e("../../../actions/BoardsActionCreators"),d=e("../../../stores/BoardStore"),p=e("../Rename.jsx"),m=e("classie"),f=e("classnames"),g=e("dompurify"),v=e("emoji-strip"),y=function(){return{isEditingStore:d.getItemViewEditingState()}},E=React.createClass({displayName:"ItemViewNote",propTypes:{isNew:React.PropTypes.bool.isRequired,item:React.PropTypes.object.isRequired,note:React.PropTypes.string.isRequired,onTitleUpdated:React.PropTypes.func.isRequired,title:React.PropTypes.string.isRequired},getInitialState:function(){return _.assign(y(),{isClosable:!0,isEditing:!1})},componentDidMount:function(){d.addChangeListener(this._onChange),this.initEditor()},componentDidUpdate:function(e,t){this.state.isClosable||this.state.isEditing||this.isUnmounting||this.setState({isClosable:!0},function(){setTimeout(function(){h.setItemViewEditingState(!1)},100)})},initEditor:function(){var e=u(this.refs.noteContent),t=u(this.refs.toolbarwrapper),n=u(this.refs.title).querySelector("h2");document.addEventListener("keyup",this.keyUpHandler,!1),c=new wysihtml5.Editor(e,{toolbar:t,parserRules:window.wysihtml5ParserRules,cleanUp:!1,useLineBreaks:!1,autoLink:!0}),c.on("focus",i.bind(this)),c.on("blur",o.bind(this)),c.on("change",r.bind(this)),c.on("destroy:composer",a.bind(this)),n.addEventListener("focus",this.focusHandler,!1),n.addEventListener("blur",this.blurHandler,!1),(this.props.isNew||!this.props.title)&&setTimeout(function(){return n.focus()},150),u(this.refs.noteWrap).addEventListener("scroll",this.scrollHandler,!1)},componentWillUnmount:function(){var e=u(this.refs.title).querySelector("h2");this.isUnmounting=!0,d.removeChangeListener(this._onChange),m.remove(document.body,"wysihtml5-supported"),document.removeEventListener("keyup",this.keyUpHandler),this.refs.noteWrap.removeEventListener("scroll",this.scrollHandler),c.stopObserving("focus",i),c.stopObserving("blur",o),c.stopObserving("change",r),c.stopObserving("destroy:composer",a),e.removeEventListener("focus",this.focusHandler),e.removeEventListener("blur",this.blurHandler),c.destroy()},handleNoteUpdate:function(e){h.updateNoteContent(this.props.item,e),e!==c.getValue(!1)&&c.setValue(e,!1)},scrollHandler:function(e){var t=e.target;this.refs.gradientBottom.style.opacity=t.offsetHeight+t.scrollTop>=t.scrollHeight-20?(t.scrollHeight-(t.offsetHeight+t.scrollTop))/20:1;var n=(t.offsetHeight+t.scrollTop-this.refs.noteWrap.offsetHeight)/40;this.refs.gradientTop.style.opacity=n>1?1:n},keyUpHandler:function(e){if(this.state.isEditing)switch(e.which){case 27:this.refs.noteContent.blur()}},focusHandler:function(){this.setState({isClosable:!1,isEditing:!0},function(){h.setItemViewEditingState(!0)})},blurHandler:function(){this.setState({isEditing:!1},function(){setTimeout(function(){r.bind(this)()}.bind(this),1)}.bind(this))},render:function(){var e={contentEditable:{height:1,width:1,marginTop:-1,marginLeft:-1,overflow:"hidden"},noteWrapper:{maxHeight:window.innerHeight-100},noteInner:{maxHeight:window.innerHeight-220}},t=f({"note-contents":!0,closable:!this.state.isEditingStore,unclosable:this.state.isEditingStore}),n=f({"note-wrap":!0,closable:!this.state.isEditingStore,unclosable:this.state.isEditingStore});return React.createElement("div",{className:"note-item"},React.createElement("div",{id:"wysihtml5-editor-toolbar",ref:"toolbarwrapper",className:"unclosable"},React.createElement("header",{ref:"toolbar"},React.createElement("ul",{className:"commands"},React.createElement("li",{"data-wysihtml5-command":"bold",title:"Make text bold (CTRL + B)",className:"command"},"Bold ",React.createElement("i",null)),React.createElement("li",{"data-wysihtml5-command":"italic",title:"Make text italic (CTRL + I)",className:"command"},"Italic ",React.createElement("i",null)),React.createElement("li",{"data-wysihtml5-command":"underline",title:"Underline text (CTRL + U)",className:"command"},"Underline ",React.createElement("i",null)),React.createElement("li",{"data-wysihtml5-command":"strike",title:"Strike through selected text",className:"command"},"Strike Through ",React.createElement("i",null)),React.createElement("li",{"data-wysihtml5-command":"insertUnorderedList",title:"Insert an unordered list",className:"command"},"Unordered List ",React.createElement("i",null)),React.createElement("li",{"data-wysihtml5-command":"insertOrderedList",title:"Insert an ordered list",className:"command"},"Ordered List ",React.createElement("i",null))))),React.createElement("div",{className:t},React.createElement("div",{className:n},React.createElement("div",{className:"note-gradient-top",ref:"gradientTop"}),React.createElement("div",{className:"note-wrapper unclosable",style:e.noteWrapper},React.createElement("div",{className:"note-inner",ref:"noteWrap",style:e.noteInner},React.createElement("div",{contentEditable:!0,style:e.contentEditable}),React.createElement(p,{ref:"title",className:"title",onSubmit:this.props.onTitleUpdated,value:this.props.title,placeholder:"Untitled Note"}),React.createElement("div",{onClick:s,ref:"noteContent",id:"boardItemNoteContent","data-placeholder":"Write note here...",dangerouslySetInnerHTML:{__html:this.props.note}}))),React.createElement("div",{className:"note-gradient-bottom",ref:"gradientBottom"}))))},_onChange:function(){return this.setState(y())}});!function(e){e.commands.strike={exec:function(t,n){e.commands.formatInline.exec(t,n,"strike")},state:function(t,n){return e.commands.formatInline.state(t,n,"strike")}}}(wysihtml5),t.exports=E},{"../../../actions/BoardsActionCreators":29,"../../../stores/BoardStore":99,"../Rename.jsx":67,classie:2,classnames:4,dompurify:6,"emoji-strip":7}],86:[function(e,t,n){function i(e){for(var t=e.target,n=!1;!n;){if((t&&t.classList.contains("note-inner")||null===t)&&(n=!0),t.href){e.preventDefault(),e.stopPropagation(),window.open(t.href,"_blank");break}t=t.parentNode}}var o=ReactDOM,r=o.findDOMNode,a=e("../../../../common/utilities/parse-links"),s=React.createClass({displayName:"ItemViewNoteReadonly",componentDidMount:function(){this.refs.noteWrap.addEventListener("scroll",this.scrollHandler,!1)},componentWillUnmount:function(){this.refs.noteWrap.removeEventListener("scroll",this.scrollHandler)},scrollHandler:function(e){var t=e.target,n=r(this.refs.gradientBottom),i=r(this.refs.noteWrap),o=(t.offsetHeight+t.scrollTop-i.offsetHeight)/20;n.style.opacity=t.offsetHeight+t.scrollTop>=t.scrollHeight-20?(t.scrollHeight-(t.offsetHeight+t.scrollTop))/20:1,n.style.opacity=o>1?1:o},render:function(){var e,t={maxHeight:window.innerHeight-100},n={maxHeight:window.innerHeight-220};return this.props.note&&(e=a(this.props.note,null,["br","p","ul","ol","li","strike","b","u","i"])),React.createElement("div",{className:"note-contents closable"},React.createElement("div",{className:"note-wrap closable"},React.createElement("div",{className:"note-gradient-top",ref:"gradientTop"}),React.createElement("div",{className:"note-wrapper unclosable",style:t},React.createElement("div",{className:"note-inner",ref:"noteWrap",style:n},React.createElement("span",{className:"board-rename title"},React.createElement("h2",{className:"name"},this.props.title)),React.createElement("div",{onClick:i,ref:"noteContent",id:"boardItemNoteContent",dangerouslySetInnerHTML:{__html:e}}))),React.createElement("div",{className:"note-gradient-bottom",ref:"gradientBottom"})))}});t.exports=s},{"../../../../common/utilities/parse-links":155}],87:[function(e,t,n){var i=(e("classie"),e("./Image.jsx")),o=e("./File.jsx"),r=React.createClass({displayName:"ItemViewSourceFile",propTypes:{id:React.PropTypes.number,isShare:React.PropTypes.bool,title:React.PropTypes.string,filename:React.PropTypes.string,downloadUrl:React.PropTypes.string,imageUrl:React.PropTypes.string,isFullSize:React.PropTypes.bool,loaded:React.PropTypes.bool,naturalHeight:React.PropTypes.number,naturalWidth:React.PropTypes.number,showSidebar:React.PropTypes.bool,thumbnailFullUrl:React.PropTypes.string,closing:React.PropTypes.bool,toggleItemViewClassname:React.PropTypes.func,onImageAnimated:React.PropTypes.func},getInitialState:function(){return{imageLoaded:!1,imageError:!1}},componentDidMount:function(){var e=new Image;e.onload=function(){this.setState({imageLoaded:!0,imageError:!1},function(){this.props.toggleItemViewClassname(!1)}.bind(this))}.bind(this),e.onerror=function(){this.setState({imageError:!0,imageLoaded:!1},function(){this.props.toggleItemViewClassname(!0)}.bind(this))}.bind(this),e.src=this.props.thumbnailFullUrl},render:function(){var e=this.state.imageError?o:i,t={};return this.state.imageError?(t.isShare=this.props.isShare,t.downloadUrl=this.props.downloadUrl,t.filename=this.props.filename,t.title=this.props.title):(t.id=this.props.id,t.imageUrl=this.props.imageUrl,t.isFullSize=this.props.isFullSize,t.loaded=this.props.loaded,t.naturalHeight=this.props.naturalHeight,t.naturalWidth=this.props.naturalWidth,t.showSidebar=this.props.showSidebar,t.thumbnailFullUrl=this.props.thumbnailFullUrl,t.closing=this.props.closing,t.onImageAnimated=this.props.onImageAnimated,t.isSourceFile=!0),React.createElement(e,React.__spread({},t))}});t.exports=r},{"./File.jsx":82,"./Image.jsx":84,classie:2}],88:[function(e,t,n){var i=e("../../../utils/file-extension-service"),o=e("../../../utils/Contain"),r=e("../../../mixins/AnnotationsMixin.jsx"),a=e("../../../stores/BoardStore"),s=e("../../../mixins/SketchMixin.jsx"),c=e("classnames"),l=e("classie"),u=React.createClass({displayName:"ItemViewSourceFileWithBar",propTypes:{downloadUrl:React.PropTypes.string,filename:React.PropTypes.string,thumbnailFullUrl:React.PropTypes.string,showSidebar:React.PropTypes.bool,isFullSize:React.PropTypes.bool},mixins:[r,s],getInitialState:function(){return{imageWidth:0,imageHeight:0,imageLoaded:!1,imageError:!1,scaledWidth:0,top:0}},componentDidMount:function(){var e=new Image;e.onload=function(){this.setState({imageWidth:e.width,imageHeight:e.height,imageLoaded:!0,imageError:!1},function(){setTimeout(function(){this.setImageSize(),this.centerContainer()}.bind(this))}.bind(this))}.bind(this),e.onerror=function(){this.setState({imageError:!0,imageLoaded:!1})}.bind(this),e.src=this.refs.image.src,window.addEventListener("resize",this.setImageSize,!1),window.addEventListener("resize",this.centerContainer,!1)},centerContainer:function(){var e=ReactDOM.findDOMNode(this.refs.sourceFileInner);if(e){var t=window.innerHeight-200,n=Math.round(t/2-e.offsetHeight/2);this.setState({top:n})}},componentDidUpdate:function(e){e.showSidebar!==this.props.showSidebar?(this.setImageSize(),this.centerContainer()):e.isFullSize!==this.props.isFullSize&&this.setImageSize()},componentWillUnmount:function(){window.removeEventListener("resize",this.setImageSize),window.removeEventListener("resize",this.centerContainer)},getVisibleSketch:function(){return a.getVisibleSketch()},render:function(){var e=this.state,t=e.top,n=this.renderAnnotations(),o=this.renderVisibleSketch(),r=Object.assign({},h.container,{top:t}),a=c({"source-file-inner":!0,fullsize:this.props.isFullSize,unclosable:!0});a+=" filetype-"+i.getSourceFileType(this.props.filename),this.state.imageError&&(a="file-wrap unclosable filetype-"+i.getFileType(this.props.filename)),this.props.downloadUrl||(a+=" downloads-disabled");var s=this.props.filename.split(".").pop(),l=this.props.filename.substr(0,this.props.filename.lastIndexOf("."));return React.createElement("div",{className:this.state.imageError?a:null},this.state.imageError?React.createElement("span",null,React.createElement("div",{className:"file-content"},React.createElement("div",{className:"filetype-icon"}),React.createElement("div",{className:"filename"},this.props.filename)),this.props.downloadUrl?React.createElement("a",{href:this.props.downloadUrl,className:"download-file",download:!0},"Download"):null):React.createElement("div",{className:"image-wrap",ref:"imageWrap"},n,o,React.createElement("div",{className:a,ref:"sourceFileInner",style:r},React.createElement("img",{ref:"image",className:"source-file-image",src:this.props.thumbnailFullUrl,onClick:this.handleImageClick,onMouseEnter:this.handleImageMouseEnter,onMouseMove:this.handleImageMouseMove,onMouseLeave:this.handleImageMouseLeave}),!this.props.isFullSize&&React.createElement("a",{href:this.props.downloadUrl||window.location.href,onClick:this.props.downloadUrl?function(){}:function(e){return e.preventDefault()},className:"download-file"},React.createElement("span",{className:"filename"},React.createElement("span",{ref:"fileName",className:"filename-text"},React.createElement("span",{className:"text-inner",ref:"filenameInner"},l),React.createElement("span",{className:"file-extension",ref:"fileExtension"},".",s))),this.props.downloadUrl&&React.createElement("span",{className:"download-text"},"Download")))))},setImageSize:function(){if(!this.state.imageLoaded)return{};var e=ReactDOM.findDOMNode(this),t=ReactDOM.findDOMNode(this.refs.sourceFileInner),n=ReactDOM.findDOMNode(this.refs.image);if(t&&n){var i,r;if(e){if(this.props.isFullSize)i=this.naturalWidth(),r=this.naturalHeight();else{var a=e.parentNode,s=window.getComputedStyle(a),c=a.offsetWidth-parseInt(s.paddingLeft,10)-parseInt(s.paddingRight,10),u=a.offsetHeight-parseInt(s.paddingTop,10)-parseInt(s.paddingBottom,10),h=[[0,0,c,u],[0,0,this.state.imageWidth,this.state.imageHeight+74]],d=o(h[0],h[1]);i=d[2]}t.style.width=i+"px",t.style.height=r?r+"px":null,this.props.isFullSize?(n.style.width=i+"px",n.style.height=r+"px"):(n.style.width=null,n.style.height=null);var p=ReactDOM.findDOMNode(this.refs.fileName);if(p){var m=Math.max(29,219>=i?i-137:i-189);p.style.width=m+"px";var f=ReactDOM.findDOMNode(this.refs.filenameInner),g=ReactDOM.findDOMNode(this.refs.fileExtension);f.style.display="inline",f.style.removeProperty("width"),g.style.display="inline",f.style.width=Math.min(m-g.offsetWidth,f.offsetWidth)+"px",f.style.display="inline-block",g.style.display="inline-block",219>=i?l.add(t,"hide-icon"):l.remove(t,"hide-icon")}}}},loaded:function(){return this.state.imageLoaded},naturalWidth:function(){return this.state.imageWidth},naturalHeight:function(){return this.state.imageHeight},imageSelector:function(){return".source-file-image"}});t.exports=u;var h={container:{}}},{"../../../mixins/AnnotationsMixin.jsx":94,"../../../mixins/SketchMixin.jsx":97,"../../../stores/BoardStore":99,"../../../utils/Contain":102,"../../../utils/file-extension-service":109,classie:2,classnames:4}],89:[function(e,t,n){var i=e("keymirror");t.exports=i({UPDATE_BOARD_COLLABORATORS_TOGGLE:null,UPDATE_BOARD_PASSWORD_TOGGLE:null,UPDATE_BOARD_PASSWORD:null,UPDATE_FONT_FILES_DOWNLOAD_TOGGLE:null,UPDATE_IMAGE_DOWNLOAD_TOGGLE:null,UPDATE_SOURCE_FILES_DOWNLOAD_TOGGLE:null,PASSWORD_STEP_UPDATE_PASSWORD:null,PASSWORD_STEP_SAVE:null,PASSWORD_STEP_CHANGE:null,PASSWORD_STEP_NONE:null,PASSWORD_STEP_SAVING:null,PASSWORD_STEP_UPDATING:null,PASSWORD_STEP_SAVE_SUCCESS:null,PASSWORD_STEP_SAVE_FAIL:null,INIT_SAVE:null,UPDATE_BOARD_SETTINGS:null})},{keymirror:18}],90:[function(e,t,n){var i=e("keymirror");t.exports={ActionTypes:i({INITIAL_SERVER_LOAD:null,OPEN_MODAL:null,GOTO_BOARD:null,OPEN_BOARD_SHARE:null,TRIGGER_BOARD_SHARE_OVERLAY:null,TRIGGER_BOARD_SETTINGS_OVERLAY:null,BOARD_SHARE_LOADED:null,SET_ZOOM:null,BOARD_SETTINGS_LOADED:null,JOIN_BOARD:null,DELETE_BOARD_CONFIRMATION:null,SET_USER:null,SET_IS_ENTERPRISE:null,SET_COMPANY_DATA:null,SET_COLLABORATOR_DATA:null,SET_FILTER:null,SET_SORT:null,SET_SELECTED_COMPANY:null,SET_SELECTED_COLLABORATOR:null,SET_BOARDS:null,SET_FEATURE_FLAGS:null,SET_SINGLE_TENANT_CONFIG:null,SET_BASE_BOARDS_ROUTE:null,SET_BOARD_SPACE:null,URL_UPDATED:null,SET_BOARD:null,SET_SINGLE_ITEM_SHARE:null,SET_BOARD_SORT_ORDER:null,UPDATE_TITLE:null,UPDATE_DESCRIPTION:null,SET_LAYOUT_TYPE:null,UPDATE_GROUP_TITLE:null,UPDATE_GROUP_DESCRIPTION:null,ADD_GROUP:null,MOVE_GROUP:null,DELETE_GROUP:null,SET_ITEM_COLUMNS:null,MOVE_ITEM:null,DELETE_ITEM:null,GOTO_ITEM:null,PREVIOUS_ITEM:null,NEXT_ITEM:null,CLEAR_SELECTED_ITEM:null,UPDATE_ITEM_TITLE:null,UPDATE_ITEM_DESCRIPTION:null,UPDATE_COLOR_VALUE:null,SAVE_COLOR_VALUE:null,UPDATE_NOTE_CONTENT:null,LOAD_ITEM_COMMENTS:null,COMMENTS_LOADED:null,ADD_COMMENT:null,IDENTIFY_AND_ADD_COMMENT:null,UPDATE_COMMENT_ID:null,DELETE_COMMENT:null,UPDATE_COMMENT:null,EDIT_COMMENT_ANNOTATION:null,ADD_ANNOTATION:null,EDIT_ANNOTATION:null,REMOVE_ANNOTATION:null,VIEW_ANNOTATION:null,SET_HIGHLIGHTED_COMMENT:null,LOAD_ANNOTATIONS:null,TOGGLE_SKETCH_MODE:null,SET_ACTIVE_SKETCH:null,VIEW_SKETCH:null,LOAD_COMMENTS_ROUNDUP:null,COMMENTS_ROUNDUP_LOADED:null,MARK_ITEM_COMMENTS_READ:null,NEW_COLOR:null,NEW_NOTE:null,LOAD_NEW_ITEM:null,ADD_COLOR_FROM_BAR:null,ADD_NEW_COLOR_ITEM:null,ITEM_VIEW_OPEN:null,ITEM_VIEW_CLOSE:null,SET_HEADER_STATE:null,SET_IMAGE_COLORS:null,IMAGE_COLORS_LOADED:null,ITEM_VIEW_EDITING_STATE:null,SHARE_BOARD_ITEM:null,START_UPLOAD:null,ADD_TEMP_ITEM:null,ADD_BULK_TEMP_ITEMS:null,UPDATE_TEMP_ITEM:null,ITEM_UPLOADED:null,SOURCE_FILE_PREVIEW_GENERATED:null,TRIGGER_BROWSE:null,START_HEADER_UPLOAD:null,ADD_TEMP_HEADER:null,BOARD_HEADER_UPLOADED:null,TRIGGER_HEADER_BROWSE:null,HIDE_ADD_VIEW:null,SYNC_BOARD_ITEM:null,SYNC_BOARD_ITEM_UPLOAD_COMPLETE:null,SET_PHOTO_HEADER_SIZE:null,SET_PHOTO_HEADER_OFFSET:null,SET_PHOTO_HEADER_TINT:null,SET_PHOTO_HEADER_BLUR:null,DELETE_HEADER_IMAGE:null,TOGGLE_ITEM_SELECTION:null,CLEAR_SELECTION_STORE:null,SELECT_BOARD_ITEM:null,SELECT_FIRST_ITEM:null,TOGGLE_DRAGGER_ITEMS:null,BULK_DELETE_ITEMS:null,BULK_MOVE_ITEMS:null,BULK_SIZE_ITEMS:null,SET_DRAG_STATE:null,DRAG_MOVE_ITEM:null,DROP_ITEM:null,MOVE_ITEM_TO_GROUP:null}),PayloadSources:i({SERVER_ACTION:null,VIEW_ACTION:null}),SORT_TYPES:{activity:{id:1,name:"Recent"},alphanumeric:{id:2,name:"Alphanumeric"}},LAYOUT_TYPES:{MASONRY:1,METICULOUS:2,GRID:3},ITEM_TYPES:{IMAGE:1,NOTE:2,COLOR:3,FONT:4,DOCUMENT:5,MEDIA:6,SOURCE:7,GENERIC:8,FILE:[4,5,6,7,8]},ITEM_TYPE_NAMES:{1:"image",2:"note",3:"color",4:"font",5:"document",6:"media",7:"sourceFile",8:"genericFile"},ANIMATION_TIMINGS:{ITEM_VIEW_OPEN:300,ITEM_VIEW_CLOSE:290}}},{keymirror:18}],91:[function(e,t,n){var i=e("keymirror");t.exports={ActionTypes:i({REPLACE_WITH_REMOTE:null,SET_FROM_FILE:null,SET_IMAGE_CACHE:null,UPDATE_IMAGE_CACHE_KEY:null})}},{keymirror:18}],92:[function(e,t,n){var i=e("flux").Dispatcher,o=e("../constants/BoardsConstants"),r=e("object-assign"),a=r(new i,{handleViewAction:function(e){this.dispatch({source:o.PayloadSources.VIEW_ACTION,action:e})},handleServerAction:function(e){this.dispatch({source:o.PayloadSources.SERVER_ACTION,action:e})}});t.exports=a},{"../constants/BoardsConstants":90,flux:10,"object-assign":20}],93:[function(e,t,n){var i=e("flux").Dispatcher,o=_.assign(new i,{handleAction:function(e){this.dispatch({source:"ImageCacheAction",action:e})}});t.exports=o},{flux:10}],94:[function(e,t,n){var i=e("../stores/BoardStore"),o=e("../actions/BoardsActionCreators"),r=e("../components/board/ItemAnnotations.jsx"),a=e("classie"),s={getInitialState:function(){return{followerActive:!1,followerX:0,followerY:0}},componentDidUpdate:function(){var e=this.refs.imageWrap;e&&(i.getEditingCommentAnnotation()?a.add(e,"unclosable"):a.remove(e,"unclosable"))},renderAnnotations:function(){var e=i.getEditingCommentAnnotation(),t=i.getAnnotations(),n=i.getActiveAnnotation(),o=i.getVisibleSketch();return React.createElement(r,{isEditingAnnotations:e,annotations:t,activeAnnotation:n,visibleSketch:!!o,loaded:this.loaded(),showSidebar:this.props.showSidebar,naturalWidth:this.naturalWidth(),naturalHeight:this.naturalHeight(),onEditAnnotation:this.handleAnnotationEdited,followerActive:this.state.followerActive,followerX:this.state.followerX,followerY:this.state.followerY,onSetHighlightedComment:this.handleSetHighlightedComment,imageSelector:this.imageSelector()})},handleImageMouseEnter:function(e){i.getEditingCommentAnnotation()&&this.setState({followerActive:!0,followerX:e.clientX,followerY:e.clientY})},handleImageMouseMove:function(e){i.getEditingCommentAnnotation()&&this.setState({followerActive:!0,followerX:e.clientX,followerY:e.clientY})},handleImageMouseLeave:function(e){i.getEditingCommentAnnotation()&&this.setState({followerActive:!1,followerX:e.clientX,followerY:e.clientY})},handleImageClick:function(e){if(i.getEditingCommentAnnotation()){var t=this.refs.image,n=t.getBoundingClientRect(),r=Math.floor((e.clientX-n.left)*this.naturalWidth()/t.offsetWidth),a=Math.floor((e.clientY-n.top)*this.naturalHeight()/t.offsetHeight);o.addAnnotation(r,a),document.querySelector(".comment-editor-textarea").focus()}},handleAnnotationEdited:function(e,t){o.editAnnotation(e,t)},handleSetHighlightedComment:function(e){var t=i.getActiveAnnotation();t&&t.canEdit||o.setHighlightedComment(e)}};t.exports=s},{"../actions/BoardsActionCreators":29,"../components/board/ItemAnnotations.jsx":50,"../stores/BoardStore":99,classie:2}],95:[function(e,t,n){var i=e("classie"),o=e("../actions/BoardsActionCreators"),r=e("../actions/SelectionActionCreators"),a=e("../stores/BoardStore"),s={isIE:function(){return window.navigator.msPointerEnabled},dragStart:function(e){if(e.preventDefault(),this.props.canEdit&&!this.props.isShare&&(document.addEventListener("mousemove",this.dragMove,!1),document.addEventListener("mouseup",this.dragEnd,!1),this.props.selected.indexOf(this.props.item.get("id"))<0&&!this.props.isSelectingBulkItems&&r.clearSelectionStore(),!this.props.isLoading)){var t=ReactDOM.findDOMNode(this),n=t.getBoundingClientRect(),i=this.isIE()?1:1/this.props.zoom;o.setDragState({item:this.props.item.toJS(),started:!1,initialMouseX:e.clientX*i,initialMouseY:e.clientY*i,initialX:Math.floor(n.left*i),initialY:Math.floor(n.top*i),initialGroupID:this.props.groupID,newGroupID:null}),document.querySelector(".board-header").style.zIndex="3"}},dragTimeout:null,prevX:0,prevY:0,dragMove:function(e){if(!this.props.isLoading||this.props.canEdit){var t=ReactDOM.findDOMNode(this),n=a.getDragState(),r=this.isIE()?1:1/this.props.zoom;if(!(Math.abs(e.clientX*r-n.initialMouseX)<=3&&Math.abs(e.clientY*r-n.initialMouseY)<=3)){i.add(document.body,"is-dragging");var s=document.querySelector(".board-zoom-wrap"),c=s.offsetWidth,l=this.props.zoom<1?(c-c*this.props.zoom)/2:0,u=r*e.clientX-(n.initialMouseX-n.initialX),h=r*e.clientY-(n.initialMouseY-n.initialY);!this.isIE()&&window.pageYOffset>0&&this.props.zoom<1&&(h+=window.pageYOffset/this.props.zoom),!this.isIE()&&this.props.zoom<1&&(u-=l/this.props.zoom),u=Math.floor(u),h=Math.floor(h),this.setState({isDragging:!0,x:u,y:h});var d="translate("+u+"px, "+h+"px)";this.isIE()&&(d=this.setIETransform(u,h)),t.style.position="fixed",t.style.pointerEvents="none",t.style.zIndex=99999,t.style.top="0px",t.style.left="0px",t.style.WebkitTransform=d,t.style.msTransform=d,t.style.transform=d,o.setDragState({initialGroupID:this.props.groupID,started:!0}),this.dragTimeout&&(clearTimeout(this.dragTimeout),this.dragTimeout=null),(e.clientX!==this.prevX||e.clientY!==this.prevY)&&o.dragMoveItem(),this.prevX=e.clientX,this.prevY=e.clientY,e.preventDefault()}}},dragEnd:function(e){if(document.removeEventListener("mousemove",this.dragMove),document.removeEventListener("mouseup",this.dragEnd),document.querySelector(".board-header").style.zIndex="4",this.props.canEdit){this.dragTimeout&&(clearTimeout(this.dragTimeout),this.dragTimeout=null);var t=a.getDragState(),n=this.isIE()?1:1/this.props.zoom;if(t.item.id!==this.props.item.get("id")||Math.abs(n*e.clientX-t.initialMouseX)<=3&&Math.abs(n*e.clientY-t.initialMouseY)<=3)return this.props.isSelectingBulkItems?r.toggleItemSelection(this.props.item.get("id"),null,e.metaKey||e.ctrlKey,e.shiftKey):1===this.props.zoom&&e.target===ReactDOM.findDOMNode(this).querySelector(".zoom-wrap")&&o.gotoBoardItem(this.props.item.get("id")),void o.setDragState({newGroupID:null,initialGroupID:null,initialMouseX:0,initialMouseY:0,item:null,x:0,y:0,started:!1});if(!this.props.isLoading){if(this.isMounted()&&this.setState({isDragging:!1,isDropping:!0}),t.initialGroupID===t.newGroupID&&o.dropItem(this.props.selected),o.setDragState({newGroupID:null,initialGroupID:null,initialMouseX:0,initialMouseY:0,item:null,x:0,y:0,started:!1}),this.isMounted()){var s=ReactDOM.findDOMNode(this);s.style.position="absolute";var c="translate("+this.props.item.get("x")+"px, "+this.props.item.get("y")+"px)";s.style.WebkitTransform=c,s.style.msTransform=c,s.style.transform=c,setTimeout(function(){this.isMounted()&&this.setState({isDropping:!1})}.bind(this),30)}i.remove(document.body,"is-dragging")}}},setIETransform:function(e,t){if(this.props.zoom<1){var n=this.props.item.get("width"),i=this.props.item.get("height");e-=(n-n*this.props.zoom)/2,t-=(i-i*this.props.zoom)/2}var o="translate("+e+"px, "+t+"px)",r=this.props.zoom.toFixed(2),a=" scale("+r+") rotate(0.0001deg)";return o+a}};t.exports=s},{"../actions/BoardsActionCreators":29,"../actions/SelectionActionCreators":31,"../stores/BoardStore":99,classie:2}],96:[function(e,t,n){function i(){return{selectionStore:o.getStore()}}var o=e("../stores/SelectionStore"),r=e("../actions/SelectionActionCreators"),a=e("../utils/is"),s=!1,c={getInitialState:function(){var e=i();return e.isSelectingBulkItems=!1,e.metaKeyCode=null,e},handleDocumentKeyUp:function(e){this.state.isSelectingBulkItems&&this.state.metaKeyCode===e.which&&this.setState({isSelectingBulkItems:!1,metaKeyCode:null})},handleDocumentKeyDown:function(e){a(e.target,"#boardItemNoteContent")||a(e.target,"textarea")||a(e.target,"input")&&!a(e.target,"input[type=range]")||"true"===e.target.contentEditable||(e.metaKey||e.ctrlKey||e.shiftKey?(s||(r.selectFirstItem(),s=!0),this.setState({isSelectingBulkItems:!0,metaKeyCode:e.which})):this.state.isSelectingBulkItems&&this.setState({isSelectingBulkItems:!1}))},handleDocumentMouseMove:function(e){e.metaKey||e.ctrlKey||e.shiftKey||!this.state.isSelectingBulkItems||this.setState({isSelectingBulkItems:!1,metaKeyCode:null})},componentDidMount:function(){s=!1,o.addChangeListener(this._onSelectionStoreChange),document.addEventListener("keydown",this.handleDocumentKeyDown,!1),document.addEventListener("keyup",this.handleDocumentKeyUp,!1),document.addEventListener("mousemove",this.handleDocumentMouseMove,!1)},componentWillUnmount:function(){o.removeChangeListener(this._onSelectionStoreChange),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("keyup",this.handleDocumentKeyUp),document.removeEventListener("mousemove",this.handleDocumentMouseMove)},_onSelectionStoreChange:function(){return this.setState(i())}};t.exports=c},{"../actions/SelectionActionCreators":31,"../stores/SelectionStore":101,"../utils/is":111}],97:[function(e,t,n){var i=e("dompurify"),o={componentDidMount:function(){this.setSketchSize(),window.addEventListener("resize",_.throttle(this.setSketchSize,50),!1)},componentWillUpdate:function(e){if(this.props.showSidebar!==e.showSidebar){var t=this.refs.sketchContainer;t&&(this.props.showSidebar?(t.style.webkitTransitionDelay="0s",t.style.transitionDelay="0s"):(t.style.webkitTransitionDelay="0.35s",t.style.transitionDelay="0.35s"))}},componentDidUpdate:function(e){if(e.showSidebar!==this.props.showSidebar){var t=this.refs.sketchContainer;t&&setTimeout(function(){this.setSketchSize(),t.style.webkitTransitionDelay="0s",t.style.transitionDelay="0s"}.bind(this),310)}else this.setSketchSize()},componentWillUnmount:function(){window.removeEventListener("resize",_.throttle(this.setSketchSize,50),!1)},renderVisibleSketch:function(){var e=this.getVisibleSketch();return e?React.createElement("div",{ref:"sketchContainer",className:"sketch-container",dangerouslySetInnerHTML:{__html:i.sanitize(e)}}):null},setSketchSize:function(){var e=this.getVisibleSketch();if(e){var t=ReactDOM.findDOMNode(this).querySelector(".image-wrap img"),n=t.getBoundingClientRect(),i=this.refs.sketchContainer;i&&(i.style.width=t.offsetWidth+"px",i.style.height=t.offsetHeight+"px",i.style.top=n.top+"px",i.style.left=n.left+"px")}}};t.exports=o},{dompurify:6}],98:[function(e,t,n){function i(){var e=b(w.boardPassword),t=e.strength;("medium"===t||"strong"===t)&&(w.step=E.PASSWORD_STEP_SAVE,w.isPasswordProtected&&(w.step=E.PASSWORD_STEP_UPDATE_PASSWORD))}function o(){var e=b(w.boardPassword),t=e.strength;return w.step===E.PASSWORD_STEP_SAVING||w.step===E.PASSWORD_STEP_UPDATING?!1:void(("medium"===t||"strong"===t)&&(w.step=E.PASSWORD_STEP_SAVING,w.isPasswordProtected&&(w.step=E.PASSWORD_STEP_UPDATING)))}function r(){w.isPasswordProtected=!0,w.step=E.PASSWORD_STEP_SAVE_SUCCESS}function a(){w.isPasswordProtected=!1,w.step=E.PASSWORD_STEP_SAVE_FAIL}function s(e){var t=e,n=t.disableFontDownloads,i=t.disableSourceDownloads,o=t.disableImageDownloads,r=t.isPasswordProtected,a=t.password;w=Object.assign({},S,{disableFontDownloads:n,disableSourceDownloads:i,disableImageDownloads:o,isPasswordProtected:r,boardPassword:a,isPasswordToggled:r,usingDefaults:!1})}function c(e){w.isPasswordToggled=e,e||(w.boardPassword=S.boardPassword,w.isPasswordProtected=S.isPasswordProtected);
}function l(e){w.boardPassword=e}function u(e){w.disableAllDownloads=e}function h(e){w.disableSourceDownloads=e}function d(e){w.disableFontDownloads=e}function p(e){w.disableImageDownloads=e}function m(){var e=w,t=e.disableFontDownloads,n=e.disableImageDownloads,i=e.disableSourceDownloads;w.disableAllDownloads=t||n||i}function f(){var e=w,t=e.disableAllDownloads;t?(w.disableSourceDownloads=!0,w.disableFontDownloads=!0,w.disableImageDownloads=!0):(w.disableSourceDownloads=!1,w.disableFontDownloads=!1,w.disableImageDownloads=!1)}var g=e("events"),v=g.EventEmitter,y=e("../dispatcher/BoardsDispatcher"),_=e("../constants/BoardsConstants"),E=e("../constants/BoardSettingsConstants"),b=e("password-strength"),T="change",S={disableAllDownloads:!1,disableFontDownloads:!1,disableImageDownloads:!1,disableSourceDownloads:!1,isPasswordToggled:!1,isPasswordProtected:!1,boardPassword:"",step:E.PASSWORD_STEP_NONE,usingDefaults:!0},w=Object.assign({},S),C=Object.assign({},v.prototype,{getSettings:function(){return w},emitChange:function(){this.emit(T)},listen:function(e){this.on(T,e)},unlisten:function(e){this.removeListener(T,e)}});C.dispatchToken=y.register(function(e){var t=!0,n=e,g=n.action;switch(g.actionType){case _.ActionTypes.SET_BOARD:s(g.data),m();break;case E.UPDATE_BOARD_COLLABORATORS_TOGGLE:u(g.value),f();break;case E.UPDATE_BOARD_PASSWORD_TOGGLE:c(g.value);break;case E.UPDATE_BOARD_PASSWORD:l(g.value),i();break;case E.UPDATE_FONT_FILES_DOWNLOAD_TOGGLE:d(g.value),m();break;case E.UPDATE_IMAGE_DOWNLOAD_TOGGLE:p(g.value),m();break;case E.UPDATE_SOURCE_FILES_DOWNLOAD_TOGGLE:h(g.value),m();break;case E.PASSWORD_STEP_SAVE_SUCCESS:r();break;case E.PASSWORD_STEP_SAVE_FAIL:a();break;case E.INIT_SAVE:o();break;default:t=!1}return t&&C.emitChange(),!0}),t.exports=C},{"../constants/BoardSettingsConstants":89,"../constants/BoardsConstants":90,"../dispatcher/BoardsDispatcher":92,events:9,"password-strength":21}],99:[function(e,t,n){function i(e){var t=e.type.toLowerCase();return-1===t.indexOf("image/")?!1:t.indexOf("svg")>=0?!1:g.getFileItemType(e.name)===l.ITEM_TYPES.SOURCE?!1:!0}function o(e,t,n){var i=new Image;i.onload=function(){this.width&&this.height?(t.metaData.width=this.width,t.metaData.height=this.height,t.metaData.imagecolors=f.extractColorsFromImage(i,8)):(t.metaData.width=270,t.metaData.height=217),ht(),xt.emitChange()},i.onerror=function(){t.metaData.width=270,t.metaData.height=217,e.items.push(t),ht(),xt.emitChange()},i.crossOrigin="Anonymous",i.src=n}var r,a,s=e("../../common/stores/LocalStorageCache"),c=e("../dispatcher/BoardsDispatcher"),l=e("../constants/BoardsConstants"),u=e("../../common/constants/UploaderConstants"),h=e("events").EventEmitter,d=e("../actions/ImageCacheActionCreators"),p=e("../stores/ImageCacheStore"),m=e("../utils/packer"),f=e("../utils/color-extraction-service"),g=e("../utils/file-extension-service"),v="change",y={},E={},b={},T={loaded:!1},S=[],w=null,C=null,R=1,A={},D=!1,I=!1,M=!0,x=!1,O=!0,k=!0,N=[],L=!1,P=null,U=null,j=[],B=!1,H="",z=null,F={item:null,initialGroupID:0,newGroupID:0,initialMouseX:0,initialMouseY:0,x:0,y:0,started:!1},V=!1,W=!1,G={visible:!1,type:null},q=!1,Y="",K=function(e){y=e},X=function(e){E=e},Z=function(e){r=e},J=function(e){var t=ie(e);if(b.id&&t.id!==b.id?(R=1,k=!0,N=N||[]):b.id||(R=1),b=t,a=b.id,D=!0,w){var n=[];e.groups.forEach(function(e){n=n.concat(e.items)});var i=!!_.find(n,function(e){return e.id===w.id});i||(w=null)}w&&b.groups.forEach(function(e){e.items&&e.items.length>0&&e.items.forEach(function(e){e.id===w.id&&(w=_.assign(w,e))})}),ht()},Q=function(e){T=e},ee=function(e){w=e.boardItem},te=function(e){x=e},ne=function(e){Y=e},ie=function(e){return e.groups&&e.groups.forEach(function(t,n){t.items&&t.items.length>0&&(e.groups[n].items=_.filter(t.items,function(e){return e.itemTypeID===l.ITEM_TYPES.IMAGE&&e.boardItemUploadState!==u.uploadStates.PERM.id&&"blob"!==e.metaData.imageUrl.substring(0,4)?!1:e.itemTypeID>3&&e.boardItemUploadState!==u.uploadStates.PERM.id?!1:!0}))}),e},oe=function(e,t){var n=e.split("/").reverse(),i=t?"#":"boards";if(n[1].indexOf(i)>=0&&w)I=!0,Ve();else if(n[2].indexOf(i)>=0||n[3].indexOf(i)>=0){var o=n[2].indexOf(i)>=0?0:1;w||setTimeout(function(){var e=parseInt(n[o],10);e&&(le(e,!1),xt.emitChange(),1===o&&(U=parseInt(n[0],10)))})}},re=function(){var e=[270,563,856,1149];b.groups&&b.groups.forEach(function(t){t.items&&t.items.length>0&&t.items.forEach(function(t){var n=parseInt(t.columns,10);if(t.itemTypeID===l.ITEM_TYPES.IMAGE){var i=se(t);t.height=i.height?i.height:217,t.width=i.width}else if(t.width=e[n-1],t.itemTypeID===l.ITEM_TYPES.NOTE&&4===n)t.height=ae(t);else{var o=[217,457,457,457];t.height=o[n-1]}})})},ae=function(e){var t,n=$('<div id="temp-note-item-'+e.id+'" class="board-item full-note" data-columns="4" style="position: relative; height: auto;">\n			<div class="item-content item-note">\n				<div class="note-content" style="position: relative;">\n					<h4>'+e.title+"</h4>\n					<span>"+e.metaData.note+"</span>\n				</div>\n			</div>\n		</div>"),i=$(".board-items:first");if(i.length)i.append(n),t=n.height(),n.remove();else{var o=$('<div class="board-details">\n				<div class="inner">\n					<div class="board-items-section">\n						<div class="board-items" />\n					</div>\n				</div>\n			</div>');o.find(".board-items").append(n),$(".board-header").after(o),t=o.find("#temp-note-item-"+e.id).height(),o.remove()}return t},se=function(e){var t=e.metaData.width,n=e.metaData.height,i=b.layoutTypeID,o=parseInt(e.columns,10),r=270*o+23*(o-1);if(i===l.LAYOUT_TYPES.MASONRY){var a=[270,563,856,1149],s=a[o-1],c=n*s/t;return{width:r,height:Math.ceil(c)}}var u=n*r/t,h=Math.max(1,Math.floor(u/240)),d=n/t;i===l.LAYOUT_TYPES.GRID&&(h=Math.min(o,h),1===o&&(h=1)),(2===o||3===o)&&o>h&&d>=.65&&(h=o);var p;return p=4===o&&(i!==l.LAYOUT_TYPES.GRID||4>h)?r*n/t:217*h+23*(h-1),{width:r,height:Math.ceil(p)}},ce=function(e,t){w=null,J(e),le(t,!0)},le=function(e,t,n){if(I=!1,t=!!t,Ee(""),n&&(U=n),e&&e>0&&b&&b.groups&&b.groups.length>0)for(var i=0;i<b.groups.length;i++){var o=b.groups[i];if(o.items&&o.items.length>0)for(var r=0;r<o.items.length;r++){var a=o.items[r];if(a.id===e)return w=a,void(w.isNew=t?!0:!1)}}w=null},ue=function(){S=[];for(var e=0;e<b.groups.length;e++)for(var t=b.groups[e],n=0;n<t.items.length;n++)S.push(t.items[n])},he=function(){var e=[],t=0;if(b.groups)for(var n=0;n<b.groups.length;n++){var i=b.groups[n];if(n>0){var o=_.pluck(b.groups[n-1].items,"y"),r=_.pluck(b.groups[n-1].items,"height");if(o.length>0){var a=_.max(o);if(a&&a>0&&(t+=a),r.length>0){var s=_.max(r);t+=s}}}t+=10;for(var c=_.sortBy(i.items,"sort"),l=0;l<c.length;l++){var u=_.clone(c[l],!0);u.y+=t,e.push(u)}}return e},de=function(e){j=[],L=!1,Ee(""),ue();var t=_.indexOf(S,w);w="previous"===e?0===t?S[S.length-1]:S[t-1]:t>=S.length-1?S[0]:S[t+1]},pe=function(){de("previous")},me=function(){de("next")},fe=function(){I=!1,w=null,j=[]},ge=function(){O=!0,j=[]},ve=function(e){if(w){if(w=e,O=!1,U){var t=_.find(e.boardItemComments,function(e){return e.id===U});t&&setTimeout(function(){Ye(null,t.id),xt.emitChange()})}ye()}},ye=function(){j=[];for(var e=0;e<w.boardItemComments.length;e++){var t=w.boardItemComments[e];t.hasAnnotation&&j.push({canEdit:!1,x:t.x,y:t.y,label:t.annotationLabel})}},_e=function(){B=!B},Ee=function(e){H=z=e},be=function(e){if(N=e,N.length){var t=0;N.forEach(function(e){e.unread&&t++}),b.unreadCommentCount=t}k=!1},Te=function(e,t){var n=_.sortBy(b.groups,"sort"),i=n.indexOf(_.find(n,{id:e.id})),o="up"===t?i-1:i+1;n.splice(o,0,n.splice(i,1)[0]);for(var r=0;r<n.length;r++)n[r].sort=r+1,_.find(b.groups,{id:n[r].id}).sort=n[r].sort},Se=function(e){b.title=e},we=function(e){b.description=e},Ce=function(e){b.layoutTypeID=e,ht()},Re=function(e,t){var n=_.find(b.groups,{id:e.id});n.title=t},Ae=function(e,t){var n=_.find(b.groups,{id:e.id});n.description=t},De=function(e){ue();for(var t=_.find(b.groups,{id:e.groupID}),n=_.uniq(e.items),i=[],o=0;o<n.length;o++){var r=_.find(S,{id:e.items[o]});r&&i.push(r)}t.items=i},Ie=function(e,t){b.groups&&_.each(b.groups,function(n){n.items&&_.each(n.items,function(n){n.id===e.id&&(n.title=t)})})},Me=function(e,t){b.groups&&_.each(b.groups,function(n){n.items&&_.each(n.items,function(n){n.id===e.id&&(n.description=t)})})},xe=function(e,t){var n="";/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)&&(n=t,b.groups&&_.each(b.groups,function(t){t.items&&_.each(t.items,function(t){t.id===e.id&&(t.metaData.color.replace("#","")===t.title.replace("#","")&&(t.title=n,w.title=n),t.metaData.color=n,w.metaData.color=n)})}))},Oe=function(e,t){b.groups&&_.each(b.groups,function(n){n.items&&_.each(n.items,function(n){n.id===e.id&&(n.metaData.note=t)})})},ke=function(e,t){b.groups&&b.groups.forEach(function(n){n.items&&n.items.forEach(function(n){n.id===e.id&&(n.columns=t)})}),ht()},Ne=function(e,t,n,i,o,a,s){var c={userID:r.id,name:r.name,avatarID:r.avatarID,initials:r.intials,hasSystemAvatar:r.hasSystemAvatar,boardItemID:w.id,comment:e,hasAnnotation:n,x:i,y:o,annotationLabel:a,svg:s,updatedAt:Date.now(),isNew:!0};if(w.boardItemComments.push(c),L=!1,Ee(""),n){var l=_.find(j,function(e){return e.label===a});l&&(l.active=!1,l.canEdit=!1)}Ve()},Le=function(e,t,n,i,o,a,s,c,l){if(e&&t){var u={userID:r.id,name:e,avatarID:r.avatarID,initials:r.intials,hasSystemAvatar:r.hasSystemAvatar,boardItemID:w.id,comment:n,hasAnnotation:o,x:a,y:s,annotationLabel:c,svg:l,updatedAt:Date.now(),isNew:!0};if(w.boardItemComments.push(u),L=!1,Ee(""),o){var h=_.find(j,function(e){return e.label===c});h&&(h.active=!1,h.canEdit=!1)}Ve()}},Pe=function(e,t,n){var i;b.groups?_.each(b.groups,function(t){t.items&&_.each(t.items,function(t){t.id===e.id&&(i=_.find(e.boardItemComments,{isNew:!0}))})}):w&&(i=_.find(w.boardItemComments,{isNew:!0})),i&&(i.id=t,i.sketchID=n,delete i.isNew)},Ue=function(e,t,n,i,o,r,a,s,c){var l=_.find(w.boardItemComments,function(t){return t.id===e}),u=!!l.hasAnnotation;l&&(l.comment=t,l.hasAnnotation=!!n,l.x=i||0,l.y=o||0,l.annotationLabel=r||0,l.sketchID=s&&a?a:null,l.svg=s,l.mentions=c);var h;!n&&u&&(h=_.find(j,function(e){return e.label===r}),h&&j.splice(j.indexOf(h),1)),n&&(h=_.find(j,function(e){return e.label===r}),h?(h.x=i,h.y=o):j.push({visible:!0,canEdit:!1,x:i,y:o,label:r})),L=!1,Ee("")},je=function(e){w.boardItemComments=_.without(w.boardItemComments,e),e.hasAnnotation&&Ve(e.annotationLabel),L=!1,Ee("")},Be=function(){L=!L},He=function(){var e=_.find(j,function(e){return!!e.active});return e},ze=function(e,t){j.push({canEdit:!0,visible:!0,label:We(),x:e,y:t,active:!0}),L=!1},Fe=function(e,t){var n=_.find(j,function(e){return!!e.active});n&&(n.x=e,n.y=t)},Ve=function(e){if(e){var t=_.find(j,function(t){return t.label===e});t&&j.splice(_.indexOf(j,t),1)}else{var n=_.find(j,function(e){return!!e.active});n&&(n.active=!1,n.canEdit=!1)}},We=function(){var e=parseInt(_.max(_.pluck(w.boardItemComments,"annotationLabel")),10)+1;return isNaN(e)&&(e=1),e},Ge=function(e,t){var n=_.find(w.boardItemComments,function(t){return t.id===e}),i=_.find(j,function(e){return e.label===n.annotationLabel});i&&j.forEach(function(e){e.label===n.annotationLabel?(e.active=!0,e.canEdit=!!t):(e.active=!1,e.canEdit=!1)})},qe=function(e){var t=_.find(w.boardItemComments,function(t){return t.id===e});H||(z=t&&t.svg?t.svg:null)},Ye=function(e,t){if(!e&&!t)return P=null,Ve(),void(H||Ee(""));var n=_.find(w.boardItemComments,function(n){return e?e===n.annotationLabel:t?t===n.id:void 0});if(n){P=n;var i=_.find(j,function(t){return t.label===e});i&&(Ve(),i.active=!0),n.svg&&!H&&(z=n.svg)}},Ke=function(e){var t=_.find(b.groups,function(t){return t.id===e.groupID});t.items.push(e),ht()},$e=function(e){return e.metaData.thumbnailFullUrl&&"sketch"!==g.getFileType(e.clientFilename)?g.getFileItemType(e.clientFilename)===l.ITEM_TYPES.SOURCE:!1},Xe=function(e){if(e.boardID===b.id)if(i(e.file)){d.setFromFile({key:e.file.id,file:e.file});var t=p.getImageCache(e.file.id);Je(t,e.user,e.boardID,e.boardGroupID,e.file,e.title,e.sort,!1,e.index)}else Ze(e.user,e.boardID,e.boardGroupID,e.file,e.title,e.sort,!1,e.index)},Ze=function(e,t,n,i,o,r,a,s){if(a=!!a,t===b.id){for(var c,l=0,u=b.groups.length;u>l;l++)for(var h=0,d=b.groups[l].items.length;d>h;h++)if(b.groups[l].items[h].clientFilename.toLowerCase()===i.name.toLowerCase()){c=b.groups[l].items[h];break}if(c)c.metaData.downloadUrl=null,c.isProcessed=!1,c.updatedAt=(new Date).getTime();else{var p=_.find(b.groups,function(e){return e.id===n}),m=1;p.items.forEach(function(e){e.sort>=m&&(m=e.sort+1)});var f={boardID:t,clientFilename:i.name,columns:"1",commentCount:0,createdAt:(new Date).getTime(),createdBy:e,description:"",fileversion:"0",groupID:n,id:i.id,itemTypeID:g.getFileItemType(i.name),metaData:{tags:[],clientFilename:i.name,downloadUrl:null},serverFileName:i.name,sort:-1===r?m:r,title:o,isProcessed:!1,updatedAt:(new Date).getTime(),x:0,y:0};p.items.push(f),ht()}}},Je=function(e,t,n,i,r,a,s,c,u){if(c=c||!1,n===b.id){var h=_.find(b.groups,function(e){return e.id===i}),d=1;h.items.forEach(function(e){e.sort>=d&&(d=e.sort+1)});var p={boardID:n,clientFilename:r.name,columns:"1",commentCount:0,createdAt:(new Date).getTime(),createdBy:t,description:"",fileversion:"0",groupID:i,height:0,id:r.id,isProcessed:c,itemTypeID:l.ITEM_TYPES.IMAGE,metaData:{imagecolors:[],tags:[],imageUrl:e,thumbnailFullUrl:e,width:270,height:217},serverFileName:r.name,sort:-1===s?d:s,title:a,updatedAt:(new Date).getTime(),width:0,x:0,y:0};h.items.push(p),o(h,p,e)}},Qe=function(e){var t=et(e.id);t&&(t.metaData.imagecolors=e.metaData.imagecolors),w&&w.id===e.id&&(w.metaData.imagecolors=e.metaData.imagecolors)},et=function(e){var t;return b.groups&&b.groups.forEach(function(n){n.items&&n.items.forEach(function(n){n.id===e&&(t=n)})}),t},tt=function(e,t,n){var i=et(e.id);i&&(i.id=n,i.itemTypeID===l.ITEM_TYPES.IMAGE&&d.updateImageCacheKey({oldKey:e.id,newKey:n}))},nt=function(e){var t=et(e.id);if(t)e.itemTypeID===l.ITEM_TYPES.IMAGE&&d.replaceWithRemote({key:e.id,newURL:e.metaData.thumbnailFullUrl}),_.merge(t,e),e.metaData.thumbnailFullUrl&&!t.metaData.thumbnailFullUrl&&(t.metaData.thumbnailFullUrl=e.metaData.thumbnailFullUrl);else{var n=_.find(b.groups,function(t){return t.id===e.boardGroupID});n&&n.items.push(e)}ht()},it=function(e){var t=et(e.id);t&&(t.metaData.thumbnailFullUrl=e.metaData.thumbnailFullUrl)},ot=function(e){b.photoHeaderSize=e},rt=function(e){b.photoHeaderOffset=e},at=function(e){b.photoHeaderTint=e},st=function(e){b.photoHeaderBlur=e},ct=function(){b.photoHeaderBlur=0,b.photoHeaderTint=65,b.photoHeaderImageUrl=null},lt=function(e){if(e.boardID===b.id){d.setFromFile({key:e.file.id,file:e.file});var t=p.getImageCache(e.file.id);b.photoHeaderImageUrl=t}},ut=function(e){d.replaceWithRemote({key:e.id,newURL:e.photoHeaderImageUrl})},ht=function(){re(),yt(null,!1,!0)},dt=function(e){F=_.assign(F,e)},pt=function(e){for(var t=0;t<e.length;t++)e[t].sort=t+1},mt=function(e,t,n){var i=et(e.id),o=_.find(b.groups,function(e){return e.id===t}),r=_.find(o.packer.tempItems,function(e){return!!e.isPlaceholder});if(!r)return void setTimeout(function(){ht(),xt.emitChange()});var a=[],s=_.find(b.groups,function(e){return e.id===i.groupID}),c=_.findIndex(s.items,function(e){return e.id===i.id});if(s.items.splice(c,1),i.groupID=t,n&&n.length>0)for(var l=0;l<n.length;l++){var u=n[l];if(u!==i.id){var h=et(u);a.push(h);var d=_.find(b.groups,function(e){return e.id===h.groupID}),p=_.indexOf(d.items,h);d.items.splice(p,1),h.groupID=t}}if(o.items.push(i),i.isMovingToGroup=!0,o.packer.addMovedItem(),i.x=r.x,i.y=r.y,o.placeholderActive=!1,o.placeholder=null,o.packer.dropItem(),o.items.sort(function(e,t){return e.y-t.y||e.x-t.x}),pt(o.items),a.length>0){o.items.forEach(function(e){e.sort>i.sort&&(e.sort+=a.length)});for(var m=0;m<a.length;m++)a[m].sort=i.sort+(m+1),a[m].x=i.x+(m+1),a[m].y=i.y,o.items.push(a[m]);o.items.sort(function(e,t){return e.y-t.y||e.x-t.x}),pt(o.items)}yt(null,!1,!0),setTimeout(function(){i.isMovingToGroup=!1,xt.emitChange()},30)},ft=function(e,t){for(var n=[],i=0;i<e.length;i++){var o=et(e[i]),r=_.find(b.groups,function(e){return e.id===o.groupID}),a=_.indexOf(r.items,o);o.groupID=t,r.items.splice(a,1),n.push(o)}var s=_.find(b.groups,function(e){return e.id===t});n.forEach(function(e){s.items.push(e)}),ht()},gt=function(e,t){for(var n=0;n<e.length;n++){var i=et(e[n]);i.columns=t}ht()},vt=function(e){e.height=0===e.packer.height&&e.items.length>0?e.height:e.packer.height},yt=function(e,t,n){var i,o=[];e?(i=[],i.push(_.find(b.groups,function(t){return t.id===e}))):i=b.groups;var r=function(e,t,n){if(!(o.indexOf(e.initial.id)>=0)){o.push(e.initial.id);var i=_.find(n.items,function(t){return t.id===e.initial.id});i&&(i.x=e.x,i.y=e.y,i.number=t)}},a=function(e,t){var n=i[e],o=function(){var e=t?n.packer.tempItems:n.packer.items;vt(n),e.forEach(function(e,t){r(e,t,n)})};o()};if(i)for(var s=0;s<i.length;s++){var c=i[s];(!c.packer||n)&&(c.packer=new m({items:_.sortBy(c.items,"sort"),width:1192,rowWidth:270,spacing:23})),t?(c.packer.dropItem(),a(s,!0)):(c.packer.pack(),a(s,!1))}},_t=function(){if(F.item){if(Math.abs(F.x)>0||Math.abs(F.y)>0){var e=_.find(b.groups,function(e){return e.id===(F.newGroupID?F.newGroupID:F.initialGroupID)});if(!e.packer||!e.packer.dragItem)return;_.each(b.groups,function(t){t.placeholderActive=!1,t.placeholder=null,t!==e&&(t.packer.pack(),_.each(t.packer.items,function(e){var n=_.find(t.items,function(t){return t.id===e.initial.id});n&&(n.x=e.x,n.y=e.y)}))}),e.id!==F.initialGroupID&&(e.placeholderActive=!0,e.placeholder={width:F.item.width,height:F.item.height,x:F.x,y:F.y}),e.packer.dragItem(F.item,F.x,F.y,e.id!==F.initialGroupID),_.each(e.packer.tempItems,function(t){if(t.initial.id===F.item.id&&e.placeholderActive)e.placeholder.x=t.x,e.placeholder.y=t.y;else{var n=_.find(e.items,function(e){return e.id===t.initial.id});if(!n)return;if(n===F.item)return n.dragX=t.x,void(n.dragY=t.y);n.x=t.x,n.y=t.y}}),setTimeout(function(){vt(e),xt.emitChange()},15)}}else _.each(b.groups,function(e){e.placeholderActive=!1,e.placeholder=null}),yt()},Et=function(e){if(F.item){F.item.x=F.item.dragX,F.item.y=F.item.dragY,delete F.item.dragX,delete F.item.dragY;var t=_.find(b.groups,function(e){return e.id===F.item.groupID});if(e&&e.length>0){for(var n=[],i=0;i<e.length;i++){var o=e[i];if(o!==F.item.id){var r=et(o),a=_.find(b.groups,function(e){return e.id===r.groupID}),s=_.indexOf(a.items,r);a.items.splice(s,1),r.groupID=F.item.groupID,n.push(r)}}if(n){for(t.items.forEach(function(e){e.sort>F.item.sort&&(e.sort+=n.length)}),i=0;i<n.length;i++)n[i].sort=F.item.sort+(i+1),n[i].x=F.item.x+(i+1),n[i].y=F.item.y,t.items.push(n[i]);return t.packer.dropItem(),t.items.sort(function(e,t){return e.y-t.y||e.x-t.x}),pt(t.items),void yt(null,!1,!0)}}b.groups.forEach(function(e){e.packer.resortItems(),e.placeholderActive&&(e.placeholderActive=!1,e.placeholder=null,e.items.forEach(function(t){var n=_.find(e.packer.tempItems,function(e){return e.initial.id===t.id});n&&(t.x=n.x,t.y=n.y)})),vt(e),setTimeout(function(){yt(e.id,t.id===e.id,t.id!==e.id),e.items.sort(function(e,t){return e.y-t.y||e.x-t.x}),pt(e.items),xt.emitChange()},10)})}},bt=function(e){var t=et(e);b.groups.forEach(function(e){if(e.items){var n=_.indexOf(e.items,t);if(n>=0)return e.items.splice(n,1),void ht()}},this)},Tt=function(e){for(var t=0;t<e.length;t++)bt(e[t])},St=function(e){C=e?{shareUrl:window.location.protocol+"//"+window.location.hostname+"/boards/"+e.key+"/",userID:e.userID,boardID:e.boardID,boardItemID:e.boardItemID}:null},wt=function(e){R=e},Ct=function(e){A={shareUrl:window.location.protocol+"//"+window.location.hostname+"/boards/"+e.key+"/",userID:e.userID,boardID:e.boardID,boardItemID:e.boardItemID}},Rt=function(e){G={visible:!0,type:e}},At=function(){G={visible:!1,type:null}},Dt=function(e){W=e},It=function(e){V=e},Mt=function(){q=!1},xt=_.assign({},h.prototype,{getIsLoading:function(){return M},getInitialServerLoad:function(){return D},getFeatureFlags:function(){return y},getSingleTenantConfig:function(){return E},getBaseBoardsRoute:function(){return Y},getBoardSpace:function(){return T},getCommentsLoading:function(){return O},getCommentsRoundupLoading:function(){return k},getUser:function(){return r},getBoardID:function(){return a},getBoard:function(){return b},getCommentsRoundup:function(){return N},getBoardItems:function(){return ue(),S},getBoardItemsSorted:function(){var e=he();return e},getItemByID:function(e){return et(e)},getSelectedItem:function(){return w},getClearSelectedItem:function(){return I},getShareData:function(){return C},getZoom:function(){return R},getSettings:function(){return A},getDragState:function(){return F},getIsValidSourceFile:function(e){return $e(e)},getDragState:function(){return F},clearBoard:function(){b={},R=1,F={item:null,initialGroupID:0,newGroupID:0,initialMouseX:0,initialMouseY:0,x:0,y:0,started:!1}},loadFromBoardsCache:function(e,t){r=e,a=t;var n=s.get("board-"+a);n&&!x&&(b=n.board,M=!1)},getEditingCommentAnnotation:function(){return L},getAnnotations:function(){return j},getActiveAnnotation:function(){return He()},getMaxAnnotationLabel:function(){return We()},getSketchMode:function(){return B},getActiveSketch:function(){return H},getVisibleSketch:function(){return z},getHighlightedComment:function(){return P},getItemViewVisibility:function(){return G},getEditorState:function(){return W},getItemViewEditingState:function(){return V},emitChange:function(){a&&(s.set("board-"+a,{board:b}),M=!1),this.emit(v)},addChangeListener:function(e){this.on(v,e)},removeChangeListener:function(e){this.removeListener(v,e)},getAddViewOpenState:function(){return q}});c.register(function(e){var t=e.action,n=!0;switch(t.actionType){case l.ActionTypes.SET_FEATURE_FLAGS:K(t.data);break;case l.ActionTypes.SET_SINGLE_TENANT_CONFIG:X(t.data);break;case l.ActionTypes.URL_UPDATED:oe(t.data.url,t.data.isShare);break;case l.ActionTypes.LOAD_NEW_ITEM:ce(t.data.board,t.data.itemID);break;case l.ActionTypes.GOTO_ITEM:le(t.data.id,!1,t.data.commentID);break;case l.ActionTypes.PREVIOUS_ITEM:pe();break;case l.ActionTypes.NEXT_ITEM:me();break;case l.ActionTypes.CLEAR_SELECTED_ITEM:fe();break;case l.ActionTypes.COMMENTS_LOADED:ve(t.data);break;case l.ActionTypes.SET_USER:Z(t.data);break;case l.ActionTypes.SET_BOARD:J(t.data);break;case l.ActionTypes.UPDATE_TITLE:Se(t.data);break;case l.ActionTypes.UPDATE_DESCRIPTION:we(t.data);break;case l.ActionTypes.SET_LAYOUT_TYPE:Ce(t.data);break;case l.ActionTypes.UPDATE_GROUP_TITLE:Re(t.data.group,t.data.title);break;case l.ActionTypes.UPDATE_GROUP_DESCRIPTION:Ae(t.data.group,t.data.description);break;case l.ActionTypes.SET_BOARD_SORT_ORDER:De(t.data);break;case l.ActionTypes.MOVE_GROUP:Te(t.data.group,t.data.direction);break;case l.ActionTypes.MOVE_ITEM:break;case l.ActionTypes.SET_ITEM_COLUMNS:ke(t.data.item,t.data.columns);break;case l.ActionTypes.UPDATE_ITEM_TITLE:Ie(t.data.item,t.data.title);break;case l.ActionTypes.UPDATE_ITEM_DESCRIPTION:Me(t.data.item,t.data.description);break;case l.ActionTypes.UPDATE_COLOR_VALUE:xe(t.data.item,t.data.color);break;case l.ActionTypes.UPDATE_NOTE_CONTENT:Oe(t.data.item,t.data.noteContent);break;case l.ActionTypes.DELETE_ITEM:bt(t.data);break;case l.ActionTypes.BULK_DELETE_ITEMS:Tt(t.data.ids);break;case l.ActionTypes.SET_SINGLE_ITEM_SHARE:ee(t.data);break;case l.ActionTypes.LOAD_ITEM_COMMENTS:ge();break;case l.ActionTypes.ADD_COMMENT:Ne(t.data.comment,t.data.notifyOthers,t.data.hasAnnotation,t.data.x,t.data.y,t.data.annotationLabel,t.data.sketchData);break;case l.ActionTypes.IDENTIFY_AND_ADD_COMMENT:Le(t.data.name,t.data.email,t.data.commentText,t.data.notifyUsers,t.data.hasAnnotation,t.data.x,t.data.y,t.data.annotationLabel,t.data.sketchData);break;case l.ActionTypes.UPDATE_COMMENT_ID:Pe(t.data.item,t.data.commentID,t.data.sketchID);break;case l.ActionTypes.DELETE_COMMENT:je(t.data);break;case l.ActionTypes.UPDATE_COMMENT:Ue(t.data.commentID,t.data.content,t.data.hasAnnotation,t.data.x,t.data.y,t.data.annotationLabel,t.data.sketchID,t.data.sketchData,t.data.mentions);break;case l.ActionTypes.EDIT_COMMENT_ANNOTATION:Be();break;case l.ActionTypes.ADD_ANNOTATION:ze(t.data.x,t.data.y);break;case l.ActionTypes.EDIT_ANNOTATION:Fe(t.data.x,t.data.y);break;case l.ActionTypes.REMOVE_ANNOTATION:Ve(t.data);break;case l.ActionTypes.VIEW_ANNOTATION:Ge(t.data.commentID,t.data.editing);break;case l.ActionTypes.SET_HIGHLIGHTED_COMMENT:Ye(t.data);break;case l.ActionTypes.LOAD_ANNOTATIONS:ye();break;case l.ActionTypes.TOGGLE_SKETCH_MODE:_e();break;case l.ActionTypes.SET_ACTIVE_SKETCH:Ee(t.data);break;case l.ActionTypes.VIEW_SKETCH:qe(t.data);break;case l.ActionTypes.ADD_NEW_COLOR_ITEM:Ke(t.data);break;case l.ActionTypes.IMAGE_COLORS_LOADED:Qe(t.data);break;case l.ActionTypes.ADD_TEMP_ITEM:Xe(t.data);break;case l.ActionTypes.ADD_BULK_TEMP_ITEMS:addBulkTempItems(t.data);break;case l.ActionTypes.UPDATE_TEMP_ITEM:tt(t.data.file,t.data.boardID,t.data.id);break;case l.ActionTypes.ITEM_UPLOADED:nt(t.data);break;case l.ActionTypes.SOURCE_FILE_PREVIEW_GENERATED:it(t.data);break;case l.ActionTypes.ADD_TEMP_HEADER:lt(t.data);break;case l.ActionTypes.BOARD_HEADER_UPLOADED:ut(t.data);break;case l.ActionTypes.SET_PHOTO_HEADER_SIZE:ot(t.data);break;case l.ActionTypes.SET_PHOTO_HEADER_OFFSET:rt(t.data);break;case l.ActionTypes.SET_PHOTO_HEADER_TINT:at(t.data);break;case l.ActionTypes.SET_PHOTO_HEADER_BLUR:st(t.data);break;case l.ActionTypes.DELETE_HEADER_IMAGE:ct();break;case l.ActionTypes.SET_DRAG_STATE:dt(t.data);break;case l.ActionTypes.MOVE_ITEM_TO_GROUP:mt(t.data.item,t.data.newGroupID,t.data.selected);break;case l.ActionTypes.BULK_MOVE_ITEMS:ft(t.data.ids,t.data.groupID);break;case l.ActionTypes.BULK_SIZE_ITEMS:gt(t.data.ids,t.data.columns);break;case l.ActionTypes.DRAG_MOVE_ITEM:_t();break;case l.ActionTypes.DROP_ITEM:Et(t.data);break;case l.ActionTypes.SET_ZOOM:wt(t.data);break;case l.ActionTypes.LOAD_COMMENTS_ROUNDUP:k=!0;break;case l.ActionTypes.COMMENTS_ROUNDUP_LOADED:be(t.data.comments);break;case l.ActionTypes.BOARD_SHARE_LOADED:St(t.data);break;case l.ActionTypes.BOARD_SETTINGS_LOADED:Ct(t.data);break;case l.ActionTypes.ITEM_VIEW_OPEN:Rt(t.data);break;case l.ActionTypes.HIDE_ADD_VIEW:Mt();break;case l.ActionTypes.ITEM_VIEW_CLOSE:At();break;case l.ActionTypes.SET_HEADER_STATE:Dt(t.data);break;case l.ActionTypes.ITEM_VIEW_EDITING_STATE:It(t.data);break;case l.ActionTypes.SET_IS_REDIRECTING:te(t.data);break;case l.ActionTypes.SET_BASE_BOARDS_ROUTE:ne(t.data);break;case l.ActionTypes.SET_BOARD_SPACE:Q(t.data);break;default:n=!1}return n&&xt.emitChange(),!0}),t.exports=xt},{"../../common/constants/UploaderConstants":123,"../../common/stores/LocalStorageCache":149,"../actions/ImageCacheActionCreators":30,"../constants/BoardsConstants":90,"../dispatcher/BoardsDispatcher":92,"../stores/ImageCacheStore":100,"../utils/color-extraction-service":108,"../utils/file-extension-service":109,"../utils/packer":112,events:9}],100:[function(e,t,n){var i=e("../dispatcher/ImageCacheDispatcher"),o=e("../constants/ImageCacheConstants"),r=e("events").EventEmitter,a="imageCacheChange",s={},c=window.URL||window.webkitURL||!1,l=function(e,t){s[e]=t},u=function(e){var t=e.key,n=e.file;if(c){var i=c.createObjectURL(n.getNative());l(t,i)}else{var o=new FileReader;o.onloadend=function(){l(t,o.result)},o.readAsDataURL(n.getNative())}},h=function(e){var t=e.oldKey,n=e.newKey;s[t]&&(s[n]=s[t],delete s[t])},d=function(e){var t=e.key,n=e.newURL;if(!s[t])return void(s[t]=n);var i=new Image;i.onload=function(){var e=s[t];s[t]=n,p.emitChange(),"blob"===e.substr(0,4)&&c.revokeObjectURL(e)},i.src=n},p=_.assign({},r.prototype,{getImageCache:function(e){return s[e]},emitChange:function(){this.emit(a)},addChangeListener:function(e){this.on(a,e)},removeChangeListener:function(e){this.removeListener(a,e)}});p.setMaxListeners(0),p.dispatchToken=i.register(function(e){var t=e.action,n=!0;switch(t.actionType){case o.ActionTypes.SET_IMAGE_CACHE:l(t.data);break;case o.ActionTypes.SET_FROM_FILE:u(t.data);break;case o.ActionTypes.UPDATE_IMAGE_CACHE_KEY:h(t.data);break;case o.ActionTypes.REPLACE_WITH_REMOTE:d(t.data),n=!1;break;default:n=!1}return n&&p.emitChange(),!0}),t.exports=p},{"../constants/ImageCacheConstants":91,"../dispatcher/ImageCacheDispatcher":93,events:9}],101:[function(e,t,n){var i=e("../constants/BoardsConstants"),o=e("../dispatcher/BoardsDispatcher"),r=e("./BoardStore"),a=e("events").EventEmitter,s="change",c={selected:[],cmdIsPressed:!1,shiftIsPressed:!1},l=function(e,t,n,i){if(n)c.selected.indexOf(e)>=0&&!t?c.selected.splice(c.selected.indexOf(e),1):-1===c.selected.indexOf(e)&&c.selected.push(e);else if(i){if(c.selected.indexOf(e)>=0&&!t)c.selected.splice(c.selected.indexOf(e),1);else if(-1===c.selected.indexOf(e)){for(var o=r.getBoardItemsSorted(),a=_.pluck(o,"id"),s=a.indexOf(e),l=s-1;l>=0&&!(c.selected.indexOf(a[l])>=0);l--)c.selected.push(a[l]);c.selected.push(e)}}else c.selected.indexOf(e)>=0&&!t?c.selected=[]:-1===c.selected.indexOf(e)&&(c.selected=[e])},u=function(){c={selected:[],cmdIsPressed:!1,shiftIsPressed:!1}},h=function(e,t){t||u();for(var n=0;n<e.length;n++)-1===c.selected.indexOf(e[n])&&c.selected.push(e[n])},d=function(e){var t=r.getBoardItemsSorted(),n=m.getSelectedItems();if(!(n.length>1)){var i,o,a,s;if(n){var c=_.find(t,function(e){return e.id===n[0]}),u=_.indexOf(t,c);if(u>=0){if("left"===e)if(0===u)i=t[t.length-1];else if(0===c.x)i=t[u-1];else{for(s=null,o=0;o<t.length;o++)t[o].id!==c.id&&(a=t[o],(a.y===c.y||a.y<c.y&&a.y+a.height>c.y)&&a.x<c.x&&(!s||a.x>s.x)&&(s=a));i=s?s:t[u-1]}else if("right"===e)if(u>=t.length-1)i=t[0];else{for(s=null,o=0;o<t.length;o++)t[o].id!==c.id&&(a=t[o],(a.y===c.y||a.y<c.y&&a.y+a.height>c.y)&&a.x>c.x&&(!s||a.x<s.x)&&(s=a));i=s?s:t[u+1]}else if("up"===e){if(0===u)return;if(0===c.y)i=t[0];else for(o=u-1;o>=0;o--)t[o].y<c.y&&!i&&(t[o].x===c.x||t[o].x<c.x&&t[o].x+t[o].width>c.x)&&(i=t[o])}else if("down"===e){if(u===t.length-1)return;for(o=u+1;o<t.length;o++)t[o].y>c.y&&!i&&(t[o].x===c.x||t[o].x<c.x&&t[o].x+t[o].width>c.x)&&(i=t[o]);i||(i=t[t.length-1])}}else i=t[0]}else i=t[0];l(i.id)}},p=function(){var e=r.getBoardItemsSorted();c.selected=[],e.length&&l(e[0].id)},m=_.assign({},a.prototype,{getStore:function(){return c},getSelectedItems:function(){return c.selected},emitChange:function(){this.emit(s)},addChangeListener:function(e){this.on(s,e)},removeChangeListener:function(e){this.removeListener(s,e)}});m.dispatchToken=o.register(function(e){var t=e.action,n=!0;switch(t.actionType){case i.ActionTypes.DELETE_ITEM:case i.ActionTypes.BULK_DELETE_ITEMS:case i.ActionTypes.BULK_MOVE_ITEMS:case i.ActionTypes.SET_BOARD_SORT_ORDER:case i.ActionTypes.CLEAR_SELECTION_STORE:u();break;case i.ActionTypes.TOGGLE_ITEM_SELECTION:l(t.data.id,t.data.onlyAdd,t.data.cmdKeyPressed,t.data.shiftKeyPressed);break;case i.ActionTypes.TOGGLE_DRAGGER_ITEMS:h(t.data.ids,t.data.cmdKeyPressed);break;case i.ActionTypes.SELECT_BOARD_ITEM:d(t.data);break;case i.ActionTypes.SELECT_FIRST_ITEM:p();break;default:n=!1}return n&&m.emitChange(),!0}),t.exports=m},{"../constants/BoardsConstants":90,"../dispatcher/BoardsDispatcher":92,"./BoardStore":99,events:9}],102:[function(e,t,n){t.exports=function(e,t){function n(t){var n=t[2],a=t[3],s=n/a,c=[];return r>s?(c[2]=o*s|0,c[3]=o,c[0]=i-c[2]>>1,c[1]=0):(c[2]=i,c[3]=i/s|0,c[0]=0,c[1]=o-c[3]>>1),c[0]+=e[0],c[1]+=e[1],c}var i=e[2],o=e[3],r=i/o;return t?n(t):n}},{}],103:[function(e,t,n){var i=function(){"use strict";var e,t=function(){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("id","IntercomUtils"),e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}();return i=function(n){return e?e:(e=this,e.hidden=!1,i.prototype.showIntercom=function(){return e.hidden?(e.hidden=!1,t.deleteRule(0)):void 0},void(i.prototype.hideIntercom=function(){return e.hidden?void 0:(e.hidden=!0,t.insertRule("#intercom-container { display: none !important }",0))}))}}();t.exports=new i},{}],104:[function(e,t,n){var i=!1;t.exports=function(){i||(i=!0,
("undefined"==typeof config||config.allowExternalScripts!==!1)&&!function(e){var t=e.createElement("script"),n=e.getElementsByTagName("script")[0];t.src="//use.typekit.net/rcd5mwi.js",t.async=!0,t.onload=function(){try{Typekit.load()}catch(e){}},n.parentNode.insertBefore(t,n)}(document))}},{}],105:[function(e,t,n){function i(e,t){var t=t||{};try{r().logEvent(e,t)}catch(n){a(n)}}function o(e,t){var n={"Page Name":e||"","Category Name":t||"",Title:document.title,URL:document.URL,Path:window.location.pathname,Referrer:document.referrer},o="App - Browsing - Visit Page";i(o,n)}function r(){var e;try{e=window.amplitude&&window.amplitude.getInstance("standalone")}catch(t){a(t)}var n=window.featureFlags&&window.featureFlags["aqua-amplitude-growth-analytics"],i=function(){n&&a("Tried to use amplitude but standalone instance did not exist")};return n&&e?e:{init:i,logEvent:i,logRevenue:i,setUserId:i,setUserProperties:i,setOptOut:i,setVersionName:i,setDomain:i,setDeviceId:i,setGlobalUserProperties:i,identify:i,clearUserProperties:i,setGroup:i,logRevenueV2:i,regenerateDeviceId:i,logEventWithTimestamp:i,logEventWithGroups:i,setSessionId:i}}function a(e){if(window.NREUM&&window.NREUM.noticeError)try{window.NREUM.noticeError(e)}catch(t){console.error("Error Calling NR noticeError"),console.error(e)}else console.error(e)}var s=e("lodash"),c=function(){return window.analytics&&window.analytics.track||s.noop};t.exports={track:c(),trackGrowth:i,trackGrowthPage:o}},{lodash:19}],106:[function(e,t,n){function i(e,t,n){function i(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function r(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}var a=r(),s=e-a,c=0,l=20;n="undefined"==typeof n?500:n;var u=function(){c+=l;var e=Math.easeInOutQuad(c,a,s,n);i(e),n>c?o(u):t&&"function"==typeof t&&t()};u()}Math.easeInOutQuad=function(e,t,n,i){return e/=i/2,1>e?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)},Math.easeInCubic=function(e,t,n,i){var o=(e/=i)*e*e;return t+n*o},Math.inOutQuintic=function(e,t,n,i){var o=(e/=i)*e,r=o*e;return t+n*(6*r*o+-15*o*o+10*r)};var o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();t.exports=i},{}],107:[function(e,t,n){var i=e("./stack-blur"),o=function(e,t){var n=e.id;i.stackBlurCanvasRGB(n,0,0,e.width,e.height,t)},r=function(e,t){for(var n=[21,25,27],i=e.getContext("2d"),o=i.getImageData(0,0,e.width,e.height),r=o.data,a=r.length,s=0;a>s;)r[s]=r[s++]*(1-t)+n[0]*t,r[s]=r[s++]*(1-t)+n[1]*t,r[s]=r[s++]*(1-t)+n[2]*t,s++;i.clearRect(0,0,e.width,e.height),i.putImageData(o,0,0)},a=function(e,t){var n=parseInt(e,16),i=Math.round(2.55*t),o=(n>>16)+i,r=(n>>8&255)+i,a=(255&n)+i;return"#"+(16777216+65536*(255>o?1>o?0:o:255)+256*(255>r?1>r?0:r:255)+(255>a?1>a?0:a:255)).toString(16).slice(1)},s={Blur:o,Tint:r,Shade:a};t.exports=s},{"./stack-blur":113}],108:[function(e,t,n){var i=function(e,t){var n=new ColorThief,i=n.getPalette(e,t+2);return i&&i.length>0?o(i,t):[]},o=function(e,t){for(var n=[],i="",o=0;t>o;o++)if(e&&e[o]){i="#";for(var r=0;3>r;r++){var a=e[o][r].toString(16);a=1===a.length?"0"+a:a,i+=a}n.push(i)}return n};t.exports={extractColorsFromImage:i}},{}],109:[function(e,t,n){var i=e("..//constants/BoardsConstants"),o={getFileType:function(e){var t=e.split(".").pop().toLowerCase();switch(t){case"ai":return"illustrator";case"psd":return"photoshop";case"sketch":return"sketch";case"svg":case"eps":return"vector";case"zip":case"tar":case"gz":return"zip";case"mov":case"mp4":return"video";case"mp3":case"wav":case"aif":return"audio";case"ttf":case"otf":case"eot":case"woff":return"font";case"pdf":return"pdf";case"doc":case"docx":case"pages":case"txt":case"rtf":case"odf":return"document";case"xls":case"xlsx":case"numbers":case"csv":return"spreadsheet";case"ppt":case"pptx":case"key":return"presentation";case"html":case"htm":case"js":case"css":case"sass":case"scss":case"less":case"styl":case"coffee":case"jade":case"haml":case"py":case"php":case"rb":case"cfc":case"cfm":case"h":case"m":case"go":return"code";default:return"generic"}},getSourceFileType:function(e){return e.split(".").pop().toLowerCase()},getFileItemType:function(e){var t=e.split(".").pop().toLowerCase();return["psd","ai","sketch","pdf"].indexOf(t)>=0?i.ITEM_TYPES.SOURCE:["ttf","otf","woff","eot"].indexOf(t)>=0?i.ITEM_TYPES.FONT:["doc","docx","xls","xlsx","ppt","pptx","pages","txt","rtf","odf"].indexOf(t)>=0?i.ITEM_TYPES.DOCUMENT:["mp3","wav","mov","mp4"].indexOf(t)>=0?i.ITEM_TYPES.MEDIA:i.ITEM_TYPES.GENERIC},getExtensionWithDot:function(e){var t=e.split(".");return 1===t.length||""===t[0]&&2===t.length?"":"."+t.pop().toLowerCase()},getPossibleFilenameMatches:function(e){var t=this.getExtensionWithDot(e),n=e.toLowerCase().substr(0,e.lastIndexOf(".")).replace("@2x","").replace("@3x","").replace("@print",""),i={nonRetina:n+t,twoX:n+"@2x"+t,threeX:n+"@3x"+t,print:n+"@print"+t};return i}};t.exports=o},{"..//constants/BoardsConstants":90}],110:[function(e,t,n){t.exports=function(e){var t=0;do isNaN(e.offsetTop)||(t+=e.offsetTop);while(e=e.offsetParent);return t}},{}],111:[function(e,t,n){var i=function(e,t){var n=document.querySelectorAll(t);if(n&&n.length>0){if(_.indexOf(n,e)>=0)return!0;for(;e.parentNode;)if(e=e.parentNode,_.indexOf(n,e)>=0)return!0}return!1};t.exports=i},{}],112:[function(e,t,n){var i=function(e){this.opts=e,this.items=[],this.tempItems=[],this.spaces=[],this._init()};i.prototype={_init:function(){for(var e=this.opts.items,t=0;t<e.length;t++)this.items.push({initial:e[t],x:0,y:0,width:e[t].width+this.opts.spacing,height:e[t].height+this.opts.spacing,isIgnored:!1});this.spaces.push({x:0,y:0,width:this.opts.width,height:Number.POSITIVE_INFINITY})},sort:function(e,t){return e.y-t.y||e.x-t.x},overlaps:function(e,t){var n=e.x+e.width,i=e.y+e.height,o=t.x+t.width,r=t.y+t.height;return e.x<o&&n>t.x&&e.y<r&&i>t.y},generateSpaces:function(e,t){if(!this.overlaps(e,t))return!1;var n=[],i=e.x+e.width,o=e.y+e.height,r=t.x+t.width,a=t.y+t.height;return e.y<t.y&&n.push({x:e.x,y:e.y,width:e.width,height:t.y-e.y}),i>r&&n.push({x:r,y:e.y,width:i-r,height:e.height}),o>a&&n.push({x:e.x,y:a,width:e.width,height:o-a}),e.x<t.x&&n.push({x:e.x,y:e.y,width:t.x-e.x,height:e.height}),n},contains:function(e,t){var n=t.width||0,i=t.height||0;return e.x<=t.x&&e.y<=t.y&&e.x+e.width>=t.x+n&&e.y+e.height>=t.y+i},mergeSpaces:function(){for(var e=0;e<this.spaces.length;e++){var t=this.spaces[e];if(t){var n=this.spaces.slice(0);n.splice(e,1),n.concat(this.items.slice(0));for(var i=0,o=0;o<n.length;o++){var r=n[o],a=e>o?0:1;this.contains(t,r)&&(this.spaces.splice(o+a-i,1),i++)}}}},reSortSpaces:function(){this.mergeSpaces(),this.spaces.sort(this.sort)},itemPlaced:function(e){for(var t=[],n=0;n<this.spaces.length;n++){var i=this.spaces[n],o=this.generateSpaces(i,e);o?t.push.apply(t,o):t.push(i)}this.spaces=t,this.reSortSpaces()},packItem:function(e){if(e.stamped)return void this.itemPlaced(e);for(var t=0;t<this.spaces.length;t++){var n=this.spaces[t];if(n.width>=e.width&&n.height>=e.height)return e.x=n.x,e.y=n.y,void this.itemPlaced(e)}},setPackerHeight:function(e){for(var t=0,n=0;n<e.length;n++){var i=e[n],o=i.height+i.y;o>t&&(t=o)}this.height=t},alignItemRow:function(e,t){var n=Math.max(0,Math.min(4,Math.floor(e.x/this.opts.rowWidth))*(this.opts.rowWidth+this.opts.spacing));if(e.x=n,e.y<0)e.y=0;else{var i=0;_.each(t,function(t){t.initial.id!==e.initial.id&&i<t.y+t.height&&(i=t.y+t.height)}),e.y>i&&(e.y=i)}},makeGapless:function(e){var t=0,n=0;if(t=Math.max(0,Math.min(4,Math.floor(e.x/this.opts.rowWidth))*(this.opts.rowWidth+this.opts.spacing)),e.y>0)for(var i=0;i<this.tempItems.length;i++){var o=this.tempItems[i];if(!(_.isEqual(o,e)||o.y>e.y)&&(o.x===t||o.x<t&&o.x+o.width>t)){var r=o.y+o.height;r>n&&(n=r)}}else e.y<0&&(n=0);e.x=t,e.y=n},dragTimeout:null,addMovedItem:function(){var e=_.filter(this.tempItems,function(e){return e.isPlaceholder});e&&e.forEach(function(e){delete e.isPlaceholder,this.items.push(e)},this),this.dropItem()},dropItem:function(e){this.dragTimeout&&(clearTimeout(this.dragTimeout),this.dragTimeout=null),e=e||this.tempItems;var t=[];e.forEach(function(e){t.indexOf(e.initial.id)<0&&(t.push(e.initial.id),e=this.makeGapless(e))},this),e.sort(this.sort),this.pack(e,!0)},dragItem:function(e,t,n,i){this.dragTimeout&&(clearTimeout(this.dragTimeout),this.dragTimeout=null),this.spaces=[{x:0,y:0,width:this.opts.width,height:Number.POSITIVE_INFINITY}],this.tempItems=_.clone(this.items,!0),i&&this.tempItems.push({isPlaceholder:!0,x:t,y:n,width:e.width+this.opts.spacing,height:e.height+this.opts.spacing,initial:e});var o=_.find(this.tempItems,function(t){return t.initial.id===e.id});o.x=t,o.y=n,this.alignItemRow(o,this.tempItems),o.stamped=!0,this.tempItems.sort(this.sort);for(var r,a=0;a<this.tempItems.length;a++)if(this.tempItems[a].initial.id===o.initial.id){r=a;break}this.tempItems.splice(r,1),this.tempItems.unshift(o),this.pack(this.tempItems)},resortItems:function(){this.items.sort(this.sort),this.tempItems&&this.tempItems.sort(this.sort)},pack:function(e,t){var n,i=[];for(e=e||this.items,this.spaces=[{x:0,y:0,width:this.opts.width,height:Number.POSITIVE_INFINITY}],n=0;n<e.length;n++)e[n].isIgnored||i.indexOf(e[n].initial.id)<0&&(i.push(e[n].initial.id),this.packItem(e[n]));for(n=0;n<e.length;n++)e[n].stamped=!1;if(this.setPackerHeight(e),t){var o=[];this.tempItems.forEach(function(e){if(!(o.indexOf(e.initial.id)>=0)){o.push(e.initial.id);var t=_.find(this.items,function(t){return t.initial.id===e.initial.id});t?(t.x=e.x,t.y=e.y):this.items.push(e)}},this),this.items.sort(this.sort)}}},t.exports=i},{}],113:[function(e,t,n){function i(e,t,n,i){var a=document.getElementById(e),s=a.naturalWidth,c=a.naturalHeight,l=document.getElementById(t);l.style.width=s+"px",l.style.height=c+"px",l.width=s,l.height=c;var u=l.getContext("2d");u.clearRect(0,0,s,c),u.drawImage(a,0,0),isNaN(n)||1>n||(i?o(t,0,0,s,c,n):r(t,0,0,s,c,n))}function o(e,t,n,i,o,r){if(!(isNaN(r)||1>r)){r|=0;var l,u=document.getElementById(e),h=u.getContext("2d");try{try{l=h.getImageData(t,n,i,o)}catch(d){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),l=h.getImageData(t,n,i,o)}catch(d){throw alert("Cannot access local image"),new Error("unable to access local image data: "+d)}}}catch(d){throw alert("Cannot access image"),new Error("unable to access image data: "+d)}var p,m,f,g,v,y,_,E,b,T,S,w,C,R,A,D,I,M,x,O,k,N,L,P,U=l.data,j=r+r+1,B=i-1,H=o-1,z=r+1,F=z*(z+1)/2,V=new a,W=V;for(f=1;j>f;f++)if(W=W.next=new a,f==z)var G=W;W.next=V;var q=null,Y=null;_=y=0;var K=s[r],$=c[r];for(m=0;o>m;m++){for(D=I=M=x=E=b=T=S=0,w=z*(O=U[y]),C=z*(k=U[y+1]),R=z*(N=U[y+2]),A=z*(L=U[y+3]),E+=F*O,b+=F*k,T+=F*N,S+=F*L,W=V,f=0;z>f;f++)W.r=O,W.g=k,W.b=N,W.a=L,W=W.next;for(f=1;z>f;f++)g=y+((f>B?B:f)<<2),E+=(W.r=O=U[g])*(P=z-f),b+=(W.g=k=U[g+1])*P,T+=(W.b=N=U[g+2])*P,S+=(W.a=L=U[g+3])*P,D+=O,I+=k,M+=N,x+=L,W=W.next;for(q=V,Y=G,p=0;i>p;p++)U[y+3]=L=S*K>>$,0!=L?(L=255/L,U[y]=(E*K>>$)*L,U[y+1]=(b*K>>$)*L,U[y+2]=(T*K>>$)*L):U[y]=U[y+1]=U[y+2]=0,E-=w,b-=C,T-=R,S-=A,w-=q.r,C-=q.g,R-=q.b,A-=q.a,g=_+((g=p+r+1)<B?g:B)<<2,D+=q.r=U[g],I+=q.g=U[g+1],M+=q.b=U[g+2],x+=q.a=U[g+3],E+=D,b+=I,T+=M,S+=x,q=q.next,w+=O=Y.r,C+=k=Y.g,R+=N=Y.b,A+=L=Y.a,D-=O,I-=k,M-=N,x-=L,Y=Y.next,y+=4;_+=i}for(p=0;i>p;p++){for(I=M=x=D=b=T=S=E=0,y=p<<2,w=z*(O=U[y]),C=z*(k=U[y+1]),R=z*(N=U[y+2]),A=z*(L=U[y+3]),E+=F*O,b+=F*k,T+=F*N,S+=F*L,W=V,f=0;z>f;f++)W.r=O,W.g=k,W.b=N,W.a=L,W=W.next;for(v=i,f=1;r>=f;f++)y=v+p<<2,E+=(W.r=O=U[y])*(P=z-f),b+=(W.g=k=U[y+1])*P,T+=(W.b=N=U[y+2])*P,S+=(W.a=L=U[y+3])*P,D+=O,I+=k,M+=N,x+=L,W=W.next,H>f&&(v+=i);for(y=p,q=V,Y=G,m=0;o>m;m++)g=y<<2,U[g+3]=L=S*K>>$,L>0?(L=255/L,U[g]=(E*K>>$)*L,U[g+1]=(b*K>>$)*L,U[g+2]=(T*K>>$)*L):U[g]=U[g+1]=U[g+2]=0,E-=w,b-=C,T-=R,S-=A,w-=q.r,C-=q.g,R-=q.b,A-=q.a,g=p+((g=m+z)<H?g:H)*i<<2,E+=D+=q.r=U[g],b+=I+=q.g=U[g+1],T+=M+=q.b=U[g+2],S+=x+=q.a=U[g+3],q=q.next,w+=O=Y.r,C+=k=Y.g,R+=N=Y.b,A+=L=Y.a,D-=O,I-=k,M-=N,x-=L,Y=Y.next,y+=i}h.putImageData(l,t,n)}}function r(e,t,n,i,o,r){if(!(isNaN(r)||1>r)){r|=0;var l,u=document.getElementById(e),h=u.getContext("2d");try{try{l=h.getImageData(t,n,i,o)}catch(d){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),l=h.getImageData(t,n,i,o)}catch(d){throw alert("Cannot access local image"),new Error("unable to access local image data: "+d)}}}catch(d){throw alert("Cannot access image"),new Error("unable to access image data: "+d)}var p,m,f,g,v,y,_,E,b,T,S,w,C,R,A,D,I,M,x,O,k=l.data,N=r+r+1,L=i-1,P=o-1,U=r+1,j=U*(U+1)/2,B=new a,H=B;for(f=1;N>f;f++)if(H=H.next=new a,f==U)var z=H;H.next=B;var F=null,V=null;_=y=0;var W=s[r],G=c[r];for(m=0;o>m;m++){for(R=A=D=E=b=T=0,S=U*(I=k[y]),w=U*(M=k[y+1]),C=U*(x=k[y+2]),E+=j*I,b+=j*M,T+=j*x,H=B,f=0;U>f;f++)H.r=I,H.g=M,H.b=x,H=H.next;for(f=1;U>f;f++)g=y+((f>L?L:f)<<2),E+=(H.r=I=k[g])*(O=U-f),b+=(H.g=M=k[g+1])*O,T+=(H.b=x=k[g+2])*O,R+=I,A+=M,D+=x,H=H.next;for(F=B,V=z,p=0;i>p;p++)k[y]=E*W>>G,k[y+1]=b*W>>G,k[y+2]=T*W>>G,E-=S,b-=w,T-=C,S-=F.r,w-=F.g,C-=F.b,g=_+((g=p+r+1)<L?g:L)<<2,R+=F.r=k[g],A+=F.g=k[g+1],D+=F.b=k[g+2],E+=R,b+=A,T+=D,F=F.next,S+=I=V.r,w+=M=V.g,C+=x=V.b,R-=I,A-=M,D-=x,V=V.next,y+=4;_+=i}for(p=0;i>p;p++){for(A=D=R=b=T=E=0,y=p<<2,S=U*(I=k[y]),w=U*(M=k[y+1]),C=U*(x=k[y+2]),E+=j*I,b+=j*M,T+=j*x,H=B,f=0;U>f;f++)H.r=I,H.g=M,H.b=x,H=H.next;for(v=i,f=1;r>=f;f++)y=v+p<<2,E+=(H.r=I=k[y])*(O=U-f),b+=(H.g=M=k[y+1])*O,T+=(H.b=x=k[y+2])*O,R+=I,A+=M,D+=x,H=H.next,P>f&&(v+=i);for(y=p,F=B,V=z,m=0;o>m;m++)g=y<<2,k[g]=E*W>>G,k[g+1]=b*W>>G,k[g+2]=T*W>>G,E-=S,b-=w,T-=C,S-=F.r,w-=F.g,C-=F.b,g=p+((g=m+U)<P?g:P)*i<<2,E+=R+=F.r=k[g],b+=A+=F.g=k[g+1],T+=D+=F.b=k[g+2],F=F.next,S+=I=V.r,w+=M=V.g,C+=x=V.b,R-=I,A-=M,D-=x,V=V.next,y+=i}h.putImageData(l,t,n)}}function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var s=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];t.exports={stackBlurImage:i,stackBlurCanvasRGBA:o,stackBlurCanvasRGB:r}},{}],114:[function(e,t,n){(function(n){e("es6-object-assign").polyfill(),window.Typekit&&window.Typekit.load(),n.gTooltip=new Tooltip("",{baseClass:"tooltip-v2"}),n.gTooltipOwner=null;var i={boardComponent:e("../boards/components/Board.jsx"),boardItemComponent:e("../boards/components/BoardItem.jsx"),boardStore:e("../boards/stores/BoardStore"),actions:e("../boards/actions/BoardsActionCreators"),constants:e("../boards/constants/BoardsConstants"),dispatcher:e("../boards/dispatcher/BoardsDispatcher")};n.InvBoards=t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../boards/actions/BoardsActionCreators":29,"../boards/components/Board.jsx":32,"../boards/components/BoardItem.jsx":33,"../boards/constants/BoardsConstants":90,"../boards/dispatcher/BoardsDispatcher":92,"../boards/stores/BoardStore":99,"es6-object-assign":8}],115:[function(e,t,n){function i(e){if(!e)return"";var t=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=t.length;return n>1?t[0].slice(0,1)+t[n-1].slice(0,1):t[0].slice(0,1)}function o(e){var t=e.user||{},n=t.avatarID,i=t.avatarUrl,o=void 0;return" "===n&&(n=null),e.customImage?o=e.customImage:i&&i.indexOf("00000000")<0?o=i:n&&n.indexOf("00000000")<0&&(o="/avatars/"+t.avatarID),o}var r=e("classnames"),a=React.createClass({displayName:"Avatar",propTypes:{user:React.PropTypes.object,customImage:React.PropTypes.string,size:React.PropTypes.number},getDefaultProps:function(){return{size:35}},getInitialState:function(){return{imageError:!1}},componentWillReceiveProps:function(e){var t=!_.isEqual(this.props.user,e.user),n=!_.isEqual(this.props.customImage,e.customImage);(t||n)&&this.setState({imageError:!1})},render:function(){var e=this.props,t=e.user,n=e.size;if(!t)return null;var i={width:n,height:n},o=r({"m-avatar":!0,"system-avatar":t.hasSystemAvatar,"has-image":!!this.state.imageError}),a=this.renderInitials(),s=this.renderImage();return React.createElement("span",{className:o,style:i},a,s)},renderImage:function(){if(this.state.imageError)return null;var e=this.props,t=e.user,n=e.size,i=o(this.props);if(!i)return null;var r={src:i,alt:t.name||"",style:{display:"block",width:n,height:n},onError:this.handleImageError};return React.createElement("img",React.__spread({},r))},renderInitials:function(){var e=this.props,t=e.user,n=e.size,o=t.initials,r={className:"initials",style:{display:"block",lineHeight:n+"px",fontSize:Math.abs(n/3)}};return o=!o&&t.name?i(t.name):o,o?React.createElement("span",React.__spread({},r),o.toUpperCase()):null},handleImageError:function(){this.setState({imageError:!0})}});t.exports=a},{classnames:4}],116:[function(e,t,n){var i=React,o=i.PropTypes,r=i.createClass,a=ReactDOM,s=a.findDOMNode,c=e("./icons/Tick.jsx"),l=e("classnames"),u=r({propTypes:{labelText:o.string.isRequired,checked:o.bool.isRequired,disabled:o.bool,handleChange:o.func.isRequired,name:o.string.isRequired},getDefaultProps:function(){return{disabled:!1,labelText:"",checked:!1}},handleClick:function(){var e=this.props,t=e.disabled,n=e.name,i=e.handleChange,o=s(this.refs[n]);t||(o.checked=!o.checked,i(!o.checked))},render:function(){var e=this.props,t=e.disabled,n=e.labelText,i=e.name,o=e.checked,r=l({"react-checkbox-wrapper":!0,"is-disabled":t}),a=l({"react-checkbox":!0,"is-checked":!t&&o});return React.createElement("div",{className:r,onClick:this.handleClick},React.createElement("div",null,React.createElement("span",{className:a},React.createElement(c,{checked:!t&&o})),React.createElement("input",{checked:o,disabled:t,hidden:!0,id:i,name:i,ref:i,type:"checkbox",readOnly:!0})),React.createElement("label",{htmlFor:i},n))}});t.exports=u},{"./icons/Tick.jsx":122,classnames:4}],117:[function(e,t,n){var i=React.createClass({displayName:"Loading",propTypes:{text:React.PropTypes.string},getDefaultProps:function(){return{text:""}},render:function(){var e,t=this.props,n=t.text,i=window.navigator.userAgent,r=i.indexOf("MSIE ");return e=r>0||navigator.userAgent.match(/Trident.*rv\:11\./)?React.createElement("div",{className:"dots"},React.createElement("div",{className:"bounce1"}),React.createElement("div",{className:"bounce2"}),React.createElement("div",{className:"bounce3"})):React.createElement("div",{className:"loader"},React.createElement("svg",{className:"circular"},React.createElement("circle",{className:"path",cx:"32",cy:"32",r:"30",fill:"none",strokeWidth:"4"}))),React.createElement("div",{className:"loading-directive"},e,n?React.createElement("h2",{style:o.h2},n):null)}}),o={h2:{fontSize:"22px",fontWeight:"400",marginTop:32,textAlign:"center"}};t.exports=i},{}],118:[function(e,t,n){function i(e){delete e.ref}var o=React,r=o.PropTypes,a=o.createClass,s=React.createFactory(e("./ReactStaticContainer.jsx")),c=a({displayName:"ReactModal",propTypes:{children:r.any,isOpen:r.bool.isRequired,onRequestClose:r.func},getDefaultProps:function(){return{isOpen:!1}},componentDidMount:function(){this.node=document.createElement("div"),this.node.className="React-Modal",document.body.appendChild(this.node),this.mountModal(this.props),this.handleOverflow(this.props)},componentWillReceiveProps:function(e){this.handlePropsChange(e)},componentWillUnmount:function(){this.unmountModal(),document.body.classList.remove("has-modal"),document.body.removeChild(this.node)},handleOverflow:function(e){e.isOpen?document.body.classList.add("has-modal"):document.body.classList.remove("has-modal")},handlePropsChange:function(e){this.mountModal(e),this.handleOverflow(e)},unmountModal:function(){ReactDOM.unmountComponentAtNode(this.node)&&(this.modal=null)},mountModal:function(e){i(e),this.modal=ReactDOM.render(s(e),this.node)},render:function(){return React.DOM.noscript()}});t.exports=c},{"./ReactStaticContainer.jsx":119}],119:[function(e,t,n){var i=React,o=i.createClass,r=ReactDOM,a=r.findDOMNode,s=React.addons.CSSTransitionGroup,c=o({displayName:"ReactStaticContainer",componentDidMount:function(){},componentWillUnmount:function(){},handleOnKeyUp:function(e){var t=this.props,n=t.onRequestClose;e.preventDefault(),27===e.keyCode&&n()},handleOverlayClick:function(e){var t=this.props,n=t.onRequestClose;e.target.className===a(this.overlay).className&&n()},render:function(){var e=this.props,t=e.children,n=this.props.isOpen?React.createElement("div",{className:"React-Modal-Overlay",onClick:this.handleOverlayClick,ref:function(e){return this.overlay=e}.bind(this)},React.createElement("div",{className:"React-Modal-Container",ref:function(e){return this.container=e}.bind(this)},React.createElement("div",{style:l.container},t))):null;return React.createElement(s,{transitionEnterTimeout:200,transitionLeaveTimeout:300,transitionName:"modal-fade-in"},n)}});t.exports=c;var l={container:{padding:"30px 40px 0"}}},{}],120:[function(e,t,n){var i=React.createClass({displayName:"Spinner",propTypes:{styles:React.PropTypes.object,width:React.PropTypes.number,height:React.PropTypes.number},getDefaultProps:function(){return{width:32,height:32,styles:{width:"100%"}}},render:function(){return React.createElement("div",{style:this.props.styles},React.createElement("div",{className:"spinner"},React.createElement("div",{className:"spinner-indicator"},React.createElement("svg",{className:"spinner-element",width:this.props.width,height:this.props.height,viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},React.createElement("circle",{className:"path",fill:"none",strokeWidth:"1.5",strokeLinecap:"square",cx:"8",cy:"8",r:"6"})))))}});t.exports=i},{}],121:[function(e,t,n){var i=React,o=i.PropTypes,r=i.createClass,a=ReactDOM,s=a.findDOMNode,c=e("classnames"),l=r({propTypes:{checked:o.bool.isRequired,handleChange:o.func.isRequired,name:o.string.isRequired},handleClick:function(){var e=this.props,t=e.name,n=e.handleChange,i=s(this.refs[t]).checked;return n(!i)},render:function(){var e=this.props,t=e.name,n=e.checked,i=c({"react-switch":!0,"is-checked":n});return React.createElement("div",{className:"react-switch-wrapper",onClick:this.handleClick},React.createElement("span",{className:i},React.createElement("span",{className:"react-switch-circle"})),React.createElement("input",{checked:n,hidden:!0,id:t,name:t,readOnly:!0,ref:t,type:"checkbox"}))}});t.exports=l},{classnames:4}],122:[function(e,t,n){{var i=React,o=(i.PropTypes,i.createClass),r=ReactDOM;r.findDOMNode,e("classnames"),t.exports=o({displayName:"Tick",propTypes:{checked:React.PropTypes.bool},getDefaultProps:function(){return{checked:!1}},render:function(){var e=this.props,t=e.checked,n=t?"#62be76":"#d9dfe6";return React.createElement("svg",{width:"14",height:"14",viewBox:"0 0 14 14"},React.createElement("g",null,React.createElement("rect",{fill:n,width:"14",height:"14",rx:"2",ry:"2"}),React.createElement("path",{fill:"#fff",d:"M10.779,4.206 C11.078,4.505 11.078,4.990 10.779,5.289 L7.307,9.761 C7.008,10.060 6.523,10.060 6.224,9.761 C5.925,9.462 5.925,8.978 6.224,8.679 L9.696,4.206 C9.995,3.907 10.480,3.907 10.779,4.206 Z"}),React.createElement("path",{fill:"#fff",d:"M4.219,7.235 C4.537,6.917 5.052,6.917 5.370,7.235 L6.746,8.611 C7.064,8.929 7.064,9.444 6.746,9.762 C6.429,10.079 5.913,10.079 5.596,9.762 L4.219,8.385 C3.902,8.068 3.902,7.553 4.219,7.235 Z"})))}})}},{classnames:4}],123:[function(e,t,n){t.exports={uploadStates:{LEGACY:{name:"Legacy",id:0},PRE:{name:"Pre",id:1},TEMP:{name:"Temp",id:2},PERM:{name:"Perm",id:3},REVERTED:{name:"Reverted",id:4},REJECTED:{name:"Rejected",id:6}}}},{}],124:[function(e,t,n){var i={componentDidMount:function(){var e=ReactDOM.findDOMNode(this);e.addEventListener("mouseenter",this.mouseenter,!1),e.addEventListener("mouseleave",this.mouseleave,!1)},componentDidUpdate:function(){!gTooltip.hidden&&gTooltipOwner===this&&this.tooltipContent&&this.update(this.tooltipContent())},componentWillUnmount:function(){var e=ReactDOM.findDOMNode(this);gTooltip&&!gTooltip.hidden&&gTooltipOwner===this&&(gTooltip.detach().hide(),gTooltipOwner=null),e.removeEventListener("mouseenter",this.mouseenter),e.removeEventListener("mouseleave",this.mouseleave)},mouseenter:function(){gTooltipOwner=this,this.tooltipContent?this.update(this.tooltipContent()):console.warn("Component has TooltipMixin but does not provide tooltipContent()")},mouseleave:function(){gTooltipOwner===this&&(gTooltip.detach().hide(),gTooltipOwner=null)},update:function(e){var t=ReactDOM.findDOMNode(this);ReactDOM.render(e,gTooltip.element,function(){gTooltip.attach(t).show().updateSize().place("top").effect("fade")})}};t.exports=i},{}],125:[function(e,t,n){!function(n,i){"use strict";function o(e,t,n){function i(e){return(e||"").toString()}function o(t,n,i){var o=[];if(!n)return o;for(var r,a,s,c,l=n.length;l--;){var u=n[l].userID===i;r=n[l].text,c=n[l].startPos,s=u?"me-mentioned":"mention-blue",a='<span class="'+s+'">'+e.escape(r)+"</span>",t.substr(c,r.length)===r&&o.push({index:c,html:a,css:s,text:r})}return o.reverse(),o}function r(t,n){for(var i=[],o=e.first(n),r=0;r<t.length;r++)if(o&&o.index===r){r+=o.text.length-1,i.push(o.html);var a=e.indexOf(n,o);o=n[a+1]}else{var s=t[r];i.push(l[s]||s)}return i.join("")}function a(t,n){var i=[],o=e.partition(t,function(e){return"@project"===e.text||"@conversation"===e.text});if(o[0].length>0){var r=e.groupBy(o[0],"startPos");e.each(r,function(t){var o=e.find(t,function(e){return e.userID===n});i.push(o?o:t[0])})}return e.sortBy(o[1].concat(i),function(e){return e.startPos})}function s(t,s,c){t.mentions&&c&&c.hasOwnProperty("atConversationDisabled")&&c.atConversationDisabled&&e.remove(t.mentions,function(e){return"@conversation"===e.text}),e.isObject(s)&&(c=s,s=null);var l=a(t.mentions,s)||[];return t=i(t.comment),c=c||{},s=s||c.userID||c.currentUser||c.currentUserID,l=o(t,l,s),t=r(t,l),c.ignoreLineBreaks||(t=u(t)),c.ignoreLinks||(t=h(t)),c.ignoreEmojis||(t=n.parseEmoji(t)),t}function c(e,t){for(var n,i=[],o=!1,r=0,a=0;a<e.length;a++){var s=e[a],c="<"===s,l=">"===s,u=" "===n&&" "===s,h=c||l;n=s,o||u||r++,(t>=r||h||o)&&!u&&i.push(s),r===t&&a<e.length&&i.push("..."),c?o=!0:l&&(o=!1)}return i.join("")}function u(e){return i(e).replace(/(\r\n?|\n)/g,"<br />")}function h(e){var t=i(e),n=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,o=/(^|\s)(www\.[\S]+(\b|$))/gim,r=/([^@\\s]+@[^@\\s]+\\.\\w{2}[\\.\\w]*)/gim;return t.replace(n,'<a href="$&" target="_blank">$&</a>').replace(o,'<a href="http://$&" target="_blank">$&</a>').replace(r,function(e,t,n){return t?e:'<a href="mailto:'+n+'">'+n+"</a>"})}return{getComment:s,substrHtml:c,applyLineBreaks:u,applyHtmlLinks:h}}if("undefined"!=typeof t&&t.exports){var r=e("lodash"),a=e("../../../utilities/mention-utilities"),s=e("../../emoji/emoji-value"),c=e("../../emoji/emoji-service")(s);t.exports=o(r,a,c)}else i&&i.service("parseCommentService",o);var l={"<":"&lt;",">":"&gt;","&":"&amp;"}}(angular,InVision)},{"../../../utilities/mention-utilities":154,"../../emoji/emoji-service":126,"../../emoji/emoji-value":127,lodash:19}],126:[function(e,t,n){!function(e,n,i){"use strict";function o(e){function t(){return e.emojis}function n(){return Object.keys(t())}function o(){return b}function r(){return v}function a(){return y}function s(){return _}function c(){return E}function l(e){return v=e}function u(e){return y=e}function h(e){return _=e}function d(e){return E=e}function p(t){var n="";return"undefined"==typeof t||t.split(":").length<2?t:t.replace(T,function(t,i){return e.faceToEmojis[t]?n=e.faceToEmojis[t].emoji:b.indexOf(i)>=0&&(n=i),n?"<i class='emoji-icon-comment emojis-"+n+"' title=':"+n+":'></i>":t})}function m(e){for(var t=[],n=0,i=b.length;i>n;n++){var o=b[n];0===o.indexOf(e)&&t.push({label:o})}return t}function f(e,t,n){var i={showAll:!1};if("string"!=typeof e||e.indexOf(":")<0)return i;var o=":",r=" ",a=e.substring(0,t),s=e.substring(t),c=a.lastIndexOf(o),l=s.indexOf(r);return n&&c+o.length===t?i={emoji:"",showAll:!0}:(i={before:a.substring(0,c),emoji:"",after:s.substring(l+r.length),colon:o},i.emoji=e.substring(c+o.length,t),(i.emoji.indexOf(":")>=0||i.emoji.indexOf(" ")>=0)&&(i.emoji=""),i)}function g(e){for(var t={top:0,left:0},n=e,i=document.body;n;)t.left+=n.offsetLeft+n.clientLeft,t.top+=n.offsetTop+n.clientTop,n=n.offsetParent;for(n=e;n!==i;)n&&n.scrollTop&&n.scrollTop>0&&(t.top-=n.scrollTop),n&&n.scrollLeft&&n.scrollLeft>0&&(t.left-=n.scrollLeft),n=n.parentNode;return t}var v=!1,y=!1,_=!1,E=!1,b=i.flatten(i.map(e.emojis,i.values)),T=new RegExp(":(([a-z0-9_+-])+):|("+e.faces.join("|")+")","g");return{getEmojis:t,getAllEmojis:o,getCategories:n,parseEmoji:p,splitEmoji:f,findEmoji:m,isPopoverActive:r,isTypeaheadActive:a,isPopoverActiveOnModal:s,isTypeaheadActiveOnModal:c,setPopover:l,setTypeahead:u,setPopoverOnModal:h,setTypeaheadOnModal:d,getElementBoundingCoords:g}}"undefined"!=typeof t&&t.exports?t.exports=o:n&&n.service("emojiService",o)}(angular,InVision,_)},{}],127:[function(e,t,n){!function(e,n){"use strict";var i={emojis:{grinning:["grinning","grin","joy","smiley","smile","sweat_smile","satisfied","innocent","smiling_imp","wink","blush","yum","relieved","heart_eyes","sunglasses","smirk","neutral_face","expressionless","unamused","sweat","pensive","confused","confounded","kissing","kissing_heart","kissing_smiling_eyes","kissing_closed_eyes","stuck_out_tongue","stuck_out_tongue_winking_eye","stuck_out_tongue_closed_eyes","disappointed","worried","angry","rage","cry","persevere","triumph","disappointed_relieved","frowning","anguished","fearful","weary","sleepy","tired_face","grimacing","sob","open_mouth","hushed","cold_sweat","scream","astonished","flushed","sleeping","dizzy_face","no_mouth","relaxed","mask","smile_cat","joy_cat","smiley_cat","heart_eyes_cat","smirk_cat","kissing_cat","pouting_cat","crying_cat_face","scream_cat","no_good","ok_woman","bow","see_no_evil","hear_no_evil","speak_no_evil","raising_hand","person_frowning","person_with_pouting_face","bust_in_silhouette","busts_in_silhouette","boy","girl","man","woman","family","couple","two_men_holding_hands","two_women_holding_hands","cop","dancers","bride_with_veil","person_with_blond_hair","man_with_gua_pi_mao","man_with_turban","older_man","older_woman","baby","construction_worker","princess","japanese_ogre","japanese_goblin","ghost","angel","alien","space_invader","imp","skull","information_desk_person","guardsman"],ok:["eyes","ear","nose","lips","tongue","point_up","fist","raised_hands","raised_hand","v","point_up_2","point_down","point_left","point_right","punch","wave","ok_hand","thumbsup","thumbsdown","clap","open_hands","rat","mouse2","ox","water_buffalo","cow2","tiger2","leopard","rabbit2","cat2","dragon","crocodile","whale2","snail","snake","racehorse","ram","goat","sheep","monkey","rooster","chicken","dog2","pig2","boar","elephant","octopus","shell","bug","ant","honeybee","beetle","fish","tropical_fish","blowfish","turtle","hatching_chick","baby_chick","hatched_chick","bird","penguin","koala","poodle","dromedary_camel","camel","dolphin","mouse","cow","tiger","rabbit","cat","dragon_face","whale","horse","monkey_face","dog","pig","frog","hamster","wolf","bear","panda_face","pig_nose","paw_prints"],
hamburger:["hamburger","coffee","pizza","meat_on_bone","poultry_leg","rice_cracker","rice_ball","rice","curry","ramen","spaghetti","bread","fries","sweet_potato","dango","oden","sushi","fried_shrimp","fish_cake","icecream","shaved_ice","ice_cream","doughnut","cookie","chocolate_bar","candy","lollipop","custard","honey_pot","cake","bento","stew","egg","fork_and_knife","tea","sake","wine_glass","cocktail","tropical_drink","beer","beers","baby_bottle","mushroom","tomato","eggplant","grapes","melon","watermelon","tangerine","lemon","banana","pineapple","apple","green_apple","pear","peach","cherries","strawberry","chestnut","seedling","evergreen_tree","deciduous_tree","palm_tree","cactus","tulip","cherry_blossom","rose","hibiscus","sunflower","blossom","corn","ear_of_rice","herb","four_leaf_clover","maple_leaf","fallen_leaf","leaves"],star:["star","sunny","cloud","telephone","umbrella","spades","clubs","hearts","diamonds","recycle","wheelchair","warning","copyright","registered","tm","zap","soccer","baseball","snowman","partly_sunny","no_entry","golf","sailboat","fuelpump","scissors","ballot_box_with_check","white_check_mark","airplane","envelope","pencil2","black_nib","heavy_check_mark","heavy_multiplication_x","sparkles","snowflake","x","negative_squared_cross_mark","question","heavy_exclamation_mark","bangbang","interrobang","heart","heavy_plus_sign","heavy_minus_sign","heavy_division_sign","o","black_joker","cyclone","foggy","closed_umbrella","sunrise","ocean","earth_africa","earth_americas","earth_asia","globe_with_meridians","full_moon_with_face","sun_with_face","star2","ribbon","gift","birthday","jack_o_lantern","christmas_tree","santa","fireworks","sparkler","balloon","tada","confetti_ball","tanabata_tree","crossed_flags","bamboo","dolls","flags","wind_chime","rice_scene","school_satchel","mortar_board","microphone","movie_camera","cinema","headphones","art","tophat","circus_tent","ticket","clapper","performing_arts","video_game","dart","slot_machine","8ball","game_die","bowling","flower_playing_cards","musical_note","notes","saxophone","guitar","musical_keyboard","trumpet","violin","musical_score","tennis","ski","basketball","checkered_flag","snowboarder","running","surfer","trophy","horse_racing","football","rugby_football","swimmer","dancer","lipstick","nail_care","massage","haircut","barber","syringe","pill"],bulb:["bulb","kiss","love_letter","ring","gem","couplekiss","bouquet","couple_with_heart","wedding","heartbeat","broken_heart","two_hearts","sparkling_heart","heartpulse","cupid","blue_heart","green_heart","yellow_heart","purple_heart","gift_heart","revolving_hearts","heart_decoration","diamond_shape_with_a_dot_inside","anger","bomb","zzz","collision","sweat_drops","droplet","dash","shit","muscle","dizzy","speech_balloon","thought_balloon","heavy_dollar_sign","credit_card","yen","dollar","euro","pound","money_with_wings","seat","computer","briefcase","minidisc","floppy_disk","cd","dvd","file_folder","open_file_folder","page_with_curl","page_facing_up","date","card_index","chart_with_upwards_trend","chart_with_downwards_trend","bar_chart","pushpin","round_pushpin","paperclip","notebook","book","books","pencil","telephone_receiver","pager","fax","satellite","loudspeaker","mega","outbox_tray","inbox_tray","package","mailbox_closed","mailbox","mailbox_with_mail","mailbox_with_no_mail","postbox","postal_horn","newspaper","iphone","no_mobile_phones","camera","video_camera","tv","radio","vhs","low_brightness","high_brightness","mute","sound","speaker","battery","electric_plug","mag","mag_right","lock_with_ink_pen","closed_lock_with_key","key","lock","unlock","bell","no_bell","bookmark","link","radio_button","underage","fire","flashlight","wrench","hammer","nut_and_bolt","hocho","gun","microscope","telescope","crystal_ball","clock3","pray"],rocket:["rocket","helicopter","steam_locomotive","train","bullettrain_side","bullettrain_front","train2","light_rail","station","tram","bus","oncoming_bus","trolleybus","busstop","minibus","ambulance","fire_engine","police_car","oncoming_police_car","taxi","oncoming_taxi","red_car","oncoming_automobile","blue_car","truck","articulated_lorry","tractor","monorail","mountain_railway","suspension_railway","mountain_cableway","aerial_tramway","ship","rowboat","speedboat","traffic_light","vertical_traffic_light","construction","rotating_light","triangular_flag_on_post","door","house","house_with_garden","european_post_office","convenience_store","school","no_entry_sign","smoking","no_smoking","put_litter_in_its_place","bike","no_bicycles","bicyclist","mountain_bicyclist","walking","no_pedestrians","mens","womens","toilet","shower","bath","bathtub","cn","de","es","fr","uk","it","jp","kr","ru","us"]},faces:[":\\)",":\\|",":\\(",":D",":P","D:"],faceToEmojis:{":)":{emoji:"smile"},":|":{emoji:"neutral_face"},":(":{emoji:"disappointed"},":D":{emoji:"smiley"},":P":{emoji:"stuck_out_tongue"},"D:":{emoji:"anguished"}}};n&&n.value("emojiValue",i),"undefined"!=typeof t&&t.exports&&(t.exports=i)}(angular,InVision)},{}],128:[function(e,t,n){var i=e("../dispatcher/CommentDispatcher"),o=e("../constants/CommentConstants"),r={addMentionToComment:function(e,t,n){i.handleViewAction({actionType:o.ACTION_TYPES.ADD_MENTION_TO_COMMENT,data:{mentionText:e,cursorPosition:t,positionCursorAfterMention:n}})},clearAll:function(){i.handleViewAction({actionType:o.ACTION_TYPES.CLEAR_ALL})},clearMentionText:function(e,t){i.handleViewAction({actionType:o.ACTION_TYPES.CLEAR_MENTION_TEXT,data:{value:e,cursorPosition:t}})},setCurrentComment:function(e,t){i.handleViewAction({actionType:o.ACTION_TYPES.SET_CURRENT_COMMENT,data:{text:e,mentions:t}})},setCommentContent:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.SET_COMMENT_CONTENT,data:e})},setCommentLength:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.SET_COMMENT_LENGTH,data:e})},startNewMention:function(){i.handleViewAction({actionType:o.ACTION_TYPES.START_NEW_MENTION})}};t.exports=r},{"../constants/CommentConstants":141,"../dispatcher/CommentDispatcher":142}],129:[function(e,t,n){var i=e("../dispatcher/CommentDispatcher"),o=e("../constants/CommentConstants"),r={setCurrentTabIndex:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.SET_CURRENT_TAB_INDEX,data:e})}};t.exports=r},{"../constants/CommentConstants":141,"../dispatcher/CommentDispatcher":142}],130:[function(e,t,n){var i=e("../dispatcher/CommentDispatcher"),o=e("../constants/CommentConstants"),r={adjustStartPos:function(e,t){i.handleViewAction({actionType:o.ACTION_TYPES.ADJUST_START_POS,data:{cursorPos:e,lenDiff:t}})},clearAll:function(){i.handleViewAction({actionType:o.ACTION_TYPES.CLEAR_ALL})},clearMentions:function(){i.handleViewAction({actionType:o.ACTION_TYPES.CLEAR_MENTIONS})},clearMentionMenu:function(){i.handleViewAction({actionType:o.ACTION_TYPES.CLEAR_MENTION_MENU})},deleteMention:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.DELETE_MENTION,data:{startPos:e}})},loadCandidates:function(){i.handleViewAction({actionType:o.ACTION_TYPES.LOAD_CANDIDATES})},addMention:function(e,t,n,r){i.handleViewAction({actionType:o.ACTION_TYPES.ADD_MENTION,data:{text:e,startPos:n,userID:t,name:r}})},rebuildMentionsFromComment:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.REBUILD_MENTIONS,data:{comment:e}})},parseMentionString:function(e,t){i.handleViewAction({actionType:o.ACTION_TYPES.PARSE_MENTION_STRING,data:{value:e,cursorPosition:t}})},selectCandidate:function(e,t,n,r,a){i.handleViewAction({actionType:o.ACTION_TYPES.SELECT_CANDIDATE,data:{value:e,triggerChar:t,keyCode:n,cursorPosition:r,positionCursorAfterMention:a}})},selectNextCandidate:function(){i.handleViewAction({actionType:o.ACTION_TYPES.SELECT_NEXT_CANDIDATE})},selectPreviousCandidate:function(){i.handleViewAction({actionType:o.ACTION_TYPES.SELECT_PREVIOUS_CANDIDATE})},setActiveCandidateID:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.SET_ACTIVE_CANDIDATE_ID,data:e})},deleteRange:function(e,t){i.handleViewAction({actionType:o.ACTION_TYPES.DELETE_RANGE,data:{start:e,length:t}})},viewMentionMenu:function(e){i.handleViewAction({actionType:o.ACTION_TYPES.VIEW_MENTION_MENU,data:e})}};t.exports=r},{"../constants/CommentConstants":141,"../dispatcher/CommentDispatcher":142}],131:[function(e,t,n){var i=e("../actions/CommentActions"),o=e("../stores/CommentStore"),r=e("./Textarea.jsx"),a=e("./EmojiMenu.jsx"),s=e("./EmojiTypeahead.jsx"),c=(e("../utils/CommentUtilities.js"),e("immutable"),e("./LimitedTextarea.jsx")),l=e("../actions/MentionActions"),u=e("./Menu.jsx"),h=e("./NotificationCount.jsx"),d=e("../stores/MentionStore"),p=function(){return{activeCandidateID:d.getActiveCandidateID(),commentContent:o.getCommentContent(),cursorPosition:o.getCursorPosition(),mentionMenuVisible:d.getMentionMenuVisible(),mentions:d.getMentions(),searchResults:d.getSearchResults(),triggerChar:d.getMentionMenuTriggerChar()}},m=React.createClass({displayName:"CommentEditor",propTypes:{autoFocus:React.PropTypes.bool,defaultValue:React.PropTypes.string,atConversationDisabled:React.PropTypes.bool,disableEmojis:React.PropTypes.bool,disableMentions:React.PropTypes.bool,disableMentionShortcut:React.PropTypes.bool,hideAddButton:React.PropTypes.bool,itemID:React.PropTypes.number,onChange:React.PropTypes.func,onKeyDown:React.PropTypes.func,triggerChar:React.PropTypes.string},getDefaultProps:function(){return{autoFocus:!0,defaultValue:"",disableEmojis:!1,disableMentions:!1,disableMentionShortcut:!1,hideAddButton:!1,onChange:function(){},onKeyDown:function(){},triggerChar:""}},getInitialState:function(){return p()},componentWillMount:function(){i.setCommentContent(this.props.defaultValue||""),d.setDisableMentionShortcut(this.props.disableMentionShortcut),d.setDisableAtConversation(this.props.atConversationDisabled)},componentDidMount:function(){o.addChangeListener(this._onChange),d.addChangeListener(this._onChange),this.props.defaultValue&&this.state.commentContent!==this.props.defaultValue&&i.setCommentContent(this.props.defaultValue),this.props.disableMentions||l.loadCandidates()},componentWillUnmount:function(){o.removeChangeListener(this._onChange),d.removeChangeListener(this._onChange)},render:function(){var e=this.props.disableMentions?c:r,t=d.getCandidates();return React.createElement("div",null,React.createElement("div",{className:"comment-textarea-wrapper"},React.createElement(e,{ref:"textarea",autoFocus:this.props.autoFocus,commentContent:this.state.commentContent,cursorPosition:this.state.cursorPosition,mentionMenuVisible:this.state.mentionMenuVisible,onChange:this.props.onChange,onKeyDown:this.props.onKeyDown,triggerChar:this.state.triggerChar})),this.props.disableEmojis?null:React.createElement("div",null,React.createElement(a,{textareaRef:this.refs.textarea,onChange:this.props.onChange,mentionMenuVisible:this.state.mentionMenuVisible}),React.createElement(s,{textareaRef:this.refs.textarea,mentionMenuVisible:this.state.mentionMenuVisible})),this.state.mentionMenuVisible&&!this.props.disableMentions?React.createElement(u,{activeCandidateID:this.state.activeCandidateID,candidates:t,commentContent:this.state.commentContent,disableMentionShortcut:this.props.disableMentionShortcut,atConversationDisabled:this.props.atConversationDisabled,searchResults:this.state.searchResults,textareaRef:this.refs.textarea,triggerChar:this.state.triggerChar}):null,this.props.disableMentions?null:React.createElement(h,{hideAddButton:this.props.hideAddButton,mentions:this.state.mentions}))},_onChange:function(){return this.setState(p())}});t.exports=m},{"../actions/CommentActions":128,"../actions/MentionActions":130,"../stores/CommentStore":143,"../stores/MentionStore":145,"../utils/CommentUtilities.js":147,"./EmojiMenu.jsx":132,"./EmojiTypeahead.jsx":134,"./LimitedTextarea.jsx":136,"./Menu.jsx":137,"./NotificationCount.jsx":139,"./Textarea.jsx":140,immutable:17}],132:[function(e,t,n){var i=e("classnames"),o=e("classie"),r=e("../actions/CommentActions"),a=e("../constants/CommentConstants"),s=e("../stores/CommentStore"),c=e("./EmojiTabs.jsx"),l=React.createClass({displayName:"EmojiMenu",propTypes:{mentionMenuVisible:React.PropTypes.bool,onChange:React.PropTypes.func,textareaRef:React.PropTypes.object},getInitialState:function(){return{hoverEmoji:"",popoverStyles:{position:"fixed",zIndex:30},showPopover:!1}},componentDidMount:function(){window.addEventListener("resize",this.positionPopover,!1),document.addEventListener("keydown",this.handleDocumentKeydown,!1);var e=document.querySelector("#boardItem .comment-list");e&&e.addEventListener("scroll",this.positionPopover,!1)},componentDidUpdate:function(e,t){this.positionPopover()},componentWillUnmount:function(){window.removeEventListener("resize",this.positionPopover,!1),window.removeEventListener("click",this.handleWindowClick,!1),document.removeEventListener("keydown",this.handleDocumentKeydown,!1);var e=document.querySelector("#boardItem .comment-list");e&&e.removeEventListener("scroll",this.positionPopover,!1)},render:function(){var e=i({"emoji-popover":!0,"hover-emoji":""!==this.state.hoverEmoji}),t=i("emoji-icon-big","emojis-"+this.state.hoverEmoji+"-x2");return React.createElement("div",{className:"emoji-wrapper"},this.state.showPopover&&!this.props.mentionMenuVisible?React.createElement("div",{ref:"popover",className:e,style:this.state.popoverStyles},React.createElement("div",{className:"emoji-header"},React.createElement("h5",{className:"description"},"Type ':' and TAB to autocomplete or choose an emoji below:"),React.createElement("h5",{className:"details"},React.createElement("span",{className:t}),React.createElement("span",{className:"emoji-name"}," :",this.state.hoverEmoji,":"))),React.createElement(c,{ref:"tabs",onClearEmoji:this.handleClearEmoji,onHoverEmoji:this.handleHoverEmoji,onSelectEmoji:this.handleSelectEmoji})):null,React.createElement("div",{className:"comment-editor-tooltip add-emoji","data-tooltip":"Add Emoji",ref:"icon"},React.createElement("a",{onClick:this.togglePopover},this.icon())))},handleClearEmoji:function(e){""!==this.state.hoverEmoji&&this.setState({hoverEmoji:""})},handleDocumentKeydown:function(e){if(this.state.showPopover&&!this.props.mentionMenuVisible){var t=event.which||event.keyCode;-1!==a.HOT_KEYS.indexOf(t)&&27===t&&(e.preventDefault(),e.stopPropagation(),setTimeout(function(){this.togglePopover()}.bind(this),100))}},handleHoverEmoji:function(e){e!==this.state.hoverEmoji&&this.setState({hoverEmoji:e})},handleSelectEmoji:function(e){var t=s.getCommentContent()+":"+e+": ";r.setCommentContent(t),this.togglePopover(),this.props.onChange({target:{value:t}})},icon:function(){var e={pointerEvents:"none"};return React.createElement("svg",{style:e,viewBox:"0 0 20 20"},React.createElement("circle",{cx:"10",cy:"10",r:"10"}),React.createElement("path",{d:"M10,15.5c2.3,0,4.3-1.5,5.1-3.5H4.9C5.7,14,7.7,15.5,10,15.5z M6.5,9C7.3,9,8,8.3,8,7.5 S7.3,6,6.5,6S5,6.7,5,7.5S5.7,9,6.5,9z M13.5,9C14.3,9,15,8.3,15,7.5S14.3,6,13.5,6S12,6.7,12,7.5S12.7,9,13.5,9z M10,18 c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8S14.4,18,10,18z M10,0C4.5,0,0,4.5,0,10s4.5,10,10,10c5.5,0,10-4.5,10-10S15.5,0,10,0z"}))},handleWindowClick:function(e){this.state.showPopover&&(ReactDOM.findDOMNode(this.refs.tabs).contains(e.target)||this.togglePopover())},positionPopover:function(){if(this.state.showPopover){var e=ReactDOM.findDOMNode(this.refs.icon),t=e.getBoundingClientRect(),n=_.clone(this.state.popoverStyles),i=document.querySelector(".board-item-options");window.innerHeight-t.bottom<=400?(n.height="191px",n.top=t.top-198+"px",ReactDOM.findDOMNode(this.refs.tabs.refs.tabs).style.bottom="98px",ReactDOM.findDOMNode(this.refs.tabs.refs.emojis).style.height="92px"):(delete n.height,n.top=t.bottom-10+"px",ReactDOM.findDOMNode(this.refs.tabs.refs.tabs).style.bottom="238px",ReactDOM.findDOMNode(this.refs.tabs.refs.emojis).style.height="232px"),i&&(parseInt(n.top.replace("px",""),10)<63?o.add(i,"hide"):o.has(i,"hide")&&o.remove(i,"hide")),n.bottom="initial",n.right=window.innerWidth-t.right-10+"px",_.isEqual(n,this.state.popoverStyles)||this.setState({popoverStyles:n})}},togglePopover:function(){this.setState({showPopover:!this.state.showPopover},function(){if(this.state.showPopover)this.positionPopover(),setTimeout(function(){window.addEventListener("click",this.handleWindowClick,!1)}.bind(this));else{window.removeEventListener("click",this.handleWindowClick,!1);var e=document.querySelector(".board-item-options");e&&o.has(e,"hide")&&o.remove(e,"hide")}}.bind(this))}});t.exports=l},{"../actions/CommentActions":128,"../constants/CommentConstants":141,"../stores/CommentStore":143,"./EmojiTabs.jsx":133,classie:2,classnames:4}],133:[function(e,t,n){var i=e("classnames"),o=e("../actions/EmojiActions"),r=e("../stores/EmojiStore"),a=e("../../../ng-components/emoji/emoji-value"),s=e("../../../ng-components/emoji/emoji-service")(a),c=s.getCategories(),l=s.getEmojis(),u=React.createClass({displayName:"EmojiTabs",propTypes:{onClearEmoji:React.PropTypes.func,onHoverEmoji:React.PropTypes.func,onSelectEmoji:React.PropTypes.func},getInitialState:function(){return{activeTab:r.getCurrentTabIndex()}},renderTabs:function(){var e,t,n=c.map(function(n,o){return e=i({active:this.state.activeTab===o}),t=i("emoji-icon-tab","emojis-"+n),React.createElement("li",{key:"tab-"+o,className:e,onClick:this.handleTabClick.bind(this,o)},React.createElement("span",{className:t},n))}.bind(this));return n},renderEmojis:function(){var e,t=Object.keys(l),n=l[t[this.state.activeTab]].map(function(t,n){return e=i("emoji-icon","emojis-"+t),React.createElement("span",{key:n,className:e,onClick:this.handleClick.bind(this,t),onMouseEnter:this.handleMouseEnter.bind(this,t),onMouseLeave:this.handleMouseLeave.bind(this,t),"data-emoji":t},t)}.bind(this));return n},render:function(){var e=this.renderTabs(),t=this.renderEmojis();return React.createElement("div",null,React.createElement("ul",{className:"tabs",ref:"tabs"},e),React.createElement("div",{className:"emojis",ref:"emojis"},t))},handleClick:function(e){this.props.onSelectEmoji(e)},handleMouseEnter:function(e){this.props.onHoverEmoji(e)},handleMouseLeave:function(e){this.props.onClearEmoji(e)},handleTabClick:function(e){this.state.activeTab!==e&&this.setState({activeTab:e},function(){o.setCurrentTabIndex(e)})}});t.exports=u},{"../../../ng-components/emoji/emoji-service":126,"../../../ng-components/emoji/emoji-value":127,"../actions/EmojiActions":129,"../stores/EmojiStore":144,classnames:4}],134:[function(e,t,n){var i=e("classie"),o=e("classnames"),r=e("../actions/CommentActions"),a=e("../constants/CommentConstants"),s=(e("../stores/CommentStore"),e("../utils/CommentUtilities")),c=e("../../../ng-components/emoji/emoji-value"),l=e("../../../ng-components/emoji/emoji-service")(c),u=React.createClass({displayName:"EmojiTypeahead",propTypes:{mentionMenuVisible:React.PropTypes.bool,textareaRef:React.PropTypes.object},getInitialState:function(){return{current:0,comment:"",firstTab:!0,items:[],isActive:!1,isBrowsing:!1,styles:{bottom:"initial",right:0,position:"fixed",zIndex:30}}},componentDidMount:function(){var e=document.querySelector("#boardItem .comment-list");e&&e.addEventListener("scroll",this.positionTypeahead,!1)},componentDidUpdate:function(e,t){var n;!e.textareaRef&&this.props.textareaRef&&(n=ReactDOM.findDOMNode(this.props.textareaRef),n.addEventListener("keydown",this.handleKeydown,!1),n.addEventListener("input",this.handleChange,!1)),this.positionTypeahead()},componentWillUnmount:function(){var e=document.querySelector("#boardItem .comment-list");e&&e.removeEventListener("scroll",this.positionTypeahead,!1)},renderItems:function(){var e=this.state.items.map(function(e,t){var n=o({active:this.state.current===t}),i=o("emoji-icon-typeahead","emojis-"+e.label);return React.createElement("li",{key:t,ref:e.label,onMouseEnter:this.handleMouseEnter.bind(this,t),onClick:this.handleClick,className:n,"data-idx":t},React.createElement("i",{className:i}),":",e.label,":")}.bind(this));return e},render:function(){var e=o({"emoji-typeahead":!0,"emoji-typeahead-big":this.state.items.length>15}),t=this.renderItems();return React.createElement("div",{className:"emoji-typeahead-wrapper"},this.state.items.length>0&&!this.props.mentionMenuVisible?React.createElement("div",{className:e,ref:"typeahead",style:this.state.styles},React.createElement("nav",null,React.createElement("span",{className:"typeahead-command"},React.createElement("span",{className:"strong"},"tab")," or ",React.createElement("span",{className:"emojis-navigation emojis-navigation-arrows"})," to navigate"),React.createElement("span",{className:"typeahead-command"},React.createElement("span",{className:"emojis-navigation emojis-navigation-return"})," to select"),React.createElement("span",{className:"typeahead-command"},React.createElement("span",{className:"strong"},"esc")," to dismiss")),React.createElement("ul",{className:"emoji-list",ref:"emojiList"},t)):null)},flush:function(){this.setState({current:0,firstTab:!0,items:[],isActive:!1,isBrowsing:!1},function(){var e=document.querySelector(".board-item-options");e&&i.has(e,"hide")&&i.remove(e,"hide")})},handleChange:function(e){this.state.isBrowsing||(this.flush(),this.updateTypeahead())},handleKeydown:function(e){if(ReactDOM.findDOMNode(this.props.textareaRef)===document.activeElement&&!this.props.mentionMenuVisible){var t=e.which||e.keyCode,n=_.clone(this.state,!0);if(-1===a.HOT_KEYS.indexOf(t))return void this.flush();if(27===t)return void this.flush();if(9===t&&!this.state.isActive)return this.updateTypeahead(!0),void e.preventDefault();if(this.state.isActive){if(32===t)return void this.flush();e.preventDefault(),n.isBrowsing=!0,37===t||38===t?(n.firstTab=!1,n.current=0===n.current?n.items.length-1:n.current-1,this.browseEmoji(n)):39===t||40===t?(n.firstTab=!1,n.current=n.current>=n.items.length-1?0:n.current+1,this.browseEmoji(n)):9===t?(n.firstTab?n.firstTab=!1:n.current=n.current>=n.items.length-1?0:n.current+1,this.browseEmoji(n)):13===t&&(this.selectEmoji(),this.flush()),13!==t&&this.setState(n)}}},handleMouseEnter:function(e,t){this.setState({current:e})},handleClick:function(){this.selectEmoji()},emitEmoji:function(e,t){if(e=e||this.state,"undefined"!=typeof e.items[e.current]){var n=ReactDOM.findDOMNode(this.props.textareaRef),i=l.splitEmoji(n.value,s.getCaretPos(n)),o=e.items[e.current].label;r.setCommentContent(i.before+i.colon+o+": "+i.after),t&&t(i.before.length+i.colon.length+o.length+2)}},scrollToEmoji:function(e){var t=40,n=e.label,i=ReactDOM.findDOMNode(this.refs.emojiList),o=ReactDOM.findDOMNode(this.refs[n]),r=o.offsetTop-i.scrollTop;t>r?i.scrollTop+=r-t:r>i.offsetHeight&&(i.scrollTop+=r-i.offsetHeight)},browseEmoji:function(e){e=e||this.state;var t=ReactDOM.findDOMNode(this.props.textareaRef),n=s.getCaretPos(t);this.emitEmoji(e),s.setCaretPos(t,n),e.items.length>15&&this.scrollToEmoji(e.items[e.current])},selectEmoji:function(e){e=e||this.state;var t=ReactDOM.findDOMNode(this.props.textareaRef);this.emitEmoji(e,function(e){s.setCaretPos(t,e)}),this.flush()},activateTypeahead:function(e){var t=l.findEmoji(e.emoji),n=t.length>0;this.setState({items:t,isActive:n},function(){this.positionTypeahead()}.bind(this))},positionTypeahead:function(){if(0!==this.state.items.length&&this.props.textareaRef&&!this.props.mentionMenuVisible){var e=ReactDOM.findDOMNode(this.props.textareaRef),t=e.getBoundingClientRect(),n=_.clone(this.state.styles),o=t.top-5-ReactDOM.findDOMNode(this.refs.typeahead).clientHeight;0>o&&(o=t.bottom+5),n.left="initial",n.right=window.innerWidth-t.right+"px",n.top=o+"px";var r=document.querySelector(".board-item-options");r&&63>o?i.has(r,"hide")||i.add(r,"hide"):r&&i.remove(r,"hide"),_.isEqual(n,this.state.styles)||this.setState({styles:n})}},updateTypeahead:function(e){var t=ReactDOM.findDOMNode(this.props.textareaRef),n=l.splitEmoji(t.value,s.getCaretPos(t),e);return e&&n.showAll?void this.activateTypeahead(n):void(n.emoji&&n.emoji.length>=a.MIN_EMOJI_SEARCH&&this.activateTypeahead(n))}});t.exports=u},{"../../../ng-components/emoji/emoji-service":126,"../../../ng-components/emoji/emoji-value":127,"../actions/CommentActions":128,"../constants/CommentConstants":141,"../stores/CommentStore":143,"../utils/CommentUtilities":147,classie:2,classnames:4}],135:[function(e,t,n){var i=React.createClass({displayName:"EmptyMenu",propTypes:{message:React.PropTypes.string},getDefaultProps:function(){return{message:"No matches. Keep typing an email address to add someone new."}},render:function(){return React.createElement("div",{className:"empty"},React.createElement("span",{className:"user-email"}),React.createElement("p",null,this.props.message))}});t.exports=i},{}],136:[function(e,t,n){var i=e("../actions/CommentActions"),o=e("../utils/CommentUtilities"),r=React.createClass({displayName:"LimitedTextarea",propTypes:{autoFocus:React.PropTypes.bool,commentContent:React.PropTypes.string,cursorPosition:React.PropTypes.number,mentionMenuVisible:React.PropTypes.bool,onChange:React.PropTypes.func,onKeyDown:React.PropTypes.func,triggerChar:React.PropTypes.string},componentDidMount:function(){this.props.autoFocus&&ReactDOM.findDOMNode(this).focus()},componentDidUpdate:function(e,t){e.cursorPosition!==this.props.cursorPosition&&o.setCaretPos(ReactDOM.findDOMNode(this),this.props.cursorPosition)},render:function(){return React.createElement("textarea",{className:"comment-editor-textarea",onBlur:this.handleBlur,onChange:this.handleChange,onKeyDown:this.handleKeyDown,onPaste:this.handleKeyDown,placeholder:"Leave a comment",value:this.props.commentContent})},handleChange:function(e){i.setCommentContent(e.target.value),this.props.onChange(e)},handleKeyDown:function(e){this.props.onKeyDown(e)}});t.exports=r},{"../actions/CommentActions":128,"../utils/CommentUtilities":147}],137:[function(e,t,n){var i=e("./EmptyMenu.jsx"),o=(e("immutable"),e("./MenuItem.jsx")),r=e("../stores/MentionStore"),a=React.createClass({displayName:"MentionMenu",propTypes:{activeCandidateID:React.PropTypes.number,atConversationDisabled:React.PropTypes.bool,candidates:React.PropTypes.object,commentContent:React.PropTypes.string,searchResults:React.PropTypes.object,textareaRef:React.PropTypes.object,triggerChar:React.PropTypes.string},getInitialState:function(){return{styles:{width:"364px",position:"fixed"}}},componentDidMount:function(){this.checkMenuSize()},componentDidUpdate:function(e,t){this.checkMenuSize()},shouldComponentUpdate:function(e){var t=JSON.stringify(e.searchResults.matches),n=JSON.stringify(this.props.searchResults.matches);return t!==n||e.activeCandidateID!==this.props.activeCandidateID?!0:!1},renderMenuItems:function(){var e=this.props.searchResults.matches.map(function(e,t){return React.createElement(o,{key:t,activeCandidateID:this.props.activeCandidateID,candidate:e,candidates:this.props.candidates,commentContent:this.props.commentContent,disableMentionShortcut:this.props.disableMentionShortcut})}.bind(this));return e},renderMessageFooter:function(){var e,t={display:this.props.disableMentionShortcut?"none":"block"},n=[],i=r.isOverMentionCap("conversation"),o=r.isOverMentionCap("project");return r.isOverMentionCap()?(e=i&&o?React.createElement("span",null,React.createElement("strong",null,"@converstaion")," and ",React.createElement("strong",null,"@project")," don't"):React.createElement("span",null,React.createElement("strong",null,"@",r.isOverMentionCap())," doesn't"),n.push(React.createElement("p",{key:"mention-info-1"}," ",e," work with this many people. Choose who you'd like to notify"))):(n.push(React.createElement("p",{key:"mention-info-2"},React.createElement("strong",null,"@project")," will notify everyone collaborating on this project")),this.props.atConversationDisabled||n.push(React.createElement("p",{key:"mention-info-1"},React.createElement("strong",null,"@conversation")," will notify everyone in this conversation"))),React.createElement("div",{className:"message-footer",style:t},n)},render:function(){{var e="",t=this.renderMenuItems();this.props.atConversationDisabled}return"+"===this.props.triggerChar?e="Enter an email address to add someone new to this conversation.":0!==this.props.searchResults.matches.length||this.props.searchResults.isOverMax?this.props.searchResults.isOverMax&&(e="Too many matches to display. Keep typing to narrow down your results."):e=r.hasSearchMentionInput()?"No matches. Keep typing an email address to add someone new.":"Start typing a name or email address to mention a person in this comment.",React.createElement("div",{className:"mention-menu-wrapper",style:this.state.styles},this.props.searchResults.matches.size>0&&"+"!==this.props.triggerChar?React.createElement("div",null,React.createElement("div",{className:"message"},"Mention someone by name or email"),React.createElement("ul",{className:"user-search",id:"userSearch"},t),this.renderMessageFooter()):React.createElement("div",null,React.createElement(i,{message:e}),this.renderMessageFooter()))},checkMenuSize:function(){if(this.props.textareaRef){var e=_.clone(this.state.styles),t=ReactDOM.findDOMNode(this.props.textareaRef).getBoundingClientRect(),n=this.props.atConversationDisabled?0:12;window.innerHeight-t.bottom<=290?(e.bottom=window.innerHeight-t.top+n+"px",e.top="initial"):(e.bottom="initial",e.top=t.bottom+8+"px"),e.right=window.innerWidth-t.right+"px",_.isEqual(e,this.state.styles)||this.setState({styles:e})}}});t.exports=a},{"../stores/MentionStore":145,"./EmptyMenu.jsx":135,"./MenuItem.jsx":138,immutable:17}],138:[function(e,t,n){var i=e("../../../components/Avatar.jsx"),o=e("../utils/CommentUtilities"),r=(e("../actions/CommentActions"),e("classnames")),a=e("immutable"),s=e("../stores/MentionStore"),c=e("../actions/MentionActions"),l=e("../../../services/mention-shortcut-service.js"),u=React.createClass({displayName:"MentionMenuItem",propTypes:{activeCandidateID:React.PropTypes.number,candidate:React.PropTypes.instanceOf(a.Map),candidates:React.PropTypes.object,commentContent:React.PropTypes.string,disableMentionShortcut:React.PropTypes.bool},getInitialState:function(){return{candidates:this.props.candidates.candidates.toJS(),conversationMembers:this.props.candidates.conversationMembers.toJS()}},render:function(){var e=this.props,t=e.activeCandidateID,n=e.candidate,o=r({user:!0,clearfix:!0,active:t===n.get("id"),disabled:"shortcut"===n.toJS().role&&s.isOverMentionCap(n.toJS().name)}),a=r({avatar:!0,shortcut:"shortcut"===n.toJS().role});return React.createElement("li",{className:o,onClick:this.handleClick,onMouseOver:this.handleMouseOver},React.createElement("div",{className:a},React.createElement(i,{user:n.toJS(),size:32})),React.createElement("div",{className:"details"},React.createElement("span",{className:"name"},n.get("name")," "),React.createElement("div",{className:"user-info"},this.getPersonInfo(n,this.props.candidates))))},getPersonInfo:function(e){if(!this.props.disableMentionShortcut){var t=e.toJS(),n={candidates:{candidates:this.state.candidates,conversationMembers:this.state.conversationMembers}};return l.getUserInfo(t,n)}return e.toJS().email},handleClick:function(){var e=this.props,t=e.candidate,n=document.querySelector(".comment-editor-textarea");return s.isOverMentionCap(t.toJS().name)&&"shortcut"===t.toJS().role||c.selectCandidate(this.props.commentContent,"@",13,o.getCaretPos(n),!0),!1},handleMouseOver:function(){var e=this.props,t=e.candidate;s.isOverMentionCap(t.toJS().name)&&"shortcut"===t.toJS().role||c.setActiveCandidateID(this.props.candidate.get("id"))}});t.exports=u},{"../../../components/Avatar.jsx":115,"../../../services/mention-shortcut-service.js":148,"../actions/CommentActions":128,"../actions/MentionActions":130,"../stores/MentionStore":145,"../utils/CommentUtilities":147,classnames:4,immutable:17}],139:[function(e,t,n){var i=e("../actions/CommentActions"),o=React.createClass({displayName:"MentionNotificationCount",propTypes:{hideAddButton:React.PropTypes.bool,mentions:React.PropTypes.array},getInitialState:function(){return{styles:{width:"210px",
position:"absolute",marginTop:"3px"}}},componentWillMount:function(){if(this.props.hideAddButton){var e=_.clone(this.state.styles);e.width="160px",this.setState({styles:e})}},renderMentions:function(){var e=this.getWhoWillBeNotified(),t=e.map(function(e,t){return React.createElement("span",{className:"number-users",key:t},"+"==e.substring(0,1)?e.substring(1):e)});return t},render:function(){var e=this.getWhoWillBeNotified().length,t=1===e?"person":"people",n=this.renderMentions();return React.createElement("div",{className:"user-notification",style:this.state.styles},React.createElement("div",{className:"people-notified"},React.createElement("div",{className:"mention-tooltip"},e," ",t,e>0?React.createElement("div",{className:"mention-tooltip-content"},n):null)," will be notified.",this.props.hideAddButton?null:React.createElement("a",{className:"add-others",onClick:this.handleAddClick},"Add others?")))},handleAddClick:function(e){i.startNewMention()},getWhoWillBeNotified:function(){var e=this.props.mentions,t=[];return _.each(e,function(e){t.push(e.name?e.name:e.text)}),_.uniq(t)}});t.exports=o},{"../actions/CommentActions":128}],140:[function(e,t,n){var i=e("lodash"),o=e("../actions/CommentActions"),r=e("../constants/CommentConstants"),a=e("../stores/CommentStore"),s=e("../utils/CommentUtilities"),c=e("../actions/MentionActions"),l=e("../stores/MentionStore"),u=e("../../../utilities/mention-utilities.js"),h=React.createClass({displayName:"CommentTextarea",propTypes:{autoFocus:React.PropTypes.bool,commentContent:React.PropTypes.string,cursorPosition:React.PropTypes.number,mentionMenuVisible:React.PropTypes.bool,onChange:React.PropTypes.func,onKeyDown:React.PropTypes.func,triggerChar:React.PropTypes.string},componentDidMount:function(){this.props.autoFocus&&ReactDOM.findDOMNode(this).focus()},componentDidUpdate:function(e,t){e.cursorPosition!==this.props.cursorPosition&&s.setCaretPos(ReactDOM.findDOMNode(this),this.props.cursorPosition),this.props.mentionMenuVisible&&!e.mentionMenuVisible&&ReactDOM.findDOMNode(this).focus()},render:function(){return React.createElement("textarea",{className:"comment-editor-textarea",onBlur:this.handleBlur,onChange:this.handleChange,onFocus:this.handleFocus,onKeyDown:this.handleKeyDown,onPaste:this.handleKeyDown,placeholder:"Leave a comment",value:this.props.commentContent})},blurTimeout:null,pendingMentionsUpdate:null,handleBlur:function(e){this.blurTimeout=setTimeout(function(){c.clearMentionMenu()},150)},handleChange:function(e){var t,n=e.target.value,h=s.getCaretPos(e.target),d=n[h-1],p=a.getCommentLength(),m=n.length,f=p>m,g=p-m,v=g>1,y=s.isEditingMention(n,h);if(v&&c.deleteRange(h,g),m!==p){var _=m-p;c.adjustStartPos(h,_)}if(y&&f){var E=s.getLastWord(n,h).index;c.deleteMention(E)}this.pendingMentionsUpdate&&clearTimeout(this.pendingMentionsUpdate),this.pendingMentionsUpdate=setTimeout(i.bind(function(){c.rebuildMentionsFromComment(e.target.value),this.pendingMentions=null},this),250),t=u.replaceMalformedEmails(e.target.value,l.getMentions()),o.setCommentContent(t),e.target.value=t,(y||r.MENU_TRIGGER_KEYS.indexOf(d)>=0&&(" "===n[h-2]||1===h))&&!this.props.mentionMenuVisible?(d=s.getCurrentMentionTrigger(n,h),c.viewMentionMenu(d),setTimeout(function(){c.parseMentionString(n,h)})):this.props.mentionMenuVisible&&!y?c.clearMentionMenu():this.props.mentionMenuVisible&&y&&c.parseMentionString(n,h),this.props.onChange(e)},handleFocus:function(e){this.blurTimeout&&clearTimeout(this.blurTimeout)},handleKeyDown:function(e){var t=e.which||e.keyCode;return this.props.mentionMenuVisible&&-1!==r.HOT_KEYS.indexOf(t)&&32!==t?(e.preventDefault(),9===t||13===t?void c.selectCandidate(e.target.value,this.props.triggerChar,t,s.getCaretPos(e.target),!0):27===t?void c.clearMentionMenu():40===t?(c.selectNextCandidate(),void this.adjustScroll(1)):38===t?(c.selectPreviousCandidate(),void this.adjustScroll(0)):void this.props.onKeyDown(e)):void this.props.onKeyDown(e)},adjustScroll:function(e){var t=document.getElementById("userSearch");if(t){var n=t.querySelector(".user.active");1===e&&(n!==t.lastChild?t.scrollTop+=n.offsetHeight:t.scrollTop=0),0===e&&(n!==t.firstChild?t.scrollTop-=n.offsetHeight:t.scrollTop=t.scrollHeight-t.offsetHeight)}}});t.exports=h},{"../../../utilities/mention-utilities.js":154,"../actions/CommentActions":128,"../actions/MentionActions":130,"../constants/CommentConstants":141,"../stores/CommentStore":143,"../stores/MentionStore":145,"../utils/CommentUtilities":147,lodash:19}],141:[function(e,t,n){var i=e("keymirror");t.exports={ACTION_TYPES:i({ADD_MENTION:null,ADD_MENTION_TO_COMMENT:null,ADJUST_START_POS:null,CLEAR_ALL:null,CLEAR_MENTIONS:null,CLEAR_MENTION_MENU:null,CLEAR_MENTION_TEXT:null,DELETE_MENTION:null,DELETE_RANGE:null,LOAD_CANDIDATES:null,PARSE_MENTION_STRING:null,REBUILD_MENTIONS:null,SELECT_CANDIDATE:null,SELECT_NEXT_CANDIDATE:null,SELECT_PREVIOUS_CANDIDATE:null,SET_ACTIVE_CANDIDATE_ID:null,SET_COMMENT_CONTENT:null,SET_COMMENT_LENGTH:null,SET_CURRENT_TAB_INDEX:null,SET_CURRENT_COMMENT:null,START_NEW_MENTION:null,UPDATE_MENTIONS:null,VIEW_MENTION_MENU:null}),HOT_KEYS:[9,13,27,32,37,38,39,40],MENU_TRIGGER_KEYS:["@","+"],MIN_EMOJI_SEARCH:2,PAYLOAD_SOURCES:i({SERVER_ACTION:null,VIEW_ACTION:null}),USER_ROLES:{CONTRIBUTOR:"Contributor",REVIEWER:"Reviewer",ADMIN:"Admin",MANAGER:"Manager"}}},{keymirror:18}],142:[function(e,t,n){var i=e("flux").Dispatcher,o=e("../constants/CommentConstants"),r=_.assign(new i,{handleViewAction:function(e){this.dispatch({source:o.PAYLOAD_SOURCES.VIEW_ACTION,action:e})},handleServerAction:function(e){this.dispatch({source:o.PAYLOAD_SOURCES.SERVER_ACTION,action:e})}});t.exports=r},{"../constants/CommentConstants":141,flux:10}],143:[function(e,t,n){var i=e("lodash"),o=e("../dispatcher/CommentDispatcher"),r=e("../constants/CommentConstants"),a=e("../utils/CommentUtilities"),s=e("events").EventEmitter,c=e("../actions/MentionActions"),l="change",u="",h=0,d=0,p=i.assign({},s.prototype,{getCommentContent:function(){return u},getCommentLength:function(){return h},getCursorPosition:function(){return d},emitChange:function(){this.emit(l)},addChangeListener:function(e){this.on(l,e)},removeChangeListener:function(e){this.removeListener(l,e)}}),m=function(e,t){var n=[],o=e?e:"";t=i.map(t,function(e){var t=n.length;return n.push(e.text),{text:e.text,userID:e.userID,startPos:t,name:e.name}}),n=i.uniq(n),n=n.join(" "),n+=o,u=n,h=n.length,d=n.length,setTimeout(function(){i.each(t,function(e){c.addMention(e.text,e.userID,e.startPos,e.name)})})},f=function(e,t,n){var i=a.getCurrentMentionText(u,t),o=u.substr(0,t-i.join("").length),r=u.substr(t,u.length),s=n?" ":"";u=o+e+s+r,("@"===i[0]||a.isEmailAddress(i[1]))&&(d=u.indexOf(e)+e.length+1,n&&d++)},g=function(){u="",h=0,d=0},v=function(e,t){var n=a.getCurrentMentionText(e,t),i=u.replace(n.join(""),n+"__CURSOR__");u=i.replace("__CURSOR__",""),d=i.indexOf("__CURSOR__")},y=function(e){u=e,_(e.length)},_=function(e){h=e},E=function(){u=""===u?"@":u+" @",d=u.length,setTimeout(function(){c.viewMentionMenu("@")},50)};o.register(function(e){var t=e.action,n=!0;switch(t.actionType){case r.ACTION_TYPES.ADD_MENTION_TO_COMMENT:f(t.data.mentionText,t.data.cursorPosition,t.data.positionCursorAfterMention);break;case r.ACTION_TYPES.CLEAR_ALL:g();break;case r.ACTION_TYPES.CLEAR_MENTION_TEXT:v(t.data.value,t.data.cursorPosition);break;case r.ACTION_TYPES.SET_COMMENT_CONTENT:y(t.data);break;case r.ACTION_TYPES.SET_COMMENT_LENGTH:_(t.data);break;case r.ACTION_TYPES.SET_CURRENT_COMMENT:m(t.data.text,t.data.mentions);break;case r.ACTION_TYPES.START_NEW_MENTION:E();break;default:n=!1}return n&&p.emitChange(),!0}),t.exports=p},{"../actions/MentionActions":130,"../constants/CommentConstants":141,"../dispatcher/CommentDispatcher":142,"../utils/CommentUtilities":147,events:9,lodash:19}],144:[function(e,t,n){var i=e("../dispatcher/CommentDispatcher"),o=e("../constants/CommentConstants"),r=e("events").EventEmitter,a="change",s=0,c=_.assign({},r.prototype,{getCurrentTabIndex:function(){return s},emitChange:function(){this.emit(a)},addChangeListener:function(e){this.on(a,e)},removeChangeListener:function(e){this.removeListener(a,e)}}),l=function(e){s=e};i.register(function(e){var t=e.action,n=!0;switch(t.actionType){case o.ACTION_TYPES.SET_CURRENT_TAB_INDEX:l(t.data);break;default:n=!1}return n&&c.emitChange(),!0}),t.exports=c},{"../constants/CommentConstants":141,"../dispatcher/CommentDispatcher":142,events:9}],145:[function(e,t,n){var i,o=e("lodash"),r=e("../utils/CandidatesPartial"),a=e("../actions/CommentActions"),s=e("../stores/CommentStore"),c=e("../actions/MentionActions"),l=e("../dispatcher/CommentDispatcher"),u=e("../constants/CommentConstants"),h=e("../utils/CommentUtilities"),d=e("events").EventEmitter,p=e("immutable"),m=e("../../../utilities/mention-utilities.js"),f=e("../../../services/mention-shortcut-service.js"),g="change",v=0,y={},_=!0,E=!1,b=!1,T=null,S=[],w=250,C={isOverMax:!1,matches:[]},R=function(){return y.isOverProjectMentionCap?"project":!1},A=function(){return y.isOverConversationMentionCap?"conversation":!1},D=function(e){return e?A()===e||R()===e?e:!1:A()||R()},I=o.assign({},d.prototype,{getActiveCandidateID:function(){return v},getCandidates:function(){return y},getMentionMenuTriggerChar:function(){return T},getMentionMenuVisible:function(){return b},getMentions:function(){return S},isOverMentionCap:function(e){return D(e)},hasSearchMentionInput:function(){return b&&o.isArray(i)&&(i[1]||"").toString().length>0},getSearchResults:function(){return C},emitChange:function(){this.emit(g)},addChangeListener:function(e){this.on(g,e)},removeChangeListener:function(e){this.removeListener(g,e)},setDisableMentionShortcut:function(e){_=e},setDisableAtConversation:function(e){E=e}}),M=function(e){o.find(S,{userID:e.userID})||S.push(e)},x=function(e,t){S.forEach(function(n){e-t<=n.startPos&&(n.startPos+=t)})},O=function(e){var t=_?[]:f.getShortcuts(e);return t.length&&E?[o.find(t,function(e){return"project"===e.name})]:t},k=function(){v=0,S=[]},N=function(){v=0,y={},b=!1,T=null,S=[],C={isOverMin:!1,matches:[]},i=null},L=function(){b=!1,T=null,C={isOverMin:!1,matches:[]},v=0,i=null},P=function(e){S.forEach(function(t,n){t.startPos===e&&S.splice(n,1)})},U=function(e,t,n){return"+"===e?"+"+t:"@"===e&&n?"@"+n.get("name").replace(/\s/g,""):t},j=function(){r.load(function(e){var t=function(e){var t=e.get("role");return t===u.USER_ROLES.CONTRIBUTOR||t===u.USER_ROLES.REVIEWER||t===u.USER_ROLES.ADMIN||t===u.USER_ROLES.MANAGER},n=[];e.candidates.forEach(function(e){n.push(e.id)});var i=O(n),o=p.fromJS(e.candidates).sort(function(e,n){return t(e)!==t(n)?t(e)?-1:1:e.get("name").toUpperCase()<n.get("name").toUpperCase()?-1:1});y={candidates:p.fromJS(i).concat(o),members:p.fromJS(e.members),conversationMembers:p.fromJS(e.conversationMembers),isOverConversationMentionCap:p.fromJS(e.isOverConversationMentionCap),isOverProjectMentionCap:p.fromJS(e.isOverProjectMentionCap)},v=y.candidates.size>0?y.candidates.first().get("id"):0,I.emitChange()})},B=function(e,t){C={isOverMin:!1,matches:[]};var n=h.getCurrentMentionText(e,t);if(i=n,"@"===n[0]&&n[1].length>0){var o=new RegExp(n[1],"i"),r=y.candidates.filter(function(e){return e.get("email")?e.get("name").split(" ").join("").search(o)>-1||e.get("email").search(o)>-1:e.get("name").split(" ").join("").search(o)>-1}),s=r.size>w;C={isOverMax:s,matches:s?[]:r},v=C.matches.size>0?C.matches.first().get("id"):0,0===C.matches.size&&m.isEmailAddress(n[1])&&(setTimeout(function(){a.setCommentContent(e.replace(n[0]+n[1],"+"+n[1]))}),W(!0,"+"))}},H=function(e){var t=y.candidates?y.candidates.toJS():[],n=y.members?y.members.toJS():[],i=y.conversationMembers?y.conversationMembers.toJS():[],o=_||E;S=m.findMentions(e,{existingMentions:S,candidates:t,members:_?[]:n,conversationMembers:o?[]:i,debug:!1})},z=function(e){var t=-1,n=0;v>0&&(t=C.matches.findIndex(function(e){return e.get("id")===v})),n="next"===e?t>-1&&t+1<C.matches.size?t+1:0:0>=t?C.matches.size-1:t-1,C.matches.get(n)&&(v=C.matches.get(n).get("id"))},F=function(e,t,n,i,o){var r,l,u=h.getCurrentMentionText(e,i),d=u[0]+u[1],p=d.length,m={};if("+"===u[0])r=h.isEmailAddress(u[1])?U(u[0],u[1]):u.join(""),m.email=u[1],l=u[1];else{var f=y.candidates.find(function(e){return e.get("id")===v});if(r=U(u[0],u[1],f),m.userID=f.get("id"),l=f.get("name"),D(l))return void L()}m.text=r,m.name=l,m.startPos=i-p,M(m),L(),setTimeout(function(){var e=s.getCommentLength()+r.length-p;a.setCommentLength(e),a.addMentionToComment(r,i,o),c.rebuildMentionsFromComment(s.getCommentContent())})},V=function(e){v=e},W=function(e,t){b=e,t&&(T=t)},G=function(e,t){var n=e+t;S=o.filter(S,function(t){if(!o.isNumber(t.startPos))return t;var i=t.startPos,r=t.startPos+t.text.length;return e>r||i>n?t:void 0})};l.register(function(e){var t=e.action,n=!0;switch(t.actionType){case u.ACTION_TYPES.ADJUST_START_POS:x(t.data.cursorPos,t.data.lenDiff);break;case u.ACTION_TYPES.CLEAR_ALL:N();break;case u.ACTION_TYPES.CLEAR_MENTIONS:k();break;case u.ACTION_TYPES.CLEAR_MENTION_MENU:L();break;case u.ACTION_TYPES.DELETE_MENTION:P(t.data.startPos);break;case u.ACTION_TYPES.LOAD_CANDIDATES:j();break;case u.ACTION_TYPES.PARSE_MENTION_STRING:B(t.data.value,t.data.cursorPosition);break;case u.ACTION_TYPES.REBUILD_MENTIONS:H(t.data.comment);break;case u.ACTION_TYPES.ADD_MENTION:M(t.data);break;case u.ACTION_TYPES.SELECT_CANDIDATE:F(t.data.value,t.data.triggerChar,t.data.keyCode,t.data.cursorPosition,t.data.positionCursorAfterMention);break;case u.ACTION_TYPES.SELECT_NEXT_CANDIDATE:z("next");break;case u.ACTION_TYPES.SELECT_PREVIOUS_CANDIDATE:z("prev");break;case u.ACTION_TYPES.SET_ACTIVE_CANDIDATE_ID:V(t.data);break;case u.ACTION_TYPES.DELETE_RANGE:G(t.data.start,t.data.length);break;case u.ACTION_TYPES.VIEW_MENTION_MENU:W(!0,t.data);break;default:n=!1}return n&&I.emitChange(),!0}),t.exports=I},{"../../../services/mention-shortcut-service.js":148,"../../../utilities/mention-utilities.js":154,"../actions/CommentActions":128,"../actions/MentionActions":130,"../constants/CommentConstants":141,"../dispatcher/CommentDispatcher":142,"../stores/CommentStore":143,"../utils/CandidatesPartial":146,"../utils/CommentUtilities":147,events:9,immutable:17,lodash:19}],146:[function(e,t,n){var i=e("../../../utilities/API"),o={load:function(e){try{var t=angular.element(document.body).injector().get("commentObjectService"),n=t.get()}catch(o){e([])}"board"!==n.objectType&&e([]),i.get("/api/mentions/candidates?boardID="+n.objectID+"&boardItemID="+n.conversationID+"&hasMentionShortcuts=true",function(t,n){e(t?[]:n.body.candidates)})}};t.exports=o},{"../../../utilities/API":150}],147:[function(e,t,n){var i=e("../constants/CommentConstants"),o=e("../../../ng-components/emoji/emoji-value"),r=e("../../../ng-components/emoji/emoji-service")(o),a=(e("immutable"),/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i),s={getCaretPos:function(e){if(e&&e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n}},getCurrentMentionTrigger:function(e,t){if(!this.isEditingMention(e,t))return"";var n=e.substr(0,t),i=/\S+$/.exec(n)||[" "];return i[0].charAt(0)},getCurrentMentionText:function(e,t){var n=e.substr(t-1,e.length),i=/^\S+/.exec(n)||[""];return n=n.replace(i[0],""),e=e.replace(n,""),t>1&&(e=/\S+$/.exec(e)[0]||""),[e.charAt(0),e.substr(1,e.length)]},getLastWord:function(e,t){var n=e.substr(0,t),i=/\S+$/.exec(n)||[" "];return{text:i,index:n.length-i[0].length}},isEditingMention:function(e,t){var n=this.getLastWord(e,t).text;return i.MENU_TRIGGER_KEYS.indexOf(n[0].charAt(0))>=0},isEmailAddress:function(e){var t=a;return t.test(e)},parseComment:function(e,t){return t||(e=r.parseEmoji(e)),e},parseMentions:function(e,t,n,i){if(i=!!i)return e;var o=0,r=t.sort(function(e,t){return e.startPos-t.startPos});return r.forEach(function(t){var i=t.text,r=t.startPos,a=t.userID===n+""?"me-mentioned":"mention-blue",s='<span class="'+a+'">'+i+"</span>";e=e.slice(0,r+o)+(s||"")+e.slice(r+i.length+o,e.length),o+=s.length-i.length}),e},setCaretPos:function(e,t){if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.focus(),void 0!==e.selectionStart&&e.setSelectionRange(t,t)},parseLineBreaks:function(e){return e=e.split("\n").join("<br />")}};t.exports=s},{"../../../ng-components/emoji/emoji-service":126,"../../../ng-components/emoji/emoji-value":127,"../constants/CommentConstants":141,immutable:17}],148:[function(e,t,n){!function(n,i){"use strict";function o(n){function i(e,t){if("conversation"===e.name){var n=[];return a.map(t.candidates.conversationMembers,function(e){n.push(e.name)}),n.length?r(n):"It's lonely in here!"}if("project"===e.name){var i=[],o=a.filter(t.candidates.candidates,function(e){return"member"===e.role});return a.map(o,function(e){i.push(e.name)}),i.length?r(i):"It's lonely in here!"}return e.email}function o(e){if(e){var t=Math.max.apply(Math,e);s.map(function(e,n){e.id=t+n+1})}return s}function r(e){if(e.length<3)return e.join(2===e.length?", ":"");var t=e.slice(0,2).join(", ");return t+" & "+(e.length-2)+" more"}var a=n;"undefined"!=typeof t&&t.exports&&(a=e("lodash"));var s=[{name:"project",role:"shortcut"},{name:"conversation",role:"shortcut"}];return{getUserInfo:i,getShortcuts:o}}"undefined"!=typeof t&&t.exports?t.exports=o(null):i&&i.service("mentionShortcutService",o)}(angular,InVision)},{lodash:19}],149:[function(e,t,n){var i=function(){var e="x";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}}();t.exports={set:function(e,t){if(i)try{localStorage.setItem(e,JSON.stringify(t))}catch(n){localStorage.getItem(e)&&localStorage.removeItem(e)}},get:function(e){return i?JSON.parse(localStorage.getItem(e)):null}}},{}],150:[function(e,t,n){var i=e("superagent"),o=e("./get-cookie"),r=function(){return o("XSRF-TOKEN")||o("XSRF-TOKEN_QA")||o("XSRF-TOKEN_LOCAL")},a=function(e,t){i.get(e).set("X-XSRF-TOKEN",r()).end(function(e,n){return"function"==typeof t?t(e,n):void 0})},s=function(e,t,n){i.post(e).send(t).set("X-XSRF-TOKEN",r()).end(function(e,t){return"function"==typeof n?n(e,t):void 0})};t.exports={get:a,post:s}},{"./get-cookie":153,superagent:26}],151:[function(e,t,n){function i(e){return e=String(e||"").replace(f,""),(e+"000000").slice(0,6)}function o(e){return!r(e)}function r(e){e=i(e);var t=e.slice(0,2),n=e.slice(2,4),o=e.slice(4),r=parseInt(t,16),a=parseInt(n,16),s=parseInt(o,16),c=(299*r+587*a+114*s)/1e3;return c>130}function a(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:[0,0,0]}function s(e,t,n){return["#",c(e),c(t),c(n)].join("")}function c(e){return e=e.toString(16),1===e.length?"0"+e:e}function l(e){var t,n,i=e[0]/255,o=e[1]/255,r=e[2]/255,a=1,s=Math.max(i,o,r),c=Math.min(i,o,r),l=(s+c)/2,u=s-c;if(s===c)t=n=0;else{switch(n=l>.5?u/(2-s-c):u/(s+c),s){case i:t=(o-r)/u+(r>o?6:0);break;case o:t=(r-i)/u+2;break;case r:t=(i-o)/u+4}t/=6}return{h:360*t,s:n,l:l,a:a}}function u(e){return Math.min(1,Math.max(0,e))}function h(e){var t=parseInt(e.h,10),n=parseInt(100*e.s,10)+"%",i=parseInt(100*e.l,10)+"%";return"hsl("+t+", "+n+", "+i+")"}function d(e,t){var n=l(a(e));return n.l-=t/100,n.l=u(n.l),h(n)}function p(e,t){var n=l(a(e));return n.l+=t/100,n.l=u(n.l),h(n)}function m(e){return/^#([A-Fa-f0-9]{3}$)|([A-Fa-f0-9]{6}$)/.test(e)}var f=/[^a-f0-9]+/gi,g={isLight:r,isDark:o,lighten:p,darken:d,hexToRGB:a,RGBToHex:s,checkHex:m};t.exports=g},{}],152:[function(e,t,n){var i=function(){this.dayAsStringMap=[{"long":"Sunday","short":"Sun"},{"long":"Monday","short":"Mon"},{"long":"Tuesday","short":"Tue"},{"long":"Wednesday","short":"Wed"},{"long":"Thursday","short":"Thr"},{"long":"Friday","short":"Fri"},{"long":"Saturday","short":"Sat"}],this.monthAsStringMap=[{"long":"January","short":"Jan"},{"long":"February","short":"Feb"},{"long":"March","short":"Mar"},{"long":"April","short":"Apr"},{"long":"May","short":"May"},{"long":"June","short":"Jun"},{"long":"July","short":"Jul"},{"long":"August","short":"Aug"},{"long":"September","short":"Sep"},{"long":"October","short":"Oct"},{"long":"November","short":"Nov"},{"long":"December","short":"Dec"}]};i.prototype={add:function(e,t,n){var i=this.duplicate(e);switch(n.toLowerCase()){case"y":i.setFullYear(i.getFullYear()+t);break;case"m":i.setMonth(i.getMonth()+t);break;case"d":i.setDate(i.getDate()+t);break;case"w":i.setDate(i.getDate()+7*t);break;case"h":i.setTime(i.getTime()+1e3*t*60*60);break;case"n":i.setTime(i.getTime()+1e3*t*60);break;case"s":i.setTime(i.getTime()+1e3*t);break;case"l":i.setTime(i.getTime()+t)}return i},addDays:function(e,t){var n=this.duplicate(e);return n.setDate(n.getDate()+t),n},addLeadingZero:function(e){return 1===e.toString().length?"0"+e:e},convertSecondsToMinutes:function(e,t){var n=Math.floor(e/60),i=e%60;return t===!0&&0===n?":"+this.addLeadingZero(i):n+":"+this.addLeadingZero(i)},duplicate:function(e){return new Date(e)},equals:function(e,t){return e.getTime()===t.getTime()},formatDate:function(e,t){var n=this,i=this.removeTime(e),o=t.replace(/M+|m+|d+|yyyy|yy/g,function(e){return n.getFormattedDatePart(i,e)});return o},formatRecentDate:function(e,t){var n=this.removeTime(e);return this.isToday(n)?"Today":this.isYesterday(n)?"Yesterday":this.formatDate(e,t)},formatTime:function(e,t){var n=this,i=this.duplicate(e),o=t.replace(/H+|h+|m+|t+|T+/g,function(e){return n.getFormattedTimePart(i,e)});return o},getDayOfWeekAsString:function(e,t){return t?this.dayAsStringMap[e]["short"]:this.dayAsStringMap[e]["long"]},getFormattedDatePart:function(e,t){switch(t){case"D":case"d":return e.getDate();case"DD":case"dd":return this.addLeadingZero(e.getDate());case"DDD":return this.getDayOfWeekAsString(e.getDay()).toUpperCase();case"ddd":return this.getDayOfWeekAsString(e.getDay());case"dddd":return this.getDayOfWeekAsString(e.getDay(),!0);case"M":case"m":return e.getMonth()+1;case"MM":case"mm":return this.addLeadingZero(e.getMonth()+1);case"MMM":case"mmm":return this.getMonthAsString(e.getMonth(),!0);case"MMMM":case"mmmm":return this.getMonthAsString(e.getMonth(),!1);case"YY":case"yy":return this.addLeadingZero(e.getFullYear()%100);case"YYYY":case"yyyy":return e.getFullYear()}return t},getFormattedTimePart:function(e,t){var n;switch(t){case"H":return e.getHours();case"HH":return n=e.getHours(),10>n?"0"+n:n;case"h":return n=e.getHours()%12,0===n?12:n;case"hh":return n=e.getHours()%12,n=0===n?12:n,10>n?"0"+n:n;case"M":case"MM":case"m":case"mm":return n=e.getMinutes(),10>n?"0"+n:n;case"T":return e.getHours()<12?"A":"P";case"TT":return e.getHours()<12?"AM":"PM";case"t":return e.getHours()<12?"a":"p";case"tt":return e.getHours()<12?"am":"pm"}return t},getMonthAsString:function(e,t){return t?this.monthAsStringMap[e]["short"]:this.monthAsStringMap[e]["long"]},isRecent:function(e,t,n){var i=this.add(new Date,-t,n);return e>=i},isToday:function(e){return this.equals(e,this.today())},isYesterday:function(e){return this.equals(e,this.yesterday())},removeTime:function(e){var t=this.duplicate(e);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},today:function(){return this.removeTime(new Date)},yesterday:function(){return this.addDays(this.today(),-1)},formatRelativeWithinMonth:function(e,t){t=t||"smallDate",moment.lang("smallDate",{relativeTime:{future:"in %s",past:"%s",s:"1s",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1mo",MM:"%d months",y:"a year",yy:"%d years"}}),moment.lang("expandedDate",{relativeTime:{future:"in %s",past:"%s ago",s:"1 second",ss:"%d seconds",m:"1 minute",mm:"%d minutes",h:"1 hour",hh:"%d hours",d:"1 day",dd:"%d days",M:"1 month",MM:"%d months",y:"a year",yy:"%d years"}}),moment.lang("expandedDate",{relativeTime:{future:"in %s",past:"%s ago",s:"1 second",ss:"%d seconds",m:"1 minute",mm:"%d minutes",h:"1 hour",hh:"%d hours",d:"1 day",dd:"%d days",M:"1 month",MM:"%d months",y:"a year",yy:"%d years"}}),moment.lang("expandedDate",{relativeTime:{future:"in %s",past:"%s ago",s:"1 second",ss:"%d seconds",m:"1 minute",mm:"%d minutes",h:"1 hour",hh:"%d hours",d:"1 day",dd:"%d days",M:"1 month",MM:"%d months",y:"a year",yy:"%d years"}});var n,i=moment(),o=moment(e).diff(i,"months");return 0===Math.abs(o)?(moment.lang(t),n=moment(e).fromNow(),moment.lang(!1)):n=moment(e).format("MMM D"),n}},t.exports=new i},{}],153:[function(e,t,n){t.exports=function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}},{}],154:[function(e,t,n){!function(e,n){"use strict";function i(t){function n(){t?t.log.apply(t,arguments):window&&window.console&&window.console.log.apply(window.console,arguments)}function i(e){var t="@"+e.replace(u,"");return t}function o(e){return{userID:e.id||e.userID,text:i(e.name)}}function r(t,o){var r=e.copy(v);e.isObject(o)&&e.extend(r,o);var s,c,l,u,h,d,p,f=[],y=0,E=r.existingMentions,b=r.candidates,T=r.members,S=r.conversationMembers;if(!e.isArray(E))throw"if provided, existingMentions must be an array";if(!e.isArray(b))throw"if provided, candidates must be an array";for(r.debug&&n("commentText:",t),r.searchCandidates&&b.length<=r.maxCandidates&&_.each(b,function(e){e.mentionText=i(e.name).toLowerCase()});s=m.exec(t);)r.debug&&n("Checking mention match:",s[2],"index:",s.index,s),h=[],l=null,u=null,p=null,y=s.index+s[1].length,c=s[2]||s[3],c=c.replace(/[\s,.!?\-]$/,""),d="@project"===c||"@conversation"===c,c=c.replace(g,""),r.debug&&n("Text with trailing punctuation stripped:",c),l=_.find(E,{text:c,startPos:y}),!l||d?(l=_.find(E,{text:c}),!l||d?T.length&&"@project"===c?_.each(T,function(e){u={userID:e.id,text:c,name:e.name,startPos:y},f.push(u)}):S.length&&"@conversation"===c?_.each(S,function(e){u={userID:e.id,text:c,name:e.name,startPos:y},f.push(u)}):r.searchCandidates&&b.length<=r.maxCandidates&&(_.each(b,function(t){t.mentionText===c.toLowerCase()&&"shortcut"!==t.role&&h.push(e.copy(t))}),1===h.length)?(r.debug&&n("Have single candidate which matches text"),u={userID:h[0].id,text:c,name:h[0].name,startPos:y},f.push(u)):a(c)&&(("@"===c.charAt(0)||"+"===c.charAt(0))&&(c=c.slice(1,c.length)),r.debug&&n("Have apparently-valid email address"),u={startPos:y,text:"+"+c,email:c},f.push(u)):(r.debug&&n("Have text match different startPos with existing mention"),u=e.copy(l),u.startPos=y,f.push(u))):(r.debug&&n("Have exact match with existing mention"),f.push(l));return r.debug&&(n(f.length+" mentions in "+t+":---------"),_.each(f,function(e){n(JSON.stringify(e))})),f}function a(e){return e.match(f)}function s(e,t){return t.forEach(function(t){var n=t.text.slice(1,t.text.length);if(a(n)){var i="@"+n;-1!==e.indexOf(i)&&(e=e.replace(i,"+"+n))}}),e}var c="!-/:-@[-`{-~",l="\x00- ",u=new RegExp("["+l+c+"]+","g"),h="(@[\\S]+(?:["+c+"]+|$)?)",d="([^@\\s]+@[^@\\s]+\\.\\w{2}[\\.\\w]*)",p="(^|\\s)(?:"+h+"|\\+("+d+"))",m=new RegExp(p,"g"),f=new RegExp(d),g=new RegExp("["+c+"]+$","g"),v={candidates:[],conversationMembers:[],debug:!1,existingMentions:[],maxCandidates:300,members:[],searchCandidates:!0};return{findMentions:r,isEmailAddress:a,nameToMentionText:i,replaceMalformedEmails:s,userToMention:o}}"undefined"!=typeof t&&t.exports?t.exports=i(null):n&&n.service("mentionUtilities",i)}(angular,InVision)},{}],155:[function(e,t,n){function i(e,t,n){return t=t||{newWindow:!0,stripPrefix:!1,phone:!1,email:!1,twitter:!1,hashtag:!1,replaceFn:function(e,t){var n=e.getTagBuilder().build(t);return n.setInnerHtml(t.matchedText),n}},n=n||[],e=o.link(e,t),e=r.sanitize(e,{ALLOWED_TAGS:n.concat(["a"]),ALLOWED_ATTR:["href","target"]})}var o=e("autolinker"),r=e("dompurify");t.exports=i},{autolinker:1,dompurify:6}],156:[function(e,t,n){!function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),o=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+o)},o);return e=i+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}()},{}]},{},[114]);
;
;
/*! main.js */ 
;
;
var InVision = angular.module( "InVision", [ "ngResource", "ngRoute", "ngSanitize" ] );
(function( ng, app ){
app.config(
function( $routeProvider ){
}
);
app.config(
function( $httpProvider ) {
var httpInterceptorFor401Response = function( $window, $q, config ) {
var interceptor = function( request ) {
var interceptedResponse = request.then(
function() {
return( request );
},
function( httpResponse ) {
if ( httpResponse.status === 401 ) {
$window.setTimeout(
function() {
$window.location.href = ( "./" + config.share.key );
},
100
);
return( $q.defer().promise );
}
return( request );
}
);
return( interceptedResponse );
};
return( interceptor );
};
var httpInterceptorForHttpActivityTracking = function( httpActivityService ) {
var interceptor = function( request ) {
request.then(
function( httpResponse ) {
var isPostRequest = (httpResponse.config.method !== "GET");
var isBlacklisted = (httpResponse.config.data && ("X-Do-Not-Track-As-Post" in httpResponse.config.data));
var trackAsPost = (isPostRequest && !isBlacklisted);
httpActivityService.requestCompleted( trackAsPost );
},
function( httpResponse ) {
var isPostRequest = (httpResponse.config.method !== "GET");
var isBlacklisted = (httpResponse.config.data && ("X-Do-Not-Track-As-Post" in httpResponse.config.data));
var trackAsPost = (isPostRequest && !isBlacklisted);
httpActivityService.requestCompleted( trackAsPost );
}
);
return( request );
};
return( interceptor );
};
$httpProvider.responseInterceptors.push( httpInterceptorFor401Response );
$httpProvider.responseInterceptors.push( httpInterceptorForHttpActivityTracking );
}
);
app.provider(
"$exceptionHandler",
{
$get: function( errorLogService ) {
return( errorLogService.exceptionHandler );
}
}
);
app.run(
function( $http, httpActivityService, $window ) {
function startInterceptor( data, getHeaders ) {
var isPostRequest = ("Content-Type" in getHeaders());
var isBlacklisted = (ng.isString( data ) && (data.indexOf( "X-Do-Not-Track-As-Post" ) !== -1));
var trackAsPost = (isPostRequest && !isBlacklisted);
httpActivityService.requestStarted( trackAsPost );
return( data );
}
function addTimezoneOffsetHeader( data, getHeaders ) {
var headers = getHeaders();
var now = new Date();
if ( now.getTimezoneOffset ) {
headers[ "X-Timezone-Offset" ] = -now.getTimezoneOffset();
}
return( data );
}
function addLoadedAtHeader( data, getHeaders ) {
var headers = getHeaders();
headers[ "X-Page-Loaded-At" ] = addLoadedAtHeader.loadedAt;
return( data );
}
addLoadedAtHeader.loadedAt = ( new Date() ).getTime();
function addReferrerHeader( data, getHeaders ) {
var headers = getHeaders();
headers[ "X-Referrer-Hash" ] = $window.location.hash;
return( data );
}
$http.defaults.transformRequest.push( startInterceptor );
$http.defaults.transformRequest.push( addTimezoneOffsetHeader );
$http.defaults.transformRequest.push( addLoadedAtHeader );
$http.defaults.transformRequest.push( addReferrerHeader );
}
);
})( angular, InVision );
;
;
/*! empty.js */ 
;
;

;
;
/*! cmd-enter.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invCmdEnter", CmdEnterDirective );
function CmdEnterDirective() {
return({
link: link,
restrict: "A"
});
function link( scope, element, attributes ) {
element.on(
"keydown",
function handleKeyEvent( event ) {
if ( ( event.which === 13 ) && event.metaKey ) {
event.preventDefault();
scope.$apply(
function changeViewModel() {
scope.$eval(
attributes.invCmdEnter,
{
$event: event
}
);
}
);
}
}
);
}
}
})( angular, InVision );
;
;
/*! emit-repeat-finish.js */ 
;
;
/**
* Gives ng-repeats the ability to emit that it has finished its rendering ( can trigger multiple times )
* Usage: <div ng-repeat="item in items" on-repeat-finish="projectListRepeatComplete"></div>
*/
angular.module("InVision")
.directive("emitRepeatFinish", function($timeout) {
return {
restrict: "A",
link: function(scope, element, attr) {
if ( scope.$last ) {
$timeout(function () {
scope.$emit(attr.emitRepeatFinish ? attr.emitRepeatFinish : 'ngRepeatFinished');
});
}
}
};
});
;
;
/*! global-uploader.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invGlobalUploader", Directive );
var uploader;
var screenSourceIntroPref = {
isLoaded: false,
showScreenSourceModal: true
};
var retinaNotice = {
isActive: false,
beenSeen: false
};
var isMissingFileExtension = function( filename ) {
var extensionPattern = /\.[^.]+$/i;
return( ! extensionPattern.test( filename ) );
};
var isNotUploading = function() {
return( uploader.state === plupload.STOPPED );
};
var isPDF = function( name ) {
var pattern = /\.(pdf)$/i;
return(
pattern.test( name )
);
};
var isSourceFile = function( name ) {
var pattern = /\.(psd|ai|sketch)$/i;
return(
pattern.test( name )
);
};
var isLayerExtractionFile = function( name ) {
var pattern = /\.(psd|ai|sketch|pdf)$/i;
return(
pattern.test( name )
);
};
var isValidFilename = function( name ) {
var pattern = /\.(gif|jpe?g|png|pdf|psd|ai|sketch)$/i;
return(
pattern.test( name )
);
};
var isImage = function( name ) {
var pattern = /\.(gif|jpe?g|png)$/i;
return (
pattern.test( name )
);
};
var getFileExtension = function( name ) {
return name.split(".").pop();
}
/** @ngInject */
function Directive( $rootScope, $timeout, screenService, sessionService, userPreferenceService, modelEvents, _, errorLogService, boardService, utilityService, analyticsService, config, clientEvents ) {
var maxInBytes = 10485760;
var _projectID;
var _uploadType = "screen";
var _uploadSource = ""; // helps track where the image was being uploaded from within the app.
var _screenType = "";
var _boardID;
var _boardGroupID;
var addingFiles = false;
var _internalQueue = [];
var _skipQueueChangedEvent = false;
var link = function(scope, element){
$rootScope.globalUploadInfo = {
upload: {
files: [],
statusText: ''
},
sync: {
files: [],
processed: [],
statusText: ''
}
};
element.find('body').append('<button id="globalPluploadButton"></button>');
var uploadButton = $('#globalPluploadButton');
uploader = new plupload.Uploader({
runtimes: "html5",
url: "/api/screens",
multipart: false,
method: 'put',
max_retries: 3,
browse_button: "globalPluploadButton",
headers: {}
});
if ( config.featureFlags["encryption-at-rest"] ) {
uploader.settings.headers["x-amz-server-side-encryption"] = "AES256";
}
uploader.bind( "BeforeUpload", handleBeforeUpload );
uploader.bind( "QueueChanged", handleQueueChanged );
uploader.bind( "FilesAdded", handleFilesAdded );
uploader.bind( "FileUploaded", handleFileUploaded);
uploader.bind( "UploadComplete", handleUploadComplete);
uploader.bind( "Error", handleError );
uploader.bind( "UploadProgress", handleUploadProgress);
uploader.init();
scope.$on('globalUploadBrowse', function(e, projectID){
_uploadType = 'screen';
_projectID = projectID;
_screenType = '';
uploadButton.trigger('click');
});
scope.$on('globalUploadBoardsBrowse', function(e, boardID, boardGroupID) {
_uploadType = 'boardItem';
_boardID = boardID;
_boardGroupID = boardGroupID;
uploadButton.trigger('click');
});
scope.$on('globalUploadBoardHeaderBrowse', function(e, boardID) {
_uploadType = 'boardPhotoHeader';
_boardID = boardID;
uploadButton.trigger('click');
});
scope.$on('globalUploadLoadingScreen', function(e, projectID){
_uploadType = "screen";
_projectID = projectID;
_screenType = "LoadingScreen";
uploadButton.trigger("click");
});
scope.$on('globalUploadPlaceholderScreen', function(e, file, suggestedSort, dividerID, projectID, workflowStatusID){
_uploadType = "screen";
_projectID = projectID;
var filesToAdd = [];
var file = new plupload.File(new mOxie.File(null, file), file.name);
file.getSource().suggestedSort = suggestedSort;
file.getSource().dividerID = dividerID;
file.getSource().projectID = projectID;
file.getSource().isPlaceholder = 1;
file.getSource().workflowStatusID = workflowStatusID || 0;
file.getSource().forceCreate = 1;
filesToAdd.push( file );
setTimeout(function() {
uploader.trigger( "FilesAdded", filesToAdd );
}, 1);
});
scope.$on("globalUploadAddScreens", function(e, files, suggestedSort, dividerID, projectID) {
_uploadType = "screen";
_uploadSource = "screens_tab";
_projectID = projectID;
var filesToAdd = [];
for ( var i = ( files.length - 1 ) ; i >= 0 ; i-- ) {
var file = new plupload.File(new mOxie.File(null, files[i]), files[i].name);
file.getSource().suggestedSort = suggestedSort;
file.getSource().dividerID = dividerID;
file.getSource().projectID = projectID;
filesToAdd.push(file);
}
filesToAdd = _.sortOnPropertyUsingNaturalOrder( filesToAdd, "name" );
if(filesToAdd.length) {
setTimeout(function() {
uploader.trigger( "FilesAdded", filesToAdd );
}, 1);
}
});
scope.$on('globalUploadReplaceScreen', function(e, file, screenID, projectID, isPlaceholder){
_uploadType = 'screen';
_projectID = projectID;
var filesToAdd = [];
var file = new plupload.File(new mOxie.File(null, file));
file.getSource().screenID = screenID;
file.getSource().projectID = projectID;
file.getSource().isPlaceholder = isPlaceholder || 0;
filesToAdd.push( file );
setTimeout(function(){
uploader.trigger( 'FilesAdded', filesToAdd );
},1);
});
scope.$on('globalUploadAddBoardItems', function(e, files, suggestedSort, boardGroupID, boardID){
_uploadType = 'boardItem';
_boardID = boardID;
var filesToAdd = [];
for ( var i = ( files.length - 1 ) ; i >= 0 ; i-- ){
var file = new plupload.File(new mOxie.File(null, files[i]), files[i].name);
file.getSource().suggestedSort = suggestedSort + i;
file.getSource().boardGroupID = boardGroupID;
file.getSource().boardID = boardID;
filesToAdd.push(file);
}
filesToAdd = _.sortOnPropertyUsingNaturalOrder( filesToAdd, "name" );
if(filesToAdd.length){
setTimeout(function(){
uploader.trigger( 'FilesAdded', filesToAdd );
},1);
}
});
scope.$on('globalUploadAddBoardHeaderImage', function(e, files, boardID){
_uploadType = 'boardPhotoHeader';
_boardID = boardID;
var filesToAdd = [];
for ( var i = ( files.length - 1 ) ; i >= 0 ; i-- ){
var file = new plupload.File(new mOxie.File(null, files[i]));
file.getSource().boardID = boardID;
filesToAdd.push( file );
}
setTimeout(function(){
uploader.trigger( 'FilesAdded', filesToAdd );
},1);
});
$rootScope.globalUploadStatusText = function() {
return $rootScope.globalUploadInfo.upload.statusText + $rootScope.globalUploadInfo.sync.statusText;
};
function validateFiles( files ) {
var filesToAdd = [];
var fileExcludedBasedOnName = null;
var i;
var triggerExtractionWarning = false;
var failedFileExtensions = [];
for ( i = ( files.length - 1 ); i >= 0; i-- ){
var file = files[i];
if (_uploadType !== "boardItem" &&
_uploadType !== "boardPhotoHeader" &&
!config.featureFlags["can-run-server-side-extaction"] &&
isSourceFile(file.name)
) {
failedFileExtensions.push(getFileExtension(file.name))
triggerExtractionWarning = true;
delete files[ i ];
} else if ( ! isValidFilename( file.name ) || utilityService.isHTML( file.name ) ) {
fileExcludedBasedOnName = file.name;
delete files[ i ];
} else if (file.size > maxInBytes && !isPDF(file.name) && !isSourceFile(file.name)) { // limit the max file size, unless it's a PDF or a screen source file
$timeout(function() {
scope.openModalWindow(
"error",
( "The file, \"" + file.name + ",\" is too large. Are you sure that it's not a mislabeled file?" )
);
});
delete files[ i ];
}else{
filesToAdd.unshift(file);
}
}
if( !! fileExcludedBasedOnName ) {
$timeout(function() {
scope.openModalWindow( "error", "The file, \"" + fileExcludedBasedOnName + ",\" was skipped since it doesn't appear to be an image file." );
});
}
if (triggerExtractionWarning) {
$timeout(function() {
if (config.featureFlags["extraction-deprecation-gold-1709-drag-n-drop-ui"]) {
scope.openModalWindow( "onboardingCraftFullScreen", { fileExtensions: failedFileExtensions } );
} else {
scope.openModalWindow( "extractionDeprecated" );
}
});
}
return filesToAdd;
}
function validateBoardFiles( files ) {
var filesToAdd = [];
var fileIsMissingExtension = null;
var i;
for ( i = ( files.length - 1 ); i >= 0; i-- ){
var file = files[i];
if ( isMissingFileExtension( file.name ) ) {
fileIsMissingExtension = file.name;
delete files[ i ];
}else{
filesToAdd.unshift(file);
}
}
if( !! fileIsMissingExtension ) {
$timeout(function() {
scope.openModalWindow( "error", "The file, \"" + fileIsMissingExtension + ",\" was skipped since it doesn't appear to be a valid file." );
});
}
return filesToAdd;
}
function validateBoardHeaderFiles( files ) {
var filesToAdd = [];
if( files.length > 1 ) {
scope.openModalWindow("error", "You can only use a single image as the header.");
} else {
for ( var i = ( files.length - 1 ) ; i >= 0 ; i-- ){
var file = files[i];
if( ! isImage( file.name ) ) {
$timeout(function() {
scope.openModalWindow("error", "Header images must have a .jpg, .png, or .gif extension.");
});
} else {
filesToAdd.push(file);
}
}
}
return filesToAdd;
}
function handleFilesAdded( up, files ){
if ( up.state === plupload.UPLOADING ) {
_internalQueue.push(files);
return;
}
if ( _uploadType === "boardItem" ) {
files = validateBoardFiles(files);
} else if ( _uploadType === "boardPhotoHeader" ) {
files = validateBoardHeaderFiles(files);
} else {
files = validateFiles(files);
}
_removeInvalidFiles(up, files);
if ( files.length === 0 ) {
return;
}
clientEvents.forNamespace("globalUploader")
.trigger("filesAdded", {
type: _uploadType,
source: _uploadSource
}
);
var user = sessionService.user;
scope.$apply(function(){
if(!$rootScope.globalUploadInfo.upload.files.length){
$rootScope.globalUploadInfo.upload.statusText = 'Initializing Upload...';
}
scope.$broadcast('hideUploadOverlay');
});
if (screenSourceIntroPref.showScreenSourceModal && config.featureFlags["can-run-server-side-extaction"]) {
files.every(function(file){
if( isSourceFile(file.name) && _uploadType !== "boardItem" && _uploadType !== "boardPhotoHeader" ){
scope.openModalWindow("screenSource");
return false;
}
});
}
var requestFiles = [];
var tempFiles = [];
var tempScreens = [];
var maintainedSort = -1;
var boardID = 0;
if(_uploadType === "screen"){
var projectID = files[0].getSource().projectID || _projectID;
var isLoadingScreen = false;
if(_screenType === "LoadingScreen"){
if(files.length > 1){
scope.openModalWindow( "error", "You can only select one Loading Screen" );
return;
}else if(isLayerExtractionFile(files[0].name)){
scope.openModalWindow( "error", "You can't use a source file for a Loading Screen" );
return;
}else{
isLoadingScreen = true;
}
}
files.forEach(function(file, index){
tempFiles.push(file);
up.files.splice(_.findIndex(up.files, { id: file.id}), 1);
var dividerID = typeof file.getSource().dividerID === 'undefined' ? -1 : file.getSource().dividerID;
var suggestedSort = file.getSource().suggestedSort || -1;
var screenID = file.getSource().screenID || 0;
var screenTypeID = 1;
var requestFile = {
file: file.name,
uid: file.id,
isPlaceholder: file.getSource().isPlaceholder || 0,
workflowStatusID: file.getSource().workflowStatusID || 0,
forceCreate: file.getSource().forceCreate || 0
};
if(isLoadingScreen){
suggestedSort = 1;
dividerID = 0;
screenTypeID = 3;
requestFile.isLoadingScreen = true;
}
if( suggestedSort !== -1 ){
suggestedSort = suggestedSort + index;
}
if ( !isLayerExtractionFile(file.name) ){
tempScreens.push({
file: file,
user: user,
projectID: projectID,
dividerID: dividerID,
suggestedSort: suggestedSort,
screenID: screenID,
screenTypeID: screenTypeID
});
}
if(screenID){
requestFile.screenid = screenID;
}else{
requestFile.suggestedSort = suggestedSort;
requestFile.dividerID = dividerID;
}
requestFiles.push(requestFile);
});
InvScreens.actions.addTempScreens(tempScreens);
var screensToUpdate = [];
screenService.requestUpload(requestFiles, projectID).then(function(signedFiles){
signedFiles.forEach(function(signedFile, index){
var file = _.find(tempFiles, {id: signedFile.uid});
file.getSource().signedUrl = signedFile.signedurl;
file.getSource().projectID = projectID;
if( !file.getSource().screenID && !isLayerExtractionFile(file.name) ){
screensToUpdate.push({
file: file,
projectID: projectID,
id: signedFile.id,
name: signedFile.name,
sort: signedFile.sort
});
}
if(isLayerExtractionFile(file.name)){
var syncFile = {
name: file.name,
projectID: projectID,
groupID: projectID,
status: "uploading",
screens: 0,
assetID: 0
};
$rootScope.globalUploadInfo.sync.files.push(syncFile);
scope.$broadcast('setShowingUploadingFiles', true);
}
$rootScope.globalUploadInfo.upload.files.push({
projectID: projectID,
name: file.name,
id: signedFile.id || file.getSource().screenID || 0,
percent: 0,
uploaded: false
});
up.files.push(file);
});
InvScreens.actions.updateTempScreens(screensToUpdate);
$timeout(updateGlobalUploadInfo);
tempFiles = requestFiles = null;
up.start();
}, function(){
tempFiles = requestFiles = null;
});
}else if ( _uploadType === "boardItem" ){
var boardGroupID = files[0].getSource().boardGroupID || _boardGroupID;
boardID = files[0].getSource().boardID || _boardID;
if( !! files ) {
files.forEach(function(file, index){
tempFiles.push(file);
up.files.splice(_.findIndex(up.files, { id: file.id}), 1);
var boardItemID = file.getSource().boardItemID || 0;
if(
file.type.indexOf("image/") >= 0 &&
["psd", "sketch", "ai"].indexOf(file.name.split('.').pop().toLowerCase()) === -1
) {
var fileName = file.name;
fileName = fileName.replace(/\.[^/.]+$/, "");
fileName = fileName.replace(/[_-]/g, " ");
fileName = fileName.replace(/\w\S*/g, function( match ) {
return match.charAt(0).toUpperCase() + match.substr(1);
});
file.getSource().title = fileName;
} else {
file.getSource().title = file.name;
}
var title = file.getSource().title;
var sort = file.getSource().suggestedSort || -1;
var requestFile = {
file: file.name,
uid: file.id,
title: title,
sort: sort
};
InvBoards.actions.addTempItem(file, user, boardID, boardGroupID, title, sort);
requestFiles.push(requestFile);
});
}
boardService.requestUpload(requestFiles, boardGroupID).then(function(signedFiles){
signedFiles.forEach(function(signedFile, index){
var file = _.find(tempFiles, {id: signedFile.uid});
file.getSource().signedUrl = signedFile.signedurl;
file.getSource().boardID = boardID;
InvBoards.actions.updateTempItem(file, boardID, signedFile.id);
$rootScope.globalUploadInfo.upload.files.push({
boardID: boardID,
id: signedFile.id || file.getSource().boardItemID || 0,
percent: 0,
name: file.name,
uploaded: false
});
up.files.push(file);
});
$timeout(updateGlobalUploadInfo);
tempFiles = requestFiles = null;
up.start();
}, function(){
tempFiles = requestFiles = null;
});
}else if ( _uploadType === "boardPhotoHeader" ){
requestFiles = [];
tempFiles = [];
boardID = files[0].getSource().boardID || _boardID;
files.forEach(function(file, index){
file.getSource().boardID = boardID;
tempFiles.push(file);
up.files.splice(_.findIndex(up.files, { id: file.id}), 1);
var requestFile = {
file: file.name,
uid: file.id
};
InvBoards.actions.addTempHeader(boardID, file);
requestFiles.push(requestFile);
});
boardService.requestPhotoHeaderUpload(requestFiles[0], boardID).then(function(signedFiles){
signedFiles.forEach(function(signedFile, index){
var file = _.find(tempFiles, {id: signedFile.uid});
file.getSource().signedUrl = signedFile.signedurl;
file.getSource().boardID = boardID;
$rootScope.globalUploadInfo.upload.files.push({
boardID: boardID,
name: file.name,
percent: 0,
uploaded: false
});
up.files.push(file);
});
$timeout(updateGlobalUploadInfo);
tempFiles = requestFiles = null;
up.start();
}, function(){
tempFiles = requestFiles = null;
});
}
_screenType = "";
}
function _removeInvalidFiles(up, files) {
var filesToRemove = [];
up.files.forEach(function(file) {
var validFile = _.find(files, { id: file.id });
if (!validFile) {
filesToRemove.push(file);
};
});
_skipQueueChangedEvent = true;
filesToRemove.forEach(function(file) {
up.removeFile(file); // this will trigger "QueueChanged" event
});
_skipQueueChangedEvent = false;
}
function handleBeforeUpload(up, file ){
up.settings.url = file.getSource().signedUrl;
file.status = plupload.UPLOADING;
up.trigger( "UploadFile", file );
return false;
}
function findUploadingFile(file){
var info;
if(file.getSource().projectID){
info = _.find($rootScope.globalUploadInfo.upload.files,
{'name':file.name, 'projectID': file.getSource().projectID, 'uploaded': false});
}else if(file.getSource().boardID){
info = _.find($rootScope.globalUploadInfo.upload.files,
{'name':file.name, 'boardID': file.getSource().boardID, 'uploaded': false});
}
return info;
}
function handleFileUploaded(up, file){
trackUpload("Success", file);
if(file.getSource().hasOwnProperty('projectID')){
asyncRetinaModalNotificationCheck([file]);
}
$timeout(function(){
var uploadInfo = findUploadingFile(file);
var syncFile = _.find($rootScope.globalUploadInfo.sync.files,
{'name':file.name, 'groupID': file.getSource().projectID, 'status': 'uploading'});
if(uploadInfo){
uploadInfo.uploaded = true;
}
if(syncFile){
syncFile.status = "initializing";
}
updateGlobalUploadInfo();
});
}
function isRetinaImage(img) {
if (img.width >= 2000) {
return true;
}
return false;
}
function readUploadedFiles(files) {
return files.map(function(file) {
return new Promise(function(accept) {
var reader = new FileReader();
reader.onloadend = function() {
accept(reader.result);
};
reader.readAsDataURL(file.getNative());
});
});
}
function loadImageURLs(urls) {
var promises = urls.map(function(src) {
return new Promise(function(accept) {
var img = new Image();
img.onload = function() {
accept(img);
};
img.src = src;
});
});
return Promise.all(promises);
}
function extractDimensions(images) {
return images.some(function(img) {
return isRetinaImage(img);
});
}
function handleRetinaModalOpen(isRetinaScreen) {
if (isRetinaScreen && !retinaNotice.isActive) {
retinaNotice.isActive = true;
$timeout(_.noop)
.then(scope.openModalWindow.bind(this, 'retinaHelper'));
}
}
function asyncRetinaModalNotificationCheck(files) {
retinaNotice.beenSeen = sessionService.user.showretinahelpermodal === '1';
if (!retinaNotice.beenSeen && !retinaNotice.isActive) {
Promise.all(readUploadedFiles(files))
.then(loadImageURLs)
.then(extractDimensions)
.then(handleRetinaModalOpen);
}
}
function handleUploadComplete(){
$timeout(updateGlobalUploadInfo);
if (_internalQueue.length) {
var _files = _internalQueue.shift();
handleFilesAdded(uploader, _files);
}
}
function handleQueueChanged( up ) {
if ( _skipQueueChangedEvent ) {
return;
}
if ( up.files.length && up.state === plupload.STOPPED ) {
up.start();
}
}
function handleUploadProgress( up, file ){
$timeout(function(){
var uploadInfo = findUploadingFile(file);
if(uploadInfo){
uploadInfo.percent = file.percent;
}
});
}
function handleError( up, error ) {
if ( error.file ) {
scope.openModalWindow( "error", "Looks like some of your files did not finish uploading. Please re-upload any files that did not complete." );
}
error.toString = function() {
var data = {
type: "GlobalUploaderError",
code: error.code,
message: error.message,
response: ( error.response || "" ),
responseHeaders: ( error.responseHeaders || "" ),
status: ( error.status || "" )
};
if ( error.file ) {
data.file = {
id: error.file.id,
name: error.file.name,
percent: error.file.percent,
size: error.file.size,
status: error.file.status,
type: error.file.type
};
console.log("error file:", error.file);
trackUpload("Failure", error.file);
} else {
data.file = "Error is not file related.";
}
return( ng.toJson( data ) );
};
errorLogService.exceptionHandler( error );
}
function checkScreenSourceIntro(){
if( !screenSourceIntroPref.isLoaded ){
userPreferenceService.getPreferenceTypeByName( "showScreenSourceIntro", true, "boolean" ).then(
function( typeResponse ) {
userPreferenceService.getUserPreferenceById( typeResponse.data.id ).then(
function( valueResponse ) {
if( valueResponse.exists === "true" && valueResponse.data.value === "0" ){
screenSourceIntroPref.showScreenSourceModal = false;
} else {
screenSourceIntroPref.showScreenSourceModal = true;
}
screenSourceIntroPref.isLoaded = true;
typeResponse = null;
valueResponse = null;
}
);
}
);
}
}
var isListeningToUnload = false;
var unloadMessage = "Closing the window will cancel your current uploads.";
var showUnloadMessage = function (e) {
(e || window.event).returnValue = unloadMessage;
return unloadMessage;
};
function updateGlobalUploadInfo(){
var uploadInfo = $rootScope.globalUploadInfo;
var uploadedCount = _.filter(uploadInfo.upload.files, 'uploaded', true).length;
var syncCompleteCount = _.filter(uploadInfo.sync.files, {'status' : 'complete'}).length;
var syncFailCount = _.filter(uploadInfo.sync.files, {'status' : 'failed'}).length;
if( (syncCompleteCount+syncFailCount) === uploadInfo.sync.files.length){
uploadInfo.sync.statusText = '';
uploadInfo.sync.files = [];
}
if(uploadedCount === uploadInfo.upload.files.length){
uploadInfo.upload.statusText = '';
uploadInfo.upload.files = [];
}
if(uploadInfo.upload.files.length){
uploadInfo.upload.statusText = 'Uploading ' + uploadedCount + ' of  ' + (uploadInfo.upload.files.length).toString() + ' files';
}else if( uploadInfo.sync.files.length ){
uploadInfo.sync.statusText = 'Syncing ' + (syncCompleteCount+1).toString() + ' of  ' + (uploadInfo.sync.files.length).toString() + ' files';
}
if(!uploadInfo.upload.files.length && !uploadInfo.sync.files.length){
scope.$broadcast('setShowingUploadingFiles', false);
}
if (!uploadInfo.upload.files.length) {
window.removeEventListener("beforeunload", showUnloadMessage);
isListeningToUnload = false;
} else if( !isListeningToUnload ) {
window.addEventListener("beforeunload", showUnloadMessage);
isListeningToUnload = true;
}
}
function trackUpload(status, file) {
var fileType = file.name.split(".").pop();
switch ( fileType ) {
case "psd":
analyticsService.track("PSD " + status);
break;
case "sketch":
analyticsService.track("Sketch " + status);
break;
}
if ( _uploadSource === "screens_tab" ) {
analyticsService.track( "Screen.UploadedFrontend",
{
ScreenUploadedStatus: status,
FileType: fileType
}
);
}
}
modelEvents.on('showScreenSourceModalPreferenceUpdated.globalUploader', function(event, pref) {
if ( pref === 0 ){
screenSourceIntroPref.showScreenSourceModal = false;
}
});
modelEvents.on('selectiveSyncFilesUploading.globalUploader', function( event, files, groupID, groupType, props ) {
if ( groupType === "board" ) {
for ( var i=0, length=files.length; i<length; i++ ) {
var id = files[i].entityID;
var sort = -1;
var randomProgress = Math.random() * (64 - 20) + 20;
files[i].id = files[i].entityID;
InvBoards.actions.addTempItem(files[i], props.userID, groupID, props.boardGroupID, files[i].title, sort);
InvBoards.actions.updateTempItem(files[i], groupID, id);
$rootScope.globalUploadInfo.upload.files.push({
name: files[i].name,
uploaded: false,
id: id,
percent: randomProgress,
groupID: groupID,
groupType: groupType,
oauthApp: props.oauthApp
});
}
$timeout(updateGlobalUploadInfo);
} else if (groupType === "project") {
for ( var i=0, length=files.length; i<length; i++ ) {
var objID = files[i].screenID || files[i].entityID;
var id = isLayerExtractionFile(files[i].name) ? 0 : objID;
var randomProgress = Math.random() * (64 - 20) + 20;
$rootScope.globalUploadInfo.upload.files.push({
name: files[i].name,
uploaded: false,
id: id,
percent: randomProgress,
groupID: groupID,
groupType: groupType,
oauthApp: props.oauthApp
});
if(isLayerExtractionFile(files[i].name)){
var syncFile = {
name: files[i].name,
groupID: groupID,
status: "uploading",
screens: 0,
assetID: 0
};
$rootScope.globalUploadInfo.sync.files.push(syncFile);
scope.$broadcast('setShowingUploadingFiles', true);
}
}
$timeout(updateGlobalUploadInfo);
}
});
modelEvents.on( "selectiveSyncFileUploadComplete.globalUploader", function( event, groupID, fileName){
var uploadInfo = _.find($rootScope.globalUploadInfo.upload.files,
{'name': fileName, 'groupID': groupID, 'uploaded': false});
var syncFile = _.find($rootScope.globalUploadInfo.sync.files,
{'name': fileName, 'groupID': groupID, 'status': 'uploading'});
if (uploadInfo) {
uploadInfo.uploaded = true;
if (uploadInfo.groupType === "board" && !!uploadInfo.oauthApp) {
InvBoards.actions.syncBoardItemUploadComplete(uploadInfo.oauthApp);
}
}
if(syncFile){
syncFile.status = "initializing";
}
$timeout(updateGlobalUploadInfo);
});
modelEvents.on('screenSourceUploaded.globalUploader', function( event, screenSource ) {
var clientFilename = screenSource.asset.clientFilename;
var syncFile = _.find($rootScope.globalUploadInfo.sync.files, {'name': clientFilename, 'groupID': screenSource.asset.projectID, 'assetID': 0});
if(syncFile){
syncFile.status = 'processing';
syncFile.assetID = screenSource.asset.id;
syncFile.screens = screenSource.info.screens ? screenSource.info.screens.length : [];
}
$timeout(updateGlobalUploadInfo);
});
modelEvents.on('screenSourceSyncUpdated.globalUploader', function( event, assetID, status, projectID ) {
var uploadingFile = _.find($rootScope.globalUploadInfo.sync.files, {'assetID': assetID, 'groupID': projectID});
if(uploadingFile){
if( status === 'complete' && $rootScope.globalUploadInfo.sync.files.length ){
uploadingFile.status = 'complete';
} else if( status === "failed" || status === "inspected" || status === "cancelled" || status === "killed" ){
uploadingFile.status = 'failed';
}else if(uploadingFile){
uploadingFile.status = 'processing';
}
}
$timeout(updateGlobalUploadInfo);
});
scope.$on('$destroy', function() {
modelEvents.off('showScreenSourceModalPreferenceUpdated.globalUploader');
modelEvents.off('selectiveSyncFilesUploading.globalUploader');
modelEvents.off('screenSourceUploaded.globalUploader');
modelEvents.off('selectiveSyncFileUploadComplete.globalUploader');
modelEvents.off('screenSourceSyncUpdated.globalUploader');
});
checkScreenSourceIntro();
};
return({
link: link,
restrict: "A"
});
}
})( angular, InVision );
;
;
/*! lazier-src.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( 'invLazierContainer', function () {
return {
restrict: 'A',
controller: ['$scope', '$element', function ($scope, $element) {
$element.data('invLazierContainer', $element);
}]
};
});
app.directive( "invLazierSrc", Directive );
/** @ngInject */
function Directive( $window, $document ) {
var win = angular.element( $window );
var container = win;
var lazyLoader = (function() {
var images = [];
var renderTimer = null;
var renderDelay = 200;
var windowHeight = null;
var windowWidth = null;
var isWatchingWindow = false;
function addImage( image ) {
images.push( image );
if ( ! renderTimer ) {
startRenderTimer();
}
if ( ! isWatchingWindow ) {
startWatchingWindow();
}
startWatchingContainer();
}
function checkLayout() {
if ( ! renderTimer ) {
startRenderTimer();
}
if ( ! isWatchingWindow ) {
startWatchingWindow();
}
startWatchingContainer();
}
function removeImage( image ) {
for ( var i = 0, len = images.length ; i < len ; i++ ) {
if ( images[ i ] === image ) {
images.splice( i, 1 );
break;
}
}
if ( ! images.length ) {
clearRenderTimer();
stopWatchingWindow();
}
}
function checkImages() {
var visible = [];
var hidden = [];
if ( windowHeight === null ) {
windowHeight = win.height();
}
if ( windowWidth === null ) {
windowWidth = win.width();
}
var scrollTop = win.scrollTop();
var scrollLeft = win.scrollLeft();
var topFoldOffset = scrollTop;
var bottomFoldOffset = ( topFoldOffset + windowHeight );
var leftFoldOffset = scrollLeft;
var rightFoldOffset = ( leftFoldOffset + windowWidth );
for ( var i = 0 , len = images.length ; i < len ; i++ ) {
var image = images[ i ];
if ( image.isVisible( topFoldOffset, bottomFoldOffset, leftFoldOffset, rightFoldOffset ) ) {
visible.push( image );
} else {
hidden.push( image );
}
}
for ( var i = 0 ; i < visible.length ; i++ ) {
visible[ i ].render();
}
images = hidden;
clearRenderTimer();
if ( ! images.length ) {
stopWatchingWindow();
}
}
function clearRenderTimer() {
clearTimeout( renderTimer );
renderTimer = null;
}
function keyPressed() {
if ( ! renderTimer ) {
startRenderTimer();
}
}
function startRenderTimer() {
renderTimer = setTimeout( checkImages, renderDelay );
}
function startWatchingWindow() {
isWatchingWindow = true;
win.on( "resize.invLazierSrc", windowResized );
$document.on( "keyup.invLazierSrc", keyPressed );
}
function startWatchingContainer() {
if ( ! container.attr('inv-lazier-container-watched') ) {
container.data('invLazierContainerWatched', true);
container.on( "scroll.invLazierSrc", containerScrolled );
}
}
function stopWatchingWindow() {
isWatchingWindow = false;
win.off( "resize.invLazierSrc" );
container.off( "scroll.invLazierSrc" );
$document.off( "keyup.invLazierSrc" );
}
function windowResized() {
windowHeight = win.height();
windowWidth = win.width();
if ( ! renderTimer ) {
startRenderTimer();
}
}
function containerScrolled() {
if ( ! renderTimer ) {
startRenderTimer();
}
}
return({
addImage: addImage,
checkLayout: checkLayout,
removeImage: removeImage
});
})();
function LazyImage( element ) {
this.element = element;
this.offsetElement = this.element;
this.source = null;
this.rendered = false;
this.height = null;
this.width = null;
}
LazyImage.prototype = {
isVisible: function( topFoldOffset, bottomFoldOffset, leftFoldOffset, rightFoldOffset ) {
if ( ! this.offsetElement.is( ":visible" ) ) {
return( false );
}
if ( ! this.height ) {
while ( ! ( this.height = this.offsetElement.height() ) ) {
this.offsetElement = this.offsetElement.parent();
}
this.width = this.offsetElement.width();
}
var top = this.offsetElement.offset().top;
var bottom = ( top + this.height );
var left = this.offsetElement.offset().left;
var right = left + this.width;
return(
(
topFoldOffset 	  <= bottom &&
bottomFoldOffset  >= top    &&
leftFoldOffset	  <= right  &&
rightFoldOffset	  >= left
)
||
(
topFoldOffset 	  >= top 	&&
bottomFoldOffset  <= bottom &&
leftFoldOffset	  >= left  	&&
rightFoldOffset	  <= right
)
);
},
render: function() {
this.rendered = true;
this.renderSource();
},
renderSource: function() {
this.element[ 0 ].src = this.source;
},
setSource: function( newSource ) {
this.source = newSource;
if ( this.rendered ) {
this.renderSource();
}
}
};
function handleIndexChange( newValue, oldValue ) {
if ( newValue === oldValue ) {
return;
}
lazyLoader.checkLayout();
}
function link( $scope, element, attributes ) {
var scrollContainer = element.inheritedData( 'invLazierContainer' );
if ( scrollContainer ) {
container = angular.element( scrollContainer );
}
var lazyImage = new LazyImage( element );
lazyLoader.addImage( lazyImage );
attributes.$observe(
"invLazierSrc",
function( newSource ) {
lazyImage.setSource( newSource );
}
);
if ( "$index" in $scope ) {
$scope.$watch( "$index", handleIndexChange );
}
$scope.$on(
"$destroy",
function() {
lazyLoader.removeImage( lazyImage );
}
);
$scope.$on(
"checkLayout.invLazierSrc",
function() {
lazyLoader.checkLayout();
}
)
}
return({
link: link,
restrict: "A"
});
}
})( angular, InVision );
;
;
/*! lazy-src.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invLazySrc", Directive );
/** @ngInject */
function Directive() {
var pendingTimer = null;
var pending = [];
function dequeueHandler() {
for ( var i = 0, length = pending.length ; i < length ; i++ ) {
pending[ i ]();
}
pendingTimer = null;
pending = [];
}
function queueHandler( handler ) {
pending.push( handler );
if ( ! pendingTimer ) {
pendingTimer = setTimeout( dequeueHandler, 100 );
}
}
function isElementVisible( element ) {
if ( ! element.is( ":visible" ) ) {
return( false );
}
var bottomOfScreen = ( win.height() + win.scrollTop() );
return( element.offset().top < bottomOfScreen );
}
var win = $( window );
var doc = $( document );
var link = function( $scope, element, attributes ) {
function examineImage() {
if ( isElementVisible( element ) ) {
showImage();
stopMonitoring();
}
}
function handleWatchCallback( newValue, oldValue ) {
if ( newValue === oldValue ) {
return;
}
examineImage();
}
function setupMonitoring() {
if ( isElementVisible( element ) ) {
return( showImage() );
}
startMonitoring();
}
function showImage() {
element.prop( "src", src );
isVisible = true;
}
function startMonitoring() {
isMonitoring = true;
win.on( "resize", examineImage );
win.on( "scroll", examineImage );
watchDocumentHeight();
watchLazyExpression();					
}
function stopMonitoring() {
isMonitoring = false;
win.off( "resize", examineImage );
win.off( "scroll", examineImage );
unbindLazyWatch();
unbindDocumentWatch();
}
function watchDocumentHeight() {
unbindDocumentWatch = $scope.$watch(
function() {
return( doc.height() )
},
handleWatchCallback
);
}
function watchLazyExpression() {
if ( ! attributes.lazyWatch ) {
return;
}
unbindLazyWatch = $scope.$watch( attributes.lazyWatch, handleWatchCallback );
}
var src = null;
var isMonitoring = false;
var isVisible = false;
var unbindLazyWatch = ng.noop;
var unbindDocumentWatch = ng.noop;
attributes.$observe( 
"invLazySrc",
function( interpolatedSource ) {
src = interpolatedSource;
if ( isVisible ) {
return( showImage() );
}
if ( isMonitoring ) {
return;
}
queueHandler( setupMonitoring );
}
);
$scope.$on(
"$destroy",
function() {
win.off( "resize", examineImage );
win.off( "scroll", examineImage );
}
);
};
return({
link: link,
restrict: "A"
});
}
})( angular, InVision );
;
;
/*! loading.js */ 
;
;
/**
* Loading directive to display loading animation.
* Usage: <span loading="isLoading"></span>
*/
angular.module("InVision")
.directive("loading", function() {
var ua = window.navigator.userAgent;
var msie = ua.indexOf("MSIE ");
var template;
if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
template = "<div class=\"dots\"><div class=\"bounce1\"></div><div class=\"bounce2\"></div><div class=\"bounce3\"></div></div>";
} else {
template = "<div class=\"loader\"><svg class=\"circular\"><circle class=\"path\" cx=\"32\" cy=\"32\" r=\"30\" fill=\"none\" stroke-width=\"4\"></svg></div>";
}
return {
restrict: "AE",
replace: true,
template: "<div class=\"loading-directive\" ng-show=\"isLoading\">" + template + "</div>",
scope: {
isLoading: "=loading"
}
};
});
;
;
/*! mobile-transition-layer.js */ 
;
;
(function(ng, app) {
var _DEBUG_ = _DEBUG_ || false;
var _STANDALONE_ = window._STANDALONE_ || false;
app
.directive('invMobileTransitionLayer', Directive);
/** @ngInject */
function Directive($timeout, $log, _, transitionsService, config, screenService, autoImagePreloader) {
var vm = {};
return {
link:        linkFunction,
restrict:    'A',
templateUrl: '/assets/apps/common/views/directives' +
'/mobile-transition-layer.htm'
};
function linkFunction($scope, element) {
var
$element       = ng.element(element),
$wrapper       = $element.find('.inner2'),
$fixedElements = {
curr: [],
targ: []
},
$curr,
$targ;
var userAgent = window.navigator.userAgent.toLowerCase();
var transitionFeatureFlag = $scope.transitionFeatureFlag || false;
vm.initalised  = false;
vm.isPreparing = false;
vm.isPlaying   = false;
vm.isUpdating  = false;
vm.transitionTypes = {
2:  'slide-right',
3:  'slide-left',
4:  'slide-up',
5:  'slide-down',
6:  'flip-right',
7:  'flip-left',
8:  'dissolve',
9:  'flow',
10: 'pop',
11: 'push-right',
12: 'push-left',
13: 'slide-fade'
};
vm.specialTransitions = [2, 3, 11, 12];
$scope.Math = Math;
$scope.getBackgroundColor = getBackgroundColor;
$scope.screenInHotspot    = screenInHotspot;
$scope.transitionScreen   = screenService.getCurrentScreen();
$scope.transitionScreens  = [];
$scope.pushDownFixedHeader = $scope.isAndroid ? ( $scope.statusBarPushDown || 0 ) : 0;
if (isChrome46()) {
$scope.chromeClass = "mobile-hover-chrome";
}
$scope.addStatusBarHeight =
( ($scope.config && $scope.config.mobileStatusbarIsOpaque) || (config && config.project && config.project.mobileStatusbarIsOpaque) )
&& $scope.isInAppMode
&& !vm.isAndroid ? true : false;
$scope.$on('mobile:transition:prepare', prepareTransitions);
$scope.$on('mobile:transition:run', doTransition);
$scope.$on('mobile:transition:updateCurrent', updateCurrentScreen);
$scope.$on('mobile:transition:init', initTransitionScreens);
if (!$scope.isMobileShare) {
initTransitionScreens({}, true);
}
function updateCurrentScreen(event, cb) {
if (_DEBUG_) $log.info('invMobileTransitionLayer.updateCurrentScreen');
if (vm.isUpdating) return false;
vm.isUpdating = true;
$scope.transitionScreen = screenService.getScreenClickedOn();
if (cb) {
return $timeout(cb)
.then(function () {
vm.isUpdating = false;
});
}
vm.isUpdating = false;
return false;
}
function initTransitionScreens(event, update) {
if (_DEBUG_) $log.info('invMobileTransitionLayer.initTransitionScreens');
if (!transitionFeatureFlag) {
if (_.isFunction(screenService.getScreens)) {
$scope.transitionScreens = screenService.getScreens();
}
if ( $scope.screens && $scope.screens.length ) {
$scope.transitionScreens = $scope.screens;
} else if (!$scope.isMobileShare && !$scope.transitionScreens.length ) {
$scope.transitionScreens = augmentScreens($scope.screens);
}
$scope.transitionScreens = augmentScreens($scope.transitionScreens);
}
return $timeout(function () {
$scope.$emit('mobile:transition:ready');
if (update) {
updateCurrentScreen()
}
});
}
function screenInHotspot(id) {
return _.some($scope.transitionScreen.hotspots, {targetScreenID: id});
}
function getBackgroundColor(screen) {
if (_.isEmpty(screen)) return;
var color = screen.backgroundColor;
if (!color) {
color = screen.extended.fixedFooterBackground;
}
return color.length === 6 ? '#' + color : color;
}
function prepareTransitions() {
if (_DEBUG_) $log.info('invMobileTransitionLayer.prepareTransitions');
if (vm.isPreparing) return false;
vm.isPreparing = true;
var data              = $scope.transitionData;
var current           = data.currentScreen;
var target            = data.targetScreen;
var maintainScrollPos = data.maintainScrollPosition || false;
var transitionName    = vm.transitionTypes[data.transitionTypeID];
if (transitionFeatureFlag) {
$scope.$apply(function() {
$scope.currentScreen = current;
$scope.targetScreen = target;
});
$curr = element.find("#current-screen");
$targ = element.find("#next-screen");
} else {
$curr = element.find("#transition-picture-" + current.id);
$targ = element.find("#transition-picture-" + target.id);
}
$element.addClass('will-transition');
if ( current.fixedHeaderHeight
&& current.fixedHeaderHeight === target.fixedHeaderHeight
&& _.contains(vm.specialTransitions, data.transitionTypeID) ) {
$curr.addClass('equal-height-header');
$targ.addClass('equal-height-header');
ripOutFixedElements('.fixed-header');
}
if ( current.fixedFooterHeight
&& current.fixedFooterHeight === target.fixedFooterHeight
&& _.contains(vm.specialTransitions, data.transitionTypeID) ) {
$curr.addClass('equal-height-footer');
$targ.addClass('equal-height-footer');
ripOutFixedElements('.fixed-footer');
}
var scrollPos = -(data.scrollPosition);
$curr.find('img:first').css({
marginTop: scrollPos
});
$targ.find('img:first').css({
marginTop: maintainScrollPos ? scrollPos : 0
});
transitionsService.configure(
$curr,
$targ,
$wrapper,
$fixedElements
);
var mobileDeviceID = $scope.config ? $scope.config.mobileDeviceID : null;
var mobileTemplate = _.filter(config.mobileDevices, { mobileDeviceID: mobileDeviceID })[0];
if (mobileTemplate && mobileTemplate.mobileSkin === "iPhoneX") {
var mobileStatusbarIsOpaque =
($scope.config && $scope.config.mobileStatusbarIsOpaque) ||
(config && config.project && config.project.mobileStatusbarIsOpaque);
var mobileStatusbarIsVisible =
($scope.config && $scope.config.mobileStatusbarIsVisible) ||
(config && config.project && config.project.mobileStatusbarIsVisible);
var borderRadiusStyle =
mobileStatusbarIsOpaque && mobileStatusbarIsVisible
? "0 0 40px 40px"
: "40px";
$element.css("border-radius", borderRadiusStyle);
}
$element.addClass(transitionName);
transitionsService[transitionName]();
}
function doTransition() {
if (_DEBUG_) $log.info('invMobileTransitionLayer.doTransition');
if (vm.isPlaying) return false;
vm.isPlaying = true;
$element.addClass('is-transitioning');
transitionsService.play(animationOverCallback);
}
function ripOutFixedElements(elementClass) {
if (_DEBUG_) $log.info('ripOutFixedElements');
var $ripCurr = $curr.find(elementClass).clone();
var $ripTarg = $targ.find(elementClass).clone();
$ripCurr.addClass('current');
$ripTarg.addClass('target');
$element.append($ripCurr);
$element.append($ripTarg);
$fixedElements.curr.push($ripCurr);
$fixedElements.targ.push($ripTarg);
}
function animationOverCallback() {
if (_DEBUG_) $log.info('animationOverCallback');
var nodes;
var id            = $scope.transitionData.transitionTypeID;
var removeClasses = [
vm.transitionTypes[id],
'is-transitioning',
'will-transition'
].join(' ');
var cleanupClasses = [
'equal-height-header',
'equal-height-footer'
].join(' ');
$targ.removeClass(cleanupClasses);
$curr.removeClass(cleanupClasses);
$element.removeClass(removeClasses);
vm.isPreparing = false;
vm.isPlaying = false;
if (transitionFeatureFlag) {
$scope.$apply(function() {
$scope.currentScreen = null;
$scope.targetScreen = null;
});
}
if ($fixedElements.curr.length) {
nodes = $fixedElements.curr.concat($fixedElements.targ);
_.forEach(nodes, function(node) {
node.remove();
});
$fixedElements.curr = [];
$fixedElements.targ = [];
}
return $scope.setIsTransitioning(false);
}
function augmentScreens(screens) {
return _.map(screens, function addDisplayScale(screen) {
if ( !$scope.isMobileShare ) {
return screen;
}
if (screen.displayScale) {
return screen;
} else {
screen.displayScale = (+($scope.deviceTemplate.viewportWidth) / screen.width);
}
return screen;
});
}
function isChrome46() {
var version = navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);
var platform = navigator.platform;
return platform === "MacIntel" && !!version && parseInt(version[2], 10) === 46;
}
$scope.getImageUrl = function( url ) {
return autoImagePreloader.previous( url ) || url;
};
}
}
})(angular, InVision);
;
;
/*! modal.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invModal", Directive );
/** @ngInject */
function Directive( $timeout, $document, $window, modalWindowRequest, emojiService ) {
var linkFunction = function( $scope, element, attributes ) {
var $element = $(element);
var $win = $(window);
var isClosedByPlugin = true;
var modalType = ( attributes.invModalType || "top" );
var settings = {
keyboard: false,
backdrop: "static"
};
var isOpen = false;
var isTrueModal = ( attributes.invTrueModal || false );
if ( modalWindowRequest.isSuppressFade() && $element.is( ".animate" ) ) {
$element.removeClass( "animate" );
$element.on(
"shown.invModal",
function() {
$timeout(function() {
$element.addClass( "animate" );
}, 150);
}
);
}
$element
.addClass("modal")
.modal(settings);
var $backdrop = $(".modal-backdrop");
$backdrop
.addClass("animate-in " + $element.attr("id") );
setModalPosition();
function forcePositive(number) {
return number < 0 ? 0 : number;
}
function setModalPosition() {
$timeout(function() {
if (!$win || !$element) {
return;
}
var newCSS = {
top: $win.scrollTop(),
left: $win.scrollLeft(),
marginLeft: forcePositive( Math.round( ( $win.outerWidth() - $element.outerWidth() ) / 2 ) ),
marginTop: forcePositive( Math.round( ( $win.outerHeight() - $element.outerHeight() ) / 2 ) )
};
$element
.css(newCSS)
.attr( "tabindex", -1 )
.addClass("animate-in");
if (isOpen) {
$element.addClass("open");
$scope.$emit("modal.isWindowOpen", true);
if ( $window.InvScreens ) {
$window.InvScreens.screensStore.setIsModalOpen(true);
}
}
$('.invisible-modal-padding-fix').css('height', 1000);
isOpen = true;
});
}
$element.on(
"hidden.invModal",
function() {
$scope.$emit( "modalWindowHidden" );
$scope.$emit("modal.isWindowOpen", false);
if ( $window.InvScreens ) {
$window.InvScreens.screensStore.setIsModalOpen(false);
}
$('.invisible-modal-padding-fix').css('height', 0);
$timeout( ng.noop );
}
);
$element.on(
"shown.invModal",
function() {
if ( modalType !== "top" ) {
return;
}
setModalPosition();
}
);
$win.on("resize.invModal", setModalPosition);
$win.on("hashchange.invModal", function() {
if ( isTrueModal ) {
return;
}
$scope.closeModalWindow();
});
$document
.on("keyup.invModal", function( event ) {
if ( isTrueModal ) {
return;
}
var keyCode = event.which || event.keyCode;
if ( keyCode === 27 ) {
$scope.closeModalWindow();
}
});
$backdrop
.on("click.invModal", function(e) {
e.preventDefault();
if ( isTrueModal ) {
return;
}
$scope.closeModalWindow();
});
$scope.$on("resizeModal", setModalPosition);
$scope.$on(
"closeModalWindowWithoutFade",
function() {
$scope.closeModalWindow( true );
}
);
$scope.$on(
"$destroy",
function() {
$win.off("resize.invModal");
$win.off("hashchange.invModal");
$element.off( "hide.invModal" );
$element.off( "hidden.invModal" );
$element.off( "shown.invModal" );
$element.removeClass("animate-in");
$element.removeClass("animate-out");
$document.off("keyup.invModal");
$backdrop.off("click.invModal");
$scope = element = attributes = $element = $win = null;
}
);
$scope.closeModalWindow = function( suppressFade ) {
if ( emojiService && emojiService.isPopoverActiveOnModal() ) {
emojiService.setPopoverOnModal( false );
return;
}
if ( emojiService && emojiService.isTypeaheadActiveOnModal() ) {
emojiService.setTypeaheadOnModal( false );
return;
}
isClosedByPlugin = false;
if ( suppressFade ) {
$(".modal-backdrop").removeClass("animate-in");
$element.modal("hide");
} else {
$element.addClass("animate-out");
$(".modal-backdrop").removeClass("animate-in");
$timeout(function closeModal() {
if ($element) {
$element.modal("hide");
}
}, 200);
}
};
};
return({
link: linkFunction,
restrict: "A"
});
}
})( angular, InVision );
;
;
/*! overlay-screen.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive(
"invOverlayScreen",
/** @ngInject */
function( $timeout, _ ) {
var linkFunction = function( $scope, element ) {
console.log("invOverlayScreen");
};
return({
link: linkFunction,
restrict: "A"
});
}
);
})( angular, InVision );
;
;
/*! react-component.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invReactComponent", Directive );
/** @ngInject */
function Directive() {
var linkFunction = function( scope, element ) {
var remount = function(){
ReactDOM.unmountComponentAtNode(element[0]);
ReactDOM.render(
React.createFactory(scope.reactComponent)(scope.reactProps),
element[0],
function() {
if ( scope.reactRootRenderedMethod ) {
scope.reactRootRenderedMethod();
}
}
);
};
scope.$watch('reactRemount', function() {
remount();
});
scope.$on('$destroy', function() {
ReactDOM.unmountComponentAtNode(element[0]);
});
};
return({
restrict: 'E',
link: linkFunction,
scope: {
reactComponent: '=',
reactProps: '=',
reactRootRenderedMethod: '=',
reactRemount: '='
}
});
}
})( angular, InVision );
;
;
/*! tail-source.js */ 
;
;
(function( ng, app ) {
var CSS_ACTIVE_CLASS = 'connection-active';
"use strict";
app.directive( "invTailSource", Directive );
/** @ngInject */
function Directive( $, _, $parse ) {
var controllerFunction = function( $scope, $element, $attrs ) {
function invoke( action, args ) {
$scope.$eval( action, args );
}
var source = {
element : $element,
handler : { },
type : $.trim( $attrs.invTailSource ),
data : $parse( $attrs.invTailSourceData )( $scope )
};
_.assign( source.handler, {
handleSetConnection: function( event ) {
if ( event.side === source.connectedOnSide ) return;
source.connectedOnSide = event.side;
$element.removeClass('tail-connected tail-connected-left tail-connected-right tail-connected-top tail-connected-bottom');
if ( event.connected ) {
$element.addClass( 'tail-connected tail-connected-'+ event.side );
invoke( $attrs.invOnConnectionSet, { event: event, source: source });
}
else invoke( $attrs.invOnConnectionUnset, { event: event, source: source });
},
handleDeactivate : function( event ) {
$element.removeClass( CSS_ACTIVE_CLASS );
invoke( $attrs.invOnConnectionDeactivate, { event: event, source: source });
},
handleCancel : function( event ) {
invoke( $attrs.invOnConnectionCancel, { event: event, source: source });
},
handleConnect : function( event, targets ) {
invoke( $attrs.invOnConnection, { event: event, source: source, targets: targets });
},
handleFlash : function( event ) {
invoke( $attrs.invOnConnectionFlash, { event: event, source: source });
}
});
$scope.$on('tailConnector:activate:source', function( event, register ) {
$element.addClass( CSS_ACTIVE_CLASS );
register( source );
invoke( $attrs.invOnConnectionActivate, { event: event, source: source });
});
};
return({
link     : controllerFunction,
restrict : "A"
});
}
})( angular, InVision );
;
;
/*! tail-target.js */ 
;
;
(function( ng, app ) {
var CSS_ACTIVE_CLASS = 'connection-active'
, CSS_HOVER_CLASS = 'connection-hover';
"use strict";
app.directive( "invTailTarget", Directive );
/** @ngInject */
function Directive( $, _, $parse, $interpolate ) {
var controllerFunction = function( $scope, $element, $attrs ) {
function invoke( action, args ) {
$scope.$eval( action, args );
}
var target = {
context : $scope.$parent,
element : $element,
focusable : !$element.is('[inv-tail-no-focus]'),
handler : { },
is : { }
};
target.data = $parse( $attrs.invTailTargetData )( $scope );
var types = $interpolate( $attrs.invTailTarget || '' )( target.context ).split(',');
target.types = _( types ).map( $.trim ).filter().value();
_.each( target.types, function( type ) { 
target.is[ type ] = true;
});
_.assign( target.handler, {
handleSetConnection: function( event ) {
if ( event.side === target.connectedOnSide ) return;
target.connectedOnSide = event.side;
$element.removeClass('tail-connected tail-connected-left tail-connected-right tail-connected-top tail-connected-bottom');
if ( event.connected ) {
$element.addClass( 'tail-connected tail-connected-'+ event.side );
invoke( $attrs.invOnConnectionSet, event, target );
}
else invoke( $attrs.invOnConnectionUnset, event, target );
},
handleDeactivate: function( event ) {
$element.removeClass( CSS_ACTIVE_CLASS ).removeClass( CSS_HOVER_CLASS );
invoke( $attrs.invOnConnectionDeactivate, { event: event, target: target });
},
handleCancel: function( event ) {
invoke( $attrs.invOnConnectionCancel, { event: event, target: target });
},
handleConnect: function( event, source ) {
invoke( $attrs.invOnConnection, { event: event, source: source, target: target });
},
handleMouseEnter: function( event, source ) { 
invoke( $attrs.invOnConnectionEnter, { event: event, target: target, source: source });
if ( event.cancel !== true ) $element.addClass( CSS_HOVER_CLASS );
},
handleMouseLeave: function( event, source ) { 
invoke( $attrs.invOnConnectionLeave, { event: event, target: target, source: source });
if ( event.cancel !== true ) $element.removeClass( CSS_HOVER_CLASS );
}
});
$scope.$on('tailConnector:activate:target', function( event, register ) {
invoke( $attrs.invOnConnectionActivate, { event: event, target: target });
if ( event.cancel === true ) return;
$element.addClass( CSS_ACTIVE_CLASS );
register( target );
});
};
return({
controller : controllerFunction,
restrict   : "A"
});
}
})( angular, InVision );
;
;
/*! tooltip.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invTooltip", Directive );
/** @ngInject */
function Directive( $ ) {
function escapeHtml( str ){
var safeContent = String( str )
.replace( /&/g, "&amp;" )
.replace( /"/g, "&quot;" )
.replace( /'/g, "&apos;" )
.replace( /</g, "&lt;" )
.replace( />/g, "&gt;" )
;
safeContent = safeContent
.replace( /&lt;(br)\s*\/?&gt;/ig, "<$1 />" )
.replace( /&lt;(\/)?(strong|em)&gt;/ig, "<$1$2>" )
;
return( safeContent );
}
function handleMouseEnter( event ) {
$.data( this, "isShowing", true );
}
function handleMouseLeave( event ) {
$.data( this, "isShowing", false );
}
function link( $scope, element, attributes ) {
function tryToKillTooltip () {
if ( tooltipInstance ) {
tooltipInstance.show = ng.noop;
if ( tooltipInstance.$tip ) {
tooltipInstance.$tip.remove();
}
}
element.tooltip( "destroy" );
}
function getOptions() {
return {
placement: function() {
return( element.attr("placement") || "top" );
},
delay: 100,
title: function() {
return( escapeHtml( attributes.invTooltip ) );
},
template: '<div class="tooltip ' +
(attributes.tooltipWidth === 'content' ? 'content-width' : styleClass) +
'"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'
};
}
var tooltipInstance = null;
var styleClass = ( attributes.tooltipstyleclass || "" );
element
.on( "mouseenter", handleMouseEnter )
.on( "mouseleave", handleMouseLeave )
;
attributes.$observe(
"invTooltip",
function handleTooltipChange( newValue ) {
if ( element.data('isShowing') ) {
if ( newValue.length > 0 ) {
tooltipInstance.show();
} else {
tooltipInstance.hide();
}
}
}
);
attributes.$observe(
"dynamicclass",
function handleTooltipChange( newValue, oldValue ) {
if ( element.data('isShowing') ) {
if ( oldValue ) {
tooltipInstance.$tip.removeClass(oldValue);
}
tooltipInstance.$tip.addClass(newValue);
tooltipInstance.show();
}
}
);
attributes.$observe(
"tooltipDisabled",
function handleTooltipDisabledChange( newValue ) {
newValue = ( newValue || "false" );
var isEnabled = ( newValue === "false" );
if ( isEnabled ) {
var tooltipOptions = getOptions();
element.tooltip( tooltipOptions );
tooltipInstance = element.data( "tooltip" );
} else {
tryToKillTooltip();
}
}
);
$scope.$on(
"$destroy",
function handleDestroyEvent() {
tryToKillTooltip();
$scope = element = attributes = tooltipInstance = styleClass = null;
tryToKillTooltip = getOptions = null;
}
);
}
return({
link: link,
restrict: "A"
});
}
})( angular, InVision );
;
;
/*! analytics-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "analyticsService", Service );
/** @ngInject */
function Service( $window, $timeout, moment, config, errorLogService ) {
function identifyUser( user, currentSubscription ) {
if ( !$window.analytics || !config || !user || !currentSubscription ) {
return;
}
var nameSplit = splitName( user.name );
var traits = {
bucket: user.bucketID,
createdAt: moment(user.userCreatedAt).unix(),
name: user.name,
firstname: nameSplit.firstname,
lastname: nameSplit.lastname,
email: user.email,
referring_source: user.source,
plan_name: currentSubscription.name,
lifecyclestage: translateSubscriptionToLifecycleStage( currentSubscription ),
subscriptionexpiresat: currentSubscription.expiresAt,
lastKnownIPAddress: user.lastKnownIpAddress,
"feature_inspect-v-1": config.featureFlags["inspect-v-1"],
"feature_inspect-v-3": config.featureFlags["inspect-v3"],
"feature_inspect-v-3-enterprise": config.featureFlags["inspect-v3-enterprise"],
"feature_inspect-asset-manager": config.featureFlags["inspect-assetManager"],
isSingleTenant: config.singleTenantConfig.useSingleTenantAnalytics,
customer_status: config.isCustomer ? "Existing Customer" : "Potential Customer",
screenUploadedCount: user.screenUploadedCount
};
var momentDate = moment( currentSubscription.projectGracePeriodEndsAt );
if ( momentDate.isValid() ) {
traits.gracePeriodEndsAt = momentDate.toJSON();
}
if ( user.companyInfo && user.companyInfo.subdomain !== "" ) {
traits.usagedataid = user.companyInfo.subdomain;
}
if ( user.companyInfo && typeof user.companyInfo.sfdcAccountID !== "undefined" &&
user.companyInfo.sfdcAccountID !== "" &&
user.companyInfo.sfdcAccountID !== "#N/A"
){
traits.sfdcaccountid = user.companyInfo.sfdcAccountID;
}
if ( typeof user.companyMembership !== "undefined" &&
typeof user.companyMembership.roleName !== "undefined" &&
user.companyMembership.roleName !== ""
){
traits.enterprise_role = user.companyMembership.roleName;
}
if ( typeof user.companyMembership !== "undefined" &&
typeof user.companyMembership.companyID !== "undefined" &&
user.companyInfo.companyID > 0
){
if (
typeof user.companyInfo !== "undefined" &&
typeof user.companyInfo.providers !== "undefined" &&
Array.isArray( user.companyInfo.providers ) &&
user.companyInfo.providers.length > 0
){
traits.sso = true;
} else {
traits.sso = false;
}
}
traits.derived_plan = currentSubscription.name;
if (user.hasCompanyMembership) {
if (user.companyInfo && user.companyInfo.companystatusid == 1 /* Active Paid */) {
traits.derived_plan = 'Enterprise';
} else if (user.companyInfo && user.companyInfo.companystatusid == 7 /* Active Trial */) {
traits.derived_plan = 'Enterprise Trial';
}
} else if (user.isTeamPlanMember) {
traits.derived_plan = 'Team';
}
var context = {
integrations: {
Intercom: {
user_hash: config.intercomUserHash
}
}
};
var subdomain = window.location.hostname.split(".")[0];
var userID = (config.singleTenantConfig && config.singleTenantConfig.useSingleTenantAnalytics) ? subdomain + "-" + user.id : user.id;
var callback = function () {
if ( typeof $window.mixpanel !== "undefined" && $window.mixpanel != null ) {
$window.mixpanel.name_tag(null);
}
};
$window.analytics.ready(function() {
if (typeof $window.mixpanel !== 'undefined' && $window.mixpanel != null) {
$window.mixpanel.reset();
$window.mixpanel.identify(userID);
}
if (
typeof ga !== 'undefined'
&& typeof ga === 'function'
&& ['LIVE', 'PREVIEW'].indexOf(config.serverType) !== -1
) {
ga('create', 'UA-24306919-3', 'projects.invisionapp.com', {'name': 'appTracker'} );
var gaDimensions = {};
gaDimensions.dimension1 = config.isCustomer ? "Existing Customer" : "Potential Customer";
ga( 'appTracker.send', 'pageview', gaDimensions);
}
});
$window.analytics.identify( userID, traits, context, callback );
var growthTraits = {
"Full Name": user.name,
Email: user.email,
"Plan Name": traits.derived_plan,
"Signup Date": moment(user.userCreatedAt).format("YYYY-MM-DD HH:mm:ss"),
"Most Recent IP Address": user.lastKnownIpAddress,
"Screens Upload Count": user.screenUploadedCount,
"Last Activity": moment(user.lastRequestAt).format("YYYY-MM-DD HH:mm:ss")
}
identifyGrowth( user.id, growthTraits );
var MILLIS_PER_DAY = 60 * 60 * 24 * 1000;
$window.InvAnalytics = {
accountAgeDays: (Date.now() - config.accountCreatedAt) / MILLIS_PER_DAY
};
}
function translateSubscriptionToLifecycleStage( subscription ) {
var planNamesToConsiderLeads = [ "Free" ];
var lifecycleStage = "lead";
var hasQualifyingCustomerPlan = planNamesToConsiderLeads.indexOf( subscription.name ) < 0;
var hasPaidPlan = subscription.price > 0;
var shouldBeConsideredCustomer = hasQualifyingCustomerPlan && hasPaidPlan;
if ( shouldBeConsideredCustomer ) {
lifecycleStage = "customer";
}
return lifecycleStage;
}
function splitName( name ) {
var split = name.split(/\s/);
var parts = {
firstname: "",
lastname: ""
};
if ( split.length === 1 ) {
parts.firstname = split[0];
} else if ( split.length > 1 ) {
parts.firstname = split[0];
parts.lastname = split[ split.length - 1 ];
}
return parts;
}
function segmentIo() {
try {
$timeout( segmentIoSync, 10, false );
} catch (error) {
errorLogService.exceptionHandler( error );
}
}
function segmentIoSync() {
if ( window.analytics && typeof window.analytics.load === "function" ) {
if ( config.allowExternalScripts !== false ) {
window.analytics.load(config.segmentIoKey);
window.analytics.page();
}
}
}
function outbrain() {
$timeout( outbrainSync, 10, false );
}
function outbrainSync() {
window.OB_ADV_ID = 13797;
if ( config.allowExternalScripts !== false ) {
loadScript('//widgets.outbrain.com/obtp.js');
}
}
function optimizely() {
$timeout( optimizelySync, 10, false );
}
function optimizelySync() {
if ( config.allowExternalScripts !== false ) {
loadScript('//cdn.optimizely.com/js/7610134.js');
}
window.optimizely = window.optimizely || [];
}
function loadScript(url, cb) {
var el = document.createElement('script');
el.async = true;
el.src = url;
if (cb && angular.isFunction(cb)) {
el.onload = el.onreadystatechange = cb;
}
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(el, s);
}
function hashString(stringToHash) {
var hash = 0, i, chr, len;
if (stringToHash.length === 0) return hash;
for (i = 0, len = stringToHash.length; i < len; i++) {
chr   = stringToHash.charCodeAt(i);
hash  = ((hash << 5) - hash) + chr;
hash |= 0; // Convert to 32bit integer
}
return hash;
}
function  initGrowthAnalytics() {
$timeout( function () {
amplitudeInit();
}, 10, false );
}
var amplitudeFinishedInit = false;
var amplitudeQueue = [];
function  amplitudeInit() {
if ( config.amplitudeKey ) {
try {
getSafeAmplitudeInstance().init(config.amplitudeKey, null, {
saveEvents: true,
includeUtm: true,
includeReferrer: true,
batchEvents: true,
includeGclid: true,
eventUploadThreshold: 10,
eventUploadPeriodMillis: 1000
}, function(instance) {
amplitudeFinishedInit = true;
if ( typeof amplitudeQueue === "object" && amplitudeQueue.length ) {
while ( amplitudeQueue.length ) {
var queueItem = amplitudeQueue.shift();
if (typeof queueItem.function === "function") {
queueItem.function.apply(this, queueItem.params);
}
}
}
});
} catch (error) {
errorLogService.exceptionHandler( error );	
}
}
}
function identifyGrowth( id, traits ) {
if ( amplitudeFinishedInit ) {
var subdomain = window.location.hostname.split(".")[0];
var userID = (config.singleTenantConfig && config.singleTenantConfig.useSingleTenantAnalytics) ? subdomain + "-" + id : id;
try {
getSafeAmplitudeInstance().setUserId( userID );
getSafeAmplitudeInstance().setUserProperties( traits );
} catch ( error ) {
errorLogService.exceptionHandler( error );
}
if (config.isSignUpEvent) {
var signupRecent = true;
if (traits["Signup Date"]) {
var signupDate = new Date(traits["Signup Date"]);
var signupDatePadded = new Date(signupDate.getTime()+(2*24*60*60*1000)); // +2 days
signupRecent = (signupDatePadded > new Date());
}
if (signupRecent) {
trackGrowth("App - Signup - Successful Signup",{
"Signup Type": "Email Address",
"Plan": (config.newSignupForPlan != "false" ? config.newSignupForPlan : "Free"),
"Flow": config.signUpEventForm
});
}
config.isSignUpEvent = false;
}
if (config.loginEventSource) {
trackGrowth("App - Login",{
"Login Type": config.loginEventType,
"Login Location": config.loginEventSource
});
config.loginEventSource = false;
}
} else {
if ( config.amplitudeKey ) {
amplitudeQueue.push({ function: identifyGrowth, params: [ id, traits ] } );
}
}
}
function getSafeAmplitudeInstance() {
var amplitudeStandaloneInstance;
try {
amplitudeStandaloneInstance = window.amplitude && window.amplitude.getInstance("standalone");
} catch ( error ) {
errorLogService.exceptionHandler( error );
}
var amplitudeEnabled = config.featureFlags && config.featureFlags["aqua-amplitude-growth-analytics"];
var consoleNoop = function(){
if(amplitudeEnabled){
errorLogService.exceptionHandler( 'Tried to use amplitude but standalone instance did not exist' );
}
}
return ( amplitudeEnabled && amplitudeStandaloneInstance ) ? amplitudeStandaloneInstance : {
init: consoleNoop,
logEvent: consoleNoop,
logRevenue: consoleNoop,
setUserId: consoleNoop,
setUserProperties: consoleNoop,
setOptOut: consoleNoop,
setVersionName: consoleNoop,
setDomain: consoleNoop,
setDeviceId: consoleNoop,
setGlobalUserProperties: consoleNoop,
identify: consoleNoop,
clearUserProperties: consoleNoop,
setGroup: consoleNoop,
logRevenueV2: consoleNoop,
regenerateDeviceId: consoleNoop,
logEventWithTimestamp: consoleNoop,
logEventWithGroups: consoleNoop,
setSessionId: consoleNoop
};
}	
function trackGrowth(event, object) {
var object = object || {};
if ( amplitudeFinishedInit ) {
try {
getSafeAmplitudeInstance().logEvent(event, object);					
} catch ( error ) {
errorLogService.exceptionHandler( error );
}
} else {
if ( config.amplitudeKey ) {
amplitudeQueue.push( {function: trackGrowth, params: [ event, object ] } );
}
}
}
function trackGrowthPage(name, category) {
var properties = {
"Page Name": name || "",
"Category Name": category || "",
"Title": document.title,
"URL": document.URL,
"Path": window.location.pathname,
"Referrer": document.referrer
};
var event = "App - Browsing - Visit Page";
trackGrowth(event, properties);
}
return {
identifyUser: identifyUser,
identifyGrowth: identifyGrowth,
initGrowthAnalytics: initGrowthAnalytics,
track: ($window.analytics && $window.analytics.track) || angular.noop,
trackGrowth: trackGrowth,
trackGrowthPage: trackGrowthPage,
debug: ($window.analytics && $window.analytics.debug) || angular.noop,
segmentIo: segmentIo,
googleAnalytics: angular.noop, // TODO: Remove all references to this
outbrain: outbrain,
optimizely: optimizely
};
}
})( angular, InVision );
;
;
/*! app-cache.service.js */ 
;
;
(function( ng, app ){
'use strict';
var _DEBUG_ = window._DEBUG_ || false;
app
.service('appCacheService', Service);
/** @ngInject */
function Service($log, Notification) {
var _appCache = window.applicationCache;
var updateOnce =  _.once(_appCache.update);
if (!localStorage.appCacheRetryCounts) {
try {
localStorage.setItem('appCacheRetryCounts', 0);
} catch(err) {
$log.error(err)
}
}
var service = {
update: update
};
init();
return service;
function init() {
if (_DEBUG_) $log.info('appCacheService.init');
_appCache.addEventListener('cached', handleCachedEvent, false);
_appCache.addEventListener('error', handleErrorEvent, false);
_appCache.addEventListener('obsolete', handleObsoleteEvent, false);
_appCache.addEventListener('updateready', handleUpdateReadyEvent, false);
window.addEventListener('load', handleWindowLoadEvent, false);
return service;
}
function handleCachedEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleCachedEvent', e);
if (_DEBUG_) {
Notification.success({
title: 'App Cache',
message: 'Successfully cached for offline viewing.',
delay: 15000
});
}
}
function handleCheckingEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleCheckingEvent', e);
}
function handleDownloadingEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleDownloadingEvent', e);
}
function handleErrorEvent(err) {
if (_DEBUG_) $log.error('appCacheService.handleErrorEvent', err);
var retryCount = +(localStorage.getItem('appCacheRetryCounts'));
if (retryCount < 2 && window.navigator.onLine) {
try {
localStorage.setItem('appCacheRetryCounts', retryCount + 1);
} catch(err) {
$log.error(err)
}
/*
Supress missing resource error until they can be fully solved
Notification.error({
title: 'Missing Resource',
message: '<p>Your project may not be fully cached. If you notice any missing screens, please restore your internet connection and refresh the app.</p><button class="button -refresh" onClick="javascript:window.location.reload()">Refresh</button>',
delay: 15000
}); 
*/
} else {
localStorage.setItem('appCacheRetryCounts', 0)
/*
Notification.error({
title: 'Missing Resource',
message: '<p>Your project may not be fully cached. If you notice any missing screens, please restore your internet connection and refresh the app.</p><button class="button -refresh" onClick="javascript:window.location.reload()">Refresh</button><a class="button -contact-customer-support" href="mailto:support@invisionapp.com?subject=' + encodeURIComponent('[Mobile Share] - App Cache Error') + '&body=' + encodeURIComponent('Dear Support,\n\n' + 'The Project: ' + window.location.href + ', is telling me it’s missing a resource.\n\n' + 'Please investigate the issue.\n\nThank you for your help!\n\n' + 'Cheers,\n[YOUR NAME]') + '">Contact Support</a>',
delay: 99999
});
*/
}
}
function handleNoUpdateEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleNoUpdateEvent', e);
}
function handleObsoleteEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleObsoleteEvent', e);
if (_DEBUG_) Notification.info('Outdated App Cache, updating...');
updateOnce();
}
function handleProgressEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleProgressEvent', e);
}
function handleUpdateReadyEvent(e) {
if (_DEBUG_) $log.info('appCacheService.handleUpdateReadyEvent', e);
if (_appCache.status === _appCache.UPDATEREADY) {
try {
_appCache.swapCache();
if (_DEBUG_) Notification.success('Successfully updated the App Cache.');
} catch (err) {
handleErrorEvent(err);
}
}
}
function handleWindowLoadEvent() {
handleUpdateReadyEvent();
window.removeEventListener('load', handleWindowLoadEvent);
}
function update() {
if (_DEBUG_) $log.info('appCacheService.update');
try {
_appCache.update();
} catch (err) {
handleErrorEvent(err);
}
return service;
}
}
})( angular, InVision );
;
;
/*! app-settings.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.factory( "appSettings", appSettings )
;
function appSettings( $location, _, sessionService, config ) {
var launchDarklyFeatureFlags = [
"enableMyNotifications",
"mentionShortcut",
"projectNotificationPreferences",
"shareCommentingLogin"
];
var settings = {
debug: false,
notifications: [],
features: {
tfa: false,
sessionInactivity: false
}
};
var user = {};
var isInVisionAppUser = false;
return {
setUser: setUser,
setSettings: setSettings,
getSettings: getSettings,
setFeatureFlag: setFeatureFlag
};
function setUser( u ) {
user = u;
isInVisionAppUser = (
user &&
! user.isAnonymous &&
user.email.indexOf("@invisionapp.com") > -1
);
settings.features.notifications = isInVisionAppUser;
settings.features.boardsSelectiveSync = isInVisionAppUser;
if ( ! isInVisionAppUser && config.featureFlags ) {
setSettings( {
debug: false,
notifications: [], 
features: config.featureFlags 
} );
}
}
function setSettings( newSettings ) {
_.each(launchDarklyFeatureFlags, function(k) {
newSettings.features[k] = settings.features[k];
});
ng.extend( settings, newSettings );
}
function setFeatureFlag( flagName, flagValue) {
settings.features[flagName] = flagValue;
}
function getSettings() {
if ( !settings.debug && isInVisionAppUser ) {
settings.features.inbox = true;
settings.features.scheduledLiveShare = true;
settings.features.boardsSelectiveSync = true;
}
return settings;
}
}
})( angular );
;
;
/*! client-events.js */ 
;
;
(function( ng, app ) {
"use strict";
app.factory( "clientEvents", ClientEventsFactory );
function ClientEventsFactory( _ ) {
var bindings = [];
return({
add: add,
forNamespace: forNamespace,
remove: remove,
trigger: trigger
});
function add( namespace, eventType, eventHandler, context ) {
testNamespace( namespace );
testEventType( eventType );
testEventHandler( eventHandler );
bindings.push({
namespace: namespace,
eventType: eventType,
eventHandler: eventHandler,
context: ( context || null )
});
return( this );
}
function forNamespace( namespace ) {
return({
add: _.partial( add, namespace ),
forNamespace: forNamespace,
remove: _.partial( remove, namespace ),
trigger: trigger
});
}
function remove( namespace, eventType, eventHandler ) {
bindings = _.reject(
bindings,
function operator( binding ) {
return( bindingMatches( binding, namespace, eventType, eventHandler ) );
}
);
return( this );
}
function trigger( eventType ) {
var eventArguments = Array.prototype.slice.call( arguments );
var event = eventArguments[ 0 ] = {
type: eventType
};
_.each(
bindings,
function iterator( binding ) {
if ( binding.eventType === eventType ) {
binding.eventHandler.apply( binding.context, eventArguments );
}
}
);
return( event );
}
function bindingMatches( binding, namespace, eventType, eventHandler ) {
return(
( binding.namespace === namespace ) &&
( ! eventType || ( binding.eventType === eventType ) ) &&
( ! eventHandler || ( binding.eventHandler === eventHandler ) )
);
}
function testEventHandler( newEventHandler ) {
if ( ! _.isFunction( newEventHandler ) ) {
throw( new Error( "EventHandler must be a function." ) );
}
}
function testEventType( newEventType ) {
if ( ! _.isString( newEventType ) ) {
throw( new Error( "EventType must be a string value." ) );
}
if ( ! _.trim( newEventType ) ) {
throw( new Error( "EventType must not be empty." ) );
}
}
function testNamespace( newNamespace ) {
if ( ! _.isString( newNamespace ) ) {
throw( new Error( "Namespace must be a string value." ) );
}
if ( ! _.trim( newNamespace ) ) {
throw( new Error( "Namespace must not be empty." ) );
}
}
}
})( angular, InVision );
;
;
/*! comment-object-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.factory( "commentObjectService", CommentObjectService );
function CommentObjectService() {
var current = {
objectType: null,	// One of "project" or "board"
objectID: 0,			// The id of the project or board which is currently selected
conversationID: 0
};
return ({
get: function() {
return current;
},
reset: function() {
current = {
objectType: null,
objectID: 0,
conversationID: 0
};
},
set: function( objectType, opts ) {
if ( objectType !== null ) { // Allow setting objectType to null
if ( objectType !== "project" && objectType !== "board" ) {
throw ("Bug alert. When setting the comment object type, you must pass either 'project' or 'board'. You passed " + objectType + ".");
}
}
this.reset();
current = {
objectType: objectType,
objectID: opts.objectID,
conversationID: opts.conversationID
};
}
});
}
})( angular, InVision );
;
;
/*! conversation-crop-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "conversationCropService", Service );
/** @ngInject */
function Service( _, $q ) {
var cropImage;
var markerWidth = 20; // hardcoded diameter of markers, helps with placing a circle here at the center when the x/y is actually top/left and not center
var isUnsupported = false; // if we encounter an error with this process, don't keep trying to use canvas cropping
function createConversationImage( conversation, imageSrc, cropWidth, cropHeight, markerRadius ) {
var deferred = $q.defer();
var canvas = document.getElementById("renderCanvas");
if( !('crossOrigin' in new Image() ) ) {
isUnsupported = true;
}
if ( isUnsupported ) {
setTimeout(function() {
deferred.reject( "error" );
},1);
return deferred.promise;
}
try {
var ctx = canvas.getContext("2d");
var baseX = conversation.x;
var baseY = conversation.y;
var sourceX = baseX + markerWidth - (cropWidth / 2);
var sourceY = baseY + markerWidth - (cropHeight / 2);
var loadedImg = new Image();
canvas.width = cropWidth;
canvas.height = cropHeight;
ctx.clearRect( 0, 0, canvas.width, canvas.height);
var centerX = canvas.width / 2;
var centerY = canvas.height / 2;
if ( sourceX < 0 ) {
centerX = Math.abs(sourceX);
sourceX = 0;
}
if ( sourceY < 0 ) {
centerY = Math.abs(sourceY);
sourceY = 0;
}
loadedImg.crossOrigin = "Anonymous";
loadedImg.onload = function() {
if ( sourceX > loadedImg.width ) {
centerX = Math.abs(sourceX);
sourceX = loadedImg.width;
}
if ( sourceY > loadedImg.height ) {
centerY = Math.abs(sourceY);
sourceY = loadedImg.height;
}
var isEdgeCase = false;
if ( ( sourceX + cropWidth ) > loadedImg.width ) {
isEdgeCase = true;
sourceX = ( loadedImg.width - cropWidth );
if ( sourceX < 0 ) {
sourceX = 0;
cropWidth = loadedImg.width;
}
}
if ( ( sourceY + cropHeight ) > loadedImg.height ) {
isEdgeCase = true;
sourceY = ( loadedImg.height - cropHeight );
if ( sourceY < 0 ) {
sourceY = 0;
cropHeight = loadedImg.height;
}
}
ctx.drawImage( loadedImg, sourceX, sourceY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight );
if ( ! isEdgeCase ) {
var markerColor = "#ff3366"; // pink
if( conversation.isForDevelopment ){
markerColor = "#630ee3"; // purple
}else if( conversation.isTourPoint ){
markerColor = "#0e89df"; // blue
}else if ( conversation.isPrivate ){
markerColor = "#939ba8"; // grey
}
ctx.beginPath();
ctx.arc( centerX, centerY, markerRadius, 0, 2 * Math.PI, false );
ctx.fillStyle = markerColor;
ctx.fill();
ctx.lineWidth = 1;
ctx.strokeStyle = "#f5fbfd";
ctx.stroke();
}
try {
var dataUrl = canvas.toDataURL("image/png");
} catch( exception ) {
isUnsupported = true;
deferred.reject( exception );
return;
}
deferred.resolve(dataUrl);
};
var augmentedSrc = imageSrc.replace('project-images', 'projects'); // hax replace for local
loadedImg.src = augmentedSrc;
} catch ( exception ) {
isUnsupported = true;
setTimeout(function() {
deferred.reject( exception );
}, 1);
}
return deferred.promise;
}
return({
createConversationImage: createConversationImage
});
}
})( angular, InVision );
;
;
/*! date-helper.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "dateHelper", Service );
/** @ngInject */
function Service() {
this.dayAsStringMap = [
{
"long": "Sunday",
"short": "Sun"
},
{
"long": "Monday",
"short": "Mon"
},
{
"long": "Tuesday",
"short": "Tue"
},
{
"long": "Wednesday",
"short": "Wed"
},
{
"long": "Thursday",
"short": "Thr"
},
{
"long": "Friday",
"short": "Fri"
},
{
"long": "Saturday",
"short": "Sat"
}
];
this.monthAsStringMap = [
{
"long": "January",
"short": "Jan"
},
{
"long": "February",
"short": "Feb"
},
{
"long": "March",
"short": "Mar"
},
{
"long": "April",
"short": "Apr"
},
{
"long": "May",
"short": "May"
},
{
"long": "June",
"short": "Jun"
},
{
"long": "July",
"short": "Jul"
},
{
"long": "August",
"short": "Aug"
},
{
"long": "September",
"short": "Sep"
},
{
"long": "October",
"short": "Oct"
},
{
"long": "November",
"short": "Nov"
},
{
"long": "December",
"short": "Dec"
}
];
return( this );
}
Service.prototype = {
add: function( datetime, count, unit ) {
var newDatetime = this.duplicate( datetime );
switch ( unit.toLowerCase() ) {
case "y":
newDatetime.setFullYear( newDatetime.getFullYear() + count );
break;
case "m":
newDatetime.setMonth( newDatetime.getMonth() + count );
break;
case "d":
newDatetime.setDate( newDatetime.getDate() + count );
break;
case "w":
newDatetime.setDate( newDatetime.getDate() + ( count * 7 ) );
break;
case "h":
newDatetime.setTime( newDatetime.getTime() + ( count * 1000 * 60 * 60 ) );
break;
case "n":
newDatetime.setTime( newDatetime.getTime() + ( count * 1000 * 60 ) );
break;
case "s":
newDatetime.setTime( newDatetime.getTime() + ( count * 1000 ) );
break;
case "l":
newDatetime.setTime( newDatetime.getTime() + count );
break;
}
return( newDatetime );
},
addDays: function( datetime, dayCount ) {
var newDatetime = this.duplicate( datetime );
newDatetime.setDate( newDatetime.getDate() + dayCount );
return( newDatetime );
},
addLeadingZero: function( value ) {
if ( value.toString().length === 1 ) {
return( "0" + value );
}
return( value );
},
convertSecondsToMinutes: function( seconds, excludeZeroMinute ) {
var minutes = Math.floor( seconds / 60 );
var remainingSeconds = ( seconds % 60 );
if (
( excludeZeroMinute === true ) &&
( minutes === 0 )
) {
return( ":" + this.addLeadingZero( remainingSeconds ) );
} else {
return( minutes + ":" + this.addLeadingZero( remainingSeconds ) );
}
},
duplicate: function( datetime ) {
return(
new Date( datetime )
);
},
equals: function( date1, date2 ) {
return( date1.getTime() === date2.getTime() );
},
formatDate: function( datetime, dateMask ) {
var self = this;
var date = this.removeTime( datetime );
var result = dateMask.replace(
/M+|m+|d+|yyyy|yy/g,
function( $0 ) {
return(
self.getFormattedDatePart( date, $0 )
);
}
);
return( result );
},
formatRecentDate: function( datetime, dateMask ) {
var date = this.removeTime( datetime );
if ( this.isToday( date ) ) {
return( "Today" );
} else if ( this.isYesterday( date ) ) {
return( "Yesterday" );
} else {
return( this.formatDate( datetime, dateMask ) );
}
},
formatTime: function( datetime, timeMask ) {
var self = this;
var date = this.duplicate( datetime );
var result = timeMask.replace(
/H+|h+|m+|t+|T+/g,
function( $0 ) {
return(
self.getFormattedTimePart( date, $0 )
);
}
);
return( result );
},
getDayOfWeekAsString: function( dayOfWeek, useShortVersion ) {
if ( useShortVersion ) {
return( this.dayAsStringMap[ dayOfWeek ][ "short" ] );
} else {
return( this.dayAsStringMap[ dayOfWeek ][ "long" ] );
}
},
getFormattedDatePart: function( datetime, pattern ) {
switch( pattern ) {
case "D":
case "d":
return( datetime.getDate() );
break;
case "DD":
case "dd":
return( this.addLeadingZero( datetime.getDate() ) );
break;
case "DDD":
return( this.getDayOfWeekAsString( datetime.getDay() ).toUpperCase() );
break;
case "ddd":
return( this.getDayOfWeekAsString( datetime.getDay() ) );
break;
case "dddd":
return( this.getDayOfWeekAsString( datetime.getDay(), true ) );
break;
case "M":
case "m":
return( datetime.getMonth() + 1 );
break;
case "MM":
case "mm":
return( this.addLeadingZero( datetime.getMonth() + 1 ) );
break;
case "MMM":
case "mmm":
return( this.getMonthAsString( datetime.getMonth(), true ) );
break;
case "MMMM":
case "mmmm":
return( this.getMonthAsString( datetime.getMonth(), false ) );
break;
case "YY":
case "yy":
return( this.addLeadingZero( datetime.getFullYear() % 100 ) );
break;
case "YYYY":
case "yyyy":
return( datetime.getFullYear() );
break;
}
return( pattern );
},
getFormattedTimePart: function( datetime, pattern ) {
switch( pattern ) {
case "H":
return( datetime.getHours() );
break;
case "HH":
var value = datetime.getHours();
return( value < 10 ?  "0" + value : value );
break;
case "h":
var value = (datetime.getHours()  % 12);
return( value === 0 ? 12 : value );
break;
case "hh":
var value = (datetime.getHours()  % 12);
value = ( value === 0 ? 12 : value );
return( value < 10 ?  "0" + value : value );
break;
case "M":
case "MM":
case "m":
case "mm":
var value = datetime.getMinutes();
return( value < 10 ? "0" + value : value );
break;
case "T":
return( datetime.getHours() < 12 ? "A" : "P" );
break;
case "TT":
return( datetime.getHours() < 12 ? "AM" : "PM" );
break;
case "t":
return( datetime.getHours() < 12 ? "a" : "p" );
break;
case "tt":
return( datetime.getHours() < 12 ? "am" : "pm" );
break;
}
return( pattern );
},
getMonthAsString: function( month, useShortVersion ) {
if ( useShortVersion ) {
return( this.monthAsStringMap[ month ][ "short" ] );
} else {
return( this.monthAsStringMap[ month ][ "long" ] );
}
},
isRecent: function( datetime, delta, unit ) {
var cutoff = this.add( new Date(), -delta, unit );
return( datetime >= cutoff );
},
isToday: function( datetime ) {
return(
this.equals( datetime, this.today() )
);
},
isYesterday: function( datetime ) {
return(
this.equals( datetime, this.yesterday() )
);
},
notEquals: function( date1, date2 ) {
return( ! this.equals( date1, date2 ) );
},
removeTime: function( datetime ) {
var newDatetime = this.duplicate( datetime );
newDatetime.setHours( 0 );
newDatetime.setMinutes( 0 );
newDatetime.setSeconds( 0 );
newDatetime.setMilliseconds( 0 );
return( newDatetime );
},
today: function() {
return(
this.removeTime( new Date() )
);
},
tomorrow: function() {
return( this.addDays( this.today(), 1 ) );
},
yesterday: function() {
return(
this.addDays( this.today(), -1 )
);
},
formatRelativeWithinMonth: function(time, lang) {
lang = lang || "smallDate";
moment.lang("smallDate", {
relativeTime : {
future : "in %s",
past : "%s ago",
s : "1s",
m : "1m",
mm : "%dm",
h : "1h",
hh : "%dh",
d : "1d",
dd : "%dd",
M : "1mo",
MM : "%d months",
y : "a year",
yy : "%d years"
}
});
moment.lang("expandedDate", {
relativeTime : {
future : "in %s",
past : "%s ago",
s : "1 second",
ss : "%d seconds",
m : "1 minute",
mm : "%d minutes",
h : "1 hour",
hh : "%d hours",
d : "1 day",
dd : "%d days",
M : "1 month",
MM : "%d months",
y : "a year",
yy : "%d years"
}
});
moment.lang("expandedDate", {
relativeTime : {
future : "in %s",
past : "%s ago",
s : "1 second",
ss : "%d seconds",
m : "1 minute",
mm : "%d minutes",
h : "1 hour",
hh : "%d hours",
d : "1 day",
dd : "%d days",
M : "1 month",
MM : "%d months",
y : "a year",
yy : "%d years"
}
});
moment.lang("expandedDate", {
relativeTime : {
future : "in %s",
past : "%s ago",
s : "1 second",
ss : "%d seconds",
m : "1 minute",
mm : "%d minutes",
h : "1 hour",
hh : "%d hours",
d : "1 day",
dd : "%d days",
M : "1 month",
MM : "%d months",
y : "a year",
yy : "%d years"
}
});
var now = moment(),
diff = moment(time).diff(now, "months"),
output;
if ( Math.abs(diff) === 0 ) {
moment.lang( lang );
output = moment(time).fromNow();
moment.lang(false);
} else {
output = moment(time).format("MMM D");
}
return output;
}
};
})( angular, InVision );
;
;
/*! deferred.js */ 
;
;
(function( ng, app ) {
"use strict";
app.factory(
"Deferred",
/** @ngInject */
function( $q, _ ) {
function Deferred() {
var deferred = $q.defer();
var promise = deferred.promise;
var core = {
resolve: deferred.resolve,
reject: deferred.reject,
then: promise.then
};
var isResolved = false;
var isRejected = false;
var updateCallbacks = [];
var mistakeCallbacks = [];
deferred.resolve = function() {
if ( isResolved && !isRejected ) {
for ( var i = 0, length = updateCallbacks.length ; i < length ; i++ ) {
updateCallbacks[ i ].apply( {}, arguments );
}
} else {
isResolved = true;
core.resolve.apply( deferred, arguments )
}
};
deferred.reject = function() {
if ( isResolved ) {
for ( var i = 0, length = mistakeCallbacks.length ; i < length ; i++ ) {
mistakeCallbacks[ i ].apply( {}, arguments );
}
} else {
isRejected = true;
core.reject.apply( deferred, arguments )
}
};
promise.then = function() {
var newPromise = core.then.apply( promise, arguments );
newPromise.update = promise.update;
newPromise.mistake = promise.mistake;
return( newPromise );
};
promise.update = function( callback ) {
updateCallbacks.push( callback );
return( promise );
};
promise.mistake = function( callback ) {
mistakeCallbacks.push( callback );
return( promise );
};
return( deferred );
}
Deferred.handleAllPromises = function( promises, successCallback, errorCallback, runOnce ) {
var handleSuccess = function( index, response ) {
if ( hasError ) {
return;
}
results[ index ] = response;
if ( _.contains( results, null ) ) {
return;
}
successCallback.apply( null, results );
};
var handleError = function( index, response ) {
if ( hasError ) {
return;
}
hasError = true;
errorCallback.call( null, response );
};
var results = [];
for ( var i = 0, length = promises.length ; i < length ; i++ ) {
results.push( null );
}
var hasError = false;
successCallback = ( successCallback || ng.noop );
errorCallback = ( errorCallback || ng.noop );
_.forEach(
promises,
function( promise, index ) {
Deferred.handlePromise(
promise,
function( response ) {
handleSuccess( index, response );
},
function( response ) {
handleError( index, response );
},
runOnce
);
}
);
};
Deferred.handlePromise = function( promise, successCallback, errorCallback, runOnce ) {
var handleSuccess = function( response ) {
if ( hasRun && runOnce ) {
return;
}
hasRun = true;
successCallback( response );
};
var hasRun = false;
successCallback = ( successCallback || ng.noop );
errorCallback = ( errorCallback || ng.noop );
promise.then( handleSuccess, errorCallback );
promise.update( handleSuccess );
promise.mistake( errorCallback );
return( promise );
};
return( Deferred );
}
);
})( angular, InVision );
;
;
/*! error-log-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "errorLogService", ErrorLogService );
/** @ngInject */
function ErrorLogService( $log, $window, stackTraceService ) {
var debounceLog = {};
var appLoadedAt = ( new Date() ).getTime();
function log( exception ) {
$log.error.apply( $log, arguments );
try {
var errorMessage = typeof exception === "object" && exception.message ?
exception.message : exception.toString();
if ( shouldSkipErrorReporting( errorMessage ) ) {
return;
}
if ( $window.NREUM && $window.NREUM.noticeError ) {
try {
$window.NREUM.noticeError( exception );
} catch ( newRelicError ) {
$log.error.call( $log, newRelicError );
}
}
var stackTrace = exception instanceof Error ?
stackTraceService.print({ e: exception }) :
exception;
$.ajax({
type: "POST",
url: "/api/error-log/javascript",
contentType: "application/json",
headers: {
"X-Page-Loaded-At": appLoadedAt
},
data: ng.toJson({
errorUrl: $window.location.href,
errorMessage: errorMessage,
stackTrace: ng.toJson( stackTrace )
})
});
} catch ( loggingError ) {
$log.warn( "Error logging failed" );
$log.log( loggingError );
}
}
function normalizeErrorMessage( message ) {
return(
String( message ).toLowerCase().replace( /[^a-z0-9]+/gi, "_" )
);
}
function shouldSkipErrorReporting( message ) {
var errorKey = ( "debounce_" + normalizeErrorMessage( message ) );
if ( debounceLog.hasOwnProperty( errorKey ) ) {
return( true );
}
debounceLog[ errorKey ] = true;
return( false );
}
return({
exceptionHandler: log
});
}
})( angular, InVision );
;
;
/*! hashkey-copier.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "hashKeyCopier", HashKeyCopier );
/** @ngInject */
/** @ngInject */
function HashKeyCopier( _ ) {
function applyHashKeyIndex( hashKeyIndex, target, uniqueIdentifiers ) {
if ( _.isArray( target ) ) {
applyHashKeyIndexToArray( hashKeyIndex, "[]", target, uniqueIdentifiers );
} else if ( _.isObject( target ) ) {
applyHashKeyIndexToObject( hashKeyIndex, ".", target, uniqueIdentifiers );
}
return( target );
}
function applyHashKeyIndexToArray( hashKeyIndex, path, target, uniqueIdentifiers ) {
for ( var i = 0, length = target.length ; i < length ; i++ ) {
var targetItem = target[ i ];
if ( _.isArray( targetItem ) ) {
applyHashKeyIndexToArray( hashKeyIndex, ( path + "[]" ), targetItem, uniqueIdentifiers );
} else if ( _.isObject( targetItem ) ) {
applyHashKeyIndexToObject( hashKeyIndex, ( path + "." ), targetItem, uniqueIdentifiers );
}
}
}
function applyHashKeyIndexToObject( hashKeyIndex, path, target, uniqueIdentifiers ) {
var identifier = getUniqueIdentifierForObject( target, uniqueIdentifiers );
if ( identifier ) {
var hashKeyPath = ( path + target[ identifier ] );
if ( hashKeyIndex.hasOwnProperty( hashKeyPath ) ) {
target[ hashKeyLookup ] = hashKeyIndex[ hashKeyPath ];
path += ( target[ identifier ] + "." );
}
}
for ( var key in target ) {
if ( target.hasOwnProperty( key ) ) {
var targetItem = target[ key ];
if ( _.isArray( targetItem ) ) {
applyHashKeyIndexToArray( hashKeyIndex, ( path + key + "[]" ), targetItem, uniqueIdentifiers );
} else if ( _.isObject( targetItem ) ) {
applyHashKeyIndexToObject( hashKeyIndex, ( path + key + "." ) , targetItem, uniqueIdentifiers );
}
}
}
}
function buildHashKeyIndex( target, uniqueIdentifiers ) {
var hashKeyIndex = {};
if ( _.isArray( target ) ) {
buildHashKeyIndexForArray( hashKeyIndex, "[]", target, uniqueIdentifiers );
} else if ( _.isObject( target ) ) {
buildHashKeyIndexForObject( hashKeyIndex, ".", target, uniqueIdentifiers );
}
return( hashKeyIndex );
}
function buildHashKeyIndexForArray( hashKeyIndex, path, target, uniqueIdentifiers ) {
for ( var i = 0, length = target.length ; i < length ; i++ ) {
var targetItem = target[ i ];
if ( _.isArray( targetItem ) ) {
buildHashKeyIndexForArray( hashKeyIndex, ( path + "[]" ), targetItem, uniqueIdentifiers );
} else if ( _.isObject( targetItem ) ) {
buildHashKeyIndexForObject( hashKeyIndex, ( path + "." ), targetItem, uniqueIdentifiers );
}
}
}
function buildHashKeyIndexForObject( hashKeyIndex, path, target, uniqueIdentifiers ) {
if ( target.hasOwnProperty( hashKeyLookup ) ) {
var identifier = getUniqueIdentifierForObject( target, uniqueIdentifiers );
if ( identifier ) {
hashKeyIndex[ path + target[ identifier ] ] = target[ hashKeyLookup ];
path += ( target[ identifier ] + "." );
}
}
for ( var key in target ) {
if ( target.hasOwnProperty( key ) ) {
var targetItem = target[ key ];
if ( _.isArray( targetItem ) ) {
buildHashKeyIndexForArray( hashKeyIndex, ( path + key + "[]" ), targetItem, uniqueIdentifiers );
} else if ( _.isObject( targetItem ) ) {
buildHashKeyIndexForObject( hashKeyIndex, ( path + key + "." ) , targetItem, uniqueIdentifiers );
}
}
}
}
function copyHashKeys( existing, incoming, uniqueIdentifiers ) {
if ( isExistingDataEmpty( existing ) ) {
return( incoming );
}
if ( ! uniqueIdentifiers ) {
uniqueIdentifiers = [ "id" ];
}
var hashKeyIndex = buildHashKeyIndex( existing, uniqueIdentifiers );
applyHashKeyIndex( hashKeyIndex, incoming, uniqueIdentifiers );
return( incoming );
}
function getUniqueIdentifierForObject( target, uniqueIdentifiers ) {
for ( var i = 0, length = uniqueIdentifiers.length ; i < length ; i++ ) {
var identifier = uniqueIdentifiers[ i ];
if ( target.hasOwnProperty( identifier ) ) {
return( identifier );
}
}
return( null );
}
function isEmptyArray( target ) {
return(
target.hasOwnProperty( "length" ) && 
( target.length === 0 )
);
}
function isExistingDataEmpty( existing ) {
if ( ! existing || isEmptyArray( existing ) ) {
return( true );
}
return( false );
}
var hashKeyLookup = "$$hashKey";
return({
copyHashKeys: copyHashKeys
});
}
})( angular, InVision );
;
;
/*! http-activity-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "httpActivityService", Service );
/** @ngInject */
function Service() {
this.activeRequestCount = 0;
this.activeGetRequestCount = 0;
this.activePostRequestCount =  0;
return( this );
}
Service.prototype = {
isActive: function() {
return( this.activeRequestCount !== 0 );
},
isActiveWithGet: function() {
return( this.activeGetRequestCount !== 0 );
},
isActiveWithPost: function() {
return( this.activePostRequestCount !== 0 );
},
requestCompleted: function( isPostRequest ) {
if ( isPostRequest ) {
this.activePostRequestCount--;
} else {
this.activeGetRequestCount--;
}
this.activeRequestCount--;
if ( this.activeRequestCount === 0 ) {
this.activeGetRequestCount = 0;
this.activePostRequestCount = 0;
}
return( this.activeRequestCount );
},
requestStarted: function( isPostRequest ) {
if ( isPostRequest ) {
this.activePostRequestCount++;
} else { 
this.activeGetRequestCount++;
}
this.activeRequestCount++;
return( this.activeRequestCount );
}
};
})( angular, InVision );
;
;
/*! image-canvas-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "imageCanvasService", Service );
/** @ngInject */
function Service( serviceHelper ) {
var cachedColors = {};
function getImageColorAtCoodinates( imageUrl, coordinates, callback ) {
if ( imageUrl in cachedColors ) {
return( callback( cachedColors[ imageUrl ] ) );
}
var colors = [];
var image = new Image();
image.crossOrigin = "Anonymous";
image.onload = function() {
var canvas = document.createElement("canvas");
canvas.width = image.width;
canvas.height = image.height;
var ctx = canvas.getContext( "2d" );
ctx.drawImage( image, 0, 0 );
var imageData = ctx.getImageData( 0, 0, canvas.width, canvas.height );
for ( var i = 0 ; i < coordinates.length ; i++ ) {
var xCoord = coordinates[ i ].x;
var yCoord = coordinates[ i ].y;
var index = ( 4 * ( yCoord * imageData.width + xCoord ) );
var r = imageData.data[ index ];
var g = imageData.data[ index + 1 ];
var b = imageData.data[ index + 2 ];
var a = imageData.data[ index + 3 ];
colors.push( "rgba(" + r + "," + g + "," + b + "," + a + ")" );
}
callback( cachedColors[ imageUrl ] = colors );
imageUrl = coordinates = callback = colors = image = null;
$(canvas).remove();
};
image.src = imageUrl;
}
return({
getImageColorAtCoodinates: getImageColorAtCoodinates
});
}
})( angular, InVision );
;
;
/*! image-route-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "imageRouteService", Service );
/** @ngInject */
function Service(  ) {
function getProjectMobileDeviceID( projMobileDeviceID ){
if( typeof projMobileDeviceID != "number" ){
projMobileDeviceID = 0;
}
return projMobileDeviceID;
}
function getThumbnailURL( screenID, screenVersion, projectMobileDeviceID ){
return ( "/thumbnails/" + screenID + "/" + screenVersion + "/" + getProjectMobileDeviceID( projectMobileDeviceID ) );
}
function getScreenURL( screenID, screenVersion, projectMobileDeviceID ){
return ( "/screens/" + screenID + "/" + screenVersion + "/" + getProjectMobileDeviceID( projectMobileDeviceID ) );
}
function getHomeScreenURL( homeScreenID, homeScreenVersion, projectMobileDeviceID ){
if( homeScreenID ){
return ( "/thumbnails/" + homeScreenID + "/" + homeScreenVersion + "/" + getProjectMobileDeviceID( projectMobileDeviceID ) );
} else {
return ( "/assets/apps/common/img/blank.png" );
}
}
return({
getScreenURL: getScreenURL,
getThumbnailURL: getThumbnailURL,
getHomeScreenURL: getHomeScreenURL
});
}
})( angular, InVision );
;
;
/*! jquery.js */ 
;
;
(function( ng, app ) {
"use strict";
app.factory( "$", Factory );
function Factory() {
return $;
}
})( angular, InVision );
;
;
/*! lodash.js */ 
;
;
(function( ng, app, _, undefined ) {
"use strict";
app.factory( "_", Factory );
/** @ngInject */
function Factory() {
_.anyWithProperty = function( collection, name, value ) {
var result = _.any(
collection,
function( item ) {
return( item[ name ] === value );
}
);
return( result );
};
_.capitalizeFirstLetter = function( value ) {
if ( ! value ) {
return( "" );
}
return( value.slice( 0, 1 ).toUpperCase() + value.slice( 1 ) );
};
_.containsWithProperty = function( collection, name, value ) {
return( !! this.findWithProperty( collection, name, value ) );
};
_.countWithProperty = function( collection, name, value ) {
var count = 0;
for ( var i = 0 ; i < collection.length ; i++ ) {
if ( collection[ i ][ name ] === value ) {
count++;
}
}
return( count );
};
_.extendExistingProperties = function( destination, source ) {
if ( ! ( destination && source ) ) {
return( destination );
}
var angularKeyPattern = new RegExp( "^\\$+", "i" );
for ( var key in source ) {
if (
source.hasOwnProperty( key ) &&
destination.hasOwnProperty( key ) &&
! angularKeyPattern.test( key ) &&
! _.isFunction( source[ key ] )
) {
destination[ key ] = source[ key ];
}
}
return( destination );
};
_.filterWithProperty = function( collection, name, value ) {
var filteredCollection = _.filter(
collection,
function( item ) {
return( item[ name ] === value );
}
);
return( filteredCollection );
};
_.findWithProperty = function( collection, name, value ) {
var result = _.find(
collection,
function( item ) {
return( item[ name ] === value );
}
);
return( result );
};
_.findWithPropertyAndReplace = function( collection, name, value, replacement, operator ) {
if ( ! collection || ( replacement === undefined ) ) {
return( collection );
}
operator = ( operator || ng.noop );
for ( var i = 0, length = collection.length ; i < length ; i++ ) {
var item = collection[ i ];
if ( item[ name ] === value ) {
collection[ i ] = ( operator( replacement, item ) || replacement );
return( collection );
}
}
collection.push( replacement );
return( collection );
};
_.indexOfWithProperty = function( collection, name, value ) {
for ( var i = 0 ; i < collection.length ; i++ ) {
if ( collection[ i ][ name ] === value ) {
return( i );
}
}
return( -1 );
};
_.isValidEmail = function( value ) {
var pattern = /^[^@]+@[^.]+(\.[^.]+)+$/i;
return( pattern.test( value ) );
};
_.notContainsProperty = function( collection, name, value ) {
var filteredCollection = this.filter(
collection,
function( item ) {
return( !_.contains(item[ name ].toLowerCase(), value.toLowerCase()) );
}
);
return( filteredCollection );
};
_.maxProperty = function( collection, name ) {
if ( ! collection.length ) {
return;
}
return(
_.max(
_.pluck( collection, name )
)
);
};
_.minProperty = function( collection, name ) {
return(
_.min(
_.pluck( collection, name )
)
);
};
_.normalizeMixedDataValue = function( value ) {
var padding = "000000000000000";
value = value.replace(
/(\d+)((\.\d+)+)?/g,
function( $0, integer, decimal, repeatDecimal ) {
if ( decimal !== repeatDecimal ) {
return(
padding.slice( integer.length ) +
integer +
decimal
);
}
decimal = ( decimal || ".0" );
return(
padding.slice( integer.length ) +
integer +
decimal +
padding.slice( decimal.length )
);
}
);
return( value );
};
_.rejectWithProperty = function( collection, name, value ) {
var filteredCollection = _.reject(
collection,
function( item ) {
return( item[ name ] === value );
}
);
return( filteredCollection );
};
_.setProperty = function( collection, name, value ) {
this.forEach(
collection,
function( item ) {
item[ name ] = value;
}
);
return( collection );
};
_.similar = function( collectionA, collectionB ) {
var deltaA = _.difference( collectionA, collectionB ).length;
var deltaB = _.difference( collectionB, collectionA ).length;
return( ( deltaA + deltaB ) === 0 );
};
_.sortOnProperty = function( collection, name, direction, caseInsensitive ) {
direction = ( direction || "asc" );
var sortIndicator = ( direction === "asc" ? -1 : 1 );
collection.sort(
function( a, b ) {
if ( caseInsensitive ) {
return( a[ name ].toLowerCase() < b[ name ].toLowerCase() ? sortIndicator : - sortIndicator );
} else {
return( a[ name ] < b[ name ] ? sortIndicator : -sortIndicator );
}
}
);
return( collection );
};
_.sortOnPropertyUsingNaturalOrder = function( collection, name, direction ) {
direction = ( direction || "asc" );
var sortIndicator = ( direction === "asc" ? -1 : 1 );
collection.sort(
function( a, b ) {
var aMixed = _.normalizeMixedDataValue( a.name.toLowerCase() );
var bMixed = _.normalizeMixedDataValue( b.name.toLowerCase() );
return( aMixed < bMixed ? sortIndicator : -sortIndicator );
}
);
return( collection );
};
_.sortOnPropertyUsingLowerCase = function( collection, name, direction ) {
direction = ( direction || "asc" );
var sortIndicator = ( direction === "asc" ? -1 : 1 );
collection.sort(
function( a, b ) {
var nameA = ( a[ name ] || "" ).toLowerCase();
var nameB = ( b[ name ] || "" ).toLowerCase();
if ( nameA < nameB ) {
return( sortIndicator );
} else if ( nameB < nameA ) {
return( -sortIndicator );
}
return( 0 );
}
);
return( collection );
};
_.sumProperty = function( collection, name ) {
var sum = 0;
for ( var i = 0 ; i < collection.length ; i++ ) {
sum += collection[ i ][ name ];
}
return( sum );
};
_.trim = function( value ) {
return(
value.replace( /^\s+|\s+$/g, "" )
);
};
_.withoutProperty = function( collection, name, value ) {
var filteredCollection = this.filter(
collection,
function( item ) {
return( item[ name ] !== value );
}
);
return( filteredCollection );
};
_.withoutPropertyRange = function( collection, name, valueRange ) {
var filteredCollection = this.filter(
collection,
function( item ) {
return( _.indexOf( valueRange, item[ name ] ) === -1 );
}
);
return( filteredCollection );
};
_.withProperty = function( collection, name, value ) {
var filteredCollection = this.filter(
collection,
function( item ) {
return( item[ name ] === value );
}
);
return( filteredCollection );
};
_.withPropertyRange = function( collection, name, valueRange ) {
var filteredCollection = this.filter(
collection,
function( item ) {
return( _.indexOf( valueRange, item[ name ] ) !== -1 );
}
);
return( filteredCollection );
};
return( _ );
}
})( angular, InVision, _ );
;
;
/*! mention-shortcut-service.js */ 
;
;
(function( ng, app ) {
"use strict";
if (typeof module !== "undefined" && module.exports) {
module.exports = MentionShortcutService(null);
} else if (app) {
app.service( "mentionShortcutService", MentionShortcutService );
}
function MentionShortcutService(_) {
var lodash = _;
if (typeof module !== "undefined" && module.exports) {
lodash = require("lodash");
}
var mentionShortcuts = [
{
name: "project",
role: "shortcut"
},
{
name: "conversation",
role: "shortcut"
}
];
function getUserInfo( user, users ) {
if (user.name === "conversation") {
var conversationMembers = [];
lodash.map(users.candidates.conversationMembers, function(member) {
conversationMembers.push(member.name);
});
return conversationMembers.length ? createUserTeaser(conversationMembers) : "It's lonely in here!";
} else if (user.name === "project") {
var projectMembers = [];
var members = lodash.filter(users.candidates.candidates, function(candidate) {
return candidate.role === "member";
});
lodash.map(members, function(member) {
projectMembers.push(member.name);
});
return projectMembers.length ? createUserTeaser(projectMembers) : "It's lonely in here!";
} else {
return user.email;
}
}
function getShortcuts(ids) {
if (ids) {
var lastID = Math.max.apply( Math, ids );
mentionShortcuts.map(function(shortcut, i) {
shortcut.id = lastID + i + 1;
});
}
return mentionShortcuts;
}
function createUserTeaser(users) {
if (users.length < 3) {
return users.length === 2 ? users.join(", ") : users.join("");
} else {
var names = users.slice(0, 2).join(", ");
return names + " & " + ( users.length - 2 ) + " more";
}
}
return {
getUserInfo: getUserInfo,
getShortcuts: getShortcuts
};
}
})( angular, InVision );
;
;
/*! modal-window-request.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "modalWindowRequest", ModalWindowRequest );
/** @ngInject */
function ModalWindowRequest() {
function getData( index, defaultValue ) {
if ( arguments.length === 0 ) {
return( modalData );
} else if ( 
( index > modalData.length ) &&
( arguments.length == 2 )
) {
return( defaultValue );
} else {
return( modalData[ index ] );
}
}
function getType() {
return( modalType );
}
function isSuppressFade() {
return( suppressFade === true );
}
function setRequest( newModalType, newModalData, newSuppressFade ) {
modalType = newModalType;
modalData = newModalData;
suppressFade = ( newSuppressFade || false );
}
function setSuppressFade( newSuppressFade ) {
suppressFade = ( newSuppressFade || false );
}
function isSuppressClose() {
return( suppressClose === true );
}
function setSuppressClose( newSuppressClose ) {
suppressClose = ( newSuppressClose || false );
}
var modalType = "";
var modalData = [];
var suppressFade = false;
var suppressClose = false;
return({
getData: getData,
getType: getType,
isSuppressFade: isSuppressFade,
setRequest: setRequest,
setSuppressFade: setSuppressFade,
isSuppressClose: isSuppressClose,
setSuppressClose: setSuppressClose
});
}
})( angular, InVision );
;
;
/*! model-events.js */ 
;
;
(function( ng, app ) {
"use strict";
app.factory( "modelEvents", ModelEventsFactory );
/** @ngInject */
function ModelEventsFactory( PubSub ) {
return( new PubSub() );
}
})( angular, InVision );
;
;
/*! moment.js */ 
;
;
(function( ng, app, moment ) {
"use strict";
app.factory( "moment", Factory );
/** @ngInject */	
function Factory() {
return moment;
}
})( angular, InVision, moment );
;
;
/*! notifications-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "notificationsService", Service );
/** @ngInject */
function Service( $resource, serviceHelper, modelEvents ) {
function getSettings() {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "getSettings"
});
return( promise );
}
function removeCommentEmailFromQueue( commentID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "removeCommentEmailFromQueue",
parameters: {
command: "removeCommentEmailFromQueue",
commentID: commentID
},
successCallback: function( response ) {
}
});
return( promise );
}
function updateEmailNotificationFrequency( frequency ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateEmailNotificationFrequency",
parameters: {
command: "updateEmailNotificationFrequency",
frequency: frequency
},
successCallback: function( response ) {
}
});
return( promise );
}
function updateSendDigestAt( wantsDigestAtFrequencyInHours, digestSendTime ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateSendDigestAt",
parameters: {
command: "digestSendTime",
wantsDigestAtFrequencyInHours: wantsDigestAtFrequencyInHours,
sendNextDigestAt: digestSendTime
},
successCallback: function( response ) {
}
});
return( promise );
}
function updateSettings( settings ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateSettings",
parameters: settings,
successCallback: function( response ) {
modelEvents.trigger( "notificationSettingsUpdated", settings );
}
});
return( promise );
}
var resource = $resource(
"/api/notifications/:command",
{
command: "@command"
},
{
getSettings: {
method: "GET"
},
removeCommentEmailFromQueue: {
method: "DELETE",
command: "removeCommentEmailFromQueue"
},
updateEmailNotificationFrequency: {
method: "POST",
command: "emailNotificationFrequency"
},
updateSendDigestAt: {
method: "POST",
command: "digestSendTime"
},
updateSettings: {
method: "POST"
}
}
);
return({
getSettings: getSettings,
removeCommentEmailFromQueue: removeCommentEmailFromQueue,
updateEmailNotificationFrequency: updateEmailNotificationFrequency,
updateSendDigestAt: updateSendDigestAt,
updateSettings: updateSettings
});
}
})( angular, InVision );
;
;
/*! pagination.js */ 
;
;
angular.module('InVision')
.factory('paginationHelper',
function( _ ) {
var MINIMUM_PAGES_TO_COMPRESS = 11 // 2 left, 2 right, 3 middle, 4 (2/2 compressed )
, ITEMS_PER_EDGE = 2
, ITEMS_PER_MID = 3 // should be an odd number
, ITEMS_BEFORE_COMPRESSING = 4
, ITEMS_PER_UNCOMPRESSED_EDGE = 6;
function _compress( instance ) {
var index = instance.index
, pages = instance.pages;
if ( pages.length < MINIMUM_PAGES_TO_COMPRESS ) return pages;
var ranges = {
start : {
at       : 0,
boundary : ITEMS_BEFORE_COMPRESSING,
total    : ITEMS_PER_EDGE
},
mid : { at: index - Math.floor(( ITEMS_PER_MID - 1  ) / 2 ), total: ITEMS_PER_MID },
end : { 
at       : pages.length - ITEMS_PER_EDGE,
boundary : pages.length - ITEMS_BEFORE_COMPRESSING,
total    : ITEMS_PER_EDGE
}
};
if ( ranges.mid.at < ranges.start.boundary ) {
delete ranges.start;
ranges.mid = { at: 0, total: ITEMS_PER_UNCOMPRESSED_EDGE };
}
if ( ranges.mid.at + ranges.mid.total > ranges.end.boundary ) {
ranges.mid = { at: pages.length - ITEMS_PER_UNCOMPRESSED_EDGE, total: ITEMS_PER_UNCOMPRESSED_EDGE };
delete ranges.end;
}
var compressed = [ ];
if ( ranges.start ) {
compressed = compressed.concat( pages.slice( ranges.start.at, ranges.start.at + ranges.start.total ));
compressed.push({ separator: true });
}
if ( ranges.mid )
compressed = compressed.concat( pages.slice( ranges.mid.at, ranges.mid.at + ranges.mid.total ));
if ( ranges.end ) {
compressed.push({ separator: true });
compressed = compressed.concat( pages.slice( ranges.end.at, ranges.end.at + ranges.end.total ));
}
instance.pages = compressed;
}
function Pagination( config ) {
_.assign( this, config );
this.pages = [ ];
this.index = config.index || 0;
if ( config.pages )
_.times( config.pages + 1, function( i ) {
this.pages.push({
index   : i,
number  : i+1,
current : i === this.index
});
}, this );
this.totalPages = this.pages.length;
if ( config.compress )
_compress( this );
this.atStart = this.index === 0;
this.atEnd = this.index === this.totalPages - 1;
}
_.assign( Pagination, {
});
_.assign( Pagination.prototype, {
next: function() {
this.go( this.index + 1 );
},
previous: function() {
this.go( this.index - 1 );
},
go: function( index ) {
var current = this.index;
this.index = Math.max( 0, Math.min( index, this.totalPages ));
if ( this.index !== current && _.isFunction( this.onPageChanged ))
this.onPageChanged( this.index );
}
});
return Pagination;
});
;
;
/*! preloader.js */ 
;
;
angular.module('InVision')
.factory('preloader',
function($q, $rootScope) {
function Preloader(imageLocations) {
this.imageLocations = imageLocations;
this.imageCount = this.imageLocations.length;
this.loadCount = 0;
this.states = {
PENDING: 1,
LOADING: 2,
RESOLVED: 3,
REJECTED: 4
};
this.state = this.states.PENDING;
this.deferred = $q.defer();
this.promise = this.deferred.promise;
}
Preloader.preloadImages = function( imageLocations ) {
var preloader = new Preloader( imageLocations );
return preloader.load();
};
Preloader.prototype = {
constructor: Preloader,
isInitiated: function() {
return( this.state !== this.states.PENDING );
},
isRejected: function() {
return( this.state === this.states.REJECTED );
},
isResolved: function() {
return( this.state === this.states.RESOLVED );
},
load: function() {
if ( this.isInitiated() ) {
return( this.promise );
}
this.state = this.states.LOADING;
for ( var i = 0 ; i < this.imageCount ; i++ ) {
this.loadImageLocation( this.imageLocations[ i ] );
}
return( this.promise );
},
handleImageLoad: function handleImageLoad( imageLocation ) {
this.loadCount++;
if ( this.isRejected() ) {
return;
}
this.deferred.notify({
percent: Math.ceil( this.loadCount / this.imageCount * 100 ),
imageLocation: imageLocation
});
if ( this.loadCount === this.imageCount ) {
this.state = this.states.RESOLVED;
this.deferred.resolve( this.imageLocations );
}
},
loadImageLocation: function(imageLocation) {
var preloader = this,
image = new Image();
image.onload = function( event ) {
$rootScope.$apply(function() {
preloader.handleImageLoad(event.target.src);
preloader = null;
image = null;
event = null;
});
};
image.onerror = function( event ) {
preloader.deferred.reject();
};
image.src = imageLocation;
}
};
return Preloader;
});
;
;
/*! pusher.js */ 
;
;
(function( ng, app ) {
"use strict";
app.value( "Pusher", Pusher );
})( angular, InVision );
;
;
/*! render-context.js */ 
;
;
(function( ng, app ) {
"use strict";
app.value( "RenderContext", RenderContext );
/** @ngInject */
function RenderContext( requestContext, actionPrefix, paramNames ) {
this._requestContext = requestContext;
this._actionPrefix = actionPrefix;
this._paramNames = paramNames;
return( this );
}
RenderContext.prototype = {
getNextSection: function() {
return(
this._requestContext.getNextSection( this._actionPrefix )
);
},
isChangeLocal: function() {
return(
this._requestContext.startsWith( this._actionPrefix )
);
},
isChangeRelevant: function() {
if ( ! this._requestContext.startsWith( this._actionPrefix ) ) {
return( false );
}
if ( this._requestContext.hasActionChanged() ) {
return( true ) ;
}
return(
this._paramNames.length && 
this._requestContext.haveParamsChanged( this._paramNames )
);
}
};
})( angular, InVision );
;
;
/*! request-context.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "requestContext", RequestContext );
/** @ngInject */
function RequestContext( RenderContext ) {
this.RenderContext = RenderContext;
this._action = "";
this._sections = [];
this._params = {};
this._previousAction = "";
this._previousParams = {};
return( this );
}
RequestContext.prototype = {
getAction: function() {
return( this._action );
},
getNextSection: function( prefix ) {
if ( ! this.startsWith( prefix ) ) {
return( null );
}
if ( prefix === "" ) {
return( this._sections[ 0 ] );
}
var depth = prefix.split( "." ).length;
if ( depth === this._sections.length ) {
return( null );
}
return( this._sections[ depth ] );
},
getParam: function( name ) {
return( this._params[ name ] || null );
},
getParams: function() {
return( this._params || null );
},
getParamAsInt: function( name, defaultValue ) {
var valueAsInt = parseInt( this.getParam( name ) );
if ( isNaN( valueAsInt ) ) {
return( defaultValue || 0 );
} else {
return( valueAsInt );
}
},
getRenderContext: function( requestActionLocation, paramNames ) {
requestActionLocation = (requestActionLocation || "");
paramNames = (paramNames || []);
if ( ! ng.isArray( paramNames ) ) {
paramNames = [ paramNames ];
}
return(
new this.RenderContext( this, requestActionLocation, paramNames )
);
},
hasActionChanged: function() {
return( this._action !== this._previousAction );
},
hasParamChanged: function( paramName, paramValue ) {
if ( ! ng.isUndefined( paramValue ) ) {
return( ! this.isParam( paramName, paramValue ) );
}
if (
!(paramName in this._previousParams) &&
(paramName in this._params)
) {
return( true );
} else if (
(paramName in this._previousParams) &&
!(paramName in this._params)
) {
return( true );
}
return( this._previousParams[ paramName ] !== this._params[ paramName ] );
},
haveParamsChanged: function( paramNames ) {
for ( var i = 0, length = paramNames.length ; i < length ; i++ ) {
if ( this.hasParamChanged( paramNames[ i ] ) ) {
return( true );
}
}
return( false );
},
isParam: function( paramName, paramValue ) {
if (
(paramName in this._params) &&
(this._params[ paramName ] == paramValue)
) {
return( true );
}
return( false );
},
setContext: function( action, routeParams ) {
this._previousAction = this._action;
this._previousParams = this._params;
this._action = action;
this._sections = action.split( "." );
this._params = ng.copy( routeParams );
},
startsWith: function( prefix ) {
if (
!prefix.length || 
(this._action === prefix) ||
(this._action.indexOf( prefix + "." ) === 0)
) {
return( true );
}
return( false );
}
};
})( angular, InVision );
;
;
/*! screen-alignment-helper.js */ 
;
;
angular.module('InVision')
.factory('ScreenAlignmentHelper',
function( _, $, $window, screenService ) {
function ScreenAlignment() {
}
_.assign( ScreenAlignment.prototype, {
calculate : function( screen, container ) {
if ( !container ) container = $window;
if (!( container instanceof $ )) container = $( container );
var alignment = {
containerWidth : Math.min( container.width(), $window.innerWidth ),
screenWidth : screen.width * screen.displayScale,
usingScroll : parseInt( screen.zoomScrollBehavior, 10 ) === screenService.zoomScrollBehaviors.NORMAL,
center : screen.alignment === 'center',
left : screen.alignment === 'left',
right : screen.alignment === 'right'
};
if ( alignment.usingScroll ) {
if ( alignment.right ) {
alignment.offset = alignment.screenWidth - alignment.containerWidth;
} else if ( alignment.left ) {
alignment.offset = 0;
} else {
alignment.offset = Math.max( 0, ( alignment.screenWidth - alignment.containerWidth ) / 2 );
}
} else {
if ( alignment.right ) {
alignment.offset = Math.min( alignment.containerWidth - alignment.screenWidth, 0 );
} else if ( alignment.left ) {
alignment.offset = 0;
} else { // center
alignment.offset = Math.min( ( alignment.containerWidth - alignment.screenWidth ) / 2, 0 );
}
}
return alignment;
}
});
return ScreenAlignment;
});
;
;
/*! service-helper.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "serviceHelper", ServiceHelper );
/** @ngInject */
function ServiceHelper( Deferred ) {
function executeRequest( options ) {
var resource = options.resource;
var name = options.name;
var parameters = ( options.parameters || {} );
var successCallback = ( options.successCallback || ng.noop );
var errorCallback = ( options.errorCallback || ng.noop );
var deferred = new Deferred();
if( window.location.protocol === "file:" ) {
deferred.resolve();
return deferred.promise;
}
var resourceResponse = resource[ name ]( 
parameters,
function( response ) {
successCallback( response );
deferred.resolve( response );
},
function( response ) {
errorCallback( response );
deferred.reject(
unwrapErrorMessage( response )
);
}
);
return( deferred.promise );
}
function unwrapErrorMessage( errorResponse ) {
try {
var response = ng.fromJson( errorResponse.data );
if ( ng.isString( response ) ) {
response = {
message: response,
code: -1
};
}
} catch ( error ) {
var response = {
message: errorResponse.data,
code: -1
};
}
return( response );
}
return({
executeRequest: executeRequest
});
}
})( angular, InVision );
;
;
/*! session-inactivity-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "sessionInactivityService", SessionInactivityService );
/** @ngInject */
function SessionInactivityService( $document,_ , modelEvents ) {
var 
keepAliveCb = ng.noop, 
timeoutCb = ng.noop, 
sessionIdentifier, 
throttledKeepAlive;
function killSession() {
teardown();
timeoutCb();
}
function setSessionActive() {
throttledKeepAlive();
}
function init( sessionId, keepAliveCallback, timeoutCallback ) {
keepAliveCb = keepAliveCallback;
timeoutCb = timeoutCallback;
throttledKeepAlive = _.throttle( keepAliveCb, 30000 ); // run the keepalive a max of once every 30 seconds. lastRequestAt isn't updated on the backend if it's not greater than 60 seconds
sessionIdentifier = sessionId; // the session we're currently using. 
teardown(); // make sure there aren't any leftovers
$document
.on("mousemove.sessionInactivity keypress.sessionInactivity", function (e) {
setSessionActive();
});
$(window)
.on("focus.sessionInactivity", function(e) { 
setSessionActive(); // don't throttle the call if we're focusing the tab
})
.on("blur.sessionInactivity", throttledKeepAlive.cancel ); // kill any trailing keepalives if we leave the tab
modelEvents.on(
"sessionInactive.sessionInactivity",
function(event, identifier) {
if ( identifier === sessionIdentifier ) {
killSession();
}
}
);
}
function teardown() {
$document
.off(".sessionInactivity");
$(window)
.off(".sessionInactivity");
modelEvents
.off("sessionInactive.sessionInactivity");
}
return({
init: init,
disable: teardown // in case you want to programmatically disable this after initialization for some reason
});
}
})( angular, InVision );
;
;
/*! sort-screens.js */ 
;
;
(function(app) {
app.factory('sortScreens', sortScreensFactory);
/** @ngInject */
function sortScreensFactory(_) {
return function sortScreens(screens, dividers, sortTypeID) {
var sortKey = sortTypeID === 2 ? "name" : "sort";
var sortedDividers = _.sortBy(dividers, "sort");
var groupedScreens = _.chain(screens)
.groupBy("screenGroupId")
.mapValues(function (screens) {
return _.sortBy(screens, sortKey);
})
.value();
return sortedDividers.reduce(function (sortedScreens, divider) {
if (groupedScreens[divider.dividerID]) {
sortedScreens = sortedScreens.concat(groupedScreens[divider.dividerID]);
}
return sortedScreens;
}, []);
}
}
})(InVision);
;
;
/*! stack-trace-service.js */ 
;
;
(function( ng, app, printStackTrace ) {
"use strict";
app.factory( "stackTraceService", Factory );
function Factory() {
return({
print: printStackTrace
});
}
})( angular, InVision, printStackTrace );
;
;
/*! tail-connector-display.js */ 
;
;
(function( ng, app ) {
"use strict";
function invoke( action, point ) {
if (!( point && point[ action ])) return;
var args = [].slice.call( arguments, 2 );
point[ action ].apply( point, args );
}
app.factory( "tailConnectorDisplay", function( $, _ ) {
var DEFAULTS = {
view : document.body,
curve       : 0.6,
padding     : 10, // 4,
lineWidth   : 1.5,
colorSource : 'borderColor',
shadowColor : 'rgba( 0,0,0, 0.15 )',
color: {
start : '#4682a9',
end   : '#4682a9',
focus : '#4682a9'
}}
, END_POINT_BORDER_ADJUSTMENT = 3
, HIDDEN_MOUSE_CURSOR_CSS = 'hide-mouse-pointer';
function showMousePointer( instance ) {
instance.view.removeClass( HIDDEN_MOUSE_CURSOR_CSS );
instance.pointer.hide();
}
function hideMousePointer( instance ) {
instance.view.addClass( HIDDEN_MOUSE_CURSOR_CSS );
instance.pointer.show();
}
function getOpposite( side ) {
return ({ left: 'right', right: 'left', top: 'bottom', bottom: 'top' })[ side ];
}
function getBounds( instance, point ) {
var bounds = { };
if ( point instanceof $ )
bounds = point[ 0 ].getBoundingClientRect();
else {
bounds.x = bounds.left = bounds.right = 0|point.x;
bounds.y = bounds.top = bounds.bottom = 0|point.y;
bounds.width = 0;
bounds.height = 0;
}
bounds.centerX = bounds.left + ( bounds.width * 0.5 || 0 );
bounds.centerY = bounds.top + ( bounds.height * 0.5 || 0 );
return bounds;
}
function overlaps( a, b ) {
return hitTest( a.left, a.top, b ) || hitTest( a.right, a.bottom, b ) || hitTest( a.left, a.bottom, b ) || hitTest( a.right, a.top, b );
}
function hitTest( x, y, b ) {
return x >= b.left && x <= b.right && y >= b.top && y <= b.bottom;
}
function isPoint( a, b ) {
if ( !a || !b ) return false;
if ( a instanceof $ ) a = a[ 0 ];
if ( b instanceof $ ) b = b[ 0 ];
return a === b;
}
function setPoint( instance, which, point ) {
clearPoint( instance, which );
instance[ which ] = point;
}
function clearPoint( instance, which ) {
if ( !instance[ which ] ) return;
invoke( 'setConnection', instance[ which ], { connected: false });
delete instance[ which ];
}
function updateDrawingArea( instance ) {
_.assign( instance.canvas, { width: instance.container.width(), height: instance.container.height() });
}
function getStartingSide( instance, start, end ) {
var distance = {
left   : end.right - start.left,
right  : start.right - end.left,
top    : end.bottom - start.top,
bottom : start.bottom - end.top
};
var side;
_.each( distance, function( value, dir ) {
if ( !side || value > distance[ side ])
side = dir;
});
return side;
}
function getDrawingPath( instance, start, end, side, isCursor ) {
var points;
if ( side === 'top' )
points = {
start: { x: start.centerX, y: start.bottom },
end: { x: end.centerX, y: end.top }
};
else if ( side === 'bottom' )
points = {
start: { x: start.centerX, y: start.top },
end: { x: end.centerX, y: end.bottom }
};
else if ( side === 'left' )
points = {
start: { x: start.right, y: start.centerY },
end: { x: end.left, y: end.centerY }
};
else if ( side === 'right' )
points = {
start: { x: start.left, y: start.centerY },
end: { x: end.right, y: end.centerY },
};
if ( isCursor ) {
if ( side === 'top' ) points.end.y -= END_POINT_BORDER_ADJUSTMENT;
else if ( side === 'bottom' ) points.end.y += END_POINT_BORDER_ADJUSTMENT;
else if ( side === 'left' ) points.end.x -= END_POINT_BORDER_ADJUSTMENT;
else if ( side === 'right' ) points.end.x += END_POINT_BORDER_ADJUSTMENT;
}
return points;
}
function generateCurve( instance, path, side ) {
var curve = DEFAULTS.curve
, points = { };
_.assign( points, {
p1 : { x: path.start.x, y: path.start.y },
p2 : { x: path.end.x, y: path.end.y }
});
var adjust;
if ( side === 'right' ) {
adjust = ( points.p1.x - points.p2.x ) * curve;
points.p1.x -= adjust;
points.p2.x += adjust;
}
else if ( side === 'left' ) {
adjust = ( points.p2.x - points.p1.x ) * curve;
points.p1.x += adjust;
points.p2.x -= adjust;
}
else if ( side === 'bottom' ) {
adjust = ( points.p2.y - points.p1.y ) * curve;
points.p1.y += adjust;
points.p2.y -= adjust;
}
else if ( side === 'top' ) {
adjust = ( points.p1.y - points.p2.y ) * curve;
points.p1.y -= adjust;
points.p2.y += adjust;
}
return points;
}
function getConnectorColor( instance, point ) {
if (!( point instanceof $ )) return;
var source = point.is('[connector-line-color]') ? point : point.find('[connector-line-color]');
var color;
if ( source.length > 0 ) {
var prop = source.attr('connector-line-color') || DEFAULTS.colorSource;
color = source.css( prop );
}
return color;
}
function applyTheme( instance, path, start, end, useFocus ) {
var fill = instance.context.createLinearGradient( path.start.x, path.start.y, path.end.x, path.end.y );
var color1 = getConnectorColor( instance, start );
var color2 = getConnectorColor( instance, end );
fill.addColorStop( 0, color1 || instance.color.start );
fill.addColorStop( 1, color2 || instance.color[ useFocus ? 'focus' : 'end' ]);
instance.context.lineWidth = DEFAULTS.lineWidth;
instance.context.strokeStyle = fill;
}
function updateElementConnection( point, side ) {
invoke( 'setConnection', point, { connected: !!side, side: side });
}
function updateView( instance ) {
if (!( instance.start && ( instance.focus || instance.end )))
return instance.hide();
instance.show();
var startPoint = instance.start
, useCursor = !instance.focus
, useFocus = !useCursor
, endPoint = useFocus ? instance.focus : instance.end
, start = getBounds( instance, startPoint )
, end = getBounds( instance, endPoint )
, overlapsStart = useCursor && hitTest( end.x, end.y, start );
if ( useCursor && overlapsStart ) {
showMousePointer( instance );
return instance.pointer.hide();
}
var side = getStartingSide( instance, start, end )
, opposite = getOpposite( side )
, path = getDrawingPath( instance, start, end, side, useCursor )
, curve = generateCurve( instance, path, side );
updateDrawingArea( instance, path );
if ( DEFAULTS.debug ) {
instance.context.fillStyle = 'rgba(255,255,255,0.1)';
instance.context.fillRect( 0,0, instance.canvas.width, instance.canvas.height );
}
if ( useFocus ) {
showMousePointer( instance );
instance.pointer.hide();
}
else {
hideMousePointer( instance );
var nudge = instance.pointer.width() / 2;
instance.pointer.css({
left : end.left - nudge,
top  : end.top - nudge
}).show();
if ( opposite === 'top' ) end.top -= nudge;
else if ( opposite === 'bottom' ) end.top += nudge;
else if ( opposite === 'left' ) end.left += nudge;
else if ( opposite === 'right' ) end.left += nudge;
}
updateElementConnection( startPoint, opposite );
updateElementConnection( endPoint, side );
applyTheme( instance, path, startPoint, endPoint, useFocus );
instance.context.beginPath();
instance.context.moveTo( path.start.x, path.start.y );
instance.context.bezierCurveTo( curve.p1.x, curve.p1.y, curve.p2.x, curve.p2.y, path.end.x, path.end.y );
instance.context.stroke();
}
function Connector( options ) {
this.options = _.extend({ }, DEFAULTS, options );
this.color = _.assign({ }, this.options.color );
var view = this.options.view
, container = document.createElement('div')
, pointer = document.createElement('div')
, canvas = document.createElement('canvas')
, context = canvas.getContext('2d');
_.assign( this, {
view      : $( view ),
container : $( container ),
pointer   : $( pointer ),
canvas    : canvas,
context   : context
});
this.container
.css({ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: 9999 })
.hide()
.append( canvas )
.appendTo( this.view );
this.pointer.addClass('tail-connector-pointer')
.prependTo( this.container );
}
_.assign( Connector.prototype, {
clear : function() {
this.clearStart();
this.clearEnd();
this.clearFocus();
this.hide();
},
clearStart : function() { return clearPoint( this, 'start' ); },
clearEnd : function() { return clearPoint( this, 'end' ); },
clearFocus : function() { return clearPoint( this, 'focus' ); },
startAt : function( at ) { return setPoint( this, 'start', at ); },
endAt : function( at ) { return setPoint( this, 'end', at ); },
focusAt : function( at ) { return setPoint( this, 'focus', at ); },
isStart : function( compare ) { return isPoint( this.start, compare ); },
isEnd : function( compare ) { return isPoint( this.end, compare ); },
isFocus : function( compare ) { return isPoint( this.focus, compare ); },
show : function() { 
this.container.addClass('active').show();
},
hide : function() {
showMousePointer( this );
_.assign( this.canvas, { width: 0, height: 0 });
this.container.removeClass('active').hide();
},
update : function() {
updateView( this );
}
});
return Connector;
});
})( angular, InVision );
;
;
/*! tail-connector.js */ 
;
;
(function( ng, app ) {
"use strict";
var START_POINT_CONNECTING_CLASS = 'connecting'
, DEFAULT_CONFIG = {
};
app.service( "tailConnector", function( $, _, $rootScope, tailConnectorDisplay, utilityService ) {
var nextFrame = utilityService.getRequestAnimationFrame();
function invoke( action, point ) {
if (!( point && point.handler && point.handler[ action ])) return;
var args = [].slice.call( arguments, 2 );
point.handler[ action ].apply( point.handler, args );
}
function hitTest( at, x, y ) { return at.left <= x && x <= at.right && at.top <= y && y <= at.bottom; }
function inView( element, bounds ) {
var container = element.parentNode;
bounds = bounds || element.getBoundingClientRect();
do {
var area = container.getBoundingClientRect()
, boundless = area.top === area.bottom || area.left === area.right;
if ( !boundless && ( bounds.right < area.left || bounds.left > area.right || bounds.top > area.bottom || bounds.bottom < area.top ))
return false;
container = container.parentNode;
} while( container && container !== document.body );
return true;
}
function autoRefresh( instance ) {
function refresh() {
if ( !instance.active ) return;
instance.display.update();
nextFrame( refresh );
}
refresh();
}
function trackMovements( instance, event ) {
_.assign( instance.mouse, { 
x: event.clientX,
y: event.clientY
});
if ( !instance.active ) return;
event = { };
_.each( instance.targets, function( target ) {
if ( event.cancel ) return;
if ( !target.element.is(':visible')) return;
var element = target.element[ 0 ]
, bounds = element.getBoundingClientRect()
, over = hitTest( bounds, instance.mouse.x, instance.mouse.y );
if ( over && !inView( element, bounds )) return;
if ( over && !target.isMouseOver ) {
if ( target.focusable )
instance.display.focusAt( target.element );
invoke( 'handleMouseEnter', target, event, instance.source );
}
else if ( !over && target.isMouseOver ) {
if ( instance.display.isFocus( target.element ))
instance.display.clearFocus();
invoke( 'handleMouseLeave', target, event, instance.source );
}
target.isMouseOver = over;
});
instance.display.update();
}
function trackPresses( instance ) { }
function trackReleases( instance ) {
if ( !instance.active ) return;
var event = { };
var hits = _.filter( instance.targets, function( target ) {
if ( event.cancel || !target.isMouseOver )
return null;
invoke( 'handleConnect', target, event, instance.source );
return target;
});
if ( hits.length === 0 ) invoke( 'handleCancel', instance.source, event );
else invoke( 'handleConnect', instance.source, event, hits );
}
function registerPoint( instance, config, accepts, kind, item ) {
if (!( item.types || item.type )) return;
var ignore;
_.each( config.except, function( type ) {
if ( ignore ) return;
if ( 'type' in item ) ignore = item.type === type;
else if ( 'types' in item ) ignore = _.contains( item.types, type );
});
if ( ignore ) return;
var accept;
_.each( accepts, function( type ) {
if ( accept ) return;
if ( 'type' in item ) accept = item.type === type;
else if ( 'types' in item ) accept = _.contains( item.types, type );
});
if ( !accept ) return;
if (!( item.element instanceof $ ))
item.element = $( item.element );
item.element.setConnection = item.handler.handleSetConnection;
if ( kind === 'source' ) instance.source = item;
else instance.targets.push( item );
}
function Service() {
this.targets = [ ];
this.mouse = { x: 0, y: 0 };
this.display = new tailConnectorDisplay( document.body );
this._pending = [ ];
$( window ).mousemove( _.bind( trackMovements, null, this ))
.mousedown( _.bind( trackPresses, null, this ))
.mouseup( _.bind( trackReleases, null, this ));
}
_.assign( Service, {
});
_.assign( Service.prototype, {
activate : function( source, targets, config ) {
config = _.defaults( DEFAULT_CONFIG, config );
if ( _.isString( targets ))
targets = _.filter( _.map( $.trim( targets ).split(','), $.trim ));
delete this.source;
this.targets = this._pending;
this._pending = [ ];
if ( !_.isArray( this.targets )) this.targets = [ ];
$rootScope.$broadcast('tailConnector:activate:source', _.bind( registerPoint, null, this, config, [ source ], 'source' ));
$rootScope.$broadcast('tailConnector:activate:target', _.bind( registerPoint, null, this, config, targets, 'target' ));
this.active = this.source && this.targets.length > 0;
if ( !this.active ) return false;
this.source.element.addClass( START_POINT_CONNECTING_CLASS );
this.display.startAt( this.source.element );
this.display.endAt( this.mouse );
this.display.show();
if ( config.autoRefresh !== false )
autoRefresh( this );
},
register: function( instance ) {
var target = this.active ? this.targets : this._pending;
target.push( instance );
},
deactivate : function() {
this.active = false;
this.source.element.removeClass( START_POINT_CONNECTING_CLASS );
var event = { };
invoke( 'handleDeactivate', this.source, event );
_.each([ this.source ].concat( this.targets ), function( point ) {
invoke( 'handleDeactivate', point, event );
});
this.display.clear();
},
flash : function() { 
if ( !this.active ) return;
var event = { };
_.each([ this.source ].concat( this.targets ), function( point ) {
invoke( 'handleFlash', point, event );
});
}
});
return new Service();
});
})( angular, InVision );
;
;
/*! transitions.service.js */ 
;
;
(function(ng, app) {
var _DEBUG_ = _DEBUG_ || false;
app
.service('transitionsService', Service);
/** @ngInject */
function Service($log, _) {
var userAgent = navigator.userAgent.toLowerCase();
var isiOS = (/(ip(hone|od|ad))/g).test(userAgent);
var isAndroid = (/android/g).test(userAgent);
var _targ,
_curr,
_wrap,
_fixed,
_fixedCurr,
_fixedTarg,
_timeline;
var _ready = false;
var _clearProps = [
'transform',
'transformStyle',
'opacity',
'boxShadow',
'backfaceVisibility',
'zIndex',
'perspective',
'transformOrigin'
].join(',');
var _cb = _.noop;
var _tweenDefaults = {
autoRound: true,
delay: 0.05,
roundProps: 'x,y',
ease: Power3.easeOut
};
var _durations = {
dissolve:   0.45,
pop:        0.8,
flow:       1.0,
pushLeft:   0.5,
pushRight:  0.5,
flipLeft:   1.0,
flipRight:  1.0,
slideDown:  0.8,
slideUp:    0.8,
slideLeft:  0.5,
slideRight: 0.5,
slideFade:  1.0
};
var service = {
'dissolve':    dissolve,
'push-right':  pushRight,
'push-left':   pushLeft,
'flip-right':  flipRight,
'flip-left':   flipLeft,
'flow':        flow,
'pop':         pop,
'slide-up':    slideUp,
'slide-down':  slideDown,
'slide-right': slideRight,
'slide-left':  slideLeft,
'slide-fade':  slideFade,
configure:     configure,
play:          play
};
init();
return service;
function init() {
if (_DEBUG_) $log.info('transitionsService.init');
TweenLite.lagSmoothing(150, 21);
_timeline = new TimelineLite({
onComplete: onComplete,
paused: true
});
return service;
}
function configure(current, target, wrapper, fixed) {
if (_DEBUG_) $log.info('transitionsService.configure');
_curr  = current;
_targ  = target;
_wrap  = wrapper;
if (fixed) {
_fixed = true;
if (fixed.curr) _fixedCurr = fixed.curr;
if (fixed.targ) _fixedTarg = fixed.targ;
}
_ready = true;
return service;
}
function dissolve() {
if (_DEBUG_) $log.info('transitionsService.dissolve');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {zIndex: 3, opacity: 1});
_timeline.add([
TweenLite.to(_curr, _durations.dissolve, ng.extend({},
_tweenDefaults, {
opacity: 0,
delay: 0.1,
ease: Power1.easeInOut
})
)
]);
return service;
}
function pushRight() {
if (_DEBUG_) $log.info('transitionsService.pushRight');
if (!_ready) return handleError({code: 'NotReady'});
var targCss = {
x: '0%'
}
if (!isAndroid) targCss.boxShadow = '0 0 40px 0 rgba(0, 0, 0, .2)';
TweenLite.set(_curr, {
x: '0%',
z: 0
});
TweenLite.set(_targ, {
x: '-100%',
z: 0,
zIndex: 3
});
_timeline.add([
TweenLite.to(_curr, _durations.pushRight, ng.extend({},
_tweenDefaults, {
x: '25%'
})
),
TweenLite.to(_targ, _durations.pushRight, ng.extend({},
_tweenDefaults, targCss)
)
]);
if (_fixed) _fadeFixed('pushRight');
return service;
}
function pushLeft() {
if (_DEBUG_) $log.info('transitionsService.pushLeft');
if (!_ready) return handleError({code: 'NotReady'});
var targCss = {
x: '0%'
}
if (!isAndroid) targCss.boxShadow = '0 0 40px 0 rgba(0, 0, 0, .2)';
TweenLite.set(_curr, {
x: '0%',
z: 0
});
TweenLite.set(_targ, {
x: '100%',
z: 0,
zIndex: 3
});
_timeline.add([
TweenLite.to(_curr, _durations.pushLeft, ng.extend({},
_tweenDefaults, {
x: '-25%'
})
),
TweenLite.to(_targ, _durations.pushLeft, ng.extend({},
_tweenDefaults, targCss)
)
]);
if (_fixed) _fadeFixed('pushLeft');
return service;
}
function flipRight() {
if (_DEBUG_) $log.info('transitionsService.flipRight');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_wrap, {
transformStyle: 'preserve-3d',
perspective: 1000
});
TweenLite.set(_curr, {
rotationY: 0,
zIndex: 3,
transformOrigin: '50% 50%',
backfaceVisibility: 'hidden'
});
TweenLite.set(_targ, {
rotationY: -180,
scale: .7,
transformOrigin: '50% 50%',
backfaceVisibility: 'hidden'
});
_timeline.add([
TweenLite.to(_curr, _durations.flipRight, ng.extend({},
_tweenDefaults, {
rotationY: 180,
scale: .7
})
),
TweenLite.to(_targ, _durations.flipRight, ng.extend({},
_tweenDefaults, {
rotationY: 0,
scale: 1
})
)
]);
return service;
}
function flipLeft() {
if (_DEBUG_) $log.info('transitionsService.flipLeft');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_wrap, {
transformStyle: 'preserve-3d',
perspective: 1000
});
TweenLite.set(_curr, {
rotationY: 0,
zIndex: 3,
transformOrigin: '50% 50%',
backfaceVisibility: 'hidden'
});
TweenLite.set(_targ, {
rotationY: 180,
scale: .7,
transformOrigin: '50% 50%',
backfaceVisibility: 'hidden'
});
_timeline.add([
TweenLite.to(_curr, _durations.flipLeft, ng.extend({},
_tweenDefaults, {
rotationY: -180,
scale: .7
})
),
TweenLite.to(_targ, _durations.flipLeft, ng.extend({},
_tweenDefaults, {
rotationY: 0,
scale: 1
})
)
]);
return service;
}
function slideRight() {
if (_DEBUG_) $log.info('transitionsService.slideRight');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {x: 0, z: 0});
TweenLite.set(_targ, {x: '-99.8%', z: 0});
_timeline.add([
TweenLite.to(_wrap, _durations.slideRight, ng.extend({},
_tweenDefaults, {
delay: 0.3,
x: '100%'
})
)
]);
if (_fixed) _fadeFixed('slideRight');
return service;
}
function slideLeft() {
if (_DEBUG_) $log.info('transitionsService.slideLeft');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {x: 0, z: 0});
TweenLite.set(_targ, {x: '99.8%', z: 0});
_timeline.add([
TweenLite.to(_wrap, _durations.slideLeft, ng.extend({},
_tweenDefaults, {
delay: 0.3,
x: '-100%'
})
)
]);
if (_fixed) _fadeFixed('slideLeft');
return service;
}
function slideDown() {
if (_DEBUG_) $log.info('transitionsService.slideDown');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {y: '0%', zIndex: 3});
_timeline.add([
TweenLite.to(_curr, _durations.slideDown, ng.extend({},
_tweenDefaults, {
y: '100%',
ease: Power4.easeOut
})
)
]);
return service;
}
function slideUp() {
if (_DEBUG_) $log.info('transitionsService.slideUp');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_targ, {y: '100%', zIndex: 3});
_timeline.add([
TweenLite.to(_targ, _durations.slideUp, ng.extend({},
_tweenDefaults, {
y: '0%',
ease: Power4.easeOut
})
)
]);
return service;
}
function slideFade() {
if (_DEBUG_) $log.info('transitionsService.slideFade');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {
x: 0,
transformOrigin: '50% 50%'
});
TweenLite.set(_targ, {
opacity: 0,
scale: 0.8,
transformOrigin: '50% 50%'
});
_timeline.add([
TweenLite.to(_curr, _durations.slideFade, ng.extend({},
_tweenDefaults, {
x: '-100%',
opacity: 0.5
})
),
TweenLite.to(_targ, _durations.slideFade, ng.extend({},
_tweenDefaults, {
opacity: 1,
scale: 1
})
)
]);
return service;
}
function pop() {
if (_DEBUG_) $log.info('transitionsService.pop');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {
opacity: 1,
transformOrigin: '50% 50%',
zIndex: 3
});
TweenLite.set(_targ, {
opacity: 0,
transformOrigin: '50% 50%',
scale: 0.5
});
_timeline.add([
TweenLite.to(_curr, _durations.pop, ng.extend({},
_tweenDefaults, {
scale: .5,
opacity: 0
})
),
TweenLite.to(_targ, _durations.pop, ng.extend({},
_tweenDefaults, {
opacity: 1,
scale: 1
})
)
]);
return service;
}
function flow() {
if (_DEBUG_) $log.info('transitionsService.flow');
if (!_ready) return handleError({code: 'NotReady'});
TweenLite.set(_curr, {
opacity: 1,
x: '0%',
transformOrigin: '50% 50%',
scale: 1
});
TweenLite.set(_targ, {
opacity: .5,
x: '100%',
transformOrigin: '50% 50%',
scale: 0.5
});
_timeline.add(
TweenLite.to(_curr, _durations.flow / 4, ng.extend({},
_tweenDefaults, {
opacity: .5,
scale: 0.5
})
)
);
_timeline.add([
TweenLite.to(_curr, _durations.flow / 2, ng.extend({},
_tweenDefaults, {
x: '-100%',
delay: 0
})
),
TweenLite.to(_targ, _durations.flow / 2, ng.extend({},
_tweenDefaults, {
x: '0%',
delay: 0
})
)
]);
_timeline.add(
TweenLite.to(_targ, _durations.flow / 4, ng.extend({},
_tweenDefaults, {
opacity: 1,
scale: 1,
delay: 0
})
)
);
return service;
}
function play(cb) {
if (_DEBUG_) $log.info('transitionsService.play');
if (!cb) return handleError({code: 'NoCallback'});
_cb = cb;
return _timeline.play();
}
function _fadeFixed(transitionType) {
if (_DEBUG_) $log.info('transitionsService._fadeFixed', transitionType);
TweenLite.set(_fixedCurr, {
opacity: 1
});
if (_fixedCurr) {
_timeline.add(
TweenLite.to(_fixedCurr, (_durations[transitionType] - 0.3), {
opacity: 0
}), (_durations[transitionType] - 0.3)
);
}
return service;
}
function onComplete() {
if (_DEBUG_) $log.info('transitionsService.onComplete');
_timeline.clear();
TweenLite.set([_targ, _curr, _wrap], {clearProps: _clearProps});
_targ, _curr, _wrap, _fixed, _fixedCurr, _fixedTarg = null;
return _cb();
}
function handleError(err) {
if (_DEBUG_) $log.error('transitionsService.handleError', err);
var message;
switch (err.code.toLowerCase()) {
case 'nocallback':
message = 'You did not provide an animation onComplete callback';
break;
case 'notarget':
message = 'You have to provide a target node before you can ' +
'animate something.';
break;
case 'notready':
message = 'You are trying to use the transitions service before ' +
'it was even ready. Please refactor your code.';
break;
default:
message = 'Something bad happened.';
}
throw new Error(message);
}
}
})(angular, InVision);
;
;
/*! utility-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "utilityService", UtilityService );
/** @ngInject */
function UtilityService() {
/**
* Generates a GUID string, according to RFC4122 standards.
* @returns {String} The generated GUID.
* @example af8a8416-6e18-a307-bd9c-f2c947bbb3aa
* @author Slavik Meltser (slavik@meltser.info).
* @link http://slavik.meltser.info/?p=142
*/
function guid() {
function _p8(s) {
var p = (Math.random().toString(16)+"000000000").substr(2,8);
return s ? "-" + p.substr(0,4) + "-" + p.substr(4,4) : p ;
}
return _p8() + _p8(true) + _p8(true) + _p8();
}
function stripHTML( str ) {
var htmlRegex = /(<([^>]+)>)/ig;
return str.replace(htmlRegex, "");
}
function isHTML( str ) { // results and regex set to var scope for reduced mutability over many requests
var regex = /(<([^>]+)>)/ig;
var result = regex.test( str );
return result;
}
function getRequestAnimationFrame() {
return window.requestAnimationFrame
|| window.webkitRequestAnimationFrame
|| window.mozRequestAnimationFrame
|| function( callback ){ window.setTimeout( callback, 1000 / 60 ); 
};
}
return({
isHTML: isHTML,
stripHTML: stripHTML,
getRequestAnimationFrame: getRequestAnimationFrame,
guid: guid
});
}
})( angular, InVision );
;
;
/*! validation-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "validationService", ValidationService );
/** @ngInject */
function ValidationService() {
this.errorCodes = [
{
code: 400,
message: "Invalid request for this resource."
},
{
code: 400,
message: "Invalid request body content."
},
{
code: 401,
message: "The credentials you provided are not valid."
},
{
code: 403,
message: "Forbidden."
},
{
code: 404,
message: "The requested resource could not be found."
},
{
code: 405,
message: "The requested resource does not support the given method."
},
{
code: 406,
message: "The screen you were attempting to view was not found."
},
{
code: 407,
message: "The project you were attempting to view was not found."
},
{
code: 1100,
message: "Validation failure"
},
{
code: 1101,
message: "Validation failure: missing field"
},
{
code: 1102,
message: "Validation failure: invalid field"
},
{
code: 1103,
message: "Validation failure: already exists"
},
{
code: 3003,
message: "Sorry, you have attempted your request too many times."
},
{
code: 5001,
message: "Sorry, you aren't a collaborator on the project you tried to access. Please inform the project owner."
},
{
code: 5002,
message: "Sorry, you aren't a collaborator on the project you tried to access. Would you like to Join this project?"
},
{
code: 500,
message: "Unexpected error"
}
];
return( this );
}
ValidationService.prototype = {
isAlreadyExists: function( error ) {
return( error.code === 1103 );
},
isBadRequest: function( error ) {
return( error.code === 400 );
},
isForbidden: function( error ) {
return( error.code === 403 );
},
isInvalid: function( error ) {
return( error.code === 1100 );
},
isInvalidField: function( error ) {
return( error.code === 1102 );
},
isMissingField: function( error ) {
return( error.code === 1101 );
},
isNotFound: function( error ) {
return( error.code === 404 );
},
isScreenNotFound: function( error ) {
return( error.code === 406 );
},
isProjectNotFound: function( error ) {
return( error.code === 407 );
},
isProjectEmpty: function( error ) {
return( error.code === 409 );
},
isOverQuota: function( error ) {
return( 
( error.code === 3000 ) ||
( error.code === 3001 )
);
},
isMissingProjectPermission: function( error ) {
return( error.code === 5001 );
},
canJoinProject: function( error ) {
return( error.code === 5002 );
},
isTooManyAttempts: function( error ) {
return( error.code === 3003 );
}
};
})( angular, InVision );
;
;
/*! comment.controller.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")   // FIXME -- shall we create a module comment?
.controller( "comment.CommentController", CommentController );
var mentionUID = 1;
function CommentController() {
var vm = this;
initialize();
function initialize() {
vm.uid = mentionUID++;
}
}
})( angular );
;
;
/*! comment.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.directive( "invComment", CommentDirective );
function CommentDirective( $window ) {
return ({
controller: "comment.CommentController",
controllerAs: "vm",
restrict: "A",
templateUrl: "/assets/apps/common/ng-components/comment/comment.directive.htm",
link: linkFunction,
scope: {
comment: "=comment", 	// current comment
conversation: "=conversation",  // previous comments [0..N]
screenId: "=screenId",
boardId: "=boardId",
hasEmojis: "@hasEmojis",  							// dis/enable emojis
hasWhoIsNotified: "@hasWhoIsNotified", 	// dis/enable who-is-notified directive
hasMentions: "=hasMentions",
hasMentionShortcut: "@hasMentionShortcut",	// dis/enable shorcuts (@project, @conversation)
onAddComment: "&?onAddComment",
onExitComment: "&?onExitComment",
onFocusCallback: "&?onFocusCallback",
mentionPositioningClass: "@?",
classString: "@?",
placeholder: "@?",
tabIndex: "@?",
name: "@?"
}
});
function linkFunction( scope, element, attrs ) {
if ( ng.isUndefined( attrs.onExitComment ) ) {
return;
}
var firstClick = true;
ng.element( $window ).on( "click", handleClick );
scope.$on( "$destroy", handleDestroy );
function handleClick( event ) {			
if ( element[0].contains( event.target ) ) {
return;
}
if ( firstClick ) {
firstClick = false;
return;
}
var emojiPopover = ng.element( document.querySelector(".emoji-popover") );
if ( emojiPopover && emojiPopover[0].contains( event.target ) ) {
return;
}
scope.$apply(function() {
scope.onExitComment();
});
}
function handleDestroy() {
ng.element( $window ).off( "click" );
}
}
}
})( angular );
;
;
/*! mention.filter.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.filter("mention", function() {
return function( val ) {
if ( typeof val === "undefined") {
return false;
}
var nameParts = val.trim().split(" ").join("");
return "@" + nameParts;
};
});
})( angular );
;
;
/*! nice-date.filter.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.filter("niceDate", niceDateFilter)
;
function niceDateFilter( moment ) {
return function( val ) {
var now = moment();
var date = moment( val );
if ( date > now ) {
return now.fromNow();
}
return date.fromNow();
};
}
})( angular );
;
;
/*! parseCommentService.js */ 
;
;
(function( ng, app ) {
"use strict";
if (typeof module !== "undefined" && module.exports) {
var _ = require("lodash");
var MentionUtilities = require("../../../utilities/mention-utilities");
var EmojiValue = require("../../emoji/emoji-value");
var EmojiService = require("../../emoji/emoji-service")(EmojiValue);
module.exports = ParseCommentService( _, MentionUtilities, EmojiService );
} else if (app) {
app.service("parseCommentService", ParseCommentService);
}
var escapedEntities = {
"<": "&lt;",
">": "&gt;",
"&": "&amp;"
};
function ParseCommentService( _, mentionUtilities, emojiService ) {
function _str( str ) {
return ( str || "" ).toString();
}
function _extractMentionsHtmlFromComment ( comment, mentions, currentUserID ) {
var extracted = [];
if ( ! mentions ) {
return extracted;
}
var mentionText;
var mentionHTML;
var className;
var startPos;
var i = mentions.length;
while ( i-- ) {
var self = ( mentions[ i ].userID === currentUserID );
mentionText = mentions[ i ].text;
startPos = mentions[ i ].startPos;
className = self ? "me-mentioned" : "mention-blue";
mentionHTML = "<span class=\"" + className + "\">" + _.escape( mentionText ) + "</span>";
if ( comment.substr( startPos, mentionText.length ) === mentionText ) {
extracted.push( {
index: startPos,
html: mentionHTML,
css: className,
text: mentionText
} );
}
}
extracted.reverse();
return extracted;
}
function _applyMentionsToComment( comment, mentions ) {
var parsedComment = [ ];
var next = _.first( mentions );
for ( var i = 0; i < comment.length; i++ ) {
if ( next && next.index === i ) {
i += next.text.length - 1;
parsedComment.push( next.html );
var index = _.indexOf( mentions, next );
next = mentions[ index + 1 ];
}
else {
var letter = comment[ i ];
parsedComment.push( escapedEntities[ letter ] || letter );
}
}
return parsedComment.join("");
}
function _handleMentionShortcuts( mentions, userID ) {
var mentionData = [];
var sortedMentions = _.partition(mentions, function( m ) {
return m.text === "@project" || m.text === "@conversation";
});
if ( sortedMentions[0].length > 0 ) {
var grouped = _.groupBy( sortedMentions[0], "startPos" );
_.each(grouped, function( group ) {
var meMention =_.find( group, function( g ) {
return g.userID === userID;
});
mentionData.push( !!meMention ? meMention : group[0] );
});
}
return _.sortBy( sortedMentions[1].concat( mentionData ), function( mention ) {
return mention.startPos;
});
}
function getComment( comment, currentUserID, options ) {
if (
comment.mentions &&
options &&
options.hasOwnProperty("atConversationDisabled") &&
options.atConversationDisabled
) {
_.remove(comment.mentions, function(m) {
return m.text === "@conversation";
});
}
if ( _.isObject( currentUserID )) {
options = currentUserID;
currentUserID = null;
}
var mentions = _handleMentionShortcuts(comment.mentions, currentUserID) || [ ];
comment = _str( comment.comment );
options = options || { };
currentUserID = currentUserID || options.userID || options.currentUser || options.currentUserID;
mentions = _extractMentionsHtmlFromComment( comment, mentions, currentUserID );
comment = _applyMentionsToComment( comment, mentions );
if ( !options.ignoreLineBreaks ) {
comment = applyLineBreaks( comment );
}
if ( !options.ignoreLinks ) {
comment = applyHtmlLinks( comment );
}
if ( !options.ignoreEmojis ) {
comment = emojiService.parseEmoji( comment );
}
return comment;
}
function substrHtml( html, limit ) {
var output = [];
var inTag = false;
var count = 0;
var lastCharacter;
for ( var i = 0; i < html.length; i++ ) {
var character = html[ i ];
var openTag = character === "<";
var closeTag = character === ">";
var multiSpace = lastCharacter === " " && character === " ";
var isTag = openTag || closeTag;
lastCharacter = character;
if (!( inTag || multiSpace )) {
count++;
}
if (( count <= limit || isTag || inTag ) && !multiSpace ) {
output.push( character );
}
if ( count === limit && i < html.length ) {
output.push('...');
}
if ( openTag ) {
inTag = true;
}
else if ( closeTag ) {
inTag = false;
}
}
return output.join("");
}
function applyLineBreaks( string ) {
return _str( string ).replace( /(\r\n?|\n)/g, "<br />" );
}
function applyHtmlLinks( html ) {
var string = _str( html );
var patternURL = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
var patternWWW = /(^|\s)(www\.[\S]+(\b|$))/gim;
var patternEmail = /([^@\\s]+@[^@\\s]+\\.\\w{2}[\\.\\w]*)/gim;
return string
.replace(patternURL, '<a href="$&" target="_blank">$&</a>')
.replace(patternWWW, '<a href="http://$&" target="_blank">$&</a>')
.replace(patternEmail, function( match, plus, address ) {
/**
* Since JS does not support negative look behind, we check if
* there is a + character captured to lead the e-mail address
* and only replace the email address with a link if it is not
* there.
*/
return plus ? match : '<a href="mailto:' + address + '">' + address + '</a>';
})
;
}
return {
getComment: getComment,
substrHtml: substrHtml,
applyLineBreaks: applyLineBreaks,
applyHtmlLinks: applyHtmlLinks
};
}
})( angular, InVision );
;
;
/*! comment-teaser.controller.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.controller( "comment.CommentTeaserController", CommentTeaserController );
function CommentTeaserController(
$log,
$scope,
_,
appSettings,
mentionStorage,
mentionUtilityService,
itemOwnerPartial,
projectWatchersPartial,
sessionService
) {
var vm = this;
var props = $scope.props = $scope;
var isProjectNotificationEnabled = appSettings.getSettings().features.projectNotificationPreferences;
$scope.$watch( "isShown", handleIsShown );
$scope.$watch( "conversation", handleConversationChange );
$scope.$on( "$destroy", handleDestroy );
itemOwnerPartial.addBinding( setItemOwner );
projectWatchersPartial.addBinding( setProjectWatchers );
initialize();
function initialize() {
mentionStorage.load();
if ( isProjectNotificationEnabled && props.projectId ) {
loadProjectWatchers();
setProjectWatchers();
} else {
loadItemOwner();
setItemOwner();
}
setMentions( true );
}
function loadItemOwner() {
if ( ! sessionService.user.isAccountAuthenticated ) {
return;
}
var itemID = props.screenId || props.boardId;
var itemType = !!props.screenId ? "screen" : "board";
itemOwnerPartial
.load( itemID, itemType )
.catch( protectState( handleReject ) )
;
function handleReject( error ) {
$log.error("For some reason we couldn't load your screen owner");
}
}
function setItemOwner() {
var itemID = props.screenId || props.boardId;
var itemType = !!props.screenId ? "screen" : "board";
vm.itemOwner = itemOwnerPartial.get( itemID, itemType );
if ( ! vm.itemOwner ) {
return;
}
mentionStorage.setOwner( vm.itemOwner );
}
function loadProjectWatchers() {
if ( ! sessionService.user.isAccountAuthenticated ) {
return;
}
projectWatchersPartial
.load( props.projectId )
.catch( protectState( handleReject ) )
;
function handleReject( error ) {
$log.error("For some reason we couldn't load your project watchers");
}
}
function setProjectWatchers() {
vm.watchers = projectWatchersPartial.get( props.projectId );
if ( _.isEmpty( vm.watchers ) ) {
return;
}
mentionStorage.setWatchers( vm.watchers );
}
function setMentions( isInit ) {
if ( _.isEmpty( props.conversation ) ) {
return;
}
var lastComment = _.last( props.conversation );
var lastMentions = lastComment.mentions || [];
var userDetails = mentionUtilityService.getUserDetails( lastComment );
if ( isInit ) {
vm.peopleNotified = mentionUtilityService.getMyMentions( lastMentions, userDetails );
return;
}
mentionStorage.insert( lastMentions );
mentionStorage.insert( userDetails );
vm.peopleNotified = mentionStorage.get();
}
function handleIsShown( newVal ) {
if ( typeof newVal === "undefined" || newVal ) {
return;
}
$scope.$evalAsync( function() {
if (props.hasInitialMentions) {
setMentions();
}
});
}
function handleConversationChange( newVal, oldVal ) {
if ( ! newVal || newVal === oldVal ) {
return;
}
setMentions( true );
}
function handleDestroy() {
$scope.isDestroyed = true;
itemOwnerPartial.removeBinding( setItemOwner );
projectWatchersPartial.removeBinding( setProjectWatchers );
}
function protectState( callback ) {
return( proxy );
function proxy() {
if ( $scope.isDestroyed ) {
$log.warn( "Returning out of callback due to state change." );
return;
}
return( callback.apply( null, arguments ) );
}
}
}
})( angular );
;
;
/*! comment-teaser.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.directive( "invCommentTeaser", CommentTeaserDirective )
;
function CommentTeaserDirective() {
return ({
controller: "comment.CommentTeaserController",
controllerAs: "vm",
restrict: "A",
templateUrl: "/assets/apps/common/ng-components/comment/teaser/comment-teaser.directive.htm",
scope: {
isShown: "=isShown",
hasInitialMentions: "=hasInitialMentions",
conversation: "=conversation",
screenId: "=screenId",
boardId: "=boardId",
projectId: "=projectId"
}
});
}
})( angular );
;
;
/*! emoji-add-menu.directive.js */ 
;
;
(function (ng) {
"use strict";
ng
.module("InVision")
.directive("invEmojiAddMenu", Directive);
function Directive(
$window,
$document,
emojiService,
appSettings
) {
return ({
link: linkFunction,
restrict: "A",
replace: true,
templateUrl: "/assets/apps/common/ng-components/emoji/emoji-add-menu.directive.htm"
});
function linkFunction(scope, element) {
var menuObj = {
width: 320,
height: 335,
topLimit: 400 // limit to either show the menu above or beneath the emoji-add icon
};
var ESC = 27;
var textarea = null;
var addEmojiElement = null;
var emojiContainer = element.find(".emojis");
var emojiIcon = ".emoji-icon";
var emojiAttr = "data-emoji";
var isModal = element.closest(".modal").length > 0 || element.closest(".m-inbox-conversation").length || element.closest(".m-inbox-board-item").length;
var emojiPlaceholder = element.closest(".emoji-root").find(".emoji-placeholder");
var appendTo = (emojiPlaceholder.length > 0) ? emojiPlaceholder : $document.find("body");
scope.$on("emoji:toggle", handleToggle);
$document.on("keydown", keyboardEvents);
angular.element($window).on("click", handleClickOutside);
init();
function init() {
scope.tabs = emojiService.getCategories();
scope.activeTab = {
"idx": 0,
"tab": scope.tabs[0]
};
scope.emojis = emojiService.getEmojis();
scope.hoverEmoji = null;
}
scope.setTab = function (index) {
scope.activeTab.idx = index;
scope.activeTab.tab = scope.tabs[index];
};
emojiContainer.on("click", emojiIcon, function(e) {
textarea = addEmojiElement.closest(".post-emojis").find("textarea").val(); // can't cache it, enabled with ng-if
scope.$emit("emoji:add", textarea, this.getAttribute( emojiAttr ), scope.commentTarget );
scope.isOpen = false;
scope.$apply();
});
emojiContainer.on("mouseenter", emojiIcon, function (e) {
scope.hoverEmoji = this.getAttribute(emojiAttr);
scope.$digest();
});
emojiContainer.on("mouseleave", emojiIcon, function (e) {
scope.hoverEmoji = null;
scope.$digest();
});
function keyboardEvents(event) {
var keyCode = event.which || event.keyCode;
if (keyCode !== ESC) {
return;
}
if (!scope.isOpen) {
emojiService.setPopover(false);
}
scope.isOpen = false;
scope.$digest();
}
function handleToggle(event, isOpen, addEmojiElm) {
addEmojiElement = addEmojiElm;
if (!isOpen) {
return;
}
emojiService.setPopover(true);
emojiService.setPopoverOnModal(true);
appendTo.append(element);
var addEmojiIconCoords = emojiService.getElementBoundingCoords(addEmojiElement[0]);
var appendToCoords = emojiService.getElementBoundingCoords(appendTo[0]);
var top = (addEmojiIconCoords.top - appendToCoords.top) - (menuObj.height + menuObj.height * 0.1);
var left = (addEmojiIconCoords.left - appendToCoords.left) + menuObj.width / 2;
if (addEmojiIconCoords.top < menuObj.topLimit) {
top = addEmojiIconCoords.top - appendToCoords.top;
}
element.css({
top: top,
left: left
});
if (isModal) {
element.css({
zIndex: 1051
});
}
}
function handleClickOutside(event) {
if (addEmojiElement && (addEmojiElement[0].contains(event.target) || element[0].contains(event.target))) {
return;
}
scope.isOpen = false;
scope.$digest();
}
scope.$on(
"$destroy",
function () {
emojiService.setPopover(false);
emojiService.setPopoverOnModal(false);
$(emojiContainer).off("click mouseenter mouseleave");
angular.element($window).off("click", handleClickOutside);
$document.off("keydown", keyboardEvents);
element.remove();
}
);
}
}
})(angular);
;
;
/*! emoji-add.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("InVision")
.directive( "invEmojiAdd", Directive );
function Directive( emojiService ) {
return({
link: linkFunction,
restrict: "A",
replace: true,
scope: { 
commentTarget: "=target",
isOpen: "@"
},
templateUrl: "/assets/apps/common/ng-components/emoji/emoji-add.directive.htm"
});
function linkFunction( scope, element ) {
init();
scope.togglePopover = togglePopover;
function init() {
emojiService.setPopover( false );
emojiService.setPopoverOnModal( false );
scope.isOpen = false;
}
function togglePopover() {
scope.isOpen = !scope.isOpen;
scope.$emit("emoji:toggle", scope.isOpen, element );
}
}
}
})( angular );
;
;
/*! emoji-service.js */ 
;
;
(function( ng, app, _ ) {
"use strict";
if (typeof module !== "undefined" && module.exports) {
module.exports = EmojiService;
} else if (app) {
app.service( "emojiService", EmojiService );
}
function EmojiService( emojiValue ) {
var popoverActive          = false;
var typeaheadActive        = false;
var popoverActiveOnModal   = false;
var typeaheadActiveOnModal = false;
var flatEmojis = _.flatten( _.map( emojiValue.emojis, _.values ) );
var rEmojis = new RegExp(":(([a-z0-9_+-])+):|("+ emojiValue.faces.join("|") +")", "g");
return({
getEmojis: getEmojis,
getAllEmojis: getAllEmojis,
getCategories: getCategories,
parseEmoji: parseEmoji,
splitEmoji: splitEmoji,
findEmoji: findEmoji,
isPopoverActive: isPopoverActive,
isTypeaheadActive: isTypeaheadActive,
isPopoverActiveOnModal: isPopoverActiveOnModal,
isTypeaheadActiveOnModal: isTypeaheadActiveOnModal,
setPopover: setPopover,
setTypeahead: setTypeahead,
setPopoverOnModal: setPopoverOnModal,
setTypeaheadOnModal: setTypeaheadOnModal,
getElementBoundingCoords: getElementBoundingCoords
});
function getEmojis() {
return emojiValue.emojis;
}
function getCategories() {
return Object.keys( getEmojis() );
}
function getAllEmojis() {
return flatEmojis;
}
function isPopoverActive() {
return popoverActive;
}
function isTypeaheadActive() {
return typeaheadActive;
}
function isPopoverActiveOnModal() {
return popoverActiveOnModal;
}
function isTypeaheadActiveOnModal() {
return typeaheadActiveOnModal;
}
function setPopover( flag ) {
popoverActive = flag;
return popoverActive;
}
function setTypeahead( flag ) {
typeaheadActive = flag;
return typeaheadActive;
}
function setPopoverOnModal( flag ) {
popoverActiveOnModal = flag;
return popoverActiveOnModal;
}
function setTypeaheadOnModal( flag ) {
typeaheadActiveOnModal = flag;
return typeaheadActiveOnModal;
}
function parseEmoji( comment ) {
var icon = "";
if ( typeof comment === "undefined" || comment.split(":").length < 2 ) {
return comment;
}
return comment.replace( rEmojis, function( match, text ) {
if ( emojiValue.faceToEmojis[ match ] ) {
icon = emojiValue.faceToEmojis[ match ].emoji;
}
else if ( flatEmojis.indexOf( text ) >= 0 ) {
icon = text;
}
if ( !icon ) {
return match;
}
return "<i class='emoji-icon-comment emojis-" + icon + "' title=':" + icon + ":'></i>";
});
}
function findEmoji( q ) {
var results = [];
for ( var i = 0, nodes = flatEmojis.length; i < nodes; i++ ) {
var emoji = flatEmojis[ i ];
if ( emoji.indexOf( q ) === 0 ) {
results.push({
"label": emoji
});
}
}
return results;
}
function splitEmoji( val, index, showAll ) {
var comment = {
showAll: false
};
if ( typeof val !== "string" || val.indexOf(":") < 0 ) {
return comment;
}
var openingChar = ":";
var closingChar = " ";
var prefix = val.substring( 0, index );
var suffix = val.substring( index );
var openingCharPos = prefix.lastIndexOf( openingChar );
var closingCharPos = suffix.indexOf( closingChar );
if ( showAll && ( openingCharPos + openingChar.length === index ) ) {
comment = {
emoji: "",
showAll: true
};
return comment;
}
comment = {
before: prefix.substring( 0, openingCharPos ),
emoji: "",
after: suffix.substring( closingCharPos + closingChar.length ),
colon: openingChar
};
comment.emoji = val.substring( openingCharPos + openingChar.length, index );
if ( comment.emoji.indexOf(":") >= 0 || comment.emoji.indexOf(" ") >= 0 ) {
comment.emoji = "";
}
return comment;
}
function getElementBoundingCoords( element ) {
var coordinates = { top: 0, left: 0 };
var obj = element;
var body = document.body;
while ( obj ) {
coordinates.left += obj.offsetLeft + obj.clientLeft;
coordinates.top += obj.offsetTop + obj.clientTop;
obj = obj.offsetParent;
}
obj = element;
while ( obj !== body ) {
if ( obj &&  obj.scrollTop && obj.scrollTop > 0 ) {
coordinates.top -= obj.scrollTop;
}
if ( obj && obj.scrollLeft && obj.scrollLeft > 0 ) {
coordinates.left -= obj.scrollLeft;
}
obj = obj.parentNode;
}
return coordinates;
}
}
})( angular, InVision, _ );
;
;
/*! emoji-text.directive.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invEmojiText", EmojiTextDirective );
function EmojiTextDirective( emojiService ) {
return ({
link: linkFunction,
restrict: "A"
});
function linkFunction( $scope ) {
$scope.$on("emoji:add", addEmoji );
$scope.$on("emoji:typeahead", typeaheadEmoji );
function addEmoji( event, commentVal, emoji ) {
var emojiItem = ":" + emoji + ": ";
$scope.comment = commentVal + emojiItem; // updates the comment model
}
function typeaheadEmoji( event, emoji, caretPos ) {
var comment = "";
comment = emojiService.splitEmoji( $scope.comment, caretPos );
$scope.comment = comment.before + comment.colon + emoji + ": " + comment.after;
}
}
}
})( angular, InVision );
;
;
/*! emoji-typeahead.directive.js */ 
;
;
(function( ng, app ) {
"use strict";
ng
.module("InVision")
.directive( "invEmojiTypeahead", EmojiTypeaheadDirective );
function EmojiTypeaheadDirective(
$timeout,
$document,
emojiService,
appSettings
) {
return({
link: linkFunction,
scope: {
model: "=",
commentTarget: "=target",
isNarrow: "@"
},
restrict: "A",
replace: true,
templateUrl: "/assets/apps/common/ng-components/emoji/emoji-typeahead.directive.htm"
});
function linkFunction( $scope, element ) {
var minSearch = 2;
var HOT_KEYS = [
9,  // TAB
13, // RETURN
27, // ESC
32, // SPACE
37, // arrow left
38, // arrow up
39, // arrow right
40  // arrow down
];
var emojiIcon = "li";
var emojiAttr = "data-idx";
var textarea = element.parent().find("textarea");
var emojiList = element.find(".emoji-list");
var caretPos = 0;
var mentionEnabled = false;
var emojiPlaceholder = element.closest(".emoji-root").find(".emoji-placeholder");
var appendTo = ( emojiPlaceholder.length > 0 ) ? emojiPlaceholder : $document.find( "body" );
var isModal = element.closest(".modal").length > 0 || element.closest(".m-inbox-conversation").length;
init();
function init() {
$scope.current = 0;
$scope.items = [];
$scope.isActive = false;
$scope.isBrowsing = false;
$scope.comment = "";
emojiService.setTypeahead( false );
emojiService.setTypeaheadOnModal( false );
if ( !textarea ) {
throw new Error("Textarea not available. Please provide one");
}
}
function flush() {
$scope.current = 0;
$scope.items.length = 0;
$scope.isActive = false;
$scope.isBrowsing = false;
$scope.firstTab = true;
}
function getCaretPos( el ) {
if ( el && el.selectionStart ) {
return el.selectionStart;
} else if ( document.selection ) {
el.focus();
var sel = document.selection.createRange();
var selLen = document.selection.createRange().text.length;
sel.moveStart("character", -el.value.length);
return sel.text.length - selLen;
}
}
function setCaretPos( el, cPos ) {
if ( el.createTextRange ) {
var range = el.createTextRange();
range.move("character", cPos );
range.select();
} else {
el.focus();
if ( el.selectionStart !== undefined ) {
el.setSelectionRange( cPos, cPos );
}
}
}
function scrollToEmoji() {
var paddingOffset = 40;
var currentEmoji = $scope.items[ $scope.current ].label;
var posTop = element.find(".emojis-" + currentEmoji).position().top;
var scrollTop = emojiList.scrollTop();
if ( posTop < paddingOffset ) {
emojiList.scrollTop( scrollTop + ( posTop - paddingOffset ) );
} else if ( posTop > emojiList.height() + paddingOffset ) {
emojiList.scrollTop( scrollTop + ( posTop - emojiList.height() ) );
}
}
function updateTypeahead( showAll ) {
var splitComment = emojiService.splitEmoji( $scope.comment, caretPos, showAll );
if ( showAll && splitComment.showAll ) {
activateTypeahead( splitComment );
return;
}
if ( splitComment.emoji && splitComment.emoji.length >= minSearch ) {
activateTypeahead( splitComment );
}
}
function activateTypeahead( comment ) {
$scope.items = emojiService.findEmoji( comment.emoji );
if ( $scope.items.length <= 0 ) {
return;
}
$scope.isActive = true;
emojiService.setTypeahead( true );
emojiService.setTypeaheadOnModal( true );
appendTo.append( element );
requestAnimationFrame( function() {
var textareaCoords = emojiService.getElementBoundingCoords( textarea[ 0 ] );
var appendToCoords = emojiService.getElementBoundingCoords( appendTo[ 0 ] );
element.css({
top: textareaCoords.top - appendToCoords.top,
left: textareaCoords.left - appendToCoords.left
});
if ( isModal ) {
element.css({
zIndex: 1051
});
}
});
}
function emitEmoji() {
if ( typeof $scope.items[ $scope.current ] === "undefined" ) {
return;
}
$scope.$emit("emoji:typeahead", $scope.items[ $scope.current ].label, caretPos );
$scope.$apply();
}
function browseEmoji() {
emitEmoji();
setCaretPos( textarea[0], caretPos );
if ( $scope.items.length > 15 ) {
scrollToEmoji();
}
}
function selectEmoji() {
emitEmoji();
flush();
setCaretPos( textarea[0], $scope.model.length );
}
function keyboardEvents( event ) {
if ( !textarea.is(":focus") ) {
return;
}
var keyCode = event.which || event.keyCode;
if ( HOT_KEYS.indexOf( keyCode ) === -1 ) {
flush();
return;
}
if ( keyCode === 27 ) {
if ( !$scope.isActive ) {
emojiService.setTypeahead( false );
}
flush();
$scope.$digest();
return;
}
if ( keyCode === 9 && !$scope.isActive ) {
updateTypeahead( true );
event.preventDefault();
}
if ( !$scope.isActive ) {
return;
}
if ( keyCode === 32 ) {
flush();
$scope.$digest();
return;
}
event.preventDefault();
$scope.isBrowsing = true;
if ( keyCode === 37 || keyCode === 38 ) {
$scope.firstTab = false; // reset first tab
$scope.current = ( $scope.current === 0 ) ? $scope.items.length - 1 : $scope.current - 1;
browseEmoji();
}
else if ( keyCode === 39 || keyCode === 40 ) {
$scope.firstTab = false;
$scope.current = ( $scope.current >= $scope.items.length - 1 ) ? 0 : $scope.current + 1;
browseEmoji();
}
else if ( keyCode === 9 ) {
if ( $scope.firstTab ) {
$scope.firstTab = false;
}
else {
$scope.current = ( $scope.current >= $scope.items.length - 1 ) ? 0 : $scope.current + 1;
}
browseEmoji();
}
else if ( keyCode === 13 ) {
selectEmoji();
}
$scope.$digest();
}
textarea.on( "keydown", keyboardEvents );
element.on( "click", emojiIcon, function( e ) {
selectEmoji();
});
element.on( "mouseenter", emojiIcon, function( e ) {
$scope.current = parseInt( this.getAttribute( emojiAttr ), 10 );
$scope.$digest();
});
$scope.$watch("model", function( newValue, oldValue ) {
if ( newValue === oldValue ) {
return;
}
if ( $scope.isBrowsing ) {
return;
}
caretPos = getCaretPos( textarea[0] );
$scope.comment = newValue;
flush();
updateTypeahead();
});
$scope.$on(
"$destroy",
function() {
textarea.off( "keydown", keyboardEvents );
element.off( "click mouseenter" );
emojiService.setTypeahead( false );
emojiService.setTypeaheadOnModal( false );
element.remove();
}
);
}
}
})( angular, InVision );
;
;
/*! emoji-value.js */ 
;
;
(function( ng, app ) {
"use strict";
var emojiValue = {
emojis: {
"grinning": [
"grinning",
"grin",
"joy",
"smiley",
"smile",
"sweat_smile",
"satisfied",
"innocent",
"smiling_imp",
"wink",
"blush",
"yum",
"relieved",
"heart_eyes",
"sunglasses",
"smirk",
"neutral_face",
"expressionless",
"unamused",
"sweat",
"pensive",
"confused",
"confounded",
"kissing",
"kissing_heart",
"kissing_smiling_eyes",
"kissing_closed_eyes",
"stuck_out_tongue",
"stuck_out_tongue_winking_eye",
"stuck_out_tongue_closed_eyes",
"disappointed",
"worried",
"angry",
"rage",
"cry",
"persevere",
"triumph",
"disappointed_relieved",
"frowning",
"anguished",
"fearful",
"weary",
"sleepy",
"tired_face",
"grimacing",
"sob",
"open_mouth",
"hushed",
"cold_sweat",
"scream",
"astonished",
"flushed",
"sleeping",
"dizzy_face",
"no_mouth",
"relaxed",
"mask",
"smile_cat",
"joy_cat",
"smiley_cat",
"heart_eyes_cat",
"smirk_cat",
"kissing_cat",
"pouting_cat",
"crying_cat_face",
"scream_cat",
"no_good",
"ok_woman",
"bow",
"see_no_evil",
"hear_no_evil",
"speak_no_evil",
"raising_hand",
"person_frowning",
"person_with_pouting_face",
"bust_in_silhouette",
"busts_in_silhouette",
"boy",
"girl",
"man",
"woman",
"family",
"couple",
"two_men_holding_hands",
"two_women_holding_hands",
"cop",
"dancers",
"bride_with_veil",
"person_with_blond_hair",
"man_with_gua_pi_mao",
"man_with_turban",
"older_man",
"older_woman",
"baby",
"construction_worker",
"princess",
"japanese_ogre",
"japanese_goblin",
"ghost",
"angel",
"alien",
"space_invader",
"imp",
"skull",
"information_desk_person",
"guardsman"
],
"ok": [
"eyes",
"ear",
"nose",
"lips",
"tongue",
"point_up",
"fist",
"raised_hands",
"raised_hand",
"v",
"point_up_2",
"point_down",
"point_left",
"point_right",
"punch",
"wave",
"ok_hand",
"thumbsup",
"thumbsdown",
"clap",
"open_hands",
"rat",
"mouse2",
"ox",
"water_buffalo",
"cow2",
"tiger2",
"leopard",
"rabbit2",
"cat2",
"dragon",
"crocodile",
"whale2",
"snail",
"snake",
"racehorse",
"ram",
"goat",
"sheep",
"monkey",
"rooster",
"chicken",
"dog2",
"pig2",
"boar",
"elephant",
"octopus",
"shell",
"bug",
"ant",
"honeybee",
"beetle",
"fish",
"tropical_fish",
"blowfish",
"turtle",
"hatching_chick",
"baby_chick",
"hatched_chick",
"bird",
"penguin",
"koala",
"poodle",
"dromedary_camel",
"camel",
"dolphin",
"mouse",
"cow",
"tiger",
"rabbit",
"cat",
"dragon_face",
"whale",
"horse",
"monkey_face",
"dog",
"pig",
"frog",
"hamster",
"wolf",
"bear",
"panda_face",
"pig_nose",
"paw_prints"
],
"hamburger": [
"hamburger",
"coffee",
"pizza",
"meat_on_bone",
"poultry_leg",
"rice_cracker",
"rice_ball",
"rice",
"curry",
"ramen",
"spaghetti",
"bread",
"fries",
"sweet_potato",
"dango",
"oden",
"sushi",
"fried_shrimp",
"fish_cake",
"icecream",
"shaved_ice",
"ice_cream",
"doughnut",
"cookie",
"chocolate_bar",
"candy",
"lollipop",
"custard",
"honey_pot",
"cake",
"bento",
"stew",
"egg",
"fork_and_knife",
"tea",
"sake",
"wine_glass",
"cocktail",
"tropical_drink",
"beer",
"beers",
"baby_bottle",
"mushroom",
"tomato",
"eggplant",
"grapes",
"melon",
"watermelon",
"tangerine",
"lemon",
"banana",
"pineapple",
"apple",
"green_apple",
"pear",
"peach",
"cherries",
"strawberry",
"chestnut",
"seedling",
"evergreen_tree",
"deciduous_tree",
"palm_tree",
"cactus",
"tulip",
"cherry_blossom",
"rose",
"hibiscus",
"sunflower",
"blossom",
"corn",
"ear_of_rice",
"herb",
"four_leaf_clover",
"maple_leaf",
"fallen_leaf",
"leaves"
],
"star": [
"star",
"sunny",
"cloud",
"telephone",
"umbrella",
"spades",
"clubs",
"hearts",
"diamonds",
"recycle",
"wheelchair",
"warning",
"copyright",
"registered",
"tm",
"zap",
"soccer",
"baseball",
"snowman",
"partly_sunny",
"no_entry",
"golf",
"sailboat",
"fuelpump",
"scissors",
"ballot_box_with_check",
"white_check_mark",
"airplane",
"envelope",
"pencil2",
"black_nib",
"heavy_check_mark",
"heavy_multiplication_x",
"sparkles",
"snowflake",
"x",
"negative_squared_cross_mark",
"question",
"heavy_exclamation_mark",
"bangbang",
"interrobang",
"heart",
"heavy_plus_sign",
"heavy_minus_sign",
"heavy_division_sign",
"o",
"black_joker",
"cyclone",
"foggy",
"closed_umbrella",
"sunrise",
"ocean",
"earth_africa",
"earth_americas",
"earth_asia",
"globe_with_meridians",
"full_moon_with_face",
"sun_with_face",
"star2",
"ribbon",
"gift",
"birthday",
"jack_o_lantern",
"christmas_tree",
"santa",
"fireworks",
"sparkler",
"balloon",
"tada",
"confetti_ball",
"tanabata_tree",
"crossed_flags",
"bamboo",
"dolls",
"flags",
"wind_chime",
"rice_scene",
"school_satchel",
"mortar_board",
"microphone",
"movie_camera",
"cinema",
"headphones",
"art",
"tophat",
"circus_tent",
"ticket",
"clapper",
"performing_arts",
"video_game",
"dart",
"slot_machine",
"8ball",
"game_die",
"bowling",
"flower_playing_cards",
"musical_note",
"notes",
"saxophone",
"guitar",
"musical_keyboard",
"trumpet",
"violin",
"musical_score",
"tennis",
"ski",
"basketball",
"checkered_flag",
"snowboarder",
"running",
"surfer",
"trophy",
"horse_racing",
"football",
"rugby_football",
"swimmer",
"dancer",
"lipstick",
"nail_care",
"massage",
"haircut",
"barber",
"syringe",
"pill"
],
"bulb": [
"bulb",
"kiss",
"love_letter",
"ring",
"gem",
"couplekiss",
"bouquet",
"couple_with_heart",
"wedding",
"heartbeat",
"broken_heart",
"two_hearts",
"sparkling_heart",
"heartpulse",
"cupid",
"blue_heart",
"green_heart",
"yellow_heart",
"purple_heart",
"gift_heart",
"revolving_hearts",
"heart_decoration",
"diamond_shape_with_a_dot_inside",
"anger",
"bomb",
"zzz",
"collision",
"sweat_drops",
"droplet",
"dash",
"shit",
"muscle",
"dizzy",
"speech_balloon",
"thought_balloon",
"heavy_dollar_sign",
"credit_card",
"yen",
"dollar",
"euro",
"pound",
"money_with_wings",
"seat",
"computer",
"briefcase",
"minidisc",
"floppy_disk",
"cd",
"dvd",
"file_folder",
"open_file_folder",
"page_with_curl",
"page_facing_up",
"date",
"card_index",
"chart_with_upwards_trend",
"chart_with_downwards_trend",
"bar_chart",
"pushpin",
"round_pushpin",
"paperclip",
"notebook",
"book",
"books",
"pencil",
"telephone_receiver",
"pager",
"fax",
"satellite",
"loudspeaker",
"mega",
"outbox_tray",
"inbox_tray",
"package",
"mailbox_closed",
"mailbox",
"mailbox_with_mail",
"mailbox_with_no_mail",
"postbox",
"postal_horn",
"newspaper",
"iphone",
"no_mobile_phones",
"camera",
"video_camera",
"tv",
"radio",
"vhs",
"low_brightness",
"high_brightness",
"mute",
"sound",
"speaker",
"battery",
"electric_plug",
"mag",
"mag_right",
"lock_with_ink_pen",
"closed_lock_with_key",
"key",
"lock",
"unlock",
"bell",
"no_bell",
"bookmark",
"link",
"radio_button",
"underage",
"fire",
"flashlight",
"wrench",
"hammer",
"nut_and_bolt",
"hocho",
"gun",
"microscope",
"telescope",
"crystal_ball",
"clock3",
"pray"
],
"rocket": [
"rocket",
"helicopter",
"steam_locomotive",
"train",
"bullettrain_side",
"bullettrain_front",
"train2",
"light_rail",
"station",
"tram",
"bus",
"oncoming_bus",
"trolleybus",
"busstop",
"minibus",
"ambulance",
"fire_engine",
"police_car",
"oncoming_police_car",
"taxi",
"oncoming_taxi",
"red_car",
"oncoming_automobile",
"blue_car",
"truck",
"articulated_lorry",
"tractor",
"monorail",
"mountain_railway",
"suspension_railway",
"mountain_cableway",
"aerial_tramway",
"ship",
"rowboat",
"speedboat",
"traffic_light",
"vertical_traffic_light",
"construction",
"rotating_light",
"triangular_flag_on_post",
"door",
"house",
"house_with_garden",
"european_post_office",
"convenience_store",
"school",
"no_entry_sign",
"smoking",
"no_smoking",
"put_litter_in_its_place",
"bike",
"no_bicycles",
"bicyclist",
"mountain_bicyclist",
"walking",
"no_pedestrians",
"mens",
"womens",
"toilet",
"shower",
"bath",
"bathtub",
"cn",
"de",
"es",
"fr",
"uk",
"it",
"jp",
"kr",
"ru",
"us"
]
},
faces: [
":\\)", // :)
":\\|", // :|
":\\(", // :(
":\D",  // :D
":\P",  // :P
"\D:"   // D:
],
faceToEmojis: {
":)": {
emoji: "smile"
},
":|": {
emoji: "neutral_face"
},
":(": {
emoji: "disappointed"
},
":D": {
emoji: "smiley"
},
":P": {
emoji: "stuck_out_tongue"
},
"D:": {
emoji: "anguished"
}
}
};
if (app) {
app.value("emojiValue", emojiValue);	
}
if (typeof module !== "undefined" && module.exports) {
module.exports = emojiValue;
}
})( angular, InVision );
;
;
/*! mention.controller.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention", [])
.controller( "mention.MentionController", mentionController );
function mentionController(
_,
appSettings,
candidatesPartial,
config,
mentionService,
mentionShortcutService,
mentionStorage,
$scope
) {
var vm = this;
var MAX_MATCHES = 250;
vm.searchPeople = searchPeople;
vm.selectPerson = selectPerson;
vm.addMention = addMention;
initialize();
function initialize() {
if (!$scope.hasMentions) {
return;
}
candidatesPartial.load();
}
/**
* Takes the existingMention data and extracts the human-readable
* term, returning it.
*
* @param {Object} existingMention - mention data from the getMentionedUser method
* @returns {String} the extracted, human-readable term
*/
function getTermFromExistingMention( existingMention ) {
if ( existingMention.email ) {
return existingMention.email;
}
return existingMention.name;
}
/**
* Replaces the existing, encoded mention text with a readable
* version of the mention, and returns that readable version
*
* @param {Object} existingMention - mention data from the getMentionedUser method
* @param {Object} mentionInfo - mention data from the getTriggerInfo method
* @returns {String} the extracted, human-readable term
*/
function handleExistingMention( existingMention, mentionInfo ) {
var startPos = mentionInfo.mentionPosition;
var endPos = startPos + mentionInfo.mentionText.length + 1;
var term = getTermFromExistingMention( existingMention );
mentionService.replaceInputText(
mentionInfo.mentionSelectedElement,
mentionInfo.mentionTriggerChar + term,
startPos,
endPos
);
return term;
}
/**
* Loops over the `people` array and returns a new array where
* the appropriate values (determined by triggerChar) match the
* specified term
*
* @param {String} triggerChar - determines which filter algorithm to use
* @param {String} currentTerm - the value that will be matched against
* @returns {Array} the filtered list of people
*/
function generatePeopleList( triggerChar, currentTerm ) {
var term = currentTerm || "";
var upperCaseTerm = term.toUpperCase();
var mentionShortcuts = buildShortcuts();
var handlers = {
"@": function handleMentions( item ) {
var name = item.name.replace( /\s*/g, "" ).toUpperCase();
return ~name.indexOf( upperCaseTerm );
},
"+": function handleEmailMentions( item ) {
var email = ( item.email || "" ).toUpperCase();
return ~email.indexOf( upperCaseTerm );
}
};
var handler = handlers[triggerChar] || function noop() {};
var matches = _.filter( mentionShortcuts.concat(candidatesPartial.data.candidates.candidates), handler );
if (matches.length > MAX_MATCHES) {
return {
isOverMax: true,
matches: []
};
}
return {
isOverMax: false,
matches: matches
};
}
function searchPeople( mentionInfo ) {
var term = mentionInfo.mentionText || "";
var triggerChar = mentionInfo.mentionTriggerChar;
var existingMention = mentionService.getMentionedUser( term );
if ( existingMention ) {
term = handleExistingMention( existingMention, mentionInfo );
}
var peopleList = generatePeopleList( triggerChar, term );
var peopleListIsPopulated = peopleList.matches.length > 0;
var termHasValue = term.length > 0;
var isMention = triggerChar === "@";
var isDefaultView = isMention && !termHasValue;
var noMatches = isMention && termHasValue && !peopleListIsPopulated && !peopleList.isOverMax;
var overMax = isMention && termHasValue && peopleList.isOverMax;
var isNewUser = isMention && term.length > 2 && !peopleListIsPopulated;
vm.view = "default";
if ( isDefaultView ) {
vm.view = "defaultNoTerm";
}
if ( noMatches ) {
vm.view = "noCandidates";
}
if ( overMax ) {
vm.view = "overMax";
}
if ( isNewUser ) {
vm.view = "newUser";
}
vm.people = peopleList.matches;
}
function selectPerson( person ) {
var triggerChar = "@";
var name = person.name.replace( /\s/g, "" );
var id = person.id;
var isShortcut = person.role === "shortcut";
if ( !id && !isShortcut ) {
triggerChar = "+";
id = mentionService.isEmailAddress( person.email ) ? person.email : null;
name = id;
}
if ( id || isShortcut ) {
return triggerChar + name;
}
return person.name;
}
function addMention( person, startPos ) {
mentionStorage.insert( person, startPos );
}
function buildShortcuts() {
var hasMentionShortcuts = appSettings.getSettings().features.mentionShortcut;
if (!hasMentionShortcuts) {
return [];
}
var shortcuts = mentionShortcutService.getShortcuts();
if(
config.featureFlags["prototypes-rain-690-sunset-conversation"] ||
config.featureFlags["boards-rain-687-sunset-conversation"]
) {
return [_.find(shortcuts, function(s) {
return s.name === "project";
})];
}
return shortcuts;
}
}
})( angular );
;
;
/*! mention.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.directive( "invMention", MentionDirective );
function MentionDirective() {
return ({
controller: "mention.MentionController",
controllerAs: "vm",
restrict: "A",
templateUrl: "/assets/apps/common/ng-components/mention/mention.directive.htm",
scope: {
uid: "@uid",
hasWhoIsNotified: "@hasWhoIsNotified",
hasMentions: "=hasMentions",
conversation: "=conversation",
screenId: "=screenId",
boardId: "=boardId",
mentionPositioningClass: "@?"
}
});
}
})( angular );
;
;
/*! utility.js */ 
;
;

;
;
/*! order-by-user-role.filter.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.filter("orderByUserRole", orderByUserRoleFilter );
function orderByUserRoleFilter( _ ) {
return function( input ) {
if ( !Array.isArray( input ) ) {
return input;
}
var CONTRIBUTOR = "Contributor";
var REVIEWER = "Reviewer";
var ADMIN = "Admin";
var MANAGER = "Manager";
var collaborators = [];
var others = [];
for ( var i = 0, nodes = input.length; i < nodes; i++ ) {
var userRole = input[ i ].role;
switch ( userRole ) {
case CONTRIBUTOR:
case REVIEWER:
case ADMIN:
case MANAGER:
collaborators.push( input[ i ] );
break;
default:
others.push( input[ i ] );
break;
}
}
var sortedCollaborators = _.sortBy( collaborators, "name" );
var sortedOthers = _.sortBy( others, "name" );
return sortedCollaborators.concat( sortedOthers );
};
}
})( angular );
;
;
/*! unsafe.filter.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.filter("unsafe", function( $sce ) {
return function( val ) {
return $sce.trustAsHtml( val );
};
});
})( angular );
;
;
/*! mention-menu-item.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.directive( "invMentionMenuItem", mentionMenuItemDirective );
function mentionMenuItemDirective() {
return ({
restrict: "A",
scope: {
item: "=invMentionMenuItem"
},
require: "^invMentionMenu",
link: function( scope, element, attrs, controller ) {
scope.$watch(function() {
return controller.isActive( scope.item );
}, function( active ) {
if ( active ) {
element.addClass("active");
} else {
element.removeClass("active");
}
});
element.bind("mouseenter", function() {
if(!(controller.isOverMentionCap(scope.item.name)  && scope.item.role === "shortcut")) {
scope.$apply(function() {
controller.activate( scope.item );
});
}
});
element.bind("click", function() {
if(!(controller.isOverMentionCap(scope.item.name) && scope.item.role === "shortcut")) {
controller.selectItem( scope.item );
}
return false;
});
}
});
}
})( angular );
;
;
/*! mention-menu.controller.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.controller( "mention.MenuController", menuController );
function menuController(
$scope,
_,
appSettings,
config,
candidatesPartial,
mentionShortcutService
) {
var vm = this;
var props = $scope.props = $scope;
props.visible = false;
vm.getInitials = getInitials;
vm.getUserInfo = getUserInfo;
vm.activate = props.activate = activate;
vm.isActive = props.isActive = isActive;
vm.selectItem = props.selectItem = selectItem;
vm.hasMentionShortcuts = appSettings.getSettings().features.mentionShortcut;
vm.isOverMentionCap = props.isOverMentionCap = isOverMentionCap;
vm.conversationDisabled = config.featureFlags["prototypes-rain-690-sunset-conversation"];
props.activateNextItem = activateNextItem;
props.activatePreviousItem = activatePreviousItem;
props.isFirstItemActive = isFirstItemActive;
props.isLastItemActive = isLastItemActive;
props.selectActive = selectActive;
props.isVisible = isVisible;
props.showMenu = showMenu;
props.setParent = setParent;
function getInitials( name ) {
if ( !name ) {
return ("");
}
var nameParts = name.replace( /^\s+|\s+$/g, "" ).split( /\s+/ );
var namePartsCount = nameParts.length;
if ( namePartsCount > 1 ) {
return (
nameParts[ 0 ].slice( 0, 1 ) +
nameParts[ namePartsCount - 1 ].slice( 0, 1 )
);
}
return ( nameParts[ 0 ].slice( 0, 1 ) );
}
function getUserInfo( person ) {
if ( vm.hasMentionShortcuts ) {
return mentionShortcutService.getUserInfo(person, candidatesPartial.data);
}
return person.email;
}
function activate( item ) {
props.activeItem = item;
}
function isActive( item ) {
return props.activeItem === item;
}
function selectItem( item ) {
var text = props.select({
item: item
});
var startPos = props.parentMentio.replaceText( text );
props.addMention({
person: item,
startPos: startPos
});
}
function activateNextItem() {
var index = props.items.indexOf(props.activeItem);
activate(props.items[(index + 1) % props.items.length]);
}
function activatePreviousItem() {
var index = props.items.indexOf(props.activeItem);
activate(props.items[index === 0 ? props.items.length - 1 : index - 1]);
}
function isFirstItemActive() {
var index = props.items.indexOf(props.activeItem);
return index === 0;
}
function isLastItemActive() {
var index = props.items.indexOf( props.activeItem );
return index === (props.items.length - 1);
}
function selectActive() {
if ( !props.activeItem ) {
return;
}
props.selectItem( props.activeItem );
}
function isVisible() {
return props.visible;
}
function isOverProjectMentionsCap () {
return candidatesPartial.data.candidates.isOverProjectMentionCap ? "project": false;
}
function isOverConversationMentionsCap () {
return candidatesPartial.data.candidates.isOverConversationMentionCap ? "conversation": false;
}
function isOverMentionCap(itemName) {
if(itemName) {
return (isOverProjectMentionsCap() === itemName || isOverConversationMentionsCap() === itemName)? itemName: false;
}
return isOverProjectMentionsCap() || isOverConversationMentionsCap();
}
function showMenu() {
if ( !props.visible ) {
props.requestVisiblePendingSearch = true;
}
}
function setParent( scope ) {
props.parentMentio = scope;
props.targetElement = scope.targetElement;
}
}
})( angular );
;
;
/*! mention-menu.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.directive( "invMentionMenu", mentionMenuDirective );
function mentionMenuDirective(
mentionService,
$rootScope,
$log,
$window,
$document
) {
return ({
restrict: "A",
scope: {
search: "&mentioSearch",
select: "&mentioSelect",
addMention: "&addMention",
items: "=mentioItems",
view: "=mentioView",
triggerChar: "=mentioTriggerChar",
forElem: "=mentioFor",
mentionPositioningClass: "@?"
},
templateUrl: "/assets/apps/common/ng-components/mention/menu/mention-menu.directive.htm",
controller: "mention.MenuController",
controllerAs: "vm",
link: function( scope, element, attr ) {
if ( !scope.forElem ) {
$log.error("mentio-menu requires a target element in the mentio-for attribute");
return;
}
if ( !scope.triggerChar ) {
$log.error("mentio-menu requires a trigger char");
return;
}
var HOT_KEYS = [
9,  // TAB
13, // RETURN
27, // ESC
37, // arrow left
38, // arrow up
39, // arrow right
40  // arrow down
];
var textarea = element.closest(".comment-wrapper").find("textarea.mention-text");
textarea.on( "keydown paste", handleKeyEvent );
angular.element( $document ).on( "click", handleClick );
angular.element( $window ).on( "resize", handleResize );  // Do we need this?
scope.$on("$destroy", handleDestroy );
$rootScope.$broadcast("menuCreated", {
targetElement: attr.mentioFor,
scope: scope
});
scope.$watch("items", function( items ) {
if ( items && items.length >= 0 ) {
scope.activate( items[0] );
if ( !scope.visible && scope.requestVisiblePendingSearch) {
scope.visible = true;
scope.requestVisiblePendingSearch = false;
}
triggerPopUnderMention();
} else {
scope.hideMenu();
}
});
scope.$watch("isVisible()", function( visible ) {
if ( visible ) {
triggerPopUnderMention();
}
});
function triggerPopUnderMention() {
var triggerCharSet = [];
triggerCharSet.push(scope.triggerChar);
mentionService.popUnderMention(
scope.parentMentio.context(),
triggerCharSet,
element,
scope.requireLeadingSpace,
textarea
);
}
scope.hideMenu = function() {
scope.visible = false;
element.css("display", "none");
};
scope.adjustScroll = function( direction ) {
var menuEl = element[0];
var menuItemsList = menuEl.querySelector("ul");
if ( !menuItemsList ) {
return;
}
var menuItem = (menuEl.querySelector("[inv-mention-menu-item].active") ||
menuEl.querySelector("[data-inv-mention-menu-item].active"));
if ( scope.isFirstItemActive() ) {
menuItemsList.scrollTop = 0;
return;
} else if ( scope.isLastItemActive() ) {
menuItemsList.scrollTop = menuItemsList.scrollHeight;
return;
}
if ( direction === 1 ) {
menuItemsList.scrollTop += menuItem.offsetHeight;
} else {
menuItemsList.scrollTop -= menuItem.offsetHeight;
}
};
function handleKeyEvent( event ) {
if ( !textarea.is(":focus") ) {
return;
}
var keyCode = event.which || event.keyCode;
if ( ! scope.visible || HOT_KEYS.indexOf( keyCode ) === -1 ) {
return;
}
event.preventDefault();
if ( keyCode === 9 || keyCode === 13 ) {
if(scope.isOverMentionCap(scope.activeItem.name)) {
scope.hideMenu();
return;
}
scope.selectActive();
return;
}
if ( keyCode === 27 ) {
scope.$apply(function() {
scope.hideMenu();
});
return;
}
if ( keyCode === 40 ) {
scope.$apply(function() {
scope.activateNextItem();
});
scope.adjustScroll(1);
return;
}
if ( keyCode === 38 ) {
scope.$apply(function() {
scope.activatePreviousItem();
});
scope.adjustScroll(-1);
return;
}
}
function handleClick( event ) {
if ( scope.visible ) {
scope.$apply(function() {
scope.hideMenu();
});
}
}
function handleResize() {
if ( scope.visible ) {
var triggerCharSet = [];
triggerCharSet.push( scope.triggerChar );
mentionService.popUnderMention(
scope.parentMentio.context(),
triggerCharSet,
element,
scope.requireLeadingSpace
);
}
}
function handleDestroy() {
scope.hideMenu();
textarea.off( "keydown paste", handleKeyEvent );
angular.element( $document ).off( "click", handleClick );
angular.element( $window ).off( "resize", handleResize );
}
}
});
}
})( angular );
;
;
/*! candidates-partial.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.factory( "candidatesPartial", CandidatesPartialFactory );
function CandidatesPartialFactory( $http, $q, commentObjectService ) {
var data = {};
return {
data: data,
load: load
};
function load() {
var deferred = $q.defer();
getCandidates().then(
function handleResolve( partial ) {
setData( partial.candidates );
deferred.resolve();
},
function handleReject( response ) {
deferred.reject( response );
}
);
return( deferred.promise );
}
function getCandidates() {
var commentObject = commentObjectService.get();
var apiUrl = ["/api/mentions/candidates?"];
if ( commentObject.objectType === "project" ) {
apiUrl.push(
"projectID=",
commentObject.objectID,
"&conversationID=",
commentObject.conversationID
);
} else if ( commentObject.objectType === "board" ) {
apiUrl.push(
"boardID=",
commentObject.objectID,
"&boardItemID=",
commentObject.conversationID
);
}
apiUrl.push("&hasMentionShortcuts=true");
var request = $http.get( apiUrl.join("") );
return request.then(
function handleResolve( response ) {
return response.data;
},
function handleReject( errorResponse ) {
return $q.reject( unwrapErrorResponse( errorResponse ) );
}
);
}
function unwrapErrorResponse( errorResponse ) {
var response = {
code: -1,
id: -1
};
try {
response = ng.fromJson( errorResponse.data );
if ( ng.isString( response ) ) {
response.message = response;
}
} catch( error ) {
response.message = "Error: " + error;
}
return response;
}
function setData( partial ) {
return( data.candidates = partial );
}
function deleteData() {
delete( data.candidates );
}
}
})( angular );
;
;
/*! item-owner-partial.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.factory( "itemOwnerPartial", ItemOwnerPartial );
function ItemOwnerPartial(
_,
$q,
$http,
$rootScope
) {
var data = {
itemOwners: []
};
var bindings = [];
var pendingTrigger = false;
return {
get: get,
load: load,
addBinding: addBinding,
removeBinding: removeBinding
};
function get( itemID, type ) {
if ( !itemID ) {
return;
}
var existingItem = _.find(data.itemOwners, { itemID: itemID, type: type });
return ng.copy( existingItem );
}
function load( itemID, type ) {
var deferred = $q.defer();
if ( !itemID ) {
deferred.reject("Error: undefined itemID");
return deferred.promise;
}
getOwner( itemID, type ).then(
function handleResolve( partial ) {
setData( partial, itemID, type );
deferred.resolve();
triggerChange();
},
function handleReject( response ) {
deferred.reject( response );
}
);
return( deferred.promise );
}
function addBinding( handler, context ) {
bindings.push({
handler: handler,
context: ( context || null )
});
}
function removeBinding( handler, context ) {
bindings = _.reject(
bindings,
function operator( binding ) {
return(
( binding.handler === handler ) && 
( ! context || ( handler.context === context ) )
);
}
);
}
function getOwner( itemID, type ) {
var typeURLPart = type === "screen" ? "screens" : "board";
var urlParts = ["/api", typeURLPart, itemID, "owner"];
var request = $http({
method: "GET",
url: ( urlParts.join("/") )
});
return request.then(
function handleResolve( response ) {
return response.data;
},
function handleReject( errorResponse ) {
return $q.reject( unwrapErrorResponse( errorResponse ) );
}
);
}
function setData( partial, itemID, type ) {
var existingItem = _.find(data.itemOwners, { itemID: itemID, type: type });
if ( !!existingItem ) {
return;
}
else {
data.itemOwners.push({
itemID: itemID,
type: type,
id: partial.id,
name: partial.name,
avatarID: partial.avatarID,
email: partial.email
});
}
triggerChange();
}
function triggerChange() {
if ( pendingTrigger ) {
return;
}
pendingTrigger = true;
$rootScope.$evalAsync(
function async() {
pendingTrigger = false;
_.each(
bindings,
function iterator( binding ) {
binding.handler.call( binding.context );
}
);
}
);
}
function unwrapErrorResponse( errorResponse ) {
var response = {
code: -1,
id: -1
};
try {
response = ng.fromJson( errorResponse.data );
if ( ng.isString( response ) ) {
response.message = response;
}
} catch( error ) {
response.message = "Error: " + error;
}
return response;
}
}
})( angular );
;
;
/*! mention-storage.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.factory( "mentionStorage", MentionStorage );
function MentionStorage(
_,
mentionUtilityService,
modelEvents,
sessionService
) {
var mentions = [];
var owner = {};
var watchers = [];
return {
load: load,
get: get,
getWhoIsNotified: getWhoIsNotified,
set: set,
insert: insert,
removeMention: removeMention,
setOwner: setOwner,
setWatchers: setWatchers,
destroy: destroy
};
function load() {
flush();
}
function get() {
return ng.copy( mentions );
}
function getWhoIsNotified() {
var currentMentions = getMentions();
var splitMentions = _.partition(currentMentions, function(o) { return o.userID; });
var uniqueEmails = _.uniq(splitMentions[1], "email");
return uniqueEmails.concat(_.uniq(splitMentions[0], "userID"));
}
function set( newMentions ) {
mentions = _.uniq( ng.copy( newMentions ) || [] );
modelEvents.trigger("MentionStorageUpdated");
}
function insert( person, startPos ) {
if ( ! person ) {
return;
}
var people = [].concat( person );
var text;
var item;
var newMention;
var i = 0;
var nodes = people.length;
var acceptDupes = ( startPos >= 0 );
for ( ; i < nodes; i++ ) {
item = people[ i ];
if ( ! mentionUtilityService.isNewMention( item, mentions, acceptDupes ) ) {
continue;
}
if ( item.email && ! item.id ) {
text = "+" + item.email;
} else {
text = item.text || "@" + item.name.replace(/\s/g, "");
}
newMention = {
userID: item.userID || item.id,
text: text,
name: item.name,
startPos: item.startPos || startPos
};
if ( ! mentionExists( newMention ) ) {
mentions.push( newMention );
}
}
modelEvents.trigger("MentionStorageUpdated");
}
function removeMention( text, startPos ) {
var itemID = _.findIndex( mentions, { "startPos": startPos } );
if ( itemID >= 0 ) {
mentions.splice( itemID, 1 );
modelEvents.trigger("MentionStorageUpdated");
}
}
function setOwner( item ) {
if ( ! item ) {
return;
}
owner = item;
modelEvents.trigger("MentionStorageUpdated");
}
function setWatchers( items ) {
if ( _.isEmpty( items ) ) {
return;
}
watchers = items;
modelEvents.trigger("MentionStorageUpdated");
}
function destroy() {
flush();
}
function getMentions() {
if ( _.isEmpty( owner ) && _.isEmpty( watchers ) ) {
return mentions;
}
if ( watchers.length ) {
return mentions.concat( watchers );
}
if ( hasItemOwner() ) {
return mentions;
}
var user = sessionService.user;
if ( +owner.id === user.id ) {
return mentions;
}
var returnedOwner = ng.copy( owner );
returnedOwner.name += " (screen owner)";
return mentions.concat( returnedOwner );
}
function mentionExists( newMention ) {
return ( _.findIndex(mentions, function( m ) {
var matching = m.text === newMention.text &&
m.startPos === newMention.startPos;
if ( newMention.userID !== undefined ) {
return matching && newMention.userID === m.userID;
} else {
return matching && newMention.email === m.email;
}
}) > -1 );
}
function flush() {
mentions.length = 0;
}
/*
* I check if mentions array already contains the screenOnwer
* @return {Boolean}
*/
function hasItemOwner() {
var matches = mentions.filter( function( mention ) {
return mention.userID === owner.id;
});
return ( matches.length > 0 );
}
}
})( angular );
;
;
/*! mention-utility.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.factory( "mentionUtilityService", MentionUtilityService );
function MentionUtilityService(
_,		
sessionService
) {
return {
isNewMention: isNewMention,
getMyMentions: getMyMentions,
getUserDetails: getUserDetails
};
/*
** I check if the passed item can be a new mention
** @param {Object} item
** @param {Boolean} acceptDupes - if true, don't check possible duplicates
** @return {Boolean}
*/
function isNewMention( item, mentions, acceptDupes ) {
var userID = item.userID || item.id;
if ( sessionService.user.id === userID ) {
return false;
}
if ( acceptDupes ) {
return true;
}
if ( _.some( mentions, { "userID": userID } ) ) {
return false;
}
return true;
}
/*
** I parse all the passed mentions
** removing duplicates and the current user
** @return {Boolean}
*/
function getMyMentions() {
var args = _.flatten( [].slice.call( arguments ) );
var myMentions = [];
_.forEach( args, function( value, key ) {	
if ( isNewMention( value, myMentions ) ) {
myMentions.push( value );
}
} );
return _.uniq( myMentions, "text" );
}
function getUserDetails( comment ) {
if ( _.isEmpty( comment ) ) {
return {};
}
if ( comment.user ) {
return comment.user;
}
return {
userID: comment.userID,
name: comment.userName
};
}
}
})( angular );
;
;
/*! mention.service.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.factory( "mentionService", MentionService );
function MentionService(
_,
$window,
$document,
$log,
sessionService,
mentionStorage
) {
var MENTION_PATTERN = "(?:@|\\+)(\\[[^\\]]+?\\])";
var READABLE_MENTION_STRINGPATTERN = "(^|\\s)((?:\\+|@)[^\\s]*)";
var SQUARE_BRACKET_CONTENTS_PATTERN = /^\[([^\]]+?)\]$/;
var NAME_AND_ID_PATTERN = /(^[^\|]+?)(?:\|)(.+)$/;
var EMAIL_ADDRESS_PATTERN = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
function popUnderMention( ctx, triggerCharSet, selectionEl, requireLeadingSpace, textarea ) {
var coordinates;
var mentionInfo = getTriggerInfo( ctx, triggerCharSet, requireLeadingSpace, false );
if ( ! mentionInfo ) {
selectionEl.css({
display: "none"
});
return;
}
coordinates = getTextAreaOrInputUnderlinePosition( ctx, getDocument(ctx).activeElement, mentionInfo.mentionPosition );
selectionEl.css({
top: coordinates.top + "px",
left: coordinates.left + "px",
position: "absolute",
display: "block"
});
$document.find( "body" ).append( selectionEl );
requestAnimationFrame( function() {
var box = getElementBoundingCoords( selectionEl );
var textareaCoords = getElementBoundingCoords( textarea );
if ( ! box || ! textareaCoords ) {
return;
}
var topOffset = box.height + 60;  
var newTop = coordinates.top - box.height;
if ( coordinates.top < topOffset ) {
newTop = textareaCoords.bottom + 30;
}
selectionEl.css({
top: newTop
});
});
}
function getElementBoundingCoords( element ) {
if ( !element ) {
return;
}
var clientRectangle;
var el = element[ 0 ];
while ( typeof clientRectangle === "undefined" || clientRectangle.height === 0 ) {
clientRectangle = el.getBoundingClientRect();
if ( clientRectangle.height === 0 ) {
el = el.childNodes[ 0 ];
}
if ( ! el || ! el.getBoundingClientRect ) {
return;
}
}
return clientRectangle;
}
function scrollIntoView( ctx, elem, clientRect ) {
var reasonableBuffer = 20;
var maxScrollDisplacement = 100;
var elemTop = clientRect.top;
var elemBottom = elemTop + clientRect.height;
if ( elemTop < 0 ) {
$window.scrollTo(0, $window.pageYOffset + clientRect.top - reasonableBuffer);
} else if (elemBottom > $window.innerHeight) {
var maxY = $window.pageYOffset + clientRect.top - reasonableBuffer;
if (maxY - $window.pageYOffset > maxScrollDisplacement) {
maxY = $window.pageYOffset + maxScrollDisplacement;
}
var targetY = $window.pageYOffset - ($window.innerHeight - elemBottom);
if (targetY > maxY) {
targetY = maxY;
}
$window.scrollTo(0, targetY);
}
}
/**
* Determines if the active element is an input or text area
*
* @returns {Bool} - true if it IS an input or text area
*/
function isSelectedElementTextAreaOrInput( ctx ) {
var element = getDocument( ctx ).activeElement;
var isTextAreaOrInput = false;
var nodeName;
var type;
if ( element !== null ) {
nodeName = element.nodeName;
type = element.getAttribute( "type" );
isTextAreaOrInput = ( nodeName === "INPUT" && type === "text" ) || nodeName === "TEXTAREA";
}
return isTextAreaOrInput;
}
function selectElement( ctx, targetElement, path, offset ) {
var range;
var elem = targetElement;
if (path) {
for (var i = 0; i < path.length; i++) {
elem = elem.childNodes[path[i]];
if (elem === undefined) {
return;
}
while (elem.length < offset) {
offset -= elem.length;
elem = elem.nextSibling;
}
if (elem.childNodes.length === 0 && !elem.length) {
elem = elem.previousSibling;
}
}
}
var sel = getWindowSelection(ctx);
range = getDocument(ctx).createRange();
range.setStart(elem, offset);
range.setEnd(elem, offset);
range.collapse(true);
try {
sel.removeAllRanges();
} catch ( error ) {
$log.error( error );
}
sel.addRange( range );
targetElement.focus();
}
function pasteHtml( ctx, html, startPos, endPos ) {
var range, sel;
sel = getWindowSelection(ctx);
range = getDocument(ctx).createRange();
range.setStart(sel.anchorNode, startPos);
range.setEnd(sel.anchorNode, endPos);
range.deleteContents();
var el = getDocument(ctx).createElement("div");
el.innerHTML = html;
var frag = getDocument(ctx).createDocumentFragment(),
node, lastNode;
while ((node = el.firstChild)) {
lastNode = frag.appendChild(node);
}
range.insertNode(frag);
if (lastNode) {
range = range.cloneRange();
range.setStartAfter(lastNode);
range.collapse(true);
sel.removeAllRanges();
sel.addRange(range);
}
}
function resetSelection( ctx, targetElement, path, offset ) {
var nodeName = targetElement.nodeName;
if ( nodeName === "INPUT" || nodeName === "TEXTAREA" ) {
if ( targetElement !== getDocument( ctx ).activeElement ) {
targetElement.focus();
}
} else {
selectElement( ctx, targetElement, path, offset );
}
}
/**
* Replaces the text inside of the selected text area or input
*/
function replaceInputText( element, text, startPos, endPos ) {
text = text || "";
var value = element.value;
var preText = value.substring( 0, startPos );
var postText = value.substring( endPos, value.length );
var selectionPos = startPos + text.length;
element.value = preText + text + postText;
element.selectionStart = selectionPos;
element.selectionEnd = selectionPos;
}
/**
* @returns {String} - all the people that will be mentioned
* e.g.: "@leonardo @donatello @michelangelo "
**/
function getInitialMentions() {
var mentions = mentionStorage.get();
var myID = sessionService.user.id;
mentions = _.filter(mentions, function(m) {
return m.userID !== myID;
});
var initialMentions = _.uniq( mentions, "text" );
initialMentions = initialMentions.map(function( value ) {
return value.text + " ";
}).join("");
mentions.forEach(function( mention ) {
mention.startPos = initialMentions.indexOf(mention.text);
});
mentionStorage.set( mentions );
return initialMentions;
}
/**
* Checks if text matches an already selected user pattern, expects
* the brackets around the mentions.
*
* @param {String} text - the text, including brackets, to search for user data
* @param {Boolean} formatDataForAPI - true if the data should be formatted for the API
* @returns {Object} the mention data
*/
function getMentionedUser( text, formatDataForAPI ) {
var results = SQUARE_BRACKET_CONTENTS_PATTERN.exec( text );
var returnObj = {};
var name;
var id;
var user;
var parsed;
var idString = formatDataForAPI === true ? "userID" : "id";
if ( ! results ) {
return;
}
user = results[ 1 ];
if ( isEmailAddress( user ) ) {
returnObj = {email: user, text: "+" + user};
return returnObj;
}
parsed = NAME_AND_ID_PATTERN.exec( user );
if ( ! parsed ) {
return;
}
name = parsed[ 1 ];
id = parsed[ 2 ];
returnObj = {
name: name,
text: "@" + name,
};
returnObj[idString] = id;
return returnObj;
}
/**
* Finds all mentions within a raw comment text
*/
function findAllMentions( rawCommentText, formatDataForAPI ) {
rawCommentText = rawCommentText || "";
var match;
var results = [];
var regexp = new RegExp( MENTION_PATTERN, "g" );
while ( match = regexp.exec( rawCommentText ) ) {
var data = getMentionedUser( match[ 1 ], formatDataForAPI );
data.startPos = match.index;
data.endPos = data.startPos + match[ 0 ].length;
results.push( data );
}
return results;
}
function parseMention( comment, mentions ) {
if ( ! mentions ) {
return comment;
}
var mentionText;
var mentionHTML;
var className;
var startPos;
var myUserID = sessionService.user.id;
var i = mentions.length;
while ( i-- ) {
mentionText = mentions[ i ].text;
startPos = mentions[ i ].startPos;
className = ( mentions[ i ].userID === myUserID ) ? "me-mentioned" : "mention-blue";
mentionHTML = "<span class=\"" + className + "\">" + mentionText + "</span>";
if ( comment.substr( startPos, mentionText.length ) === mentionText ) {
comment = comment.slice( 0, startPos ) + mentionHTML + comment.slice( startPos + mentionText.length );
}
}
return comment;
}
/**
* Checks if text is an e-mail address
*/
function isEmailAddress( text ) {
var email = EMAIL_ADDRESS_PATTERN;
return email.test( text );
}
function replaceTriggerText( ctx, targetElement, path, offset, triggerCharSet, text, requireLeadingSpace, hasTrailingSpace ) {
resetSelection( ctx, targetElement, path, offset );
var mentionInfo = getTriggerInfo(ctx, triggerCharSet, requireLeadingSpace, true, hasTrailingSpace);
if ( ! mentionInfo ) {
return;
}
var startPos = mentionInfo.mentionPosition;
var endPos = startPos + mentionInfo.mentionText.length + 1;
var element = getDocument( ctx ).activeElement;
text = text + " ";
replaceInputText( element, text, startPos, endPos );
return startPos;
}
function getNodePositionInParent( ctx, elem ) {
if (elem.parentNode === null) {
return 0;
}
for (var i = 0; i < elem.parentNode.childNodes.length; i++) {
var node = elem.parentNode.childNodes[i];
if (node === elem) {
return i;
}
}
}
/**
* Gets the last index of a mention starting with `character` found
* inside of `text`
*
* @param {String} text - text to search through
* @param {String} character - the mention starting character
* @returns {Integer} the index of the mention within text, or -1
*/
function regexpLastIndexOf( text, character ) {
/**
* Matches "@" at the beginning of a string OR following a space,
* so we can find things like "@brian" or " @brian" but not match
* "email me at brian@joe.com"
*/
var regexp = new RegExp( "(^|\\s)\\" + character + "[^\\s]*", "g" );
var lastIndex = -1;
var result;
while ( result = regexp.exec( text ) ) {
lastIndex = result.index;
if ( typeof result[1] === "string" ) {
lastIndex += result[1].length;
}
}
return lastIndex;
}
function getTriggerInfo( ctx, triggerCharSet, requireLeadingSpace, menuAlreadyActive, hasTrailingSpace ) {
/*jshint maxcomplexity:11 */
var mostRecentTriggerCharPos = -1; // I am the index position of the last trigger character
var effectiveRange; // I am all of the text to be parsed
var offset; // ??? I am only related to content editable
var path; // ??? I am only related to content editable
var selected; // I am the active element
var selectionInfo; // I hold data for when we are dealing with content editable
var triggerChar; // I (should be) the currently active trigger character
if ( isSelectedElementTextAreaOrInput( ctx ) ) {
selected = getDocument( ctx ).activeElement;
}
effectiveRange = getTextPrecedingCurrentSelection( ctx );
if ( !effectiveRange ) {
return;
}
triggerCharSet.forEach( function( c ) {
var idx = regexpLastIndexOf( effectiveRange, c );
if ( idx > mostRecentTriggerCharPos ) {
mostRecentTriggerCharPos = idx;
triggerChar = c;
}
});
/**
* If logic simplification
*/
var preceedingChar = effectiveRange.substring( mostRecentTriggerCharPos - 1, mostRecentTriggerCharPos );
var triggerCharExists = ~mostRecentTriggerCharPos;
var triggerCharIsValid = mostRecentTriggerCharPos === 0 || ! requireLeadingSpace || /[\xA0\s]/g.test( preceedingChar );
if ( ! triggerCharExists || ! triggerCharIsValid ) {
return;
}
var currentTriggerSnippet = effectiveRange
.substring( mostRecentTriggerCharPos + 1, effectiveRange.length );
if ( hasTrailingSpace ) {
currentTriggerSnippet = currentTriggerSnippet.trim();
}
var doesNotHaveASpace = ! /[\xA0\s]/g.test(currentTriggerSnippet);
var isValid = currentTriggerSnippet.length >= 0 && doesNotHaveASpace;
if ( isValid ) {
return {
mentionPosition: mostRecentTriggerCharPos,
mentionText: currentTriggerSnippet,
mentionSelectedElement: selected,
mentionSelectedPath: path,
mentionSelectedOffset: offset,
mentionTriggerChar: triggerChar
};
}
}
function getWindowSelection( ctx ) {
if (!ctx) {
return window.getSelection();
} else {
return ctx.iframe.contentWindow.getSelection();
}
}
function getDocument( ctx ) {
if (!ctx) {
return document;
} else {
return ctx.iframe.contentWindow.document;
}
}
/**
* Gets all of the text in the input that comes before the cursor's
* current position.
*/
function getTextPrecedingCurrentSelection( ctx ) {
var text;
if (isSelectedElementTextAreaOrInput(ctx)) {
var textComponent = getDocument(ctx).activeElement;
var startPos = textComponent.selectionStart;
text = textComponent.value.substring(0, startPos);
} else {
var selectedElem = getWindowSelection(ctx).anchorNode;
if ( selectedElem !== null ) {
var workingNodeContent = selectedElem.textContent;
var selectStartOffset = getWindowSelection(ctx).getRangeAt(0).startOffset;
if ( selectStartOffset >= 0 ) {
text = workingNodeContent.substring( 0, selectStartOffset );
}
}
}
return text;
}
function localToGlobalCoordinates( ctx, element, coordinates ) {
var iframe = ctx ? ctx.iframe : null;
var obj = element;
var body = getDocument().body;
coordinates.top += obj.scrollTop;
while ( obj ) {
coordinates.left += obj.offsetLeft + obj.clientLeft;
coordinates.top += obj.offsetTop + obj.clientTop;
obj = obj.offsetParent;
if ( ! obj && iframe ) {
obj = iframe;
iframe = null;
}
}
obj = element;
iframe = ctx ? ctx.iframe : null;
while ( obj !== body ) {
if ( obj.scrollTop && obj.scrollTop > 0 ) {
coordinates.top -= obj.scrollTop;
}
if ( obj.scrollLeft && obj.scrollLeft > 0 ) {
coordinates.left -= obj.scrollLeft;
}
obj = obj.parentNode;
if ( ! obj && iframe ) {
obj = iframe;
iframe = null;
}
}
}
function getTextAreaOrInputUnderlinePosition( ctx, element, position ) {
var coordinates = {top: 0, left: 0};
localToGlobalCoordinates(ctx, element, coordinates);
return coordinates;
}
return {
popUnderMention: popUnderMention,
replaceTriggerText: replaceTriggerText,
getTriggerInfo: getTriggerInfo,
selectElement: selectElement,
replaceInputText: replaceInputText,
isEmailAddress: isEmailAddress,
getMentionedUser: getMentionedUser,
findAllMentions: findAllMentions,
parseMention: parseMention,
getInitialMentions: getInitialMentions,
getTextAreaOrInputUnderlinePosition: getTextAreaOrInputUnderlinePosition,
getTextPrecedingCurrentSelection: getTextPrecedingCurrentSelection,
getNodePositionInParent: getNodePositionInParent,
pasteHtml: pasteHtml,
resetSelection: resetSelection,
scrollIntoView: scrollIntoView
};
}
})( angular );
;
;
/*! mentions-store.js */ 
;
;
(function( ng, app) {
"use strict";
app.factory( "mentionsStore", MentionsStoreFactory );
var nextGetterID = 0;
function MentionsStoreFactory(
$http,
$q,
_,
appSettings,
clientEvents,
sessionService
) {
var state = {
isLoading: false
};
resetMentionData();
var getters = {};
/**
* Sets the state mention data to default (empty) values. Called on
* instantiation and any time we need to reset the mention data.
*/
function resetMentionData() {
state.mentions = [];
state.mentionsByID = {};
state.mentionsByProjectID = {};
state.mentionsByCommentID = {};
state.mentionsByConversationID = {};
state.mentionsByUserID = {};
state.mentionsByScreenID = {};
state.mentionsCount = 0;
}
clientEvents
.forNamespace( "inboxMentionsPartial" )
.add( "inbox.project.markedRead", handleProjectMarkedRead )
.add( "inbox.conversation.commentDeleted", handleCommentDeleted )
.add( "inbox.conversation.deleted", handleConversationDeleted )
.add( "inbox.conversation.markedRead", handleConversationMarkedRead )
.add( "allInboxNotificationsMarkedRead", handleAllNotificationsMarkedRead );
/**
* I handle the event when all notifications for a project have
* been marked read.
*
* @param {Event} event - the event data
* @param {Object} data - the custom payload of data about the event
*/
function handleProjectMarkedRead( event, data ) {
var projectID = data.projectID;
removeAllMentionsForProject( projectID );
}
/**
* I handle the event when a comment has been deleted.
*
* @param {Event} event - the event data
* @param {Object} data - the custom payload of data about the event
*/
function handleCommentDeleted( event, data ) {
var commentID = data.commentID;
removeAllMentionsForComment( commentID );
}
/**
* I handle the event when a conversation has been deleted.
*
* @param {Event} event - the event data
* @param {Object} data - the custom payload of data about the event
*/
function handleConversationDeleted( event, data ) {
var conversationID = data.conversationID;
removeAllMentionsForConversation( conversationID );
}
/**
* I handle the event when a conversation has been marked read.
*
* @param {Event} event - the event data
* @param {Object} data - the custom payload of data about the event
*/
function handleConversationMarkedRead( event, data ) {
var conversationID = data.conversationID;
removeAllMentionsForConversation( conversationID );
}
/**
* I handle the event when all notifications have been marked read.
*/
function handleAllNotificationsMarkedRead() {
resetMentionData();
callGetters();
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* I add the specified getterFunction to the list of getters, bound
* to context, and return the ID of the getter
*
* @param {Function} getterFunction - the getter to be executed on state change
* @param {Context} context - the context to bind getterFunction to
* @returns {Integer} the id of the getter, for reference later
*/
function addGetter( getterFunction, context ) {
getters[nextGetterID] = {
handler: getterFunction,
context: context
};
return nextGetterID++;
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* Removes the getter, specified by getterID, from the map of
* getters
*
* @param {Integer} getterID - the id of the getter to remove
*/
function removeGetterByID( getterID ) {
delete getters[getterID];
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* Removes any getters which match the handler and context, or if
* no context is provided, removes any getters which match the
* handler.
*
* @param {Function} handler - the handler
* @param {Context} context - the context that is bound to handler
*/
function removeGetter( handler, context ) {
getters = _.reject( getters, function operator( getter, id ) {
var isHandler = getter.handler === handler;
var isContext = ! context || getter.context === context;
return isHandler && isContext;
});
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* Iterates over all of the getters, calling them with the correct
* context and passing the current value of state.
*/
function callGetters() {
_.each( getters, function iterator( getter ) {
getter.handler.call( getter.context, state );
});
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* We expect the server to return an object, but if there is a
* server-side error or something unexpected, we want to ensure
* that the error message is normalized.
*
* @param {Object|String} error - the error object or string
* @returns {Object} the error object
*/
function normalizeError( error ) {
if ( _.isString( error ) ) {
error = {
message: error,
code: -1
};
}
return error;
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* Normalize the HTTP response to separate the HTTP structure from
* the data expected by the calling context
*
* @param {Promise} $httpPromise - the promise created by calling $http.verb
* @returns {Promise} the modified promise
*/
function normalizeHttpResponse( $httpPromise ) {
return $httpPromise.then(
function handleResolve( response ) {
return response.data;
},
function handleReject( response ) {
return $q.reject( normalizeError( response.data ) );
}
);
}
/**
* @TODO: MAKE THIS A PROTOTYPE METHOD
* Initiates the grabbing of the mention data from the API and
* returns a promise for that request
*
* @returns {Promise} the promise for the GET request
*/
function loadData() {
var subscriptionsEnabled = appSettings.getSettings().features.projectNotificationPreferences;
var endpoint = subscriptionsEnabled ?
"/api/partials/desktop/inbox/notifications/get-notification-badges" :
"/api/mentions/unread";
var request = $http.get(endpoint);
return normalizeHttpResponse( request );
}
/**
* Assigns the mention data to the state. Also, loops over all the
* mentions and assigns mentions by id, screen id, project id,
* comment id, and conversation id in a memory efficient way by
* referencing the already defined mention. This allows us to very
* efficiently and easily map mentions to other data.
*
* @param {Array} mentions - the mention data to be set on the state
*/
function parseMentionData( mentions ) {
var mentionIndex = 0;
state.mentions = mentions.mentions;
_.forEach( state.mentions, function( mention ) {
mentionIndex++;
mention.id = mentionIndex;
state.mentionsCount = mentionIndex;
state.mentionsByID[ mention.id ] = mention;
addMentionToMap( "mentionsByProjectID", mention.projectID, mention );
addMentionToMap( "mentionsByCommentID", mention.commentID, mention );
addMentionToMap( "mentionsByConversationID", mention.conversationID, mention );
addMentionToMap( "mentionsByUserID", mention.userID, mention );
addMentionToMap( "mentionsByScreenID", mention.screenID, mention );
});
};
/**
* Adds a mention to the specified map, also ensuring that the
* map is defined, and creating it if it is not yet defined. This
* is basically a utility method used by parseMentionData above.
*
* @param {String} mapName - the name of the map to add the mention to
* @param {Integer} key - the key (id) where the mention should get added
* @param {Object} mention - the mention to be added to the map
*/
function addMentionToMap( mapName, key, mention ) {
if ( ! key ) {
return;
}
state[ mapName ][ key ] = state[ mapName ][ key ] || {count: 0, mentions: {}};
state[ mapName ][ key ].count++;
state[ mapName ][ key ].mentions[ mention.id ] = mention;
}
/**
* Gets all of the mentions for the currently logged-in user
*
* @returns {Object} - a map of {count: N, mentions: {...}}
*/
function getAllMyMentions() {
var myID = sessionService.user.id;
return getAllMentionsByUserID( myID ) || {count: 0, mentions: {}};
}
/**
* Gets all mentions by user id
*
* @param {Integer} id - user id
* @returns {Object|Undefined} mention map or undefined
*/
function getAllMentionsByUserID( id ) {
return state.mentionsByUserID[ id ];
}
/**
* Gets all mentions by screen id
*
* @param {Integer} id - screen id
* @returns {Object|Undefined} mention map or undefined
*/
function getAllMentionsByScreenID( id ) {
return state.mentionsByScreenID[ id ];
}
/**
* Gets all mentions by project id
*
* @param {Integer} id - project id
* @returns {Object|Undefined} mention map or undefined
*/
function getAllMentionsByProjectID( id ) {
return state.mentionsByProjectID[ id ];
}
/**
* Gets all mentions by comment id
*
* @param {Integer} id - comment id
* @returns {Object|Undefined} mention map or undefined
*/
function getAllMentionsByCommentID( id ) {
return state.mentionsByCommentID[ id ];
}
/**
* Gets all mentions by conversation id
*
* @param {Integer} id - conversation id
* @returns {Object|Undefined} mention map or undefined
*/
function getAllMentionsByConversationID( id ) {
return state.mentionsByConversationID[ id ];
}
/**
* Gets a mention by mention id
*
* @param {Integer} id - the id value to search for in the map
* @returns {Object|Undefined} mention or undefined
*/
function getMentionByID( id ) {
return state.mentionsByID[ id ];
}
/**
* Gets all mentions formatted for my-mentions API
*
* @returns {Object|Undefined} mention map or undefined
*/
function getMyMentionsCommentIDs() {
var myMentions = getAllMyMentions();
if ( !myMentions ) {
return;
}
var val, prop;
var tempObj = {
commentIDs: {
prototypeComments: [],
boardComments: []
}
};
for ( prop in myMentions.mentions ) {
if ( myMentions.mentions.hasOwnProperty( prop ) ) {
val = myMentions.mentions[ prop ];
if ( val.mentionCommentType === "screen" ) {
tempObj.commentIDs.prototypeComments.push( val.commentID );
} else if ( val.mentionCommentType === "board_item" ) {
tempObj.commentIDs.boardComments.push( val.commentID );
}
}
}
return tempObj;
}
/**
* Purges a mention from the state, removing it from every list
* where it's referenced. This is useful for when a mention has
* been "read" on the client side.
*
* @param {Object|Integer} mention - the mention, or id of the mention to remove
*/
function purgeMention( mention ) {
if ( _.isNumber( mention ) ) {
mention = getMentionByID( id );
}
if ( ! mention ) {
return;
}
var id = mention.id;
state.mentionsCount--;
delete state.mentionsByID[ id ];
removeMentionFromUser( mention.userID, id );
removeMentionFromProject( mention.projectID, id );
removeMentionFromComment( mention.commentID, id );
removeMentionFromConversation( mention.conversationID, id );
removeMentionFromScreen( mention.screenID, id );
}
/**
* Removes all mentions for a particular conversation. Used when an
* entire conversation has been marked read.
*
* @param {Integer} conversationID - the id of the conversation
*/
function removeAllMentionsForConversation( conversationID ) {
removeAllMentionsFromMap( getAllMentionsByConversationID, conversationID );
}
/**
* Removes all mentions for a particular comment. Used when an
* entire comment has been marked read.
*
* @param {Integer} commentID - the id of the comment
*/
function removeAllMentionsForComment( commentID ) {
removeAllMentionsFromMap( getAllMentionsByCommentID, commentID );
}
/**
* Removes all mentions for a particular project. Used when an
* entire project has been marked read.
*
* @param {Integer} projectID - the id of the project
*/
function removeAllMentionsForProject( projectID ) {
removeAllMentionsFromMap( getAllMentionsByProjectID, projectID );
}
/**
* Removes all mentions for a particular user.
*
* @param {Integer} userID - the id of the user
*/
function removeAllMentionsForUser( userID ) {
removeAllMentionsFromMap( getAllMentionsByUserID, userID );
}
/**
* Removes all mentions for a particular screen.
*
* @param {Integer} screenID - the id of the screen
*/
function removeAllMentionsForScreen( screenID ) {
removeAllMentionsFromMap( getAllMentionsByScreenID, screenID );
}
/**
* Proxied by other methods to normalize/DRY code. Gets a map of
* mentions by passing mapID to the specified getMentionsMethod,
* looping over each of the returned mentions and calling the
* purgeMention method for each. Calls callGetters on completion.
*
* @param {Function} getMentionsMethod - the method to get the mentions list
* @param {Integer} mapID - the id value to pass to getMentionsMethod
*/
function removeAllMentionsFromMap( getMentionsMethod, mapID ) {
var mentionsMap = getMentionsMethod( mapID );
if ( ! mentionsMap ) {
return;
}
_.forEach( mentionsMap.mentions, purgeMention );
callGetters();
}
/**
* Proxy for removeMentionFor map that removes from the list of
* mentions by user id.
*
* @param {Integer} userID - the id of the user
* @param {Integer} mentionID - the id of the mention to remove
*/
function removeMentionFromUser( userID, mentionID ) {
removeMentionFromMap( "mentionsByUserID", userID, mentionID );
}
/**
* Proxy for removeMentionFor map that removes from the list of
* mentions by screen id.
*
* @param {Integer} screenID - the id of the screen
* @param {Integer} mentionID - the id of the mention to remove
*/
function removeMentionFromScreen( screenID, mentionID ) {
removeMentionFromMap( "mentionsByScreenID", screenID, mentionID );
}
/**
* Proxy for removeMentionFor map that removes from the list of
* mentions by project id.
*
* @param {Integer} projectID - the id of the project
* @param {Integer} mentionID - the id of the mention to remove
*/
function removeMentionFromProject( projectID, mentionID ) {
removeMentionFromMap( "mentionsByProjectID", projectID, mentionID );
}
/**
* Proxy for removeMentionFor map that removes from the list of
* mentions by comment id.
*
* @param {Integer} commentID - the id of the comment
* @param {Integer} mentionID - the id of the mention to remove
*/
function removeMentionFromComment( commentID, mentionID ) {
removeMentionFromMap( "mentionsByCommentID", commentID, mentionID );
}
/**
* Proxy for removeMentionFor map that removes from the list of
* mentions by conversation id.
*
* @param {Integer} conversationID - the id of the conversation
* @param {Integer} mentionID - the id of the mention to remove
*/
function removeMentionFromConversation( conversationID, mentionID ) {
removeMentionFromMap( "mentionsByConversationID", conversationID, mentionID );
}
/**
* Utility function, proxied by other methods to normalize and DRY
* up the code for deleting a mention from a map within state, such
* as mentionsByCommentID or mentionsByProjectID.
*
* @param {String} type - the map type to delete the mention from,
*   one of mentionsByScreenID, mentionsByProjectID, mentionsByCommentID,
*   or mentionsByConversationID
* @param {Integer} typeID - the id of the map type that holds the mention
* @param {Integer} mentionID - the id of the mention to remove
*/
function removeMentionFromMap( type, typeID, mentionID ) {
var map = state[ type ][ typeID ];
delete map.mentions[ mentionID ];
map.count--;
}
function get() {
return state;
}
function load() {
if ( state.isLoading ) {
return;
}
var deferred = $q.defer();
loadData().then(
function handleResolve( mentions ) {
state.isLoading = false;
resetMentionData();
parseMentionData( mentions );
callGetters();
deferred.resolve();
},
function handleReject( response ) {
state.isLoading = false;
deferred.reject( response );
}
);
return deferred.promise;
}
return {
load: load,
get: get,
addGetter: addGetter,
removeGetter: removeGetter,
removeGetterByID: removeGetterByID,
getAllMyMentions: getAllMyMentions,
getMyMentionsCommentIDs: getMyMentionsCommentIDs,
getAllMentionsByScreenID: getAllMentionsByScreenID
};
}
})( angular, InVision );
;
;
/*! project-watchers-partial.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.factory( "projectWatchersPartial", ProjectWatchersPartial )
;
function ProjectWatchersPartial(
$http,
$q,
$rootScope,
_
) {
var projectWatchersData = {
watchers: []
};
var bindings = [];
var pendingTrigger = false;
return {
get: get,
load: load,
addBinding: addBinding,
removeBinding: removeBinding
};
function get( projectID ) {
if ( !projectID ) {
return [];
}
var existingWatchers = _.filter( projectWatchersData.watchers, function( i ) {
return i.projectID === projectID;
});
return ng.copy( existingWatchers );
}
function load( projectID ) {
var deferred = $q.defer();
if ( !projectID ) {
deferred.reject("Error: undefined itemID");
return deferred.promise;
}
getWatchers( projectID ).then(
function handleResolve( partial ) {
setData( partial, projectID );
deferred.resolve();
triggerChange();
},
function handleReject( response ) {
deferred.reject( response );
}
);
return( deferred.promise );
}
function addBinding( handler, context ) {
bindings.push({
handler: handler,
context: ( context || null )
});
}
function removeBinding( handler, context ) {
bindings = _.reject(
bindings,
function operator( binding ) {
return(
( binding.handler === handler ) && 
( ! context || ( handler.context === context ) )
);
}
);
}
function getWatchers( projectID ) {
var urlParts = [
"/api/conversations/project-watchers",
projectID
];
var request = $http({
method: "GET",
url: ( urlParts.join("/") )
});
return request.then(
function handleResolve( response ) {
return response.data;
},
function handleReject( errorResponse ) {
return $q.reject( unwrapErrorResponse( errorResponse ) );
}
);
}
function setData( partial, projectID ) {
var existingItem = _.find( projectWatchersData.watchers, { projectID: projectID });
if ( !!existingItem ) {
return;
}
else {
_.forEach( partial.watchers, function( value ) {
projectWatchersData.watchers.push({
projectID: projectID,
userID: value.id,
name: value.name
});
});
}
triggerChange();
}
function triggerChange() {
if ( pendingTrigger ) {
return;
}
pendingTrigger = true;
$rootScope.$evalAsync(
function async() {
pendingTrigger = false;
_.each(
bindings,
function iterator( binding ) {
binding.handler.call( binding.context );
}
);
}
);
}
function unwrapErrorResponse( errorResponse ) {
var response = {
code: -1,
id: -1
};
try {
response = ng.fromJson( errorResponse.data );
if ( ng.isString( response ) ) {
response.message = response;
}
} catch( error ) {
response.message = "Error: " + error;
}
return response;
}
}
})( angular );
;
;
/*! mention-text.controller.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.controller( "mention.TextController", textController )
;
function textController(
$attrs,
$scope,
$timeout,
_,
appSettings,
mentionService
) {
var props = $scope.props = $scope;
props.query = function( mentionInfo ) {
var remoteScope = props.triggerCharMap[mentionInfo.mentionTriggerChar];
if ( props.trimTerm === undefined || props.trimTerm ) {
mentionInfo.mentionText = mentionInfo.mentionText.trim();
}
remoteScope.showMenu();
remoteScope.search({
mentionInfo: mentionInfo
});
remoteScope.typedTerm = mentionInfo.mentionText;
};
props.defaultSearch = function( mentionInfo ) {
var results = [];
var term = mentionInfo.mentionText || "";
var itNeedsToBeReplaced;
_.forEach( props.items, function( item ) {
var text = item.name.toUpperCase() + item.surname.toUpperCase();
if ( ~text.indexOf( term.toUpperCase() ) ) {
results.push( item );
}
});
itNeedsToBeReplaced = mentionInfo.mentionTriggerChar === "@" && results.length < 1 && term.length > 2;
if ( itNeedsToBeReplaced ) {
var element = mentionInfo.mentionSelectedElement;
var text = "+" + term;
var startPos = mentionInfo.mentionPosition;
var endPos = startPos + text.length;
mentionService.replaceInputText( element, text, startPos, endPos );
}
props.localItems = results;
};
props.bridgeSearch = function( mentionInfo ) {
var searchFn = $attrs.mentioSearch ? props.search : props.defaultSearch;
searchFn( mentionInfo );
};
props.defaultSelect = function( locals ) {
var character = props.defaultTriggerChar;
if ( locals.item.label) {
return handleNewUserAdd( locals.item.label );
}
return character + locals.item.name + locals.item.surname;
};
function handleNewUserAdd( text ) {
if ( ! mentionService.isEmailAddress( text ) ) {
return "notemail";
}
return "+" + text;
}
props.bridgeSelect = function(itemVar) {
var selectFn = $attrs.mentioSelect ? props.select : props.defaultSelect;
return selectFn({
item: itemVar
});
};
props.setTriggerText = function( text ) {
if ( props.syncTriggerText ) {
props.typedTerm = (props.trimTerm === undefined || props.trimTerm) ? text.trim() : text;
}
};
props.context = function() {
};
props.replaceText = function( text, hasTrailingSpace, hideAll ) {
if ( hideAll === undefined || hideAll ) {
props.hideAll();
}
var startPos = mentionService.replaceTriggerText(
props.context(),
props.targetElement,
props.targetElementPath,
props.targetElementSelectedOffset,
props.triggerCharSet,
text,
props.requireLeadingSpace,
hasTrailingSpace
);
if ( !hasTrailingSpace ) {
props.setTriggerText('');
angular.element( props.targetElement ).triggerHandler('change');
if ( props.isContentEditable() ) {
props.contentEditableMenuPasted = true;
var timer = $timeout(function() {
props.contentEditableMenuPasted = false;
}, 200);
props.$on('$destroy', function() {
$timeout.cancel(timer);
});
}
}
return startPos;
};
props.hideAll = function() {
for ( var key in props.triggerCharMap ) {
if ( props.triggerCharMap.hasOwnProperty(key) ) {
props.triggerCharMap[key].hideMenu();
}
}
};
props.selectActive = function() {
var key = findVisibleKey( props.triggerCharMap );
key && key.selectActive();
};
props.isActive = function() {
var key = findVisibleKey( props.triggerCharMap );
return !! key;
};
props.isContentEditable = function() {
return (props.targetElement.nodeName !== 'INPUT' && props.targetElement.nodeName !== 'TEXTAREA');
};
props.addMenu = function( menuScope ) {
if ( menuScope.parentScope && props.triggerCharMap.hasOwnProperty(menuScope.triggerChar) ) {
return;
}
props.triggerCharMap[menuScope.triggerChar] = menuScope;
props.triggerCharMap['+'] = menuScope;
if (props.triggerCharSet === undefined) {
props.triggerCharSet = [];
}
props.triggerCharSet.push(menuScope.triggerChar, "+");
menuScope.setParent(props);
};
props.$on(
"menuCreated", function( event, data ) {
if ( $attrs.uid && $attrs.uid === data.targetElement ) {
props.addMenu( data.scope );
}
}
);
}
function findVisibleKey( map ) {
for ( var key in map ) {
if ( map.hasOwnProperty( key ) && map[key].visible ) {
return map[key];
}
}
return null;
}
})( angular );
;
;
/*! mention-text.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.directive( "invMentionText", mentionTextDirective )
;
function mentionTextDirective(
$document,
$log,
$timeout,
appSettings,
candidatesPartial,
clientEvents,
config,
mentionService,
mentionStorage,
mentionUtilities
) {
return ({
restrict: "A",
controller: "mention.TextController",
controllerAs: "vm",
scope: {
uid: "=uid",
ngModel: "=",
typedTerm: "=mentioTypedTerm",
requireLeadingSpace: "=mentioRequireLeadingSpace",
trimTerm: "=mentioTrimTerm",
hasWhoIsNotified: "@hasWhoIsNotified",
hasMentions: "=hasMentions",
hasMentionShortcut: "@hasMentionShortcut"
},
link: linkFunction
});
function linkFunction( scope, element, attrs, controller ) {
scope.triggerCharMap = {};
scope.targetElement = element;
attrs.$set("autocomplete", "off");
var mentions = "";
var pendingMentionsUpdate = null;
var hasExistingMentions = false;
var firstEdit = true;
var hasMentionShortcut = appSettings.getSettings().features.mentionShortcut;
clientEvents
.forNamespace( "mention" )
.add( "mention.addOthers", handleAddOthers )
;
if (scope.hasMentions) {
scope.$watch( "ngModel", handleWatch );
}
scope.$on( "$destroy", handleDestroy );
initialize();
function initialize() {
if ( !scope.hasMentions || scope.ngModel && scope.ngModel.length ) {
return;
}
$timeout(function setCommentMentions() {
mentions = mentionService.getInitialMentions();
scope.ngModel = mentions;
focusElement();
});
}
function handleAddOthers( event, data ) {
if ( attrs.uid && attrs.uid === data.targetElement ) {
scope.ngModel = ( typeof scope.ngModel === "undefined" ) ? " @" : scope.ngModel + " @";
$timeout(function initWatch() {
focusElement();
handleWatch( scope.ngModel );
}, 1);
}
}
function updateMentions( newValue ) {
var hasConversation = hasMentionShortcut && !config.featureFlags["prototypes-rain-690-sunset-conversation"];
var mentionsData = mentionUtilities.findMentions(
newValue,
{
existingMentions: mentionStorage.get(),
candidates: candidatesPartial.data.candidates.candidates,
members: hasMentionShortcut ? candidatesPartial.data.candidates.members : [],
conversationMembers: hasConversation ? candidatesPartial.data.candidates.conversationMembers : [],
debug: false
}
);
mentionStorage.set( mentionsData );
hasExistingMentions = !!mentionsData.length;
}
function handleWatch( newValue, oldValue ) {
if ( newValue === oldValue || ( newValue === mentions && newValue !== "" ) ) {
return;
}
if ( firstEdit ) {
scope.$emit( "mentionText.editing", true );
firstEdit = false;
}
if ( !newValue ) {
scope.$emit( "mentionText.editing", false );
firstEdit = true;
}
var isActive = scope.isActive();
if ( ! scope.triggerCharSet ) {
$log.error("Error, no mention-items attribute was provided" );
return;
}
if (pendingMentionsUpdate) {
clearTimeout(pendingMentionsUpdate);
}
pendingMentionsUpdate = setTimeout( function() {
updateMentions( newValue );
pendingMentionsUpdate = null;
}, 250);
if ( hasExistingMentions ) {
var mentionsToCheck = mentionStorage.get();
document.activeElement.value = mentionUtilities.replaceMalformedEmails(newValue, mentionsToCheck);
}
var mentionInfo = mentionService.getTriggerInfo(
scope.context(),
scope.triggerCharSet,
scope.requireLeadingSpace,
isActive
);
if ( mentionInfo ) {
mentionInfo.mentionText = mentionInfo.mentionText.replace( /[^a-zA-Z0-9]+$/, "" );
}
/**
* content editable selection changes to local nodes which
* modifies the start position of the selection over time,
* just consider triggerchar changes which
* will have the odd effect that deleting a trigger char pops
* the menu for a previous
* trigger char sequence if one exists in a content editable
**/
var isContentEditable = scope.isContentEditable();
var mentionPositionMatches = mentionInfo && mentionInfo.mentionPosition === scope.currentMentionPosition;
var alreadyTriggeredFromInput = ! isContentEditable && mentionPositionMatches;
var triggerCharMatches = mentionInfo && mentionInfo.mentionTriggerChar === scope.currentMentionTriggerChar;
var alreadyTriggeredFromContentEditable = isContentEditable && triggerCharMatches;
var alreadyTriggered = isActive && ( alreadyTriggeredFromContentEditable || alreadyTriggeredFromInput );
var isNewOrAlreadyTriggered = ! isActive || alreadyTriggered;
if ( mentionInfo && isNewOrAlreadyTriggered ) {
/** save selection info about the target control for later re-selection */
if ( mentionInfo.mentionSelectedElement ) {
scope.targetElement = mentionInfo.mentionSelectedElement;
scope.targetElementPath = mentionInfo.mentionSelectedPath;
scope.targetElementSelectedOffset = mentionInfo.mentionSelectedOffset;
}
/* publish to external ngModel */
scope.setTriggerText( mentionInfo.mentionText );
/* remember current position */
scope.currentMentionPosition = mentionInfo.mentionPosition;
scope.currentMentionTriggerChar = mentionInfo.mentionTriggerChar;
/* perform query */
scope.query( mentionInfo );
} else {
var currentTypedTerm = scope.typedTerm;
scope.setTriggerText("");
scope.hideAll();
}
}
function focusElement() {
var el = element[0];
el.focus();
el.selectionStart = el.selectionEnd = el.value.length;
}
function handleDestroy() {
mentionStorage.destroy();
scope.$emit( "mentionText.editing", false );
}
}
}
})( angular );
;
;
/*! mention-who-is-notified.controller.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.controller("mention.WhoIsNotifiedController", WhoIsNotifiedController );
function WhoIsNotifiedController(
$attrs,
$log,
$scope,
_,
appSettings,
clientEvents,
mentionStorage,
modelEvents
) {
var vm = this;
var props = $scope.props = $scope;
modelEvents.on( "MentionStorageUpdated", handleMentionStorageUpdated );
$scope.$on( "$destroy", handleDestroy );
initialize();
vm.pluralizePerson = pluralizePerson;
vm.getUsername = getUsername;
vm.addOthers = addOthers;
function pluralizePerson() {
return vm.peopleNotified.length === 1 ? "person" : "people";
}
/**
* Return the username 
* if prop `name` is not present, return `text` without '@' or '+'
*
* @param {object} peopleNotified user
* @return {string}
*/
function getUsername( user ) {
if ( user.name ) {
return user.name;
}
if ( user.text && ( user.text[ 0 ] === "@" || user.text[ 0 ] === "+" ) ) {
return user.text.slice( 1 );
}
return user.text;
}
function addOthers() {
clientEvents.trigger(
"mention.addOthers", {
targetElement: $attrs.mentioFor
}
);
}
function initialize() {
updatePeopleNotified();
}
function updatePeopleNotified() {
vm.peopleNotified = mentionStorage.getWhoIsNotified();
}
function handleMentionStorageUpdated() {
$scope.$evalAsync(function() {
updatePeopleNotified();
});
}
function handleDestroy() {
modelEvents.off( "MentionStorageUpdated" );
}
}
})( angular );
;
;
/*! mention-who-is-notified.directive.js */ 
;
;
(function( ng ) {
"use strict";
ng
.module("mention")
.directive("invMentionWhoIsNotified", WhoIsNotifiedDirective );
function WhoIsNotifiedDirective() {
return ({
restrict: "A",
templateUrl: "/assets/apps/common/ng-components/mention/who-is-notified/mention-who-is-notified.directive.htm",
controller: "mention.WhoIsNotifiedController",
controllerAs: "vm"
});
}
})( angular );
;
;
/*! mention-utilities.js */ 
;
;
(function( ng, app ) {
"use strict";
if (typeof module !== "undefined" && module.exports) {
module.exports = MentionUtilities(null);
} else if (app) {
app.service("mentionUtilities", MentionUtilities);
}
function MentionUtilities($log) {
var PUNCTUATION = "\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e";
var SPACES = "\x00-\x20";
var NAME_TO_MENTION_TEXT_RE = new RegExp("[" + SPACES + PUNCTUATION + "]+", "g");
var MENTION_STRINGPATTERN = "(@[\\S]+(?:[" + PUNCTUATION + "]+|$)?)";	// @mention followed by punctuation, space or end of line
var EMAIL_ADDRESS_STRINGPATTERN = "([^@\\s]+@[^@\\s]+\\.\\w{2}[\\.\\w]*)";
var VISIBLE_MENTION_STRINGPATTERN =
"(^|\\s)" +               // Start of text or whitespace
"(?:" +                   // non-capturing group
MENTION_STRINGPATTERN +
"|\\+(" +                 // Pattern OR, leading "+", start capture group
EMAIL_ADDRESS_STRINGPATTERN +
"))";                     // Close email capture group, then non-capturing group
var VISIBLE_MENTION_RE = new RegExp( VISIBLE_MENTION_STRINGPATTERN, "g" );
var EMAIL_RE = new RegExp(EMAIL_ADDRESS_STRINGPATTERN);
var TRAILING_PUNCTUATION_RE = new RegExp("[" + PUNCTUATION + "]+$", "g");
var defaultOptions = {
candidates: [],
conversationMembers: [],
debug: false,				// Set to true to log debug info
existingMentions: [],
maxCandidates: 300,   		// If there are more than this many candidates, they will not be searched.
members: [],
searchCandidates: true		// Set to true to search single matches in candidates
};
return ({
findMentions: findMentions,
isEmailAddress: isEmailAddress,
nameToMentionText: nameToMentionText,
replaceMalformedEmails: replaceMalformedEmails,
userToMention: userToMention
});
function log() {
if ($log) {
$log.log.apply($log, arguments);
} else if (window && window.console) {
window.console.log.apply(window.console, arguments);
}
}
function nameToMentionText(name) {
var result = "@" + name.replace(NAME_TO_MENTION_TEXT_RE, '');
return result;
}
function userToMention( user ) {
return {
userID: user.id || user.userID,
text: nameToMentionText( user.name )
};
}
function findMentions( commentText, userOptions ) {
var options = ng.copy(defaultOptions);
if (ng.isObject(userOptions)) {
ng.extend(options, userOptions);
}
var results = [];
var toReplace = [];
var match;
var text;
var cursorPos = 0;
var existingMention;
var newMention;
var matchingCandidates;
var mentionShortcut;
var email;
var existingMentions = options.existingMentions;
var candidates = options.candidates;
var members = options.members;
var conversationMembers = options.conversationMembers;
if ( !ng.isArray( existingMentions ) ) {
throw ("if provided, existingMentions must be an array");
}
if ( !ng.isArray( candidates ) ) {
throw ("if provided, candidates must be an array");
}
if (options.debug) {
log("commentText:", commentText);
}
if (options.searchCandidates && candidates.length <= options.maxCandidates) {
_.each(candidates, function(candidate) {
candidate.mentionText = nameToMentionText(candidate.name).toLowerCase();
});
}
while ( match = VISIBLE_MENTION_RE.exec( commentText ) ) {
if (options.debug) {
log("Checking mention match:", match[2], "index:", match.index, match);
}
matchingCandidates = [];
existingMention = null;
newMention = null;
email = null;
cursorPos = match.index + match[1].length;
text = match[2] || match[3]; // different capture groups for @Name and +z@email.com
text = text.replace(/[\s,.!?\-]$/,"");
mentionShortcut = text === "@project" || text === "@conversation";
text = text.replace(TRAILING_PUNCTUATION_RE, '');
if (options.debug) {
log("Text with trailing punctuation stripped:", text);
}
existingMention = _.find(
existingMentions,
{"text": text, "startPos": cursorPos}
);
if ( existingMention && !mentionShortcut ) {
if ( options.debug ) {
log("Have exact match with existing mention");
}
results.push( existingMention );
continue;
}
existingMention = _.find(
existingMentions,
{"text": text}
);
if ( existingMention && !mentionShortcut ) {
if ( options.debug ) {
log("Have text match different startPos with existing mention");
}
newMention = ng.copy( existingMention );
newMention.startPos = cursorPos;
results.push( newMention );
continue;
}
if (!!members.length && text === "@project") {
_.each( members, function(member) {
newMention = {
userID: member.id,
text: text,
name: member.name,
startPos: cursorPos
};
results.push( newMention );
});
continue;
}
if (!!conversationMembers.length && text === "@conversation") {
_.each( conversationMembers, function(member) {
newMention = {
userID: member.id,
text: text,
name: member.name,
startPos: cursorPos
};
results.push( newMention );
});
continue;
}
if ( options.searchCandidates && candidates.length <= options.maxCandidates ) {
_.each( candidates, function( candidate ) {
if (candidate.mentionText === text.toLowerCase() && candidate.role !== 'shortcut') {
matchingCandidates.push(ng.copy(candidate));
}
});
if ( matchingCandidates.length === 1 ) {
if ( options.debug ) {
log("Have single candidate which matches text");
}
newMention = {
userID: matchingCandidates[ 0 ].id,
text: text,
name: matchingCandidates[ 0 ].name,
startPos: cursorPos
};
results.push( newMention );
continue;
}
}
if (isEmailAddress(text)) {
if (text.charAt(0) === "@" || text.charAt(0) === "+") {
text = text.slice(1, text.length);
}
if ( options.debug ) {
log("Have apparently-valid email address");
}
newMention = {
startPos: cursorPos,
text: "+" + text,
email: text
};
results.push(newMention);
}
}
if (options.debug) {
log(results.length + " mentions in " + commentText + ":---------");
_.each(results, function(m) {
log(JSON.stringify(m));
});
}
return results;
}
function isEmailAddress(text) {
return text.match(EMAIL_RE);
}
function replaceMalformedEmails(commentText, mentions) {
mentions.forEach(function (item) {
var slicedText = item.text.slice(1,item.text.length);
if (isEmailAddress(slicedText)) {
var malformedEmail = "@" + slicedText;
if (commentText.indexOf(malformedEmail) !== -1) {
commentText = commentText.replace(malformedEmail, "+" + slicedText);
}
}
});
return commentText;
}
}
})( angular, InVision );
;
;
/*! pub-sub.js */ 
;
;
(function( ng, app ) {
"use strict";
app.factory( "PubSub", PubSubFactory );
/** @ngInject */
function PubSubFactory( _ ) {
var PubSub = function() {
function off( eventType, callback ) {
var eventConfig = parseEventConfig( eventType );
if ( ! subscriptions.hasOwnProperty( eventConfig.type ) ) {
return;
}
subscriptions[ eventConfig.type ] = _.reject(
subscriptions[ eventConfig.type ],
function( subscription ) {
if ( callback ) {
return(
( subscription.namespace === eventConfig.namespace ) &&
( subscription.callback === callback )
);
} else {
return( subscription.namespace === eventConfig.namespace );
} 
}
);
}
function on( eventType, callback, context ) {
if ( _.isArray( eventType ) ) {
_.forEach(
eventType,
function( eventType ) {
on( eventType, callback, context );
}
);
return;
}
var eventConfig = parseEventConfig( eventType );
if ( ! subscriptions.hasOwnProperty( eventConfig.type ) ) {
subscriptions[ eventConfig.type ] = [];
}
subscriptions[ eventConfig.type ].push({
namespace: eventConfig.namespace,
callback: callback,
context: ( context || {} )
});
}
function parseEventConfig( eventType ) {
var parts = eventType.split( "." );
return({
type: parts.shift(),
namespace: ( parts.join( "," ) || null )
});
}
function trigger( eventType, eventData ) {
var eventConfig = parseEventConfig( eventType );
if ( eventConfig.type === "*" ) {
throw( new Error( "IllegalEventType" ) );
}
if ( ! subscriptions.hasOwnProperty( eventConfig.type ) ) {
return;
}
var eventArguments = arguments;
eventArguments[ 0 ] = {
type: eventConfig.type,
namespace: eventConfig.namespace
};
_.forEach(
subscriptions[ eventConfig.type ],
function( subscription ) {
if ( 
( eventConfig.namespace === null ) ||
( eventConfig.namespace === subscription.namespace )
) {
subscription.callback.apply( subscription.context, eventArguments );
}
}
);
_.forEach(
subscriptions[ "*" ],
function( subscription ) {
subscription.callback.apply( subscription.context, eventArguments );
}
);
}
var subscriptions = {};
subscriptions[ "*" ] = [];
return({
off: off,
on: on,
trigger: trigger
});
};
return( PubSub );
}
})( angular, InVision );
;
;
/*! app-controller.js */ 
;
;
(function( ng, app ){
"use strict";
app.controller( "AppController", Controller );
/** @ngInject */
function Controller(
$scope,
$document,
$route,
$routeParams,
$location,
$window,
$timeout,
config,
requestContext,
shareService,
Deferred,
_,
modelEvents,
sessionService,
userService,
appSettings,
sessionInactivityService
) {
function getXsrfTokenCookie() {
var cookieString = ( $document.prop( "cookie" ) || "" );
var matches = cookieString.match( /\bXSRF-TOKEN=([^;]+)/i );
return( ( matches && matches[ 1 ] ) || "" );
}
function isInVisionAppUser() {
return $scope.user && ! $scope.user.isAnonymous && $scope.user.email.indexOf("@invisionapp.com") > -1;
}
function isRouteRedirect( route ) {
return( ! route.current.action );
}
$scope.clearBodyStyle = function() {
$scope.bodyStyle = {};
};
$scope.setBodyClass = function( className ) {
var bodyClass = 'board';
$scope.bodyClass = ( bodyClass + " " + className );
};
$scope.setWindowTitle = function( title ) {
$scope.windowTitle = title;
};
$scope.toggleShareModal = function() {
$scope.isShowingShareModal = ! $scope.isShowingShareModal;
};
$scope.toggleSidebar = function() {
$scope.sidebarOpen = ! $scope.sidebarOpen;
};
$scope.openModalWindow = function() {
var modalData = _.toArray( arguments );
var modalType = modalData.shift();
$scope.$broadcast( "openModalWindow", modalType, modalData );
};
var renderContext = requestContext.getRenderContext( "", "itemID" );
$scope.user = sessionService.getUser();
appSettings.setUser( $scope.user );
$scope.settings = appSettings.getSettings();
$scope.xsrfToken = getXsrfTokenCookie();
$scope.windowTitle = "Boards";
$scope.bodyClass = "";
$scope.setBodyClass( "" );
$scope.subview = null;
$scope.share = shareService.getShare();
$scope.isModalOpen = false;
$scope.isShowingShareModal = false;
$scope.shareLink = $document[0].URL;
$scope.sidebarOpen = false;
$scope.isReviewer = $scope.user.isReviewer;
$scope.config = config;
$scope.baseBoardsRoute = "/projects/boards";
$scope.$watch(
"share",
function(newValue, oldValue) {
if( !! newValue.data.metaData && !! newValue.data.metaData.imageUrl ) {
$scope.share.data.metaData.imageDownloadUrl = newValue.data.metaData.imageUrl + "?download=true";
}
},
true);
$scope.$on(
"requestContextChanged",
function() {
if ( ! renderContext.isChangeRelevant() ) {
return;
}
$scope.subview = renderContext.getNextSection();
$scope.setBodyClass( "" );
}
);
$scope.$on(
"$routeChangeSuccess",
function( event, currentRoute, previousRoute ) {
if ( isRouteRedirect( $route ) ) {
return;
}
requestContext.setContext( $route.current.action, $routeParams );
$scope.$broadcast( "requestContextChanged", requestContext );
}
);
$scope.settings = appSettings.getSettings();
$scope.$on("modal.isWindowOpen", function( event, isOpen ) {
$scope.isModalOpen = isOpen;
});
modelEvents.on(
"identityChanged.appController",
function( event, user ) {
$scope.user = sessionService.getUser();
$scope.isReviewer = ($scope.user.companyMembership && $scope.user.companyMembership
.roleID === userService.ROLES.REVIEWER) || $scope.user.isReviewer;
}
);
if ( $scope.user.hasCompanyMembership ) {
sessionInactivityService.init(
$scope.user.sessionIdentifier,
sessionService.authenticate,
function() {
document.location.reload(true);
}
);
}
}
})( angular, InVision );
;
;
/*! boards-share-item-controller.js */ 
;
;
(function( ng, app ){
"use strict";
app.controller( "modal.boards.ShareItemController", Controller );
/** @ngInject */
function Controller( $scope, $window, analyticsService, boardService, modalWindowRequest, _ ) {
$scope.openNewWindow = function() {
analyticsService.track("Boards.ShareItem", {
boardid: $scope.share.boardID,
boardsShareType: "open",
boardsShareLocation: "share",
boardItemType: boardService.itemTypeNames[+$scope.boardItem.itemTypeID]
});
};
$scope.share = modalWindowRequest.getData( 0 );
$scope.boardItem = modalWindowRequest.getData( 1 );
$scope.config = modalWindowRequest.getData( 2 );
if ($scope.config.companySettings.permissions.requireShareAuth) {
$scope.showShareAuthWarning = true;
}
$scope.shareUrl = $window.location.protocol + "//" + $window.location.hostname + "/boards/" + $scope.share.key + "/";
}
})( angular, InVision );
;
;
/*! modal-controller.js */ 
;
;
(function( ng, app ){
"use strict";
app.controller( "layouts.ModalController", Controller );
/** @ngInject */
function Controller( $scope, modalWindowRequest, beforeUnloadService, _ ) {
$scope.views = {
'shareBoardItem': 'share-item.htm'
};
var originalBodyClass = "";
var isPageRefreshing = false;
$scope.subview = null;
$scope.nextSubview = null;
$scope.$on(
"modalWindowHidden",
function( event ) {
$scope.subview = $scope.nextSubview;
$scope.nextSubview = null;
if( $scope.subview === null ) {
$scope.setBodyClass( originalBodyClass );
}
}
);
$scope.$on(
"openModalWindow",
function( event, modalType, modalData ) {
if ( isPageRefreshing ) {
return;
}
if ( $scope.subview === null ) {
modalWindowRequest.setRequest( modalType, modalData );
$scope.subview = modalType;
originalBodyClass = $scope.bodyClass;
$scope.setBodyClass( $scope.bodyClass + " modal-open" );
} else if ( modalType === "error" && $scope.subview === modalType ) {
return;
} else {
modalWindowRequest.setRequest( modalType, modalData, true ); // TRUE == suppress fade
$scope.nextSubview = modalType;
$scope.$broadcast( "closeModalWindowWithoutFade" );
}
}
);
beforeUnloadService.push(
this,
function() {
isPageRefreshing = true;
setTimeout(
function() {
isPageRefreshing = false;
},
1000
);
}
);
}
})( angular, InVision );
;
;
/*! board.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invBoard", Directive );
/** @ngInject */
function Directive(
$location,
$timeout,
userService,
commentObjectService,
modelEvents,
config
) {
var linkFunction = function( scope, element ) {
var user = scope.user;
user.initials = userService.getInitials( user.name );
user.hasSystemAvatar = userService.isSystemAvatar( user.avatarID );
InvBoards.actions.setUser(user);
if (scope.share.config.boardItemID) {
ReactDOM.render(
React.createFactory(InvBoards.boardItemComponent)({
boardItemID: scope.share.config.boardItemID,
boardID: scope.boardID,
share: config.share,
thumbnailerResizeEndpoint: config.thumbnailerResizeEndpoint,
user: user,
isShare: true
}),
element[0]
);
} else {
ReactDOM.render(
React.createFactory(InvBoards.boardComponent)({
boardID: scope.boardID,
thumbnailerResizeEndpoint: config.thumbnailerResizeEndpoint,
isReviewer: scope.isReviewer,
user: user,
isShare: true,
companySettings: config.companySettings,
shouldClose: scope.shouldClose
}),
element[0]
);
scope.setWindowTitle(scope.board.title);
}
var registerId = InvBoards.dispatcher.register(function(payload) {
var action = payload.action;
var changed = true;
switch (action.actionType) {
case InvBoards.constants.ActionTypes.GOTO_BOARD:
$location.path("/" + scope.boardID);
break;
case InvBoards.constants.ActionTypes.GOTO_ITEM:
$location.path("/" + scope.boardID + "/" + action.data.id);
break;
case InvBoards.constants.ActionTypes.LOAD_ITEM_COMMENTS:
scope.boardItem = action.data;
scope.loadItemComments();
break;
case InvBoards.constants.ActionTypes.ADD_COMMENT:
scope.boardItem = action.data.item;
scope.addNewComment(
action.data.comment,
action.data.notifyOthers,
action.data.hasAnnotation,
action.data.x,
action.data.y,
action.data.sketchData,
action.data.mentions
);
break;
case InvBoards.constants.ActionTypes.IDENTIFY_AND_ADD_COMMENT:
scope.changeIdentityAndAddNewComment(
action.data.name,
action.data.email,
action.data.commentText,
action.data.notifyUsers,
action.data.hasAnnotation,
action.data.x,
action.data.y,
action.data.sketchData,
action.data.mentions
);
break;
case InvBoards.constants.ActionTypes.DELETE_COMMENT:
scope.deleteComment( action.data.id );
break;
case InvBoards.constants.ActionTypes.UPDATE_COMMENT:
scope.updateComment(
action.data.commentID,
action.data.content,
action.data.hasAnnotation,
action.data.x,
action.data.y,
action.data.hasExistingAnnotation,
action.data.sketchID,
action.data.sketchData,
action.data.mentions
);
break;
case InvBoards.constants.ActionTypes.LOAD_COMMENTS_ROUNDUP:
scope.loadCommentsRoundup();
break;
case InvBoards.constants.ActionTypes.MARK_ITEM_COMMENTS_READ:
scope.markItemCommentsRead( action.data.id );
break;
case InvBoards.constants.ActionTypes.TRIGGER_BOARD_SHARE_OVERLAY :
scope.loadShareData( action.data.boardId );
break;
case InvBoards.constants.ActionTypes.SHARE_BOARD_ITEM :
scope.shareBoardItem(action.data);
break;
case InvBoards.constants.ActionTypes.SET_IMAGE_COLORS :
scope.setImageColors( action.data );
break;
case InvBoards.constants.ActionTypes.OPEN_MODAL:
switch ( action.data.modalType ) {
case "share-board-item":
scope.shareBoardItem(action.data.item);
break;
}
break;
default:
changed = false;
break;
}
if ( changed ) {
$timeout(function() {
});
}
return true;
});
modelEvents.on("identityChanged", function() {
$timeout(function() {
InvBoards.actions.setUser(scope.user);
});
});
var setFlags = function(scopeFlags) {
var features = {};
var k;
for (k in scopeFlags) {
if (scopeFlags[k]) {
features[k] = scopeFlags[k];
}
}
for (k in config.featureFlags) {
if (config.featureFlags[k]) {
features[k] = config.featureFlags[k];
}
}
return features;
};
setTimeout(function() {
InvBoards.actions.setFeatureFlags(setFlags(scope.settings.features));
InvBoards.actions.setBaseBoardsRoute(scope.baseBoardsRoute);
});
scope.$watch("settings.features", function(newValue, oldValue) {
if (! _.isEqual(newValue, oldValue)) {
setTimeout(function() {
InvBoards.actions.setFeatureFlags(setFlags(newValue));
InvBoards.actions.setBaseBoardsRoute(scope.baseBoardsRoute);
});
}
});
scope.$on("boardLoaded", function() {
InvBoards.actions.setBoard(scope.board);
commentObjectService.set("board", scope.boardID);
});
scope.$on("singleItemShareLoaded", function() {
InvBoards.actions.setBoard(scope.board);
InvBoards.actions.setSingleItemShare(scope.boardItem);
scope.setWindowTitle(scope.boardItem.title);
commentObjectService.set("board", scope.boardID);
});
scope.$on("shareLoaded", function(event, response) {
InvBoards.actions.boardShareLoaded(response);
});
scope.$on("boardItemCommentsLoaded", function() {
InvBoards.actions.commentsLoaded(scope.boardItem);
commentObjectService.set("board", {
objectID: scope.boardID,
conversationID: scope.boardItem.id
});
});
scope.$on("newCommentID", function(event, boardItem, commentID, sketchID) {
InvBoards.actions.updateCommentID(boardItem, commentID, sketchID);
});
scope.$on("$locationChangeSuccess", function(event, newUrl, oldUrl) {
$timeout(function() {
InvBoards.actions.URLUpdated(newUrl, true);
});
});
scope.$on("$destroy", function() {
ReactDOM.unmountComponentAtNode(element[0]);
InvBoards.dispatcher.unregister(registerId);
});
};
return({
restrict: "E",
link: linkFunction
});
}
})( angular, InVision );
;
;
/*! copy-to-clipboard.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive(
"invCopyToClipboard",
function( $timeout, analyticsService, boardService, errorLogService ) {
var linkFunction = function( $scope, element, attributes ) {
try {
analyticsService.segmentIo();
} catch (error) {
errorLogService.exceptionHandler(error);
}
var $element = $(element),
$button = $element.find("button"),
$copied = $element.find(".copied"),
input = element.find("input[type='text']");
if( $button.length === 0 ){
$button = $element.find("a.copy");
}
var handleLinkCopy = function() {
analyticsService.track("Boards.ShareItem", {
boardid: $scope.boardItem.boardID,
boardsShareType: "url",
boardsShareLocation: "share",
boardItemType: boardService.itemTypeNames[+$scope.boardItem.itemTypeID]
});
};
var copyToClipboard = function(e) {
copyToNativeClipboard(e, input.val() );
e.preventDefault();
$copied.show();
$timeout(function() {
$copied.hide();
}, 4000);
handleLinkCopy();
};
document.addEventListener("copy", copyToClipboard );
$button.on("click.copyToClipboard", function() {
document.execCommand("copy");
});				
$scope.$on(
"$destroy",
function() {
$button.off("click.copyToClipboard");
document.removeEventListener("copy", copyToClipboard );
}
);
};
return({
link: linkFunction
});
}
);
})( angular, InVision );
;
;
/*! realtime.js */ 
;
;
(function( ng, app ) {
"use strict";
app.directive( "invRealtime", Directive );
/** @ngInject */
function Directive( $window, config, Pusher, modelEvents, _ ) {
function link( $scope, element, attributes ) {
function buildModelEventTriggerArguments( event, eventType, propertyNames ) {
var triggerArguments = _.map(
propertyNames,
function( propertyName ) {
return( event.data[ propertyName ] );
}
);
triggerArguments.unshift( eventType );
return( triggerArguments );
}
function getChannelName( userID ) {
var privateChannelName = ["private", "user", userID];
if ( config.pusher.namespace ) {
privateChannelName.push(config.pusher.namespace);
}
return( privateChannelName.join("-") );
}
function buildModelEventTriggerArguments( event, eventType, propertyNames ) {
var triggerArguments = _.map(
propertyNames,
function( propertyName ) {
return( event.data[ propertyName ] );
}
);
triggerArguments.unshift( eventType );
if ('triggeredByUserID' in event) {
triggerArguments.push(event.triggeredByUserID);
}
return( triggerArguments );
}
function mapPushEvent( channel, eventType, property1, property2, propertyN ) {
var propertyNames = _.toArray( arguments );
var channel = propertyNames.shift();
var eventType = propertyNames.shift();
channel.bind(
eventType,
function( event ) {
var triggerArguments = buildModelEventTriggerArguments( event, eventType, propertyNames );
$scope.$apply(
function() {
modelEvents.trigger.apply( modelEvents, triggerArguments );
}
);
}
);
}
function subscribeToChannelEvents( userChannel ) {
mapPushEvent( userChannel, "boardUpdated", "board" );
mapPushEvent( userChannel, "boardItemCreated", "board" );
mapPushEvent( userChannel, "boardItemUploaded", "boardItem" );
mapPushEvent( userChannel, "boardPhotoHeaderUploaded", "board" );
mapPushEvent( userChannel, "sessionInactive", "identifier" );
mapPushEvent( userChannel, "boardItemCommentAdded", "boardItemCommentID", "boardItemID", "boardID" );
return( userChannel );
}
$window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;
Pusher.channel_auth_endpoint = "/api/pusher/authenticate";
var pusherOptions = ( config.allowExternalScripts !== false ) ? {} : {disableStats: true};
var pusher = new Pusher( config.pusher.appKey, pusherOptions );
var userChannel = null
var unwatchUserID = $scope.$watch(
function watchUserIDExpression() {
return( config.user.id );
},
function watchUserID( newUserID, oldUserID ) {
if ( ! config.user.isAnonymous ) {
unwatchUserID();
}
if ( userChannel && oldUserID ) {
pusher.unsubscribe( getChannelName( oldUserID ) );
}
userChannel = subscribeToChannelEvents( pusher.subscribe( getChannelName( newUserID ) ) );
userChannel.bind('pusher:subscription_error', function(status) {
if(status == 403){
pusher.unsubscribe( getChannelName( newUserID ) );
}
});
}
);
/*
$scope.$on(
"$destroy",
function() {
}
);
*/
};
return({
link: link,
restrict: "A"
});
}
})( angular, InVision );
;
;
/*! before-unload-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "beforeUnloadService", BeforeUnloadService );
/** @ngInject */
function BeforeUnloadService( $window, _ ) {
this.functionQueue = [];
$window.onbeforeunload = ng.bind( this, this.run );
return( this );
}
BeforeUnloadService.prototype = {
run: function( ) {
ng.forEach( this.functionQueue, function( bundle ){
bundle.funcRef.apply( bundle.context, bundle.args );
});
},
push: function( context, funcRef, args ) {
if( _.isUndefined( funcRef ) || !_.isFunction( funcRef ) ) {
funcRef = ng.noop;
}
this.functionQueue.push( {	
context: context,
funcRef: funcRef,
args: args
} );
}
};
})( angular, InVision );
;
;
/*! session-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "sessionService", SessionService );
/** @ngInject */
function SessionService( $q, $resource, serviceHelper, config, modelEvents, userService, _ ) {
function authenticate() {
var deferred = $q.defer();
resource.get(
{
},
function( response ) {
ng.extend( user, response.account );
user.projectsUrl = response.projectsUrl;
user.initials = userService.getInitials( user.name );
user.hasSystemAvatar = userService.isSystemAvatar( user.avatarID );
if (response && response.sync) {
user.isSyncEnabled = response.sync.enabled;
user.syncClients = response.sync.clients;
}
user.companyInfo = response.companyInfo;
deferred.resolve( response );
},
function() {
deferred.reject();
}
);
return( deferred.promise );
}
function get( key, defaultValue ) {
var localKey = getDataKey( key );
if ( data.hasOwnProperty( localKey ) ) {
return( data[ localKey ] );
} else if ( ! ng.isUndefined( defaultValue ) ) {
data[ localKey ] = defaultValue;
return( defaultValue );
}
}
function getDataKey( key ) {
return( "session__" + key );
}
function set( key, value ) {
var localKey = getDataKey( key );
data[ localKey ] = value;
}
function getUser(){
return user;
}
var user = ng.copy( config.user );
user.hasSystemAvatar = userService.isSystemAvatar( user.avatarID );
user.initials = userService.getInitials( user.name );
var data = {};
modelEvents.on(
"shareIdentityChanged.sessionService",
function( event, identifiedUser ) {
user = ng.copy( identifiedUser );
user.hasSystemAvatar = userService.isSystemAvatar( user.avatarID );
user.initials = userService.getInitials( user.name );
}
);
var resource = $resource(
"/api/account",
{
},
{
getUser: {
method: "GET"
}
}
);
return({
authenticate:authenticate,
get: get,
set: set,
user: user,
getUser: getUser
});
}
})( angular, InVision );
;
;
/*! user-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "userService", UserService );
/** @ngInject */
function UserService( config, modelEvents, _ ) {
function getAffiliates() {
return(
ng.copy( config.affiliates )
);
}
function getInitials( name ) {
if ( ! name ) {
return( "" );
}
var nameParts = name.replace( /^\s+|\s+$/i, "" ).split( /\s+/i );
var namePartsCount = nameParts.length;
if ( namePartsCount > 1 ) {
return(
nameParts[ 0 ].slice( 0, 1 ) +
nameParts[ namePartsCount - 1 ].slice( 0, 1 )
);
}
return( nameParts[ 0 ].slice( 0, 1 ) );
}
function getFirstName( name ) {
if ( ! name ) {
return( "" );
}
var nameParts = name.replace( /^\s+|\s+$/i, "" ).split( /\s+/i );
return( nameParts[ 0 ] );
}
function getOnlineStatus( lastRequestAt ) {
var now = ( new Date() ).getTime();
var onlineCutoff = ( 10 * 60 * 1000 ); 	// 10 minutes.
var awayCutoff = ( 30 * 60 * 1000 );	// 30 minutes.
if ( lastRequestAt > ( now - onlineCutoff ) ) {
return( "Online" );
} else if ( lastRequestAt > ( now - awayCutoff ) ) {
return( "Away" );
}
return( "Offline" );
}
function getMembers() {
return(
ng.copy( config.members )
);
}
function isAffiliate( userID ) {
for ( var i = 0, length = config.affiliates.length ; i < length ; i++ ) {
if ( config.affiliates[ i ].id === userID ) {
return( true );
}
}
return( false );
}
function isSystemAvatar( avatarID ) {
return( avatarID.indexOf( "00000000" ) === 0 );
}
modelEvents.on(
"shareIdentityChanged.userService",
function( event, user ) {
config.user = ng.copy( user );
/*
var cachedMember = _.findWithProperty( config.members, "id", user.id );
var cachedAffiliate = _.findWithProperty( config.affiliates, "id", user.id );
if ( cachedMember || cachedAffiliate ) {
return;
}
config.affiliates.push( user );
config.affiliates.sort(
function( a, b ) {
return( a.name.toLowerCase() < b.name.toLowerCase() ? -1 : 1 );
}
);
*/
modelEvents.trigger( "identityChanged" );
}
);
var ROLES = {
ADMIN : 1,
MANAGER : 2,
CONTRIBUTOR: 3,
REVIEWER: 4
};
return({
getAffiliates: getAffiliates,
getInitials: getInitials,
getFirstName: getFirstName,
getOnlineStatus: getOnlineStatus,
getMembers: getMembers,
isAffiliate: isAffiliate,
isSystemAvatar: isSystemAvatar,
ROLES: ROLES
});
}
})( angular, InVision );
;
;
/*! boards-controller.js */ 
;
;
(function(ng, app) {
"use strict";
app.controller("boards.BoardsController", Controller);
/** @ngInject */
function Controller(
$location,
$scope,
$timeout,
$window,
_,
analyticsService,
boardService,
boardsPartial,
config,
modelEvents,
userPreferenceService,
userService
) {
var SORT_ALPHA = "alpha";
var SORT_ACTIVITY = "activity";
var vm = this;
vm.boards = [];
vm.companies = [];
vm.boardShareReference;
_.merge($scope, {
boardsSortPreference: 2,
canShowAllEnterpriseBoards: canShowAllEnterpriseBoards(),
duplicateBoard: duplicateBoard,
deleteBoard: deleteBoard,
joinBoard: joinBoard,
openBoardShare: openBoardShare,
setSortPreference: setSortPreference,
shareBoard: shareBoard,
openModalArchive: openModalArchive,
openModalUnarchive: openModalUnarchive
});
modelEvents.on("boardCreated.boards", onBoardCreatedEvent);
modelEvents.on("boardUpdated.boards", onBoardUpdatedEvent);
modelEvents.on("boardDeleted.boards", onBoardDeletedEvent);
modelEvents.on("boardItemDeleted.boards", onCommonEvent);
modelEvents.on("subscriptionChanged.boards", onCommonEvent);
$scope.$on("$destroy", onDestroyEvent);
$scope.$on("boardDuplicated", onCommonEvent);
initalize();
function saveSortPreference(sortPreference) {
userPreferenceService
.getPreferenceTypeByName("boardsSortPreference", true, "string")
.then(filterTypeID)
.then(function(id) {
userPreferenceService.setUserPreferenceById(id, sortPreference);
});
}
function onBoardCreatedEvent(event, board) {
vm.boards.push(board);
updateBoards(vm.boards);
}
function onBoardDeletedEvent(event, boards) {
updateBoards(boards);
}
function onBoardUpdatedEvent(event, board) {
var index = _.indexOf(vm.boards, _.find(vm.boards, {id: board.id}));
var cachedBoard, mergedBoard;
cachedBoard = _.findWhere(vm.boards, { id: board.id }); // Get the cached board
mergedBoard = _.merge({}, cachedBoard, board); // Combine cached and new board properties
vm.boards.splice(index, 1, mergedBoard);
if (cachedBoard) {
updateBoards(vm.boards);
}
}
function onCommonEvent() {
initalize();
}
function onDestroyEvent() {
modelEvents.off("boardCreated.boards");
modelEvents.off("boardUpdated.boards");
modelEvents.off("boardItemDeleted.boards");
modelEvents.off("boardDeleted.boards");
modelEvents.off("subscriptionChanged.boards");
}
function filterTypeID(type) {
return type.data.id;
}
function initalize() {
$scope.setWindowTitle("Boards");
analyticsService.trackGrowthPage("Boards");
userPreferenceService
.getPreferenceTypeByName("boardsSortPreference", true, "string")
.then(filterTypeID)
.then(userPreferenceService.getUserPreferenceById)
.then(function(valueResponse) {
$scope.boardsSortPreference = !!valueResponse.exists || !!valueResponse.data && +valueResponse.data.value !== 1 ? 2 : 1;
})
.then(boardsPartial.get)
.then(applyBoardsMiddleware, handleBoardsFail)
.then(function(data) {
$scope.$broadcast("boards:dataLoaded", data);
analyticsService.track("Boards.Opened");
});
}
function handleBoardsFail() {
var message = "For some reason, we couldn't load your boards. "
+ "Try refreshing your browser.";
$scope.openModalWindow("error", message);
return Promise.reject();
}
function updateBoards(boards) {
vm.boards = augmentBoards(boards);
var updatedCompanies = augmentCompanies(vm.boards, vm.companies);
InvBoards.actions.updateBoards(vm.boards);
InvBoards.actions.setCompanyData(updatedCompanies);
}
function applyBoardsMiddleware(res) {
vm.boards = augmentBoards(res.boards || []);
vm.companies = res.companies || [];
var collaborators = augmentTeamMembers(getAllCollaboratorsForFiltering());
return {
companies: augmentCompanies(vm.boards, res.companies),
boards: vm.boards,
collaborators: collaborators,
sort: getSortPreferenceByName(),
isEnterprise: $scope.isEnterprise,
companyTeams: res.companyTeams
};
}
function getAllCollaboratorsForFiltering() {
var collaborators = [];
_.forEach(vm.boards, function(board) {
if (board && board.members) {
_.forEach(board.members, function(member) {
if (!_.findWithProperty(collaborators, "id", member.id)) {
collaborators.push(member);
}
});
}
});
return _.sortOnPropertyUsingLowerCase( collaborators, "name" );
}
function augmentTeamMembers(teamMembers) {
if (!teamMembers) return [];
var teams = teamMembers.map(function(member) {
var _member = _.merge({}, member);
_member.initials = userService.getInitials(_member.name);
_member.hasSystemAvatar = userService.isSystemAvatar(_member.avatarID);
return _member;
});
return teams;
}
function augmentCompanies(boards, companies) {
return companies.map(function(company) {
company.activeBoards = boards.filter(function(board) {
return board.companyID === company.leadUserID;
});
return company;
});
}
function augmentBoards(boards) {
return boards.map(function(board) {
board.members = augmentTeamMembers(board.members);
board.boarditems = board.boarditems || [];
return board;
});
}
function getSortPreferenceByName() {
switch ($scope.boardsSortPreference) {
case 1:
return SORT_ALPHA;
default:
return SORT_ACTIVITY;
}
}
function canShowAllEnterpriseBoards() {
if ($scope.isEnterprise) {
if ($scope.isContributor &&
!$scope.enterpriseConfig.permissions.canDesignersViewAllBoards) {
return false;
}
return true;
}
return false;
}
function setSortPreference(sortType) {
$scope.boardsSortPreference = sortType;
saveSortPreference(sortType);
}
function openBoardShare(boardID, context) {
var url = $window.location.protocol + "//" + $window.location.hostname + "/boards/";
vm.boardShareReference = $window.open($window.location.href, "boardShare_" + boardID);
if (vm.boardShareReference === null || vm.boardShareReference.document.location.href !== url) {
boardService.createShare(boardID)
.then(function(response) {
var params = context.isEnterpriseBoard ? "#?nonce=true" : "";
var boardUrl = url + response.key + "/" + params;
$window.open(boardUrl, "boardShare_" + boardID);
});
}
}
function joinBoard(board) {
boardService.changeUsersOnBoard(board.id, [$scope.user.id])
.then(function() {
$location.url("/boards/" + board.id);
});
}
function shareBoard(boardID) {
boardService.createShare(boardID)
.then(function(response) {
$scope.openModalWindow("shareBoard", response, config);
}, function(response) {
$scope.openModalWindow("error", "For some reason, we couldn't create "
+ "your share link. Try refreshing "
+ "your browser.");
});
}
function deleteBoard(board) {
$scope.openModalWindow("deleteBoard", board);
}
function duplicateBoard(board) {
$scope.openModalWindow("duplicateBoard", board);
}
function openModalArchive(boardId) {
$scope.openModalWindow("archiveBoard", boardId);
}
function openModalUnarchive(data) {
$scope.openModalWindow("unarchiveBoard", data);
}
}
})(angular, InVision);
;
;
/*! board-controller.js */ 
;
;
(function( ng, app ) {
"use strict";
app.controller( "boards.BoardController", Controller );
/** @ngInject */
function Controller( $scope, $attrs, $timeout, $location, $filter, $window, requestContext, Deferred, boardService, _, modelEvents, hashKeyCopier, userService, colorExtractionService, analyticsService, shareService, config, errorLogService ) {
var sheet;
var isShare = $attrs.isShare === "true";
var isNonce = $location.search().nonce === "true";
try {
analyticsService.segmentIo();
} catch (error) {
errorLogService.exceptionHandler(error);
}
function loadRemoteData() {
$scope.isLoading = true;
var boardID = isShare ? $scope.boardID : requestContext.getParamAsInt( "boardID" );
var user = $scope.user;
if (! isShare) {
if ( ! boardID ) {
$location.path("/boards/");
return;
} else if ( $scope.isReviewer ) {
redirectToShare();
}
Deferred.handlePromise(
boardService.getBoard( boardID ),
function( response ) {
var isMember = response.members.some(function(m) { return m.id === user.id; });
if ( !isMember ) {
redirectToShare();
return;
} else {
$scope.isLoading = false;
applyRemoteData( response );
}
},
function( response ) {
if (response.code === 403) {
redirectToShare();
} else {
$scope.openModalWindow( "error", "For some reason, we couldn't load your board. Try refreshing your browser." );
}
}
);
} else {
Deferred.handlePromise(
boardService.getBoard( boardID ),
function( response ) {
$scope.isLoading = false;
applyRemoteData( response );
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't load your board. Try refreshing your browser." );
}
);
}
}
function applyRemoteData( response ) {
_.each( response.groups, function(group) {
$scope.boardGroupCopies[group.id] = {
title: group.title,
description: group.description,
sortOrder: getSortOrder( group )
};
});
$scope.board = response;
$scope.board.members = augmentTeamMembers( response.members );
$scope.setWindowTitle( $scope.board.title );
checkSampleProjectWelcomeModal($scope.board);
$scope.$broadcast("boardLoaded");
}
function checkSampleProjectWelcomeModal(board) {
if (! board.isSample) {
return;
}
if ($window.localStorage) {
var viewedSampleBoards = localStorage.getItem("viewedSampleBoards");
if (!! viewedSampleBoards) {
viewedSampleBoards = JSON.parse(viewedSampleBoards);
if (viewedSampleBoards.indexOf(board.id) >= 0) {
return;
}
}
}
$scope.openModalWindow("sampleProjectWelcome", board.id, board.title, "board");
}
function augmentTeamMembers( teamMembers ) {
for ( var i = 0, length = teamMembers.length; i < length; i++ ) {
var user = teamMembers[ i ];
user.initials = userService.getInitials( user.name );
user.hasSystemAvatar = userService.isSystemAvatar( user.avatarID );
}
return( teamMembers );
}
function getSortOrder( group ) {
var sortedGroupItems = ( !! group.items ) ? _.sortOnProperty( group.items, "sort", "asc" ) : [];
var sortOrder = !! sortedGroupItems ? _.pluck( sortedGroupItems, "id" ) : [];
return sortOrder;
}
function redirectToShare() {
InvBoards.actions.setIsRedirecting(true);
Deferred.handlePromise(
boardService.createShare( $scope.boardID ),
function( response ) {
var url = $window.location.protocol + "//" + $window.location.hostname + "/boards/";
$window.location.href = url + response.key + "/";
}
);
}
function updateBoardItems( boardData ) {
if ( !! boardData ) {
$scope.board = hashKeyCopier.copyHashKeys( $scope.board, boardData );
$scope.board.members = augmentTeamMembers( $scope.board.members );
$scope.$broadcast("packery:addItems");
}
updateBoardItemSorting( !! boardData );
}
function updateBoardItemSorting( contentChanged, force ) {
force = !! force;
var changedGroups = {};
var groupsProcessed = 0;
for ( var group in $scope.boardGroupCopies ) {
$scope.$broadcast("packery:getItemSort", group, updateBoardItemSortingCallback);
}
function updateBoardItemSortingCallback( groupID, sortOrder ) {
groupsProcessed++;
if ( ! _.isEqual(sortOrder, $scope.boardGroupCopies[groupID].sortOrder) || force ) {
changedGroups[groupID] = sortOrder;
$scope.boardGroupCopies[groupID].sortOrder = sortOrder;
}
if ( groupsProcessed >= $scope.board.groups.length ) {
$scope.saveBoardItemSorting( changedGroups, contentChanged );
}
}
}
$scope.updateBoardSettings = updateBoardSettings;
function updateBoardSettings(settings) {
boardService
.updateBoardSettings($scope.board.id, settings)
.then(function(response) {
}, function(response) {
$scope.openModalWindow( "error", "For some reason, we couldn't update your board. Try refreshing your browser." );
});
}
$scope.saveBoardItemSorting = function() {
$timeout(function() {
var newSort = {};
var groups = InvBoards.boardStore.getBoard().groups;
groups.forEach(function(group) {
var groupSort = _.clone(_.pluck(_.sortBy(group.items, "sort"), "id"));
newSort[group.id] = groupSort;
});
Deferred.handlePromise(
boardService.updateItemSort( $scope.board.id, JSON.stringify(newSort) ),
function( response ) {
analyticsService.track("Boards.RepositionItem", {
boardid: $scope.boardID
}, {
integrations: {
All: false
}
});
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't sort your board items. Try refreshing your browser." );
}
);
}, 200);
};
function updateBoardGroupSorting() {
var sortedGroups = _.sortOnProperty( $scope.board.groups, "sort", "asc" );
var boardGroupIDs = _.pluck( sortedGroups, "id" );
boardService.updateGroupSort( $scope.board.id, JSON.stringify(boardGroupIDs) );
}
function createBoardItemPlaceholders( files ) {
var isReplacing = false;
for ( var i = 0; i < files.length; i++ ) {
isReplacing = false;
var j, k;
for ( j = 0; j < $scope.board.groups.length; j++ ) {
var group = $scope.board.groups[j];
if ( !! group.items && group.items.length > 0 ) {
for ( k = 0; k < group.items.length; k++ ) {
var item = group.items[k];
if ( !! item.metaData.clientFilename && item.metaData.clientFilename === files[i].name ) {
$scope.board.groups[j].items[k].isProcessed = false;
$scope.board.groups[j].items[k].metaData.imageHeight = files[i].height;
$scope.board.groups[j].items[k].metaData.imageWidth = files[i].width;
isReplacing = true;
}
}
}
}
if ( ! isReplacing ) {
var boardGroup = _.findWithProperty($scope.board.groups, "id", files[i].groupID);
var placeholderItem = {
uploaderID: files[i].id,
isProcessed: false,
itemTypeID: boardService.itemTypes.IMAGE,
name: files[i].processedName,
progress: files[i].percent,
metaData: {
imageHeight: files[i].height,
imageWidth: files[i].width,
image: files[i].image
}
};
if ( ! boardGroup ) {
boardGroup = $scope.board.groups[0];
}
boardGroup.items.push( placeholderItem );
}
}
$scope.$broadcast( "packery:itemsUpdated", "placeholders" );
}
function updateBoardItemPlaceholder( boardData ) {
var newBoardItem = $scope.findBoardItemWithProperty( "id", boardData.newBoardItemID, boardData );
if ( !! newBoardItem ) {
for ( var i = 0; i < $scope.board.groups.length; i++ ) {
var group = $scope.board.groups[i];
if ( !! group.items ) {
for ( var j = 0; j < group.items.length; j++ ) {
var item = group.items[j];
if ( ( item.name === newBoardItem.title || item.title === newBoardItem.title ) && ! item.isProcessed ) {
var imageWidth = ng.copy(item.metaData.imageWidth);
var imageHeight = ng.copy(item.metaData.imageHeight);
if ( ! newBoardItem.metaData.imageWidth && !! $scope.board.groups[i].items[j].metaData.imageWidth ) {
newBoardItem.metaData.imageWidth = $scope.board.groups[i].items[j].metaData.imageWidth;
newBoardItem.metaData.imageHeight = $scope.board.groups[i].items[j].metaData.imageHeight;
}
$scope.board.groups[i].items[j].id = newBoardItem.id;
$scope.board.groups[i].items[j].title = newBoardItem.title;
$scope.board.groups[i].items[j].commentCount = newBoardItem.commentCount;
$scope.board.groups[i].items[j].createdAt = newBoardItem.createdAt;
$scope.board.groups[i].items[j].createdBy = newBoardItem.createdBy;
$scope.board.groups[i].items[j].metaData = newBoardItem.metaData;
$scope.board.groups[i].items[j].metaData.imageWidth = imageWidth;
$scope.board.groups[i].items[j].metaData.imageHeight = imageHeight;
$scope.board.groups[i].items[j].updatedAt = newBoardItem.updatedAt;
$scope.board.groups[i].items[j].isProcessed = true;
$scope.$broadcast("reloadImage", newBoardItem.id);
return;
}
}
}
}
}
}
function addTeamInvites( invites ) {
for ( var i = 0; i < invites.length; i++ ) {
$scope.board.teamInvitations.push( invites[i] );
}
}
function saveBoardItem( callback, boardItem ) {
callback = callback || null;
boardItem = boardItem || $scope.boardItem;
if ( ! boardItem.title ) {
boardItem.title = generateItemTitle( boardItem.itemTypeID );
}
var params = {
boardGroupID: boardItem.groupID,
sort: !! boardItem.sort ? boardItem.sort : 0,
title: boardItem.title,
description: boardItem.description,
tags: !! boardItem.metaData.tags ? JSON.stringify(boardItem.metaData.tags) : JSON.stringify([]),
columns: !! boardItem.columns ? boardItem.columns : 1
};
switch ( boardItem.itemTypeID ) {
case boardService.itemTypes.COLOR :
params.color = boardItem.metaData.color;
if ( ! params.color ) {
params.color = "#eee";
}
break;
case boardService.itemTypes.NOTE :
params.note = boardItem.metaData.note;
break;
case boardService.itemTypes.IMAGE :
params.imageColors = JSON.stringify(boardItem.metaData.imagecolors);
break;
}
if ( boardItem.id ) {
updateBoardItem( boardItem, params, callback );
} else {
saveNewBoardItem( boardItem, params, callback );
}
}
function saveNewBoardItem( boardItem, params, callback ) {
params = params || {};
callback = callback || null;
var boardGroupID = params.boardGroupID;
var sort = params.sort;
var title = params.title;
var tags = params.tags;
switch ( boardItem.itemTypeID ) {
case boardService.itemTypes.COLOR :
var color = params.color;
Deferred.handlePromise(
boardService.createColorSwatchItem( boardGroupID, sort, title, color, tags ),
function( response ) {
if ( callback && typeof callback === "function" ) {
callback( response );
}
}
);
break;
case boardService.itemTypes.NOTE :
var note = params.note;
Deferred.handlePromise(
boardService.createNoteItem( boardGroupID, sort, title, note, tags ),
function( response ) {
if ( callback && typeof callback === "function" ) {
callback( response );
}
}
);
break;
case boardService.itemTypes.IMAGE :
break;
}
}
function updateBoardItem( boardItem, params, callback ) {
params = params || {};
callback = callback || null;
var boardGroupID = params.boardGroupID;
var sort = params.sort;
var title = params.title;
var description = params.description;
var tags = params.tags;
var columns = params.columns;
var additionalParameters = {};
switch ( boardItem.itemTypeID ) {
case boardService.itemTypes.COLOR :
additionalParameters.color = params.color;
break;
case boardService.itemTypes.NOTE :
additionalParameters.note = params.note;
break;
case boardService.itemTypes.IMAGE :
additionalParameters.imageColors = params.imageColors;
break;
}
Deferred.handlePromise(
boardService.updateBoardItem( boardItem.id, boardGroupID, sort, title, description, tags, columns, additionalParameters ),
function( response ) {
if ( callback && typeof callback === "function" ) {
callback( response );
}
}
);
}
function generateItemTitle( type ) {
var boardItemTitles = [];
var title;
_.each( $scope.board.groups, function(group) {
if ( !! group.items ) {
_.each( group.items, function(item) {
boardItemTitles.push( item.title );
});
}
});
if (boardService.itemTypes.NOTE === type) return "";
switch ( type ) {
case boardService.itemTypes.COLOR :
title = "New Color";
break;
case boardService.itemTypes.IMAGE :
title = "New Image";
break;
}
if ( boardItemTitles.indexOf( title ) !== -1 ) {
var counter = 2;
var originalTitle = title;
while ( boardItemTitles.indexOf( title ) !== -1 ) {
title = originalTitle + " " + counter;
counter++;
}
return title;
} else {
return title;
}
}
$scope.shareBoard = function( boardID ) {
Deferred.handlePromise(
boardService.createShare( boardID ),
function( response ) {
$scope.openModalWindow( "shareBoard", response );
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't create your share link. Try refreshing your browser." );
}
);
};
$scope.loadShareData = function( boardID ) {
Deferred.handlePromise(
boardService.createShare( boardID ),
function( response ) {
$scope.$broadcast("shareLoaded", response);
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't create your share link. Try refreshing your browser." );
}
);
};
$scope.loadSettingsData = function( boardID ) {
var success = function(response) {
$scope.$broadcast("board:settings:loaded", response);
};
var failure = function() {
$scope.openModalWindow("error", "For some reason, we couldn't create "
+ "your share link. Try refreshing your "
+ "browser.");
};
return boardService
.createShare(boardID)
.then(success, failure);
};
$scope.addColorItem = function( color, item, sort ) {
boardService.createColorSwatchItem(
item.groupID,
sort,
color,
color,
JSON.stringify([])
).then(function(response) {
var newBoardItem = $scope.findBoardItemWithProperty( "id", response.newBoardItemID );
InvBoards.actions.addNewColorItem( newBoardItem );
});
};
$scope.shareBoardItem = function(item) {
analyticsService.trackGrowth("App - Projects - Click Share Button", {"Location": "Share Board Item Button"});
Deferred.handlePromise(
boardService.createShare( item.boardID, item.id ),
function( response ) {
$scope.openModalWindow( "shareBoardItem", response, item, config );
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't create your share link. Try refreshing your browser." );
}
);
};
$scope.colorTitleUpdated = function( title, skipSave ) {
skipSave = !! skipSave;
$scope.boardItem.title = title;
if ( /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test( $scope.boardItem.title ) ) {
$scope.boardItem.metaData.color = $scope.boardItem.title;
}
if ( !! $scope.boardItem.id && ! skipSave ) {
saveBoardItem();
}
};
$scope.itemTitleUpdated = function( title ) {
$scope.boardItem.title = title;
if ( !! $scope.boardItem.id ) {
saveBoardItem();
}
};
$scope.itemDescriptionUpdated = function( description ) {
$scope.boardItem.description = description;
if ( !! $scope.boardItem.id ) {
saveBoardItem();
}
};
$scope.itemColorUpdated = function( color ) {
$scope.boardItem.metaData.color = color;
if ( !! $scope.boardItem.id ) {
saveBoardItem();
}
};
$scope.itemNoteUpdated = function( noteContent ) {
$scope.boardItem.metaData.note = noteContent;
if ( !! $scope.boardItem.id ) {
saveBoardItem();
}
};
$scope.addTeamMembers = function() {
var boardID = ( ! $scope.board || ! $scope.board.id ) ? requestContext.getParamAsInt( "boardID" ) : $scope.board.id;
if ( $scope.isEnterprise ) {
$scope.openModalWindow( "enterpriseBoardMembers", boardID );
} else {
$scope.openModalWindow( "boardMembers", boardID );
}
};
$scope.isEmpty = function() {
for ( var i = 0; i < $scope.board.groups.length; i++ ) {
if ( !! $scope.board.groups[i].items && $scope.board.groups[i].items.length > 0 ) {
return false;
}
}
return true;
};
$scope.showUpgradeModal = function() {
analyticsService.trackGrowth("App - Upgrade - Hit Paywall", {"Paywall Type": "Boards Limit"});
$scope.openChangePlanModal( "boards quota" );
};
$scope.updateBoard = function( newTitle, newDescription ) {
var title = $scope.board.title;
var description = $scope.board.description;
var layoutTypeID = !! $scope.board.layoutTypeID ? $scope.board.layoutTypeID : 1;
if ( !! newTitle ) {
title = newTitle;
$scope.board.title = newTitle;
}
if ( !! newDescription || newDescription === "" ) {
description = newDescription;
$scope.board.description = newDescription;
}
if ( ! title ) {
$scope.openModalWindow( "error", "The title for your board cannot be left blank." );
return;
}
Deferred.handlePromise(
boardService.updateBoard( $scope.board.id, title, description, layoutTypeID ),
function( response ) {
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't update your board. Try refreshing your browser." );
}
);
};
$scope.deleteBoardPhotoHeader = function( boardID ) {
Deferred.handlePromise(
boardService.deleteBoardPhotoHeader( boardID ),
function( response ) {
}, function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't delete your board photo header. Try refreshing your browser." );
}
);
};
$scope.deleteBoardItem = function( boardItemID ) {
Deferred.handlePromise(
boardService.deleteBoardItem( boardItemID ),
function( response ) {
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't delete the board item. Try refreshing your browser." );
}
);
};
$scope.bulkDeleteItems = function( ids ) {
Deferred.handlePromise(
boardService.deleteBoardItems( ids ),
function( response ) {},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't delete the board items. Try refreshing your browser." );
}
);
};
$scope.newBoardItem = function( type, groupID ) {
groupID = groupID || $scope.board.groups[0].id;
var boardItem = {
groupID: groupID,
userOwnerID: $scope.user.id,
itemTypeID: boardService.itemTypes[ type.toUpperCase() ],
metaData: {}
};
saveNewBoardItem(boardItem, {
boardGroupID: groupID,
title: generateItemTitle(boardItem.itemTypeID),
sort: _.findWithProperty($scope.board.groups, "id", groupID).items.length,
tags: JSON.stringify([]),
color: "#EEEEEE",
note: ""
}, function(response) {
$scope.$broadcast("newBoardItemID", response.newBoardItemID);
});
};
$scope.updateBoardItem = function( item ) {
var boardGroupID = item.groupID;
var sort = item.sort;
var title = item.title;
var description = item.description;
var tags = JSON.stringify(item.metaData.tags);
var columns = item.columns;
var additionalParameters = {};
switch ( item.itemTypeID ) {
case boardService.itemTypes.COLOR :
additionalParameters.color = item.metaData.color;
break;
case boardService.itemTypes.NOTE :
additionalParameters.note = item.metaData.note;
break;
case boardService.itemTypes.IMAGE :
additionalParameters.imageColors = JSON.stringify(item.metaData.imagecolors);
break;
}
boardService.updateBoardItem( item.id, boardGroupID, sort, title, description, tags, columns, additionalParameters );
};
$scope.addBoardGroup = function( sort ) {
_.each($scope.board.groups, function(group) {
if ( group.sort > sort ) {
group.sort += 1;
}
});
var group = {
sort: sort + 1,
title: "",
description: "",
items: []
};
$scope.board.groups.push( group );
var groupIndex = $scope.board.groups.length - 1;
Deferred.handlePromise(
boardService.createBoardGroup( $scope.board.id, group.sort, group.title, group.description ),
function( response ) {
var groupID = parseInt( response.newBoardGroupID, 10 );
$scope.board.groups[groupIndex].id = groupID;
updateBoardGroupSorting();
$scope.$broadcast("boardLoaded");
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't save the section. Try refreshing your browser." );
}
);
};
$scope.updateBoardGroup = function( group, newTitle, newDescription ) {
var title = group.title || "";
var description = group.description || "";
if ( !! newTitle ) {
title = newTitle;
group.title = newTitle;
}
if ( !! newDescription || newDescription === "" ) {
description = newDescription;
group.description = newDescription;
}
Deferred.handlePromise(
boardService.updateBoardGroup( group.id, $scope.board.id, group.sort, title, description ),
function( response ) {
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't update the section. Try refreshing your browser." );
}
);
};
$scope.moveGroup = function( group, direction, preventMove ) {
if ( preventMove ) {
return false;
}
updateBoardGroupSorting();
};
$scope.deleteBoardGroup = function( boardGroupID ) {
Deferred.handlePromise(
boardService.deleteBoardGroup( boardGroupID ),
function( response ) {
},
function( response ) {
$scope.openModalWindow( "error", "For some reason, we couldn't delete the board group. Try refreshing your browser." );
}
);
};
$scope.triggerBrowse = function() {
$scope.$broadcast("triggerBoardUploadPrompt", $scope.board.groups[0].id);
};
$scope.findBoardItemWithProperty = function( property, value, board, returnMultiple ) {
board = board || $scope.board;
returnMultiple = !! returnMultiple;
var items = [];
for ( var i = 0; i < board.groups.length; i++ ) {
var group = board.groups[i];
if ( !! group.items ) {
for ( var j = 0; j < group.items.length; j++ ) {
var item = group.items[j];
if ( !! item[property] && item[property] === value ) {
if ( returnMultiple ) {
items.push( item );
} else {
return item;
}
}
}
}
}
if ( returnMultiple ) {
return items;
}
return false;
};
$scope.openBoardItemView = function( item ) {
$scope.boardItemView.showing = true;
$scope.boardItemView.item = item;
};
$scope.boardGroupWidth = function( groupItems ) {
if ( ! groupItems || groupItems.length > 1 ) {
return {};
} else if ( groupItems.length === 1 ) {
var columnCount = groupItems[0].columns;
var columnWidths = [ 270, 572, 873, 1176 ];
return {
width: columnWidths[columnCount - 1]
};
}
};
$scope.loadItemComments = function() {
function augmentCommentUsers( comments ) {
if ( !! comments ) {
for (var i = 0; i < comments.length; i++) {
var user = comments[i];
user.initials = userService.getInitials( user.name );
user.hasSystemAvatar = userService.isSystemAvatar( user.avatarID );
}
return comments;
}
}
if ( !! $scope.boardItem ) {
Deferred.handlePromise(
boardService.getBoardItem( $scope.boardItem.id ),
function( response ) {
$scope.boardItem.boardItemComments = augmentCommentUsers( response.boardItemComments );
for ( var i = 0; i < $scope.boardItem.boardItemComments.length; i++ ) {
if ( $scope.boardItem.boardItemComments[i].unread ) {
boardService.markBoardItemCommentsRead($scope.boardItem.id).then($scope.loadCommentsRoundup);
break;
}
}
$scope.$broadcast("boardItemCommentsLoaded");
}
);
}
};
$scope.addNewComment = function( commentText, notifyUsers, hasAnnotation, x, y, sketchData, mentions ) {
boardService.createBoardItemComment(
$scope.boardItem.id,
commentText,
notifyUsers,
hasAnnotation,
x,
y,
sketchData,
mentions
).then(function( response ) {
analyticsService.track("Comment.Added", {
boardid: $scope.boardID,
commentType: "board-item",
commentLocation: isShare ? "boardShare" : "boardEdit",
userNotified: !! ( mentions && mentions.length ),
boardItemType: boardService.itemTypeNames[ $scope.boardItem.itemTypeID ]
});
var newComment = _.find( response.boardItemComments, function( comment ) {
return comment.id === response.newCommentID;
});
var sketchID = !! newComment && !! newComment.sketchID ? newComment.sketchID : null;
$scope.$broadcast("newCommentID", $scope.boardItem, response.newCommentID, sketchID);
if ( !! hasAnnotation ) {
analyticsService.track("Boards.AnnotateComment", {
boardid: $scope.boardItem.boardID,
boardsAnnotationLocation: isShare ? "share" : "edit"
}, {
integrations: {
All: false,
Mixpanel: true
}
});
}
if ( !! sketchData ) {
analyticsService.track("Boards.SketchComment", {
boardid: $scope.boardItem.boardID,
boardsSketchLocation: isShare ? "share" : "edit"
}, {
integrations: {
All: false,
Mixpanel: true
}
});
}
}, function() {
$scope.openModalWindow("error", "There was an issue saving your comment. Please try again.");
});
};
$scope.changeIdentityAndAddNewComment = function( name, email, commentText, notifyUsers, hasAnnotation, x, y, sketchData, mentions ) {
if ( ! name || name == "" ) {
return;
}
if ( ! email || email == "" ) {
return;
}
var promise = Deferred.handlePromise(
( shareService.identify( name, email ) ),
function( response ) {
modelEvents.trigger( "identityChanged" );
$scope.addNewComment( commentText, notifyUsers, hasAnnotation, x, y, sketchData, mentions );
},
function( response ) { // TODO error
}
);
};
$scope.updateComment = function( commentID, content, hasAnnotation, x, y, hasExistingAnnotation, sketchID, sketchData, mentions ) {
boardService.updateBoardItemComment(commentID, content, hasAnnotation, x, y, sketchID, sketchData, mentions).then(function(response) {
if ( !! hasAnnotation && ! hasExistingAnnotation ) {
analyticsService.track("Boards.AnnotateComment", {
boardid: $scope.boardItem.boardID,
boardsAnnotationLocation: isShare ? "share" : "edit"
}, {
integrations: {
All: false,
Mixpanel: true
}
});
}
if ( ! sketchID && !! sketchData ) {
analyticsService.track("Boards.SketchComment", {
boardid: $scope.boardItem.boardID,
boardsSketchLocation: isShare ? "share" : "edit"
}, {
integrations: {
All: false,
Mixpanel: true
}
});
}
});
};
$scope.deleteComment = function( commentID ) {
Deferred.handlePromise(
boardService.deleteBoardItemComment( commentID,
function( commentID ) {
},
function() {
})
);
};
$scope.bulkResizeItems = function( ids, columns ) {
var resizeArray = [];
for ( var i = 0; i < ids.length; i++ ) {
resizeArray.push({ "id": ids[i], "columns": columns });
}
boardService.updateItemColumns($scope.boardID, resizeArray);
};
$scope.setImageColors = function(item) {
var itemCopy = _.clone(item, true);
var img = new Image();
img.onload = function() {
itemCopy.metaData.imagecolors = colorExtractionService.extractColorsFromImage( img, 8 );
InvBoards.actions.imageColorsLoaded(itemCopy);
if (! isShare) {
boardService.updateBoardItem(
itemCopy.id,
itemCopy.groupID,
itemCopy.sort,
itemCopy.title,
itemCopy.description,
JSON.stringify([]),
itemCopy.columns,
{
imageColors: JSON.stringify(itemCopy.metaData.imagecolors)
}
);
}
};
img.crossOrigin = "Anonymous";
img.src = itemCopy.metaData.imageUrl;
};
$scope.loadCommentsRoundup = function() {
var boardID = isShare ? $scope.boardID : requestContext.getParamAsInt( "boardID" );
boardService.getCommentsRoundup(boardID).then(function(data) {
InvBoards.actions.commentsRoundupLoaded(boardID, data);
});
};
$scope.setPhotoHeaderSize = function(size) {
$scope.updateBoardPhotoHeader( $scope.board.photoHeaderOffset, $scope.board.photoHeaderBlur, $scope.board.photoHeaderTint, parseInt(size, 10) );
};
$scope.setPhotoHeaderOffset = function(offset) {
$scope.updateBoardPhotoHeader( parseInt(offset, 10), $scope.board.photoHeaderBlur, $scope.board.photoHeaderTint, $scope.board.photoHeaderSize );
};
$scope.setPhotoHeaderTint = function(tint) {
$scope.updateBoardPhotoHeader( $scope.board.photoHeaderOffset, $scope.board.photoHeaderBlur, parseInt(tint, 10), $scope.board.photoHeaderSize );
};
$scope.setPhotoHeaderBlur = function(blur) {
$scope.updateBoardPhotoHeader( $scope.board.photoHeaderOffset, parseInt(blur, 10), $scope.board.photoHeaderTint, $scope.board.photoHeaderSize );
};
$scope.updateBoardPhotoHeader = function( offset, blur, tint, size ) {
Deferred.handlePromise(
boardService.updateBoardPhotoHeader(
$scope.boardID,
offset || 0,
blur || 0,
0, // Noise value TODO remove
tint || 0,
size || 1
),
function() {
},
function() {
$scope.openModalWindow("error", "There was an issue updating your header image settings. Please try again.");
}
);
};
$scope.isLoading = true;
$scope.shouldClose = isNonce;
if (isShare) {
$scope.board = $scope.share.data;
$scope.boardID = !! $scope.share.data.boardID ? $scope.share.data.boardID : $scope.board.id;
$scope.boardItem = null;
$scope.setWindowTitle( $scope.board.title );
$timeout(function() {
if ( !! $scope.share.config.boardItemID ) {
$scope.boardItem = $scope.share.data;
$scope.$broadcast("singleItemShareLoaded");
} else {
$scope.$broadcast("boardLoaded");
}
});
} else {
$scope.boardID = requestContext.getParamAsInt( "boardID" );
$scope.board = null;
$scope.boardItem = null;
}
$scope.boardCopy = null;
$scope.boardGroupCopies = {};
$scope.boardItemView = {
showing: false,
item: {}
};
modelEvents.on( "boardUpdated.boardDetails", function(event, response, triggeredByUserID ) {
if ($scope.user.id != triggeredByUserID) {
loadRemoteData();
}
});
modelEvents.on( "boardItemCreated.boardDetails", function( event, response ) {
updateBoardItems( response );
});
modelEvents.on( "boardItemUploaded.boardDetails", function( event, response, triggeredByUserID ) {
if (! $scope.board || parseInt(response.boardID, 10) !== parseInt($scope.board.id, 10)) {
return;
}
loadRemoteData();
boardService.getBoardItem( response.id ).then(function(returnItem) {
InvBoards.actions.itemUploaded(returnItem);
});
});
modelEvents.on( "boardItemFlattenedUploaded.boardDetails", function( event, response ) {
if (! $scope.board || parseInt(response.boardID, 10) !== parseInt($scope.board.id, 10)) {
return;
}
setTimeout(function() {
boardService.getBoardItem(response.id).then(function(returnItem) {
InvBoards.actions.sourceFilePreviewGenerated(returnItem);
});
});
});
modelEvents.on( "boardPhotoHeaderUploaded.boardDetails", function( event, response, triggeredByUserID ) {
if ( response.boardID === $scope.boardID ) {
boardService.getBoard( response.boardID ).then(function(board) {
InvBoards.actions.boardHeaderUploaded(board);
});
}
if ($scope.user.id != triggeredByUserID) {
loadRemoteData();
}
});
modelEvents.on( "boardItemDeleted.boardDetails", function( event, response ) {
updateBoardItems( response );
$scope.$broadcast("boardLoaded");
});
modelEvents.on( "boardGroupDeleted.boardDetails", function( event, response ) {
updateBoardItems( response );
$scope.$broadcast("boardLoaded");
});
modelEvents.on( "boardUsersUpdated.boardDetails", function( event, response ) {
updateBoardItems( response );
$scope.$broadcast("boardLoaded");
});
modelEvents.on( "boardInviteesUpdated.boardDetails", function( event, response ) {
updateBoardItems( response );
$scope.$broadcast("boardLoaded");
});
modelEvents.on( "teamInvitationCreated.boardDetails", function( event, response ) {
addTeamInvites( response );
$scope.$broadcast("boardLoaded");
});
modelEvents.on( "boardItemUpdated.boardDetails", function( event, response ) {
updateBoardItems( response );
});
modelEvents.on( "boardItemUploadStart.boardDetails", function( event, files ) {
createBoardItemPlaceholders( files );
});
modelEvents.on( "updatePlaceholderItemProgress.boardDetails", function( event, data ) {
var affectedPlaceholder = $scope.findBoardItemWithProperty( "uploaderID", data.id );
if ( !! affectedPlaceholder && ! affectedPlaceholder.isProcessed ) {
affectedPlaceholder.progress = data.progress;
}
});
modelEvents.on( "boardItemCommentAdded.boardDetails", function( event, boardItemCommentID, boardItemID, boardID, triggeredByUserID ) {
if ($scope.user.id != triggeredByUserID) {
InvBoards.actions.loadCommentsRoundup();
if (!!$scope.boardItem) {
if ($scope.boardItem.id === boardItemID) {
InvBoards.actions.loadItemComments($scope.boardItem);
}
}
}
});
modelEvents.on("showGoogleFilePicker.boardDetails", function( event ) {
$scope.openModalWindow( "googlePicker" );
});
modelEvents.on(
"subscriptionChanged.board",
function( event, subscription ) {
loadRemoteData();
}
);
modelEvents.on(
"selectiveSyncFilesUploading.board",
function( event, files, groupID, groupType, fileData, vendor ) {
if (groupType !== "board" || groupID !== $scope.board.id) {
return;
}
vendor = (vendor === "gDrive") ? "google" : vendor;
analyticsService.track("Boards.SelectiveSync", {
boardsSyncType: vendor
});
}
);
$scope.$on(
"saveBoardItem",
function( event, params ) {
$scope.saveBoardItem( params );
}
);
$scope.$on(
"newCommentAdded",
function( event, boardItem ) {
var itemGroupIndex = _.indexOfWithProperty( $scope.board.groups, "id", boardItem.groupID );
var itemIndex = _.indexOfWithProperty( $scope.board.groups[itemGroupIndex].items, "id", boardItem.id );
$scope.board.groups[itemGroupIndex].items[itemIndex].commentCount++;
}
);
$scope.$on(
"commentDeleted",
function( event, boardItem ) {
var itemGroupIndex = _.indexOfWithProperty( $scope.board.groups, "id", boardItem.groupID );
var itemIndex = _.indexOfWithProperty( $scope.board.groups[itemGroupIndex].items, "id", boardItem.id );
if ( !! $scope.board.groups[itemGroupIndex].items[itemIndex].commentCount ) {
$scope.board.groups[itemGroupIndex].items[itemIndex].commentCount--;
}
}
);
$scope.$on(
"dragItemPositioned",
function( event ) {
$timeout(function() {
updateBoardItems();
});
}
);
modelEvents.on(
"hideUploadOverlay.boardDetails",
function() {
InvBoards.actions.hideAddView();
}
);
$scope.$on(
"$destroy",
function() {
modelEvents.off( "boardUpdated.boardDetails" );
modelEvents.off( "boardItemCommentAdded.boardDetails" );
modelEvents.off( "boardItemCreated.boardDetails" );
modelEvents.off( "boardItemUploaded.boardDetails" );
modelEvents.off( "boardItemDeleted.boardDetails" );
modelEvents.off( "boardItemUpdated.boardDetails" );
modelEvents.off( "boardGroupDeleted.boardDetails" );
modelEvents.off( "boardUsersUpdated.boardDetails" );
modelEvents.off( "boardInviteesUpdated.boardDetails" );
modelEvents.off( "boardItemUploadStart.boardDetails" );
modelEvents.off( "updatePlaceholderItemProgress.boardDetails" );
modelEvents.off( "teamInvitationCreated.boardDetails" );
modelEvents.off( "subscriptionChanged.board" );
modelEvents.off( "boardItemFlattenedUploaded.boardDetails" );
modelEvents.off( "showGoogleFilePicker.boardDetails" );
modelEvents.off( "selectiveSyncFilesUploading.board" );
modelEvents.off( "hideUploadOverlay.boardDetails" );
modelEvents.off( "boardPhotoHeaderUploaded.boardDetails" );
$scope.clearSecondaryBodyClass();
if ( !! sheet ) {
if ( !! sheet.ownerNode ) {
document.head.removeChild( sheet.ownerNode );
}
sheet = null;
}
}
);
$scope.setWindowTitle( "Boards" );
if (!! $scope.setSecondaryBodyClass) {
$scope.setSecondaryBodyClass( "board" );
}
if (! isShare) {
loadRemoteData();
}
}
})( angular, InVision );
;
;
/*! board-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "boardService", Service );
/** @ngInject */
function Service( $resource, serviceHelper, modelEvents, analyticsService ) {
function getBoards() {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "getBoards"
});
return( promise );
}
function getBoard( boardID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "getBoard",
parameters: {
id: boardID
},
successCallback: function( response ) {
}
});
return( promise );
}
function archiveBoard(boardID) {
return serviceHelper.executeRequest({
resource: resource,
name: "archiveBoard",
parameters: {
id: boardID
}
});
}
function activateBoard(boardID) {
return serviceHelper.executeRequest({
resource: resource,
name: "activateBoard",
parameters: {
id: boardID
}
});
}
function duplicateBoard(boardId) {
return serviceHelper.executeRequest({
resource: resource,
name: "duplicateBoard",
parameters: {
boardId: boardId
}
});
}
function createBoard( title, description, userID, layoutTypeID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createBoard",
parameters: {
title: title,
description: description,
userID: userID,
layoutTypeID: layoutTypeID
},
successCallback: function( response ) {
modelEvents.trigger( "boardCreated", response );
}
});
return( promise );
}
function updateBoard( boardID, title, description, layoutTypeID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateBoard",
parameters: {
boardID: boardID,
title: title,
description: description,
layoutTypeID: layoutTypeID
},
successCallback: function( response ) {
modelEvents.trigger( "boardUpdated", response );
}
});
return( promise );
}
function updateBoardSettings( boardID, settings ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateBoardSettings",
parameters: {
boardID: boardID,
disableFontDownloads: settings.disableFontDownloads,
disableSourceDownloads: settings.disableSourceDownloads,
disableImageDownloads: settings.disableImageDownloads,
password: settings.boardPassword
},
successCallback: function( response ) {
modelEvents.trigger( "boardUpdated", response );
}
});
return( promise );
}
function updateBoardPhotoHeader( boardID, photoHeaderOffset, photoHeaderBlur, photoHeaderNoise, photoHeaderTint, photoHeaderSize ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateBoardPhotoHeader",
parameters: {
boardID: boardID,
photoHeaderOffset: photoHeaderOffset,
photoHeaderBlur: photoHeaderBlur,
photoHeaderNoise: photoHeaderNoise,
photoHeaderTint: photoHeaderTint,
photoHeaderSize: photoHeaderSize
},
successCallback: function( response ) {
modelEvents.trigger( "boardUpdated", response );
}
});
return( promise );
}
function deleteBoardPhotoHeader( boardID ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "deleteBoardPhotoHeader",
parameters: {
id: boardID
},
successCallback: function( response ) {
modelEvents.trigger( "boardUpdated", response );
}
});
return( promise );
}
function deleteBoard( boardID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "deleteBoard",
parameters: {
listCommand: boardID
},
successCallback: function( response ) {
modelEvents.trigger( "boardDeleted", response );
}
});
return( promise );
}
function createBoardGroup( boardID, sort, title, description ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createBoardGroup",
parameters: {
boardID: boardID,
sort: sort,
title: title,
description: description
},
successCallback: function( response ) {
modelEvents.trigger( "boardGroupCreated", response );
}
});
return( promise );
}
function updateBoardGroup( boardGroupID, boardID, sort, title, description ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateBoardGroup",
parameters: {
boardGroupID: boardGroupID,
boardID: boardID,
sort: sort,
title: title,
description: description
},
successCallback: function( response ) {
modelEvents.trigger( "boardGroupUpdated", response );
}
});
return( promise );
}
function updateGroupSort( boardID, groupIDs ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateGroupSort",
parameters: {
boardID: boardID,
groupIDs: groupIDs
},
successCallback: function( response ) {
modelEvents.trigger( "boardGroupsSorted", response );
}
});
return( promise );
}
function deleteBoardGroup( boardGroupID ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "deleteBoardGroup",
parameters: {
id: boardGroupID
},
successCallback: function( response ) {
modelEvents.trigger( "boardGroupDeleted", response );
}
});
return( promise );
}
function changeUsersOnBoard(boardID, addUserIDList, removeUserIDList, newUsersEmailMsg) {
var remove = removeUserIDList || [];
var msg = newUsersEmailMsg || "";
var promise = serviceHelper.executeRequest({
resource: resource,
name: "changeUsersOnBoard",
parameters: {
id: boardID,
addUserIDList: addUserIDList.join( "," ),
removeUserIDList: remove.join( "," ),
newUsersEmailMsg: msg
},
successCallback: function( response ) {
if ( addUserIDList.length || remove.length) {
modelEvents.trigger( "boardUsersUpdated", response );
}
}
});
return( promise );
}
function changeEnterpriseUsersOnBoard( boardID, addUserIDList, removeUserIDList, companyTeamIDList, newUsersEmailMsg ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "changeEnterpriseUsersOnBoard",
parameters: {
id: boardID,
addUserIDList: addUserIDList.join( "," ),
removeUserIDList: removeUserIDList.join( "," ),
companyTeamIDList: companyTeamIDList.join( "," ),
newUsersEmailMsg: newUsersEmailMsg
},
successCallback: function( response ) {
if ( addUserIDList.length || removeUserIDList.length) {
modelEvents.trigger( "boardUsersUpdated", response );
}
}
});
return( promise );
}
function changeInviteesOnBoard( boardID, addInviteIDs, removeInviteIDs ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "changeInviteesOnBoard",
parameters: {
id: boardID,
addInviteIDList: addInviteIDs.join( "," ),
removeInviteIDList: removeInviteIDs.join( "," )
},
successCallback: function( response ) {
if ( addInviteIDs.length || removeInviteIDs.length ) {
modelEvents.trigger( "boardInviteesUpdated", response );
}
}
});
return( promise );
}
function getBoardItem( boardItemID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "getBoardItem",
parameters: {
id: boardItemID
}
});
return( promise );
}
function markBoardItemCommentsRead( boardItemID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "markBoardItemCommentsRead",
parameters: {
id: boardItemID
}
});
return( promise );
}
function createNoteItem( boardGroupID, sort, title, note, tags ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createNoteItem",
parameters: {
boardGroupID: boardGroupID,
sort: sort,
title: title,
note: note,
tags: tags
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemCreated", response );
}
});
return( promise );
}
function createColorSwatchItem( boardGroupID, sort, title, color, tags ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createColorSwatchItem",
parameters: {
boardGroupID: boardGroupID,
sort: sort,
title: title,
color: color,
tags: tags
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemCreated", response );
}
});
return( promise );
}
function createImageItem( boardGroupID, sort, title, file, tags ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createImageItem",
parameters: {
boardGroupID: boardGroupID,
sort: sort,
title: title,
file: file,
tags: tags
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemCreated", response );
}
});
return( promise );
}
function updateBoardItem( boardItemID, boardGroupID, sort, title, description, tags, columns, additionalParameters ) {
additionalParameters = additionalParameters || {};
var parameters = {
itemId: boardItemID,
boardGroupID: boardGroupID,
sort: sort,
title: title,
description: description,
tags: tags,
columns: columns
};
for( var key in additionalParameters ) {
if( key === "color" || key === "note" || key === "imageColors" ) {
parameters[key] = additionalParameters[key];
}
}
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateBoardItem",
parameters: parameters,
successCallback: function( response ) {
modelEvents.trigger( "boardItemUpdated", response );
}
});
return( promise );
}
function deleteBoardItem( boardItemID ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "deleteBoardItem",
parameters: {
id: boardItemID
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemDeleted", response );
}
});
return( promise );
}
function deleteBoardItems( boardItemIDs ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "deleteBoardItems",
parameters: {
boardItemIDs: JSON.stringify(boardItemIDs)
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemsDeleted", response );
}
});
return( promise );
}
function updateItemSort( boardID, sortData ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateItemSort",
parameters: {
boardID: boardID,
sortData: sortData
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemsSorted", response );
}
});
return( promise );
}
function updateItemColumns( boardID, columnData ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateItemColumns",
parameters: {
id: boardID,
boardItems: columnData
}
});
return( promise );
}
function createBoardItemComment( boardItemID, comment, notifyUsers, hasAnnotation, x, y, sketchData, mentions ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createBoardItemComment",
parameters: {
boardItemID: boardItemID,
comment: comment,
notifyUsers: notifyUsers,
hasAnnotation: hasAnnotation,
x: x,
y: y,
sketch: sketchData,
mentions: mentions
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemCommentCreated", response );
}
});
return( promise );
}
function updateBoardItemComment( commentID, comment, hasAnnotation, x, y, sketchID, sketchData, mentions ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "updateBoardItemComment",
parameters: {
commentID: commentID,
comment: comment,
hasAnnotation: hasAnnotation,
x: x,
y: y,
sketchID: sketchID,
sketch: sketchData,
mentions: mentions
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemCommentUpdated", response );
}
});
return( promise );
}
function deleteBoardItemComment( commentID ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "deleteBoardItemComment",
parameters: {
itemId: commentID
},
successCallback: function( response ) {
modelEvents.trigger( "boardItemCommentDeleted", commentID );
}
});
return( promise );
}
function createShare( boardID, boardItemID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "createShare",
parameters: {
boardID: boardID,
boardItemID: boardItemID
},
successCallback: function( response ) {
modelEvents.trigger( "createShare", response );
}
});
return( promise );
}
function sendShareEmail( shareID, emailList, message ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "sendShareEmail",
parameters: {
shareID: shareID,
emailList: emailList,
message: message
}
});
return( promise );
}
function requestUpload(files, boardGroupID) {
return serviceHelper.executeRequest({
resource: resource,
name: "requestUpload",
parameters: {
files: JSON.stringify(files),
boardGroupID: boardGroupID
}
});
}
function requestPhotoHeaderUpload( file, boardID ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "requestPhotoHeaderUpload",
parameters: {
file: JSON.stringify(file),
boardID: boardID
}
});
return( promise );
}
function getCommentsRoundup( boardID ){
var promise = serviceHelper.executeRequest({
resource: resource,
name: "getCommentsRoundup",
parameters: {
id: boardID
}
});
return( promise );
}
function unsubscribeBoardItem( boardItemID ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "unsubscribeBoardItem",
parameters: {
id: boardItemID
},
successCallback: function( response ) {
modelEvents.trigger( "unsubscribeBoardItem", response );
}
});
return( promise );
}
var resource = $resource(
"/api/board/:listCommand/:id/:docCommand/:itemId/:itemType",
{
id: "@id",
listCommand: "@listCommand",
docCommand: "@docCommand",
itemId: "@itemId",
itemType: "@itemType"
},
{
getBoards: {
method: "GET",
isArray: true,
params: {
listCommand: "all"
}
},
getBoard: {
method: "GET"
},
archiveBoard: {
method: "POST",
params: {
docCommand: "archive"
}
},
activateBoard: {
method: "POST",
params: {
docCommand: "activate"
}
},
duplicateBoard: {
method: "POST",
params: {
listCommand: "copy"
}
},
createBoard: {
method: "POST",
params: {
listCommand: "create"
}
},
updateBoard: {
method: "POST",
params: {
listCommand: "update"
}
},
updateBoardSettings: {
method: "POST",
params: {
listCommand: "update-board-settings"
}
},
updateBoardPhotoHeader: {
method: "POST",
params: {
listCommand: "photo-header",
docCommand: "update"
}
},
deleteBoardPhotoHeader: {
method: "DELETE",
params: {
listCommand: "photo-header"
}
},
deleteBoard: {
method: "DELETE",
isArray: true,
params: {}
},
createBoardGroup: {
method: "POST",
params: {
listCommand: "group",
docCommand: "create"
}
},
updateBoardGroup: {
method: "POST",
params: {
listCommand: "group",
docCommand: "update"
}
},
deleteBoardGroup: {
method: "DELETE",
params: {
listCommand: "group"
}
},
updateGroupSort: {
method: "POST",
params: {
listCommand: "updateGroupSort"
}
},
changeUsersOnBoard: {
method: "POST",
params: {
docCommand: "change-users"
}
},
changeEnterpriseUsersOnBoard: {
method: "POST",
params: {
docCommand: "change-enterprise-users"
}
},
changeInviteesOnBoard: {
method: "POST",
params: {
docCommand: "change-invitees"
}
},
getBoardItem: {
method: "GET",
params: {
listCommand: "item"
}
},
markBoardItemCommentsRead: {
method: "GET",
params: {
listCommand: "item",
docCommand: "mark-comments-read"
}
},
createNoteItem: {
method: "POST",
params: {
listCommand: "item",
docCommand: "create",
itemType: "note"
}
},
createColorSwatchItem: {
method: "POST",
params: {
listCommand: "item",
docCommand: "create",
itemType: "colorSwatch"
}
},
createImageItem: {
method: "POST",
params: {
listCommand: "item",
docCommand: "create",
itemType: "image"
}
},
updateBoardItem: {
method: "POST",
params: {
listCommand: "item",
docCommand: "update"
}
},
deleteBoardItem: {
method: "DELETE",
params: {
listCommand: "item"
}
},
deleteBoardItems:{
method: "POST",
params: {
listCommand: "items",
docCommand: "delete"
}
},
updateItemSort: {
method: "POST",
params: {
listCommand: "updateItemSort"
}
},
updateItemColumns: {
method: "PUT",
params: {
docCommand: "items",
itemId: "column",
itemType: "update"
}
},
requestUpload: {
method: "POST",
isArray: true,
params:{
listCommand: "request-upload"
}
},
requestPhotoHeaderUpload: {
method: "POST",
isArray: true,
params:{
listCommand: "photo-header",
docCommand: "request-upload"
}
},
createBoardItemComment: {
method: "POST",
params: {
listCommand: "item",
docCommand: "comment",
itemType: "create"
}
},
updateBoardItemComment: {
method: "POST",
params: {
listCommand: "item",
docCommand: "comment",
itemType: "update"
}
},
deleteBoardItemComment: {
method: "DELETE",
params: {
listCommand: "item",
docCommand: "comment"
}
},
createShare: {
method: "POST",
params: {
listCommand: "share"
}
},
sendShareEmail: {
method: "POST",
params: {
listCommand: "sendShareEmail"
}
},
getCommentsRoundup: {
method: "GET",
isArray: true,
params: {
docCommand: "comments"
}
},
unsubscribeBoardItem: {
method: "POST",
params: {
listCommand: "item",
docCommand: "unsubscribe"
}
}
}
);
var itemTypes = {
IMAGE: 1,
NOTE: 2,
COLOR: 3,
FONT: 4,
DOCUMENT: 5,
MEDIA: 6,
SOURCE: 7,
GENERIC: 8,
FILE: [4, 5, 6, 7, 8]
};
var itemTypeNames = {
1: "image",
2: "note",
3: "color",
4: "font",
5: "document",
6: "media",
7: "sourceFile",
8: "genericFile"
};
var layoutTypes = {
MASONRY: 1,
METICULOUS: 2,
GRID: 3
};
return {
activateBoard: activateBoard,
archiveBoard: archiveBoard,
changeEnterpriseUsersOnBoard: changeEnterpriseUsersOnBoard,
changeInviteesOnBoard: changeInviteesOnBoard,
changeUsersOnBoard: changeUsersOnBoard,
createBoard: createBoard,
createBoardGroup: createBoardGroup,
createBoardItemComment: createBoardItemComment,
createColorSwatchItem: createColorSwatchItem,
createImageItem: createImageItem,
createNoteItem: createNoteItem,
createShare: createShare,
deleteBoard: deleteBoard,
deleteBoardGroup: deleteBoardGroup,
deleteBoardItem: deleteBoardItem,
deleteBoardItemComment: deleteBoardItemComment,
deleteBoardItems: deleteBoardItems,
deleteBoardPhotoHeader: deleteBoardPhotoHeader,
duplicateBoard: duplicateBoard,
getBoard: getBoard,
getBoardItem: getBoardItem,
getBoards: getBoards,
getCommentsRoundup: getCommentsRoundup,
itemTypeNames: itemTypeNames,
itemTypes: itemTypes,
layoutTypes: layoutTypes,
markBoardItemCommentsRead: markBoardItemCommentsRead,
requestPhotoHeaderUpload: requestPhotoHeaderUpload,
requestUpload: requestUpload,
sendShareEmail: sendShareEmail,
unsubscribeBoardItem: unsubscribeBoardItem,
updateBoard: updateBoard,
updateBoardGroup: updateBoardGroup,
updateBoardItem: updateBoardItem,
updateBoardItemComment: updateBoardItemComment,
updateBoardPhotoHeader: updateBoardPhotoHeader,
updateBoardSettings: updateBoardSettings,
updateGroupSort: updateGroupSort,
updateItemColumns: updateItemColumns,
updateItemSort: updateItemSort
};
}
})( angular, InVision );
;
;
/*! color-extraction-service.js */ 
;
;
(function( ng, app, ColorThief ) {
"use strict";
app.service( "colorExtractionService", Service );
/** @ngInject */
function Service( _ ) {
function extractColorsFromImage( image, numberOfColors ) {
var colorThief = new ColorThief(),
rgbPalette = colorThief.getPalette( image, numberOfColors+2 );
return rgbToHex( rgbPalette, numberOfColors );
}
function rgbToHex( rgbArray, numberOfColors ) {
var hexArray = [],
individualHex = "";
for( var i=0; i<numberOfColors; i++ ) {
if( ! rgbArray[i] ) {
continue;
}
individualHex = "#";
for( var j=0; j<3; j++ ) {
var colorHex = rgbArray[i][j].toString(16);
colorHex = colorHex.length === 1 ? "0" + colorHex : colorHex;
individualHex += colorHex;
}
hexArray.push( individualHex );
}
return hexArray;
}
return({
extractColorsFromImage: extractColorsFromImage
});
}
})( angular, InVision, ColorThief );
;
;
/*! share-service.js */ 
;
;
(function( ng, app ) {
"use strict";
app.service( "shareService", ShareService );
/** @ngInject */
function ShareService( $resource, serviceHelper, config, modelEvents, _ ) {
function identify( name, email ) {
var promise = serviceHelper.executeRequest({
resource: resource,
name: "identify",
parameters: {
key: getShare().config.key,
name: name,
email: email
},
successCallback: function( response ) {
modelEvents.trigger( "shareIdentityChanged", response );
}
});
return( promise );
}
function getShare() {
var share = {
config: ng.copy( config.share ),
data: ng.copy( config.data )
};
return share;
}
function getShareConfig( shareID ){
if ( cachedShareConfigFailure !== null ) {
return( cachedShareConfigFailure );
}
var promise = serviceHelper.executeRequest({
resource: resource,
name: "getShareConfig",
parameters: {
key: shareID
}
});
promise.then(
null,
function() {
cachedShareConfigFailure = promise;
}
);
return( promise );
}
var resource = $resource(
"/api/board/share/:key/:command/",
{
key: "@key",
command: "@command"
},
{
getShareConfig: {
method: "GET",
params: {
command: "share"
}
},
identify: {
method: "POST",
params: {
command: "change-identity"
}
}
}
);
var cachedShareConfigFailure = null;
return({
getShare: getShare,
getShareConfig: getShareConfig,
identify: identify
});
}
})( angular, InVision );
;
;
/*! segmentio.js */ 
;
;
if ( typeof config === "undefined" || config.allowExternalScripts !== false ) {
window.analytics=window.analytics||[],window.analytics.methods=["identify","group","track","page","pageview","alias","debug","ready","on","once","off","trackLink","trackForm","trackClick","trackSubmit"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var key=window.analytics.methods[i];window.analytics[key]=window.analytics.factory(key)}window.analytics.load=function(t){if(!document.getElementById("analytics-js")){var a=document.createElement("script");a.type="text/javascript",a.id="analytics-js",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.io/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}},window.analytics.SNIPPET_VERSION="2.0.9";
} else {
window.analytics = [];
window.analytics.alias = function() {};
window.analytics.group = function() {};
window.analytics.identify = function() {};
window.analytics.load = function(key) {};
window.analytics.on = function() {};
window.analytics.once = function() {};
window.analytics.off = function() {};
window.analytics.page = function() {};
window.analytics.pageview = function() {};
window.analytics.ready  = function() {};
window.analytics.track = function() {};
window.analytics.trackLink = function() {};
window.analytics.trackForm = function() {};
window.analytics.trackClick = function() {};
window.analytics.trackSubmit = function() {};
}
